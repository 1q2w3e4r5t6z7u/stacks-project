\input{preamble}

% OK, start here.
%
\begin{document}

\title{Deformation Problems}

\maketitle

\phantomsection
\label{section-phantom}

\tableofcontents

\section{Introduction}
\label{section-introduction}

\noindent
The goal of this chapter is to work out examples of the general theory
developed in the chapters Formal Deformation Theory,
Deformation Theory, The Cotangent Complex.

\medskip\noindent
Section 3 of the paper \cite{Sch} by Schlessinger discusses some
examples as well.






\section{Examples of deformation problems}
\label{section-examples}

\noindent
List of things that should go here:
\begin{enumerate}
\item Deformations of schemes:
\begin{enumerate}
\item The Rim-Schlessinger condition.
\item Computing the tangent space.
\item Computing the infinitesimal deformations.
\item The deformation category of an affine hypersurface.
\end{enumerate}
\item Deformations of sheaves (for example fix $X/S$, a finite type point
$s$ of $S$, and a quasi-coherent sheaf $\mathcal{F}_s$ over $X_s$).
\item Deformations of algebraic spaces (very similar to deformations
of schemes; maybe even easier?).
\item Deformations of maps (eg morphisms between schemes; you can fix
both or one of the target and/or source).
\item Add more here.
\end{enumerate}





\section{General outline}
\label{section-general}

\noindent
This section lays out the procedure for discussing the next few examples.

\medskip\noindent
Step I. For each section we fix a Noetherian ring $\Lambda$ and
we fix a finite ring map $\Lambda \to k$ where $k$ is a field.
As usual we let $\mathcal{C}_\Lambda = \mathcal{C}_{\Lambda, k}$
be our base category, see
Formal Deformation Theory,
Definition \ref{formal-defos-definition-CLambda}.

\medskip\noindent
Step II. In each section we define a category $\mathcal{F}$
cofibred in groupoids over $\mathcal{C}_\Lambda$. Occassionally
we will consider instead a functor
$F : \mathcal{C}_\Lambda \to \textit{Sets}$.

\medskip\noindent
Step III. We explain to what extend $\mathcal{F}$ satisfies
the Rim-Schlesssinger condition (RS) discussed in
Formal Deformation Theory, Section \ref{formal-defos-section-RS-condition}.
Similarly, we may discuss to what extend our $\mathcal{F}$
satisfies (S1) and (S2) or to what extend $F$ satisfies
the corresponding Schlessinger's conditions (H1) and (H2).
See Formal Deformation Theory, Section
\ref{formal-defos-section-schlessinger-conditions}.

\medskip\noindent
Step IV. Assume $\mathcal{F}$ has (RS).
Let $x_0$ be any object of $\mathcal{F}(k)$
for $\mathcal{F}$. Then $\mathcal{F}_{x_0}$ is
a deformation category, see
Formal Deformation Theory, Lemma
\ref{formal-defos-lemma-localize-RS}.
In particular, $\mathcal{F}_{x_0}$ satisfies (S1) and (S2)
(Formal Deformation Theory, Lemma
\ref{formal-defos-lemma-RS-implies-S1-S2}).
Thus an important question is now whether the tangent space
$$
T_{x_0}\mathcal{F} = T\mathcal{F}_{x_0}
$$
(see Formal Deformation Theory, Remark
\ref{formal-defos-remark-tangent-space-cofibered-groupoid} and
Definition \ref{formal-defos-definition-tangent-space})
is finite dimensional. Namely, this insures that
$\mathcal{F}_{x_0}$ has a versal formal object
(Formal Deformation Theory, Lemma
\ref{formal-defos-lemma-versal-object-existence}).

\medskip\noindent
Step V. If $\mathcal{F}$ passes Step IV, then we want to see if
$$
\text{Inf}_{x_0}(\mathcal{F})
$$
is finite dimensional. Namely, this will imply that
$\mathcal{F}_{x_0}$ admits a presentation by a
smooth prorepresentable groupoid in functors on $\mathcal{C}_\Lambda$, see
Formal Deformation Theory, Theorem
\ref{formal-defos-theorem-presentation-deformation-groupoid}.




\section{Finite projective modules}
\label{section-finite-projective-modules}

\noindent
This section is just a warmup. Of course finite projective modules
should not have any ``moduli''.

\begin{example}[Finite projective modules]
\label{example-finite-projective-modules}
Let $\mathcal{F}$ be the category defined as follows
\begin{enumerate}
\item an object is a pair $(A, M)$ consisting of an
object $A$ of $\mathcal{C}_\Lambda$ and a
finite projective $A$-module $M$, and
\item a morphism $(f, g) : (B, N) \to (A, M)$ consists of
a morphism $f : B \to A$ in $\mathcal{C}_\Lambda$ together
with a map $g : N \to M$ which is $f$-linear and induces
an isomorpism $N \otimes_{B, f} A \cong M$.
\end{enumerate}
The functor $p : \mathcal{F} \to \mathcal{C}_\Lambda$ sends $(A, M)$ to $A$
and $(f, g)$ to $f$. It is clear that $p$ is cofibred in groupoids.
Since every finite projective module over a local ring is finite free
(Algebra, Lemma \ref{algebra-lemma-finite-projective})
we see that
$$
\begin{matrix}
\text{isomorphism classes} \\
\text{of objects of }\mathcal{F}(A)
\end{matrix}
= \coprod\nolimits_{n \geq 0} \{*\}
$$
\end{example}

\begin{lemma}
\label{lemma-finite-projective-modules-RS}
Example \ref{example-finite-projective-modules}
satisfies the Rim-Schlessinger condition (RS).
\end{lemma}

\begin{proof}
Let $A_1 \to A$ and $A_2 \to A$ be morphisms of $\mathcal{C}_\Lambda$.
Assume $A_2 \to A$ is surjective. According to
Formal Deformation Theory, Lemma
\ref{formal-defos-lemma-RS-2-categorical}
it suffices to show that the functor
$\mathcal{F}(A) \to \mathcal{F}(A_1) \times_{\mathcal{F}(A)} \mathcal{F}(A_2)$
is an equivalence of categories.

\medskip\noindent
Thus we have to show that the category of finite projective modules
over $A_1 \times_A A_2$ is equivalent to the fibre product
of the categories of finite projective modules over $A_1$ and $A_2$
over the category of finite projective modules over $A$.
This is a special case of More on Algebra, Lemma
\ref{more-algebra-lemma-finitely-presented-module-over-fibre-product}.
We recall that the inverse functor sends the triple
$(M_1, M_2, \varphi)$ where
$M_1$ is a finite projective $A_1$-module,
$M_2$ is a finite projective $A_2$-module, and
$\varphi : M_1 \otimes_{A_1} A \to M_2 \otimes_{A_2} A$
is an isomorphism of $A$-module, to the finite projective
$A_1 \times_A A_2$-module $M_1 \times_\varphi M_2$.
\end{proof}

\begin{lemma}
\label{lemma-finite-projective-modules-TI}
In Example \ref{example-finite-projective-modules} if $x_0 = (k, V)$, then
$$
T_{x_0}\mathcal{F} = (0)
\quad\text{and}\quad
\text{Inf}_{x_0}(\mathcal{F}) = \text{End}_k(V)
$$
are finite dimensional.
\end{lemma}

\begin{proof}
Recall that $T_{x_0}\mathcal{F}$ is the set of isomorphism
classes of pairs $(x, \alpha)$ consisting of an object $x$ of $\mathcal{F}
$ over the dual numbers $k[\epsilon]$ and a morphism
$\alpha : x \to x_0$ of $\mathcal{F}$ lying over $k[\epsilon] \to k$.

\medskip\noindent
Up to isomorphism, there is a unique pair $(M, \alpha)$ consisting of a
finite projective module $M$ over $k[\epsilon]$
and $k[\epsilon]$-linear map $\alpha : M \to V$
which induces an isomorphism $M \otimes_{k[\epsilon]} k \to V$.
For example, if $V = k^{\oplus n}$, then we take
$M = k[\epsilon]^{\oplus n}$ with the obvious map $\alpha$.

\medskip\noindent
Similarly, $\text{Inf}_{x_0}(\mathcal{F})$ is the set of automorphisms
of the trivial deformation $x'_0$ of $x_0$ over $k[\epsilon]$.
See Formal Deformation Theory, Definition
\ref{formal-defos-definition-infinitesimal-auts} for details.

\medskip\noindent
Given $(M, \alpha)$ as in the second paragraph, we see that an element of
$\text{Inf}_{x_0}(\mathcal{F})$ is an automorphism $\gamma : M \to M$ with
$\gamma \bmod \epsilon = \text{id}$. Then we can write
$\gamma = \text{id}_M + \epsilon \psi$ where
$\psi : M/\epsilon M \to M/\epsilon M$ is $k$-linear.
Using $\alpha$ we can think of $\psi$ as an element of
$\text{End}_k(V)$ and this finishes the proof.
\end{proof}




\section{Representations of a group}
\label{section-representations}

\noindent
The deformation theory of representations can be very interesting.

\begin{example}[Representations of a group]
\label{example-representations}
Let $\Gamma$ be a group.
Let $\mathcal{F}$ be the category defined as follows
\begin{enumerate}
\item an object is a triple $(A, M, \rho)$ consisting of an
object $A$ of $\mathcal{C}_\Lambda$, a finite projective $A$-module $M$,
and a homomorphism $\rho : \Gamma \to \text{GL}_A(M)$, and
\item a morphism $(f, g) : (B, N, \tau) \to (A, M, \rho)$ consists of
a morphism $f : B \to A$ in $\mathcal{C}_\Lambda$ together
with a map $g : N \to M$ which is $f$-linear and $\Gamma$-equivariant
and induces an isomorpism $N \otimes_{B, f} A \cong M$.
\end{enumerate}
The functor $p : \mathcal{F} \to \mathcal{C}_\Lambda$ sends $(A, M, \rho)$
to $A$ and $(f, g)$ to $f$. It is clear that $p$ is cofibred in groupoids.
Since every finite projective module over a local ring is finite free
(Algebra, Lemma \ref{algebra-lemma-finite-projective})
we see that
$$
\begin{matrix}
\text{isomorphism classes} \\
\text{of objects of }\mathcal{F}(A)
\end{matrix}
=
\coprod\nolimits_{n \geq 0}\quad
\begin{matrix}
\text{GL}_n(A)\text{-conjugacy classes of}\\
\text{homomorphisms }\rho : \Gamma \to \text{GL}_n(A)
\end{matrix}
$$
\end{example}

\begin{lemma}
\label{lemma-representations-RS}
Example \ref{example-representations}
satisfies the Rim-Schlessinger condition (RS).
\end{lemma}

\begin{proof}
Let $A_1 \to A$ and $A_2 \to A$ be morphisms of $\mathcal{C}_\Lambda$.
Assume $A_2 \to A$ is surjective. According to
Formal Deformation Theory, Lemma
\ref{formal-defos-lemma-RS-2-categorical}
it suffices to show that the functor
$\mathcal{F}(A) \to \mathcal{F}(A_1) \times_{\mathcal{F}(A)} \mathcal{F}(A_2)$
is an equivalence of categories.

\medskip\noindent
Consider an object
$$
((A_1, M_1, \rho_1), (A_2, M_2, \rho_2), (\text{id}_A, \varphi))
$$
of the category $\mathcal{F}(A_1) \times_{\mathcal{F}(A)} \mathcal{F}(A_2)$.
Then, as seen in the proof of Lemma \ref{lemma-finite-projective-modules-RS},
we can consider the finite projective
$A_1 \times_A A_2$-module $M_1 \times_\varphi M_2$.
Since $\varphi$ is compatible with the given actions we obtain
$$
\rho_1 \times \rho_2 : \Gamma \longrightarrow
\text{GL}_{A_1 \times_A A_2}(M_1 \times_\varphi M_2)
$$
Then $(M_1 \times_\varphi M_2, \rho_1 \times \rho_2)$
is an object of $\mathcal{F}(A_1 \times_A A_2)$.
This construction determines a quasi-inverse to our functor.
\end{proof}

\begin{lemma}
\label{lemma-representations-TI}
In Example \ref{example-representations}
if $x_0 = (k, V, \rho_0)$, then
$$
T_{x_0}\mathcal{F} = \Ext^1_{k[\Gamma]}(V, V) =
H^1(\Gamma, \text{End}_k(V))
\quad\text{and}\quad
\text{Inf}_{x_0}(\mathcal{F}) = H^0(\Gamma, \text{End}_k(V))
$$
Thus $\text{Inf}_{x_0}(\mathcal{F})$ is always finite dimensional
and $T_{x_0}\mathcal{F}$ is finite dimensional
if $\Gamma$ is finitely generated.
\end{lemma}

\begin{proof}
We first deal with the infinitesimal automorphisms.
Let $M = V \otimes_k k[\epsilon]$ with induced action
$\rho_0' : \Gamma \to \text{GL}_n(M)$.
Then an element of $\text{Inf}_{x_0}(\mathcal{F})$
is given by an automorphism
$\gamma = \text{id} + \epsilon \psi : M \to M$
as in the proof of Lemma \ref{lemma-finite-projective-modules-TI},
where moreover $\psi$ has to commute
with the action of $\Gamma$ (given by $\rho_0$).
Thus we see that
$$
\text{Inf}_{x_0}(\mathcal{F}) = H^0(\Gamma, \text{End}_k(V))
$$
as predicted in the lemma.

\medskip\noindent
Next, let $(k[\epsilon], M, \rho)$ be an object of $\mathcal{F}$
over $k[\epsilon]$ and let $\alpha : M \to V$ be a $\Gamma$-equivariant map
inducing an isomorphism $M/\epsilon M \to V$.
Since $M$ is free as a $k[\epsilon]$-module we obtain
an extension of $\Gamma$-modules
$$
0 \to V \to M \xrightarrow{\alpha} V \to 0
$$
We omit the detailed construction of the map on the left.
Conversely, if we have an extension of $\Gamma$-modules as
above, then we can use this to make a $k[\epsilon]$-module
structure on $M$ and get an object of $\mathcal{F}(k[\epsilon])$
together with a map $\alpha$ as above.
It follows that
$$
T_{x_0}\mathcal{F} = \Ext^1_{k[\Gamma]}(V, V)
$$
as predicted in the lemma. This is equal to
$H^1(\Gamma, \text{End}_k(V))$ by
\'Etale Cohomology, Lemma \ref{etale-cohomology-lemma-ext-modules-hom}.

\medskip\noindent
The statement on dimensions follows from
\'Etale Cohomology, Lemma
\ref{etale-cohomology-lemma-finite-dim-group-cohomology}.
\end{proof}




\section{Continuous representations}
\label{section-continuous-representations}

\noindent
A very interesting thing one can do is to take an infinite Galois
group and study the deformation theory of its representations, see
\cite{Mazur-deforming}.

\begin{example}[Representations of a topological group]
\label{example-continuous-representations}
Let $\Gamma$ be a topological group.
Let $\mathcal{F}$ be the category defined as follows
\begin{enumerate}
\item an object is a triple $(A, M, \rho)$ consisting of an
object $A$ of $\mathcal{C}_\Lambda$, a finite projective $A$-module $M$,
and a continuous homomorphism $\rho : \Gamma \to \text{GL}_A(M)$
where $\text{GL}_A(M)$ is given the discrete topology\footnote{An alternative
would be to require the $A$-module $M$ with $G$-action given by $\rho$
is an $A\text{-}G$-module as defined in \'Etale Cohomology, Definition
\ref{etale-cohomology-definition-G-module-continuous}. However,
since $M$ is a finite $A$-module, this is equivalent.}, and
\item a morphism $(f, g) : (B, N, \tau) \to (A, M, \rho)$ consists of
a morphism $f : B \to A$ in $\mathcal{C}_\Lambda$ together
with a map $g : N \to M$ which is $f$-linear and $\Gamma$-equivariant
and induces an isomorpism $N \otimes_{B, f} A \cong M$.
\end{enumerate}
The functor $p : \mathcal{F} \to \mathcal{C}_\Lambda$ sends $(A, M, \rho)$
to $A$ and $(f, g)$ to $f$. It is clear that $p$ is cofibred in groupoids.
Since every finite projective module over a local ring is finite free
(Algebra, Lemma \ref{algebra-lemma-finite-projective})
we see that
$$
\begin{matrix}
\text{isomorphism classes} \\
\text{of objects of }\mathcal{F}(A)
\end{matrix}
=
\coprod\nolimits_{n \geq 0}\quad
\begin{matrix}
\text{GL}_n(A)\text{-conjugacy classes of}\\
\text{continuous homomorphisms }\rho : \Gamma \to \text{GL}_n(A)
\end{matrix}
$$
\end{example}

\begin{lemma}
\label{lemma-continuous-representations-RS}
Example \ref{example-continuous-representations}
satisfies the Rim-Schlessinger condition (RS).
\end{lemma}

\begin{proof}
The proof is exactly the same as the proof of
Lemma \ref{lemma-representations-RS}.
\end{proof}

\begin{lemma}
\label{lemma-continuous-representations-TI}
In Example \ref{example-continuous-representations}
if $x_0 = (k, V, \rho_0)$, then
$$
T_{x_0}\mathcal{F} = H^1(\Gamma, \text{End}_k(V))
\quad\text{and}\quad
\text{Inf}_{x_0}(\mathcal{F}) = H^0(\Gamma, \text{End}_k(V))
$$
Thus $\text{Inf}_{x_0}(\mathcal{F})$ is always finite dimensional
and $T_{x_0}\mathcal{F}$ is finite dimensional
if $\Gamma$ is topologically finitely generated.
\end{lemma}

\begin{proof}
The proof is exactly the same as the proof of
Lemma \ref{lemma-representations-TI}.
\end{proof}



\section{Graded algebras}
\label{section-graded-algebras}

\noindent
We will use the example in this section in the proof that the stack of
polarized proper schemes is an algebraic stack. For this reason we will
consider commutative graded algebras whose homogeneous parts are
finite projective modules (sometimes called ``locally finite'').

\begin{example}[Graded algebras]
\label{example-graded-algebras}
Let $\mathcal{F}$ be the category defined as follows
\begin{enumerate}
\item an object is a pair $(A, P)$ consisting of an
object $A$ of $\mathcal{C}_\Lambda$ and a graded $A$-algebra $P$
such that $P_d$ is a finite projective $A$-module for all $d \geq 0$, and
\item a morphism $(f, g) : (B, Q) \to (A, P)$ consists of
a morphism $f : B \to A$ in $\mathcal{C}_\Lambda$ together
with a map $g : Q \to P$ which is $f$-linear and induces an
isomorpism $Q \otimes_{B, f} A \cong P$.
\end{enumerate}
The functor $p : \mathcal{F} \to \mathcal{C}_\Lambda$ sends $(A, P)$
to $A$ and $(f, g)$ to $f$. It is clear that $p$ is cofibred in groupoids.
\end{example}

\begin{lemma}
\label{lemma-graded-algebras-RS}
Example \ref{example-graded-algebras}
satisfies the Rim-Schlessinger condition (RS).
\end{lemma}

\begin{proof}
Let $A_1 \to A$ and $A_2 \to A$ be morphisms of $\mathcal{C}_\Lambda$.
Assume $A_2 \to A$ is surjective. According to
Formal Deformation Theory, Lemma
\ref{formal-defos-lemma-RS-2-categorical}
it suffices to show that the functor
$\mathcal{F}(A) \to \mathcal{F}(A_1) \times_{\mathcal{F}(A)} \mathcal{F}(A_2)$
is an equivalence of categories.

\medskip\noindent
Consider an object
$$
((A_1, P_1), (A_2, P_2), (\text{id}_A, \varphi))
$$
of the category $\mathcal{F}(A_1) \times_{\mathcal{F}(A)} \mathcal{F}(A_2)$.
Then we consider $P_1 \times_\varphi P_2$. Since
$\varphi : P_1 \otimes_{A_1} A \to P_2 \otimes_{A_2} A$
is an isomorphism of graded algebras, we see that the graded pieces
of $P_1 \times_\varphi P_2$ are finite projective $A_1 \times_A A_2$-modules,
see proof of Lemma \ref{lemma-finite-projective-modules-RS}.
Thus $P_1 \times_\varphi P_2$ is an object of $\mathcal{F}(A_1 \times_A A_2)$.
This construction determines a quasi-inverse to our functor
and the proof is complete.
\end{proof}

\begin{lemma}
\label{lemma-graded-algebras-TI}
In Example \ref{example-graded-algebras}
if $x_0 = (k, P)$, then
$$
T_{x_0}\mathcal{F}
\quad\text{and}\quad
\text{Inf}_{x_0}(\mathcal{F}) = \text{Der}_k(P, P)
$$
are finite dimensional if $P$ is finitely generated over $k$.
\end{lemma}

\begin{proof}
We first deal with the infinitesimal automorphisms.
Let $Q = P \otimes_k k[\epsilon]$.
Then an element of $\text{Inf}_{x_0}(\mathcal{F})$
is given by an automorphism
$\gamma = \text{id} + \epsilon \delta : Q \to Q$
as above where now $\delta : P \to P$.
The fact that $\gamma$ is graded implies that
$\delta$ is homogeneous of degree $0$.
The fact that $\gamma$ is $k$-linear implies that
$\delta$ is $k$-linear.
The fact that $\gamma$ is multiplicative implies that
$\delta$ is a $k$-derivation.
Conversely, given a $k$-derivation $\delta : P \to P$
homogeneous of degree $0$, we obtain an automorphism
$\gamma = \text{id} + \epsilon \delta$ as above.
Thus we see that
$$
\text{Inf}_{x_0}(\mathcal{F}) = \text{Der}_k(P, P)
$$
as predicted in the lemma.
Clearly, if $P$ is generated in degrees $P_i$,
$0 \leq i \leq N$, then $\delta$ is determined by
the linear maps $\delta_i : P_i \to P_i$ for
$0 \leq i \leq N$ and we see that
$$
\dim_k \text{Der}_k(P, P) < \infty
$$
as desired.

\medskip\noindent
To finish the proof of the lemma we show that there is a finite
dimensional deformation space. To do this we
choose a presentation
$$
k[X_1, \ldots, X_n]/(F_1, \ldots, F_m) \longrightarrow P
$$
of graded $k$-algebras where $\deg(X_i) = d_i$ and
$F_j$ is homogeneous of degree $e_j$.
Let $Q$ be any graded $k[\epsilon]$-algebra
finite free in each degree which comes with an isomorphsm
$\alpha : Q/\epsilon Q \to P$ so that $(Q, \alpha)$ defines
an element of $T_{x_0}\mathcal{F}$.
Choose a homogeneous element $q_i \in Q$ of degree $d_i$
mapping to the image of $X_i$ in $P$.
Then we obtain
$$
k[\epsilon][X_1, \ldots, X_n] \longrightarrow Q,\quad
X_i \longmapsto q_i
$$
and since $P = Q/\epsilon Q$ this map is surjective by Nakayama's lemma.
A small diagram chase shows we can choose homogeneous elements
$F_{\epsilon, j} \in k[\epsilon][X_1, \ldots, X_n]$ of degree $e_j$
mapping to zero in $Q$ and mapping to $F_j$ in $k[X_1, \ldots, X_n]$.
Then
$$
k[\epsilon][X_1, \ldots, X_n]/(F_{\epsilon, 1}, \ldots, F_{\epsilon, m})
\longrightarrow Q
$$
is a presentation of $Q$ by flatness of $Q$ over $k[\epsilon]$.
Write
$$
F_{\epsilon, j} =  F_j + \epsilon G_j
$$
There is some ambiguity in the vector $(G_1, \ldots, G_m)$.
First, using different choices of $F_{\epsilon, j}$
we can modify $G_j$ by an arbitrary element of degree $e_j$
in the kernel of $k[X_1, \ldots, X_n] \to P$.
Hence, instead of $(G_1, \ldots, G_m)$, we remember the
element
$$
(g_1, \ldots, g_m) \in P_{e_1} \oplus \ldots \oplus P_{e_m}
$$
where $g_j$ is the image of $G_j$ in $P_{e_j}$.
Moreover, if we change our choice of $q_i$ into $q_i + \epsilon p_i$
with $p_i$ of degree $d_i$ then a computation (omitted) shows
that $g_j$ changes into
$$
g_j^{new} = g_j - \sum\nolimits_{i = 1}^n p_i \partial F_j / \partial X_i
$$
We conclude that the isomorphism class of $Q$ is determined by the
image of the vector $(G_1, \ldots, G_m)$ in the $k$-vector space
$$
W  = \Coker(P_{d_1} \oplus \ldots \oplus P_{d_n}
\xrightarrow{(\frac{\partial F_j}{\partial X_i})}
P_{e_1} \oplus \ldots \oplus P_{e_m})
$$
In this way we see that we obtain an injection
$$
T_{x_0}\mathcal{F} \longrightarrow W
$$
Since $W$ visibly has finite dimension, we conclude that the lemma is true.
\end{proof}





\section{Rings}
\label{section-rings}

\noindent
The deformation theory of rings is the same as the deformation theory
of affine schemes. For rings and schemes when we talk about deformations
it means we are thinking about {\it flat} deformations.

\begin{example}[Rings]
\label{example-rings}
Let $\mathcal{F}$ be the category defined as follows
\begin{enumerate}
\item an object is a pair $(A, P)$ consisting of an
object $A$ of $\mathcal{C}_\Lambda$ and a flat $A$-algebra $P$, and
\item a morphism $(f, g) : (B, Q) \to (A, P)$ consists of
a morphism $f : B \to A$ in $\mathcal{C}_\Lambda$ together
with a map $g : Q \to P$ which is $f$-linear and induces an
isomorpism $Q \otimes_{B, f} A \cong P$.
\end{enumerate}
The functor $p : \mathcal{F} \to \mathcal{C}_\Lambda$ sends $(A, P)$
to $A$ and $(f, g)$ to $f$. It is clear that $p$ is cofibred in groupoids.
\end{example}

\begin{lemma}
\label{lemma-rings-RS}
Example \ref{example-rings}
satisfies the Rim-Schlessinger condition (RS).
\end{lemma}

\begin{proof}
Let $A_1 \to A$ and $A_2 \to A$ be morphisms of $\mathcal{C}_\Lambda$.
Assume $A_2 \to A$ is surjective. According to
Formal Deformation Theory, Lemma
\ref{formal-defos-lemma-RS-2-categorical}
it suffices to show that the functor
$\mathcal{F}(A) \to \mathcal{F}(A_1) \times_{\mathcal{F}(A)} \mathcal{F}(A_2)$
is an equivalence of categories.
This is a special case of More on Algebra, Lemma
\ref{more-algebra-lemma-properties-algebras-over-fibre-product}.
\end{proof}

\begin{lemma}
\label{lemma-rings-TI}
In Example \ref{example-rings} if $x_0 = (k, P)$, then
$$
T_{x_0}\mathcal{F} = \text{Ext}^1_P(\NL_{P/k}, P)
\quad\text{and}\quad
\text{Inf}_{x_0}(\mathcal{F}) = \text{Der}_k(P, P)
$$
\end{lemma}

\begin{proof}
Recall that $\text{Inf}_{x_0}\mathcal{F}$ is the set of
automorphisms of the trivial deformation
$P[\epsilon] = P \otimes_k k[\epsilon]$ of $P$ to $k[\epsilon]$
equal to the identity modulo $\epsilon$.
By Deformation Theory, Lemma \ref{defos-lemma-huge-diagram}
this is equal to $\Hom_P(\Omega_{P/k}, P)$ which in turn is
equal to $\text{Der}_k(P, P)$ by
Algebra, Lemma \ref{algebra-lemma-universal-omega}.

\medskip\noindent
Recall that $T_{x_0}\mathcal{F}$ is the set of isomorphism classes
of flat deformations $Q$ of $P$ to $k[\epsilon]$, more precisely,
the set of isomorphism classes of $\mathcal{F}_{x_0}(k[\epsilon])$.
Recall that a $k[\epsilon]$-algebra $Q$ with $Q/\epsilon Q = P$
is flat over $k[\epsilon]$ if and only if
$$
0 \to P \xrightarrow{\epsilon} Q \to P \to 0
$$
is exact. This is proven in More on Morphisms, Lemma
\ref{more-morphisms-lemma-deform} and more generally in
Deformation Theory, Lemma \ref{defos-lemma-deform-module}.
Thus we may apply
Deformation Theory, Lemma \ref{defos-lemma-choices}
to see that the set of isomorphism classes of such
deformations is equal to $\text{Ext}^1_P(\NL_{P/k}, P)$.
\end{proof}

\begin{lemma}
\label{lemma-finite-type-rings-TI}
In Lemma \ref{lemma-rings-TI} if $P$ is a finite type $k$-algebra, then
\begin{enumerate}
\item $\text{Inf}_{x_0}(\mathcal{F})$ is finite dimensional if and only if
$\dim(P) = 0$, and
\item $T_{x_0}\mathcal{F}$ is finite dimensional if
$\Spec(P) \to \Spec(k)$ is smooth except at a finite number of points.
\end{enumerate}
\end{lemma}

\begin{proof}
Proof of (1). We view $\text{Der}_k(P, P)$ as a $P$-module.
If it has finite dimension over $k$, then it has finite length
as a $P$-module, hence it is supported in finitely many
closed points of $\Spec(P)$
(Algebra, Lemma \ref{algebra-lemma-simple-pieces}).
Since $\text{Der}_k(P, P) = \Hom_P(\Omega_{P/k}, P)$
we see that
$\text{Der}_k(P, P)_\mathfrak p = \text{Der}_k(P_\mathfrak p, P_\mathfrak p)$
for any prime $\mathfrak p \subset P$
(this uses Algebra, Lemmas
\ref{algebra-lemma-differentials-localize},
\ref{algebra-lemma-differentials-finitely-presented}, and
\ref{algebra-lemma-hom-from-finitely-presented}).
Let $\mathfrak p$ be a minimal prime ideal of $P$
corresponding to an irreducible component of dimension $d > 0$.
Then $P_\mathfrak p$ is an Artinian local ring
essentially of finite type over $k$ with residue field
and $\Omega_{P_\mathfrak p/k}$ is nonzero for example by
Algebra, Lemma \ref{algebra-lemma-characterize-smooth-over-field}.
Any nonzero finite module over an Artinian local ring
has both a sub and a quotient module isomorphic to the residue field.
Thus we find that
$\text{Der}_k(P_\mathfrak p, P_\mathfrak p) =
\Hom_{P_\mathfrak p}(\Omega_{P_\mathfrak p/k}, P_\mathfrak p)$
is nonzero too. Combining all of the above we find that (1) is true.

\medskip\noindent
Proof of (2). For a prime $\mathfrak p$ of $P$ we will use that
$\NL_{P_\mathfrak p/k} = (\NL_{P/k})_\mathfrak p$
(Algebra, Lemma \ref{algebra-lemma-localize-NL})
and we will
use that
$\text{Ext}_P^1(\NL_{P/k}, P)_\mathfrak p =
\text{Ext}_{P_\mathfrak p}^1(\NL_{P_\mathfrak p/k}, P_\mathfrak p)$
(More on Algebra, Remark
\ref{more-algebra-remark-pseudo-coherence-and-base-change-ext}).
Given a prime $\mathfrak p \subset P$
then $k \to P$ is smooth at $\mathfrak p$ if and only if
$(\NL_{P/k})_\mathfrak p$ is quasi-isomorphic
to a finite projective module placed in degree $0$ (this follows
immediately from the definition of a smooth ring map but it also
follows from the stronger Algebra, Lemma \ref{algebra-lemma-smooth-at-point}).

\medskip\noindent
Assume that $P$ is smooth over $k$ at all but finitely many primes.
Then these ``bad'' primes are maximal ideals
$\mathfrak m_1, \ldots, \mathfrak m_n \subset P$ by
Algebra, Lemma \ref{algebra-lemma-finite-type-algebra-finite-nr-primes}
and the fact that the ``bad'' primes form a closed subset of $\Spec(P)$.
For $\mathfrak p \not \in \{\mathfrak m_1, \ldots, \mathfrak m_n\}$
we have $\text{Ext}^1_P(\NL_{P/k}, P)_\mathfrak p = 0$ by the results above.
Thus $\text{Ext}^1_P(\NL_{P/k}, P)$ is a finite $P$-module
whose support is contained in $\{\mathfrak m_1, \ldots, \mathfrak m_r\}$.
By Algebra, Proposition
\ref{algebra-proposition-minimal-primes-associated-primes}
for example, we find that the dimension over $k$ of
$\text{Ext}^1_P(\NL_{P/k}, P)$ is a finite integer combination
of $\dim_k \kappa(\mathfrak m_i)$ and hence finite by
the Hilbert Nullstellensatz
(Algebra, Theorem \ref{algebra-theorem-nullstellensatz}).
\end{proof}

\begin{lemma}
\label{lemma-power-series-rings-TI}
In Lemma \ref{lemma-rings-TI} if $P = k[[x_1, \ldots, x_n]]/(f)$
for some nonzero $f \in (x_1, \ldots, x_n)^2$, then
\begin{enumerate}
\item $\text{Inf}_{x_0}(\mathcal{F})$ is finite dimensional
if and only if $n = 1$, and
\item $T_{x_0}\mathcal{F}$ is finite dimensional if
$$
\sqrt{(f, \partial f/\partial x_1, \ldots,  \partial f/\partial x_n)} =
(x_1, \ldots, x_n)
$$
\end{enumerate}
\end{lemma}

\begin{proof}
Proof of (1). Consider the derivations $\partial/\partial x_i$ of
$k[[x_1, \ldots, x_n]]$ over $k$. Write $f_i = \partial f/\partial x_i$.
The derivation
$$
\theta = \sum h_i \partial/\partial x_i
$$
of $k[[x_1, \ldots, x_n]]$
induces a derivation of $P = k[[x_1, \ldots, x_n]]/(f)$
if and only if
$\sum h_i f_i \in (f)$. Moreover, the induced derivation of $P$
is zero if and only if $h_i \in (f)$ for $i = 1, \ldots, n$.
Thus we find
$$
\Ker((f_1, \ldots, f_n) : P^{\oplus n} \longrightarrow P) \subset
\text{Der}_k(P, P)
$$
The left hand side is a finite dimensional $k$-vector space only if
$n = 1$; we omit the proof. We also leave it to the reader to see
that the right hand side has finite dimension if $n = 1$.
This proves (1).

\medskip\noindent
Proof of (2). Let $Q$ be a flat deformation of $P$ over $k[\epsilon]$
as in the proof of Lemma \ref{lemma-rings-TI}. Choose lifts $q_i \in Q$
of the image of $x_i$ in $P$. Then $Q$ is a complete local ring
with maximal ideal generated by $q_1, \ldots, q_n$ and $\epsilon$
(small argument omitted). Thus we get a surjection
$$
k[\epsilon][[x_1, \ldots, x_n]] \longrightarrow Q,\quad
x_i \longmapsto q_i
$$
Choose an element of the form
$f + \epsilon g \in k[\epsilon][[x_1, \ldots, x_n]]$
mapping to zero in $Q$. Observe that $g$ is well defined modulo $(f)$.
Since $Q$ is flat over $k[\epsilon]$ we get
$$
Q = k[\epsilon][[x_1, \ldots, x_n]]/(f + \epsilon g)
$$
Finally, if we changing the choice of $q_i$ amounts to
changing the coordinates $x_i$ into $x_i + \epsilon h_i$
for some $h_i \in k[[x_1, \ldots, x_n]]$. Then
$f + \epsilon g$ changes into $f + \epsilon (g + \sum h_i f_i)$
where $f_i = \partial f/\partial x_i$. Thus we see that the
isomorphism class of the deformation $Q$ is determined
by an element of
$$
k[[x_1, \ldots, x_n]]/
(f, \partial f/\partial x_1, \ldots,  \partial f/\partial x_n)
$$
This has finite dimension over $k$ if and only if
its support is the closed point of $k[[x_1, \ldots, x_n]]$
if and only if
$\sqrt{(f, \partial f/\partial x_1, \ldots,  \partial f/\partial x_n)} =
(x_1, \ldots, x_n)$.
\end{proof}












\input{chapters}

\bibliography{my}
\bibliographystyle{amsalpha}

\end{document}
