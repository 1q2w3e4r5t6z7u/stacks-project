\input{preamble}

% OK, start here.
%
\begin{document}

\title{Modules on Sites}


\maketitle

\phantomsection
\label{section-phantom}

\tableofcontents

\section{Introduction}
\label{section-introduction}

\noindent
In this document we work out basic notions of sheaves of modules on
ringed topoi or ringed sites. We first work out some basic facts on
abelian sheaves. After this we introduce ringed sites and ringed topoi.
We work through some of the very basic notions on (pre)sheaves of
$\mathcal{O}$-modules, analogous to the material on (pre)sheaves of
$\mathcal{O}$-modules in the chapter on sheaves on spaces.
Having done this, we duplicate much of the discussion in the chapter on
sheaves of modules (see Modules, Section \ref{modules-section-introduction}).
Basic references are \cite{FAC}, \cite{EGA} and \cite{SGA4}.






\section{Abelian presheaves}
\label{section-abelian-pre-sheaves}

\noindent
Let $\mathcal{C}$ be a category.
Abelian presheaves were introduced in
Sites, Sections \ref{sites-section-presheaves}
and \ref{sites-section-sheaves} and discussed a bit more
in Sites, Section \ref{sites-section-sheaves-algebraic-structures}.
We will follow the convention of this last reference, in that we think
of an abelian presheaf as a presheaf of sets endowed with addition rules
on all sets of sections compatible with the restriction mappings.
Recall that the category of abelian presheaves on $\mathcal{C}$
is denoted $\textit{PAb}(\mathcal{C})$.

\medskip\noindent
The category $\textit{PAb}(\mathcal{C})$ is abelian as defined in
Homology, Definition \ref{homology-definition-abelian-category}.
Given a map of presheaves $\varphi : \mathcal{G}_1 \to \mathcal{G}_2$
the kernel of $\varphi$ is the abelian presheaf
$U \mapsto \text{Ker}(\mathcal{G}_1(U) \to \mathcal{G}_2(U))$ and
the cokernel of $\varphi$ is the presheaf
$U \mapsto \text{Coker}(\mathcal{G}_1(U) \to \mathcal{G}_2(U))$.
Since the category of abelian groups is abelian it follows that
$\text{Coim} = \text{Im}$ because this holds over each $U$.
A sequence of abelian presheaves
$$
\mathcal{G}_1 \longrightarrow
\mathcal{G}_2 \longrightarrow
\mathcal{G}_3
$$
is exact if and only if
$\mathcal{G}_1(U) \to \mathcal{G}_2(U) \to \mathcal{G}_3(U)$
is an exact sequence of abelian groups for all $U \in \text{Ob}(\mathcal{C})$.
We leave the verifications to the reader.

\begin{lemma}
\label{lemma-limits-colimits-abelian-presheaves}
Let $\mathcal{C}$ be a category.
\begin{enumerate}
\item All limits and colimits exist in $\textit{PAb}(\mathcal{C})$.
\item All limits and colimits commute with taking sections over objects of
$\mathcal{C}$.
\end{enumerate}
\end{lemma}

\begin{proof}
Let $\mathcal{I} \to \textit{PAb}(\mathcal{C})$, $i \mapsto \mathcal{F}_i$
be a diagram. We can simply define abelian presheaves
$L$ and $C$ by the rules
$$
L : U \longmapsto \text{lim}_i\ \mathcal{F}_i(U)
$$
and
$$
C : U \longmapsto \text{colim}_i\ \mathcal{F}_i(U).
$$
It is clear that there are maps of abelian presheaves $L \to \mathcal{F}_i$
and $\mathcal{F}_i \to C$, by using the corresponding maps on groups of
sections over each $U$. It is straightforward to check that $L$ and $C$ endowed
with these maps are the limit and colimit of the diagram in
$\textit{PAb}(\mathcal{C})$. This proves (1) and (2). Details omitted.
\end{proof}


\section{Abelian sheaves}
\label{section-abelian-sheaves}

\noindent
Let $\mathcal{C}$ be a site.
The category of abelian sheaves on $\mathcal{C}$ is denoted
$\textit{Ab}(\mathcal{C})$. It is the full subcategory of
$\textit{PAb}(\mathcal{C})$ consisting of those abelian presheaves
whose underlying presheaves of sets are sheaves.
Properties ($\alpha$) -- ($\zeta$) of
Sites, Section \ref{sites-section-sheaves-algebraic-structures}
hold, see
Sites,
Proposition \ref{sites-proposition-functoriality-algebraic-structures-topoi}.
In particular the inclusion functor
$\textit{Ab}(\mathcal{C}) \to \textit{PAb}(\mathcal{C})$
has a left adjoint, namely the sheafification functor
$\mathcal{G} \mapsto \mathcal{G}^\#$.

\medskip\noindent
We suggest the reader prove the lemma on a piece of scratch paper rather
than reading the proof.

\begin{lemma}
\label{lemma-abelian-abelian}
Let $\mathcal{C}$ be a site. Let $\varphi : \mathcal{F} \to \mathcal{G}$
be a morphism of abelian sheaves on $\mathcal{C}$.
\begin{enumerate}
\item The category $\textit{Ab}(\mathcal{C})$ is an abelian category.
\item The kernel $\text{Ker}(\varphi)$ of $\varphi$ is the same as the
kernel of $\varphi$ as a morphism of presheaves.
\item The morphism $\varphi$ is injective
(Homology, Definition \ref{homology-definition-injective-surjective})
if and only if $\varphi$ is injective as a map of presheaves
(Sites, Definition \ref{sites-definition-presheaves-injective-surjective}),
if and only if $\varphi$ is injective as a map of sheaves
(Sites, Definition \ref{sites-definition-sheaves-injective-surjective}).
\item The cokernel $\text{Coker}(\varphi)$ of $\varphi$ is the sheafification
of the cokernel of $\varphi$ as a morphism of presheaves.
\item The morphism $\varphi$ is surjective
(Homology, Definition \ref{homology-definition-injective-surjective})
if and only if $\varphi$ is surjective as a map of sheaves
(Sites, Definition \ref{sites-definition-sheaves-injective-surjective}).
\item A complex of abelian sheaves
$$
\mathcal{F} \to \mathcal{G} \to \mathcal{H}
$$
is exact at $\mathcal{G}$ if and only if for all
$U \in \text{Ob}(\mathcal{C})$ and all $s \in \mathcal{G}(U)$
mapping to zero in $\mathcal{H}(U)$ there exists a covering
$\{U_i \to U\}_{i \in I}$ in $\mathcal{C}$ such that each
$s|_{U_i}$ is in the image of $\mathcal{F}(U_i) \to \mathcal{G}(U_i)$.
\end{enumerate}
\end{lemma}

\begin{proof}
We claim that Homology, Lemma \ref{homology-lemma-adjoint-get-abelian}
applies to the categories $\mathcal{A} = \textit{Ab}(\mathcal{C})$
and $\mathcal{B} = \textit{PAb}(\mathcal{C})$, and the functors
$a : \mathcal{A} \to \mathcal{B}$ (inclusion),  and
$b : \mathcal{B} \to \mathcal{A}$ (sheafification).
Let us check the assumptions of
Homology, Lemma \ref{homology-lemma-adjoint-get-abelian}.
Assumption (1) is that $\mathcal{A}$, $\mathcal{B}$ are additive categories,
$a$, $b$ are additive functors, and $a$ is right adjoint to $b$.
The first two statements are clear and adjointness is
Sites, Section \ref{sites-section-sheaves-algebraic-structures} ($\epsilon$).
Assumption (2) says that $\textit{PAb}(\mathcal{C})$ is abelian
which we saw in Section \ref{section-abelian-pre-sheaves} and
that sheafification is left exact, which is
Sites, Section \ref{sites-section-sheaves-algebraic-structures} ($\zeta$).
The final assumption is that $ba \cong \text{id}_{\mathcal{A}}$ which is
Sites, Section \ref{sites-section-sheaves-algebraic-structures} ($\delta$).
Hence Homology, Lemma \ref{homology-lemma-adjoint-get-abelian}
applies and we conclude that $\textit{Ab}(\mathcal{C})$ is abelian.

\medskip\noindent
In the proof of Homology, Lemma \ref{homology-lemma-adjoint-get-abelian}
it is shown that $\text{Ker}(\varphi)$ and $\text{Coker}(\varphi)$
are equal to the sheafification of the kernel and cokernel of $\varphi$
as a morphism of abelian presheaves. This proves (4). Since the kernel
is a equalizer (i.e., a limit) and since sheafifcation commutes with
finite limits, we conclude that (2) holds.

\medskip\noindent
Statement (2) implies (3). Statement (4) implies (5) by our description
of sheafification. The characterization of exactness in (6) follows from
(2) and (5), and the fact that the sequence is exact if and only if
$\text{Im}(\mathcal{F} \to \mathcal{G}) =
\text{Ker}(\mathcal{G} \to \mathcal{H})$.
\end{proof}

\noindent
Another way to say part (6) of the lemma is that a
sequence of abelian sheaves
$$
\mathcal{F}_1 \longrightarrow
\mathcal{F}_2 \longrightarrow
\mathcal{F}_3
$$
is exact if and only if the sheafification of
$U \mapsto \mathcal{F}_2(U)/\mathcal{F}_1(U)$ is equal to the
kernel of $\mathcal{F}_2 \to \mathcal{F}_3$.

\begin{lemma}
\label{lemma-limits-colimits-abelian-sheaves}
Let $\mathcal{C}$ be a site.
\begin{enumerate}
\item All limits and colimits exist in $\textit{Ab}(\mathcal{C})$.
\item Limits are the same as the corresponding limits of abelian presheaves
over $\mathcal{C}$ (i.e., commute with taking sections over objects of
$\mathcal{C}$).
\item Finite direct sums are the same as the correponding finite direct sums
in the category of abelian pre-sheaves over $\mathcal{C}$.
\item A colimit is the sheafification of the corresponding colimit in
the category of abelian presheaves.
\end{enumerate}
\end{lemma}

\begin{proof}
By Lemma \ref{lemma-limits-colimits-abelian-presheaves} limits and colimits
of abelian presheaves exist, and are described by taking limits and colimits
on the level of sections over objects.

\medskip\noindent
Let $\mathcal{I} \to \textit{Ab}(\mathcal{C})$, $i \mapsto \mathcal{F}_i$
be a diagram. Let $\text{lim}_i \mathcal{F}_i$ be the limit of the diagram
as an abelian presheaf. By Sites, Lemma \ref{sites-lemma-limit-sheaf}
this is an abelian sheaf. Then it is quite easy to see that
$\text{lim}_i \mathcal{F}_i$ is the limit of the diagram in
$\textit{Ab}(\mathcal{C})$. This proves limits exist and (2) holds.

\medskip\noindent
By Categories, Lemma \ref{categories-lemma-adjoint-exact}, and because
sheafification is left adjoint to the inclusion functor we see that
$\text{colim}_i\ \mathcal{F}$ exists and is the sheafification of the colimit
in $\textit{PAb}(\mathcal{C})$. This proves colimits exist and (4) holds.

\medskip\noindent
Finite direct sums are the same thing as finite products in any abelian
category. Hence (3) follows from (2).
\end{proof}







\section{Free abelian presheaves}
\label{section-free-abelian-presheaf}

\noindent
In order to prepare notation for the following definition, let us agree
to denote the free abelian group on a set $S$ as\footnote{In other chapters
the notation $\mathbf{Z}[S]$ sometimes indicates the polynomial ring over
$\mathbf{Z}$ on $S$.}
$\mathbf{Z}[S] = \bigoplus_{s \in S} \mathbf{Z}$. It is characterized
by the property
$$
\text{Mor}_{\textit{Ab}}(\mathbf{Z}[S], A)
=
\text{Mor}_{\textit{Sets}}(S, A)
$$
In other words the construction $S \mapsto \mathbf{Z}[S]$ is a left adjoint
to the forgetful functor $\textit{Ab} \to \textit{Sets}$.

\begin{definition}
\label{definition-free-abelian-presheaf-on}
Let $\mathcal{C}$ be a category. Let $\mathcal{G}$ be a presheaf of sets.
The {\it free abelian presheaf} $\mathbf{Z}_{\mathcal{G}}$ on $\mathcal{G}$
is the abelian presheaf defined by the rule
$$
U \longmapsto \mathbf{Z}[\mathcal{G}(U)].
$$
In the special case $\mathcal{G} = h_X$ of a representable presheaf
associated to an object $X$ of $\mathcal{C}$
we use the notation $\mathbf{Z}_X = \mathbf{Z}_{h_X}$. In other words
$$
\mathbf{Z}_X(U) = \mathbf{Z}[\text{Mor}_{\mathcal{C}}(U, X)].
$$
\end{definition}

\noindent
This construction is clearly functorial in the presheaf $\mathcal{G}$.
In fact it is adjoint to the forgetful functor
$\textit{PAb}(\mathcal{C}) \to \textit{PSh}(\mathcal{C})$.
Here is the precise statement.

\begin{lemma}
\label{lemma-obvious-adjointness}
Let $\mathcal{C}$ be a category.
Let $\mathcal{G}$, $\mathcal{F}$ be a presheaves of sets.
Let $\mathcal{A}$ be an abelian presheaf.
Let $U$ be an object of $\mathcal{C}$. Then
we have
\begin{align*}
\text{Mor}_{\textit{PSh}(\mathcal{C})}(h_U, \mathcal{F})
& =
\mathcal{F}(U), \\
\text{Mor}_{\textit{PAb}(\mathcal{C})}(\mathbf{Z}_{\mathcal{G}}, \mathcal{A})
& =
\text{Mor}_{\textit{PSh}(\mathcal{C})}(\mathcal{G}, \mathcal{A}), \\
\text{Mor}_{\textit{PAb}(\mathcal{C})}(\mathbf{Z}_U, \mathcal{A})
& =
\mathcal{A}(U).
\end{align*}
All of these equalities are functorial.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-coproduct-sum-free-abelian-presheaf}
Let $\mathcal{C}$ be a category.
Let $I$ be a set. For each $i \in I$ let
$\mathcal{G}_i$ be a presheaf of sets.
Then
$$
\mathbf{Z}_{\coprod_i \mathcal{G}_i}
=
\bigoplus\nolimits_{i \in I} \mathbf{Z}_{\mathcal{G}_i}
$$
in $\textit{PAb}(\mathcal{C})$.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}



\section{Free abelian sheaves}
\label{section-free-abelian-sheaf}

\noindent
Here is the notion of a free abelian sheaf on a sheaf of sets.

\begin{definition}
\label{definition-free-abelian-sheaf-on}
Let $\mathcal{C}$ be a site. Let $\mathcal{G}$ be a presheaf of sets.
The {\it free abelian sheaf} $\mathbf{Z}_{\mathcal{G}}^\#$
on $\mathcal{G}$ is the abelian sheaf $\mathbf{Z}_{\mathcal{G}}^\#$
which is the sheafification of the abelian presheaf on $\mathcal{G}$.
In the special case $\mathcal{G} = h_X$ of a representable presheaf
associated to an object $X$ of $\mathcal{C}$
we use the notation $\mathbf{Z}_X^\#$.
\end{definition}

\noindent
This construction is clearly functorial in the presheaf $\mathcal{G}$.
In fact it provides an adjoint to the forgetful functor
$\textit{Ab}(\mathcal{C}) \to \textit{Sh}(\mathcal{C})$.
Here is the precise statement.

\begin{lemma}
\label{lemma-obvious-adjointness-sheaves}
Let $\mathcal{C}$ be a site.
Let $\mathcal{G}$, $\mathcal{F}$ be a sheaves of sets.
Let $\mathcal{A}$ be an abelian sheaf.
Let $U$ be an object of $\mathcal{C}$. Then
we have
\begin{align*}
\text{Mor}_{\textit{Sh}(\mathcal{C})}(h_U^\#, \mathcal{F})
& =
\mathcal{F}(U), \\
\text{Mor}_{\textit{Ab}(\mathcal{C})}(\mathbf{Z}_{\mathcal{G}}^\#,
\mathcal{A})
& =
\text{Mor}_{\textit{Sh}(\mathcal{C})}(\mathcal{G}, \mathcal{A}), \\
\text{Mor}_{\textit{Ab}(\mathcal{C})}(\mathbf{Z}_U^\#, \mathcal{A})
& =
\mathcal{A}(U).
\end{align*}
All of these equalities are functorial.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-may-sheafify-before-abelianize}
Let $\mathcal{C}$ be a site.
Let $\mathcal{G}$ be a presheaf of sets.
Then $\mathbf{Z}_{\mathcal{G}}^\# = (\mathbf{Z}_{\mathcal{G}^\#})^\#$.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}








\section{Ringed sites}
\label{section-ringed-sites}

\noindent
In this chapter we mainly work with sheaves of modules on a ringed site.
Hence we need to define this notion.

\begin{definition}
\label{definition-ringed-site}
Ringed sites.
\begin{enumerate}
\item A {\it ringed site} is a pair $(\mathcal{C}, \mathcal{O})$
where $\mathcal{C}$ is a site and $\mathcal{O}$ is a sheaf of rings
on $\mathcal{C}$. The sheaf $\mathcal{O}$ is called the
{\it structure sheaf} of the ringed site.
\item Let $(\mathcal{C}, \mathcal{O})$, $(\mathcal{C}', \mathcal{O}')$ be ringed
sites. A {\it morphism of ringed sites}
$$
(f, f^\sharp) :
(\mathcal{C}, \mathcal{O})
\longrightarrow
(\mathcal{C}', \mathcal{O}')
$$
is given by a morphism of sites $f : \mathcal{C} \to \mathcal{C}'$
(see Sites, Definition \ref{sites-definition-morphism-sites})
together with a map of sheaves of rings
$f^\sharp : f^{-1}\mathcal{O}' \to \mathcal{O}$, which by adjunction
is the same thing as a map of sheaves of rings
$f^\sharp : \mathcal{O}' \to f_*\mathcal{O}$.
\item Let
$(f, f^\sharp) :
(\mathcal{C}_1, \mathcal{O}_1) \to (\mathcal{C}_2, \mathcal{O}_2)$ and
$(g, g^\sharp) :
(\mathcal{C}_2, \mathcal{O}_2) \to (\mathcal{C}_3, \mathcal{O}_3)$
be morphisms of ringed sites. Then we define
the {\it composition of morphisms of ringed sites}
by the rule
$$
(g, g^\sharp) \circ (f, f^\sharp) = (g \circ f, f^\sharp \circ g^\sharp).
$$
Here we use composition of morphisms of sites defined in
Sites, Definition \ref{sites-definition-composition-morphisms-sites}
and $f^\sharp \circ g^\sharp$ indicates the morphism of sheaves of
rings
$$
\mathcal{O}_3 \xrightarrow{g^\sharp} g_*\mathcal{O}_2
\xrightarrow{g_*f^\sharp} g_*f_*\mathcal{O}_1 = (g \circ f)_*\mathcal{O}_1
$$
\end{enumerate}
\end{definition}






\section{Ringed topoi}
\label{section-ringed-topoi}

\noindent
A ringed topos is just a ringed site, except that the notion of
a morphism of ringed topoi is different from the notion of a morphism
of ringed sites.

\begin{definition}
\label{definition-ringed-topos}
Ringed topoi.
\begin{enumerate}
\item A {\it ringed topos} is a pair
$(\textit{Sh}(\mathcal{C}), \mathcal{O})$
where $\mathcal{C}$ is a site and $\mathcal{O}$ is a sheaf of rings
on $\mathcal{C}$. The sheaf $\mathcal{O}$ is called the
{\it structure sheaf} of the ringed site.
\item Let $(\textit{Sh}(\mathcal{C}), \mathcal{O})$,
$(\textit{Sh}(\mathcal{C}'), \mathcal{O}')$ be ringed topoi.
A {\it morphism of ringed topoi}
$$
(f, f^\sharp) :
(\textit{Sh}(\mathcal{C}), \mathcal{O})
\longrightarrow
(\textit{Sh}(\mathcal{C}'), \mathcal{O}')
$$
is given by a morphism of topoi $f : \mathcal{C} \to \mathcal{C}'$
(see Sites, Definition \ref{sites-definition-topos})
together with a map of sheaves of rings
$f^\sharp : f^{-1}\mathcal{O}' \to \mathcal{O}$, which by adjunction
is the same thing as a map of sheaves of rings
$f^\sharp : \mathcal{O}' \to f_*\mathcal{O}$.
\item Let
$(f, f^\sharp) :
(\textit{Sh}(\mathcal{C}_1), \mathcal{O}_1)
\to (\textit{Sh}(\mathcal{C}_2), \mathcal{O}_2)$ and
$(g, g^\sharp) :
(\textit{Sh}(\mathcal{C}_2), \mathcal{O}_2) \to
(\textit{Sh}(\mathcal{C}_3), \mathcal{O}_3)$
be morphisms of ringed topoi. Then we define
the {\it composition of morphisms of ringed topoi}
by the rule
$$
(g, g^\sharp) \circ (f, f^\sharp) = (g \circ f, f^\sharp \circ g^\sharp).
$$
Here we use composition of morphisms of topoi defined in
Sites, Definition \ref{sites-definition-topos}
and $f^\sharp \circ g^\sharp$ indicates the morphism of sheaves of
rings
$$
\mathcal{O}_3 \xrightarrow{g^\sharp} g_*\mathcal{O}_2
\xrightarrow{g_*f^\sharp} g_*f_*\mathcal{O}_1 = (g \circ f)_*\mathcal{O}_1
$$
\end{enumerate}
\end{definition}

\noindent
Every morphism of ringed topoi is the composition of an equivalence
of ringed topoi with a morphism of ringed topoi associated to a morpism
of ringed sites. Here is the precise statement.

\begin{lemma}
\label{lemma-morphism-ringed-topoi-comes-from-morphism-ringed-sites}
Let $(f, f^\sharp) :
(\textit{Sh}(\mathcal{C}), \mathcal{O}_{\mathcal{C}})
\to (\textit{Sh}(\mathcal{D}), \mathcal{O}_{\mathcal{D}})$
be a morphism of ringed topoi. There exists a factorization
$$
\xymatrix{
(\textit{Sh}(\mathcal{C}), \mathcal{O}_{\mathcal{C}})
\ar[rr]_{(f, f^\sharp)}
\ar[d]_{(g, g^\sharp)}
& &
(\textit{Sh}(\mathcal{D}), \mathcal{O}_{\mathcal{D}}) \ar[d]^{(e, e^\sharp)}
\\
(\textit{Sh}(\mathcal{C}'), \mathcal{O}_{\mathcal{C}'})
\ar[rr]^{(h, h^\sharp)} & &
(\textit{Sh}(\mathcal{D}'), \mathcal{O}_{\mathcal{D}'})
}
$$
where
\begin{enumerate}
\item $g : \textit{Sh}(\mathcal{C}) \to \textit{Sh}(\mathcal{C}')$
is an equivalence of topoi induced by a special cocontinuous functor
$\mathcal{C} \to \mathcal{C}'$ (see
Sites, Definition \ref{sites-definition-special-cocontinuous-functor}),
\item $e : \textit{Sh}(\mathcal{D}) \to \textit{Sh}(\mathcal{D}')$
is an equivalence of topoi induced by a special cocontinuous functor
$\mathcal{D} \to \mathcal{D}'$ (see
Sites, Definition \ref{sites-definition-special-cocontinuous-functor}),
\item $\mathcal{O}_{\mathcal{C}'} = g_*\mathcal{O}_{\mathcal{C}}$
and $g^\sharp$ is the obvious map,
\item $\mathcal{O}_{\mathcal{D}'} = e_*\mathcal{O}_{\mathcal{D}}$
and $e^\sharp$ is the obvious map,
\item the sites $\mathcal{C}'$ and $\mathcal{D}'$ have final objects
and fibre products (i.e., all finite limits), and
\item $h$ is a morphism of sites induced by a continuous functor
$u : \mathcal{D}' \to \mathcal{C}'$ which commutes with all finite limits
(i.e., it satisfies the assumptions of
Sites, Proposition \ref{sites-proposition-get-morphism}).
\end{enumerate}
Moreover, if $(f, f^\sharp)$ is an equivalence of ringed topoi,
then we can choose the diagram such that
$\mathcal{C}' = \mathcal{D}'$, 
$\mathcal{O}_{\mathcal{C}'} = \mathcal{O}_{\mathcal{D}'}$
and $(h, h^\sharp)$ is the identiy.
\end{lemma}

\begin{proof}
This follows from
Sites, Lemma \ref{sites-lemma-morphism-topoi-comes-from-morphism-sites},
and Remarks
\ref{sites-remark-morphism-topoi-comes-from-morphism-sites}
and
\ref{sites-remark-equivalence-topoi-comes-from-morphism-sites}.
You just have to carry along the sheaves of rings. Some details omitted.
\end{proof}







\section{2-morphisms of ringed topoi}
\label{section-2-category}

\noindent
This is a brief section concerning the notion of a $2$-morphism
of ringed topoi.

\begin{definition}
\label{definition-2-morphism-ringed-topoi}
Let
$f, g :
(\textit{Sh}(\mathcal{C}), \mathcal{O}_{\mathcal{C}})
\to
(\textit{Sh}(\mathcal{D}), \mathcal{O}_{\mathcal{D}})$
be two morphisms of ringed topoi. A {\it 2-morphism from $f$ to $g$}
is given by a transformation of functors $t : f_* \to g_*$ such that
$$
\xymatrix{
& \mathcal{O}_{\mathcal{D}}
\ar[ld]_{f^\sharp}
\ar[rd]^{g^\sharp} \\
f_*\mathcal{O}_{\mathcal{C}} \ar[rr]^t & &
g_*\mathcal{O}_{\mathcal{C}}
}
$$
is commutative.
\end{definition}

\noindent
Pictorially we sometimes represent $t$ as follows:
$$
\xymatrix{
(\textit{Sh}(\mathcal{C}), \mathcal{O}_{\mathcal{C}})
\rrtwocell^f_{g}{t}
&
&
(\textit{Sh}(\mathcal{D}), \mathcal{O}_{\mathcal{D}})
}
$$
As in
Sites, Section \ref{sites-section-2-category}
giving a 2-morphism $t : f_* \to g_*$ is equivalent to giving
$t : g^{-1} \to f^{-1}$ (usually denoted by the same symbol)
such that the diagram
$$
\xymatrix{
f^{-1}\mathcal{O}_{\mathcal{D}}
\ar[rd]_{f^\sharp}  & &
g^{-1}\mathcal{O}_{\mathcal{D}} \ar[ll]^t \ar[ld]^{g^\sharp} \\
& \mathcal{O}_{\mathcal{C}}
}
$$
is commutative. As in
Sites, Section \ref{sites-section-2-category}
the axioms of a strict 2-category hold with horizontal and
vertical compositions defined as explained in loc.\ cit.










\section{Presheaves of modules}
\label{section-presheaves-modules}

\noindent
Let $\mathcal{C}$ be a category.
Let $\mathcal{O}$ be a presheaf of rings on $\mathcal{C}$.
At this point we have not yet defined a presheaf of $\mathcal{O}$-modules.
Thus we do so right now.

\begin{definition}
\label{definition-presheaf-modules}
Let $\mathcal{C}$ be a category, and
let $\mathcal{O}$ be a presheaf of rings on $\mathcal{C}$.
\begin{enumerate}
\item A {\it presheaf of $\mathcal{O}$-modules}
is given by an abelian presheaf $\mathcal{F}$ together with a
map of presheaves of sets
$$
\mathcal{O} \times \mathcal{F} \longrightarrow \mathcal{F}
$$
such that for every object $U$ of $\mathcal{C}$ the map
$\mathcal{O}(U) \times \mathcal{F}(U) \to \mathcal{F}(U)$
defines the structure of an $\mathcal{O}(U)$-module
structure on the abelian group $\mathcal{F}(U)$.
\item A {\it morphism $\varphi : \mathcal{F} \to \mathcal{G}$
of presheaves of $\mathcal{O}$-modules} is a morphism of abelian presheaves
$\varphi : \mathcal{F} \to \mathcal{G}$ such that
the diagram
$$
\xymatrix{
\mathcal{O} \times \mathcal{F} \ar[r] \ar[d]_{\text{id}\times \varphi} &
\mathcal{F} \ar[d]^{\varphi} \\
\mathcal{O} \times \mathcal{G} \ar[r] &
\mathcal{G}
}
$$
commutes.
\item The set of $\mathcal{O}$-module morphisms as above is
denoted $\text{Hom}_{\mathcal{O}}(\mathcal{F}, \mathcal{G})$.
\item The category of presheaves of $\mathcal{O}$-modules is denoted
$\textit{PMod}(\mathcal{O})$.
\end{enumerate}
\end{definition}

\noindent
Suppose that $\mathcal{O}_1 \to \mathcal{O}_2$ is a
morphism of presheaves of rings on the category $\mathcal{C}$. In this case,
if $\mathcal{F}$ is a presheaf of $\mathcal{O}_2$-modules
then we can think of $\mathcal{F}$ as a presheaf of
$\mathcal{O}_1$-modules by using the composition
$$
\mathcal{O}_1 \times \mathcal{F}
\to
\mathcal{O}_2 \times \mathcal{F}
\to
\mathcal{F}.
$$
We sometimes denote this by $\mathcal{F}_{\mathcal{O}_1}$
to indicate the restriction of rings. We call this
the {\it restriction of $\mathcal{F}$}. We obtain the
restriction functor
$$
\textit{PMod}(\mathcal{O}_2)
\longrightarrow
\textit{PMod}(\mathcal{O}_1)
$$

\medskip\noindent
On the other hand, given a presheaf of $\mathcal{O}_1$-modules
$\mathcal{G}$
we can construct a presheaf of $\mathcal{O}_2$-modules
$\mathcal{O}_2 \otimes_{p, \mathcal{O}_1} \mathcal{G}$
by the rule
$$
U \longmapsto
\left(\mathcal{O}_2 \otimes_{p, \mathcal{O}_1} \mathcal{G}\right)(U)
=
\mathcal{O}_2(U) \otimes_{\mathcal{O}_1(U)} \mathcal{G}(U)
$$
where $U \in \text{Ob}(\mathcal{C})$, with obvious restriction mappings.
The index $p$ stands for ``presheaf'' and not ``point''.
This presheaf is called the tensor product presheaf. We obtain
the {\it change of rings} functor
$$
\textit{PMod}(\mathcal{O}_1)
\longrightarrow
\textit{PMod}(\mathcal{O}_2)
$$

\begin{lemma}
\label{lemma-adjointness-tensor-restrict-presheaves}
With $\mathcal{C}$, $\mathcal{O}_1 \to \mathcal{O}_2$, $\mathcal{F}$ and
$\mathcal{G}$ as above there exists a canonical bijection
$$
\text{Hom}_{\mathcal{O}_1}(\mathcal{G}, \mathcal{F}_{\mathcal{O}_1})
=
\text{Hom}_{\mathcal{O}_2}(
\mathcal{O}_2 \otimes_{p, \mathcal{O}_1} \mathcal{G},
\mathcal{F}
)
$$
In other words, the restriction and change of rings functors defined
above are adjoint to each other.
\end{lemma}

\begin{proof}
This follows from the fact that for a ring map
$A \to B$ the restriction functor and the change
of ring functor are adjoint to each other.
\end{proof}


\section{Sheaves of modules}
\label{section-sheaves-modules}

\begin{definition}
\label{definition-sheaf-modules}
Let $\mathcal{C}$ be a site.
Let $\mathcal{O}$ be a sheaf of rings on $\mathcal{C}$.
\begin{enumerate}
\item A {\it sheaf of $\mathcal{O}$-modules} is a presheaf
of $\mathcal{O}$-modules $\mathcal{F}$,
see Definition \ref{definition-presheaf-modules},
such that the underlying presheaf of abelian groups $\mathcal{F}$
is a sheaf.
\item A {\it morphism of sheaves of $\mathcal{O}$-modules}
is a morphism of presheaves of $\mathcal{O}$-modules.
\item Given sheaves of $\mathcal{O}$-modules
$\mathcal{F}$ and $\mathcal{G}$ we denote
$\text{Hom}_{\mathcal{O}}(\mathcal{F}, \mathcal{G})$
the set of morphism of sheaves of $\mathcal{O}$-modules.
\item The category of sheaves of $\mathcal{O}$-modules
is denoted $\textit{Mod}(\mathcal{O})$.
\end{enumerate}
\end{definition}

\noindent
This definition kind of makes sense even if $\mathcal{O}$ is just a
presheaf of rings, allthough we do not know any examples where
this is useful, and we will avoid using the terminology
``sheaves of $\mathcal{O}$-modules''
in case $\mathcal{O}$ is not a sheaf of rings.



\section{Sheafification of presheaves of modules}
\label{section-sheafification-presheaves-modules}

\begin{lemma}
\label{lemma-sheafification-presheaf-modules}
Let $\mathcal{C}$ be a site.
Let $\mathcal{O}$ be a presheaf of rings on $\mathcal{C}$
Let $\mathcal{F}$ be a presheaf $\mathcal{O}$-modules.
Let $\mathcal{O}^\#$ be the sheafification of $\mathcal{O}$ as a presheaf
of rings, see Sites, Section \ref{sites-section-sheaves-algebraic-structures}.
Let $\mathcal{F}^\#$ be the sheafification of $\mathcal{F}$
as a presheaf of abelian groups. There exists a map of
sheaves of sets
$$
\mathcal{O}^\# \times \mathcal{F}^\#
\longrightarrow
\mathcal{F}^\#
$$
which makes the diagram
$$
\xymatrix{
\mathcal{O} \times \mathcal{F} \ar[r] \ar[d] &
\mathcal{F} \ar[d] \\
\mathcal{O}^\# \times \mathcal{F}^\# \ar[r] &
\mathcal{F}^\#
}
$$
commute and which makes $\mathcal{F}^\#$ into a sheaf
of $\mathcal{O}^\#$-modules. In addition, if $\mathcal{G}$
is a sheaf of $\mathcal{O}^\#$-modules, then any morphism
of presheaves of $\mathcal{O}$-modules $\mathcal{F} \to \mathcal{G}$
(into the restriction of $\mathcal{G}$ to a $\mathcal{O}$-module)
factors uniquely as $\mathcal{F} \to \mathcal{F}^\# \to \mathcal{G}$
where $\mathcal{F}^\# \to \mathcal{G}$ is a morphism of
$\mathcal{O}^\#$-modules.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\noindent
This actually means that the functor
$i : \textit{Mod}(\mathcal{O}^\#) \to \textit{PMod}(\mathcal{O})$
(combining restriction and including sheaves into presheaves)
and the sheafification functor of the lemma
${}^\# : \textit{PMod}(\mathcal{O}) \to \textit{Mod}(\mathcal{O}^\#)$
are adjoint. In a formula
$$
\text{Mor}_{\textit{PMod}(\mathcal{O})}(\mathcal{F}, i\mathcal{G})
=
\text{Mor}_{\textit{Mod}(\mathcal{O}^\#)}(\mathcal{F}^\#, \mathcal{G})
$$
An important case happens when $\mathcal{O}$ is already a sheaf of
rings. In this case the formula reads
$$
\text{Mor}_{\textit{PMod}(\mathcal{O})}(\mathcal{F}, i\mathcal{G})
=
\text{Mor}_{\textit{Mod}(\mathcal{O})}(\mathcal{F}^\#, \mathcal{G})
$$
because $\mathcal{O} = \mathcal{O}^\#$ in this case.

\begin{lemma}
\label{lemma-sheafification-exact}
Let $\mathcal{C}$ be a site.
Let $\mathcal{O}$ be a presheaf of rings on $\mathcal{C}$
The sheafification functor
$$
\textit{PMod}(\mathcal{O}) \longrightarrow \textit{Mod}(\mathcal{O}^\#), \quad
\mathcal{F} \longmapsto \mathcal{F}^\#
$$
is exact.
\end{lemma}

\begin{proof}
This is true because it holds for sheafification
$\textit{PAb}(\mathcal{C}) \to \textit{Ab}(\mathcal{C})$.
See the discussion in Section \ref{section-abelian-sheaves}.
\end{proof}

\noindent
Let $\mathcal{C}$ be a site.
Let $\mathcal{O}_1 \to \mathcal{O}_2$ be
a morphism of sheaves of rings on $\mathcal{C}$.
In Section \ref{section-presheaves-modules}
we defined a restriction functor
and a change of rings functor on presheaves of modules
associated to this situation.

\medskip\noindent
If $\mathcal{F}$ is a sheaf of $\mathcal{O}_2$-modules
then the restriction $\mathcal{F}_{\mathcal{O}_1}$
of $\mathcal{F}$ is clearly a sheaf
of $\mathcal{O}_1$-modules. We obtain the restriction functor
$$
\textit{Mod}(\mathcal{O}_2)
\longrightarrow
\textit{Mod}(\mathcal{O}_1)
$$

\medskip\noindent
On the other hand, given a sheaf of $\mathcal{O}_1$-modules
$\mathcal{G}$ the presheaf of $\mathcal{O}_2$-modules
$\mathcal{O}_2 \otimes_{p, \mathcal{O}_1} \mathcal{G}$
is in general not a sheaf. Hence we define the
{\it tensor product sheaf}
$\mathcal{O}_2 \otimes_{\mathcal{O}_1} \mathcal{G}$
by the formula
$$
\mathcal{O}_2 \otimes_{\mathcal{O}_1} \mathcal{G}
=
(\mathcal{O}_2 \otimes_{p, \mathcal{O}_1} \mathcal{G})^\#
$$
as the sheafification of our construction for presheaves.
We obtain the {\it change of rings} functor
$$
\textit{Mod}(\mathcal{O}_1)
\longrightarrow
\textit{Mod}(\mathcal{O}_2)
$$

\begin{lemma}
\label{lemma-adjointness-tensor-restrict}
With $X$, $\mathcal{O}_1$, $\mathcal{O}_2$, $\mathcal{F}$ and
$\mathcal{G}$ as above there exists a canonical bijection
$$
\text{Hom}_{\mathcal{O}_1}(\mathcal{G}, \mathcal{F}_{\mathcal{O}_1})
=
\text{Hom}_{\mathcal{O}_2}(
\mathcal{O}_2 \otimes_{\mathcal{O}_1} \mathcal{G},
\mathcal{F}
)
$$
In other words, the restriction and change of rings functors
are adjoint to each other.
\end{lemma}

\begin{proof}
This follows from
Lemma \ref{lemma-adjointness-tensor-restrict-presheaves}
and the fact that
$\text{Hom}_{\mathcal{O}_2}(
\mathcal{O}_2 \otimes_{\mathcal{O}_1} \mathcal{G},
\mathcal{F}
)
=
\text{Hom}_{\mathcal{O}_2}(
\mathcal{O}_2 \otimes_{p, \mathcal{O}_1} \mathcal{G},
\mathcal{F}
)$
because $\mathcal{F}$ is a sheaf.
\end{proof}




\section{Morphisms of topoi and sheaves of modules}
\label{section-sheaves-modules-functorial} 

\noindent
All of this material is completely straightforward.
We formulate everything in the case of morphisms of topoi,
but of course the results also hold in the case of morphisms of sites.

\begin{lemma}
\label{lemma-pushforward-module}
Let $\mathcal{C}$, $\mathcal{D}$ be sites.
Let $f : \textit{Sh}(\mathcal{C}) \to \textit{Sh}(\mathcal{D})$
be a morphism of topoi.
Let $\mathcal{O}$ be a sheaf of rings on $\mathcal{C}$.
Let $\mathcal{F}$ be a sheaf of $\mathcal{O}$-modules.
There is a natural map of sheaves of sets
$$
f_*\mathcal{O} \times f_*\mathcal{F}
\longrightarrow
f_*\mathcal{F}
$$
which turns $f_*\mathcal{F}$ into a sheaf of $f_*\mathcal{O}$-modules.
This construction is functorial in $\mathcal{F}$.
\end{lemma}

\begin{proof}
Denote $\mu : \mathcal{O} \times \mathcal{F} \to \mathcal{F}$ the
multiplication map. Recall that $f_*$ (on sheaves of sets) is left exact
and hence commutes with products. Hence $f_*\mu$ is a map as
indicated. This proves the lemma.
\end{proof}

\begin{lemma}
\label{lemma-pullback-module}
Let $\mathcal{C}$, $\mathcal{D}$ be sites.
Let $f : \textit{Sh}(\mathcal{C}) \to \textit{Sh}(\mathcal{D})$
be a morphism of topoi.
Let $\mathcal{O}$ be a sheaf of rings on $\mathcal{D}$.
Let $\mathcal{G}$ be a sheaf of $\mathcal{O}$-modules.
There is a natural map of sheaves of sets
$$
f^{-1}\mathcal{O} \times f^{-1}\mathcal{G}
\longrightarrow
f^{-1}\mathcal{G}
$$
which turns $f^{-1}\mathcal{G}$ into a sheaf of $f^{-1}\mathcal{O}$-modules.
This construction is functorial in $\mathcal{G}$.
\end{lemma}

\begin{proof}
Denote $\mu : \mathcal{O} \times \mathcal{G} \to \mathcal{G}$ the
multiplication map. Recall that $f^{-1}$ (on sheaves of sets) is exact
and hence commutes with products. Hence $f^{-1}\mu$ is a map as
indicated. This proves the lemma.
\end{proof}

\begin{lemma}
\label{lemma-adjoint-push-pull-modules}
Let $\mathcal{C}$, $\mathcal{D}$ be sites.
Let $f : \textit{Sh}(\mathcal{C}) \to \textit{Sh}(\mathcal{D})$
be a morphism of topoi.
Let $\mathcal{O}$ be a sheaf of rings on $\mathcal{D}$.
Let $\mathcal{G}$ be a sheaf of $\mathcal{O}$-modules.
Let $\mathcal{F}$ be a sheaf of $f^{-1}\mathcal{O}$-modules.
Then
$$
\text{Mor}_{\textit{Mod}(f^{-1}\mathcal{O})}(f^{-1}\mathcal{G}, \mathcal{F})
=
\text{Mor}_{\textit{Mod}(\mathcal{O})}(\mathcal{G}, f_*\mathcal{F}).
$$
Here we use
Lemmas \ref{lemma-pullback-module}
and \ref{lemma-pushforward-module}, and we think of
$f_*\mathcal{F}$ as an $\mathcal{O}$-module by restriction via
$\mathcal{O} \to f_*f^{-1}\mathcal{O}$.
\end{lemma}

\begin{proof}
First we note that we have
$$
\text{Mor}_{\textit{Ab}(\mathcal{C})}(f^{-1}\mathcal{G}, \mathcal{F})
=
\text{Mor}_{\textit{Ab}(\mathcal{D})}(\mathcal{G}, f_*\mathcal{F}).
$$
by Sites,
Proposition \ref{sites-proposition-functoriality-algebraic-structures-topoi}.
Suppose that $\alpha : f^{-1}\mathcal{G} \to \mathcal{F}$ and
$\beta : \mathcal{G} \to f_*\mathcal{F}$ are morphisms of abelian
sheaves which correspond via the formula above. We have to show that
$\alpha$ is $f^{-1}\mathcal{O}$-linear if and only if $\beta$
is $\mathcal{O}$-linear. For example, suppose $\alpha$ is
$f^{-1}\mathcal{O}$-linear, then clearly $f_*\alpha$ is
$f_*f^{-1}\mathcal{O}$-linear, and hence (as restriction is a functor)
is $\mathcal{O}$-linear. Hence it suffices to prove that the
adjunction map $\mathcal{G} \to f_*f^{-1}\mathcal{G}$ is
$\mathcal{O}$-linear. Using that both $f_*$ and $f^{-1}$ commute
with products (on sheaves of sets) this comes down to showing that
$$
\xymatrix{
\mathcal{O} \times \mathcal{G} \ar[r] \ar[d] &
f_*f^{-1}(\mathcal{O} \times \mathcal{G}) \ar[d] \\
\mathcal{G} \ar[r] & f_*f^{-1}\mathcal{G}
}
$$
is commutative. This holds because the adjunction mapping
$\text{id}_{\textit{Sh}(\mathcal{D})} \to f_*f^{-1}$ is a
transformation of functors. We omit the proof of the implication
$\beta$ linear $\Rightarrow$ $\alpha$ linear.
\end{proof}

\begin{lemma}
\label{lemma-adjoint-pull-push-modules}
Let $\mathcal{C}$, $\mathcal{D}$ be sites.
Let $f : \textit{Sh}(\mathcal{C}) \to \textit{Sh}(\mathcal{D})$
be a morphism of topoi.
Let $\mathcal{O}$ be a sheaf of rings on $\mathcal{C}$.
Let $\mathcal{F}$ be a sheaf of $\mathcal{O}$-modules.
Let $\mathcal{G}$ be a sheaf of $f_*\mathcal{O}$-modules.
Then
$$
\text{Mor}_{\textit{Mod}(\mathcal{O})}(
\mathcal{O} \otimes_{f^{-1}f_*\mathcal{O}} f^{-1}\mathcal{G}, \mathcal{F})
=
\text{Mor}_{\textit{Mod}(f_*\mathcal{O})}(\mathcal{G}, f_*\mathcal{F}).
$$
Here we use
Lemmas \ref{lemma-pullback-module}
and \ref{lemma-pushforward-module}, and we use
the canonical map $f^{-1}f_*\mathcal{O} \to \mathcal{O}$
in the definition of the tensor product.
\end{lemma}

\begin{proof}
Note that we have
$$
\text{Mor}_{\textit{Mod}(\mathcal{O})}(
\mathcal{O} \otimes_{f^{-1}f_*\mathcal{O}} f^{-1}\mathcal{G}, \mathcal{F})
=
\text{Mor}_{\textit{Mod}(f^{-1}f_*\mathcal{O})}(
f^{-1}\mathcal{G}, \mathcal{F}_{f^{-1}f_*\mathcal{O}})
$$
by Lemma \ref{lemma-adjointness-tensor-restrict}. Hence the result follows
from Lemma \ref{lemma-adjoint-push-pull-modules}.
\end{proof}






\section{Morphisms of ringed topoi and modules}
\label{section-functoriality-modules}

\noindent
We have now introduced enough notation so that we are able to
define the pullback and pushforward of modules along a morphism
of ringed topoi.

\begin{definition}
\label{definition-pushforward}
Let
$(f, f^\sharp) :
(\textit{Sh}(\mathcal{C}), \mathcal{O}_{\mathcal{C}})
\to
(\textit{Sh}(\mathcal{D}), \mathcal{O}_{\mathcal{D}})$
be a morphism of ringed topoi or ringed sites.
\begin{enumerate}
\item Let $\mathcal{F}$ be a sheaf of $\mathcal{O}_{\mathcal{C}}$-modules.
We define the {\it pushforward} of $\mathcal{F}$ as the
sheaf of $\mathcal{O}_{\mathcal{D}}$-modules which as a sheaf
of abelian groups equals $f_*\mathcal{F}$ and with
module structure given by the restriction
via $f^\sharp : \mathcal{O}_{\mathcal{D}} \to f_*\mathcal{O}_{\mathcal{C}}$
of the module structure
$$
f_*\mathcal{O}_{\mathcal{C}} \times f_*\mathcal{F}
\longrightarrow
f_*\mathcal{F}
$$
from Lemma \ref{lemma-pushforward-module}.
\item Let $\mathcal{G}$ be a sheaf of $\mathcal{O}_{\mathcal{D}}$-modules.
We define the {\it pullback} $f^*\mathcal{G}$ to be the
sheaf of $\mathcal{O}_{\mathcal{C}}$-modules defined by the formula
$$
f^*\mathcal{F}
=
\mathcal{O}_{\mathcal{C}} \otimes_{f^{-1}\mathcal{O}_{\mathcal{D}}}
f^{-1}\mathcal{F}
$$
where the ring map
$f^{-1}\mathcal{O}_{\mathcal{D}} \to \mathcal{O}_{\mathcal{C}}$
is $f^\sharp$, and where the  module
structure is given by Lemma \ref{lemma-pullback-module}.
\end{enumerate}
\end{definition}

\noindent
Thus we have defined functors
\begin{eqnarray*}
f_* : \textit{Mod}(\mathcal{O}_{\mathcal{C}})
& \longrightarrow &
\textit{Mod}(\mathcal{O}_{\mathcal{D}}) \\
f^* : \textit{Mod}(\mathcal{O}_{\mathcal{D}})
& \longrightarrow &
\textit{Mod}(\mathcal{O}_{\mathcal{C}})
\end{eqnarray*}
The final result on these functors is that they are indeed
adjoint as expected.

\begin{lemma}
\label{lemma-adjoint-pullback-pushforward-modules}
Let
$(f, f^\sharp) :
(\textit{Sh}(\mathcal{C}), \mathcal{O}_{\mathcal{C}})
\to
(\textit{Sh}(\mathcal{D}), \mathcal{O}_{\mathcal{D}})$
be a morphism of ringed topoi or ringed sites.
Let $\mathcal{F}$ be a sheaf of $\mathcal{O}_{\mathcal{C}}$-modules.
Let $\mathcal{G}$ be a sheaf of $\mathcal{O}_{\mathcal{D}}$-modules.
There is a canonical bijection
$$
\text{Hom}_{\mathcal{O}_{\mathcal{C}}}(f^*\mathcal{G}, \mathcal{F})
=
\text{Hom}_{\mathcal{O}_{\mathcal{D}}}(\mathcal{G}, f_*\mathcal{F}).
$$
In other words: the functor $f^*$ is the left adjoint to
$f_*$.
\end{lemma}

\begin{proof}
This follows from the work we did before:
\begin{eqnarray*}
\text{Hom}_{\mathcal{O}_{\mathcal{C}}}(f^*\mathcal{G}, \mathcal{F})
& = &
\text{Mor}_{\textit{Mod}(\mathcal{O}_{\mathcal{C}})}(
\mathcal{O}_{\mathcal{C}}
\otimes_{f^{-1}\mathcal{O}_{\mathcal{D}}} f^{-1}\mathcal{G},
\mathcal{F}) \\
& = &
\text{Mor}_{\textit{Mod}(f^{-1}\mathcal{O}_{\mathcal{D}})}(
f^{-1}\mathcal{G}, \mathcal{F}_{f^{-1}\mathcal{O}_{\mathcal{D}}}) \\
& = &
\text{Hom}_{\mathcal{O}_{\mathcal{D}}}(\mathcal{G}, f_*\mathcal{F}).
\end{eqnarray*}
Here we use Lemmas \ref{lemma-adjointness-tensor-restrict}
and \ref{lemma-adjoint-push-pull-modules}.
\end{proof}

\begin{lemma}
\label{lemma-push-pull-composition-modules}
$(f, f^\sharp) :
(\textit{Sh}(\mathcal{C}_1), \mathcal{O}_1)
\to (\textit{Sh}(\mathcal{C}_2), \mathcal{O}_2)$ and
$(g, g^\sharp) :
(\textit{Sh}(\mathcal{C}_2), \mathcal{O}_2) \to
(\textit{Sh}(\mathcal{C}_3), \mathcal{O}_3)$
be morphisms of ringed topoi.
There are canonical isomorphisms of functors
$(g \circ f)_* \cong g_* \circ f_*$ and
$(g \circ f)^* \cong f^* \circ g^*$.
\end{lemma}

\begin{proof}
This is clear from the definitions.
\end{proof}





\section{The abelian category of sheaves of modules}
\label{section-kernels}

\noindent
Let $(\textit{Sh}(\mathcal{C}), \mathcal{O})$ be a ringed topos.
Let $\mathcal{F}$, $\mathcal{G}$ be sheaves of $\mathcal{O}$-modules, see
Sheaves, Definition \ref{sheaves-definition-sheaf-modules}.
Let $\varphi, \psi : \mathcal{F} \to \mathcal{G}$
be morphisms of sheaves of $\mathcal{O}_X$-modules.
We define $\varphi + \psi : \mathcal{F} \to \mathcal{G}$
to be the sum of $\varphi$ and $\psi$ as morphisms of abelian sheaves.
This is clearly again a map of $\mathcal{O}$-modules.
It is also clear that composition of maps of
$\mathcal{O}$-modules is bilinear with respect to this
addition. Thus $\textit{Mod}(\mathcal{O})$ is a pre-additive
category, see Homology, Definition \ref{homology-definition-preadditive}.

\medskip\noindent
We will denote $0$ the sheaf of $\mathcal{O}$-modules
which has constant value $\{0\}$ for all objects $U$ of $\mathcal{C}$.
Clearly this is both a final and an initial object of
$\textit{Mod}(\mathcal{O})$. Given a morphism
of $\mathcal{O}$-modules $\varphi : \mathcal{F} \to \mathcal{G}$
the following are equivalent:
(a) $\varphi$ is zero, (b) $\varphi$ factors through $0$,
(c) $\varphi$ is zero on sections over each opject $U$.

\medskip\noindent
Moreover, given a pair
$\mathcal{F}$, $\mathcal{G}$ of sheaves of $\mathcal{O}$-modules
we may define the direct sum as
$$
\mathcal{F} \oplus \mathcal{G} = \mathcal{F} \times \mathcal{G}
$$
with obvious maps $(i, j, p, q)$ as in Homology, Definition
\ref{homology-definition-direct-sum}. Thus $\textit{Mod}(\mathcal{O})$
is an additive category, see
Homology, Definition \ref{homology-definition-additive-category}.

\medskip\noindent
Let $\varphi : \mathcal{F} \to \mathcal{G}$ be a morphism
of $\mathcal{O}$-modules. We may define $\text{Ker}(\varphi)$
to be the kernel of $\varphi$ as a map of abelian sheaves.
By Section \ref{section-abelian-sheaves} this is the
subsheaf of $\mathcal{F}$ with sections
$$
\text{Ker}(\varphi)(U) =
\{ s \in \mathcal{F}(U) \mid \varphi(s) = 0 \text{ in } \mathcal{G}(U)\}
$$
for all objects $U$ of $\mathcal{C}$. It is easy to see that this is indeed
a kernel in the category of $\mathcal{O}$-modules. In other words,
a morphism $\alpha : \mathcal{H} \to \mathcal{F}$ factors
through $\text{Ker}(\varphi)$ if and only if $\varphi \circ \alpha = 0$.

\medskip\noindent
Similarly, we define $\text{Coker}(\varphi)$ as the cokernel of
$\varphi$ as a map of abelian sheaves. There is a unique
multiplication map
$$
\mathcal{O} \times \text{Coker}(\varphi) \longrightarrow \text{Coker}(\varphi)
$$
such that the map $\mathcal{G} \to \text{Coker}(\varphi)$ becomes a
morphism of $\mathcal{O}$-modules (verification omitted).
The map $\mathcal{G} \to \text{Coker}(\varphi)$ is surjective
(as a map of sheaves of sets, see Section \ref{section-abelian-sheaves}).
To show that $\text{Coker}(\varphi)$ is a cokernel in
$\textit{Mod}(\mathcal{O})$, note that if
$\beta : \mathcal{G} \to \mathcal{H}$ is a morphism of $\mathcal{O}$-modules
such that $\beta \circ \varphi$ is zero, then you get for every
object $U$ of $\mathcal{C}$ a map induced by $\beta$ from
$\mathcal{G}(U)/\varphi(\mathcal{F}(U))$ into $\mathcal{H}(U)$.
By the universal property of sheafification (see
Sheaves, Lemma \ref{sheaves-lemma-sheafification-presheaf-modules})
we obtain a canonical map $\text{Coker}(\varphi) \to \mathcal{H}$
such that the original $\beta$ is equal to the composition
$\mathcal{G} \to \text{Coker}(\varphi) \to \mathcal{H}$.
The morphism $\text{Coker}(\varphi) \to \mathcal{H}$ is unique
because of the surjectivity mentioned above.

\begin{lemma}
\label{lemma-abelian}
Let $(\textit{Sh}(\mathcal{C}), \mathcal{O})$ be a ringed topos.
The category $\textit{Mod}(\mathcal{O})$ is an abelian category.
The forgetful functor
$\textit{Mod}(\mathcal{O}) \to \textit{Ab}(\mathcal{C})$
is exact, hence kernels, cokernels and exactness of
$\mathcal{O}$-modules, correspond to the corresponding notions
for abelian sheaves.
\end{lemma}

\begin{proof}
Above we have seen that $\textit{Mod}(\mathcal{O})$ is an additive
category, with kernels and cokernels
and that $\textit{Mod}(\mathcal{O}) \to \textit{Ab}(\mathcal{C})$
preserves kernels and cokernels.
By Homology, Definition \ref{homology-definition-abelian-category}
we have to show that image and coimage agree. This is clear
because it is true in $\textit{Ab}(\mathcal{C})$. The lemma follows.
\end{proof}

\begin{lemma}
\label{lemma-limits-colimits}
Let $(\textit{Sh}(\mathcal{C}), \mathcal{O})$ be a ringed topos.
All limits and colimits exist in $\textit{Mod}(\mathcal{O})$, and
the forgetful functor
$\textit{Mod}(\mathcal{O}) \to \textit{Ab}(\mathcal{C})$
commutes with them.
\end{lemma}

\begin{proof}
Let $\mathcal{I} \to \textit{Mod}(\mathcal{C})$, $i \mapsto \mathcal{F}_i$
be a diagram. Let $\text{lim}_i\ \mathcal{F}_i$ be the limit of the diagram
in $\textit{Ab}(\mathcal{C})$. By the description of this limit in
Lemma \ref{lemma-limits-colimits-abelian-sheaves} we see immediately that
there exists a multiplication
$$
\mathcal{O} \times \text{lim}_i\ \mathcal{F}_i
\longrightarrow
\text{lim}_i\ \mathcal{F}_i
$$
which turns $\text{lim}_i\ \mathcal{F}_i$ into a sheaf of
$\mathcal{O}$-modules. It is easy to see that this is the
limit of the diagram in $\textit{Mod}(\mathcal{C})$. Let
$\text{colim}_i\ \mathcal{F}_i$ be the colimit of the diagram
in $\textit{PAb}(\mathcal{C})$. By the description of this colimit
in the proof of Lemma \ref{lemma-limits-colimits-abelian-presheaves}
we see immediately that there exists a multiplication
$$
\mathcal{O} \times \text{colim}_i\ \mathcal{F}_i
\longrightarrow
\text{colim}_i\ \mathcal{F}_i
$$
which turns $\text{colim}_i\ \mathcal{F}_i$ into a presheaf of
$\mathcal{O}$-modules. Applying sheafification we get a
sheaf of $\mathcal{O}$-modules $(\text{colim}_i\ \mathcal{F}_i)^\#$,
see Lemma \ref{lemma-sheafification-presheaf-modules}.
It is easy to see that $(\text{colim}_i\ \mathcal{F}_i)^\#$
is the colimit of the diagram in $\textit{Mod}(\mathcal{C})$, and
by Lemma \ref{lemma-limits-colimits-abelian-sheaves}
forgetting the $\mathcal{O}$-module structure is
the colimit in $\textit{Ab}(\mathcal{C})$.
\end{proof}

\noindent
The existence of limits and colimits allows us to consider exactness
properties of functors defined on the category of $\mathcal{O}$-modules
in terms of limits and colimits, as in
Categories, Section \ref{categories-section-exact-functor}.
See Homology, Lemma \ref{homology-lemma-exact-functor} for a description of
exactness properties in terms of short exact sequences.

\begin{lemma}
\label{lemma-exactness-pushforward-pullback}
Let $f : (\textit{Sh}(\mathcal{C}), \mathcal{O}_{\mathcal{C}})
\to (\textit{Sh}(\mathcal{D}), \mathcal{O}_{\mathcal{D}})$
be a morphism of ringed topoi.
\begin{enumerate}
\item The functor $f_*$ is left exact. In fact it commutes with
all limits.
\item The functor $f^*$ is right exact. In fact it commutes
with all colimits.
\end{enumerate}
\end{lemma}

\begin{proof}
This is true because $(f^*, f_*)$ is an adjoint pair
of functors, see
Lemma \ref{lemma-adjoint-pullback-pushforward-modules}.
See Categories, Section \ref{categories-section-adjoint}.
\end{proof}





\section{Exactness of pushforward}
\label{section-pushforward}

\noindent
Some technical lemmas concerning exactness properties of pushforward.

\begin{lemma}
\label{lemma-reflect-surjections}
Let $f : \textit{Sh}(\mathcal{C}) \to \textit{Sh}(\mathcal{D})$ be
a morphism of topoi. The following are equivalent:
\begin{enumerate}
\item $f^{-1}f_*\mathcal{F} \to \mathcal{F}$ is surjective for
all $\mathcal{F}$ in $\textit{Ab}(\mathcal{C})$, and
\item $f_* : \textit{Ab}(\mathcal{C}) \to \textit{Ab}(\mathcal{D})$
reflects surjections.
\end{enumerate}
In this case the functor
$f_* : \textit{Ab}(\mathcal{C}) \to \textit{Ab}(\mathcal{D})$
is faithful.
\end{lemma}

\begin{proof}
Assume (1). Suppose that $a : \mathcal{F} \to \mathcal{F}'$
is a map of abelian sheaves on $\mathcal{C}$ such that $f_*a$ is surjective.
As $f^{-1}$ is exact this implies that
$f^{-1}f_*a : f^{-1}f_*\mathcal{F} \to f^{-1}f_*\mathcal{F}'$
is surjective. Combined with (1) this implies that $a$ is surjective.
This means that (2) holds.

\medskip\noindent
Assume (2). Let $\mathcal{F}$ be an abelian sheaf on $\mathcal{C}$.
We have to show that the map $f^{-1}f_*\mathcal{F} \to \mathcal{F}$ is
surjective. By (2) it suffices to show that
$f_*f^{-1}f_*\mathcal{F} \to f_*\mathcal{F}$ is surjective.
And this is true because there is a canonical map
$f_*\mathcal{F} \to f_*f^{-1}f_*\mathcal{F}$ which is a one-sided inverse.

\medskip\noindent
We omit the proof of the final assertion.
\end{proof}

\begin{lemma}
\label{lemma-exactness}
Let $f : \textit{Sh}(\mathcal{C}) \to \textit{Sh}(\mathcal{D})$ be
a morphism of topoi. Assume at least one of the following properties
holds
\begin{enumerate}
\item $f_*$ transforms surjections of sheaves of sets into surjections,
\item $f_*$ transforms surjections of abelian sheaves into surjections,
\item $f_*$ commutes with coequalizers on sheaves of sets,
\item $f_*$ commutes with pushouts on sheaves of sets,
\end{enumerate}
Then $f_* : \textit{Ab}(\mathcal{C}) \to \textit{Ab}(\mathcal{D})$
is exact.
\end{lemma}

\begin{proof}
Since $f_* : \textit{Ab}(\mathcal{C}) \to \textit{Ab}(\mathcal{D})$
is a right adjoint we already know that it transforms a short exact sequence
$0 \to \mathcal{F}_1 \to \mathcal{F}_2 \to \mathcal{F}_3 \to 0$
of abelian sheaves on $\mathcal{C}$ into an exact sequence
$$
0 \to f_*\mathcal{F}_1 \to f_*\mathcal{F}_2 \to f_*\mathcal{F}_3
$$
see
Categories, Sections \ref{categories-section-exact-functor} and
\ref{categories-section-adjoint}
and
Homology, Section \ref{homology-section-functors}. Hence it suffices to
prove that the map $f_*\mathcal{F}_2 \to f_*\mathcal{F}_3$ is surjective.
If (1), (2) holds, then this is clear from the definitions. By
Sites, Lemma \ref{sites-lemma-exactness-properties}
we see that (4) formally implies (1), hence in this case we are done also.
Assume (3). Then $\mathcal{F}_3$ is the coequalizer of two maps
$\mathcal{F}_1 \to \mathcal{F}_2$ (the zero map and the given map).
Hence also $f_*\mathcal{F}_3$ is the coequalizer of two maps
$f_*\mathcal{F}_1 \to f_*\mathcal{F}_2$. In particular we see that
$f_*\mathcal{F}_2 \to f_*\mathcal{F}_3$ is surjective.
\end{proof}

\begin{lemma}
\label{lemma-morphism-ringed-sites-almost-cocontinuous}
Let $f : \mathcal{D} \to \mathcal{C}$ be a morphism of sites
associated to the continuous functor $u : \mathcal{C} \to \mathcal{D}$.
Assume $u$ is almost cocontinuous. Then
\begin{enumerate}
\item $f_* : \textit{Ab}(\mathcal{D}) \to \textit{Ab}(\mathcal{C})$ is exact.
\item if $f^\sharp : f^{-1}\mathcal{O}_\mathcal{C} \to \mathcal{O}_\mathcal{D}$
is given so that $f$ becomes a morphism of ringed sites, then
$f_* : \textit{Mod}(\mathcal{O}_\mathcal{D}) \to
\textit{Mod}(\mathcal{O}_\mathcal{C})$ is exact.
\end{enumerate}
\end{lemma}

\begin{proof}
Part (2) follows from part (1) by
Lemma \ref{lemma-limits-colimits}.
Part (1) follows from
Sites, Lemma \ref{sites-lemma-morphism-of-sites-almost-cocontinuous}
and
Lemma \ref{sites-lemma-exactness-properties}
\end{proof}





\section{Exactness of lower shriek}
\label{section-exactness-lower-shriek}

\noindent
Let $u : \mathcal{C} \to \mathcal{D}$ be a functor between sites.
Assume that
\begin{enumerate}
\item[(a)] $u$ is cocontinuous, and
\item[(b)] $u$ is continuous.
\end{enumerate}
Let $g : \textit{Sh}(\mathcal{C}) \to \textit{Sh}(\mathcal{D})$ be the
morphism of topoi associated with $u$, see
Sites, Lemma \ref{sites-lemma-cocontinuous-morphism-topoi}.
Recall that $g^{-1} = u^p$, i.e., $g^{-1}$ is given by the simple formula
$(g^{-1}\mathcal{G})(U) = \mathcal{G}(u(U))$, see
Sites, Lemma \ref{sites-lemma-when-shriek}.
We would like to show that
$g^{-1} : \textit{Ab}(\mathcal{D}) \to \textit{Ab}(\mathcal{C})$
has a left adjoint $g_!$. By
Sites, Lemma \ref{sites-lemma-when-shriek}
the functor $g^{Sh}_! = (u_p\ )^\#$ is a left adjoint on sheaves of sets.
Moreover, we know that $g^{Sh}_!\mathcal{F}$ is the sheaf
associated to the presheaf
$$
V \longmapsto \text{colim}_{V \to u(U)} \mathcal{F}(U)
$$
where the colimit is over $(\mathcal{I}_V^u)^{opp}$ and is taken in the
category of sets. Hence the following definition is natural.

\begin{definition}
\label{definition-g-shriek}
With $u : \mathcal{C} \to \mathcal{D}$ satisfying (a), (b) above.
For $\mathcal{F} \in \textit{PAb}(\mathcal{C})$ we define
{\it $g_{p!}\mathcal{F}$} as the presheaf
$$
V \longmapsto \text{colim}_{V \to u(U)} \mathcal{F}(U)
$$
with colimits over $(\mathcal{I}_V^u)^{opp}$ taken in $\textit{Ab}$. For
$\mathcal{F} \in \textit{PAb}(\mathcal{C})$ we set
{\it $g_!\mathcal{F} = (g_{p!}\mathcal{F})^\#$}.
\end{definition}

\noindent
The reason for being so explicit with this is that the functors
the functors $g^{Sh}_!$ and $g_!$ are different. Whenever we use both
we have to be careful to make the distinction clear.

\begin{lemma}
\label{lemma-g-shriek-adjoint}
The functor $g_{p!}$ is a left adjoint to the functor $u^p$.
The functor $g_!$ is a left adjoint to the functor $g^{-1}$.
In other words the formulas
\begin{align*}
\text{Mor}_{\textit{PAb}(\mathcal{C})}(\mathcal{F}, u^p\mathcal{G})
& =
\text{Mor}_{\textit{PAb}(\mathcal{D})}(g_{p!}\mathcal{F}, \mathcal{G}),\\
\text{Mor}_{\textit{Ab}(\mathcal{C})}(\mathcal{F}, g^{-1}\mathcal{G})
& =
\text{Mor}_{\textit{Ab}(\mathcal{D})}(g_!\mathcal{F}, \mathcal{G})
\end{align*}
hold bifunctorially in $\mathcal{F}$ and $\mathcal{G}$.
\end{lemma}

\begin{proof}
The second formula follows formally from the first, since if
$\mathcal{F}$ and $\mathcal{G}$ are abelian sheaves then
\begin{align*}
\text{Mor}_{\textit{Ab}(\mathcal{C})}(\mathcal{F}, g^{-1}\mathcal{G})
& =
\text{Mor}_{\textit{PAb}(\mathcal{D})}(g_{p!}\mathcal{F}, \mathcal{G}) \\
& =
\text{Mor}_{\textit{Ab}(\mathcal{D})}(g_!\mathcal{F}, \mathcal{G})
\end{align*}
by the universal property of sheafification.

\medskip\noindent
To prove the first formula, let $\mathcal{F}$, $\mathcal{G}$ be abelian
presheaves. To prove the lemma we will construct maps from the group on the
left to the group on the right and omit the verification that these are
mutually inverse.

\medskip\noindent
Note that there is a canonical map of abelian presheaves
$\mathcal{F} \to u^pg_{p!}\mathcal{F}$ which on sections over $U$ is the
natural map
$\mathcal{F}(U) \to \text{colim}_{u(U) \to u(U')} \mathcal{F}(U')$, see
Sites, Lemma \ref{sites-lemma-recover}. 
Given a map $\alpha : g_{p!}\mathcal{F} \to \mathcal{G}$
we get $u^p\alpha : u^pg_{p!}\mathcal{F} \to u^p\mathcal{G}$.
which we can precompose by the map $\mathcal{F} \to u^pg_{p!}\mathcal{F}$.

\medskip\noindent
Note that there is a canonical map of abelian presheaves
$g_{p!}u^p\mathcal{G} \to \mathcal{G}$ which on sections over
$V$ is the natural map
$\text{colim}_{V \to u(U)} \mathcal{G}(u(U)) \to \mathcal{G}(V)$.
It maps a section $s \in u(U)$ in the summand corresponding to
$t : V \to u(U)$ to $t^*s \in \mathcal{G}(V)$.
Hence, given a map $\beta : \mathcal{F} \to u^p\mathcal{G}$
we get a map $g_{p!}\beta : g_{p!}\mathcal{F} \to g_{p!}u^p\mathcal{G}$
which we can postcompose with the map $g_{p!}u^p\mathcal{G} \to \mathcal{G}$
above.
\end{proof}

\begin{lemma}
\label{lemma-exactness-lower-shriek}
Let $\mathcal{C}$ and $\mathcal{D}$ be sites.
Let $u : \mathcal{C} \to \mathcal{D}$ be a functor.
Assume that
\begin{enumerate}
\item[(a)] $u$ is cocontinuous,
\item[(b)] $u$ is continuous, and
\item[(c)] fibre products and equalizers exist in $\mathcal{C}$ and
$u$ commutes with them.
\end{enumerate}
In this case the functor
$g_! : \textit{Ab}(\mathcal{C}) \to \textit{Ab}(\mathcal{D})$
is exact.
\end{lemma}

\begin{proof}
Compare with
Sites, Lemma \ref{sites-lemma-preserve-equalizers}.
Assume (a), (b), and (c).
We already know that $g_!$ is right exact as it is a left adjoint, see
Categories, Lemma \ref{categories-lemma-exact-adjoint} and
Homology, Section \ref{homology-section-functors}.
We have $g_! = (g_{p!}\ )^\#$. We have to show that
$g_!$ transforms injective maps of abelian sheaves into injective maps
of abelian presheaves.
Recall that sheafification of abelian presheaves is exact, see
Lemma \ref{lemma-limits-colimits-abelian-sheaves}.
Thus it suffices to show that $g_{p!}$ transforms injective maps of
abelian presheaves into injective maps of abelian presheaves.
To do this it suffices that colimits over the categories
$(\mathcal{I}_V^u)^{opp}$ of
Sites, Section \ref{sites-section-functoriality-PSh}
transform injective maps between diagrams into injections.
This follows from
Sites, Lemma \ref{sites-lemma-almost-directed}
and
Algebra, Lemma \ref{algebra-lemma-almost-directed-colimit-exact}.
\end{proof}

\begin{remark}
\label{remark-no-extension}
The functor $g_!$ cannot be extended to categories of modules in case
$g$ is (part of) a morphism of ringed topoi. Namely, given any ring map
$A \to B$ the functor $M \mapsto B \otimes_A M$ has a right adjoint
(restriction) but not in general a left adjoint (because its existence
would imply that $A \to B$ is flat). We will see in
Section \ref{section-localize}
below that it is possible to define $j_!$ on sheaves of modules
in the case of a localization of sites.
\end{remark}






\section{Global types of modules}
\label{section-global}

\begin{definition}
\label{definition-global}
Let $(\textit{Sh}(\mathcal{C}), \mathcal{O})$ be a ringed topos.
Let $\mathcal{F}$ be a sheaf of $\mathcal{O}$-modules.
\begin{enumerate}
\item We say $\mathcal{F}$ is a {\it free $\mathcal{O}$-module}
if $\mathcal{F}$ is isomorphic as an $\mathcal{O}$-module
to a sheaf of the form $\bigoplus_{i \in I} \mathcal{O}$.
\item We say $\mathcal{F}$ is {\it finite free} if
$\mathcal{F}$ is isomorphic as an $\mathcal{O}$-module
to a sheaf of the form $\bigoplus_{i \in I} \mathcal{O}$
with a finite index set $I$.
\item We say $\mathcal{F}$ is {\it generated by global sections}
if there exists a surjection
$$
\bigoplus\nolimits_{i \in I} \mathcal{O} \longrightarrow \mathcal{F}
$$
from a free $\mathcal{O}$-module onto $\mathcal{F}$.
\item We say $\mathcal{F}$ is {\it generated by finitely many global sections}
if there exists a surjection
$$
\bigoplus\nolimits_{i \in I} \mathcal{O} \longrightarrow \mathcal{F}
$$
with $I$ finite.
\item We say $\mathcal{F}$ has a {\it global presentation}
if there exists an exact sequence
$$
\bigoplus\nolimits_{j \in J} \mathcal{O} \longrightarrow
\bigoplus\nolimits_{i \in I} \mathcal{O} \longrightarrow
\mathcal{F}
$$
of $\mathcal{O}$-modules.
\item We say $\mathcal{F}$ has a {\it global finite presentation}
if there exists an exact sequence
$$
\bigoplus\nolimits_{j \in J} \mathcal{O} \longrightarrow
\bigoplus\nolimits_{i \in I} \mathcal{O} \longrightarrow
\mathcal{F}
$$
of $\mathcal{O}$-modules with $I$ and $J$ finite sets.
\end{enumerate}
\end{definition}

\noindent
Note that for any set $I$ the direct sum
$\bigoplus_{i \in I} \mathcal{O}$ exists
(Lemma \ref{lemma-limits-colimits})
and is the sheafification of the presheaf
$U \mapsto \bigoplus_{i \in I} \mathcal{O}(U)$.
This module is called the {\it free $\mathcal{O}$-module on the set $I$}.

\begin{lemma}
\label{lemma-global-pullback}
Let
$(f, f^\sharp) :
(\textit{Sh}(\mathcal{C}), \mathcal{O}_{\mathcal{C}})
\to
(\textit{Sh}(\mathcal{D}), \mathcal{O}_{\mathcal{D}})$
be a morphism of ringed topoi.
Let $\mathcal{F}$ be an $\mathcal{O}_{\mathcal{D}}$-module.
\begin{enumerate}
\item If $\mathcal{F}$ is free then $f^*\mathcal{F}$ is free.
\item If $\mathcal{F}$ is finite free then $f^*\mathcal{F}$ is finite free.
\item If $\mathcal{F}$ is generated by global sections
then $f^*\mathcal{F}$ is generated by global sections.
\item If $\mathcal{F}$ is generated by finitely many global sections
then $f^*\mathcal{F}$ is generated by finitely many global sections.
\item If $\mathcal{F}$ has a global presentation then
$f^*\mathcal{F}$ has a global presentation.
\item If $\mathcal{F}$ has a finite global presentation
then $f^*\mathcal{F}$ has a finite global presentation.
\end{enumerate}
\end{lemma}

\begin{proof}
This is true because $f^*$ commutes with arbitrary colimits
(Lemma \ref{lemma-exactness-pushforward-pullback})
and $f^*\mathcal{O}_{\mathcal{D}} = \mathcal{O}_{\mathcal{C}}$.
\end{proof}






\section{Intrinsic properties of modules}
\label{section-intrinsic}

\noindent
Let $(\textit{Sh}(\mathcal{C}), \mathcal{O})$ be a ringed topos.
An {\it intrinsic property} $\mathcal{P}(\mathcal{F})$
of an $\mathcal{O}$-module $\mathcal{F}$, is a property
such that
$\mathcal{P}(\mathcal{F}) \Leftrightarrow \mathcal{P}(f^*\mathcal{F})$
whenever $(f, f^\sharp) :
(\textit{Sh}(\mathcal{C}'), \mathcal{O}')
\to
(\textit{Sh}(\mathcal{C}), \mathcal{O})$
is an equivalence of ringed topoi.
For example, the property of being free is intrinsic. Indeed, the free
$\mathcal{O}$-module on the set $I$ is characterized by the property
that
$$
\text{Mor}_{\textit{Mod}(\mathcal{O})}(
\bigoplus\nolimits_{i \in I} \mathcal{O},
\mathcal{F})
=
\prod\nolimits_{i \in I} \text{Mor}_{\textit{Sh}(\mathcal{C})}(\{*\},
\mathcal{F})
$$
for a variable $\mathcal{F}$ in $\textit{Mod}(\mathcal{O})$.
Alternatively, we can also use Lemma \ref{lemma-global-pullback}
to see that being free is intrinsic. In fact, each of the properties
defined in Definition \ref{definition-global} is intrinsic for the
same reason.
How will we go about defining other intrinsic properties of
$\mathcal{O}$-modules?

\medskip\noindent
The upshot of
Lemma \ref{lemma-morphism-ringed-topoi-comes-from-morphism-ringed-sites}
is the following: Suppose you want to define
an intrinsic property $\mathcal{P}$ of an $\mathcal{O}$-module on a
topos. Then you can proceed as follows:
\begin{enumerate}
\item Given any site $\mathcal{C}$, any sheaf of rings $\mathcal{O}$
on $\mathcal{C}$ and any $\mathcal{O}$-module $\mathcal{F}$
define the corresponding
property $\mathcal{P}(\mathcal{C}, \mathcal{O}, \mathcal{F})$.
\item For any pair of sites $\mathcal{C}$, $\mathcal{C}'$, any
special cocontinuous functor $u : \mathcal{C} \to \mathcal{C}'$,
any sheaf of rings $\mathcal{O}$ on $\mathcal{C}$ any
$\mathcal{O}$-module $\mathcal{F}$, show that
$$
\mathcal{P}(\mathcal{C}, \mathcal{O}, \mathcal{F})
\Leftrightarrow
\mathcal{P}(\mathcal{C}', g_*\mathcal{O}, g_*\mathcal{F})
$$
where $g : \textit{Sh}(\mathcal{C}) \to \textit{Sh}(\mathcal{C}')$
is the equivalence of topoi associated to $u$.
\end{enumerate}
In this case, given any ringed topos $(\textit{Sh}(\mathcal{C}), \mathcal{O})$
and any sheaf of $\mathcal{O}$-modules $\mathcal{F}$ we simply say that
$\mathcal{F}$ has property $\mathcal{P}$ if
$\mathcal{P}(\mathcal{C}, \mathcal{O}, \mathcal{F})$ is true.
And Lemma \ref{lemma-morphism-ringed-topoi-comes-from-morphism-ringed-sites}
combined with (2) above garantees that this is well defined.

\medskip\noindent
Moreover, the same
Lemma \ref{lemma-morphism-ringed-topoi-comes-from-morphism-ringed-sites}
also garantees that if in addition
\begin{enumerate}
\item[(3)] For any morphism of ringed sites
$(f, f^\sharp) :
(\mathcal{C}, \mathcal{O}_{\mathcal{C}})
\to
(\mathcal{D}, \mathcal{O}_{\mathcal{D}})$
such that $f$ is given by a functor
$u : \mathcal{D} \to \mathcal{C}$ satisfying the
assumptions of Sites, Proposition \ref{sites-proposition-get-morphism}, 
and any $\mathcal{O}_{\mathcal{D}}$-module $\mathcal{G}$
we have
$$
\mathcal{P}(\mathcal{D}, \mathcal{O}_{\mathcal{D}}, \mathcal{F})
\Rightarrow
\mathcal{P}(\mathcal{C}, \mathcal{O}_{\mathcal{C}}, f^*\mathcal{F})
$$
\end{enumerate}
then it is true that $\mathcal{P}$ is preserved under pullback
of modules w.r.t.\ arbitrary morphisms of ringed topoi.

\medskip\noindent
We will use this method in the following sections to see
that:
locally free,
locally generated by sections,
finite type,
finite presentation,
quasi-coherent, and
coherent
are intrinsic properties of modules.

\medskip\noindent
Perhaps a more satisfying method would be to find an intrinsic definition
of these notions, rather than the laborious process sketched here.
On the other hand, in many geometric situations where we want to apply
these definitions we are given a definite ringed site, and a definite
sheaf of modules, and it is nice to have a definition already adapted to
this language.




\section{Localization of ringed sites}
\label{section-localize}

\noindent
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site.
Let $U \in \text{Ob}(\mathcal{C})$.
We explain the counterparts of the results in
Sites, Section \ref{sites-section-localize}
in this setting.

\medskip\noindent
Denote
$\mathcal{O}_U = j_U^{-1}\mathcal{O}$ the restriction of $\mathcal{O}$
to the site $\mathcal{C}/U$. It is described by the simple
rule $\mathcal{O}_U(V/U) = \mathcal{O}(V)$. With this notation
the localization morphism $j_U$ becomes a morphism of ringed topoi
$$
(j_U, j_U^\sharp) :
(\textit{Sh}(\mathcal{C}/U), \mathcal{O}_U)
\longrightarrow
(\textit{Sh}(\mathcal{C}), \mathcal{O})
$$
namely, we take $j_U^\sharp : j_U^{-1}\mathcal{O} \to \mathcal{O}_U$
the identity map.
Moreover, we obtain the following descriptions for pushforward
and pullback of modules.

\begin{definition}
\label{definition-localize-ringed-site}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site.
Let $U \in \text{Ob}(\mathcal{C})$.
\begin{enumerate}
\item The ringed site $(\mathcal{C}/U, \mathcal{O}_U)$ is called the
{\it localization of the ringed site $(\mathcal{C}, \mathcal{O})$
at the object $U$}.
\item The morphism of ringed topoi
$(j_U, j_U^\sharp) :
(\textit{Sh}(\mathcal{C}/U), \mathcal{O}_U)
\to
(\textit{Sh}(\mathcal{C}), \mathcal{O})$
is called the {\it localization morphism}.
\item The functor
$j_{U*} : \textit{Mod}(\mathcal{O}_U) \to \textit{Mod}(\mathcal{O})$
is called the {\it direct image functor}.
\item For a sheaf of $\mathcal{O}$-modules $\mathcal{F}$ on $\mathcal{C}$
the sheaf $j_U^*\mathcal{F}$ is called the
{\it restriction of $\mathcal{F}$ to $\mathcal{C}/U$}.
We will sometimes denote it by
$\mathcal{F}|_{\mathcal{C}/U}$ or even $\mathcal{F}|_U$.
It is described by the simple rule $j_U^*(\mathcal{F})(X/U) = \mathcal{F}(X)$.
\item The left adjoint
$j_{U!} : \textit{Mod}(\mathcal{O}_U) \to \textit{Mod}(\mathcal{O})$
of restriction is called {\it extension by zero}. It exists and is
exact by
Lemmas \ref{lemma-extension-by-zero} and
\ref{lemma-extension-by-zero-exact}.
\end{enumerate}
\end{definition}

\noindent
As in the topological case, see
Sheaves, Section \ref{sheaves-section-open-immersions},
the extension by zero $j_{U!}$ functor is different from
extension by the empty set $j_{U!}$ defined on sheaves of sets.
Here is the lemma defining extension by zero.

\begin{lemma}
\label{lemma-extension-by-zero}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site.
Let $U \in \text{Ob}(\mathcal{C})$.
The restriction functor
$j_U^* : \textit{Mod}(\mathcal{O}) \to \textit{Mod}(\mathcal{O}_U)$
has a left adjoint
$j_{U!} : \textit{Mod}(\mathcal{O}_U) \to \textit{Mod}(\mathcal{O})$.
So
$$
\text{Mor}_{\textit{Mod}(\mathcal{O}_U)}(\mathcal{G}, j_U^*\mathcal{F})
=
\text{Mor}_{\textit{Mod}(\mathcal{O})}(j_{U!}\mathcal{G}, \mathcal{F})
$$
for $\mathcal{F} \in \text{Ob}(\textit{Mod}(\mathcal{O}))$
and $\mathcal{G} \in \text{Ob}(\textit{Mod}(\mathcal{O}_U))$.
Moreover, the extension by zero $j_{U!}\mathcal{G}$ of $\mathcal{G}$
is the sheaf associated to the presheaf
$$
V
\longmapsto
\bigoplus\nolimits_{\varphi \in \text{Mor}_{\mathcal{C}}(V, U)}
\mathcal{G}(V \xrightarrow{\varphi} U)
$$
with obvious restriction mappings and an obvious $\mathcal{O}$-module
structure.
\end{lemma}

\begin{proof}
The $\mathcal{O}$-module structure on the presheaf is defined as
follows. If $f \in \mathcal{O}(V)$ and
$s \in \mathcal{G}(V \xrightarrow{\varphi} U)$, then
we define $f \cdot s = fs$ where
$f \in \mathcal{O}_U(\varphi : V \to U) = \mathcal{O}(V)$
(because $\mathcal{O}_U$ is the restriction of $\mathcal{O}$ to
$\mathcal{C}/U$).

\medskip\noindent
Similarly, let $\alpha : \mathcal{G} \to \mathcal{F}|_U$ be a
morphism of $\mathcal{O}_U$-modules. In this case we can define
a map from the presheaf of the lemma into $\mathcal{F}$ by mapping
$$
\bigoplus\nolimits_{\varphi \in \text{Mor}_{\mathcal{C}}(V, U)}
\mathcal{G}(V \xrightarrow{\varphi} U)
\longrightarrow
\mathcal{F}(V)
$$
by the rule that $s \in \mathcal{G}(V \xrightarrow{\varphi} U)$
maps to $\alpha(s) \in \mathcal{F}(V)$. It is clear that this is
$\mathcal{O}$-linear, and hence induces a morphism of
$\mathcal{O}$-modules $\alpha' : j_{U!}\mathcal{G} \to \mathcal{F}$
by the properties of sheafification of modules
(Lemma \ref{lemma-sheafification-presheaf-modules}).

\medskip\noindent
Conversely, let $\beta : j_{U!}\mathcal{G} \to \mathcal{F}$
by a map of $\mathcal{O}$-modules.
Recall from Sites, Section \ref{sites-section-localize}
that there exists an extension by the empty set
$j^{Sh}_{U!} : \textit{Sh}(\mathcal{C}/U) \to \textit{Sh}(\mathcal{C})$
on sheaves of sets which is left adjoint to $j_U^{-1}$.
Moreover, $j^{Sh}_{U!}\mathcal{G}$ is the sheaf associated to the presheaf
$$
V
\longmapsto
\coprod\nolimits_{\varphi \in \text{Mor}_{\mathcal{C}}(V, U)}
\mathcal{G}(V \xrightarrow{\varphi} U)
$$
Hence there is a natural map
$j^{Sh}_{U!}\mathcal{G} \to j_{U!}\mathcal{G}$ of sheaves of sets.
Hence precomposing $\beta$ by this map we get a map of sheaves of sets
$j^{Sh}_{U!}\mathcal{G} \to \mathcal{F}$ which by adjunction corresponds
to a map of sheaves of sets $\beta' : \mathcal{G} \to \mathcal{F}|_U$.
We claim that $\beta'$ is $\mathcal{O}_U$-linear. Namely, suppose
that $\varphi : V \to U$ is an object of $\mathcal{C}/U$ and that
$s, s' \in \mathcal{G}(\varphi : V \to U)$, and
$f \in \mathcal{O}(V) = \mathcal{O}_U(\varphi : V \to U)$.
Then by the discussion above we see that 
$\beta'(s + s')$, resp.\  $\beta'(fs)$ in $\mathcal{F}|_U(\varphi : V \to U)$
correspond to $\beta(s + s')$, resp.\ $\beta(fs)$ in
$\mathcal{F}(V)$. Since $\beta$ is a homomorphism we conclude.

\medskip\noindent
To conclude the proof of the lemma we have to show that the constructions
$\alpha \mapsto \alpha'$ and $\beta \mapsto \beta'$ are mutually inverse.
We omit the verifications.
\end{proof}

\begin{lemma}
\label{lemma-extension-by-zero-exact}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site.
Let $U \in \text{Ob}(\mathcal{C})$.
The functor
$j_{U!} : \textit{Mod}(\mathcal{O}_U) \to \textit{Mod}(\mathcal{O})$
is exact.
\end{lemma}

\begin{proof}
Since $j_{U!}$ is a left adjoint to $j_U^*$ we see that it is right exact
(see Categories Lemma \ref{categories-lemma-exact-adjoint}
and Homology, Section \ref{homology-section-functors}).
Hence it suffices to show that if $\mathcal{G}_1 \to \mathcal{G}_2$
is an injective map of $\mathcal{O}_U$-modules, then
$j_{U!}\mathcal{G}_1 \to j_{U!}\mathcal{G}_2$ is injective.
The map on sections of presheaves over an object $V$
(as in Lemma \ref{lemma-extension-by-zero}) is the map
$$
\bigoplus\nolimits_{\varphi \in \text{Mor}_{\mathcal{C}}(V, U)}
\mathcal{G}_1(V \xrightarrow{\varphi} U)
\longrightarrow
\bigoplus\nolimits_{\varphi \in \text{Mor}_{\mathcal{C}}(V, U)}
\mathcal{G}_2(V \xrightarrow{\varphi} U)
$$
which is injective by assumption. Since sheafification is exact (by
Lemma \ref{lemma-sheafification-presheaf-modules}
it agrees with sheafication of presheaves on sets, which is exact
by Sites, Lemma \ref{sites-lemma-sheafification-exact}) we win.
\end{proof}

\begin{lemma}
\label{lemma-relocalize}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site.
Let $f : V \to U$ be a morphism of $\mathcal{C}$.
Then there exists a commutative diagram
$$
\xymatrix{
(\textit{Sh}(\mathcal{C}/V), \mathcal{O}_V)
\ar[rd]_{(j_V, j_V^\sharp)} \ar[rr]_{(j, j^\sharp)} & &
(\textit{Sh}(\mathcal{C}/U), \mathcal{O}_U)
\ar[ld]^{(j_U, j_U^\sharp)} \\
& (\textit{Sh}(\mathcal{C}), \mathcal{O}) &
}
$$
of ringed topoi. Here $(j, j^\sharp)$ is the localization morphism
associated to the object $U/V$ of the ringed site
$(\mathcal{C}/V, \mathcal{O}_V)$.
\end{lemma}

\begin{proof}
The only thing to check is that
$j_V^\sharp = j^\sharp \circ j^{-1}(j_U^\sharp)$,
since everything else follows directly from
Sites, Lemma \ref{sites-lemma-relocalize} and
Sites, Diagram (\ref{sites-equation-relocalize}).
We omit the verification of the equality.
\end{proof}

\begin{remark}
\label{remark-localize-presheaves}
Localization and presheaves of modules; see
Sites, Remark \ref{sites-remark-localize-presheaves}.
Let $\mathcal{C}$ be a category.
Let $\mathcal{O}$ be a presheaf of rings.
Let $U$ be an object of $\mathcal{C}$.
Strictly speaking the functors $j_U^*$, $j_{U*}$ and $j_{U!}$
have not been defined for presheaves of $\mathcal{O}$-modules.
But of course, we can think of a presheaf as a sheaf for the
discrete topology on $\mathcal{C}$ (only coverings are isomorphisms).
Hence we also obtain a functor
$$
j_U^* :
\textit{PMod}(\mathcal{O})
\longrightarrow
\textit{PMod}(\mathcal{O}_U)
$$
and functors
$$
j_{U*}, j_{U!} :
\textit{PMod}(\mathcal{O}_U)
\longrightarrow
\textit{PMod}(\mathcal{O})
$$
which are right, left adjoint to $j_U^*$. Inspecting the proof of
Lemma \ref{lemma-extension-by-zero} we see that $j_{U!}\mathcal{G}$
is the presheaf
$$
V \longmapsto
\bigoplus\nolimits_{\varphi \in \text{Mor}_{\mathcal{C}}(V, U)}
\mathcal{G}(V \xrightarrow{\varphi} U)
$$
In addition the functor $j_{U!}$ is exact (by
Lemma \ref{lemma-extension-by-zero-exact} in the
case of the discrete topologies). Moreover, if $\mathcal{C}$
is actually a site, and $\mathcal{O}$ is actually a sheaf of rings,
then the diagram
$$
\xymatrix{
\textit{Mod}(\mathcal{O}_U) \ar[r]_{j_{U!}} \ar[d]_{forget} &
\textit{Mod}(\mathcal{O}) \\
\textit{PMod}(\mathcal{O}_U) \ar[r]^{j_{U!}} &
\textit{PMod}(\mathcal{O}) \ar[u]_{(\ )^\#}
}
$$
commutes.
\end{remark}









\section{Localization of morphisms of ringed sites}
\label{section-localize-morphisms}

\noindent
This section is the analogue of
Sites, Section \ref{sites-section-localize-morphisms}.

\begin{lemma}
\label{lemma-localize-morphism-ringed-sites}
Let
$(f, f^\sharp) :
(\mathcal{C}, \mathcal{O})
\longrightarrow
(\mathcal{D}, \mathcal{O}')$
be a morphism of ringed sites where $f$ is given by the continuous
functor $u : \mathcal{D} \to \mathcal{C}$.
Let $V$ be an object of $\mathcal{D}$ and set $U = u(V)$.
Then there is a canonical map of sheaves of rings $(f')^\sharp$
such that the diagram of
Sites, Lemma \ref{sites-lemma-localize-morphism}
is turned into a commutative diagram of ringed topoi
$$
\xymatrix{
(\textit{Sh}(\mathcal{C}/U), \mathcal{O}_U)
\ar[rr]_{(j_U, j_U^\sharp)} \ar[d]_{(f', (f')^\sharp)} & &
(\textit{Sh}(\mathcal{C}), \mathcal{O})
\ar[d]^{(f, f^\sharp)} \\
(\textit{Sh}(\mathcal{D}/V), \mathcal{O}'_V)
\ar[rr]^{(j_V, j_V^\sharp)} & &
(\textit{Sh}(\mathcal{D}), \mathcal{O}').
}
$$
Moreover, in this situation we have $f'_*j_U^{-1} = j_V^{-1}f_*$
and $f'_*j_{\mathcal{F}}^* = j_{\mathcal{G}}^*f_*$.
\end{lemma}

\begin{proof}
Just take $(f')^\sharp$ to be
$$
(f')^{-1}\mathcal{O}'_V =
(f')^{-1}j_V^{-1}\mathcal{O}' =
j_U^{-1}f^{-1}\mathcal{O}' \xrightarrow{j_U^{-1}f^\sharp}
j_U^{-1}\mathcal{O} = \mathcal{O}_U
$$
and everything else follows from
Sites, Lemma \ref{sites-lemma-localize-morphism}.
(Note that $j^{-1} = j^*$ on sheaves of modules if $j$ is a localization
morphism, hence the first equality of functors implies the second.)
\end{proof}

\begin{lemma}
\label{lemma-relocalize-morphism-ringed-sites}
Let
$(f, f^\sharp) :
(\mathcal{C}, \mathcal{O})
\longrightarrow
(\mathcal{D}, \mathcal{O}')$
be a morphism of ringed sites where $f$ is given by the continuous
functor $u : \mathcal{D} \to \mathcal{C}$.
Let $V \in \text{Ob}(\mathcal{D})$, $U \in \text{Ob}(\mathcal{C})$
and $c : U \to u(V)$ a morphism of $\mathcal{C}$.
There exists a commutative diagram of ringed topoi
$$
\xymatrix{
(\textit{Sh}(\mathcal{C}/U), \mathcal{O}_U)
\ar[rr]_{(j_U, j_U^\sharp)} \ar[d]_{(f_c, f_c^\sharp)} & &
(\textit{Sh}(\mathcal{C}), \mathcal{O}) \ar[d]^{(f, f^\sharp)} \\
(\textit{Sh}(\mathcal{D}/V), \mathcal{O}'_V)
\ar[rr]^{(j_V, j_V^\sharp)} & &
(\textit{Sh}(\mathcal{D}), \mathcal{O}').
}
$$
The morphism $(f_c, f_c^\sharp)$
is equal to the composition of the morphism
$$
(f', (f')^\sharp) :
(\textit{Sh}(\mathcal{C}/u(V)), \mathcal{O}_{u(V)})
\longrightarrow
(\textit{Sh}(\mathcal{D}/V), \mathcal{O}'_V)
$$
of
Lemma \ref{lemma-localize-morphism-ringed-sites}
and the morphism
$$
(j, j^\sharp) :
(\textit{Sh}(\mathcal{C}/U), \mathcal{O}_U)
\to
(\textit{Sh}(\mathcal{C}/u(V)), \mathcal{O}_{u(V)})
$$
of
Lemma \ref{lemma-relocalize}.
Given any morphisms $b : V' \to V$, $a : U' \to U$ and
$c' : U' \to u(V')$ such that
$$
\xymatrix{
U' \ar[r]_-{c'} \ar[d]_a & u(V') \ar[d]^{u(b)} \\
U \ar[r]^-c & u(V)
}
$$
commutes, then the following diagram of ringed topoi
$$
\xymatrix{
(\textit{Sh}(\mathcal{C}/U'), \mathcal{O}_{U'})
\ar[rr]_{(j_{U'/U}, j_{U'/U}^\sharp)} \ar[d]_{(f_{c'}, f_{c'}^\sharp)} & &
(\textit{Sh}(\mathcal{C}/U), \mathcal{O}_U)
\ar[d]^{(f_c, f_c^\sharp)} \\
(\textit{Sh}(\mathcal{D}/V'), \mathcal{O}'_{V'})
\ar[rr]^{(j_{V'/V}, j_{V'/V}^\sharp)} & &
(\textit{Sh}(\mathcal{D}/V), \mathcal{O}'_{V'})
}
$$
commutes.
\end{lemma}

\begin{proof}
On the level of morphisms of topoi this is
Sites, Lemma \ref{sites-lemma-relocalize-morphism}.
To check that the diagrams commute as morphisms of ringed topoi use
Lemmas \ref{lemma-relocalize} and
\ref{lemma-localize-morphism-ringed-sites}
exactly as in the proof of
Sites, Lemma \ref{sites-lemma-relocalize-morphism}.
\end{proof}
















\section{Localization of ringed topoi}
\label{section-localize-ringed-topoi}

\noindent
This section is the analogue of
Sites, Section \ref{sites-section-localize-topoi}
in the setting of ringed topoi.

\begin{lemma}
\label{lemma-localize-ringed-topos}
Let $(\textit{Sh}(\mathcal{C}), \mathcal{O})$ be a ringed topos.
Let $\mathcal{F} \in \textit{Sh}(\mathcal{C})$ be a sheaf.
For a sheaf $\mathcal{H}$ on $\mathcal{C}$ denote
$\mathcal{H}_{\mathcal{F}}$ the sheaf $\mathcal{H} \times \mathcal{F}$
seen as an object of the category $\textit{Sh}(\mathcal{C})/\mathcal{F}$.
The pair
$(\textit{Sh}(\mathcal{C})/\mathcal{F}, \mathcal{O}_{\mathcal{F}})$
is a ringed topos and there is a canonical morphism of ringed topoi
$$
(j_{\mathcal{F}}, j_{\mathcal{F}}^\sharp) :
(\textit{Sh}(\mathcal{C})/\mathcal{F}, \mathcal{O}_{\mathcal{F}})
\longrightarrow
(\textit{Sh}(\mathcal{C}), \mathcal{O})
$$
which is a localization as in
Section \ref{section-localize}
such that
\begin{enumerate}
\item the functor $j_{\mathcal{F}}^{-1}$ is the functor
$\mathcal{H} \mapsto \mathcal{H}_{\mathcal{F}}$,
\item the functor $j_{\mathcal{F}}^*$ is the functor
$\mathcal{H} \mapsto \mathcal{H}_{\mathcal{F}}$,
\item the functor $j_{\mathcal{F}!}$ on sheaves of sets is the forgetful
functor $\mathcal{G}/\mathcal{F} \mapsto \mathcal{G}$,
\item the functor $j_{\mathcal{F}!}$ on sheaves of modules associates
to the $\mathcal{O}_{\mathcal{F}}$-module
$\varphi : \mathcal{G} \to \mathcal{F}$ the $\mathcal{O}$-module
which is the sheafification of the presheaf
$$
V \longmapsto
\bigoplus\nolimits_{s \in \mathcal{F}(V)}
\{\sigma \in \mathcal{G}(V) \mid \varphi(\sigma) = s \}
$$
for $V \in \text{Ob}(\mathcal{C})$.
\end{enumerate}
\end{lemma}

\begin{proof}
By
Sites, Lemma \ref{sites-lemma-localize-topos}
we see that $\textit{Sh}(\mathcal{C})/\mathcal{F}$ is a topos
and that (1) and (3) are true. In particular this shows that
$j_{\mathcal{F}}^{-1}\mathcal{O} = \mathcal{O}_{\mathcal{F}}$
and shows that $\mathcal{O}_{\mathcal{F}}$ is a sheaf of rings.
Thus we may choose the map $j_{\mathcal{F}}^\sharp$ to be the identity,
in particular we see that (2) is true.
Moreover, the proof of
Sites, Lemma \ref{sites-lemma-localize-topos}
shows that we may assume $\mathcal{C}$ is a site with all finite limits
and a subcanonical topology and that $\mathcal{F} = h_U$ for some object
$U$ of $\mathcal{C}$.
Then (4) follows from the description of $j_{\mathcal{F}!}$ in
Lemma \ref{lemma-extension-by-zero}.
Alternatively one could show directly that the functor described
in (4) is a left adjoint to $j_{\mathcal{F}}^*$.
\end{proof}

\begin{definition}
\label{definition-localize-ringed-topos}
Let $(\textit{Sh}(\mathcal{C}), \mathcal{O})$ be a ringed topos.
Let $\mathcal{F} \in \textit{Sh}(\mathcal{C})$.
\begin{enumerate}
\item The ringed topos
$(\textit{Sh}(\mathcal{C})/\mathcal{F}, \mathcal{O}_{\mathcal{F}})$
is called the
{\it localization of the ringed topos
$(\textit{Sh}(\mathcal{C}), \mathcal{O})$ at $\mathcal{F}$}.
\item The morphism of ringed topoi
$(j_{\mathcal{F}}, j_{\mathcal{F}}^\sharp) :
(\textit{Sh}(\mathcal{C})/\mathcal{F}, \mathcal{O}_{\mathcal{F}})
\to
(\textit{Sh}(\mathcal{C}), \mathcal{O})$ of
Lemma \ref{lemma-localize-ringed-topos}
is called the {\it localization morphism}.
\end{enumerate}
\end{definition}

\noindent
We continue the tradition, esthablished in the chapter on sites, that we
check the localization constructions on topoi are compatible with the
constructions of localization on sites, whenever this makes sense.

\begin{lemma}
\label{lemma-localize-compare}
With
$(\textit{Sh}(\mathcal{C}), \mathcal{O})$ and
$\mathcal{F} \in \textit{Sh}(\mathcal{C})$ as in
Lemma \ref{lemma-localize-ringed-topos}.
If $\mathcal{F} = h_U^\#$ for some object $U$ of $\mathcal{C}$
then via the identification
$\textit{Sh}(\mathcal{C}/U) = \textit{Sh}(\mathcal{C})/h_U^\#$ of
Sites, Lemma \ref{sites-lemma-essential-image-j-shriek}
we have
\begin{enumerate}
\item canonically $\mathcal{O}_U = \mathcal{O}_{\mathcal{F}}$, and
\item with these identifications
we have $(j_{\mathcal{F}}, j_{\mathcal{F}}^\sharp) = (j_U, j_U^\sharp)$.
\end{enumerate}
\end{lemma}

\begin{proof}
The assertion for underlying topoi is
Sites, Lemma \ref{sites-lemma-localize-compare}.
Note that $\mathcal{O}_U$ is the restriction of $\mathcal{O}$
which by
Sites, Lemma \ref{sites-lemma-compute-j-shriek-restrict}
corresponds to $\mathcal{O} \times h_U^\#$ under the equivalence of
Sites, Lemma \ref{sites-lemma-essential-image-j-shriek}.
By definition of $\mathcal{O}_{\mathcal{F}}$ we get (1).
What's left is to prove that $j_{\mathcal{F}}^\sharp = j_U^\sharp$
under this identification. We omit the verification.
\end{proof}

\noindent
Localization is functorial in the following two ways:
We can ``relocalize'' a localization (see
Lemma \ref{lemma-relocalize-ringed-topos})
or we can given a morphism of ringed topoi, localize upstairs at
the inverse image of a sheaf downstairs and get a commutative
diagram of locally ringed spaces (see
Lemma \ref{lemma-localize-morphism-ringed-topoi}).

\begin{lemma}
\label{lemma-relocalize-ringed-topos}
Let $(\textit{Sh}(\mathcal{C}), \mathcal{O})$ be a ringed topos.
If $s : \mathcal{G} \to \mathcal{F}$ is a morphism of sheaves
on $\mathcal{C}$ then there exists a natural commutative diagram of
morphisms of ringed topoi
$$
\xymatrix{
(\textit{Sh}(\mathcal{C})/\mathcal{G}, \mathcal{O}_{\mathcal{G}})
\ar[rd]_{(j_\mathcal{G}, j_{\mathcal{G}}^\sharp)} \ar[rr]_{(j, j^\sharp)} & &
(\textit{Sh}(\mathcal{C})/\mathcal{F}, \mathcal{O}_{\mathcal{F}})
\ar[ld]^{(j_\mathcal{F}, j_{\mathcal{F}}^\sharp)} \\
& (\textit{Sh}(\mathcal{C}), \mathcal{O}) &
}
$$
where $(j, j^\sharp)$ is the localization morphism of the ringed topos
$(\textit{Sh}(\mathcal{C})/\mathcal{F}, \mathcal{O}_{\mathcal{F}})$
at the object $\mathcal{G}/\mathcal{F}$.
\end{lemma}

\begin{proof}
All assertions follow from
Sites, Lemma \ref{sites-lemma-relocalize-topos}
except the assertion that
$j_{\mathcal{G}}^\sharp = j^\sharp \circ j^{-1}(j_{\mathcal{F}}^\sharp)$.
We omit the verification.
\end{proof}

\begin{lemma}
\label{lemma-relocalize-compare}
With $(\textit{Sh}(\mathcal{C}), \mathcal{O})$,
$s : \mathcal{G} \to \mathcal{F}$ as in
Lemma \ref{lemma-relocalize-ringed-topos}.
If there exist a morphism $f : V \to U$ of $\mathcal{C}$
such that $\mathcal{G} = h_V^\#$ and $\mathcal{F} = h_U^\#$
and $s$ is induced by $f$, then the
diagrams of
Lemma \ref{lemma-relocalize}
and
Lemma \ref{lemma-relocalize-ringed-topos}
agree via the identifications
$(j_{\mathcal{F}}, j_{\mathcal{F}}^\sharp) = (j_U, j_U^\sharp)$
and
$(j_{\mathcal{G}}, j_{\mathcal{G}}^\sharp) = (j_V, j_V^\sharp)$
of
Lemma \ref{lemma-localize-compare}.
\end{lemma}

\begin{proof}
All assertions follow from
Sites, Lemma \ref{sites-lemma-relocalize-compare}
except for the assertion that the two maps $j^\sharp$
agree. This holds since in both cases the map
$j^\sharp$ is simply the identity. Some details omitted.
\end{proof}










\section{Localization of morphisms of ringed topoi}
\label{section-localize-morphisms-ringed-topoi}

\noindent
This section is the analogue of
Sites, Section \ref{sites-section-localize-morphisms-topoi}.

\begin{lemma}
\label{lemma-localize-morphism-ringed-topoi}
Let
$$
f :
(\textit{Sh}(\mathcal{C}), \mathcal{O})
\longrightarrow
(\textit{Sh}(\mathcal{D}), \mathcal{O}')
$$
be a morphism of ringed topoi. Let $\mathcal{G}$ be a sheaf on $\mathcal{D}$.
Set $\mathcal{F} = f^{-1}\mathcal{G}$.
Then there exists a commutative diagram of ringed topoi
$$
\xymatrix{
(\textit{Sh}(\mathcal{C})/\mathcal{F}, \mathcal{O}_{\mathcal{F}})
\ar[rr]_{(j_{\mathcal{F}}, j_{\mathcal{F}}^\sharp)}
\ar[d]_{(f', (f')^\sharp)} & &
(\textit{Sh}(\mathcal{C}), \mathcal{O}) \ar[d]^{(f, f^\sharp)} \\
(\textit{Sh}(\mathcal{D})/\mathcal{G}, \mathcal{O}'_{\mathcal{G}})
\ar[rr]^{(j_{\mathcal{G}}, j_{\mathcal{G}}^\sharp)} & &
(\textit{Sh}(\mathcal{D}), \mathcal{O}')
}
$$
We have $f'_*j_{\mathcal{F}}^{-1} = j_{\mathcal{G}}^{-1}f_*$
and $f'_*j_{\mathcal{F}}^* = j_{\mathcal{G}}^*f_*$. Moreover, the
morphism $f'$ is characterized by the rule
$$
(f')^{-1}(\mathcal{H} \xrightarrow{\varphi} \mathcal{G})
=
(f^{-1}\mathcal{H} \xrightarrow{f^{-1}\varphi} \mathcal{F}).
$$
\end{lemma}

\begin{proof}
By
Sites, Lemma \ref{sites-lemma-localize-morphism-topoi}
we have the diagram of underlying topoi, the
equality $f'_*j_{\mathcal{F}}^{-1} = j_{\mathcal{G}}^{-1}f_*$, and
the description of $(f')^{-1}$.
To define $(f')^\sharp$ we use the map
$$
(f')^\sharp :
\mathcal{O}'_{\mathcal{G}} =
j_{\mathcal{G}}^{-1} \mathcal{O}'
\xrightarrow{j_{\mathcal{G}}^{-1}f^\sharp}
j_{\mathcal{G}}^{-1} f_*\mathcal{O} =
f'_* j_{\mathcal{F}}^{-1}\mathcal{O} =
f'_* \mathcal{O}_{\mathcal{F}}
$$
or equivalently the map
$$
(f')^\sharp :
(f')^{-1}\mathcal{O}'_{\mathcal{G}} =
(f')^{-1}j_{\mathcal{G}}^{-1} \mathcal{O}' =
j_{\mathcal{F}}^{-1}f^{-1}\mathcal{O}'
\xrightarrow{j_{\mathcal{F}}^{-1}f^\sharp}
j_{\mathcal{F}}^{-1} \mathcal{O} =
\mathcal{O}_{\mathcal{F}}.
$$
We omit the verification that these two maps are indeed adjoint
to each other. The second construction of $(f')^\sharp$ shows that
the diagram commutes in the $2$-category of ringed topoi (as the
maps $j_{\mathcal{F}}^\sharp$ and $j_{\mathcal{G}}^\sharp$ are identities).
Finally, the equality $f'_*j_{\mathcal{F}}^* = j_{\mathcal{G}}^*f_*$
follows from the equality
$f'_*j_{\mathcal{F}}^{-1} = j_{\mathcal{G}}^{-1}f_*$
and the fact that pullbacks of sheaves of modules and sheaves of sets agree,
see
Lemma \ref{lemma-localize-ringed-topos}.
\end{proof}

\begin{lemma}
\label{lemma-localize-morphism-compare}
Let
$$
f :
(\textit{Sh}(\mathcal{C}), \mathcal{O})
\longrightarrow
(\textit{Sh}(\mathcal{D}), \mathcal{O}')
$$
be a morphism of ringed topoi.
Let $\mathcal{G}$ be a sheaf on $\mathcal{D}$.
Set $\mathcal{F} = f^{-1}\mathcal{G}$.
If $f$ is given by a continuous functor $u : \mathcal{D} \to \mathcal{C}$
and $\mathcal{G} = h_V^\#$, then the commutative diagrams of
Lemma \ref{lemma-localize-morphism-ringed-sites}
and
Lemma \ref{lemma-localize-morphism-ringed-topoi}
agree via the identifications of
Lemma \ref{lemma-localize-compare}.
\end{lemma}

\begin{proof}
At the level of morphisms of topoi this is
Sites, Lemma \ref{lemma-localize-morphism-compare}.
This works also on the level of morphisms of ringed topoi since
the formulas defining $(f')^\sharp$ in the proofs of
Lemma \ref{lemma-localize-morphism-ringed-sites}
and
Lemma \ref{lemma-localize-morphism-ringed-topoi}
agree.
\end{proof}

\begin{lemma}
\label{lemma-relocalize-morphism-ringed-topoi}
Let
$(f, f^\sharp) :
(\textit{Sh}(\mathcal{C}), \mathcal{O})
\to
(\textit{Sh}(\mathcal{D}), \mathcal{O}')$
be a morphism of ringed topoi.
Let $\mathcal{G}$ be a sheaf on $\mathcal{D}$,
let $\mathcal{F}$ be a sheaf on $\mathcal{C}$,
and let $s : \mathcal{F} \to f^{-1}\mathcal{G}$ a morphism of sheaves.
There exists a commutative diagram of ringed topoi
$$
\xymatrix{
(\textit{Sh}(\mathcal{C})/\mathcal{F}, \mathcal{O}_{\mathcal{F}})
\ar[rr]_{(j_{\mathcal{F}}, j_{\mathcal{F}}^\sharp)}
\ar[d]_{(f_c, f_c^\sharp)} & &
(\textit{Sh}(\mathcal{C}), \mathcal{O})
\ar[d]^{(f, f^\sharp)} \\
(\textit{Sh}(\mathcal{D})/\mathcal{G}, \mathcal{O}'_{\mathcal{G}})
\ar[rr]^{(j_{\mathcal{G}}, j_{\mathcal{G}}^\sharp)} & &
(\textit{Sh}(\mathcal{D}), \mathcal{O}').
}
$$
The morphism $(f_s, f_s^\sharp)$
is equal to the composition of the morphism
$$
(f', (f')^\sharp) :
(\textit{Sh}(\mathcal{C})/f^{-1}\mathcal{G}, \mathcal{O}_{f^{-1}\mathcal{G}})
\longrightarrow
(\textit{Sh}(\mathcal{D})/{\mathcal{G}}, \mathcal{O}'_{\mathcal{G}})
$$
of
Lemma \ref{lemma-localize-morphism-ringed-topoi}
and the morphism
$$
(j, j^\sharp) :
(\textit{Sh}(\mathcal{C})/\mathcal{F}, \mathcal{O}_{\mathcal{F}})
\to
(\textit{Sh}(\mathcal{C})/f^{-1}\mathcal{G}, \mathcal{O}_{f^{-1}\mathcal{G}})
$$
of
Lemma \ref{lemma-relocalize-ringed-topos}.
Given any morphisms $b : \mathcal{G}' \to \mathcal{G}$,
$a : \mathcal{F}' \to \mathcal{F}$, and
$s' : \mathcal{F}' \to f^{-1}\mathcal{G}'$ such that
$$
\xymatrix{
\mathcal{F}' \ar[r]_-{s'} \ar[d]_a &
f^{-1}\mathcal{G}' \ar[d]^{f^{-1}b} \\
\mathcal{F} \ar[r]^-s &
f^{-1}\mathcal{G}
}
$$
commutes, then the following diagram of ringed topoi
$$
\xymatrix{
(\textit{Sh}(\mathcal{C})/\mathcal{F}', \mathcal{O}_{\mathcal{F}'})
\ar[rr]_{(j_{\mathcal{F}'/\mathcal{F}}, j_{\mathcal{F}'/\mathcal{F}}^\sharp)}
\ar[d]_{(f_{s'}, f_{s'}^\sharp)} & &
(\textit{Sh}(\mathcal{C})/\mathcal{F}, \mathcal{O}_\mathcal{F})
\ar[d]^{(f_s, f_s^\sharp)} \\
(\textit{Sh}(\mathcal{D})/\mathcal{G}', \mathcal{O}'_{\mathcal{G}'})
\ar[rr]^{(j_{\mathcal{G}'/\mathcal{G}}, j_{\mathcal{G}'/\mathcal{G}}^\sharp)}
& &
(\textit{Sh}(\mathcal{D})/\mathcal{G}, \mathcal{O}'_{\mathcal{G}'})
}
$$
commutes.
\end{lemma}

\begin{proof}
On the level of morphisms of topoi this is
Sites, Lemma \ref{sites-lemma-relocalize-morphism-topoi}.
To check that the diagrams commute as morphisms of ringed topoi use
the commutative diagrams of
Lemmas \ref{lemma-relocalize-ringed-topos} and
\ref{lemma-localize-morphism-ringed-topoi}.
\end{proof}

\begin{lemma}
\label{lemma-relocalize-morphism-compare}
Let
$(f, f^\sharp) :
(\textit{Sh}(\mathcal{C}), \mathcal{O})
\to
(\textit{Sh}(\mathcal{D}), \mathcal{O}')$,
$s : \mathcal{F} \to f^{-1}\mathcal{G}$ be as in
Lemma \ref{lemma-relocalize-morphism-ringed-topoi}.
If $f$ is given by a continuous functor
$u : \mathcal{D} \to \mathcal{C}$
and $\mathcal{G} = h_V^\#$,
$\mathcal{F} = h_U^\#$ and $s$ comes from a morphism
$c : U \to u(V)$, then
the commutative diagrams of
Lemma \ref{lemma-relocalize-morphism-ringed-sites}
and
Lemma \ref{lemma-relocalize-morphism-ringed-topoi}
agree via the identifications of
Lemma \ref{lemma-localize-compare}.
\end{lemma}

\begin{proof}
This is formal using
Lemmas \ref{lemma-relocalize-compare} and
\ref{lemma-localize-morphism-compare}.
\end{proof}

















\section{Local types of modules}
\label{section-local}

\noindent
According to our general strategy explained in Section \ref{section-intrinsic}
we first define the local types for sheaves of modules on a ringed site, and
then we immediately show that these types are intrinsic, hence make sense
for sheaves of modules on ringed topoi.

\begin{definition}
\label{definition-site-local}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site.
Let $\mathcal{F}$ be a sheaf of $\mathcal{O}$-modules.
We will freely use the notions defined in
Definition \ref{definition-global}.
\begin{enumerate}
\item We say $\mathcal{F}$ is {\it locally free}
if for every object $U$ of $\mathcal{C}$ there exists a covering
$\{U_i \to U\}_{i \in I}$ of $\mathcal{C}$ such that each restriction
$\mathcal{F}|_{\mathcal{C}/U_i}$ is a free
$\mathcal{O}_{U_i}$-module.
\item We say $\mathcal{F}$ is {\it finite locally free}
if for every object $U$ of $\mathcal{C}$ there exists a covering
$\{U_i \to U\}_{i \in I}$ of $\mathcal{C}$ such that each restriction
$\mathcal{F}|_{\mathcal{C}/U_i}$ is a finite free
$\mathcal{O}_{U_i}$-module.
\item We say $\mathcal{F}$ is {\it locally generated by sections}
if for every object $U$ of $\mathcal{C}$ there exists a covering
$\{U_i \to U\}_{i \in I}$ of $\mathcal{C}$ such that each restriction
$\mathcal{F}|_{\mathcal{C}/U_i}$ is an
$\mathcal{O}_{U_i}$-module generated by global sections.
\item We say $\mathcal{F}$ is {\it of finite type}
if for every object $U$ of $\mathcal{C}$ there exists a covering
$\{U_i \to U\}_{i \in I}$ of $\mathcal{C}$ such that each restriction
$\mathcal{F}|_{\mathcal{C}/U_i}$ is an
$\mathcal{O}_{U_i}$-module generated by finitely many global sections.
\item We say $\mathcal{F}$ is {\it quasi-coherent}
if for every object $U$ of $\mathcal{C}$ there exists a covering
$\{U_i \to U\}_{i \in I}$ of $\mathcal{C}$ such that each restriction
$\mathcal{F}|_{\mathcal{C}/U_i}$ is an
$\mathcal{O}_{U_i}$-module which has a global presentation.
\item We say $\mathcal{F}$ is {\it of finite presentation}
if for every object $U$ of $\mathcal{C}$ there exists a covering
$\{U_i \to U\}_{i \in I}$ of $\mathcal{C}$ such that each restriction
$\mathcal{F}|_{\mathcal{C}/U_i}$ is an
$\mathcal{O}_{U_i}$-module which has a finite global presentation.
\item We say $\mathcal{F}$ is {\it coherent} if and only if
$\mathcal{F}$ is of finite type, and for every object
$U$ of $\mathcal{C}$ and any $s_1, \ldots, s_n \in \mathcal{F}(U)$
the kernel of the map
$\bigoplus_{i = 1, \ldots, n} \mathcal{O}_U \to \mathcal{F}|_U$
is of finite type on $(\mathcal{C}/U, \mathcal{O}_U)$.
\end{enumerate}
\end{definition}

\begin{lemma}
\label{lemma-special-locally-free}
Any of the properties (1) -- (7) of Definition \ref{definition-site-local}
is intrinsic (see discussion in Section \ref{section-intrinsic}).
\end{lemma}

\begin{proof}
Let $\mathcal{C}$, $\mathcal{D}$ be sites.
Let $u : \mathcal{C} \to \mathcal{D}$ be a special cocontinuous functor.
Let $\mathcal{O}$ be a sheaf of rings on $\mathcal{C}$.
Let $\mathcal{F}$ be a sheaf of $\mathcal{O}$-modules on $\mathcal{C}$.
Let $g : \textit{Sh}(\mathcal{C}) \to \textit{Sh}(\mathcal{D})$
be the equivalence of topoi associated to $u$.
Set $\mathcal{O}' = g_*\mathcal{O}$, and let
$g^\sharp : \mathcal{O}' \to g_*\mathcal{O}$ be the identity.
Finally, set $\mathcal{F}' = g_*\mathcal{F}$.
Let $\mathcal{P}_l$ be one of the properties (1) -- (6) listed in
Definition \ref{definition-site-local}.
(We will discuss the coherent case at the end of the proof.)
Let $\mathcal{P}_g$ denote the corresponding property listed in
Definition \ref{definition-global}. We have already seen that
$\mathcal{P}_g$ is intrinsic.
We have to show that
$\mathcal{P}_l(\mathcal{C}, \mathcal{O}, \mathcal{F})$
holds if and only if
$\mathcal{P}_l(\mathcal{D}, \mathcal{O}', \mathcal{F}')$
holds.

\medskip\noindent
Assume that $\mathcal{F}$ has $\mathcal{P}_l$.
Let $V$ be an object of $\mathcal{D}$.
One of the properties of a special cocontinuous functor is that there exists
a covering $\{u(U_i) \to V\}_{i \in I}$ in the site $\mathcal{D}$.
By assumption, for each $i$ there exists a covering
$\{U_{ij} \to U_i\}_{j \in J_i}$ in $\mathcal{C}$ such that
each restriction $\mathcal{F}|_{U_{ij}}$ is $\mathcal{P}_g$. By
Sites, Lemma \ref{sites-lemma-localize-special-cocontinuous}
we have commutative diagrams of ringed topoi
$$
\xymatrix{
(\textit{Sh}(\mathcal{C}/U_{ij}), \mathcal{O}_{U_{ij}}) \ar[r] \ar[d] &
(\textit{Sh}(\mathcal{C}), \mathcal{O}) \ar[d] \\
(\textit{Sh}(\mathcal{D}/u(U_{ij})), \mathcal{O}'_{u(U_{ij})}) \ar[r] &
(\textit{Sh}(\mathcal{D}), \mathcal{O}')
}
$$
where the vertical arrows are equivalences. Hence we conclude that
$\mathcal{F}'|_{u(U_{ij})}$ has property $\mathcal{P}_g$ also.
And moreover, $\{u(U_{ij}) \to V\}_{i \in I, j \in J_i}$ is a
covering of the site $\mathcal{D}$. Hence $\mathcal{F}'$ has
property $\mathcal{P}_l$.

\medskip\noindent
Assume that $\mathcal{F}'$ has $\mathcal{P}_l$.
Let $U$ be an object of $\mathcal{C}$.
By assumption, there exists a covering
$\{V_i \to u(U)\}_{i \in I}$ such that $\mathcal{F}'|_{V_i}$
has property $\mathcal{P}_g$. Because $u$ is cocontinuous we
can refine this covering by a family $\{u(U_j) \to u(U)\}_{j \in J}$
where $\{U_j \to U\}_{j \in J}$ is a covering in $\mathcal{C}$.
Say the refinement is given by $\alpha : J \to I$ and
$u(U_j) \to V_{\alpha(j)}$.
Restricting is transitive, i.e.,
$(\mathcal{F}'|_{V_{\alpha(j)}})|_{u(U_j)} = \mathcal{F}'|_{u(U_j)}$.
Hence by Lemma \ref{lemma-global-pullback} we see that
$\mathcal{F}'|_{u(U_j)}$ has property $\mathcal{P}_g$.
Hence the diagram
$$
\xymatrix{
(\textit{Sh}(\mathcal{C}/U_{j}), \mathcal{O}_{U_{j}}) \ar[r] \ar[d] &
(\textit{Sh}(\mathcal{C}), \mathcal{O}) \ar[d] \\
(\textit{Sh}(\mathcal{D}/u(U_{j})), \mathcal{O}'_{u(U_{j})})
\ar[r] &
(\textit{Sh}(\mathcal{D}), \mathcal{O}')
}
$$
where the vertical arrows are equivalences shows that $\mathcal{F}|_{U_j}$
has property $\mathcal{P}_g$ also. Thus $\mathcal{F}$ has
property $\mathcal{P}_l$ as desired.

\medskip\noindent
Finally, we prove the lemma in case
$\mathcal{P}_l = coherent$\footnote{The mechanics of this
are a bit awkward, and we suggest the reader skip this part of the proof.}.
Assume $\mathcal{F}$ is coherent. This implies that $\mathcal{F}$
is of finite type and hence $\mathcal{F}'$ is of finite type also by the
first part of the proof. Let $V$ be an object of $\mathcal{D}$ and let
$s_1, \ldots, s_n \in \mathcal{F}'(V)$. We have to show that the kernel
$\mathcal{K}'$ of
$\bigoplus_{j = 1, \ldots, n} \mathcal{O}_V \to \mathcal{F}'|_V$
is of finite type on $\mathcal{D}/V$. This means we have to show that
for any $V'/V$ there exists a covering $\{V'_i \to V'\}$ such that
$\mathcal{F}'|_{V'_i}$ is generated by finitely many sections.
Replacing $V$ by $V'$ (and restricting the sections $s_j$ to $V'$)
we reduce to the case where $V' = V$. Since $u$ is a special
cocontinuous functor, there exists a covering $\{u(U_i) \to V\}_{i \in I}$
in the site $\mathcal{D}$. Using the isomorphism of topoi
$\textit{Sh}(\mathcal{C}/U_i) = \textit{Sh}(\mathcal{D}/u(U_i))$
we see that $\mathcal{K}'|_{u(U_i)}$ corresponds to the kernel
$\mathcal{K}_i$ of a map
$\bigoplus_{j = 1, \ldots, n} \mathcal{O}_{U_i} \to \mathcal{F}|_{U_i}$.
Since $\mathcal{F}$ is coherent we see that $\mathcal{K}_i$
is of finite type. Hence we conclude (by the first part of the proof again)
that $\mathcal{K}|_{u(U_i)}$ is of finite type. Thus there exist coverings
$\{V_{il} \to u(U_i)\}$ such that $\mathcal{K}|_{V_{il}}$ is generated
by finitely many global sections. Since
$\{V_{il} \to V\}$ is a covering of $\mathcal{D}$ we conclude that
$\mathcal{K}$ is of finite type as desired.

\medskip\noindent
Assume $\mathcal{F}'$ is coherent. This implies that $\mathcal{F}'$
is of finite type and hence $\mathcal{F}$ is of finite type also by the
first part of the proof. Let $U$ be an object of $\mathcal{C}$, and let
$s_1, \ldots, s_n \in \mathcal{F}(U)$. We have to show that the kernel
$\mathcal{K}$ of
$\bigoplus_{j = 1, \ldots, n} \mathcal{O}_U \to \mathcal{F}|_U$
is of finite type on $\mathcal{C}/U$. Using the isomorphism of topoi
$\textit{Sh}(\mathcal{C}/U) = \textit{Sh}(\mathcal{D}/u(U))$
we see that $\mathcal{K}|_{U}$ corresponds to the kernel
$\mathcal{K}'$ of a map
$\bigoplus_{j = 1, \ldots, n} \mathcal{O}_{u(U)} \to \mathcal{F}'|_{u(U)}$.
As $\mathcal{F}'$ is coherent, we see that $\mathcal{K}'$ is of finite
type. Hence, by the first part of the proof again, we conclude
that $\mathcal{K}$ is of finite type.
\end{proof}

\noindent
Hence from now on we may refer to the properties of $\mathcal{O}$-modules
defined in Definition \ref{definition-site-local} without specifying a site.

\begin{lemma}
\label{lemma-local-final-object}
Let $(\textit{Sh}(\mathcal{C}), \mathcal{O})$
be a ringed topos. Let $\mathcal{F}$ be an $\mathcal{O}$-module.
Assume that the site $\mathcal{C}$ has a final object $X$.
Then
\begin{enumerate}
\item The following are equivalent
\begin{enumerate}
\item $\mathcal{F}$ is locally free,
\item there exists a covering $\{X_i \to X\}$ in $\mathcal{C}$ such that
each restriction $\mathcal{F}|_{\mathcal{C}/X_i}$ is a locally free
$\mathcal{O}_{X_i}$-module, and
\item there exists a covering $\{X_i \to X\}$ in $\mathcal{C}$ such that
each restriction $\mathcal{F}|_{\mathcal{C}/X_i}$ is a free
$\mathcal{O}_{X_i}$-module.
\end{enumerate}
\item The following are equivalent
\begin{enumerate}
\item $\mathcal{F}$ is finite locally free,
\item there exists a covering $\{X_i \to X\}$ in $\mathcal{C}$
such that each restriction $\mathcal{F}|_{\mathcal{C}/X_i}$
is a finite locally free $\mathcal{O}_{X_i}$-module, and
\item there exists a covering $\{X_i \to X\}$ in $\mathcal{C}$
such that each restriction $\mathcal{F}|_{\mathcal{C}/X_i}$
is a finite free $\mathcal{O}_{X_i}$-module.
\end{enumerate}
\item The following are equivalent
\begin{enumerate}
\item $\mathcal{F}$ is locally generated by sections,
\item there exists a covering $\{X_i \to X\}$ in $\mathcal{C}$
such that each restriction $\mathcal{F}|_{\mathcal{C}/X_i}$
is an $\mathcal{O}_{X_i}$-module locally generated by sections, and
\item there exists a covering $\{X_i \to X\}$ in $\mathcal{C}$
such that each restriction $\mathcal{F}|_{\mathcal{C}/X_i}$
is an $\mathcal{O}_{X_i}$-module globally generated by sections.
\end{enumerate}
\item The following are equivalent
\begin{enumerate}
\item $\mathcal{F}$ is of finite type,
\item there exists a covering $\{X_i \to X\}$ in $\mathcal{C}$
such that each restriction $\mathcal{F}|_{\mathcal{C}/X_i}$
is an $\mathcal{O}_{X_i}$-module of finite type, and
\item there exists a covering $\{X_i \to X\}$ in $\mathcal{C}$
such that each restriction $\mathcal{F}|_{\mathcal{C}/X_i}$
is an $\mathcal{O}_{X_i}$-module globally generated by finitely many sections.
\end{enumerate}
\item The following are equivalent
\begin{enumerate}
\item $\mathcal{F}$ is quasi-coherent,
\item there exists a covering $\{X_i \to X\}$ in $\mathcal{C}$
such that each restriction $\mathcal{F}|_{\mathcal{C}/X_i}$
is a quasi-coherent $\mathcal{O}_{X_i}$-module, and
\item there exists a covering $\{X_i \to X\}$ in $\mathcal{C}$
such that each restriction $\mathcal{F}|_{\mathcal{C}/X_i}$
is an $\mathcal{O}_{X_i}$-module which has a global presentation.
\end{enumerate}
\item The following are equivalent
\begin{enumerate}
\item $\mathcal{F}$ is of finite presentation,
\item there exists a covering $\{X_i \to X\}$ in $\mathcal{C}$
such that each restriction $\mathcal{F}|_{\mathcal{C}/X_i}$
is an $\mathcal{O}_{X_i}$-module of finite presentation, and
\item there exists a covering $\{X_i \to X\}$ in $\mathcal{C}$
such that each restriction $\mathcal{F}|_{\mathcal{C}/X_i}$
is an $\mathcal{O}_{X_i}$-module has a finite global presentation.
\end{enumerate}
\item The following are equivalent
\begin{enumerate}
\item $\mathcal{F}$ is coherent, and
\item there exists a covering $\{X_i \to X\}$ in $\mathcal{C}$
such that each restriction $\mathcal{F}|_{\mathcal{C}/X_i}$
is a coherent $\mathcal{O}_{X_i}$-module.
\end{enumerate}
\end{enumerate}
\end{lemma}

\begin{proof}
In each case we have (a) $\Rightarrow (b)$. In each of the cases (1) - (6)
condition (b) implies condition (c) by axiom (2) of a site
(see Sites, Definition \ref{sites-definition-site})
and the definition of the local types of modules.
Suppose $\{X_i \to X\}$ is a covering.
Then for every object $U$ of $\mathcal{C}$ we get an
induced covering $\{X_i \times_X U \to U\}$. Moreover, the global
property for $\mathcal{F}|_{\mathcal{C}/X_i}$ in part (c) implies
the corresponding global property for
$\mathcal{F}|_{\mathcal{C}/X_i \times_X U}$ by
Lemma \ref{lemma-global-pullback}, hence the sheaf has property (a)
by definition. We omit the proof of (b) $\Rightarrow$ (a) in case (7).
\end{proof}

\begin{lemma}
\label{lemma-local-pullback}
Let
$(f, f^\sharp) :
(\textit{Sh}(\mathcal{C}), \mathcal{O}_{\mathcal{C}})
\to
(\textit{Sh}(\mathcal{D}), \mathcal{O}_{\mathcal{D}})$
be a morphism of ringed topoi.
Let $\mathcal{F}$ be an $\mathcal{O}_{\mathcal{D}}$-module.
\begin{enumerate}
\item If $\mathcal{F}$ is locally free then $f^*\mathcal{F}$ is locally free.
\item If $\mathcal{F}$ is finite locally free then $f^*\mathcal{F}$ is
finite locally free.
\item If $\mathcal{F}$ is locally generated by sections
then $f^*\mathcal{F}$ is locally generated by sections.
\item If $\mathcal{F}$ is of finite type
then $f^*\mathcal{F}$ is of finite type.
\item If $\mathcal{F}$ is quasi-coherent then
$f^*\mathcal{F}$ is quasi-coherent.
\item If $\mathcal{F}$ is of finite presentation
then $f^*\mathcal{F}$ is of finite presentation.
\end{enumerate}
\end{lemma}

\begin{proof}
According to the discussion in Section \ref{section-intrinsic}
we need only check preservation under pullback for a morphism of ringed sites
$(f, f^\sharp) :
(\mathcal{C}, \mathcal{O}_{\mathcal{C}})
\to
(\mathcal{D}, \mathcal{O}_{\mathcal{D}})$
such that $f$ is given by a left exact, continuous functor
$u : \mathcal{D} \to \mathcal{C}$ between sites which have 
all finite limits.
Let $\mathcal{G}$ be a sheaf of $\mathcal{O}_{\mathcal{D}}$-modules
which has one of the properties (1) -- (6) of
Definition \ref{definition-site-local}.
We know $\mathcal{D}$ has a final object $Y$ and $X = u(Y)$
is a final object for $\mathcal{C}$. By assumption we have
a covering $\{Y_i \to Y\}$ such that $\mathcal{G}|_{\mathcal{D}/Y_i}$
has the corresponding global property. Set $X_i = u(Y_i)$ so
that $\{X_i \to X\}$ is a covering in $\mathcal{C}$.
We get a commutative diagram of morphisms ringed sites
$$
\xymatrix{
(\mathcal{C}/X_i, \mathcal{O}_{\mathcal{C}}|_{X_i}) \ar[r] \ar[d] &
(\mathcal{C}, \mathcal{O}_{\mathcal{C}}) \ar[d] \\
(\mathcal{D}/Y_i, \mathcal{O}_{\mathcal{D}}|_{Y_i}) \ar[r] &
(\mathcal{D}, \mathcal{O}_{\mathcal{D}})
}
$$
by Sites, Lemma \ref{sites-lemma-localize-morphism-strong}.
Hence by Lemma \ref{lemma-global-pullback}
that $f^*\mathcal{G}|_{X_i}$ has the corresponding global
property. Hence we conclude that $\mathcal{G}$ has the local
property we started out with by Lemma \ref{lemma-local-final-object}.
\end{proof}







\section{Tensor product}
\label{section-tensor-product}

\noindent
In Sections \ref{section-presheaves-modules} and
\ref{section-sheaves-modules}
we defined the change of rings functor by a tensor
product construction. To be sure this construction makes sense also
to define the tensor product of presheaves of $\mathcal{O}$-modules.
To be precise, suppose $\mathcal{C}$ is a category,
$\mathcal{O}$ is a presheaf of rings, and $\mathcal{F}$, $\mathcal{G}$
are presheaves of $\mathcal{O}$-modules. In this case we define
$\mathcal{F} \otimes_{p, \mathcal{O}} \mathcal{G}$ to be the presheaf
$$
U
\longmapsto
(\mathcal{F} \otimes_{p, \mathcal{O}} \mathcal{G})(U)
=
\mathcal{F}(U) \otimes_{\mathcal{O}(U)} \mathcal{G}(U)
$$
If $\mathcal{C}$ is a site, $\mathcal{O}$ is a sheaf of rings and
$\mathcal{F}$, $\mathcal{G}$ are sheaves of $\mathcal{O}$-modules
then we define
$$
\mathcal{F} \otimes_{\mathcal{O}} \mathcal{G}
=
(\mathcal{F} \otimes_{p, \mathcal{O}} \mathcal{G})^\#
$$
to be the sheaf of $\mathcal{O}$-modules associated to the presheaf
$\mathcal{F} \otimes_{p, \mathcal{O}} \mathcal{G}$.

\medskip\noindent
Here are some formulas which we will use below without further mention:
$$
(\mathcal{F}
\otimes_{p, \mathcal{O}} \mathcal{G})
\otimes_{p, \mathcal{O}} \mathcal{H}
=
\mathcal{F}
\otimes_{p, \mathcal{O}} (\mathcal{G}
\otimes_{p, \mathcal{O}} \mathcal{H}),
$$
and similarly for sheaves.
If $\mathcal{O}_1 \to \mathcal{O}_2$ is a map of presheaves of rings,
then
$$
(\mathcal{F} \otimes_{p, \mathcal{O}_1} \mathcal{G})
\otimes_{p, \mathcal{O}_1} \mathcal{O}_2 =
(\mathcal{F} \otimes_{p, \mathcal{O}_1} \mathcal{O}_2)
\otimes_{p, \mathcal{O}_2}
(\mathcal{G} \otimes_{p, \mathcal{O}_1} \mathcal{O}_2),
$$
and similarly for sheaves.
These follow from their algebraic counterparts and sheafification.

\medskip\noindent
Let $\mathcal{C}$ be a site, let $\mathcal{O}$ be a sheaf of rings and let
$\mathcal{F}$, $\mathcal{G}$, $\mathcal{H}$ be sheaves of
$\mathcal{O}$-modules. In this case we define
$$
\text{Bilin}_{\mathcal{O}}(\mathcal{F} \times \mathcal{G}, \mathcal{H})
=
\{\varphi \in
\text{Mor}_{\textit{Sh}(\mathcal{C})}(
\mathcal{F} \times \mathcal{G}, \mathcal{H}) \mid
\varphi \text{ is }\mathcal{O}\text{-bilinear}\}.
$$
With this definition we have
$$
\text{Hom}_{\mathcal{O}}
(\mathcal{F} \otimes_{\mathcal{O}} \mathcal{G}, \mathcal{H})
=
\text{Bilin}_{\mathcal{O}}(\mathcal{F} \times \mathcal{G}, \mathcal{H}).
$$
In other words $\mathcal{F} \otimes_{\mathcal{O}} \mathcal{G}$
represents the functor which associates to $\mathcal{H}$ the set
of bilinear maps $\mathcal{F} \times \mathcal{G} \to \mathcal{H}$.
In particular, since the notion of a bilinear map makes sense for
a pair of modules on a ringed topos, we see that the tensor
product of sheaves of modules is intrinsic to the topos (compare
the discussion in Section \ref{section-intrinsic}). In fact we
have the following.

\begin{lemma}
\label{lemma-tensor-product-pullback}
Let $f : (\textit{Sh}(\mathcal{C}), \mathcal{O}_{\mathcal{C}})
\to (\textit{Sh}(\mathcal{D}), \mathcal{O}_{\mathcal{D}})$ be
a morphism of ringed topoi. Let $\mathcal{F}$, $\mathcal{G}$
be $\mathcal{O}_{\mathcal{D}}$-modules. Then
$f^*(\mathcal{F} \otimes_{\mathcal{O}_{\mathcal{D}}} \mathcal{G})
= f^*\mathcal{F} \otimes_{\mathcal{O}_{\mathcal{C}}} f^*\mathcal{G}$
functorially in $\mathcal{F}$, $\mathcal{G}$.
\end{lemma}

\begin{proof}
For a sheaf $\mathcal{H}$ of $\mathcal{O}_{\mathcal{C}}$ modules we
have
\begin{align*}
\text{Hom}_{\mathcal{O}_{\mathcal{C}}}(
f^*(\mathcal{F} \otimes_{\mathcal{O}} \mathcal{G}), \mathcal{H})
& =
\text{Hom}_{\mathcal{O}_{\mathcal{D}}}(
\mathcal{F} \otimes_{\mathcal{O}} \mathcal{G}, f_*\mathcal{H}) \\
& =
\text{Bilin}_{\mathcal{O}_{\mathcal{D}}}(
\mathcal{F} \times \mathcal{G}, f_*\mathcal{H}) \\
& =
\text{Bilin}_{f^{-1}\mathcal{O}_{\mathcal{D}}}(
f^{-1}\mathcal{F} \times f^{-1}\mathcal{G}, \mathcal{H}) \\
& =
\text{Hom}_{f^{-1}\mathcal{O}_{\mathcal{D}}}(
f^{-1}\mathcal{F} \otimes_{f^{-1}\mathcal{O}_{\mathcal{D}}} f^{-1}\mathcal{G},
\mathcal{H}) \\
& =
\text{Hom}_{\mathcal{O}_{\mathcal{C}}}(
f^*\mathcal{F} \otimes_{f^*\mathcal{O}_{\mathcal{D}}} f^*\mathcal{G},
\mathcal{H})
\end{align*}
The interesting ``$=$'' in this sequence of equalities is the 
third equality. It follows from the definition and adjointness of
$f_*$ and $f^{-1}$ (as discussed in previous sections) in a
straightforward manner.
\end{proof}



\section{Internal Hom}
\label{section-internal-hom}

\noindent
Let $\mathcal{C}$ be a category and let $\mathcal{O}$ be a presheaf
of rings. Let $\mathcal{F}$, $\mathcal{G}$ be presheaves of
$\mathcal{O}$-modules. Consider the rule
$$
U \longmapsto \text{Hom}_{\mathcal{O}_U}(\mathcal{F}|_U, \mathcal{G}|_U).
$$
For $\varphi : V \to U$ in $\mathcal{C}$ we define a restriction mapping
$$
\text{Hom}_{\mathcal{O}_U}(\mathcal{F}|_U, \mathcal{G}|_U)
\longrightarrow
\text{Hom}_{\mathcal{O}_V}(\mathcal{F}|_V, \mathcal{G}|_V)
$$
by restricting via the relocalization morphism
$j : \mathcal{C}/V \to \mathcal{C}/U$, see
Sites, Lemma \ref{sites-lemma-relocalize}. Hence this defines a
presheaf $\textit{Hom}_{\mathcal{O}}(\mathcal{F}, \mathcal{G})$.
In addition, given an element
$\varphi \in \text{Hom}_{\mathcal{O}|_U}(\mathcal{F}|_U, \mathcal{G}|_U)$
and a section $f \in \mathcal{O}(U)$ then we can define
$f\varphi \in \text{Hom}_{\mathcal{O}|_U}(\mathcal{F}|_U, \mathcal{G}|_U)$
by either precomposing with multiplication by $f$ on $\mathcal{F}|_U$
or postcomposing with multiplication by $f$ on $\mathcal{G}|_U$ (it gives
the same result). Hence we in fact get a presheaf of $\mathcal{O}$-modules.
There is a canonical ``evaluation'' morphism
$$
\mathcal{F}
\otimes_{p, \mathcal{O}}
\textit{Hom}_{\mathcal{O}}(\mathcal{F}, \mathcal{G})
\longrightarrow
\mathcal{G}.
$$

\begin{lemma}
\label{lemma-internal-hom}
If $\mathcal{C}$ is a site, $\mathcal{O}$ is a sheaf of rings
and $\mathcal{G}$ is a sheaf of $\mathcal{O}$-modules, then
$\textit{Hom}_{\mathcal{O}}(\mathcal{F}, \mathcal{G})$
is a sheaf of $\mathcal{O}$-modules.
\end{lemma}

\begin{proof}
Omitted. Hints: Note first that
$\textit{Hom}_{\mathcal{O}}(\mathcal{F}, \mathcal{G})
= \textit{Hom}_{\mathcal{O}}(\mathcal{F}^\#, \mathcal{G})$, which reduces
the question to the case where both $\mathcal{F}$ and $\mathcal{G}$
are sheaves. The result for sheaves of sets is
Sites, Lemma \ref{sites-lemma-glue-maps}.
\end{proof}

\noindent
In the situation of the lemma the ``evaluation'' morphism
factors through the tensor product of sheaves of modules
$$
\mathcal{F}
\otimes_\mathcal{O}
\textit{Hom}_{\mathcal{O}}(\mathcal{F}, \mathcal{G})
\longrightarrow
\mathcal{G}.
$$

\begin{lemma}
\label{lemma-internal-hom-commute-limits}
Internal hom and (co)limits.
Let $\mathcal{C}$ be a category and let $\mathcal{O}$ be a presheaf of rings.
\begin{enumerate}
\item For any presheaf of $\mathcal{O}$-modules $\mathcal{F}$ the functor
$$
\textit{PMod}(\mathcal{O}) \longrightarrow \textit{PMod}(\mathcal{O})
,\quad
\mathcal{G} \longmapsto \textit{Hom}_{\mathcal{O}}(\mathcal{F}, \mathcal{G})
$$
commutes with arbitrary limits.
\item For any presheaf of $\mathcal{O}$-modules $\mathcal{G}$ the functor
$$
\textit{PMod}(\mathcal{O}) \longrightarrow \textit{PMod}(\mathcal{O})^{opp}
,\quad
\mathcal{F} \longmapsto \textit{Hom}_{\mathcal{O}}(\mathcal{F}, \mathcal{G})
$$
commutes with arbitrary colimits, in a formula
$$
\textit{Hom}_{\mathcal{O}}(\text{colim}_i\ \mathcal{F}_i, \mathcal{G})
=
\text{lim}_i\ \textit{Hom}_{\mathcal{O}}(\mathcal{F}_i, \mathcal{G}).
$$
\end{enumerate}
Suppose that $\mathcal{C}$ is a site, and $\mathcal{O}$ is a sheaf of rings.
\begin{enumerate}
\item[(3)] For any sheaf of $\mathcal{O}$-modules $\mathcal{F}$ the functor
$$
\textit{Mod}(\mathcal{O}) \longrightarrow \textit{Mod}(\mathcal{O})
,\quad
\mathcal{G} \longmapsto \textit{Hom}_{\mathcal{O}}(\mathcal{F}, \mathcal{G})
$$
commutes with arbitrary limits.
\item[(4)] For any sheaf of $\mathcal{O}$-modules $\mathcal{G}$ the functor
$$
\textit{Mod}(\mathcal{O}) \longrightarrow \textit{Mod}(\mathcal{O})^{opp}
,\quad
\mathcal{F} \longmapsto \textit{Hom}_{\mathcal{O}}(\mathcal{F}, \mathcal{G})
$$
commutes with arbitrary colimits, in a formula
$$
\textit{Hom}_{\mathcal{O}}(\text{colim}_i\ \mathcal{F}_i, \mathcal{G})
=
\text{lim}_i\ \textit{Hom}_{\mathcal{O}}(\mathcal{F}_i, \mathcal{G}).
$$
\end{enumerate}
\end{lemma}

\begin{proof}
Let $\mathcal{I} \to \textit{PMod}(\mathcal{O})$, $i \mapsto \mathcal{G}_i$
be a diagram. Let $U$ be an object of the category $\mathcal{C}$.
As $j_U^*$ is both a left and a right adjoint we see that
$\text{lim}_i\ j_U^*\mathcal{G}_i = j_U^* \text{lim}_i\ \mathcal{G}_i$.
Hence we have
\begin{align*}
\textit{Hom}_{\mathcal{O}}(\mathcal{F}, \text{lim}_i\ \mathcal{G}_i)(U)
& =
\text{Hom}_{\mathcal{O}_U}(\mathcal{F}|_U, \text{lim}_i\ \mathcal{G}_i|_U) \\
& =
\text{lim}_i\ \text{Hom}_{\mathcal{O}_U}(\mathcal{F}|_U, \mathcal{G}_i|_U) \\
& = \text{lim}_i\ \textit{Hom}_{\mathcal{O}}(\mathcal{F}, \mathcal{G}_i)(U)
\end{align*}
by definition of a limit. This proves (1). Part (2) is proved in exactly the
same way. Part (3) follows from (1) because the limit of a diagram of sheaves 
is the same as the limit in the category of presheaves.
Finally, (4) follow because, in the formula we have
$$
\text{Mor}_{\textit{Mod}(\mathcal{O})}(
\text{colim}_i\ \mathcal{F}_i, \mathcal{G})
=
\text{Mor}_{\textit{PMod}(\mathcal{O})}(
\text{colim}^{PSh}_i\ \mathcal{F}_i, \mathcal{G})
$$
as the colimit $\text{colim}_i\ \mathcal{F}_i$ is the sheafification of
the colimit $\text{colim}^{PSh}_i\ \mathcal{F}_i$ in
$\textit{PMod}(\mathcal{O})$. Hence (4) follows from (2)
(by the remark on limits above again).
\end{proof}

\begin{lemma}
\label{lemma-internal-hom-adjoint-tensor}
Let $\mathcal{C}$ be a category. Let $\mathcal{O}$ be a presheaf of
rings.
\begin{enumerate}
\item Let $\mathcal{F}$, $\mathcal{G}$, $\mathcal{H}$ be
presheaves of $\mathcal{O}$-modules. There is a canonical isomorphism
$$
\textit{Hom}_{\mathcal{O}}
(\mathcal{F} \otimes_{p, \mathcal{O}} \mathcal{G}, \mathcal{H})
\longrightarrow
\textit{Hom}_{\mathcal{O}}
(\mathcal{F}, \textit{Hom}_{\mathcal{O}}(\mathcal{G}, \mathcal{H}))
$$
which is functorial in all three entries (sheaf Hom in
all three spots). In particular,
$$
\text{Mor}_{\textit{PMod}(\mathcal{O})}(
\mathcal{F} \otimes_{p, \mathcal{O}} \mathcal{G}, \mathcal{H})
=
\text{Mor}_{\textit{PMod}(\mathcal{O})}(
\mathcal{F}, \textit{Hom}_{\mathcal{O}}(\mathcal{G}, \mathcal{H}))
$$
\item
Suppose that $\mathcal{C}$ is a site, $\mathcal{O}$ is a sheaf of rings,
and $\mathcal{F}$, $\mathcal{G}$, $\mathcal{H}$ are sheaves of
$\mathcal{O}$-modules. There is a canonical isomorphism
$$
\textit{Hom}_{\mathcal{O}}
(\mathcal{F} \otimes_{\mathcal{O}} \mathcal{G}, \mathcal{H})
\longrightarrow
\textit{Hom}_{\mathcal{O}}
(\mathcal{F}, \textit{Hom}_{\mathcal{O}}(\mathcal{G}, \mathcal{H}))
$$
which is functorial in all three entries (sheaf Hom in
all three spots). In particular,
$$
\text{Mor}_{\textit{Mod}(\mathcal{O})}(
\mathcal{F} \otimes_{\mathcal{O}} \mathcal{G}, \mathcal{H})
=
\text{Mor}_{\textit{Mod}(\mathcal{O})}(
\mathcal{F}, \textit{Hom}_{\mathcal{O}}(\mathcal{G}, \mathcal{H}))
$$
\end{enumerate}
\end{lemma}

\begin{proof}
This is the analogue of
Algebra, Lemma \ref{algebra-lemma-hom-from-tensor-product}.
The proof is the same, and is omitted.
\end{proof}

\begin{lemma}
\label{lemma-tensor-commute-colimits}
Tensor product and (co)limits.
Let $\mathcal{C}$ be a category and let $\mathcal{O}$ be a presheaf of rings.
\begin{enumerate}
\item For any presheaf of $\mathcal{O}$-modules $\mathcal{F}$ the functor
$$
\textit{PMod}(\mathcal{O}) \longrightarrow \textit{PMod}(\mathcal{O})
,\quad
\mathcal{G} \longmapsto \mathcal{F} \otimes_{p, \mathcal{O}} \mathcal{G}
$$
commutes with arbitrary colimits.
\item
Suppose that $\mathcal{C}$ is a site, and $\mathcal{O}$ is a sheaf of rings.
For any sheaf of $\mathcal{O}$-modules $\mathcal{F}$ the functor
$$
\textit{PMod}(\mathcal{O}) \longrightarrow \textit{PMod}(\mathcal{O})
,\quad
\mathcal{G} \longmapsto \mathcal{F} \otimes_\mathcal{O} \mathcal{G}
$$
commutes with arbitrary colimits.
\end{enumerate}
\end{lemma}

\begin{proof}
This is because tensor product is adjoint to internal hom according
to Lemma \ref{lemma-internal-hom-adjoint-tensor}.
See Categories, Lemma \ref{categories-lemma-adjoint-exact}.
\end{proof}

\begin{lemma}
\label{lemma-tensor-product-permanence}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site.
Let $\mathcal{F}$, $\mathcal{G}$ be sheaves of $\mathcal{O}$-modules.
\begin{enumerate}
\item If $\mathcal{F}$, $\mathcal{G}$ are locally free,
so is $\mathcal{F} \otimes_\mathcal{O} \mathcal{G}$.
\item If $\mathcal{F}$, $\mathcal{G}$ are finite locally free,
so is $\mathcal{F} \otimes_\mathcal{O} \mathcal{G}$.
\item If $\mathcal{F}$, $\mathcal{G}$ are locally generated
by sections, so is $\mathcal{F}\otimes_\mathcal{O} \mathcal{G}$.
\item If $\mathcal{F}$, $\mathcal{G}$ are of finite type,
so is $\mathcal{F} \otimes_\mathcal{O} \mathcal{G}$.
\item If $\mathcal{F}$, $\mathcal{G}$ are quasi-coherent,
so is $\mathcal{F} \otimes_\mathcal{O} \mathcal{G}$.
\item If $\mathcal{F}$, $\mathcal{G}$ are of finite presentation,
so is $\mathcal{F} \otimes_\mathcal{O} \mathcal{G}$.
\item If $\mathcal{F}$ is of finite presentation and $\mathcal{G}$ is coherent,
then $\mathcal{F} \otimes_\mathcal{O} \mathcal{G}$ is coherent.
\item If $\mathcal{F}$, $\mathcal{G}$ are coherent,
so is $\mathcal{F} \otimes_\mathcal{O} \mathcal{G}$.
\end{enumerate}
\end{lemma}

\begin{proof}
Omitted. Hint: Compare with
Sheaves of Modules, Lemma \ref{modules-lemma-tensor-product-permanence}.
\end{proof}









\section{Flat modules}
\label{section-flat}

\noindent
We can define flat modules exactly as in the case of modules over rings.

\begin{definition}
\label{definition-flat}
Let $\mathcal{C}$ be a category.
Let $\mathcal{O}$ be a presheaf of rings.
\begin{enumerate}
\item A presheaf $\mathcal{F}$ of $\mathcal{O}$-modules is called
{\it flat} if the functor
$$
\textit{PMod}(\mathcal{O})
\longrightarrow
\textit{PMod}(\mathcal{O}), \quad
\mathcal{G} \mapsto \mathcal{G} \otimes_{p, \mathcal{O}} \mathcal{F}
$$
is exact.
\item A map $\mathcal{O} \to \mathcal{O}'$ of presheaves of rings
is called {\it flat} if $\mathcal{O}'$ is flat as a presheaf of
$\mathcal{O}$-modules.
\item If $\mathcal{C}$ is a site, $\mathcal{O}$ is a sheaf of rings
and $\mathcal{F}$ is a sheaf of $\mathcal{O}$-modules, then we
say $\mathcal{F}$ is {\it flat} if the functor
$$
\textit{Mod}(\mathcal{O})
\longrightarrow
\textit{Mod}(\mathcal{O}), \quad
\mathcal{G} \mapsto \mathcal{G} \otimes_{\mathcal{O}} \mathcal{F}
$$
is exact.
\item A map $\mathcal{O} \to \mathcal{O}'$ of sheaves of rings on a site
is called {\it flat} if $\mathcal{O}'$ is flat as a sheaf of
$\mathcal{O}$-modules.
\end{enumerate}
\end{definition}

\noindent
The notion of a flat module or flat ring map is intrinsic
(Section \ref{section-intrinsic}).

\begin{lemma}
\label{lemma-flatness-presheaves}
Let $\mathcal{C}$ be a category.
Let $\mathcal{O}$ be a presheaf of rings.
Let $\mathcal{F}$ be a presheaf of $\mathcal{O}$-modules.
If each $\mathcal{F}(U)$ is a flat $\mathcal{O}(U)$-module,
then $\mathcal{F}$ is flat.
\end{lemma}

\begin{proof}
This is immediate from the definitions.
\end{proof}

\begin{lemma}
\label{lemma-flatness-sheafification}
Let $\mathcal{C}$ be a category.
Let $\mathcal{O}$ be a presheaf of rings.
Let $\mathcal{F}$ be a presheaf of $\mathcal{O}$-modules.
If $\mathcal{F}$ is a flat $\mathcal{O}$-module, then
$\mathcal{F}^\#$ is a flat $\mathcal{O}^\#$-module.
\end{lemma}

\begin{proof}
Omitted. (Hint: Sheafification is exact.)
\end{proof}

\begin{lemma}
\label{lemma-colimits-flat}
(Colimits and tensor product.)
\begin{enumerate}
\item A filtered colimit of flat presheaves of modules
is flat. A direct sum of flat presheaves of modules is flat.
\item A filtered colimit of flat sheaves of modules is flat.
A direct sum of flat presheaves of modules is flat.
\end{enumerate}
\end{lemma}

\begin{proof}
Part (1) follows from Lemma \ref{lemma-tensor-commute-colimits} and
Algebra, Lemma \ref{algebra-lemma-directed-colimit-exact}
by looking at sections over objects.
To see part (2), use Lemma \ref{lemma-tensor-commute-colimits} and
the fact that a filtered colimit of exact 
complexes is an exact complex (this uses that sheafification is exact
and commutes with colimits). Some details omitted.
\end{proof}

\begin{lemma}
\label{lemma-j-shriek-flat}
Let $\mathcal{C}$ be a category.
Let $\mathcal{O}$ be a presheaf of rings.
Let $U$ be an object of $\mathcal{C}$.
Consider the functor $j_U : \mathcal{C}/U \to \mathcal{C}$.
\begin{enumerate}
\item The presheaf of $\mathcal{O}$-modules
$j_{U!}\mathcal{O}_U$ (see
Remark \ref{remark-localize-presheaves})
is flat.
\item If $\mathcal{C}$ is a site, $\mathcal{O}$ is a sheaf of rings,
$j_{U!}\mathcal{O}_U$ is a flat sheaf of $\mathcal{O}$-modules.
\end{enumerate}
\end{lemma}

\begin{proof}
Proof of (1). By the discussion in
Remark \ref{remark-localize-presheaves}
we see that
$$
j_{U!}\mathcal{O}_U(V)
=
\bigoplus\nolimits_{\varphi \in \text{Mor}_{\mathcal{C}}(V, U)}
\mathcal{O}(V)
$$
which is a flat $\mathcal{O}(V)$-module. Hence (1) follows from
Lemma \ref{lemma-flatness-presheaves}.
Then (2) follows as $j_{U!}\mathcal{O}_U = (j_{U!}\mathcal{O}_U)^\#$
(the first $j_{U!}$ on sheaves, the second on presheaves)
and Lemma \ref{lemma-flatness-sheafification}.
\end{proof}

\begin{lemma}
\label{lemma-module-quotient-flat}
Let $\mathcal{C}$ be a category.
Let $\mathcal{O}$ be a presheaf of rings.
\begin{enumerate}
\item Any presheaf of $\mathcal{O}$-modules is a quotient of
a flat presheaf of $\mathcal{O}$-modules.
\item If $\mathcal{C}$ is a site, $\mathcal{O}$ is a sheaf of rings,
then any sheaf of $\mathcal{O}$-modules is a quotient of
a flat sheaf of $\mathcal{O}$-modules.
\end{enumerate}
\end{lemma}

\begin{proof}
Proof of (1). For every object $U$ of $\mathcal{C}$ and every
$s \in \mathcal{F}(U)$ we get a morphism
$j_{U!}\mathcal{O}_U \to \mathcal{F}$, namely the adjoint to
the morphism $\mathcal{O}_U \to \mathcal{F}|_U$, $1 \mapsto s$.
Clearly the map
$$
\bigoplus\nolimits_{(U, s)} j_{U!}\mathcal{O}_U
\longrightarrow
\mathcal{F}
$$
is surjective, and the source is flat by combining Lemmas
\ref{lemma-colimits-flat} and \ref{lemma-j-shriek-flat}.
The sheaf case follows from this either by
sheafifying or repeating the same argument.
\end{proof}

\begin{lemma}
\label{lemma-flat-tor-zero}
Let $\mathcal{C}$ be a category.
Let $\mathcal{O}$ be a presheaf of rings.
Let
$$
0 \to \mathcal{F}'' \to \mathcal{F}' \to \mathcal{F} \to 0
$$
be a short exact sequence of presheaves of $\mathcal{O}$-modules.
Assume $\mathcal{F}$ is flat. Then
\begin{enumerate}
\item For any presheaf $\mathcal{G}$
of $\mathcal{O}$-modules, the sequence
$$
0 \to
\mathcal{F}'' \otimes_{p, \mathcal{O}} \mathcal{G} \to
\mathcal{F}' \otimes_{p, \mathcal{O}} \mathcal{G} \to
\mathcal{F} \otimes_{p, \mathcal{O}} \mathcal{G} \to 0
$$
is exact.
\item If $\mathcal{C}$ is a site, and $\mathcal{O}$,
$\mathcal{F}$, $\mathcal{F}'$, $\mathcal{F}''$, and
$\mathcal{G}$ are all sheaves, the sequence
$$
0 \to
\mathcal{F}'' \otimes_\mathcal{O} \mathcal{G} \to
\mathcal{F}' \otimes_\mathcal{O} \mathcal{G} \to
\mathcal{F} \otimes_\mathcal{O} \mathcal{G} \to 0
$$
is exact.
\end{enumerate}
\end{lemma}

\begin{proof}
Choose a flat presheaf of $\mathcal{O}$-modules $\mathcal{G}'$
which surjects onto $\mathcal{G}$. This is possible by
Lemma \ref{lemma-module-quotient-flat}. Let
$\mathcal{G}'' = \text{Ker}(\mathcal{G}' \to \mathcal{G})$.
The lemma follows by applying the snake lemma to the following
diagram
$$
\begin{matrix}
 & & 0 & & 0 & & 0 & & \\
 & & \uparrow & & \uparrow & & \uparrow & & \\
 & & \mathcal{F}'' \otimes_{p, \mathcal{O}} \mathcal{G} & \to &
     \mathcal{F}' \otimes_{p, \mathcal{O}} \mathcal{G} & \to &
     \mathcal{F} \otimes_{p, \mathcal{O}} \mathcal{G} & \to & 0 \\
 & & \uparrow & & \uparrow & & \uparrow & & \\
0 & \to & \mathcal{F}'' \otimes_{p, \mathcal{O}} \mathcal{G}' & \to &
          \mathcal{F}' \otimes_{p, \mathcal{O}} \mathcal{G}' & \to &
	  \mathcal{F} \otimes_{p, \mathcal{O}} \mathcal{G}' & \to & 0 \\
 & & \uparrow & & \uparrow & & \uparrow & & \\
 & & \mathcal{F}'' \otimes_{p, \mathcal{O}} \mathcal{G}'' & \to &
     \mathcal{F}' \otimes_{p, \mathcal{O}} \mathcal{G}'' & \to &
     \mathcal{F} \otimes_{p, \mathcal{O}} \mathcal{G}'' & \to & 0 \\
 & & & & & & \uparrow & & \\
 & & & & & & 0 & &
\end{matrix}
$$
with exact rows and columns. The middle row is exact because tensoring
with the flat module $\mathcal{G}'$ is exact.
The sheaf case follows from the presheaf case as sheafification is
exact.
\end{proof}

\begin{lemma}
\label{lemma-flat-ses}
Let $\mathcal{C}$ be a category.
Let $\mathcal{O}$ be a presheaf of rings.
Let
$$
0 \to
\mathcal{F}_2 \to
\mathcal{F}_1 \to
\mathcal{F}_0 \to 0
$$
be a short exact sequence of presheaves of $\mathcal{O}$-modules.
\begin{enumerate}
\item If $\mathcal{F}_2$ and $\mathcal{F}_0$ are flat so is
$\mathcal{F}_1$.
\item If $\mathcal{F}_1$ and $\mathcal{F}_0$ are flat so is
$\mathcal{F}_2$.
\end{enumerate}
If $\mathcal{C}$ is a site and $\mathcal{O}$ is a
sheaf of rings then the same result holds $\textit{Mod}(\mathcal{O})$.
\end{lemma}

\begin{proof}
Let $\mathcal{G}^\bullet$ be an arbitrary exact complex of presheaves
of $\mathcal{O}$-modules. Assume that $\mathcal{F}_0$ is flat.
By Lemma \ref{lemma-flat-tor-zero} we see that
$$
0 \to
\mathcal{G}^\bullet \otimes_{p, \mathcal{O}} \mathcal{F}_2 \to
\mathcal{G}^\bullet \otimes_{p, \mathcal{O}} \mathcal{F}_1 \to
\mathcal{G}^\bullet \otimes_{p, \mathcal{O}} \mathcal{F}_0 \to 0
$$
is a short exact sequence of complexes of presheaves of
$\mathcal{O}$-modules. Hence (1) and (2) follow from the snake lemma.
The case of sheaves of modules is proved in the same way.
\end{proof}

\begin{lemma}
\label{lemma-flat-resolution-of-flat}
Let $\mathcal{C}$ be a category.
Let $\mathcal{O}$ be a presheaf of rings.
Let
$$
\ldots \to
\mathcal{F}_2 \to
\mathcal{F}_1 \to
\mathcal{F}_0 \to
\mathcal{Q} \to 0
$$
be an exact complex of presheaves of $\mathcal{O}$-modules.
If $\mathcal{Q}$ and all $\mathcal{F}_i$ are flat $\mathcal{O}$-modules,
then for any presheaf $\mathcal{G}$ of $\mathcal{O}$-modules the
complex
$$
\ldots \to
\mathcal{F}_2 \otimes_{p, \mathcal{O}} \mathcal{G} \to
\mathcal{F}_1 \otimes_{p, \mathcal{O}} \mathcal{G} \to
\mathcal{F}_0 \otimes_{p, \mathcal{O}} \mathcal{G} \to
\mathcal{Q} \otimes_{p, \mathcal{O}} \mathcal{G} \to 0
$$
is exact also. If $\mathcal{C}$ is a site and $\mathcal{O}$ is a
sheaf of rings then the same result holds $\textit{Mod}(\mathcal{O})$.
\end{lemma}

\begin{proof}
Follows from Lemma \ref{lemma-flat-tor-zero} by splitting the complex
into short exact sequences and using Lemma \ref{lemma-flat-ses} to
prove inductively that $\text{Im}(\mathcal{F}_{i + 1} \to \mathcal{F}_i)$
is flat.
\end{proof}





\section{Flat morphisms}
\label{section-flat-morphisms}

\begin{definition}
\label{definition-flat-morphism}
Let 
$(f, f^\sharp) :
(\textit{Sh}(\mathcal{C}), \mathcal{O})
\longrightarrow
(\textit{Sh}(\mathcal{C}'), \mathcal{O}')$
be a morphism of ringed topoi. We say $(f, f^\sharp)$ is
{\it flat} if the ring map $f^\sharp : f^{-1}\mathcal{O}' \to \mathcal{O}$
is flat. We say a morphism of ringed sites is {\it flat}
if the associated morphism of ringed topoi is flat.
\end{definition}

\begin{lemma}
\label{lemma-flat-pullback-exact}
Let $f : \textit{Sh}(\mathcal{C}) \to \textit{Sh}(\mathcal{C}')$
be a morphism of ringed topoi. Then
$$
f^{-1} : \textit{Ab}(\mathcal{C}') \longrightarrow \textit{Ab}(\mathcal{C}),
\quad
\mathcal{F} \longmapsto f^{-1}\mathcal{F}
$$
is exact. If
$(f, f^\sharp) :
(\textit{Sh}(\mathcal{C}), \mathcal{O})
\to
(\textit{Sh}(\mathcal{C}'), \mathcal{O}')$
is a flat morphism of ringed topoi then
$$
f^* : \textit{Mod}(\mathcal{O}') \longrightarrow \textit{Mod}(\mathcal{O}),
\quad
\mathcal{F} \longmapsto f^*\mathcal{F}
$$
is exact.
\end{lemma}

\begin{proof}
Given an abelian sheaf $\mathcal{G}$ on $\mathcal{C}'$
the underlying sheaf of sets of $f^{-1}\mathcal{G}$ is the same
as $f^{-1}$ of the underlying sheaf of sets of $\mathcal{G}$, see
Sites, Section \ref{sites-section-sheaves-algebraic-structures}.
Hence the exactness of $f^{-1}$ for sheaves of sets (required in the
definition of a morphism of topoi, see
Sites, Definition \ref{sites-definition-topos})
implies the exactness of $f^{-1}$ as a functor on abelian sheaves.

\medskip\noindent
To see the statement on modules recall that $f^*\mathcal{F}$ is defined
as the tensor product
$f^{-1}\mathcal{F} \otimes_{f^{-1}\mathcal{O}', f^\sharp} \mathcal{O}$.
Hence $f^*$ is a composition of functors both of which are exact.
\end{proof}





\section{Invertible modules}
\label{section-invertible}

\noindent
Here is the definition.

\begin{definition}
\label{definition-invertible-sheaf}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site.
\begin{enumerate}
\item A finite locally free $\mathcal{O}$-module $\mathcal{F}$ is said
to have {\it rank $r$} if for every object $U$ of $\mathcal{C}$ there
exists a covering $\{U_i \to U\}$ of $U$ such that $\mathcal{F}|_{U_i}$
is isomorphic to $\mathcal{O}_{U_i}^{\oplus r}$ as an
$\mathcal{O}_{U_i}$-module.
\item An {\it invertible $\mathcal{O}$-module} is a finite locally
free $\mathcal{O}$-module of rank $1$.
\item The sheaf {\it $\mathcal{O}^*$} is the subsheaf of
$\mathcal{O}$ defined by the rule
$$
U \longmapsto \mathcal{O}^*(U) = \{f \in \mathcal{O}(U) \mid
\exists g \in \mathcal{O}(U)\text{ such that }fg = 1\}
$$
It is a sheaf of abelian groups with multiplication as the group law.
\end{enumerate}
\end{definition}

\begin{lemma}
\label{lemma-constructions-invertible}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed space.
\begin{enumerate}
\item If $\mathcal{L}$, $\mathcal{N}$ are invertible
$\mathcal{O}$-modules, then so is
$\mathcal{L} \otimes_\mathcal{O} \mathcal{N}$.
\item If $\mathcal{L}$ is an invertible
$\mathcal{O}$-modules, then so is
$\mathcal{L}^{\otimes -1}
= \textit{Hom}_\mathcal{O}(\mathcal{L}, \mathcal{O})$.
\item If $\mathcal{L}$ is an invertible
$\mathcal{O}$-module, then the evaluation map
$\mathcal{L} \otimes_\mathcal{O} \mathcal{L}^{\otimes -1}
\to \mathcal{O}$ is an isomorphism.
\end{enumerate}
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-pic-set}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed space.
There exists a set of invertible modules $\{\mathcal{L}_i\}_{i \in I}$
such that each invertible module on $(\mathcal{C}, \mathcal{O})$
is isomorphic to exactly one of the $\mathcal{L}_i$.
\end{lemma}

\begin{proof}
Omitted, but see Sheaves of Modules, Lemma \ref{modules-lemma-pic-set}.
\end{proof}

\noindent
This lemma says roughly speaking that the collection of
isomorphism classes of invertible sheaves forms a set.
Lemma \ref{lemma-constructions-invertible} says that
tensor product defines the structure of an abelian group
on this set.

\begin{definition}
\label{definition-pic}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site.
The {\it Picard group} $\text{Pic}(\mathcal{O})$
the ringed site is the
abelian group whose elements are isomorphism classes of
invertible $\mathcal{O}$-modules, with addition
corresponding to tensor product.
\end{definition}









\section{Modules of differentials}
\label{section-differentials}

\noindent
In this section we briefly explain how to define the module of relative
differentials for a morphism of ringed topoi.
We suggest the reader take a look at the corresponding section
in the chapter on commutative algebra
(Algebra, Section \ref{algebra-section-differentials}).

\begin{definition}
\label{definition-derivation}
Let $\mathcal{C}$ be a site. Let $\varphi : \mathcal{O}_1 \to \mathcal{O}_2$
be a homomorphism of sheaves of rings. Let $\mathcal{F}$
be an $\mathcal{O}_2$-module. A {\it $\mathcal{O}_1$-derivation}
or more precisely a {\it $\varphi$-derivation} into $\mathcal{F}$
is a map $D : \mathcal{O}_2 \to \mathcal{F}$ which is additive, annihilates
the image of $\mathcal{O}_1 \to \mathcal{O}_2$, and satisfies the
{\it Leibniz rule}
$$
D(ab) = aD(b) + D(a)b
$$
for all $a, b$ local sections of $\mathcal{O}_2$
(wherever they are both defined). We denote
$\text{Der}_{\mathcal{O}_1}(\mathcal{O}_2, \mathcal{F})$
the set of $\varphi$-derivations into $\mathcal{F}$.
\end{definition}

\noindent
This is the sheaf theoretic analogue of
Algebra, Definition \ref{definition-derivation}.
Given a derivation $D : \mathcal{O}_2 \to \mathcal{F}$
as in the definition the map on global sections
$$
D : \Gamma(\mathcal{O}_2) \longrightarrow \Gamma(\mathcal{F})
$$
clearly is a $\Gamma(\mathcal{O}_1)$-derivation as in
the algebra definition. Note that if $\alpha : \mathcal{F} \to \mathcal{G}$
is a map of $\mathcal{O}_2$-modules, then there is an induced map
$$
\text{Der}_{\mathcal{O}_1}(\mathcal{O}_2, \mathcal{F})
\longrightarrow
\text{Der}_{\mathcal{O}_1}(\mathcal{O}_2, \mathcal{G})
$$
given by the rule $D \mapsto \alpha \circ D$. In other words
we obtain a functor.

\begin{lemma}
\label{lemma-universal-module}
Let $\mathcal{C}$ be a site. Let $\varphi : \mathcal{O}_1 \to \mathcal{O}_2$
be a homomorphism of sheaves of rings. The functor
$$
\textit{Mod}(\mathcal{O}_2) \longrightarrow \textit{Ab},\quad
\mathcal{F} \longmapsto \text{Der}_{\mathcal{O}_1}(\mathcal{O}_2, \mathcal{F})
$$
is representable.
\end{lemma}

\begin{proof}
This is proved in exactly the same way as the analogous statement in algebra.
During this proof, for any sheaf of sets $\mathcal{F}$ on $\mathcal{C}$,
let us denote
$$
\mathcal{O}_2[\mathcal{F}]
=
\bigoplus\nolimits_{U \in \text{Ob}(\mathcal{C}), s \in \mathcal{F}(U)}
j_{U!}(\mathcal{O}_2|_U).
$$
This is a sheaf of $\mathcal{O}_2$-modules.
If $\mathcal{F}$ is actually a sheaf of $\mathcal{O}_2$-modules, then there
is a canonical map
$$
c : \mathcal{O}_2[\mathcal{F}] \longrightarrow \mathcal{F}
$$
which maps the summand $j_{U!}(\mathcal{O}_2|_U)$ corresponding to
$s \in \mathcal{O}_2(U)$ into $\mathcal{F}$ by the map which is
adjoint to the map $\mathcal{O}_2|_U \to \mathcal{F}|_U$ determined by $s$.
We will employ the short hand $[s] \mapsto s$ to
describe this map and similarly for other maps below. OK, and now consider
the map of $\mathcal{O}_2$-modules
\begin{equation}
\label{equation-define-module-differentials}
\begin{matrix}
\mathcal{O}_2[\mathcal{O}_2 \times \mathcal{O}_2] \oplus
\mathcal{O}_2[\mathcal{O}_2 \times \mathcal{O}_2] \oplus
\mathcal{O}_2[\mathcal{O}_1] &
\longrightarrow &
\mathcal{O}_2[\mathcal{O}_2] \\
[(a, b)] \oplus [(f, g)] \oplus [h] & \longmapsto & [a + b] - [a] - [b] + \\
& & [fg] - g[f] - f[g] + \\
& & [\varphi(h)]
\end{matrix}
\end{equation}
with short hand notation as above. Set $\Omega_{\mathcal{O}_2/\mathcal{O}_1}$
equal to the cokernel of this map. Then it is clear that there exists
a map of sheaves of sets
$$
\text{d} : \mathcal{O}_2 \longrightarrow \Omega_{\mathcal{O}_2/\mathcal{O}_1}
$$
mapping a local section $f$ to the image of $[f]$ in
$\Omega_{\mathcal{O}_2/\mathcal{O}_1}$. By construction $\text{d}$
is a $\mathcal{O}_1$-derivation. Next, let $\mathcal{F}$
be a sheaf of $\mathcal{O}_2$-modules and let
$D : \mathcal{O}_2 \to \mathcal{F}$ be a $\mathcal{O}_1$-derivation.
Then we can define
$$
\alpha_D : \Omega_{\mathcal{O}_2/\mathcal{O}_1} \longrightarrow \mathcal{F}
$$
by setting $\alpha_D(f[g]) = fD(g)$ for local sections
$f, g$ of $\mathcal{O}_2$. It follows from the definition of a
derivation that this map annihilates sections in the image of the map
(\ref{equation-define-module-differentials}), so that we get the
desired map. Since it is clear that $\alpha_D \circ \text{d} = D$
the lemma is proved.
\end{proof}

\begin{definition}
\label{definition-module-differentials}
Let $\mathcal{C}$ be a site. Let $\varphi : \mathcal{O}_1 \to \mathcal{O}_2$
be a homomorphism of sheaves of rings. The {\it module of differentials}
of the ring map $\varphi$ is the object representing the functor
$\mathcal{F} \mapsto \text{Der}_{\mathcal{O}_1}(\mathcal{O}_2, \mathcal{F})$
which exists by Lemma \ref{lemma-universal-module}.
It is denoted $\Omega_{\mathcal{O}_2/\mathcal{O}_1}$, and the {\it universal
$\varphi$-derivation} is denoted
$\text{d} : \mathcal{O}_2 \to \Omega_{\mathcal{O}_2/\mathcal{O}_1}$.
\end{definition}

\noindent
Since this module and the derivation form the universal object representing
a functor, this notion is clearly intrinsic (i.e., does not depend
on the choice of the site underlying the ringed topos, see
Section \ref{section-intrinsic}).
Note that $\Omega_{\mathcal{O}_2/\mathcal{O}_1}$ is the cokernel of
the map (\ref{equation-define-module-differentials}) of
$\mathcal{O}_2$-modules. Moreover the map $\text{d}$ is described
by the rule that $\text{d}f$ is the image of the local section $[f]$.

\begin{lemma}
\label{lemma-localize-differentials}
Let $\mathcal{C}$ be a site. Let $\varphi : \mathcal{O}_1 \to \mathcal{O}_2$
be a homomorphism of sheaves of rings. For any object $U$ of $\mathcal{C}$
there is a canonical isomorphism
$$
\Omega_{\mathcal{O}_2/\mathcal{O}_1}|_U =
\Omega_{(\mathcal{O}_2|_U)/(\mathcal{O}_1|_U)}
$$
compatible with universal derivations.
\end{lemma}

\begin{proof}
Let us denote $j : \mathcal{C}/U \to \mathcal{C}$ the usual localization
functor. We are trying to show that
$j^{-1}\Omega_{\mathcal{O}_2/\mathcal{O}_1} =
\Omega_{j^{-1}\mathcal{O}_2/j^{-1}\mathcal{O}_1}$.
Note that on the one hand
$$
\text{Hom}_{j^{-1}\mathcal{O}_2}
(j^{-1}\Omega_{\mathcal{O}_2/\mathcal{O}_1}, \mathcal{F}) =
\text{Hom}_{\mathcal{O}_2}
(\Omega_{\mathcal{O}_2/\mathcal{O}_1}, j_*\mathcal{F}) =
\text{Der}_{\mathcal{O}_1}(\mathcal{O}_2, j_*\mathcal{F})
$$
and on the other hand
$$
\text{Hom}_{j^{-1}\mathcal{O}_2}
(\Omega_{j^{-1}\mathcal{O}_2/j^{-1}\mathcal{O}_1}, \mathcal{F}) =
\text{Der}_{j^{-1}\mathcal{O}_1}(j^{-1}\mathcal{O}_2, \mathcal{F})
$$
Hence we have to show that
$\text{Der}_{\mathcal{O}_1}(\mathcal{O}_2, j_*\mathcal{F}) =
\text{Der}_{j^{-1}\mathcal{O}_1}(j^{-1}\mathcal{O}_2, \mathcal{F})$.
By adjunction there is a natural identification
$$
\text{Mor}_{\textit{Sh}(\mathcal{C})}(\mathcal{O}_2, j_*\mathcal{F}) =
\text{Mor}_{\textit{Sh}(\mathcal{C}/U)}(j^{-1}\mathcal{O}_2, \mathcal{F})
$$
and it suffices to prove that $\mathcal{O}_1$-derivations on the
left hand side correspond to $j^{-1}\mathcal{O}_1$-derivations on the
right hand side and vice versa. We omit the verification that this is so.
\end{proof}

\noindent
Here is a particular situation where derivations come up
naturally.

\begin{lemma}
\label{lemma-double-structure-gives-derivation}
Let $\mathcal{C}$ be a site. Let $\varphi : \mathcal{O}_1 \to \mathcal{O}_2$
be a homomorphism of sheaves of rings.
Consider a short exact sequence
$$
0 \to \mathcal{F} \to \mathcal{A} \to \mathcal{O}_2 \to 0
$$
Here $\mathcal{A}$ is a sheaf of $\mathcal{O}_1$-algebras,
$\pi : \mathcal{A} \to \mathcal{O}_2$ is a surjection
of sheaves of $\mathcal{O}_1$-algebras, and
$\mathcal{F} = \text{Ker}(\pi)$ is its kernel. Assume $\mathcal{F}$ an ideal
sheaf with square zero in $\mathcal{A}$. So $\mathcal{F}$
has a natural structure of an $\mathcal{O}_2$-module.
A section $s : \mathcal{O}_2 \to \mathcal{A}$ of $\pi$
is a $\mathcal{O}_1$-algebra map such that $\pi \circ s = \text{id}$.
Given any section $s : \mathcal{O}_2 \to \mathcal{F}$
of $\pi$ and any $\varphi$-derivation $D : \mathcal{O}_1 \to \mathcal{F}$
the map
$$
s + D : \mathcal{O}_1 \to \mathcal{A}
$$
is a section of $\pi$ and every section $s'$ is of the form $s + D$
for a unique $\varphi$-derivation $D$.
\end{lemma}

\begin{proof}
Recall that the $\mathcal{O}_2$-module structure on $\mathcal{F}$
is given by $h \tau = \tilde h \tau$ (multiplication in $\mathcal{A}$)
where $h$ is a local section of $\mathcal{O}_2$, and
$\tilde h$ is a local lift of $h$ to a local
section of $\mathcal{A}$, and $\tau$ is a local section of $\mathcal{F}$.
In particular, given $s$, we may use $\tilde h = s(h)$.
To verify that $s + D$ is a homomorphism of sheaves of rings we
compute
\begin{eqnarray*}
(s + D)(ab) & = & s(ab) + D(ab) \\
& = & s(a)s(b) + aD(b) + D(a)b \\
& = & s(a) s(b) + s(a)D(b) + D(a)s(b) \\
& = & (s(a) + D(a))(s(b) + D(b))
\end{eqnarray*}
by the Leibniz rule. In the same manner one shows
$s + D$ is a $\mathcal{O}_1$-algebra map because $D$ is
an $\mathcal{O}_1$-derivation. Conversely, given $s'$ we set
$D = s' - s$. Details omitted.
\end{proof}

\begin{definition}
\label{definition-sheaf-differentials}
Let $X = (\textit{Sh}(\mathcal{C}), \mathcal{O})$ and
$Y = (\textit{Sh}(\mathcal{C}'), \mathcal{O}')$ be ringed topoi.
Let $(f, f^\sharp) : X \to Y$ be a morphism of ringed topoi.
In this situation
\begin{enumerate}
\item for a sheaf $\mathcal{F}$ of $\mathcal{O}$-modules a
{\it $Y$-derivation} $D : \mathcal{O} \to \mathcal{F}$ is just a
$f^\sharp$-derivation, and
\item the {\it sheaf of differentials $\Omega_{X/Y}$ of $X$ over $Y$}
is the module of differentials of
$f^\sharp : f^{-1}\mathcal{O}' \to \mathcal{O}$,
see Definition \ref{definition-module-differentials}.
\end{enumerate}
Thus $\Omega_{X/Y}$ comes equipped with a {\it universal $Y$-derivation}
$\text{d}_{X/Y} : \mathcal{O} \longrightarrow \Omega_{X/Y}$.
\end{definition}

\noindent
Recall that $f^\sharp : f^{-1}\mathcal{O}' \to \mathcal{O}$ so that
this definition makes sense.

\begin{lemma}
\label{lemma-functoriality-differentials}
Let
$X = (\textit{Sh}(\mathcal{C}_X), \mathcal{O}_X)$,
$Y = (\textit{Sh}(\mathcal{C}_Y), \mathcal{O}_Y)$,
$X' = (\textit{Sh}(\mathcal{C}_{X'}), \mathcal{O}_{X'})$, and
$Y' = (\textit{Sh}(\mathcal{C}_{Y'}), \mathcal{O}_{Y'})$ be ringed topoi.
Let
$$
\xymatrix{
X' \ar[d] \ar[r]_f & X \ar[d] \\
Y' \ar[r] & Y
}
$$
be a commutative diagram of morphisms of ringed topoi. The map
$f^\sharp : \mathcal{O}_X \to f_*\mathcal{O}_{X'}$ composed with the map
$f_*\text{d}_{X'/Y'} : f_*\mathcal{O}_{X'} \to f_*\Omega_{X'/Y'}$ is a
$Y$-derivation. Hence we obtain a canonical map of $\mathcal{O}_X$-modules
$\Omega_{X/Y} \to f_*\Omega_{X'/Y'}$, and by
adjointness of $f_*$ and $f^*$ a
canonical $\mathcal{O}_{X'}$-module homomorphism
$$
c_f : f^*\Omega_{X/Y} \longrightarrow \Omega_{X'/Y'}.
$$
It is uniquely characterized by the property that
$f^*\text{d}_{X/Y}(t)$ mapsto $\text{d}_{X'/Y'}(f^* t)$
for any local section $t$ of $\mathcal{O}_X$.
\end{lemma}

\begin{proof}
This is clear except for the last assertion. Let us explain the meaning of
this. Let $U \in \text{Ob}(\mathcal{C}_X)$ and let $t \in \mathcal{O}_X(U)$.
This is what it means for $t$ to be a local section of $\mathcal{O}_X$.
Now, we may think of $t$ as a map of sheaves of sets
$t : h_U^\# \to \mathcal{O}_X$. Then
$f^{-1}t : f^{-1}h_U^\# \to f^{-1}\mathcal{O}_X$. By $f^*t$ we mean
the composition
$$
\xymatrix{
f^{-1}h_U^\# \ar[rr]^{f^{-1}t} \ar@/^4ex/[rrrr]^{f^*t} & &
f^{-1}\mathcal{O}_X \ar[rr]^{f^\sharp} & &
\mathcal{O}_{X'}
}
$$
Note that $\text{d}_{X/Y}(t) \in \Omega_{X/Y}(U)$. Hence we may think of
$\text{d}_{X/Y}(t)$ as a map $\text{d}_{X/Y}(t) : h_U^\# \to \Omega_{X/Y}$.
Then $f^{-1}\text{d}_{X/Y}(t) : f^{-1}h_U^\# \to f^{-1}\Omega_{X/Y}$.
By $f^*\text{d}_{X/Y}(t)$ we mean the composition
$$
\xymatrix{
f^{-1}h_U^\#
\ar[rr]^{f^{-1}\text{d}_{X/Y}(t)}
\ar@/^4ex/[rrrr]^{f^*\text{d}_{X/Y}(t)} & &
f^{-1}\Omega_{X/Y} \ar[rr]^{1 \otimes \text{id}} & &
f^*\Omega_{X/Y}
}
$$
OK, and now the statement of the lemma means that we have
$$
c_f \circ f^*t = f^*\text{d}_{X/Y}(t)
$$
as maps from $f^{-1}h_U^\#$ to $\Omega_{X'/Y'}$. We omit the verification
that this property holds for $c_f$ as defined in the lemma. (Hint: The first
map $c'_f : \Omega_{X/Y} \to f_*\Omega_{X'/Y'}$ satisfies
$c'_f(\text{d}_{X/Y}(t)) = f_*\text{d}_{X'/Y'}(f^\sharp(t))$ as sections of
$f_*\Omega_{X'/Y'}$ over $U$, and you have to
turn this into the equality above by using adjunction.)
The reason that this uniquely characterizes $c_f$ is that the images
of $f^*\text{d}_{X/Y}(t)$ generate the $\mathcal{O}_{X'}$-module
$f^*\Omega_{X/Y}$ simply because the local sections $\text{d}_{X/Y}(t)$
generate the $\mathcal{O}_X$-module $\Omega_{X/Y}$.
\end{proof}









\section{Stalks of modules}
\label{section-stalks}

\noindent
We have to be a bit careful when taking stalks at points,
since the colimit defining a stalk (see
Sites, Equation \ref{sites-equation-stalk})
may not be filtered\footnote{Of course in almost any naturally occurring
case the colimit is filtered and some of the discussion in this section
may be simplified.}. On the other hand, by definition of a point of a site
the stalk functor is exact and commutes with arbitrary colimits.
In other words, it behaves exactly as if the colimit were filtered.

\begin{lemma}
\label{lemma-stalk-exact}
Let $\mathcal{C}$ be a site.
Let $p$ be a point of $\mathcal{C}$.
\begin{enumerate}
\item We have $(\mathcal{F}^\#)_p = \mathcal{F}_p$
for any presheaf of sets on $\mathcal{C}$.
\item The stalk functor
$\textit{Sh}(\mathcal{C}) \to \textit{Sets}$,
$\mathcal{F} \mapsto \mathcal{F}_p$ is exact (see
Categories, Definition \ref{categories-definition-exact})
and commute with arbitrary colimits.
\item The stalk functor
$\textit{PSh}(\mathcal{C}) \to \textit{Sets}$,
$\mathcal{F} \mapsto \mathcal{F}_p$ is exact (see
Categories, Definition \ref{categories-definition-exact})
and commute with arbitrary colimits.
\end{enumerate}
\end{lemma}

\begin{proof}
By
Sites, Lemma \ref{sites-lemma-point-pushforward-sheaf}
we have (1).
By
Sites, Lemmas \ref{sites-lemma-adjoint-point-push-stalk}
we see that
$\textit{PSh}(\mathcal{C}) \to \textit{Sets}$,
$\mathcal{F} \mapsto \mathcal{F}_p$ is a left adjoint,
and by
Sites, Lemma \ref{sites-lemma-point-pushforward-sheaf}
we see the same thing for
$\textit{PSh}(\mathcal{C}) \to \textit{Sets}$,
$\mathcal{F} \mapsto \mathcal{F}_p$.
Hence the stalk functor commutes with arbitrary colimits (see
Categories, Lemma \ref{categories-lemma-adjoint-exact}).
It follows from the definition of a point of a site, see
Sites, Definition \ref{sites-definition-point}
that $\textit{Sh}(S_{etale}) \to \textit{Sets}$,
$\mathcal{F} \mapsto \mathcal{F}_p$
is exact. Since sheafification is exact
(Sites, Lemma \ref{sites-lemma-sheafification-exact})
it follows that $\textit{PSh}(S_{etale}) \to \textit{Sets}$,
$\mathcal{F} \mapsto \mathcal{F}_p$
is exact.
\end{proof}

\noindent
In particular, since the stalk functor $\mathcal{F} \mapsto \mathcal{F}_p$
on presheaves commutes with all finite limits and colimits we may apply the
reasoning of the proof of
Sites,
Proposition \ref{sites-proposition-functoriality-algebraic-structures-topoi}.
The result of such an argument is that if $\mathcal{F}$ is a
(pre)sheaf of algebraic structures listed in
Sites,
Proposition \ref{sites-proposition-functoriality-algebraic-structures-topoi}
then the stalk $\mathcal{F}_p$ is naturally an algebraic structure
of the same kind. Let us explain this in detail when $\mathcal{F}$
is an abelian presheaf. In this case the addition map
$+ : \mathcal{F} \times \mathcal{F} \to \mathcal{F}$ induces
a map
$$
+ :
\mathcal{F}_p \times \mathcal{F}_p
=
(\mathcal{F} \times \mathcal{F})_p
\longrightarrow
\mathcal{F}_p
$$
where the equal sign uses that stalk functor on presheaves of sets
commutes with finite limits. This defines a group structure on
the stalk $\mathcal{F}_p$. In this way we obtain
our stalk functor
$$
\textit{PAb}(\mathcal{C}) \longrightarrow \textit{Ab}, \quad
\mathcal{F} \longmapsto \mathcal{F}_p
$$
By construction the underlying set of $\mathcal{F}_p$ is the stalk of the
underlying presheaf of sets. This also defines our stalk functor for
sheaves of abelian groups by precomposing with the inclusion
$\textit{Ab}(\mathcal{C}) \subset \textit{PAb}(\mathcal{C})$.

\begin{lemma}
\label{lemma-stalk-exact-abelian}
Let $\mathcal{C}$ be a site.
Let $p$ be a point of $\mathcal{C}$.
\begin{enumerate}
\item The functor
$\textit{Ab}(\mathcal{C}) \to \textit{Ab}$,
$\mathcal{F} \mapsto \mathcal{F}_p$ is exact.
\item The stalk functor
$\textit{PAb}(\mathcal{C}) \to \textit{Ab}$,
$\mathcal{F}  \mapsto  \mathcal{F}_p$
is exact.
\item For $\mathcal{F} \in \text{Ob}(\textit{PAb}(\mathcal{C}))$
we have $\mathcal{F}_p = \mathcal{F}^\#_p$.
\end{enumerate}
\end{lemma}

\begin{proof}
This is formal from the results of
Lemma \ref{lemma-stalk-exact}
and the construction of the stalk functor above.
\end{proof}

\noindent
Next, we turn to the case of sheaves of modules.
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site.
(It suffices for the discussion that $\mathcal{O}$ be a presheaf
of rings.)
Let $\mathcal{F}$ be a presheaf of $\mathcal{O}$-modules.
Let $p$ be a point of $\mathcal{C}$. In this case we get a map
$$
\cdot :
\mathcal{O}_p \times \mathcal{O}_p
=
(\mathcal{O} \times \mathcal{O})_p
\longrightarrow
\mathcal{O}_p
$$
which is the stalk of the multiplication map and
$$
\cdot :
\mathcal{O}_p \times \mathcal{F}_p
=
(\mathcal{O} \times \mathcal{F})_p
\longrightarrow
\mathcal{F}_p
$$
which is the stalk of the multiplication map. We omit the verification
that this defines a ring structure on $\mathcal{O}_p$ and an
$\mathcal{O}_p$-module structure on $\mathcal{F}_p$.
In this way we obtain a functor
$$
\textit{PMod}(\mathcal{O}) \longrightarrow \textit{Mod}(\mathcal{O}_p), \quad
\mathcal{F} \longmapsto \mathcal{F}_p
$$
By construction the underlying set of $\mathcal{F}_p$ is the stalk of the
underlying presheaf of sets. This also defines our stalk functor for
sheaves of $\mathcal{O}$-modules by precomposing with the inclusion
$\textit{Mod}(\mathcal{O}) \subset \textit{PMod}(\mathcal{O})$.

\begin{lemma}
\label{lemma-stalk-exact-modules}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site.
Let $p$ be a point of $\mathcal{C}$.
\begin{enumerate}
\item The functor
$\textit{Mod}(\mathcal{O}) \to \textit{Mod}(\mathcal{O}_p)$,
$\mathcal{F} \mapsto \mathcal{F}_p$ is exact.
\item The stalk functor
$\textit{PMod}(\mathcal{O}) \to \textit{Mod}(\mathcal{O}_p)$,
$\mathcal{F} \mapsto \mathcal{F}_p$
is exact.
\item For $\mathcal{F} \in \text{Ob}(\textit{PMod}(\mathcal{O}))$
we have $\mathcal{F}_p = \mathcal{F}^\#_p$.
\end{enumerate}
\end{lemma}

\begin{proof}
This is formal from the results of
Lemma \ref{lemma-stalk-exact-abelian},
the construction of the stalk functor above, and
Lemma \ref{lemma-abelian}.
\end{proof}









\section{Locally ringed topoi}
\label{section-locally-ringed}


\noindent
A reference for this section is
\cite[Expos\'e IV, Exercice 13.9]{SGA4}.

\begin{lemma}
\label{lemma-locally-ringed}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. The following
are equivalent
\begin{enumerate}
\item For every object $U$ of $\mathcal{C}$ and $f \in \mathcal{O}(U)$
there exists a covering $\{U_j \to U\}$ such that for each $j$
either $f|_{U_j}$ is invertible or $(1 - f)|_{U_j}$ is invertible.
\item For every object $U$ of $\mathcal{C}$ and
$f_1, \ldots, f_n \in \mathcal{O}(U)$ which generate the unit ideal
in $\mathcal{O}(U)$  there exists a covering $\{U_j \to U\}$
such that for each $j$ there exists an $i$ such that $f_i|_{U_j}$
is invertible.
\item The map of sheaves of sets
$$
(\mathcal{O} \times \mathcal{O})
\amalg
(\mathcal{O} \times \mathcal{O})
\longrightarrow
\mathcal{O} \times \mathcal{O}
$$
which maps $(f, a)$ in the first component to $(f, af)$ and
$(f, b)$ in the second component to $(f, b(1 - f))$ is surjective.
\end{enumerate}
\end{lemma}

\begin{proof}
It is clear that (2) implies (1). To show that (1) implies (2) we argue by
induction on $n$. The first case is $n = 2$ (since $n = 1$ is trivial).
In this case we have $a_1f_1 + a_2f_2 = 1$ for some
$a_1, a_2 \in \mathcal{O}(U)$. By assumption we can find a covering
$\{U_j \to U\}$ such that for each $j$
either $a_1f_1|_{U_j}$ is invertible or $a_2f_2|_{U_j}$ is invertible.
Hence either $f_1|_{U_j}$ is invertible or $f_2|_{U_j}$ is invertible
as desired. For $n > 2$ we have
$a_1f_1 + \ldots + a_nf_n = 1$ for some $a_1, \ldots, a_n \in \mathcal{O}(U)$. 
By the case $n = 2$ we see that we have some covering $\{U_j \to U\}_{j \in J}$
such that for each $j$ either $f_n|_{U_j}$ is invertible or
$a_1f_1 + \ldots + a_{n - 1}f_{n - 1}|_{U_j}$ is invertible.
Say the first case happens for $j \in J_n$. Set $J' = J \setminus J_n$.
By induction hypothesis, for each $j \in J'$ we can find a covering
$\{U_{jk} \to U_j\}_{k \in K_j}$ such that for each $k \in K_j$ there
exists an $i \in \{1, \ldots, n - 1\}$ such that 
$f_i|_{U_{jk}}$ is invertible. By the axioms of a site the family of
morphisms
$\{U_j \to U\}_{j \in J_n} \cup \{U_{jk} \to U\}_{j \in J', k \in K_j}$
is a covering which has the desired property.

\medskip\noindent
Assume (1). To see that the map in (3) is surjective, let
$(f, c)$ be a section of $\mathcal{O} \times \mathcal{O}$ over $U$.
By assumption there exists a covering $\{U_j \to U\}$ such that
for each $j$ either $f$ or $1 - f$ restricts to an invertible section.
In the first case we can take $a = c|_{U_j} (f|_{U_j})^{-1}$, and
in the second case we can take $b = c|_{U_j} (1 - f|_{U_j})^{-1}$.
Hence $(f, c)$ is in the image of the map on each of the members.
Conversely, assume (3) holds. For any $U$ and $f \in \mathcal{O}(U)$
there exists a covering $\{U_j \to U\}$ of $U$ such that the
section $(f, 1)|_{U_j}$ is in the image of the map in (3) on sections
over $U_j$. This means precisely that either $f$ or $1 - f$ restricts
to an invertible section over $U_j$, and we see that (1) holds.
\end{proof}

\begin{lemma}
\label{lemma-locally-ringed-stalk}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site.
Consider the following conditions
\begin{enumerate}
\item For every object $U$ of $\mathcal{C}$ and $f \in \mathcal{O}(U)$
there exists a covering $\{U_j \to U\}$ such that for each $j$
either $f|_{U_j}$ is invertible or $(1 - f)|_{U_j}$ is invertible.
\item For every point $p$ of $\mathcal{C}$ the stalk $\mathcal{O}_p$
is either the zero ring or a local ring.
\end{enumerate}
We always have (1) $\Rightarrow$ (2). If $\mathcal{C}$ has enough points
then (1) and (2) are equivalent.
\end{lemma}

\begin{proof}
Assume (1). Let $p$ be a point of $\mathcal{C}$ given by a functor
$u : \mathcal{C} \to \textit{Sets}$. Let
$f_p \in \mathcal{O}_p$. Since $\mathcal{O}_p$ is computed by
Sites, Equation (\ref{sites-equation-stalk})
we may represent $f_p$ by a triple
$(U, x, f)$ where $x \in U(U)$ and $f \in \mathcal{O}(U)$.
By assumption there exists a covering $\{U_i \to U\}$
such that for each $i$ either $f$ or $1 - f$ is invertible
on $U_i$. Because $u$ defines a point of the site we see that
for some $i$ there exists an $x_i \in u(U_i)$ which maps to
$x \in u(U)$. By the discussion surrounding
Sites, Equation (\ref{sites-equation-stalk})
we see that $(U, x, f)$ and $(U_i, x_i, f|_{U_i})$ define the
same element of $\mathcal{O}_p$. Hence we conclude that
either $f_p$ or $1 - f_p$ is invertible. Thus
$\mathcal{O}_p$ is a ring such that for every element $a$
either $a$ or $1 - a$ is invertible. This means that $\mathcal{O}_p$
is either zero or a local ring, see
Algebra, Lemma \ref{algebra-lemma-characterize-local-ring}.

\medskip\noindent
Assume (2) and assume that $\mathcal{C}$ has enough points.
Consider the map of sheaves of sets
$$
\mathcal{O} \times \mathcal{O} \amalg \mathcal{O} \times \mathcal{O}
\longrightarrow
\mathcal{O} \times \mathcal{O}
$$
of
Lemma \ref{lemma-locally-ringed} part (3). For any local ring $R$
the corresponding map
$(R \times R) \amalg (R \times R) \to R \times R$
is surjective, see for example
Algebra, Lemma \ref{algebra-lemma-characterize-local-ring}.
Since each $\mathcal{O}_p$ is a local ring or zero the map is
surjective on stalks. Hence, by our assumption that $\mathcal{C}$
has enough points it is surjective and we win.
\end{proof}

\noindent
In
Modules, Section \ref{modules-section-pathology}
we pointed out how in a ringed space $(X, \mathcal{O}_X)$
there can be an open subspace over which the structure sheaf is zero.
To prevent this we can require the sections $1$ and $0$ to have different
values in every stalk of the space $X$. In the setting of ringed topoi
and ringed sites the condition is that
\begin{equation}
\label{equation-one-is-never-zero}
\emptyset^\# \longrightarrow
\text{Equalizer}(0, 1 : * \longrightarrow \mathcal{O})
\end{equation}
is an isomorphism of sheaves. Here $*$ is the singleton sheaf,
resp.\ $\emptyset^\#$ is the ``empty sheaf'',
i.e., the final, resp.\ initial object in the category of sheaves, see
Sites, Example \ref{sites-example-singleton-sheaf},
resp.\ Section \ref{sites-section-almost-cocontinuous}.
In other words, the condition is that whenever $U \in \text{Ob}(\mathcal{C})$
is not sheaf theoretically empty, then $1, 0 \in \mathcal{O}(U)$ are not
equal. Let us state the obligatory lemma.

\begin{lemma}
\label{lemma-ringed-stalk-not-zero}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Consider the statements
\begin{enumerate}
\item (\ref{equation-one-is-never-zero}) is an isomorphism, and
\item for every point $p$ of $\mathcal{C}$ the stalk $\mathcal{O}_p$
is not the zero ring.
\end{enumerate}
We always have (1) $\Rightarrow$ (2) and if $\mathcal{C}$ has enough points
then (1) $\Leftrightarrow$ (2).
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\noindent
Lemmas \ref{lemma-locally-ringed},
\ref{lemma-locally-ringed-stalk}, and
\ref{lemma-ringed-stalk-not-zero}
motivate the following definition.

\begin{definition}
\label{definition-locally-ringed}
A ringed site $(\mathcal{C}, \mathcal{O})$ is said to be
{\it locally ringed site} if (\ref{equation-one-is-never-zero})
is an isomorphism, and the equivalent properties of
Lemma \ref{lemma-locally-ringed}
are satisfied.
\end{definition}

\noindent
In \cite[Expos\'e IV, Exercice 13.9]{SGA4} the condition that
(\ref{equation-one-is-never-zero}) be an isomorphism is missing leading to
a slightly different notion of a locally ringed site and locally ringed
topos. As we are motivated by the notion of a locally ringed space we decided
to add this condition (see explanation above).

\begin{lemma}
\label{lemma-locally-ringed-intrinsic}
Being a locally ringed site is an intrinsic property.
More precisely,
\begin{enumerate}
\item if $f : \textit{Sh}(\mathcal{C}') \to \textit{Sh}(\mathcal{C})$
is a morphism of topoi and $(\mathcal{C}, \mathcal{O})$ is
a locally ringed site, then $(\mathcal{C}', f^{-1}\mathcal{O})$
is a locally ringed site, and
\item if
$(f, f^\sharp) : (\textit{Sh}(\mathcal{C}'), \mathcal{O}')
\to (\textit{Sh}(\mathcal{C}), \mathcal{O})$
is an equivalence of ringed topoi, then
$(\mathcal{C}, \mathcal{O})$ is locally ringed if and only if
$(\mathcal{C}', \mathcal{O}')$
is locally ringed.
\end{enumerate}
\end{lemma}

\begin{proof}
It is clear that (2) follows from (1). To prove (1) note that
as $f^{-1}$ is exact we have $f^{-1}* = *$,
$f^{-1}\emptyset^\# = \emptyset^\#$, and $f^{-1}$ commutes with
products, equalizers and transforms isomorphisms and surjections
into isomorphisms and surjections. Thus $f^{-1}$ transforms the
isomorphism (\ref{equation-one-is-never-zero}) into
its analogue for $f^{-1}\mathcal{O}$ and transforms the surjection of
Lemma \ref{lemma-locally-ringed} part (3)
into the corresponding surjection for $f^{-1}\mathcal{O}$.
\end{proof}

\noindent
In fact
Lemma \ref{lemma-locally-ringed-intrinsic} part (2)
is the analogue of
Schemes, Lemma \ref{schemes-lemma-isomorphism-locally-ringed}.
It assures us that the following definition makes sense.

\begin{definition}
\label{definition-locally-ringed-topos}
A ringed topos $(\textit{Sh}(\mathcal{C}), \mathcal{O})$ is said to be
{\it locally ringed} if the underlying ringed site
$(\mathcal{C}, \mathcal{O})$ is locally ringed.
\end{definition}

\noindent
Next, we want to work out what it means to have a morphism of locally ringed
spaces. In order to do this we have the following lemma.

\begin{lemma}
\label{lemma-locally-ringed-morphism}
Let
$(f, f^\sharp) : (\textit{Sh}(\mathcal{C}), \mathcal{O}_{\mathcal{C}})
\to (\textit{Sh}(\mathcal{D}), \mathcal{O}_{\mathcal{D}})$
be a morphism of ringed topoi.
Consider the following conditions
\begin{enumerate}
\item The diagram of sheaves
$$
\xymatrix{
f^{-1}(\mathcal{O}^*_{\mathcal{D}}) \ar[r]_-{f^\sharp} \ar[d] &
\mathcal{O}^*_{\mathcal{C}} \ar[d] \\
f^{-1}(\mathcal{O}_{\mathcal{D}}) \ar[r]^-{f^\sharp} &
\mathcal{O}_{\mathcal{C}}
}
$$
is cartesian.
\item For any point $p$ of $\mathcal{C}$, setting $q = f \circ p$,
the diagram
$$
\xymatrix{
\mathcal{O}^*_{\mathcal{D}, q} \ar[r] \ar[d] &
\mathcal{O}^*_{\mathcal{C}, p} \ar[d] \\
\mathcal{O}_{\mathcal{D}, q} \ar[r] &
\mathcal{O}_{\mathcal{C}, p}
}
$$
of sets is cartesian.
\end{enumerate}
We always have (1) $\Rightarrow$ (2). If $\mathcal{C}$ has enough points
then (1) and (2) are equivalent. If
$(\textit{Sh}(\mathcal{C}), \mathcal{O}_{\mathcal{C}})$
and
$(\textit{Sh}(\mathcal{D}), \mathcal{O}_{\mathcal{D}})$
are locally ringed topoi then (2) is equivalent to
\begin{enumerate}
\item[(3)] For any point $p$ of $\mathcal{C}$, setting $q = f \circ p$,
the ring map $\mathcal{O}_{\mathcal{D}, q} \to \mathcal{O}_{\mathcal{C}, p}$
is a local ring map.
\end{enumerate}
In fact, properties (2), or (3) for a conservative
family of points implies (1).
\end{lemma}

\begin{proof}
This lemma proves itself, in other words, it follows by unwinding the
definitions.
\end{proof}

\begin{definition}
\label{definition-morphism-locally-ringed-topoi}
Let $(f, f^\sharp) : (\textit{Sh}(\mathcal{C}), \mathcal{O}_{\mathcal{C}})
\to (\textit{Sh}(\mathcal{D}), \mathcal{O}_{\mathcal{D}})$
be a morphism of ringed topoi. Assume
$(\textit{Sh}(\mathcal{C}), \mathcal{O}_{\mathcal{C}})$
and
$(\textit{Sh}(\mathcal{D}), \mathcal{O}_{\mathcal{D}})$
are locally ringed topoi. We say that $(f, f^\sharp)$ is a
{\it morphism of locally ringed topoi} if and only if the
diagram of sheaves
$$
\xymatrix{
f^{-1}(\mathcal{O}^*_{\mathcal{D}}) \ar[r]_-{f^\sharp} \ar[d] &
\mathcal{O}^*_{\mathcal{C}} \ar[d] \\
f^{-1}(\mathcal{O}_{\mathcal{D}}) \ar[r]^-{f^\sharp} &
\mathcal{O}_{\mathcal{C}}
}
$$
(see
Lemma \ref{lemma-locally-ringed-morphism})
is cartesian. If $(f, f^\sharp)$ is a morphism of ringed sites, then
we say that it is a {\it morphism of locally ringed sites} if
the associated morphism of ringed topoi is a morphism of locally ringed
topoi.
\end{definition}

\noindent
It is clear that an isomorphism of ringed topoi between locally ringed
topoi is automatically an isomorphism of locally ringed topoi.

\begin{lemma}
\label{lemma-composition-morphisms-locally-ringed-topoi}
Let
$(f, f^\sharp) :
(\textit{Sh}(\mathcal{C}_1), \mathcal{O}_1)
\to (\textit{Sh}(\mathcal{C}_2), \mathcal{O}_2)$ and
$(g, g^\sharp) :
(\textit{Sh}(\mathcal{C}_2), \mathcal{O}_2) \to
(\textit{Sh}(\mathcal{C}_3), \mathcal{O}_3)$
be morphisms of locally ringed topoi. Then the composition
$(g, g^\sharp) \circ (f, f^\sharp)$ (see
Definition \ref{definition-ringed-topos})
is also a morphism of locally ringed topoi.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-locally-ringed-intrinsic-morphism}
If $f : \textit{Sh}(\mathcal{C}') \to \textit{Sh}(\mathcal{C})$
is a morphism of topoi. If $\mathcal{O}$ is a sheaf of rings
on $\mathcal{C}$, then
$$
f^{-1}(\mathcal{O}^*) = (f^{-1}\mathcal{O})^*.
$$
In particular, if $\mathcal{O}$ turns $\mathcal{C}$ into a locally
ringed site, then setting $f^\sharp = \text{id}$
the morphism of ringed topoi
$$
(f, f^\sharp) :
(\textit{Sh}(\mathcal{C}'), f^{-1}\mathcal{O})
\to
(\textit{Sh}(\mathcal{C}, \mathcal{O})
$$
is a morphism of locally ringed topoi.
\end{lemma}

\begin{proof}
Note that the diagram
$$
\xymatrix{
\mathcal{O}^* \ar[rr] \ar[d]_{u \mapsto (u, u^{-1})} & &
{*} \ar[d]^{1} \\
\mathcal{O} \times \mathcal{O} \ar[rr]^-{(a, b) \mapsto ab} & &
\mathcal{O}
}
$$
is cartesian. Since $f^{-1}$ is exact we conclude that
$$
\xymatrix{
f^{-1}(\mathcal{O}^*)
\ar[d]_{u \mapsto (u, u^{-1})} \ar[rr] & &
{*} \ar[d]^{1} \\
f^{-1}\mathcal{O} \times f^{-1}\mathcal{O} \ar[rr]^-{(a, b) \mapsto ab} & &
f^{-1}\mathcal{O}
}
$$
is cartesian which implies the first assertion. For the second,
note that $(\mathcal{C}', f^{-1}\mathcal{O})$ is a locally ringed site
by
Lemma \ref{lemma-locally-ringed-intrinsic}
so that the assertion makes sense. Now the first part implies that
the morphism is a morphism of locally ringed topoi.
\end{proof}

\begin{lemma}
\label{lemma-localize-morphism-locally-ringed-topoi}
Localization of locally ringed sites and topoi.
\begin{enumerate}
\item Let $(\mathcal{C}, \mathcal{O})$ be a locally ringed site.
Let $U$ be an object of $\mathcal{C}$. Then the localization
$(\mathcal{C}/U, \mathcal{O}_U)$ is a locally ringed site, and
the localization morphism
$$
(j_U, j_U^\sharp) :
(\textit{Sh}(\mathcal{C}/U), \mathcal{O}_U)
\to
(\textit{Sh}(\mathcal{C}), \mathcal{O})
$$
is a morphism of locally ringed topoi.
\item Let $(\mathcal{C}, \mathcal{O})$ be a locally ringed site.
Let $f : V \to U$ be a morphism of $\mathcal{C}$.
Then the morphism
$$
(j, j^\sharp) : 
(\textit{Sh}(\mathcal{C}/V), \mathcal{O}_V)
\to
(\textit{Sh}(\mathcal{C}/U), \mathcal{O}_U)
$$
of
Lemma \ref{lemma-relocalize}
is a morphism of locally ringed topoi.
\item Let 
$(f, f^\sharp) :
(\mathcal{C}, \mathcal{O})
\longrightarrow
(\mathcal{D}, \mathcal{O}')$
be a morphism of locally ringed sites where $f$ is given by the continuous
functor $u : \mathcal{D} \to \mathcal{C}$. Let $V$ be an object of
$\mathcal{D}$ and let $U = u(V)$. Then the morphism
$$
(f', (f')^\sharp) :
(\textit{Sh}(\mathcal{C}/U), \mathcal{O}_U)
\to
(\textit{Sh}(\mathcal{D}/V), \mathcal{O}'_V)
$$
of
Lemma \ref{lemma-localize-morphism-ringed-sites}
is a morphism of locally ringed sites.
\item Let 
$(f, f^\sharp) :
(\mathcal{C}, \mathcal{O})
\longrightarrow
(\mathcal{D}, \mathcal{O}')$
be a morphism of locally ringed sites where $f$ is given by the continuous
functor $u : \mathcal{D} \to \mathcal{C}$. Let $V \in \text{Ob}(\mathcal{D})$,
$U \in \text{Ob}(\mathcal{C})$, and $c : U \to u(V)$. Then the morphism
$$
(f_c, (f_c)^\sharp) :
(\textit{Sh}(\mathcal{C}/U), \mathcal{O}_U)
\to
(\textit{Sh}(\mathcal{D}/V), \mathcal{O}'_V)
$$
of
Lemma \ref{lemma-relocalize-morphism-ringed-sites}
is a morphism of locally ringed topoi.
\item Let $(\textit{Sh}(\mathcal{C}), \mathcal{O})$ be a locally
ringed topos. Let $\mathcal{F}$ be a sheaf on $\mathcal{C}$.
Then the localization
$(\textit{Sh}(\mathcal{C})/\mathcal{F}, \mathcal{O}_{\mathcal{F}})$
is a locally ringed topos and the localization morphism
$$
(j_{\mathcal{F}}, j_{\mathcal{F}}^\sharp) :
(\textit{Sh}(\mathcal{C})/\mathcal{F}, \mathcal{O}_{\mathcal{F}})
\to
(\textit{Sh}(\mathcal{C}), \mathcal{O})
$$
is a morphism of locally ringed topoi.
\item  Let $(\textit{Sh}(\mathcal{C}), \mathcal{O})$ be a locally
ringed topos. Let $s : \mathcal{G} \to \mathcal{F}$ be a map of sheaves
on $\mathcal{C}$. Then the morphism
$$
(j, j^\sharp) :
(\textit{Sh}(\mathcal{C})/\mathcal{G}, \mathcal{O}_{\mathcal{G}})
\longrightarrow
(\textit{Sh}(\mathcal{C})/\mathcal{F}, \mathcal{O}_{\mathcal{F}})
$$
of
Lemma \ref{lemma-relocalize-ringed-topos}
is a morphism of locally ringed topoi.
\item Let
$f :
(\textit{Sh}(\mathcal{C}), \mathcal{O})
\longrightarrow
(\textit{Sh}(\mathcal{D}), \mathcal{O}')$
be a morphism of locally ringed topoi. Let $\mathcal{G}$ be a sheaf
on $\mathcal{D}$. Set $\mathcal{F} = f^{-1}\mathcal{G}$.
Then the morphism
$$
(f', (f')^\sharp) :
(\textit{Sh}(\mathcal{C})/\mathcal{F}, \mathcal{O}_{\mathcal{F}})
\longrightarrow
(\textit{Sh}(\mathcal{D})/\mathcal{G}, \mathcal{O}'_{\mathcal{G}})
$$
of
Lemma \ref{lemma-localize-morphism-ringed-topoi}
is a morphism of locally ringed topoi.
\item  Let
$f :
(\textit{Sh}(\mathcal{C}), \mathcal{O})
\longrightarrow
(\textit{Sh}(\mathcal{D}), \mathcal{O}')$
be a morphism of locally ringed topoi. Let $\mathcal{G}$ be a sheaf
on $\mathcal{D}$, let $\mathcal{F}$ be a sheaf on $\mathcal{C}$, and
let $s : \mathcal{F} \to f^{-1}\mathcal{G}$ be a morphism of sheaves.
Then the morphism
$$
(f_s, (f_s)^\sharp) :
(\textit{Sh}(\mathcal{C})/\mathcal{F}, \mathcal{O}_{\mathcal{F}})
\longrightarrow
(\textit{Sh}(\mathcal{D})/\mathcal{G}, \mathcal{O}'_{\mathcal{G}})
$$
of
Lemma \ref{lemma-relocalize-morphism-ringed-topoi}
is a morphism of locally ringed topoi.
\end{enumerate}
\end{lemma}

\begin{proof}
Part (1) is clear since $\mathcal{O}_U$ is just the
restriction of $\mathcal{O}$, so
Lemmas \ref{lemma-locally-ringed-intrinsic} and
\ref{lemma-locally-ringed-intrinsic-morphism}
apply. Part (2) is clear as the morphism $(j, j^\sharp)$
is actually a localization of a locally ringed site so (1) applies.
Part (3) is clear also since $(f')^\sharp$ is just the
restriction of $f^\sharp$ to the topos
$\textit{Sh}(\mathcal{C})/\mathcal{F}$, see proof of
Lemma \ref{lemma-localize-morphism-ringed-topoi}
(hence the diagram of
Definition \ref{definition-morphism-locally-ringed-topoi}
for the morphism $f'$ is just the restriction of the corresponding
diagram for $f$, and restriction is an exact functor).
Part (4) follows formally on combining (2) and (3).
Parts (5), (6), (7), and (8) follow from their counterparts
(1), (2), (3), and (4) by enlarging the sites as in
Lemma \ref{lemma-morphism-ringed-topoi-comes-from-morphism-ringed-sites}
and translating everything in terms of sites and morphisms of sites using
the comparisons of
Lemmas \ref{lemma-localize-compare},
\ref{lemma-relocalize-compare},
\ref{lemma-localize-morphism-compare}, and
\ref{lemma-relocalize-morphism-compare}.
(Alternatively one could use the same arguments as in the proofs
of (1), (2), (3), and (4) to prove (5), (6), (7), and (8) directly.)
\end{proof}





\input{chapters}

\bibliography{my}
\bibliographystyle{amsalpha}

\end{document}
