\input{preamble}

% OK, start here.
%
\begin{document}

\title{Modules on Sites}


\maketitle

\phantomsection
\label{section-phantom}

\tableofcontents

\section{Introduction}
\label{section-introduction}

\noindent
In this document we work out basic notions of sheaves of modules on
ringed topoi or ringed sites. We first work out some basic facts on
abelian sheaves. After this we introduce ringed sites and ringed topoi.
We work through some of the very basic notions on (pre)sheaves of
$\mathcal{O}$-modules, analogous to the material on (pre)sheaves of
$\mathcal{O}$-modules in the chapter on sheaves on spaces.
Having done this, we duplicate much of the discussion in the chapter on
sheaves of modules (see Modules, Section \ref{modules-section-introduction}).
Basic references are \cite{FAC}, \cite{EGA} and \cite{SGA4}.






\section{Abelian presheaves}
\label{section-abelian-pre-sheaves}

\noindent
Let $\mathcal{C}$ be a category.
Abelian presheaves were introduced in
Sites, Sections \ref{sites-section-presheaves}
and \ref{sites-section-sheaves} and discussed a bit more
in Sites, Section \ref{sites-section-sheaves-algebraic-structures}.
We will follow the convention of this last reference, in that we think
of an abelian presheaf as a presheaf of sets endowed with addition rules
on all sets of sections compatible with the restriction mappings.
Recall that the category of abelian presheaves on $\mathcal{C}$
is denoted $\textit{PAb}(\mathcal{C})$.

\medskip\noindent
The category $\textit{PAb}(\mathcal{C})$ is abelian as defined in
Homology, Definition \ref{homology-definition-abelian-category}.
Given a map of presheaves $\varphi : \mathcal{G}_1 \to \mathcal{G}_2$
the kernel of $\varphi$ is the abelian presheaf
$U \mapsto \text{Ker}(\mathcal{G}_1(U) \to \mathcal{G}_2(U))$ and
the cokernel of $\varphi$ is the presheaf
$U \mapsto \text{Coker}(\mathcal{G}_1(U) \to \mathcal{G}_2(U))$.
Since the category of abelian groups is abelian it follows that
$\text{Coim} = \text{Im}$ because this holds over each $U$.
A sequence of abelian presheaves
$$
\mathcal{G}_1 \longrightarrow
\mathcal{G}_2 \longrightarrow
\mathcal{G}_3
$$
is exact if and only if
$\mathcal{G}_1(U) \to \mathcal{G}_2(U) \to \mathcal{G}_3(U)$
is an exact sequence of abelian groups for all $U \in \text{Ob}(\mathcal{C})$.
We leave the verifications to the reader.

\begin{lemma}
\label{lemma-limits-colimits-abelian-presheaves}
Let $\mathcal{C}$ be a category.
\begin{enumerate}
\item All limits and colimits exist in $\textit{PAb}(\mathcal{C})$.
\item All limits and colimits commute with taking sections over objects of
$\mathcal{C}$.
\end{enumerate}
\end{lemma}

\begin{proof}
Let $\mathcal{I} \to \textit{PAb}(\mathcal{C})$, $i \mapsto \mathcal{F}_i$
be a diagram. We can simply define abelian presheaves
$L$ and $C$ by the rules
$$
L : U \longmapsto \text{lim}_i\ \mathcal{F}_i(U)
$$
and
$$
C : U \longmapsto \text{colim}_i\ \mathcal{F}_i(U).
$$
It is clear that there are maps of abelian presheaves $L \to \mathcal{F}_i$
and $\mathcal{F}_i \to C$, by using the corresponding maps on groups of
sections over each $U$. It is straightforward to check that $L$ and $C$ endowed
with these maps are the limit and colimit of the diagram in
$\textit{PAb}(\mathcal{C})$. This proves (1) and (2). Details omitted.
\end{proof}


\section{Abelian sheaves}
\label{section-abelian-sheaves}

\noindent
Let $\mathcal{C}$ be a site.
The category of abelian sheaves on $\mathcal{C}$ is denoted
$\textit{Ab}(\mathcal{C})$. It is the full subcategory of
$\textit{PAb}(\mathcal{C})$ consisting of those abelian presheaves
whose underlying presheaves of sets are sheaves.
Properties ($\alpha$) -- ($\zeta$) of
Sites, Section \ref{sites-section-sheaves-algebraic-structures}
hold, see
Sites,
Proposition \ref{sites-proposition-functoriality-algebraic-structures-topoi}.
In particular the inclusion functor
$\textit{Ab}(\mathcal{C}) \to \textit{PAb}(\mathcal{C})$
has a left adjoint, namely the sheafification functor
$\mathcal{G} \mapsto \mathcal{G}^\#$.

\medskip\noindent
We suggest the reader prove the lemma on a piece of scratch paper rather
than reading the proof.

\begin{lemma}
\label{lemma-abelian-abelian}
Let $\mathcal{C}$ be a site. Let $\varphi : \mathcal{F} \to \mathcal{G}$
be a morphism of abelian sheaves on $\mathcal{C}$.
\begin{enumerate}
\item The category $\textit{Ab}(\mathcal{C})$ is an abelian category.
\item The kernel $\text{Ker}(\varphi)$ of $\varphi$ is the same as the
kernel of $\varphi$ as a morphism of presheaves.
\item The morphism $\varphi$ is injective
(Homology, Definition \ref{homology-definition-injective-surjective})
if and only if $\varphi$ is injective as a map of presheaves
(Sites, Definition \ref{sites-definition-presheaves-injective-surjective}),
if and only if $\varphi$ is injective as a map of sheaves
(Sites, Definition \ref{sites-definition-sheaves-injective-surjective}).
\item The cokernel $\text{Coker}(\varphi)$ of $\varphi$ is the sheafification
of the cokernel of $\varphi$ as a morphism of presheaves.
\item The morphism $\varphi$ is surjective
(Homology, Definition \ref{homology-definition-injective-surjective})
if and only if $\varphi$ is surjective as a map of sheaves
(Sites, Definition \ref{sites-definition-sheaves-injective-surjective}).
\item A complex of abelian sheaves
$$
\mathcal{F} \to \mathcal{G} \to \mathcal{H}
$$
is exact at $\mathcal{G}$ if and only if for all
$U \in \text{Ob}(\mathcal{C})$ and all $s \in \mathcal{G}(U)$
mapping to zero in $\mathcal{H}(U)$ there exists a covering
$\{U_i \to U\}_{i \in I}$ in $\mathcal{C}$ such that each
$s|_{U_i}$ is in the image of $\mathcal{F}(U_i) \to \mathcal{G}(U_i)$.
\end{enumerate}
\end{lemma}

\begin{proof}
We claim that Homology, Lemma \ref{homology-lemma-adjoint-get-abelian}
applies to the categories $\mathcal{A} = \textit{Ab}(\mathcal{C})$
and $\mathcal{B} = \textit{PAb}(\mathcal{C})$, and the functors
$a : \mathcal{A} \to \mathcal{B}$ (inclusion),  and
$b : \mathcal{B} \to \mathcal{A}$ (sheafification).
Let us check the assumptions of
Homology, Lemma \ref{homology-lemma-adjoint-get-abelian}.
Assumption (1) is that $\mathcal{A}$, $\mathcal{B}$ are additive categories,
$a$, $b$ are additive functors, and $a$ is right adjoint to $b$.
The first two statements are clear and adjointness is
Sites, Section \ref{sites-section-sheaves-algebraic-structures} ($\epsilon$).
Assumption (2) says that $\textit{PAb}(\mathcal{C})$ is abelian
which we saw in Section \ref{section-abelian-pre-sheaves} and
that sheafification is left exact, which is
Sites, Section \ref{sites-section-sheaves-algebraic-structures} ($\zeta$).
The final assumption is that $ba \cong \text{id}_{\mathcal{A}}$ which is
Sites, Section \ref{sites-section-sheaves-algebraic-structures} ($\delta$).
Hence Homology, Lemma \ref{homology-lemma-adjoint-get-abelian}
applies and we conclude that $\textit{Ab}(\mathcal{C})$ is abelian.

\medskip\noindent
In the proof of Homology, Lemma \ref{homology-lemma-adjoint-get-abelian}
it is shown that $\text{Ker}(\varphi)$ and $\text{Coker}(\varphi)$
are equal to the sheafification of the kernel and cokernel of $\varphi$
as a morphism of abelian presheaves. This proves (4). Since the kernel
is a equalizer (i.e., a limit) and since sheafifcation commutes with
finite limits, we conclude that (2) holds.

\medskip\noindent
Statement (2) implies (3). Statement (4) implies (5) by our description
of sheafification. The characterization of exactness in (6) follows from
(2) and (5), and the fact that the sequence is exact if and only if
$\text{Im}(\mathcal{F} \to \mathcal{G}) =
\text{Ker}(\mathcal{G} \to \mathcal{H})$.
\end{proof}

\noindent
Another way to say part (6) of the lemma is that a
sequence of abelian sheaves
$$
\mathcal{F}_1 \longrightarrow
\mathcal{F}_2 \longrightarrow
\mathcal{F}_3
$$
is exact if and only if the sheafification of
$U \mapsto \mathcal{F}_2(U)/\mathcal{F}_1(U)$ is equal to the
kernel of $\mathcal{F}_2 \to \mathcal{F}_3$.

\begin{lemma}
\label{lemma-limits-colimits-abelian-sheaves}
Let $\mathcal{C}$ be a site.
\begin{enumerate}
\item All limits and colimits exist in $\textit{Ab}(\mathcal{C})$.
\item Limits are the same as the corresponding limits of abelian presheaves
over $\mathcal{C}$ (i.e., commute with taking sections over objects of
$\mathcal{C}$).
\item Finite direct sums are the same as the correponding finite direct sums
in the category of abelian pre-sheaves over $\mathcal{C}$.
\item A colimit is the sheafification of the corresponding colimit in
the category of abelian presheaves.
\end{enumerate}
\end{lemma}

\begin{proof}
By Lemma \ref{lemma-limits-colimits-abelian-presheaves} limits and colimits
of abelian presheaves exist, and are described by taking limits and colimits
on the level of sections over objects.

\medskip\noindent
Let $\mathcal{I} \to \textit{Ab}(\mathcal{C})$, $i \mapsto \mathcal{F}_i$
be a diagram. Let $\text{lim}_i \mathcal{F}_i$ be the limit of the diagram
as an abelian presheaf. By Sites, Lemma \ref{sites-lemma-limit-sheaf}
this is an abelian sheaf. Then it is quite easy to see that
$\text{lim}_i \mathcal{F}_i$ is the limit of the diagram in
$\textit{Ab}(\mathcal{C})$. This proves limits exist and (2) holds.

\medskip\noindent
By Categories, Lemma \ref{categories-lemma-adjoint-exact}, and because
sheafification is left adjoint to the inclusion functor we see that
$\text{colim}_i\ \mathcal{F}$ exists and is the sheafification of the colimit
in $\textit{PAb}(\mathcal{C})$. This proves colimits exist and (4) holds.

\medskip\noindent
Finite direct sums are the same thing as finite products in any abelian
category. Hence (3) follows from (2).
\end{proof}







\section{Free abelian presheaves}
\label{section-free-abelian-presheaf}

\noindent
In order to prepare notation for the following definition, let us agree
to denote the free abelian group on a set $S$ as\footnote{In other chapters
the notation $\mathbf{Z}[S]$ sometimes indicates the polynomial ring over
$\mathbf{Z}$ on $S$.}
$\mathbf{Z}[S] = \bigoplus_{s \in S} \mathbf{Z}$. It is characterized
by the property
$$
\text{Mor}_{\textit{Ab}}(\mathbf{Z}[S], A)
=
\text{Mor}_{\textit{Sets}}(S, A)
$$
In other words the construction $S \mapsto \mathbf{Z}[S]$ is a left adjoint
to the forgetful functor $\textit{Ab} \to \textit{Sets}$.

\begin{definition}
\label{definition-free-abelian-presheaf-on}
Let $\mathcal{C}$ be a category. Let $\mathcal{G}$ be a presheaf of sets.
The {\it free abelian presheaf} $\mathbf{Z}_{\mathcal{G}}$ on $\mathcal{G}$
is the abelian presheaf defined by the rule
$$
U \longmapsto \mathbf{Z}[\mathcal{G}(U)].
$$
In the special case $\mathcal{G} = h_X$ of a representable presheaf
associated to an object $X$ of $\mathcal{C}$
we use the notation $\mathbf{Z}_X = \mathbf{Z}_{h_X}$. In other words
$$
\mathbf{Z}_X(U) = \mathbf{Z}[\text{Mor}_{\mathcal{C}}(U, X)].
$$
\end{definition}

\noindent
This construction is clearly functorial in the presheaf $\mathcal{G}$.
In fact it is adjoint to the forgetful functor
$\textit{PAb}(\mathcal{C}) \to \textit{PSh}(\mathcal{C})$.
Here is the precise statement.

\begin{lemma}
\label{lemma-obvious-adjointness}
Let $\mathcal{C}$ be a category.
Let $\mathcal{G}$, $\mathcal{F}$ be a presheaves of sets.
Let $\mathcal{A}$ be an abelian presheaf.
Let $U$ be an object of $\mathcal{C}$. Then
we have
\begin{align*}
\text{Mor}_{\textit{PSh}(\mathcal{C})}(h_U, \mathcal{F})
& =
\mathcal{F}(U), \\
\text{Mor}_{\textit{PAb}(\mathcal{C})}(\mathbf{Z}_{\mathcal{G}}, \mathcal{A})
& =
\text{Mor}_{\textit{PSh}(\mathcal{C})}(\mathcal{G}, \mathcal{A}), \\
\text{Mor}_{\textit{PAb}(\mathcal{C})}(\mathbf{Z}_U, \mathcal{A})
& =
\mathcal{A}(U).
\end{align*}
All of these equalities are functorial.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-coproduct-sum-free-abelian-presheaf}
Let $\mathcal{C}$ be a category.
Let $I$ be a set. For each $i \in I$ let
$\mathcal{G}_i$ be a presheaf of sets.
Then
$$
\mathbf{Z}_{\coprod_i \mathcal{G}_i}
=
\bigoplus\nolimits_{i \in I} \mathbf{Z}_{\mathcal{G}_i}
$$
in $\textit{PAb}(\mathcal{C})$.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}



\section{Free abelian sheaves}
\label{section-free-abelian-sheaf}

\noindent
Here is the notion of a free abelian sheaf on a sheaf of sets.

\begin{definition}
\label{definition-free-abelian-sheaf-on}
Let $\mathcal{C}$ be a site. Let $\mathcal{G}$ be a presheaf of sets.
The {\it free abelian sheaf} $\mathbf{Z}_{\mathcal{G}}^\#$
on $\mathcal{G}$ is the abelian sheaf $\mathbf{Z}_{\mathcal{G}}^\#$
which is the sheafification of the abelian presheaf on $\mathcal{G}$.
In the special case $\mathcal{G} = h_X$ of a representable presheaf
associated to an object $X$ of $\mathcal{C}$
we use the notation $\mathbf{Z}_X^\#$.
\end{definition}

\noindent
This construction is clearly functorial in the presheaf $\mathcal{G}$.
In fact it provides an adjoint to the forgetful functor
$\textit{Ab}(\mathcal{C}) \to \textit{Sh}(\mathcal{C})$.
Here is the precise statement.

\begin{lemma}
\label{lemma-obvious-adjointness-sheaves}
Let $\mathcal{C}$ be a site.
Let $\mathcal{G}$, $\mathcal{F}$ be a sheaves of sets.
Let $\mathcal{A}$ be an abelian sheaf.
Let $U$ be an object of $\mathcal{C}$. Then
we have
\begin{align*}
\text{Mor}_{\textit{Sh}(\mathcal{C})}(h_U^\#, \mathcal{F})
& =
\mathcal{F}(U), \\
\text{Mor}_{\textit{Ab}(\mathcal{C})}(\mathbf{Z}_{\mathcal{G}}^\#,
\mathcal{A})
& =
\text{Mor}_{\textit{Sh}(\mathcal{C})}(\mathcal{G}, \mathcal{A}), \\
\text{Mor}_{\textit{Ab}(\mathcal{C})}(\mathbf{Z}_U^\#, \mathcal{A})
& =
\mathcal{A}(U).
\end{align*}
All of these equalities are functorial.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-may-sheafify-before-abelianize}
Let $\mathcal{C}$ be a site.
Let $\mathcal{G}$ be a presheaf of sets.
Then $\mathbf{Z}_{\mathcal{G}}^\# = (\mathbf{Z}_{\mathcal{G}^\#})^\#$.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}








\section{Ringed topoi}
\label{section-ringed-topoi}

\noindent
In this chapter we mainly work with sheaves of modules on a ringed site.
Hence we need to define this notion.

\begin{definition}
\label{definition-ringed-site}
Ringed sites.
\begin{enumerate}
\item A {\it ringed site} is a pair $(\mathcal{C}, \mathcal{O})$
where $\mathcal{C}$ is a site and $\mathcal{O}$ is a sheaf of rings
on $\mathcal{C}$. The sheaf $\mathcal{O}$ is called the
{\it structure sheaf} of the ringed site.
\item Let $(\mathcal{C}, \mathcal{O})$, $(\mathcal{C}', \mathcal{O}')$ be ringed
sites. A {\it morphism of ringed sites}
$$
(f, f^\sharp) :
(\mathcal{C}, \mathcal{O})
\longrightarrow
(\mathcal{C}', \mathcal{O}')
$$
is given by a morphism of sites $f : \mathcal{C} \to \mathcal{C}'$
(see Sites, Definition \ref{sites-definition-morphism-sites})
together with a map of sheaves of rings
$f^\sharp : f^{-1}\mathcal{O}' \to \mathcal{O}$, which by adjunction
is the same thing as a map of sheaves of rings
$f^\sharp : \mathcal{O}' \to f_*\mathcal{O}$.
\item Let
$(f, f^\sharp) :
(\mathcal{C}_1, \mathcal{O}_1) \to (\mathcal{C}_2, \mathcal{O}_2)$ and
$(g, g^\sharp) :
(\mathcal{C}_2, \mathcal{O}_2) \to (\mathcal{C}_3, \mathcal{O}_3)$
be morphisms of ringed sites. Then we define
the {\it composition of morphisms of ringed sites}
by the rule
$$
(g, g^\sharp) \circ (f, f^\sharp) = (g \circ f, f^\sharp \circ g^\sharp).
$$
Here we use composition of morphisms of sites defined in
Sites, Definition \ref{sites-definition-composition-morphisms-sites}
and $f^\sharp \circ g^\sharp$ indicates the morphism of sheaves of
rings
$$
\mathcal{O}_3 \xrightarrow{g^\sharp} g_*\mathcal{O}_2
\xrightarrow{g_*f^\sharp} g_*f_*\mathcal{O}_1 = (g \circ f)_*\mathcal{O}_1
$$
\end{enumerate}
\end{definition}

\noindent
A ringed topos and a morphism of ringed topoi are defined similarly.
Namely, a ringed topos is just a ringed site, except that the notion of
a morphism of ringed topoi is different from the notion of a morphism
of ringed sites.

\begin{definition}
\label{definition-ringed-topos}
Ringed topoi.
\begin{enumerate}
\item A {\it ringed topos} is a pair
$(\textit{Sh}(\mathcal{C}), \mathcal{O})$
where $\mathcal{C}$ is a site and $\mathcal{O}$ is a sheaf of rings
on $\mathcal{C}$. The sheaf $\mathcal{O}$ is called the
{\it structure sheaf} of the ringed site.
\item Let $(\textit{Sh}(\mathcal{C}), \mathcal{O})$,
$(\textit{Sh}(\mathcal{C}'), \mathcal{O}')$ be ringed topoi.
A {\it morphism of ringed topoi}
$$
(f, f^\sharp) :
(\textit{Sh}(\mathcal{C}), \mathcal{O})
\longrightarrow
(\textit{Sh}(\mathcal{C}'), \mathcal{O}')
$$
is given by a morphism of topoi $f : \mathcal{C} \to \mathcal{C}'$
(see Sites, Definition \ref{sites-definition-topos})
together with a map of sheaves of rings
$f^\sharp : f^{-1}\mathcal{O}' \to \mathcal{O}$, which by adjunction
is the same thing as a map of sheaves of rings
$f^\sharp : \mathcal{O}' \to f_*\mathcal{O}$.
\item Let
$(f, f^\sharp) :
(\textit{Sh}(\mathcal{C}_1), \mathcal{O}_1)
\to (\textit{Sh}(\mathcal{C}_2), \mathcal{O}_2)$ and
$(g, g^\sharp) :
(\textit{Sh}(\mathcal{C}_2), \mathcal{O}_2) \to
(\textit{Sh}(\mathcal{C}_3), \mathcal{O}_3)$
be morphisms of ringed topoi. Then we define
the {\it composition of morphisms of ringed topoi}
by the rule
$$
(g, g^\sharp) \circ (f, f^\sharp) = (g \circ f, f^\sharp \circ g^\sharp).
$$
Here we use composition of morphisms of topoi defined in
Sites, Definition \ref{sites-definition-topos}
and $f^\sharp \circ g^\sharp$ indicates the morphism of sheaves of
rings
$$
\mathcal{O}_3 \xrightarrow{g^\sharp} g_*\mathcal{O}_2
\xrightarrow{g_*f^\sharp} g_*f_*\mathcal{O}_1 = (g \circ f)_*\mathcal{O}_1
$$
\end{enumerate}
\end{definition}

\noindent
Every morphism of ringed topoi is the composition of an equivalence
of ringed topoi with a morphism of ringed topoi associated to a morpism
of ringed sites. Here is the precise statement.

\begin{lemma}
\label{lemma-morphism-ringed-topoi-comes-from-morphism-ringed-sites}
Let $(f, f^\sharp) :
(\textit{Sh}(\mathcal{C}), \mathcal{O}_{\mathcal{C}})
\to (\textit{Sh}(\mathcal{D}), \mathcal{O}_{\mathcal{D}})$
be a morphism of ringed topoi. There exists a factorization
$$
\xymatrix{
(\textit{Sh}(\mathcal{C}), \mathcal{O}_{\mathcal{C}})
\ar[rr]_{(f, f^\sharp)}
\ar[d]_{(g, g^\sharp)}
& &
(\textit{Sh}(\mathcal{D}), \mathcal{O}_{\mathcal{D}}) \ar[d]^{(e, e^\sharp)}
\\
(\textit{Sh}(\mathcal{C}'), \mathcal{O}_{\mathcal{C}'})
\ar[rr]^{(h, h^\sharp)} & &
(\textit{Sh}(\mathcal{D}'), \mathcal{O}_{\mathcal{D}'})
}
$$
where
\begin{enumerate}
\item $g : \textit{Sh}(\mathcal{C}) \to \textit{Sh}(\mathcal{C}')$
is an equivalence of topoi induced by a special cocontinuous functor
$\mathcal{C} \to \mathcal{C}'$ (see
Sites, Definition \ref{sites-definition-special-cocontinuous-functor}),
\item $e : \textit{Sh}(\mathcal{D}) \to \textit{Sh}(\mathcal{D}')$
is an equivalence of topoi induced by a special cocontinuous functor
$\mathcal{D} \to \mathcal{D}'$ (see
Sites, Definition \ref{sites-definition-special-cocontinuous-functor}),
\item $\mathcal{O}_{\mathcal{C}'} = g_*\mathcal{O}_{\mathcal{C}}$
and $g^\sharp$ is the obvious map,
\item $\mathcal{O}_{\mathcal{D}'} = e_*\mathcal{O}_{\mathcal{D}}$
and $e^\sharp$ is the obvious map,
\item the sites $\mathcal{C}'$ and $\mathcal{D}'$ have final objects
and fibre products (i.e., all finite limits), and
\item $h$ is a morphism of sites induced by a continuous functor
$u : \mathcal{D}' \to \mathcal{C}'$ which commutes with all finite limits
(i.e., it satisfies the assumptions of
Sites, Proposition \ref{sites-proposition-get-morphism}).
\end{enumerate}
Moreover, if $(f, f^\sharp)$ is an equivalence of ringed topoi,
then we can choose the diagram such that
$\mathcal{C}' = \mathcal{D}'$, 
$\mathcal{O}_{\mathcal{C}'} = \mathcal{O}_{\mathcal{D}'}$
and $(h, h^\sharp)$ is the identiy.
\end{lemma}

\begin{proof}
This follows from
Sites, Lemma \ref{sites-lemma-morphism-topoi-comes-from-morphism-sites},
and Remarks
\ref{sites-remark-morphism-topoi-comes-from-morphism-sites}
and
\ref{sites-remark-equivalence-topoi-comes-from-morphism-sites}.
You just have to carry along the sheaves of rings. Some details omitted.
\end{proof}









\section{Presheaves of modules}
\label{section-presheaves-modules}

\noindent
Let $\mathcal{C}$ be a category.
Let $\mathcal{O}$ be a presheaf of rings on $\mathcal{C}$.
At this point we have not yet defined a presheaf of $\mathcal{O}$-modules.
Thus we do so right now.

\begin{definition}
\label{definition-presheaf-modules}
Let $\mathcal{C}$ be a category, and
let $\mathcal{O}$ be a presheaf of rings on $\mathcal{C}$.
\begin{enumerate}
\item A {\it presheaf of $\mathcal{O}$-modules}
is given by an abelian presheaf $\mathcal{F}$ together with a
map of presheaves of sets
$$
\mathcal{O} \times \mathcal{F} \longrightarrow \mathcal{F}
$$
such that for every object $U$ of $\mathcal{C}$ the map
$\mathcal{O}(U) \times \mathcal{F}(U) \to \mathcal{F}(U)$
defines the structure of an $\mathcal{O}(U)$-module
structure on the abelian group $\mathcal{F}(U)$.
\item A {\it morphism $\varphi : \mathcal{F} \to \mathcal{G}$
of presheaves of $\mathcal{O}$-modules} is a morphism of abelian presheaves
$\varphi : \mathcal{F} \to \mathcal{G}$ such that
the diagram
$$
\xymatrix{
\mathcal{O} \times \mathcal{F} \ar[r] \ar[d]_{\text{id}\times \varphi} &
\mathcal{F} \ar[d]^{\varphi} \\
\mathcal{O} \times \mathcal{G} \ar[r] &
\mathcal{G}
}
$$
commutes.
\item The set of $\mathcal{O}$-module morphisms as above is
denoted $\text{Hom}_{\mathcal{O}}(\mathcal{F}, \mathcal{G})$.
\item The category of presheaves of $\mathcal{O}$-modules is denoted
$\textit{PMod}(\mathcal{O})$.
\end{enumerate}
\end{definition}

\noindent
Suppose that $\mathcal{O}_1 \to \mathcal{O}_2$ is a
morphism of presheaves of rings on the category $\mathcal{C}$. In this case,
if $\mathcal{F}$ is a presheaf of $\mathcal{O}_2$-modules
then we can think of $\mathcal{F}$ as a presheaf of
$\mathcal{O}_1$-modules by using the composition
$$
\mathcal{O}_1 \times \mathcal{F}
\to
\mathcal{O}_2 \times \mathcal{F}
\to
\mathcal{F}.
$$
We sometimes denote this by $\mathcal{F}_{\mathcal{O}_1}$
to indicate the restriction of rings. We call this
the {\it restriction of $\mathcal{F}$}. We obtain the
restriction functor
$$
\textit{PMod}(\mathcal{O}_2)
\longrightarrow
\textit{PMod}(\mathcal{O}_1)
$$

\medskip\noindent
On the other hand, given a presheaf of $\mathcal{O}_1$-modules
$\mathcal{G}$
we can construct a presheaf of $\mathcal{O}_2$-modules
$\mathcal{O}_2 \otimes_{p, \mathcal{O}_1} \mathcal{G}$
by the rule
$$
U \longmapsto
\left(\mathcal{O}_2 \otimes_{p, \mathcal{O}_1} \mathcal{G}\right)(U)
=
\mathcal{O}_2(U) \otimes_{\mathcal{O}_1(U)} \mathcal{G}(U)
$$
where $U \in \text{Ob}(\mathcal{C})$, with obvious restriction mappings.
The index $p$ stands for ``presheaf'' and not ``point''.
This presheaf is called the tensor product presheaf. We obtain
the {\it change of rings} functor
$$
\textit{PMod}(\mathcal{O}_1)
\longrightarrow
\textit{PMod}(\mathcal{O}_2)
$$

\begin{lemma}
\label{lemma-adjointness-tensor-restrict-presheaves}
With $\mathcal{C}$, $\mathcal{O}_1 \to \mathcal{O}_2$, $\mathcal{F}$ and
$\mathcal{G}$ as above there exists a canonical bijection
$$
\text{Hom}_{\mathcal{O}_1}(\mathcal{G}, \mathcal{F}_{\mathcal{O}_1})
=
\text{Hom}_{\mathcal{O}_2}(
\mathcal{O}_2 \otimes_{p, \mathcal{O}_1} \mathcal{G},
\mathcal{F}
)
$$
In other words, the restriction and change of rings functors defined
above are adjoint to each other.
\end{lemma}

\begin{proof}
This follows from the fact that for a ring map
$A \to B$ the restriction functor and the change
of ring functor are adjoint to each other.
\end{proof}


\section{Sheaves of modules}
\label{section-sheaves-modules}

\begin{definition}
\label{definition-sheaf-modules}
Let $\mathcal{C}$ be a site.
Let $\mathcal{O}$ be a sheaf of rings on $\mathcal{C}$.
\begin{enumerate}
\item A {\it sheaf of $\mathcal{O}$-modules} is a presheaf
of $\mathcal{O}$-modules $\mathcal{F}$,
see Definition \ref{definition-presheaf-modules},
such that the underlying presheaf of abelian groups $\mathcal{F}$
is a sheaf.
\item A {\it morphism of sheaves of $\mathcal{O}$-modules}
is a morphism of presheaves of $\mathcal{O}$-modules.
\item Given sheaves of $\mathcal{O}$-modules
$\mathcal{F}$ and $\mathcal{G}$ we denote
$\text{Hom}_{\mathcal{O}}(\mathcal{F}, \mathcal{G})$
the set of morphism of sheaves of $\mathcal{O}$-modules.
\item The category of sheaves of $\mathcal{O}$-modules
is denoted $\textit{Mod}(\mathcal{O})$.
\end{enumerate}
\end{definition}

\noindent
This definition kind of makes sense even if $\mathcal{O}$ is just a
presheaf of rings, allthough we do not know any examples where
this is useful, and we will avoid using the terminology
``sheaves of $\mathcal{O}$-modules''
in case $\mathcal{O}$ is not a sheaf of rings.



\section{Sheafification of presheaves of modules}
\label{section-sheafification-presheaves-modules}

\begin{lemma}
\label{lemma-sheafification-presheaf-modules}
Let $\mathcal{C}$ be a site.
Let $\mathcal{O}$ be a presheaf of rings on $\mathcal{C}$
Let $\mathcal{F}$ be a presheaf $\mathcal{O}$-modules.
Let $\mathcal{O}^\#$ be the sheafification of $\mathcal{O}$ as a presheaf
of rings, see Sites, Section \ref{sites-section-sheaves-algebraic-structures}.
Let $\mathcal{F}^\#$ be the sheafification of $\mathcal{F}$
as a presheaf of abelian groups. There exists a map of
sheaves of sets
$$
\mathcal{O}^\# \times \mathcal{F}^\#
\longrightarrow
\mathcal{F}^\#
$$
which makes the diagram
$$
\xymatrix{
\mathcal{O} \times \mathcal{F} \ar[r] \ar[d] &
\mathcal{F} \ar[d] \\
\mathcal{O}^\# \times \mathcal{F}^\# \ar[r] &
\mathcal{F}^\#
}
$$
commute and which makes $\mathcal{F}^\#$ into a sheaf
of $\mathcal{O}^\#$-modules. In addition, if $\mathcal{G}$
is a sheaf of $\mathcal{O}^\#$-modules, then any morphism
of presheaves of $\mathcal{O}$-modules $\mathcal{F} \to \mathcal{G}$
(into the restriction of $\mathcal{G}$ to a $\mathcal{O}$-module)
factors uniquely as $\mathcal{F} \to \mathcal{F}^\# \to \mathcal{G}$
where $\mathcal{F}^\# \to \mathcal{G}$ is a morphism of
$\mathcal{O}^\#$-modules.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\noindent
This actually means that the functor
$i : \textit{Mod}(\mathcal{O}^\#) \to \textit{PMod}(\mathcal{O})$
(combining restriction and including sheaves into presheaves)
and the sheafification functor of the lemma
${}^\# : \textit{PMod}(\mathcal{O}) \to \textit{Mod}(\mathcal{O}^\#)$
are adjoint. In a formula
$$
\text{Mor}_{\textit{PMod}(\mathcal{O})}(\mathcal{F}, i\mathcal{G})
=
\text{Mor}_{\textit{Mod}(\mathcal{O}^\#)}(\mathcal{F}^\#, \mathcal{G})
$$
An important case happens when $\mathcal{O}$ is already a sheaf of
rings. In this case the formula reads
$$
\text{Mor}_{\textit{PMod}(\mathcal{O})}(\mathcal{F}, i\mathcal{G})
=
\text{Mor}_{\textit{Mod}(\mathcal{O})}(\mathcal{F}^\#, \mathcal{G})
$$
because $\mathcal{O} = \mathcal{O}^\#$ in this case.

\begin{lemma}
\label{lemma-sheafification-exact}
Let $\mathcal{C}$ be a site.
Let $\mathcal{O}$ be a presheaf of rings on $\mathcal{C}$
The sheafification functor
$$
\textit{PMod}(\mathcal{O}) \longrightarrow \textit{Mod}(\mathcal{O}^\#), \quad
\mathcal{F} \longmapsto \mathcal{F}^\#
$$
is exact.
\end{lemma}

\begin{proof}
This is true because it holds for sheafification
$\textit{PAb}(\mathcal{C}) \to \textit{Ab}(\mathcal{C})$.
See the discussion in Section \ref{section-abelian-sheaves}.
\end{proof}

\noindent
Let $\mathcal{C}$ be a site.
Let $\mathcal{O}_1 \to \mathcal{O}_2$ be
a morphism of sheaves of rings on $\mathcal{C}$.
In Section \ref{section-presheaves-modules}
we defined a restriction functor
and a change of rings functor on presheaves of modules
associated to this situation.

\medskip\noindent
If $\mathcal{F}$ is a sheaf of $\mathcal{O}_2$-modules
then the restriction $\mathcal{F}_{\mathcal{O}_1}$
of $\mathcal{F}$ is clearly a sheaf
of $\mathcal{O}_1$-modules. We obtain the restriction functor
$$
\textit{Mod}(\mathcal{O}_2)
\longrightarrow
\textit{Mod}(\mathcal{O}_1)
$$

\medskip\noindent
On the other hand, given a sheaf of $\mathcal{O}_1$-modules
$\mathcal{G}$ the presheaf of $\mathcal{O}_2$-modules
$\mathcal{O}_2 \otimes_{p, \mathcal{O}_1} \mathcal{G}$
is in general not a sheaf. Hence we define the
{\it tensor product sheaf}
$\mathcal{O}_2 \otimes_{\mathcal{O}_1} \mathcal{G}$
by the formula
$$
\mathcal{O}_2 \otimes_{\mathcal{O}_1} \mathcal{G}
=
(\mathcal{O}_2 \otimes_{p, \mathcal{O}_1} \mathcal{G})^\#
$$
as the sheafification of our construction for presheaves.
We obtain the {\it change of rings} functor
$$
\textit{Mod}(\mathcal{O}_1)
\longrightarrow
\textit{Mod}(\mathcal{O}_2)
$$

\begin{lemma}
\label{lemma-adjointness-tensor-restrict}
With $X$, $\mathcal{O}_1$, $\mathcal{O}_2$, $\mathcal{F}$ and
$\mathcal{G}$ as above there exists a canonical bijection
$$
\text{Hom}_{\mathcal{O}_1}(\mathcal{G}, \mathcal{F}_{\mathcal{O}_1})
=
\text{Hom}_{\mathcal{O}_2}(
\mathcal{O}_2 \otimes_{\mathcal{O}_1} \mathcal{G},
\mathcal{F}
)
$$
In other words, the restriction and change of rings functors
are adjoint to each other.
\end{lemma}

\begin{proof}
This follows from
Lemma \ref{lemma-adjointness-tensor-restrict-presheaves}
and the fact that
$\text{Hom}_{\mathcal{O}_2}(
\mathcal{O}_2 \otimes_{\mathcal{O}_1} \mathcal{G},
\mathcal{F}
)
=
\text{Hom}_{\mathcal{O}_2}(
\mathcal{O}_2 \otimes_{p, \mathcal{O}_1} \mathcal{G},
\mathcal{F}
)$
because $\mathcal{F}$ is a sheaf.
\end{proof}




\section{Morphisms of topoi and sheaves of modules}
\label{section-sheaves-modules-functorial} 

\noindent
All of this material is completely straightforward.
We formulate everything in the case of morphisms of topoi,
but of course the results also hold in the case of morphisms of sites.

\begin{lemma}
\label{lemma-pushforward-module}
Let $\mathcal{C}$, $\mathcal{D}$ be sites.
Let $f : \textit{Sh}(\mathcal{C}) \to \textit{Sh}(\mathcal{D})$
be a morphism of topoi.
Let $\mathcal{O}$ be a sheaf of rings on $\mathcal{C}$.
Let $\mathcal{F}$ be a sheaf of $\mathcal{O}$-modules.
There is a natural map of sheaves of sets
$$
f_*\mathcal{O} \times f_*\mathcal{F}
\longrightarrow
f_*\mathcal{F}
$$
which turns $f_*\mathcal{F}$ into a sheaf of $f_*\mathcal{O}$-modules.
This construction is functorial in $\mathcal{F}$.
\end{lemma}

\begin{proof}
Denote $\mu : \mathcal{O} \times \mathcal{F} \to \mathcal{F}$ the
multiplication map. Recall that $f_*$ (on sheaves of sets) is left exact
and hence commutes with products. Hence $f_*\mu$ is a map as
indicated. This proves the lemma.
\end{proof}

\begin{lemma}
\label{lemma-pullback-module}
Let $\mathcal{C}$, $\mathcal{D}$ be sites.
Let $f : \textit{Sh}(\mathcal{C}) \to \textit{Sh}(\mathcal{D})$
be a morphism of topoi.
Let $\mathcal{O}$ be a sheaf of rings on $\mathcal{D}$.
Let $\mathcal{G}$ be a sheaf of $\mathcal{O}$-modules.
There is a natural map of sheaves of sets
$$
f^{-1}\mathcal{O} \times f^{-1}\mathcal{G}
\longrightarrow
f^{-1}\mathcal{G}
$$
which turns $f^{-1}\mathcal{G}$ into a sheaf of $f^{-1}\mathcal{O}$-modules.
This construction is functorial in $\mathcal{G}$.
\end{lemma}

\begin{proof}
Denote $\mu : \mathcal{O} \times \mathcal{G} \to \mathcal{G}$ the
multiplication map. Recall that $f^{-1}$ (on sheaves of sets) is exact
and hence commutes with products. Hence $f^{-1}\mu$ is a map as
indicated. This proves the lemma.
\end{proof}

\begin{lemma}
\label{lemma-adjoint-push-pull-modules}
Let $\mathcal{C}$, $\mathcal{D}$ be sites.
Let $f : \textit{Sh}(\mathcal{C}) \to \textit{Sh}(\mathcal{D})$
be a morphism of topoi.
Let $\mathcal{O}$ be a sheaf of rings on $\mathcal{D}$.
Let $\mathcal{G}$ be a sheaf of $\mathcal{O}$-modules.
Let $\mathcal{F}$ be a sheaf of $f^{-1}\mathcal{O}$-modules.
Then
$$
\text{Mor}_{\textit{Mod}(f^{-1}\mathcal{O})}(f^{-1}\mathcal{G}, \mathcal{F})
=
\text{Mor}_{\textit{Mod}(\mathcal{O})}(\mathcal{G}, f_*\mathcal{F}).
$$
Here we use
Lemmas \ref{lemma-pullback-module}
and \ref{lemma-pushforward-module}, and we think of
$f_*\mathcal{F}$ as an $\mathcal{O}$-module by restriction via
$\mathcal{O} \to f_*f^{-1}\mathcal{O}$.
\end{lemma}

\begin{proof}
First we note that we have
$$
\text{Mor}_{\textit{Ab}(\mathcal{C})}(f^{-1}\mathcal{G}, \mathcal{F})
=
\text{Mor}_{\textit{Ab}(\mathcal{D})}(\mathcal{G}, f_*\mathcal{F}).
$$
by Sites,
Proposition \ref{sites-proposition-functoriality-algebraic-structures-topoi}.
Suppose that $\alpha : f^{-1}\mathcal{G} \to \mathcal{F}$ and
$\beta : \mathcal{G} \to f_*\mathcal{F}$ are morphisms of abelian
sheaves which correspond via the formula above. We have to show that
$\alpha$ is $f^{-1}\mathcal{O}$-linear if and only if $\beta$
is $\mathcal{O}$-linear. For example, suppose $\alpha$ is
$f^{-1}\mathcal{O}$-linear, then clearly $f_*\alpha$ is
$f_*f^{-1}\mathcal{O}$-linear, and hence (as restriction is a functor)
is $\mathcal{O}$-linear. Hence it suffices to prove that the
adjunction map $\mathcal{G} \to f_*f^{-1}\mathcal{G}$ is
$\mathcal{O}$-linear. Using that both $f_*$ and $f^{-1}$ commute
with products (on sheaves of sets) this comes down to showing that
$$
\xymatrix{
\mathcal{O} \times \mathcal{G} \ar[r] \ar[d] &
f_*f^{-1}(\mathcal{O} \times \mathcal{G}) \ar[d] \\
\mathcal{G} \ar[r] & f_*f^{-1}\mathcal{G}
}
$$
is commutative. This holds because the adjunction mapping
$\text{id}_{\textit{Sh}(\mathcal{D})} \to f_*f^{-1}$ is a
transformation of functors. We omit the proof of the implication
$\beta$ linear $\Rightarrow$ $\alpha$ linear.
\end{proof}

\begin{lemma}
\label{lemma-adjoint-pull-push-modules}
Let $\mathcal{C}$, $\mathcal{D}$ be sites.
Let $f : \textit{Sh}(\mathcal{C}) \to \textit{Sh}(\mathcal{D})$
be a morphism of topoi.
Let $\mathcal{O}$ be a sheaf of rings on $\mathcal{C}$.
Let $\mathcal{F}$ be a sheaf of $\mathcal{O}$-modules.
Let $\mathcal{G}$ be a sheaf of $f_*\mathcal{O}$-modules.
Then
$$
\text{Mor}_{\textit{Mod}(\mathcal{O})}(
\mathcal{O} \otimes_{f^{-1}f_*\mathcal{O}} f^{-1}\mathcal{G}, \mathcal{F})
=
\text{Mor}_{\textit{Mod}(f_*\mathcal{O})}(\mathcal{G}, f_*\mathcal{F}).
$$
Here we use
Lemmas \ref{lemma-pullback-module}
and \ref{lemma-pushforward-module}, and we use
the canonical map $f^{-1}f_*\mathcal{O} \to \mathcal{O}$
in the definition of the tensor product.
\end{lemma}

\begin{proof}
Note that we have
$$
\text{Mor}_{\textit{Mod}(\mathcal{O})}(
\mathcal{O} \otimes_{f^{-1}f_*\mathcal{O}} f^{-1}\mathcal{G}, \mathcal{F})
=
\text{Mor}_{\textit{Mod}(f^{-1}f_*\mathcal{O})}(
f^{-1}\mathcal{G}, \mathcal{F}_{f^{-1}f_*\mathcal{O}})
$$
by Lemma \ref{lemma-adjointness-tensor-restrict}. Hence the result follows
from Lemma \ref{lemma-adjoint-push-pull-modules}.
\end{proof}






\section{Morphisms of ringed topoi and modules}
\label{section-functoriality-modules}

\noindent
We have now introduced enough notation so that we are able to
define the pullback and pushforward of modules along a morphism
of ringed topoi.

\begin{definition}
\label{definition-pushforward}
Let
$(f, f^\sharp) :
(\textit{Sh}(\mathcal{C}), \mathcal{O}_{\mathcal{C}})
\to
(\textit{Sh}(\mathcal{D}), \mathcal{O}_{\mathcal{D}})$
be a morphism of ringed topoi or ringed sites.
\begin{enumerate}
\item Let $\mathcal{F}$ be a sheaf of $\mathcal{O}_{\mathcal{C}}$-modules.
We define the {\it pushforward} of $\mathcal{F}$ as the
sheaf of $\mathcal{O}_{\mathcal{D}}$-modules which as a sheaf
of abelian groups equals $f_*\mathcal{F}$ and with
module structure given by the restriction
via $f^\sharp : \mathcal{O}_{\mathcal{D}} \to f_*\mathcal{O}_{\mathcal{C}}$
of the module structure
$$
f_*\mathcal{O}_{\mathcal{C}} \times f_*\mathcal{F}
\longrightarrow
f_*\mathcal{F}
$$
from Lemma \ref{lemma-pushforward-module}.
\item Let $\mathcal{G}$ be a sheaf of $\mathcal{O}_{\mathcal{D}}$-modules.
We define the {\it pullback} $f^*\mathcal{G}$ to be the
sheaf of $\mathcal{O}_{\mathcal{C}}$-modules defined by the formula
$$
f^*\mathcal{F}
=
\mathcal{O}_{\mathcal{C}} \otimes_{f^{-1}\mathcal{O}_{\mathcal{D}}}
f^{-1}\mathcal{F}
$$
where the ring map
$f^{-1}\mathcal{O}_{\mathcal{D}} \to \mathcal{O}_{\mathcal{C}}$
is $f^\sharp$, and where the  module
structure is given by Lemma \ref{lemma-pullback-module}.
\end{enumerate}
\end{definition}

\noindent
Thus we have defined functors
\begin{eqnarray*}
f_* : \textit{Mod}(\mathcal{O}_{\mathcal{C}})
& \longrightarrow &
\textit{Mod}(\mathcal{O}_{\mathcal{D}}) \\
f^* : \textit{Mod}(\mathcal{O}_{\mathcal{D}})
& \longrightarrow &
\textit{Mod}(\mathcal{O}_{\mathcal{C}})
\end{eqnarray*}
The final result on these functors is that they are indeed
adjoint as expected.

\begin{lemma}
\label{lemma-adjoint-pullback-pushforward-modules}
Let
$(f, f^\sharp) :
(\textit{Sh}(\mathcal{C}), \mathcal{O}_{\mathcal{C}})
\to
(\textit{Sh}(\mathcal{D}), \mathcal{O}_{\mathcal{D}})$
be a morphism of ringed topoi or ringed sites.
Let $\mathcal{F}$ be a sheaf of $\mathcal{O}_{\mathcal{C}}$-modules.
Let $\mathcal{G}$ be a sheaf of $\mathcal{O}_{\mathcal{D}}$-modules.
There is a canonical bijection
$$
\text{Hom}_{\mathcal{O}_{\mathcal{C}}}(f^*\mathcal{G}, \mathcal{F})
=
\text{Hom}_{\mathcal{O}_{\mathcal{D}}}(\mathcal{G}, f_*\mathcal{F}).
$$
In other words: the functor $f^*$ is the left adjoint to
$f_*$.
\end{lemma}

\begin{proof}
This follows from the work we did before:
\begin{eqnarray*}
\text{Hom}_{\mathcal{O}_{\mathcal{C}}}(f^*\mathcal{G}, \mathcal{F})
& = &
\text{Mor}_{\textit{Mod}(\mathcal{O}_{\mathcal{C}})}(
\mathcal{O}_{\mathcal{C}}
\otimes_{f^{-1}\mathcal{O}_{\mathcal{D}}} f^{-1}\mathcal{G},
\mathcal{F}) \\
& = &
\text{Mor}_{\textit{Mod}(f^{-1}\mathcal{O}_{\mathcal{D}})}(
f^{-1}\mathcal{G}, \mathcal{F}_{f^{-1}\mathcal{O}_{\mathcal{D}}}) \\
& = &
\text{Hom}_{\mathcal{O}_{\mathcal{D}}}(\mathcal{G}, f_*\mathcal{F}).
\end{eqnarray*}
Here we use Lemmas \ref{lemma-adjointness-tensor-restrict}
and \ref{lemma-adjoint-push-pull-modules}.
\end{proof}

\begin{lemma}
\label{lemma-push-pull-composition-modules}
$(f, f^\sharp) :
(\textit{Sh}(\mathcal{C}_1), \mathcal{O}_1)
\to (\textit{Sh}(\mathcal{C}_2), \mathcal{O}_2)$ and
$(g, g^\sharp) :
(\textit{Sh}(\mathcal{C}_2), \mathcal{O}_2) \to
(\textit{Sh}(\mathcal{C}_3), \mathcal{O}_3)$
be morphisms of ringed topoi.
There are canonical isomorphisms of functors
$(g \circ f)_* \cong g_* \circ f_*$ and
$(g \circ f)^* \cong f^* \circ g^*$.
\end{lemma}

\begin{proof}
This is clear from the definitions.
\end{proof}





\section{The abelian category of sheaves of modules}
\label{section-kernels}

\noindent
Let $(\textit{Sh}(\mathcal{C}), \mathcal{O})$ be a ringed topos.
Let $\mathcal{F}$, $\mathcal{G}$ be sheaves of $\mathcal{O}$-modules, see
Sheaves, Definition \ref{sheaves-definition-sheaf-modules}.
Let $\varphi, \psi : \mathcal{F} \to \mathcal{G}$
be morphisms of sheaves of $\mathcal{O}_X$-modules.
We define $\varphi + \psi : \mathcal{F} \to \mathcal{G}$
to be the sum of $\varphi$ and $\psi$ as morphisms of abelian sheaves.
This is clearly again a map of $\mathcal{O}$-modules.
It is also clear that composition of maps of
$\mathcal{O}$-modules is bilinear with respect to this
addition. Thus $\textit{Mod}(\mathcal{O})$ is a pre-additive
category, see Homology, Definition \ref{homology-definition-preadditive}.

\medskip\noindent
We will denote $0$ the sheaf of $\mathcal{O}$-modules
which has constant value $\{0\}$ for all objects $U$ of $\mathcal{C}$.
Clearly this is both a final and an initial object of
$\textit{Mod}(\mathcal{O})$. Given a morphism
of $\mathcal{O}$-modules $\varphi : \mathcal{F} \to \mathcal{G}$
the following are equivalent:
(a) $\varphi$ is zero, (b) $\varphi$ factors through $0$,
(c) $\varphi$ is zero on sections over each opject $U$.

\medskip\noindent
Moreover, given a pair
$\mathcal{F}$, $\mathcal{G}$ of sheaves of $\mathcal{O}$-modules
we may define the direct sum as
$$
\mathcal{F} \oplus \mathcal{G} = \mathcal{F} \times \mathcal{G}
$$
with obvious maps $(i, j, p, q)$ as in Homology, Definition
\ref{homology-definition-direct-sum}. Thus $\textit{Mod}(\mathcal{O})$
is an additive category, see
Homology, Definition \ref{homology-definition-additive-category}.

\medskip\noindent
Let $\varphi : \mathcal{F} \to \mathcal{G}$ be a morphism
of $\mathcal{O}$-modules. We may define $\text{Ker}(\varphi)$
to be the kernel of $\varphi$ as a map of abelian sheaves.
By Section \ref{section-abelian-sheaves} this is the
subsheaf of $\mathcal{F}$ with sections
$$
\text{Ker}(\varphi)(U) =
\{ s \in \mathcal{F}(U) \mid \varphi(s) = 0 \text{ in } \mathcal{G}(U)\}
$$
for all objects $U$ of $\mathcal{C}$. It is easy to see that this is indeed
a kernel in the category of $\mathcal{O}$-modules. In other words,
a morphism $\alpha : \mathcal{H} \to \mathcal{F}$ factors
through $\text{Ker}(\varphi)$ if and only if $\varphi \circ \alpha = 0$.

\medskip\noindent
Similarly, we define $\text{Coker}(\varphi)$ as the cokernel of
$\varphi$ as a map of abelian sheaves. There is a unique
multiplication map
$$
\mathcal{O} \times \text{Coker}(\varphi) \longrightarrow \text{Coker}(\varphi)
$$
such that the map $\mathcal{G} \to \text{Coker}(\varphi)$ becomes a
morphism of $\mathcal{O}$-modules (verification omitted).
The map $\mathcal{G} \to \text{Coker}(\varphi)$ is surjective
(as a map of sheaves of sets, see Section \ref{section-abelian-sheaves}).
To show that $\text{Coker}(\varphi)$ is a cokernel in
$\textit{Mod}(\mathcal{O})$, note that if
$\beta : \mathcal{G} \to \mathcal{H}$ is a morphism of $\mathcal{O}$-modules
such that $\beta \circ \varphi$ is zero, then you get for every
object $U$ of $\mathcal{C}$ a map induced by $\beta$ from
$\mathcal{G}(U)/\varphi(\mathcal{F}(U))$ into $\mathcal{H}(U)$.
By the universal property of sheafification (see
Sheaves, Lemma \ref{sheaves-lemma-sheafification-presheaf-modules})
we obtain a canonical map $\text{Coker}(\varphi) \to \mathcal{H}$
such that the original $\beta$ is equal to the composition
$\mathcal{G} \to \text{Coker}(\varphi) \to \mathcal{H}$.
The morphism $\text{Coker}(\varphi) \to \mathcal{H}$ is unique
because of the surjectivity mentioned above.

\begin{lemma}
\label{lemma-abelian}
Let $(\textit{Sh}(\mathcal{C}), \mathcal{O})$ be a ringed topos.
The category $\textit{Mod}(\mathcal{O})$ is an abelian category.
The forgetful functor
$\textit{Mod}(\mathcal{O}) \to \textit{Ab}(\mathcal{C})$
is exact, hence kernels, cokernels and exactness of
$\mathcal{O}$-modules, correspond to the corresponding notions
for abelian sheaves.
\end{lemma}

\begin{proof}
Above we have seen that $\textit{Mod}(\mathcal{O})$ is an additive
category, with kernels and cokernels
and that $\textit{Mod}(\mathcal{O}) \to \textit{Ab}(\mathcal{C})$
preserves kernels and cokernels.
By Homology, Definition \ref{homology-definition-abelian-category}
we have to show that image and coimage agree. This is clear
because it is true in $\textit{Ab}(\mathcal{C})$. The lemma follows.
\end{proof}

\begin{lemma}
\label{lemma-limits-colimits}
Let $(\textit{Sh}(\mathcal{C}), \mathcal{O})$ be a ringed topos.
All limits and colimits exist in $\textit{Mod}(\mathcal{O})$, and
the forgetful functor
$\textit{Mod}(\mathcal{O}) \to \textit{Ab}(\mathcal{C})$
commutes with them.
\end{lemma}

\begin{proof}
Let $\mathcal{I} \to \textit{Mod}(\mathcal{C})$, $i \mapsto \mathcal{F}_i$
be a diagram. Let $\text{lim}_i\ \mathcal{F}_i$ be the limit of the diagram
in $\textit{Ab}(\mathcal{C})$. By the description of this limit in
Lemma \ref{lemma-limits-colimits-abelian-sheaves} we see immediately that
there exists a multiplication
$$
\mathcal{O} \times \text{lim}_i\ \mathcal{F}_i
\longrightarrow
\text{lim}_i\ \mathcal{F}_i
$$
which turns $\text{lim}_i\ \mathcal{F}_i$ into a sheaf of
$\mathcal{O}$-modules. It is easy to see that this is the
limit of the diagram in $\textit{Mod}(\mathcal{C})$. Let
$\text{colim}_i\ \mathcal{F}_i$ be the colimit of the diagram
in $\textit{PAb}(\mathcal{C})$. By the description of this colimit
in the proof of Lemma \ref{lemma-limits-colimits-abelian-presheaves}
we see immediately that there exists a multiplication
$$
\mathcal{O} \times \text{colim}_i\ \mathcal{F}_i
\longrightarrow
\text{colim}_i\ \mathcal{F}_i
$$
which turns $\text{colim}_i\ \mathcal{F}_i$ into a presheaf of
$\mathcal{O}$-modules. Applying sheafification we get a
sheaf of $\mathcal{O}$-modules $(\text{colim}_i\ \mathcal{F}_i)^\#$,
see Lemma \ref{lemma-sheafification-presheaf-modules}.
It is easy to see that $(\text{colim}_i\ \mathcal{F}_i)^\#$
is the colimit of the diagram in $\textit{Mod}(\mathcal{C})$, and
by Lemma \ref{lemma-limits-colimits-abelian-sheaves}
forgetting the $\mathcal{O}$-module structure is
the colimit in $\textit{Ab}(\mathcal{C})$.
\end{proof}

\noindent
The existence of limits and colimits allows us to consider exactness
properties of functors defined on the category of $\mathcal{O}$-modules
in terms of limits and colimits, as in
Categories, Section \ref{categories-section-exact-functor}.
See Homology, Lemma \ref{homology-lemma-exact-functor} for a description of
exactness properties in terms of short exact sequences.

\begin{lemma}
\label{lemma-exactness-pushforward-pullback}
Let $f : (\textit{Sh}(\mathcal{C}), \mathcal{O}_{\mathcal{C}})
\to (\textit{Sh}(\mathcal{D}), \mathcal{O}_{\mathcal{D}})$
be a morphism of ringed topoi.
\begin{enumerate}
\item The functor $f_*$ is left exact. In fact it commutes with
all limits.
\item The functor $f^*$ is right exact. In fact it commutes
with all colimits.
\end{enumerate}
\end{lemma}

\begin{proof}
This is true because $(f^*, f_*)$ is an adjoint pair
of functors, see
Lemma \ref{lemma-adjoint-pullback-pushforward-modules}.
See Categories, Section \ref{categories-section-adjoint}.
\end{proof}








\section{Global types of modules}
\label{section-global}

\begin{definition}
\label{definition-global}
Let $(\textit{Sh}(\mathcal{C}), \mathcal{O})$ be a ringed topos.
Let $\mathcal{F}$ be a sheaf of $\mathcal{O}$-modules.
\begin{enumerate}
\item We say $\mathcal{F}$ is a {\it free $\mathcal{O}$-module}
if $\mathcal{F}$ is isomorphic as an $\mathcal{O}$-module
to a sheaf of the form $\bigoplus_{i \in I} \mathcal{O}$.
\item We say $\mathcal{F}$ is {\it finite free} if
$\mathcal{F}$ is isomorphic as an $\mathcal{O}$-module
to a sheaf of the form $\bigoplus_{i \in I} \mathcal{O}$
with a finite index set $I$.
\item We say $\mathcal{F}$ is {\it generated by global sections}
if there exists a surjection
$$
\bigoplus\nolimits_{i \in I} \mathcal{O} \longrightarrow \mathcal{F}
$$
from a free $\mathcal{O}$-module onto $\mathcal{F}$.
\item We say $\mathcal{F}$ is {\it generated by finitely many global sections}
if there exists a surjection
$$
\bigoplus\nolimits_{i \in I} \mathcal{O} \longrightarrow \mathcal{F}
$$
with $I$ finite.
\item We say $\mathcal{F}$ has a {\it global presentation}
if there exists an exact sequence
$$
\bigoplus\nolimits_{j \in J} \mathcal{O} \longrightarrow
\bigoplus\nolimits_{i \in I} \mathcal{O} \longrightarrow
\mathcal{F}
$$
of $\mathcal{O}$-modules.
\item We say $\mathcal{F}$ has a {\it global finite presentation}
if there exists an exact sequence
$$
\bigoplus\nolimits_{j \in J} \mathcal{O} \longrightarrow
\bigoplus\nolimits_{i \in I} \mathcal{O} \longrightarrow
\mathcal{F}
$$
of $\mathcal{O}$-modules with $I$ and $J$ finite sets.
\end{enumerate}
\end{definition}

\noindent
Note that for any set $I$ the direct sum
$\bigoplus_{i \in I} \mathcal{O}$ exists
(Lemma \ref{lemma-limits-colimits})
and is the sheafification of the presheaf
$U \mapsto \bigoplus_{i \in I} \mathcal{O}(U)$.
This module is called the {\it free $\mathcal{O}$-module on the set $I$}.

\begin{lemma}
\label{lemma-global-pullback}
Let
$(f, f^\sharp) :
(\textit{Sh}(\mathcal{C}), \mathcal{O}_{\mathcal{C}})
\to
(\textit{Sh}(\mathcal{D}), \mathcal{O}_{\mathcal{D}})$
be a morphism of ringed topoi.
Let $\mathcal{F}$ be an $\mathcal{O}_{\mathcal{D}}$-module.
\begin{enumerate}
\item If $\mathcal{F}$ is free then $f^*\mathcal{F}$ is free.
\item If $\mathcal{F}$ is finite free then $f^*\mathcal{F}$ is finite free.
\item If $\mathcal{F}$ is generated by global sections
then $f^*\mathcal{F}$ is generated by global sections.
\item If $\mathcal{F}$ is generated by finitely many global sections
then $f^*\mathcal{F}$ is generated by finitely many global sections.
\item If $\mathcal{F}$ has a global presentation then
$f^*\mathcal{F}$ has a global presentation.
\item If $\mathcal{F}$ has a finite global presentation
then $f^*\mathcal{F}$ has a finite global presentation.
\end{enumerate}
\end{lemma}

\begin{proof}
This is true because $f^*$ commutes with arbitrary colimits
(Lemma \ref{lemma-exactness-pushforward-pullback})
and $f^*\mathcal{O}_{\mathcal{D}} = \mathcal{O}_{\mathcal{C}}$.
\end{proof}






\section{Intrinsic properties of modules}
\label{section-intrinsic}

\noindent
Let $(\textit{Sh}(\mathcal{C}), \mathcal{O})$ be a ringed topos.
An {\it intrinsic property} $\mathcal{P}(\mathcal{F})$
of an $\mathcal{O}$-module $\mathcal{F}$, is a property
such that
$\mathcal{P}(\mathcal{F}) \Leftrightarrow \mathcal{P}(f^*\mathcal{F})$
whenever $(f, f^\sharp) :
(\textit{Sh}(\mathcal{C}'), \mathcal{O}')
\to
(\textit{Sh}(\mathcal{C}), \mathcal{O})$
is an equivalence of ringed topoi.
For example, the property of being free is intrinsic. Indeed, the free
$\mathcal{O}$-module on the set $I$ is characterized by the property
that
$$
\text{Mor}_{\textit{Mod}(\mathcal{O})}(
\bigoplus\nolimits_{i \in I} \mathcal{O},
\mathcal{F})
=
\prod\nolimits_{i \in I} \text{Mor}_{\textit{Sh}(\mathcal{C})}(\{*\},
\mathcal{F})
$$
for a variable $\mathcal{F}$ in $\textit{Mod}(\mathcal{O})$.
Alternatively, we can also use Lemma \ref{lemma-global-pullback}
to see that being free is intrinsic. In fact, each of the properties
defined in Definition \ref{definition-global} is intrinsic for the
same reason.
How will we go about defining other intrinsic properties of
$\mathcal{O}$-modules?

\medskip\noindent
The upshot of
Lemma \ref{lemma-morphism-ringed-topoi-comes-from-morphism-ringed-sites}
is the following: Suppose you want to define
an intrinsic property $\mathcal{P}$ of an $\mathcal{O}$-module on a
topos. Then you can proceed as follows:
\begin{enumerate}
\item Given any site $\mathcal{C}$, any sheaf of rings $\mathcal{O}$
on $\mathcal{C}$ and any $\mathcal{O}$-module $\mathcal{F}$
define the corresponding
property $\mathcal{P}(\mathcal{C}, \mathcal{O}, \mathcal{F})$.
\item For any pair of sites $\mathcal{C}$, $\mathcal{C}'$, any
special cocontinuous functor $u : \mathcal{C} \to \mathcal{C}'$,
any sheaf of rings $\mathcal{O}$ on $\mathcal{C}$ any
$\mathcal{O}$-module $\mathcal{F}$, show that
$$
\mathcal{P}(\mathcal{C}, \mathcal{O}, \mathcal{F})
\Leftrightarrow
\mathcal{P}(\mathcal{C}', g_*\mathcal{O}, g_*\mathcal{F})
$$
where $g : \textit{Sh}(\mathcal{C}) \to \textit{Sh}(\mathcal{C}')$
is the equivalence of topoi associated to $u$.
\end{enumerate}
In this case, given any ringed topos $(\textit{Sh}(\mathcal{C}), \mathcal{O})$
and any sheaf of $\mathcal{O}$-modules $\mathcal{F}$ we simply say that
$\mathcal{F}$ has property $\mathcal{P}$ if
$\mathcal{P}(\mathcal{C}, \mathcal{O}, \mathcal{F})$ is true.
And Lemma \ref{lemma-morphism-ringed-topoi-comes-from-morphism-ringed-sites}
combined with (2) above garantees that this is well defined.

\medskip\noindent
Moreover, the same
Lemma \ref{lemma-morphism-ringed-topoi-comes-from-morphism-ringed-sites}
also garantees that if in addition
\begin{enumerate}
\item[(3)] For any morphism of ringed sites
$(f, f^\sharp) :
(\mathcal{C}, \mathcal{O}_{\mathcal{C}})
\to
(\mathcal{D}, \mathcal{O}_{\mathcal{D}})$
such that $f$ is given by a functor
$u : \mathcal{D} \to \mathcal{C}$ satisfying the
assumptions of Sites, Proposition \ref{sites-proposition-get-morphism}, 
and any $\mathcal{O}_{\mathcal{D}}$-module $\mathcal{G}$
we have
$$
\mathcal{P}(\mathcal{D}, \mathcal{O}_{\mathcal{D}}, \mathcal{F})
\Rightarrow
\mathcal{P}(\mathcal{C}, \mathcal{O}_{\mathcal{C}}, f^*\mathcal{F})
$$
\end{enumerate}
then it is true that $\mathcal{P}$ is preserved under pullback
of modules w.r.t.\ arbitrary morphisms of ringed topoi.

\medskip\noindent
We will use this method in the following sections to see
that:
locally free,
locally generated by sections,
finite type,
finite presentation,
quasi-coherent, and
coherent
are intrinsic properties of modules.

\medskip\noindent
Perhaps a more satisfying method would be to find an intrinsic definition
of these notions, rather than the laborious process sketched here.
On the other hand, in many geometric situations where we want to apply
these definitions we are given a definite ringed site, and a definite
sheaf of modules, and it is nice to have a definition already adapted to
this language.




\section{Localization}
\label{section-localization}

\noindent
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site.
Let $U \in \text{Ob}(\mathcal{C})$.
We explain the counterparts of the results in
Sites, Section \ref{sites-section-localization} in this setting.

\medskip\noindent
Denote
$\mathcal{O}_U = j_U^{-1}\mathcal{O}$ the restriction of $\mathcal{O}$
to the site $\mathcal{C}/U$. It is described by the simple
rule $\mathcal{O}_U(V/U) = \mathcal{O}(V)$. With this notation
the localization morphism $j_U$ becomes a morphism of ringed topoi
$$
j_U :
(\textit{Sh}(\mathcal{C}/U), \mathcal{O}_U)
\longrightarrow
(\textit{Sh}(\mathcal{C}), \mathcal{O})
$$
namely, we take $j_U^\sharp : \mathcal{O}_U \to j_U^{-1}\mathcal{O}_U$
the identity map.
Moreover, we obtain the following descriptions for pushforward
and pullback of modules.
\begin{enumerate}
\item The functor
$j_{U*} : \textit{Mod}(\mathcal{O}_U) \to \textit{Mod}(\mathcal{O})$
is called the {\it direct image functor}.
\item If $\mathcal{C}$ has finite products, then we have
$j_{U*}\mathcal{G}(X) = \mathcal{G}(X \times U/U)$ for
$\mathcal{G} \in \text{Ob}(\textit{Mod}(\mathcal{O}_U))$.
\item For a sheaf of $\mathcal{O}$-modules $\mathcal{F}$ on $\mathcal{C}$
the sheaf $j_U^*\mathcal{F}$ is called the
{\it restriction of $\mathcal{F}$ to $\mathcal{C}/U$}.
We will sometimes denote it by
$\mathcal{F}|_{\mathcal{C}/U}$ or even $\mathcal{F}|_U$.
It is described by the simple rule $j_U^*(\mathcal{F})(X/U) = \mathcal{F}(X)$.
\item There is a left adjoint
$j_{U!} : \textit{Mod}(\mathcal{O}_U) \to \textit{Mod}(\mathcal{O})$
to restriction, called {\it extension by zero}. See
Lemma \ref{lemma-extension-by-zero} below for a simple description.
It is an exact functor by Lemma \ref{lemma-extension-by-zero-exact}.
\end{enumerate}

\noindent
As in the topological case, see
Sheaves, Section \ref{sheaves-section-open-immersions},
the extension by zero $j_{U!}$ functor is different from
extension by the empty set $j_{U!}$ defined on sheaves of sets.
Here is the lemma defining extension by zero.

\begin{lemma}
\label{lemma-extension-by-zero}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site.
Let $U \in \text{Ob}(\mathcal{C})$.
The restriction functor
$j_U^* : \textit{Mod}(\mathcal{O}) \to \textit{Mod}(\mathcal{O}_U)$
has a left adjoint
$j_{U!} : \textit{Mod}(\mathcal{O}_U) \to \textit{Mod}(\mathcal{O})$.
So
$$
\text{Mor}_{\textit{Mod}(\mathcal{O}_U)}(\mathcal{G}, j_U^*\mathcal{F})
=
\text{Mor}_{\textit{Mod}(\mathcal{O})}(j_{U!}\mathcal{G}, \mathcal{F})
$$
for $\mathcal{F} \in \text{Ob}(\textit{Mod}(\mathcal{O}))$
and $\mathcal{G} \in \text{Ob}(\textit{Mod}(\mathcal{O}_U))$.
Moreover, the extension by zero $j_{U!}\mathcal{G}$ of $\mathcal{G}$
is the sheaf associated to the presheaf
$$
V
\longmapsto
\bigoplus\nolimits_{\varphi \in \text{Mor}_{\mathcal{C}}(V, U)}
\mathcal{G}(V \xrightarrow{\varphi} U)
$$
with obvious restriction mappings and an obvious $\mathcal{O}$-module
structure.
\end{lemma}

\begin{proof}
The $\mathcal{O}$-module structure on the presheaf is defined as
follows. If $f \in \mathcal{O}(V)$ and
$s \in \mathcal{G}(V \xrightarrow{\varphi} U)$, then
we define $f \cdot s = fs$ where
$f \in \mathcal{O}_U(\varphi : V \to U) = \mathcal{O}(V)$
(because $\mathcal{O}_U$ is the restriction of $\mathcal{O}$ to
$\mathcal{C}/U$).

\medskip\noindent
Similarly, let $\alpha : \mathcal{G} \to \mathcal{F}|_U$ be a
morphism of $\mathcal{O}_U$-modules. In this case we can define
a map from the presheaf of the lemma into $\mathcal{F}$ by mapping
$$
\bigoplus\nolimits_{\varphi \in \text{Mor}_{\mathcal{C}}(V, U)}
\mathcal{G}(V \xrightarrow{\varphi} U)
\longrightarrow
\mathcal{F}(V)
$$
by the rule that $s \in \mathcal{G}(V \xrightarrow{\varphi} U)$
maps to $\alpha(s) \in \mathcal{F}(V)$. It is clear that this is
$\mathcal{O}$-linear, and hence induces a morphism of
$\mathcal{O}$-modules $\alpha' : j_{U!}\mathcal{G} \to \mathcal{F}$
by the properties of sheafification of modules
(Lemma \ref{lemma-sheafification-presheaf-modules}).

\medskip\noindent
Conversely, let $\beta : j_{U!}\mathcal{G} \to \mathcal{F}$
by a map of $\mathcal{O}$-modules.
Recall from Sites, Section \ref{sites-section-localization}
that there exists an extension by the empty set
$j^{Sh}_{U!} : \textit{Sh}(\mathcal{C}/U) \to \textit{Sh}(\mathcal{C})$
on sheaves of sets which is left adjoint to $j_U^{-1}$.
Moreover, $j^{Sh}_{U!}\mathcal{G}$ is the sheaf associated to the presheaf
$$
V
\longmapsto
\coprod\nolimits_{\varphi \in \text{Mor}_{\mathcal{C}}(V, U)}
\mathcal{G}(V \xrightarrow{\varphi} U)
$$
Hence there is a natural map
$j^{Sh}_{U!}\mathcal{G} \to j_{U!}\mathcal{G}$ of sheaves of sets.
Hence precomposing $\beta$ by this map we get a map of sheaves of sets
$j^{Sh}_{U!}\mathcal{G} \to \mathcal{F}$ which by adjunction corresponds
to a map of sheaves of sets $\beta' : \mathcal{G} \to \mathcal{F}|_U$.
We claim that $\beta'$ is $\mathcal{O}_U$-linear. Namely, suppose
that $\varphi : V \to U$ is an object of $\mathcal{C}/U$ and that
$s, s' \in \mathcal{G}(\varphi : V \to U)$, and
$f \in \mathcal{O}(V) = \mathcal{O}_U(\varphi : V \to U)$.
Then by the discussion above we see that 
$\beta'(s + s')$, resp.\  $\beta'(fs)$ in $\mathcal{F}|_U(\varphi : V \to U)$
correspond to $\beta(s + s')$, resp.\ $\beta(fs)$ in
$\mathcal{F}(V)$. Since $\beta$ is a homomorphism we conclude.

\medskip\noindent
To conclude the proof of the lemma we have to show that the constructions
$\alpha \mapsto \alpha'$ and $\beta \mapsto \beta'$ are mutually inverse.
We omit the verifications.
\end{proof}

\begin{lemma}
\label{lemma-extension-by-zero-exact}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site.
Let $U \in \text{Ob}(\mathcal{C})$.
The functor
$j_{U!} : \textit{Mod}(\mathcal{O}_U) \to \textit{Mod}(\mathcal{O})$
is exact.
\end{lemma}

\begin{proof}
Since $j_{U!}$ is a left adjoint to $j_U^*$ we see that it is right exact
(see Categories Lemma \ref{categories-lemma-exact-adjoint}
and Homology, Section \ref{homology-section-functors}).
Hence it suffices to show that if $\mathcal{G}_1 \to \mathcal{G}_2$
is an injective map of $\mathcal{O}_U$-modules, then
$j_{U!}\mathcal{G}_1 \to j_{U!}\mathcal{G}_2$ is injective.
The map on sections of presheaves over an object $V$
(as in Lemma \ref{lemma-extension-by-zero}) is the map
$$
\bigoplus\nolimits_{\varphi \in \text{Mor}_{\mathcal{C}}(V, U)}
\mathcal{G}_1(V \xrightarrow{\varphi} U)
\longrightarrow
\bigoplus\nolimits_{\varphi \in \text{Mor}_{\mathcal{C}}(V, U)}
\mathcal{G}_2(V \xrightarrow{\varphi} U)
$$
which is injective by assumption. Since sheafification is exact (by
Lemma \ref{lemma-sheafification-presheaf-modules}
it agrees with sheafication of presheaves on sets, which is exact
by Sites, Lemma \ref{sites-lemma-sheafification-exact}) we win.
\end{proof}

\begin{remark}
\label{remark-localization-presheaves}
Localization and presheaves of modules.
Let $\mathcal{C}$ be a category.
let $\mathcal{O}$ be a presheaf of rings.
Let $U$ be an object of $\mathcal{C}$.
Strictly speaking the functors $j_U^*$, $j_{U*}$ and $j_{U!}$
have not been defined for presheaves of $\mathcal{O}$-modules.
But of course, we can think of a presheaf as a sheaf for the
discrete topology on $\mathcal{C}$ (only coverings are isomorphisms).
Hence we also obtain a functor
$$
j_U^* :
\textit{PMod}(\mathcal{O})
\longrightarrow
\textit{PMod}(\mathcal{O}_U)
$$
and functors
$$
j_{U*}, j_{U!} :
\textit{PMod}(\mathcal{O}_U)
\longrightarrow
\textit{PMod}(\mathcal{O})
$$
which are right, left adjoint to $j_U^*$. Inspecting the proof of
Lemma \ref{lemma-extension-by-zero} we see that $j_{U!}\mathcal{G}$
is the presheaf
$$
V \longmapsto
\bigoplus\nolimits_{\varphi \in \text{Mor}_{\mathcal{C}}(V, U)}
\mathcal{G}(V \xrightarrow{\varphi} U)
$$
In addition the functor $j_{U!}$ is exact (by
Lemma \ref{lemma-extension-by-zero-exact} in the
case of the discrete topologies). Moreover, if $\mathcal{C}$
is actually a site, and $\mathcal{O}$ is actually a sheaf of rings,
then the diagram
$$
\xymatrix{
\textit{Mod}(\mathcal{O}_U) \ar[r]_{j_{U!}} \ar[d]_{forget} &
\textit{Mod}(\mathcal{O}) \\
\textit{PMod}(\mathcal{O}_U) \ar[r]^{j_{U!}} &
\textit{PMod}(\mathcal{O}) \ar[u]_{(\ )^\#}
}
$$
commutes.
\end{remark}









\section{Local types of modules}
\label{section-local}

\noindent
According to our general strategy explained in Section \ref{section-intrinsic}
we first define the local types for sheaves of modules on a ringed site, and
then we immediately show that these types are intrinsic, hence make sense
for sheaves of modules on ringed topoi.

\begin{definition}
\label{definition-site-local}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site.
Let $\mathcal{F}$ be a sheaf of $\mathcal{O}$-modules.
We will freely use the notions defined in
Definition \ref{definition-global}.
\begin{enumerate}
\item We say $\mathcal{F}$ is {\it locally free}
if for every object $U$ of $\mathcal{C}$ there exists a covering
$\{U_i \to U\}_{i \in I}$ of $\mathcal{C}$ such that each restriction
$\mathcal{F}|_{\mathcal{C}/U_i}$ is a free
$\mathcal{O}_{U_i}$-module.
\item We say $\mathcal{F}$ is {\it finite locally free}
if for every object $U$ of $\mathcal{C}$ there exists a covering
$\{U_i \to U\}_{i \in I}$ of $\mathcal{C}$ such that each restriction
$\mathcal{F}|_{\mathcal{C}/U_i}$ is a finite free
$\mathcal{O}_{U_i}$-module.
\item We say $\mathcal{F}$ is {\it locally generated by sections}
if for every object $U$ of $\mathcal{C}$ there exists a covering
$\{U_i \to U\}_{i \in I}$ of $\mathcal{C}$ such that each restriction
$\mathcal{F}|_{\mathcal{C}/U_i}$ is an
$\mathcal{O}_{U_i}$-module generated by global sections.
\item We say $\mathcal{F}$ is {\it of finite type}
if for every object $U$ of $\mathcal{C}$ there exists a covering
$\{U_i \to U\}_{i \in I}$ of $\mathcal{C}$ such that each restriction
$\mathcal{F}|_{\mathcal{C}/U_i}$ is an
$\mathcal{O}_{U_i}$-module generated by finitely many global sections.
\item We say $\mathcal{F}$ is {\it quasi-coherent}
if for every object $U$ of $\mathcal{C}$ there exists a covering
$\{U_i \to U\}_{i \in I}$ of $\mathcal{C}$ such that each restriction
$\mathcal{F}|_{\mathcal{C}/U_i}$ is an
$\mathcal{O}_{U_i}$-module which has a global presentation.
\item We say $\mathcal{F}$ is {\it of finite presentation}
if for every object $U$ of $\mathcal{C}$ there exists a covering
$\{U_i \to U\}_{i \in I}$ of $\mathcal{C}$ such that each restriction
$\mathcal{F}|_{\mathcal{C}/U_i}$ is an
$\mathcal{O}_{U_i}$-module which has a finite global presentation.
\item We say $\mathcal{F}$ is {\it coherent} if and only if
$\mathcal{F}$ is of finite type, and for every object
$U$ of $\mathcal{C}$ and any $s_1, \ldots, s_n \in \mathcal{F}(U)$
the kernel of the map
$\bigoplus_{i = 1, \ldots, n} \mathcal{O}_U \to \mathcal{F}|_U$
is of finite type on $(\mathcal{C}/U, \mathcal{O}_U)$.
\end{enumerate}
\end{definition}

\begin{lemma}
\label{lemma-special-locally-free}
Any of the properties (1) -- (7) of Definition \ref{definition-site-local}
is intrinsic (see discussion in Section \ref{section-intrinsic}).
\end{lemma}

\begin{proof}
Let $\mathcal{C}$, $\mathcal{D}$ be sites.
Let $u : \mathcal{C} \to \mathcal{D}$ be a special cocontinuous functor.
Let $\mathcal{O}$ be a sheaf of rings on $\mathcal{C}$.
Let $\mathcal{F}$ be a sheaf of $\mathcal{O}$-modules on $\mathcal{C}$.
Let $g : \textit{Sh}(\mathcal{C}) \to \textit{Sh}(\mathcal{D})$
be the equivalence of topoi associated to $u$.
Set $\mathcal{O}' = g_*\mathcal{O}$, and let
$g^\sharp : \mathcal{O}' \to g_*\mathcal{O}$ be the identity.
Finally, set $\mathcal{F}' = g_*\mathcal{F}$.
Let $\mathcal{P}_l$ be one of the properties (1) -- (6) listed in
Definition \ref{definition-site-local}.
(We will discuss the coherent case at the end of the proof.)
Let $\mathcal{P}_g$ denote the corresponding property listed in
Definition \ref{definition-global}. We have already seen that
$\mathcal{P}_g$ is intrinsic.
We have to show that
$\mathcal{P}_l(\mathcal{C}, \mathcal{O}, \mathcal{F})$
holds if and only if
$\mathcal{P}_l(\mathcal{D}, \mathcal{O}', \mathcal{F}')$
holds.

\medskip\noindent
Assume that $\mathcal{F}$ has $\mathcal{P}_l$.
Let $V$ be an object of $\mathcal{D}$.
One of the properties of a special cocontinuous functor is that there exists
a covering $\{u(U_i) \to V\}_{i \in I}$ in the site $\mathcal{D}$.
By assumption, for each $i$ there exists a covering
$\{U_{ij} \to U_i\}_{j \in J_i}$ in $\mathcal{C}$ such that
each restriction $\mathcal{F}|_{U_{ij}}$ is $\mathcal{P}_g$.
By Sites, Lemma \ref{sites-lemma-special-cocontinuous-localization}
we have commutative diagrams of ringed topoi
$$
\xymatrix{
(\textit{Sh}(\mathcal{C}/U_{ij}), \mathcal{O}_{U_{ij}}) \ar[r] \ar[d] &
(\textit{Sh}(\mathcal{C}), \mathcal{O}) \ar[d] \\
(\textit{Sh}(\mathcal{D}/u(U_{ij})), \mathcal{O}'_{u(U_{ij})}) \ar[r] &
(\textit{Sh}(\mathcal{D}), \mathcal{O}')
}
$$
where the vertical arrows are equivalences. Hence we conclude that
$\mathcal{F}'|_{u(U_{ij})}$ has property $\mathcal{P}_g$ also.
And moreover, $\{u(U_{ij}) \to V\}_{i \in I, j \in J_i}$ is a
covering of the site $\mathcal{D}$. Hence $\mathcal{F}'$ has
property $\mathcal{P}_l$.

\medskip\noindent
Assume that $\mathcal{F}'$ has $\mathcal{P}_l$.
Let $U$ be an object of $\mathcal{C}$.
By assumption, there exists a covering
$\{V_i \to u(U)\}_{i \in I}$ such that $\mathcal{F}'|_{V_i}$
has property $\mathcal{P}_g$. Because $u$ is cocontinuous we
can refine this covering by a family $\{u(U_j) \to u(U)\}_{j \in J}$
where $\{U_j \to U\}_{j \in J}$ is a covering in $\mathcal{C}$.
Say the refinement is given by $\alpha : J \to I$ and
$u(U_j) \to V_{\alpha(j)}$.
Restricting is transitive, i.e.,
$(\mathcal{F}'|_{V_{\alpha(j)}})|_{u(U_j)} = \mathcal{F}'|_{u(U_j)}$.
Hence by Lemma \ref{lemma-global-pullback} we see that
$\mathcal{F}'|_{u(U_j)}$ has property $\mathcal{P}_g$.
Hence the diagram
$$
\xymatrix{
(\textit{Sh}(\mathcal{C}/U_{j}), \mathcal{O}_{U_{j}}) \ar[r] \ar[d] &
(\textit{Sh}(\mathcal{C}), \mathcal{O}) \ar[d] \\
(\textit{Sh}(\mathcal{D}/u(U_{j})), \mathcal{O}'_{u(U_{j})})
\ar[r] &
(\textit{Sh}(\mathcal{D}), \mathcal{O}')
}
$$
where the vertical arrows are equivalences shows that $\mathcal{F}|_{U_j}$
has property $\mathcal{P}_g$ also. Thus $\mathcal{F}$ has
property $\mathcal{P}_l$ as desired.

\medskip\noindent
Finally, we prove the lemma in case
$\mathcal{P}_l = coherent$\footnote{Although mechanical this proof
is a bit awkward, and we suggest the reader skip this part of the proof.}.
Assume $\mathcal{F}$ is coherent. This implies that $\mathcal{F}$
is of finite type and hence $\mathcal{F}'$ is of finite type also by the
first part of the proof. Let $V$ be an object of $\mathcal{D}$ and let
$s_1, \ldots, s_n \in \mathcal{F}'(V)$. We have to show that the kernel
$\mathcal{K}'$ of
$\bigoplus_{j = 1, \ldots, n} \mathcal{O}_V \to \mathcal{F}'|_V$
is of finite type on $\mathcal{D}/V$. This means we have to show that
for any $V'/V$ there exists a covering $\{V'_i \to V'\}$ such that
$\mathcal{F}'|_{V'_i}$ is generated by finitely many sections.
Replacing $V$ by $V'$ (and restricting the sections $s_j$ to $V'$)
we reduce to the case where $V' = V$. Since $u$ is a special
cocontinuous functor, there exists a covering $\{u(U_i) \to V\}_{i \in I}$
in the site $\mathcal{D}$. Using the isomorphism of topoi
$\textit{Sh}(\mathcal{C}/U_i) = \textit{Sh}(\mathcal{D}/u(U_i))$
we see that $\mathcal{K}'|_{u(U_i)}$ corresponds to the kernel
$\mathcal{K}_i$ of a map
$\bigoplus_{j = 1, \ldots, n} \mathcal{O}_{U_i} \to \mathcal{F}|_{U_i}$.
Since $\mathcal{F}$ is coherent we see that $\mathcal{K}_i$
is of finite type. Hence we conclude (by the first part of the proof again)
that $\mathcal{K}|_{u(U_i)}$ is of finite type. Thus there exist coverings
$\{V_{il} \to u(U_i)\}$ such that $\mathcal{K}|_{V_{il}}$ is generated
by finitely many global sections. Since
$\{V_{il} \to V\}$ is a covering of $\mathcal{D}$ we conclude that
$\mathcal{K}$ is of finite type as desired.

\medskip\noindent
Assume $\mathcal{F}'$ is coherent. This implies that $\mathcal{F}'$
is of finite type and hence $\mathcal{F}$ is of finite type also by the
first part of the proof. Let $U$ be an object of $\mathcal{C}$, and let
$s_1, \ldots, s_n \in \mathcal{F}(U)$. We have to show that the kernel
$\mathcal{K}$ of
$\bigoplus_{j = 1, \ldots, n} \mathcal{O}_U \to \mathcal{F}|_U$
is of finite type on $\mathcal{C}/U$. Using the isomorphism of topoi
$\textit{Sh}(\mathcal{C}/U) = \textit{Sh}(\mathcal{D}/u(U))$
we see that $\mathcal{K}|_{U}$ corresponds to the kernel
$\mathcal{K}'$ of a map
$\bigoplus_{j = 1, \ldots, n} \mathcal{O}_{u(U)} \to \mathcal{F}'|_{u(U)}$.
As $\mathcal{F}'$ is coherent, we see that $\mathcal{K}'$ is of finite
type. Hence, by the first part of the proof again, we conclude
that $\mathcal{K}$ is of finite type.
\end{proof}

\noindent
Hence from now on we may refer to the properties of $\mathcal{O}$-modules
defined in Definition \ref{definition-site-local} without specifying a site.

\begin{lemma}
\label{lemma-local-final-object}
Let $(\textit{Sh}(\mathcal{C}), \mathcal{O})$
be a ringed topos. Let $\mathcal{F}$ be an $\mathcal{O}$-module.
Assume that the site $\mathcal{C}$ has a final object $X$.
Then
\begin{enumerate}
\item The following are equivalent
\begin{enumerate}
\item $\mathcal{F}$ is locally free,
\item there exists a covering $\{X_i \to X\}$ in $\mathcal{C}$ such that
each restriction $\mathcal{F}|_{\mathcal{C}/X_i}$ is a locally free
$\mathcal{O}_{X_i}$-module, and
\item there exists a covering $\{X_i \to X\}$ in $\mathcal{C}$ such that
each restriction $\mathcal{F}|_{\mathcal{C}/X_i}$ is a free
$\mathcal{O}_{X_i}$-module.
\end{enumerate}
\item The following are equivalent
\begin{enumerate}
\item $\mathcal{F}$ is finite locally free,
\item there exists a covering $\{X_i \to X\}$ in $\mathcal{C}$
such that each restriction $\mathcal{F}|_{\mathcal{C}/X_i}$
is a finite locally free $\mathcal{O}_{X_i}$-module, and
\item there exists a covering $\{X_i \to X\}$ in $\mathcal{C}$
such that each restriction $\mathcal{F}|_{\mathcal{C}/X_i}$
is a finite free $\mathcal{O}_{X_i}$-module.
\end{enumerate}
\item The following are equivalent
\begin{enumerate}
\item $\mathcal{F}$ is locally generated by sections,
\item there exists a covering $\{X_i \to X\}$ in $\mathcal{C}$
such that each restriction $\mathcal{F}|_{\mathcal{C}/X_i}$
is an $\mathcal{O}_{X_i}$-module locally generated by sections, and
\item there exists a covering $\{X_i \to X\}$ in $\mathcal{C}$
such that each restriction $\mathcal{F}|_{\mathcal{C}/X_i}$
is an $\mathcal{O}_{X_i}$-module globally generated by sections.
\end{enumerate}
\item The following are equivalent
\begin{enumerate}
\item $\mathcal{F}$ is of finite type,
\item there exists a covering $\{X_i \to X\}$ in $\mathcal{C}$
such that each restriction $\mathcal{F}|_{\mathcal{C}/X_i}$
is an $\mathcal{O}_{X_i}$-module of finite type, and
\item there exists a covering $\{X_i \to X\}$ in $\mathcal{C}$
such that each restriction $\mathcal{F}|_{\mathcal{C}/X_i}$
is an $\mathcal{O}_{X_i}$-module globally generated by finitely many sections.
\end{enumerate}
\item The following are equivalent
\begin{enumerate}
\item $\mathcal{F}$ is quasi-coherent,
\item there exists a covering $\{X_i \to X\}$ in $\mathcal{C}$
such that each restriction $\mathcal{F}|_{\mathcal{C}/X_i}$
is a quasi-coherent $\mathcal{O}_{X_i}$-module, and
\item there exists a covering $\{X_i \to X\}$ in $\mathcal{C}$
such that each restriction $\mathcal{F}|_{\mathcal{C}/X_i}$
is an $\mathcal{O}_{X_i}$-module which has a global presentation.
\end{enumerate}
\item The following are equivalent
\begin{enumerate}
\item $\mathcal{F}$ is of finite presentation,
\item there exists a covering $\{X_i \to X\}$ in $\mathcal{C}$
such that each restriction $\mathcal{F}|_{\mathcal{C}/X_i}$
is an $\mathcal{O}_{X_i}$-module of finite presentation, and
\item there exists a covering $\{X_i \to X\}$ in $\mathcal{C}$
such that each restriction $\mathcal{F}|_{\mathcal{C}/X_i}$
is an $\mathcal{O}_{X_i}$-module has a finite global presentation.
\end{enumerate}
\item The following are equivalent
\begin{enumerate}
\item $\mathcal{F}$ is coherent, and
\item there exists a covering $\{X_i \to X\}$ in $\mathcal{C}$
such that each restriction $\mathcal{F}|_{\mathcal{C}/X_i}$
is a coherent $\mathcal{O}_{X_i}$-module.
\end{enumerate}
\end{enumerate}
\end{lemma}

\begin{proof}
In each case we have (a) $\Rightarrow (b)$. In each of the cases (1) - (6)
condition (b) implies condition (c) by axiom (2) of a site
(see Sites, Definition \ref{sites-definition-site})
and the definition of the local types of modules.
Suppose $\{X_i \to X\}$ is a covering.
Then for every object $U$ of $\mathcal{C}$ we get an
induced covering $\{X_i \times_X U \to U\}$. Moreover, the global
property for $\mathcal{F}|_{\mathcal{C}/X_i}$ in part (c) implies
the corresponding global property for
$\mathcal{F}|_{\mathcal{C}/X_i \times_X U}$ by
Lemma \ref{lemma-global-pullback}, hence the sheaf has property (a)
by definition. We omit the proof of (b) $\Rightarrow$ (a) in case (7).
\end{proof}

\begin{lemma}
\label{lemma-local-pullback}
Let
$(f, f^\sharp) :
(\textit{Sh}(\mathcal{C}), \mathcal{O}_{\mathcal{C}})
\to
(\textit{Sh}(\mathcal{D}), \mathcal{O}_{\mathcal{D}})$
be a morphism of ringed topoi.
Let $\mathcal{F}$ be an $\mathcal{O}_{\mathcal{D}}$-module.
\begin{enumerate}
\item If $\mathcal{F}$ is locally free then $f^*\mathcal{F}$ is locally free.
\item If $\mathcal{F}$ is finite locally free then $f^*\mathcal{F}$ is
finite locally free.
\item If $\mathcal{F}$ is locally generated by sections
then $f^*\mathcal{F}$ is locally generated by sections.
\item If $\mathcal{F}$ is of finite type
then $f^*\mathcal{F}$ is of finite type.
\item If $\mathcal{F}$ is quasi-coherent then
$f^*\mathcal{F}$ is quasi-coherent.
\item If $\mathcal{F}$ is of finite presentation
then $f^*\mathcal{F}$ is of finite presentation.
\end{enumerate}
\end{lemma}

\begin{proof}
According to the discussion in Section \ref{section-intrinsic}
we need only check preservation under pullback for a morphism of ringed sites
$(f, f^\sharp) :
(\mathcal{C}, \mathcal{O}_{\mathcal{C}})
\to
(\mathcal{D}, \mathcal{O}_{\mathcal{D}})$
such that $f$ is given by a left exact, continuous functor
$u : \mathcal{D} \to \mathcal{C}$ between sites which have 
all finite limits.
Let $\mathcal{G}$ be a sheaf of $\mathcal{O}_{\mathcal{D}}$-modules
which has one of the properties (1) -- (6) of
Definition \ref{definition-site-local}.
We know $\mathcal{D}$ has a final object $Y$ and $X = u(Y)$
is a final object for $\mathcal{C}$. By assumption we have
a covering $\{Y_i \to Y\}$ such that $\mathcal{G}|_{\mathcal{D}/Y_i}$
has the corresponding global property. Set $X_i = u(Y_i)$ so
that $\{X_i \to X\}$ is a covering in $\mathcal{C}$.
We get a commutative diagram of morphisms ringed sites
$$
\xymatrix{
(\mathcal{C}/X_i, \mathcal{O}_{\mathcal{C}}|_{X_i}) \ar[r] \ar[d] &
(\mathcal{C}, \mathcal{O}_{\mathcal{C}}) \ar[d] \\
(\mathcal{D}/Y_i, \mathcal{O}_{\mathcal{D}}|_{Y_i}) \ar[r] &
(\mathcal{D}, \mathcal{O}_{\mathcal{D}})
}
$$
by Sites, Lemma \ref{sites-lemma-morphism-sites-localization-strong}.
Hence by Lemma \ref{lemma-global-pullback}
that $f^*\mathcal{G}|_{X_i}$ has the corresponding global
property. Hence we conclude that $\mathcal{G}$ has the local
property we started out with by Lemma \ref{lemma-local-final-object}.
\end{proof}







\section{Tensor product and internal hom}
\label{section-tensor-and-internal-hom}

\noindent
In Sections \ref{section-presheaves-modules} and
\ref{section-sheaves-modules}
we defined the change of rings functor by a tensor
product construction. To be sure this construction makes sense also
to define the tensor product of presheaves of $\mathcal{O}$-modules.
To be precise, suppose $\mathcal{C}$ is a category,
$\mathcal{O}$ is a presheaf of rings, and $\mathcal{F}$, $\mathcal{G}$
are presheaves of $\mathcal{O}$-modules. In this case we define
$\mathcal{F} \otimes_{p, \mathcal{O}} \mathcal{G}$ to be the presheaf
$$
U
\longmapsto
(\mathcal{F} \otimes_{p, \mathcal{O}} \mathcal{G})(U)
=
\mathcal{F}(U) \otimes_{\mathcal{O}(U)} \mathcal{G}(U)
$$
If $\mathcal{C}$ is a site, $\mathcal{O}$ is a sheaf of rings and
$\mathcal{F}$, $\mathcal{G}$ are sheaves of $\mathcal{O}$-modules
then we define
$$
\mathcal{F} \otimes_{\mathcal{O}} \mathcal{G}
=
(\mathcal{F} \otimes_{p, \mathcal{O}} \mathcal{G})^\#
$$
to be the sheaf of $\mathcal{O}$-modules associated to the presheaf
$\mathcal{F} \otimes_{p, \mathcal{O}} \mathcal{G}$.

\medskip\noindent
Here are some formulas which we will use below without further mention:
$$
(\mathcal{F}
\otimes_{p, \mathcal{O}} \mathcal{G})
\otimes_{p, \mathcal{O}} \mathcal{H}
=
\mathcal{F}
\otimes_{p, \mathcal{O}} (\mathcal{G}
\otimes_{p, \mathcal{O}} \mathcal{H}),
$$
and similarly for sheaves.
If $\mathcal{O}_1 \to \mathcal{O}_2$ is a map of presheaves of rings,
then
$$
(\mathcal{F} \otimes_{p, \mathcal{O}_1} \mathcal{G})
\otimes_{p, \mathcal{O}_1} \mathcal{O}_2 =
(\mathcal{F} \otimes_{p, \mathcal{O}_1} \mathcal{O}_2)
\otimes_{p, \mathcal{O}_2}
(\mathcal{G} \otimes_{p, \mathcal{O}_1} \mathcal{O}_2),
$$
and similarly for sheaves.
These follow from their algebraic counterparts and sheafification.

\medskip\noindent
Let $\mathcal{C}$ be a site, let $\mathcal{O}$ be a sheaf of rings and let
$\mathcal{F}$, $\mathcal{G}$, $\mathcal{H}$ be sheaves of
$\mathcal{O}$-modules. In this case we define
$$
\text{Bilin}_{\mathcal{O}}(\mathcal{F} \times \mathcal{G}, \mathcal{H})
=
\{\varphi \in
\text{Mor}_{\textit{Sh}(\mathcal{C})}(
\mathcal{F} \times \mathcal{G}, \mathcal{H}) \mid
\varphi \text{ is }\mathcal{O}\text{-bilinear}\}.
$$
With this definition we have
$$
\text{Hom}_{\mathcal{O}}
(\mathcal{F} \otimes_{\mathcal{O}} \mathcal{G}, \mathcal{H})
=
\text{Bilin}_{\mathcal{O}}(\mathcal{F} \times \mathcal{G}, \mathcal{H}).
$$
In other words $\mathcal{F} \otimes_{\mathcal{O}} \mathcal{G}$
represents the functor which associates to $\mathcal{H}$ the set
of bilinear maps $\mathcal{F} \times \mathcal{G} \to \mathcal{H}$.
In particular, since the notion of a bilinear map makes sense for
a pair of modules on a ringed topos, we see that the tensor
product of sheaves of modules is intrinsic to the topos (compare
the discussion in Section \ref{section-intrinsic}). In fact we
have the following.

\begin{lemma}
\label{lemma-tensor-product-pullback}
Let $f : (\textit{Sh}(\mathcal{C}), \mathcal{O}_{\mathcal{C}})
\to (\textit{Sh}(\mathcal{D}), \mathcal{O}_{\mathcal{D}})$ be
a morphism of ringed topoi. Let $\mathcal{F}$, $\mathcal{G}$
be $\mathcal{O}_{\mathcal{D}}$-modules. Then
$f^*(\mathcal{F} \otimes_{\mathcal{O}_{\mathcal{D}}} \mathcal{G})
= f^*\mathcal{F} \otimes_{\mathcal{O}_{\mathcal{C}}} f^*\mathcal{G}$
functorially in $\mathcal{F}$, $\mathcal{G}$.
\end{lemma}

\begin{proof}
For a sheaf $\mathcal{H}$ of $\mathcal{O}_{\mathcal{C}}$ modules we
have
\begin{align*}
\text{Hom}_{\mathcal{O}_{\mathcal{C}}}(
f^*(\mathcal{F} \otimes_{\mathcal{O}} \mathcal{G}), \mathcal{H})
& =
\text{Hom}_{\mathcal{O}_{\mathcal{D}}}(
\mathcal{F} \otimes_{\mathcal{O}} \mathcal{G}, f_*\mathcal{H}) \\
& =
\text{Bilin}_{\mathcal{O}_{\mathcal{D}}}(
\mathcal{F} \times \mathcal{G}, f_*\mathcal{H}) \\
& =
\text{Bilin}_{f^{-1}\mathcal{O}_{\mathcal{D}}}(
f^{-1}\mathcal{F} \times f^{-1}\mathcal{G}, \mathcal{H}) \\
& =
\text{Hom}_{f^{-1}\mathcal{O}_{\mathcal{D}}}(
f^{-1}\mathcal{F} \otimes_{f^{-1}\mathcal{O}_{\mathcal{D}}} f^{-1}\mathcal{G},
\mathcal{H}) \\
& =
\text{Hom}_{\mathcal{O}_{\mathcal{C}}}(
f^*\mathcal{F} \otimes_{f^*\mathcal{O}_{\mathcal{D}}} f^*\mathcal{G},
\mathcal{H})
\end{align*}
The interesting ``$=$'' in this sequence of equalities is the 
third equality. It follows from the definition and adjointness of
$f_*$ and $f^{-1}$ (as discussed in previous sections) in a
straightforward manner.
\end{proof}

\noindent
Let $\mathcal{C}$ be a category and let $\mathcal{O}$ be a presheaf
of rings. Let $\mathcal{F}$, $\mathcal{G}$ be presheaves of
$\mathcal{O}$-modules. Consider the rule
$$
U \longmapsto \text{Hom}_{\mathcal{O}_U}(\mathcal{F}|_U, \mathcal{G}|_U).
$$
For $\varphi : V \to U$ in $\mathcal{C}$ we define a restriction mapping
$$
\text{Hom}_{\mathcal{O}_U}(\mathcal{F}|_U, \mathcal{G}|_U)
\longrightarrow
\text{Hom}_{\mathcal{O}_V}(\mathcal{F}|_V, \mathcal{G}|_V)
$$
by restricting via the relocalization morphism
$j : \mathcal{C}/V \to \mathcal{C}/U$, see
Sites, Lemma \ref{sites-lemma-relocalize}. Hence this defines a
presheaf $\textit{Hom}_{\mathcal{O}}(\mathcal{F}, \mathcal{G})$.
In addition, given an element
$\varphi \in \text{Hom}_{\mathcal{O}|_U}(\mathcal{F}|_U, \mathcal{G}|_U)$
and a section $f \in \mathcal{O}(U)$ then we can define
$f\varphi \in \text{Hom}_{\mathcal{O}|_U}(\mathcal{F}|_U, \mathcal{G}|_U)$
by either precomposing with multiplication by $f$ on $\mathcal{F}|_U$
or postcomposing with multiplication by $f$ on $\mathcal{G}|_U$ (it gives
the same result). Hence we in fact get a presheaf of $\mathcal{O}$-modules.
There is a canonical ``evaluation'' morphism
$$
\mathcal{F}
\otimes_{p, \mathcal{O}}
\textit{Hom}_{\mathcal{O}}(\mathcal{F}, \mathcal{G})
\longrightarrow
\mathcal{G}.
$$

\begin{lemma}
\label{lemma-internal-hom}
If $\mathcal{C}$ is a site, $\mathcal{O}$ is a sheaf of rings
and $\mathcal{G}$ is a sheaf of $\mathcal{O}$-modules, then
$\textit{Hom}_{\mathcal{O}}(\mathcal{F}, \mathcal{G})$
is a sheaf of $\mathcal{O}$-modules.
\end{lemma}

\begin{proof}
Omitted. Hint: Note first that
$\textit{Hom}_{\mathcal{O}}(\mathcal{F}, \mathcal{G})
= \textit{Hom}_{\mathcal{O}}(\mathcal{F}^\#, \mathcal{G})$, which reduces
the question to the case where both $\mathcal{F}$ and $\mathcal{G}$
are sheaves.
\end{proof}

\noindent
In the situation of the lemma the ``evaluation'' morphism
factors through the tensor product of sheaves of modules
$$
\mathcal{F}
\otimes_\mathcal{O}
\textit{Hom}_{\mathcal{O}}(\mathcal{F}, \mathcal{G})
\longrightarrow
\mathcal{G}.
$$

\begin{lemma}
\label{lemma-internal-hom-commute-limits}
Internal hom and (co)limits.
Let $\mathcal{C}$ be a category and let $\mathcal{O}$ be a presheaf of rings.
\begin{enumerate}
\item For any presheaf of $\mathcal{O}$-modules $\mathcal{F}$ the functor
$$
\textit{PMod}(\mathcal{O}) \longrightarrow \textit{PMod}(\mathcal{O})
,\quad
\mathcal{G} \longmapsto \textit{Hom}_{\mathcal{O}}(\mathcal{F}, \mathcal{G})
$$
commutes with arbitrary limits.
\item For any presheaf of $\mathcal{O}$-modules $\mathcal{G}$ the functor
$$
\textit{PMod}(\mathcal{O}) \longrightarrow \textit{PMod}(\mathcal{O})^{opp}
,\quad
\mathcal{F} \longmapsto \textit{Hom}_{\mathcal{O}}(\mathcal{F}, \mathcal{G})
$$
commutes with arbitrary colimits, in a formula
$$
\textit{Hom}_{\mathcal{O}}(\text{colim}_i\ \mathcal{F}_i, \mathcal{G})
=
\text{lim}_i\ \textit{Hom}_{\mathcal{O}}(\mathcal{F}_i, \mathcal{G}).
$$
\end{enumerate}
Suppose that $\mathcal{C}$ is a site, and $\mathcal{O}$ is a sheaf of rings.
\begin{enumerate}
\item[(3)] For any sheaf of $\mathcal{O}$-modules $\mathcal{F}$ the functor
$$
\textit{Mod}(\mathcal{O}) \longrightarrow \textit{Mod}(\mathcal{O})
,\quad
\mathcal{G} \longmapsto \textit{Hom}_{\mathcal{O}}(\mathcal{F}, \mathcal{G})
$$
commutes with arbitrary limits.
\item[(4)] For any sheaf of $\mathcal{O}$-modules $\mathcal{G}$ the functor
$$
\textit{Mod}(\mathcal{O}) \longrightarrow \textit{Mod}(\mathcal{O})^{opp}
,\quad
\mathcal{F} \longmapsto \textit{Hom}_{\mathcal{O}}(\mathcal{F}, \mathcal{G})
$$
commutes with arbitrary colimits, in a formula
$$
\textit{Hom}_{\mathcal{O}}(\text{colim}_i\ \mathcal{F}_i, \mathcal{G})
=
\text{lim}_i\ \textit{Hom}_{\mathcal{O}}(\mathcal{F}_i, \mathcal{G}).
$$
\end{enumerate}
\end{lemma}

\begin{proof}
Let $\mathcal{I} \to \textit{PMod}(\mathcal{O})$, $i \mapsto \mathcal{G}_i$
be a diagram. Let $U$ be an object of the category $\mathcal{C}$.
As $j_U^*$ is both a left and a right adjoint we see that
$\text{lim}_i\ j_U^*\mathcal{G}_i = j_U^* \text{lim}_i\ \mathcal{G}_i$.
Hence we have
\begin{align*}
\textit{Hom}_{\mathcal{O}}(\mathcal{F}, \text{lim}_i\ \mathcal{G}_i)(U)
& =
\text{Hom}_{\mathcal{O}_U}(\mathcal{F}|_U, \text{lim}_i\ \mathcal{G}_i|_U) \\
& =
\text{lim}_i\ \text{Hom}_{\mathcal{O}_U}(\mathcal{F}|_U, \mathcal{G}_i|_U) \\
& = \text{lim}_i\ \textit{Hom}_{\mathcal{O}}(\mathcal{F}, \mathcal{G}_i)(U)
\end{align*}
by definition of a limit. This proves (1). Part (2) is proved in exactly the
same way. Part (3) follows from (1) because the limit of a diagram of sheaves 
is the same as the limit in the category of presheaves.
Finally, (4) follow because, in the formula we have
$$
\text{Mor}_{\textit{Mod}(\mathcal{O})}(
\text{colim}_i\ \mathcal{F}_i, \mathcal{G})
=
\text{Mor}_{\textit{PMod}(\mathcal{O})}(
\text{colim}^{PSh}_i\ \mathcal{F}_i, \mathcal{G})
$$
as the colimit $\text{colim}_i\ \mathcal{F}_i$ is the sheafification of
the colimit $\text{colim}^{PSh}_i\ \mathcal{F}_i$ in
$\textit{PMod}(\mathcal{O})$. Hence (4) follows from (2)
(by the remark on limits above again).
\end{proof}

\begin{lemma}
\label{lemma-internal-hom-adjoint-tensor}
Let $\mathcal{C}$ be a category. Let $\mathcal{O}$ be a presheaf of
rings.
\begin{enumerate}
\item Let $\mathcal{F}$, $\mathcal{G}$, $\mathcal{H}$ be
presheaves of $\mathcal{O}$-modules. There is a canonical isomorphism
$$
\textit{Hom}_{\mathcal{O}}
(\mathcal{F} \otimes_{p, \mathcal{O}} \mathcal{G}, \mathcal{H})
\longrightarrow
\textit{Hom}_{\mathcal{O}}
(\mathcal{F}, \textit{Hom}_{\mathcal{O}}(\mathcal{G}, \mathcal{H}))
$$
which is functorial in all three entries (sheaf Hom in
all three spots). In particular,
$$
\text{Mor}_{\textit{PMod}(\mathcal{O})}(
\mathcal{F} \otimes_{p, \mathcal{O}} \mathcal{G}, \mathcal{H})
=
\text{Mor}_{\textit{PMod}(\mathcal{O})}(
\mathcal{F}, \textit{Hom}_{\mathcal{O}}(\mathcal{G}, \mathcal{H}))
$$
\item
Suppose that $\mathcal{C}$ is a site, $\mathcal{O}$ is a sheaf of rings,
and $\mathcal{F}$, $\mathcal{G}$, $\mathcal{H}$ are sheaves of
$\mathcal{O}$-modules. There is a canonical isomorphism
$$
\textit{Hom}_{\mathcal{O}}
(\mathcal{F} \otimes_{\mathcal{O}} \mathcal{G}, \mathcal{H})
\longrightarrow
\textit{Hom}_{\mathcal{O}}
(\mathcal{F}, \textit{Hom}_{\mathcal{O}}(\mathcal{G}, \mathcal{H}))
$$
which is functorial in all three entries (sheaf Hom in
all three spots). In particular,
$$
\text{Mor}_{\textit{Mod}(\mathcal{O})}(
\mathcal{F} \otimes_{\mathcal{O}} \mathcal{G}, \mathcal{H})
=
\text{Mor}_{\textit{Mod}(\mathcal{O})}(
\mathcal{F}, \textit{Hom}_{\mathcal{O}}(\mathcal{G}, \mathcal{H}))
$$
\end{enumerate}
\end{lemma}

\begin{proof}
This is the analogue of
Algebra, Lemma \ref{algebra-lemma-hom-from-tensor-product}.
The proof is the same, and is omitted.
\end{proof}

\begin{lemma}
\label{lemma-tensor-commute-colimits}
Tensor product and (co)limits.
Let $\mathcal{C}$ be a category and let $\mathcal{O}$ be a presheaf of rings.
\begin{enumerate}
\item For any presheaf of $\mathcal{O}$-modules $\mathcal{F}$ the functor
$$
\textit{PMod}(\mathcal{O}) \longrightarrow \textit{PMod}(\mathcal{O})
,\quad
\mathcal{G} \longmapsto \mathcal{F} \otimes_{p, \mathcal{O}} \mathcal{G}
$$
commutes with arbitrary colimits.
\item
Suppose that $\mathcal{C}$ is a site, and $\mathcal{O}$ is a sheaf of rings.
For any sheaf of $\mathcal{O}$-modules $\mathcal{F}$ the functor
$$
\textit{PMod}(\mathcal{O}) \longrightarrow \textit{PMod}(\mathcal{O})
,\quad
\mathcal{G} \longmapsto \mathcal{F} \otimes_\mathcal{O} \mathcal{G}
$$
commutes with arbitrary colimits.
\end{enumerate}
\end{lemma}

\begin{proof}
This is because tensor product is adjoint to internal hom according
to Lemma \ref{lemma-internal-hom-adjoint-tensor}.
See Categories, Lemma \ref{categories-lemma-adjoint-exact}.
\end{proof}

\begin{lemma}
\label{lemma-tensor-product-permanence}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site.
Let $\mathcal{F}$, $\mathcal{G}$ be sheaves of $\mathcal{O}$-modules.
\begin{enumerate}
\item If $\mathcal{F}$, $\mathcal{G}$ are locally free,
so is $\mathcal{F} \otimes_\mathcal{O} \mathcal{G}$.
\item If $\mathcal{F}$, $\mathcal{G}$ are finite locally free,
so is $\mathcal{F} \otimes_\mathcal{O} \mathcal{G}$.
\item If $\mathcal{F}$, $\mathcal{G}$ are locally generated
by sections, so is $\mathcal{F}\otimes_\mathcal{O} \mathcal{G}$.
\item If $\mathcal{F}$, $\mathcal{G}$ are of finite type,
so is $\mathcal{F} \otimes_\mathcal{O} \mathcal{G}$.
\item If $\mathcal{F}$, $\mathcal{G}$ are quasi-coherent,
so is $\mathcal{F} \otimes_\mathcal{O} \mathcal{G}$.
\item If $\mathcal{F}$, $\mathcal{G}$ are of finite presentation,
so is $\mathcal{F} \otimes_\mathcal{O} \mathcal{G}$.
\item If $\mathcal{F}$ is of finite presentation and $\mathcal{G}$ is coherent,
then $\mathcal{F} \otimes_\mathcal{O} \mathcal{G}$ is coherent.
\item If $\mathcal{F}$, $\mathcal{G}$ are coherent,
so is $\mathcal{F} \otimes_\mathcal{O} \mathcal{G}$.
\end{enumerate}
\end{lemma}

\begin{proof}
Omitted. Hint: Compare with
Sheaves of Modules, Lemma \ref{modules-lemma-tensor-product-permanence}.
\end{proof}









\section{Flat modules}
\label{section-flat}

\noindent
We can define flat modules exactly as in the case of modules over rings.

\begin{definition}
\label{definition-flat}
Let $\mathcal{C}$ be a category.
Let $\mathcal{O}$ be a presheaf of rings.
\begin{enumerate}
\item A presheaf $\mathcal{F}$ of $\mathcal{O}$-modules is called
{\it flat} if the functor
$$
\textit{PMod}(\mathcal{O})
\longrightarrow
\textit{PMod}(\mathcal{O}), \quad
\mathcal{G} \mapsto \mathcal{G} \otimes_{p, \mathcal{O}} \mathcal{F}
$$
is exact.
\item If $\mathcal{C}$ is a site, $\mathcal{O}$ is a sheaf of rings
and $\mathcal{F}$ is a sheaf of $\mathcal{O}$-modules, then we
say $\mathcal{F}$ is {\it flat} if the functor
$$
\textit{Mod}(\mathcal{O})
\longrightarrow
\textit{Mod}(\mathcal{O}), \quad
\mathcal{G} \mapsto \mathcal{G} \otimes_{\mathcal{O}} \mathcal{F}
$$
is exact.
\end{enumerate}
\end{definition}

\noindent
The notion of a flat module is intrinsic (Section \ref{section-intrinsic}).

\begin{lemma}
\label{lemma-flatness-presheaves}
Let $\mathcal{C}$ be a category.
Let $\mathcal{O}$ be a presheaf of rings.
Let $\mathcal{F}$ be a presheaf of $\mathcal{O}$-modules.
If each $\mathcal{F}(U)$ is a flat $\mathcal{O}(U)$-module,
then $\mathcal{F}$ is flat.
\end{lemma}

\begin{proof}
This is immediate from the definitions.
\end{proof}

\begin{lemma}
\label{lemma-flatness-sheafification}
Let $\mathcal{C}$ be a category.
Let $\mathcal{O}$ be a presheaf of rings.
Let $\mathcal{F}$ be a presheaf of $\mathcal{O}$-modules.
If $\mathcal{F}$ is a flat $\mathcal{O}$-module, then
$\mathcal{F}^\#$ is a flat $\mathcal{O}^\#$-module.
\end{lemma}

\begin{proof}
Omitted. (Hint: Sheafification is exact.)
\end{proof}

\begin{lemma}
\label{lemma-colimits-flat}
(Colimits and tensor product.)
\begin{enumerate}
\item A directed colimit of flat presheaves of modules
is flat. A direct sum of flat presheaves of modules is flat.
\item A directed colimit of flat sheaves of modules is flat.
A direct sum of flat presheaves of modules is flat.
\end{enumerate}
\end{lemma}

\begin{proof}
Part (1) follows from Lemma \ref{lemma-tensor-commute-colimits} and
Algebra, Lemma \ref{algebra-lemma-directed-colimit-exact}
by looking at sections over objects.
To see part (2), use Lemma \ref{lemma-tensor-commute-colimits} and
the fact that a directed colimit of exact 
complexes is an exact complex (this uses that sheafification is exact
and commutes with colimits). Some details omitted.
\end{proof}

\begin{lemma}
\label{lemma-j-shriek-flat}
Let $\mathcal{C}$ be a category.
Let $\mathcal{O}$ be a presheaf of rings.
Let $U$ be an object of $\mathcal{C}$.
Consider the functor $j_U : \mathcal{C}/U \to \mathcal{C}$.
\begin{enumerate}
\item The presheaf of $\mathcal{O}$-modules
$j_{U!}\mathcal{O}_U$ (see Remark \ref{remark-localization-presheaves})
is flat.
\item If $\mathcal{C}$ is a site, $\mathcal{O}$ is a sheaf of rings,
$j_{U!}\mathcal{O}_U$ is a flat sheaf of $\mathcal{O}$-modules.
\end{enumerate}
\end{lemma}

\begin{proof}
Proof of (1). By the discussion in
Remark \ref{remark-localization-presheaves} we see that
$$
j_{U!}\mathcal{O}_U(V)
=
\bigoplus\nolimits_{\varphi \in \text{Mor}_{\mathcal{C}}(V, U)}
\mathcal{O}(V)
$$
which is a flat $\mathcal{O}(V)$-module. Hence (1) follows from
Lemma \ref{lemma-flatness-presheaves}.
Then (2) follows as $j_{U!}\mathcal{O}_U = (j_{U!}\mathcal{O}_U)^\#$
(the first $j_{U!}$ on sheaves, the second on presheaves)
and Lemma \ref{lemma-flatness-sheafification}.
\end{proof}

\begin{lemma}
\label{lemma-module-quotient-flat}
Let $\mathcal{C}$ be a category.
Let $\mathcal{O}$ be a presheaf of rings.
\begin{enumerate}
\item Any presheaf of $\mathcal{O}$-modules is a quotient of
a flat presheaf of $\mathcal{O}$-modules.
\item If $\mathcal{C}$ is a site, $\mathcal{O}$ is a sheaf of rings,
then any sheaf of $\mathcal{O}$-modules is a quotient of
a flat sheaf of $\mathcal{O}$-modules.
\end{enumerate}
\end{lemma}

\begin{proof}
Proof of (1). For every object $U$ of $\mathcal{C}$ and every
$s \in \mathcal{F}(U)$ we get a morphism
$j_{U!}\mathcal{O}_U \to \mathcal{F}$, namely the adjoint to
the morphism $\mathcal{O}_U \to \mathcal{F}|_U$, $1 \mapsto s$.
Clearly the map
$$
\bigoplus\nolimits_{(U, s)} j_{U!}\mathcal{O}_U
\longrightarrow
\mathcal{F}
$$
is surjective, and the source is flat by combining Lemmas
\ref{lemma-colimits-flat} and \ref{lemma-j-shriek-flat}.
The sheaf case follows from this either by
sheafifying or repeating the same argument.
\end{proof}

\begin{lemma}
\label{lemma-flat-tor-zero}
Let $\mathcal{C}$ be a category.
Let $\mathcal{O}$ be a presheaf of rings.
Let
$$
0 \to \mathcal{F}'' \to \mathcal{F}' \to \mathcal{F} \to 0
$$
be a short exact sequence of presheaves of $\mathcal{O}$-modules.
Assume $\mathcal{F}$ is flat. Then
\begin{enumerate}
\item For any presheaf $\mathcal{G}$
of $\mathcal{O}$-modules, the sequence
$$
0 \to
\mathcal{F}'' \otimes_{p, \mathcal{O}} \mathcal{G} \to
\mathcal{F}' \otimes_{p, \mathcal{O}} \mathcal{G} \to
\mathcal{F} \otimes_{p, \mathcal{O}} \mathcal{G} \to 0
$$
is exact.
\item If $\mathcal{C}$ is a site, and $\mathcal{O}$,
$\mathcal{F}$, $\mathcal{F}'$, $\mathcal{F}''$, and
$\mathcal{G}$ are all sheaves, the sequence
$$
0 \to
\mathcal{F}'' \otimes_\mathcal{O} \mathcal{G} \to
\mathcal{F}' \otimes_\mathcal{O} \mathcal{G} \to
\mathcal{F} \otimes_\mathcal{O} \mathcal{G} \to 0
$$
is exact.
\end{enumerate}
\end{lemma}

\begin{proof}
Choose a flat presheaf of $\mathcal{O}$-modules $\mathcal{G}'$
which surjects onto $\mathcal{G}$. This is possible by
Lemma \ref{lemma-module-quotient-flat}. Let
$\mathcal{G}'' = \text{Ker}(\mathcal{G}' \to \mathcal{G})$.
The lemma follows by applying the snake lemma to the following
diagram
$$
\begin{matrix}
 & & 0 & & 0 & & 0 & & \\
 & & \uparrow & & \uparrow & & \uparrow & & \\
 & & \mathcal{F}'' \otimes_{p, \mathcal{O}} \mathcal{G} & \to &
     \mathcal{F}' \otimes_{p, \mathcal{O}} \mathcal{G} & \to &
     \mathcal{F} \otimes_{p, \mathcal{O}} \mathcal{G} & \to & 0 \\
 & & \uparrow & & \uparrow & & \uparrow & & \\
0 & \to & \mathcal{F}'' \otimes_{p, \mathcal{O}} \mathcal{G}' & \to &
          \mathcal{F}' \otimes_{p, \mathcal{O}} \mathcal{G}' & \to &
	  \mathcal{F} \otimes_{p, \mathcal{O}} \mathcal{G}' & \to & 0 \\
 & & \uparrow & & \uparrow & & \uparrow & & \\
 & & \mathcal{F}'' \otimes_{p, \mathcal{O}} \mathcal{G}'' & \to &
     \mathcal{F}' \otimes_{p, \mathcal{O}} \mathcal{G}'' & \to &
     \mathcal{F} \otimes_{p, \mathcal{O}} \mathcal{G}'' & \to & 0 \\
 & & & & & & \uparrow & & \\
 & & & & & & 0 & &
\end{matrix}
$$
with exact rows and columns. The middle row is exact because tensoring
with the flat module $\mathcal{G}'$ is exact.
The sheaf case follows from the presheaf case as sheafification is
exact.
\end{proof}

\begin{lemma}
\label{lemma-flat-ses}
Let $\mathcal{C}$ be a category.
Let $\mathcal{O}$ be a presheaf of rings.
Let
$$
0 \to
\mathcal{F}_2 \to
\mathcal{F}_1 \to
\mathcal{F}_0 \to 0
$$
be a short exact sequence of presheaves of $\mathcal{O}$-modules.
\begin{enumerate}
\item If $\mathcal{F}_2$ and $\mathcal{F}_0$ are flat so is
$\mathcal{F}_1$.
\item If $\mathcal{F}_1$ and $\mathcal{F}_0$ are flat so is
$\mathcal{F}_2$.
\end{enumerate}
If $\mathcal{C}$ is a site and $\mathcal{O}$ is a
sheaf of rings then the same result holds $\textit{Mod}(\mathcal{O})$.
\end{lemma}

\begin{proof}
Let $\mathcal{G}^\bullet$ be an arbitrary exact complex of presheaves
of $\mathcal{O}$-modules. Assume that $\mathcal{F}_0$ is flat.
By Lemma \ref{lemma-flat-tor-zero} we see that
$$
0 \to
\mathcal{G}^\bullet \otimes_{p, \mathcal{O}} \mathcal{F}_2 \to
\mathcal{G}^\bullet \otimes_{p, \mathcal{O}} \mathcal{F}_1 \to
\mathcal{G}^\bullet \otimes_{p, \mathcal{O}} \mathcal{F}_0 \to 0
$$
is a short exact sequence of complexes of presheaves of
$\mathcal{O}$-modules. Hence (1) and (2) follow from the snake lemma.
The case of sheaves of modules is proved in the same way.
\end{proof}

\begin{lemma}
\label{lemma-flat-resolution-of-flat}
Let $\mathcal{C}$ be a category.
Let $\mathcal{O}$ be a presheaf of rings.
Let
$$
\ldots \to
\mathcal{F}_2 \to
\mathcal{F}_1 \to
\mathcal{F}_0 \to
\mathcal{Q} \to 0
$$
be an exact complex of presheaves of $\mathcal{O}$-modules.
If $\mathcal{Q}$ and all $\mathcal{F}_i$ are flat $\mathcal{O}$-modules,
then for any presheaf $\mathcal{G}$ of $\mathcal{O}$-modules the
complex
$$
\ldots \to
\mathcal{F}_2 \otimes_{p, \mathcal{O}} \mathcal{G} \to
\mathcal{F}_1 \otimes_{p, \mathcal{O}} \mathcal{G} \to
\mathcal{F}_0 \otimes_{p, \mathcal{O}} \mathcal{G} \to
\mathcal{Q} \otimes_{p, \mathcal{O}} \mathcal{G} \to 0
$$
is exact also. If $\mathcal{C}$ is a site and $\mathcal{O}$ is a
sheaf of rings then the same result holds $\textit{Mod}(\mathcal{O})$.
\end{lemma}

\begin{proof}
Follows from Lemma \ref{lemma-flat-tor-zero} by splitting the complex
into short exact sequences and using Lemma \ref{lemma-flat-ses} to
prove inductively that $\text{Im}(\mathcal{F}_{i + 1} \to \mathcal{F}_i)$
is flat.
\end{proof}





















\input{chapters}

\bibliography{my}
\bibliographystyle{amsalpha}

\end{document}
