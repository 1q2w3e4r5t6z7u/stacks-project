\input{preamble}

% OK, start here.
%
\begin{document}

\title{Derived Categories of Varieties}


\maketitle

\phantomsection
\label{section-phantom}

\tableofcontents

\section{Introduction}
\label{section-introduction}

\noindent
In this chapter we continue the discussion started in
Derived Categories of Schemes, Section \ref{perfect-section-introduction}.
We will discuss Fourier-Mukai transforms,
first studied by Mukai in \cite{Mukai}.
We will prove Orlov's theorem on derived equivalences (\cite{Orlov-K3}).
We also discuss the countability of derived equivalence
classes proved by Anel and To\"en in \cite{AT}.




\section{Conventions}
\label{section-conventions}

\noindent
Let $k$ be a field. A $k$-linear triangulated category $\mathcal{T}$
is a triangulated category (Derived Categories, Section
\ref{derived-section-triangulated-definitions})
which is endowed with a $k$-linear structure
(Differential Graded Algebra, Section \ref{dga-section-linear})
such that the translation functors $[n] : \mathcal{T} \to \mathcal{T}$
are $k$-linear for all $n \in \mathbf{Z}$.

\medskip\noindent
Let $k$ be a field. We denote $\text{Vect}_k$ the category of
$k$-vector spaces. For a $k$-vector space $V$ we denote
$V^\vee$ the $k$-linear dual of $V$, i.e., $V^\vee = \Hom_k(V, k)$.

\medskip\noindent
Let $X$ be a scheme. We denote $D_{perf}(\mathcal{O}_X)$ the full
subcategory of $D(\mathcal{O}_X)$ consisting of perfect complexes
(Cohomology, Section \ref{cohomology-section-perfect}).
If $X$ is Noetherian then
$D_{perf}(\mathcal{O}_X) \subset D^b_{\textit{Coh}}(\mathcal{O}_X)$, see
Derived Categories of Schemes, Lemma \ref{perfect-lemma-perfect-on-noetherian}.
If $X$ is Noetherian and regular, then
$D_{perf}(\mathcal{O}_X) = D^b_{\textit{Coh}}(\mathcal{O}_X)$, see
Derived Categories of Schemes, Lemma \ref{perfect-lemma-perfect-on-regular}.

\medskip\noindent
Let $k$ be a field. Let $X$ and $Y$ be schemes over $k$. In this
situation we will write $X \times Y$ instead of $X \times_{\Spec(k)} Y$.
Let $\mathcal{F}$ be a $\mathcal{O}_X$-module and let
$\mathcal{G}$ be a $\mathcal{O}_Y$-module. We set
$$
\mathcal{F} \boxtimes \mathcal{G} =
\text{pr}_1^*\mathcal{F} \otimes_{\mathcal{O}_{X \times Y}}
\text{pr}_2^*\mathcal{G}
$$
If $K \in D(\mathcal{O}_X)$ and $M \in D(\mathcal{O}_U)$ then we set
$$
K \boxtimes M =
L\text{pr}_1^*K \otimes_{\mathcal{O}_{X \times Y}}^\mathbf{L} L\text{pr}_2^*M
$$
Thus our notation is potentially ambiguous, but context should make it clear
which of the two is meant.





\section{Serre functors}
\label{section-Serre-functors}

\noindent
The material in this section is taken from \cite{Bondal-Kapranov}.

\begin{lemma}
\label{lemma-Serre-functor-exists}
Let $k$ be a field. Let $\mathcal{T}$ be a $k$-linear
triangulated category such that $\dim_k \Hom_\mathcal{T}(X, Y) < \infty$
for all $X, Y \in \Ob(\mathcal{T})$. The following are equivalent
\begin{enumerate}
\item there exists a $k$-linear equivalence
$S : \mathcal{T} \to \mathcal{T}$ and $k$-linear isomorphisms
$c_{X, Y} : \Hom_\mathcal{T}(X, Y) \to \Hom_\mathcal{T}(Y, S(X))^\vee$
functorial in $X, Y \in \Ob(\mathcal{T})$,
\item for every $X \in \Ob(\mathcal{T})$
the functor $Y \mapsto \Hom_\mathcal{T}(X, Y)^\vee$
is representable and the functor $Y \mapsto \Hom_\mathcal{T}(Y, X)^\vee$
is corepresentable.
\end{enumerate}
\end{lemma}

\begin{proof}
Condition (1) implies (2) since given $(S, c)$ and $X \in \Ob(\mathcal{T})$
the object $S(X)$ represents the functor
$Y \mapsto \Hom_\mathcal{T}(X, Y)^\vee$ and the object $S^{-1}(X)$ corepresents
the functor $Y \mapsto \Hom_\mathcal{T}(Y, X)^\vee$.

\medskip\noindent
Assume (2). We will repeatedly use the Yoneda lemma, see
Categories, Lemma \ref{categories-lemma-yoneda}.
For every $X$ denote $S(X)$ the object representing the
functor $Y \mapsto \Hom_\mathcal{T}(X, Y)^\vee$. Given
$\varphi : X \to X'$, we obtain a unique arrow $S(\varphi) : S(X) \to S(X')$
determined by the corresponding transformation of functors
$\Hom_\mathcal{T}(X, -)^\vee \to \Hom_\mathcal{T}(X', -)^\vee$.
Thus $S$ is a functor and we obtain the isomorphisms $c_{X, Y}$
by construction. It remains to show that $S$ is an equivalence.
For every $X$ denote $S'(X)$ the object corepresenting the
functor $Y \mapsto \Hom_\mathcal{T}(Y, X)^\vee$. Arguing as
above we find that $S'$ is a functor. We claim that $S'$
is quasi-inverse to $S$. To see this observe that
$$
\Hom_\mathcal{T}(X, Y) = \Hom_\mathcal{T}(Y, S(X))^\vee =
\Hom_\mathcal{T}(S'(S(X)), Y)
$$
bifunctorially, i.e., we find $S' \circ S \cong \text{id}_\mathcal{T}$.
Similarly, we have
$$
\Hom_\mathcal{T}(Y, X) = \Hom_\mathcal{T}(S'(X), Y)^\vee =
\Hom_\mathcal{T}(Y, S(S'(X)))
$$
and we find $S \circ S' \cong \text{id}_\mathcal{T}$.
\end{proof}

\begin{definition}
\label{definition-Serre-functor}
Let $k$ be a field. Let $\mathcal{T}$ be a $k$-linear
triangulated category such that $\dim_k \Hom_\mathcal{T}(X, Y) < \infty$
for all $X, Y \in \Ob(\mathcal{T})$. We say {\it a Serre functor
exists} if the equivalent conditions of Lemma \ref{lemma-Serre-functor-exists}
are satisfied. In this case a {\it Serre functor} is a $k$-linear equivalence
$S : \mathcal{T} \to \mathcal{T}$ endowed with $k$-linear isomorphisms
$c_{X, Y} : \Hom_\mathcal{T}(X, Y) \to \Hom_\mathcal{T}(Y, S(X))^\vee$
functorial in $X, Y \in \Ob(\mathcal{T})$.
\end{definition}

\begin{lemma}
\label{lemma-Serre-functor}
In the situation of Definition \ref{definition-Serre-functor}.
If a Serre functor exists, then it is unique up to unique isomorphism and
it is an exact functor of triangulated categories.
\end{lemma}

\begin{proof}
Given a Serre functor $S$ the object $S(X)$ represents
the functor $Y \mapsto \Hom_\mathcal{T}(X, Y)^\vee$.
Thus the object $S(X)$ together with the functorial identification
$\Hom_\mathcal{T}(X, Y)^\vee = \Hom_\mathcal{T}(Y, S(X))$
is determined up to unique isomorphism by the Yoneda lemma
(Categories, Lemma \ref{categories-lemma-yoneda}).
Moreover, for $\varphi : X \to X'$, the arrow $S(\varphi) : S(X) \to S(X')$
is uniquely determined by the corresponding transformation of functors
$\Hom_\mathcal{T}(X, -)^\vee \to \Hom_\mathcal{T}(X', -)^\vee$.

\medskip\noindent
For objects $X, Y$ of $\mathcal{T}$ we have
\begin{align*}
\Hom(Y, S(X)[1])^\vee
& =
\Hom(Y[-1], S(X))^\vee \\
& =
\Hom(X, Y[-1]) \\
& =
\Hom(X[1], Y) \\
& =
\Hom(Y, S(X[1]))^\vee
\end{align*}
By the Yoneda lemma we conclude that there is a unique isomorphism
$S(X[1]) \to S(X)[1]$ inducing the isomorphism from top left to bottom right.
Since each of the isomorphisms above is functorial in both $X$ and $Y$
we find that this defines an isomorphism of functors
$S \circ [1] \to [1] \circ S$.

\medskip\noindent
Let $(A, B, C, f, g, h)$ be a distinguished triangle in $\mathcal{T}$.
We have to show that the triangle $(S(A), S(B), S(C), S(f), S(g), S(h))$
is distinguished. Here we use the canonical isomorphism $S(A[1]) \to S(A)[1]$
constructed above to identify the target $S(A[1])$ of $S(h)$ with $S(A)[1]$.
We first observe that for any $X$ in $\mathcal{T}$
the triangle $(S(A), S(B), S(C), S(f), S(g), S(h))$ induces
a long exact sequence
$$
\ldots \to
\Hom(X, S(A)) \to
\Hom(X, S(B)) \to
\Hom(X, S(C)) \to
\Hom(X, S(A)[1]) \to \ldots
$$
of finite dimensional $k$-vector spaces. Namely, this sequence is
$k$-linear dual of the sequence
$$
\ldots \leftarrow
\Hom(A, X) \leftarrow
\Hom(B, X) \leftarrow
\Hom(C, X) \leftarrow
\Hom(A[1], X) \leftarrow
\ldots
$$
which is exact by Derived Categories, Lemma
\ref{derived-lemma-representable-homological}.
Next, we choose a distinguished triangle $(S(A), E, S(C), i, p, S(h))$
which is possible by axioms TR1 and TR2. We want to construct the dotted
arrow making following diagram commute
$$
\xymatrix{
S(C)[-1] \ar[r]_-{S(h[-1])} &
S(A) \ar[r]_{S(f)} &
S(B) \ar[r]_{S(g)} &
S(C) \ar[r]_{S(h)} &
S(A)[1] \\
S(C)[-1] \ar[r]^-{S(h[-1])} \ar@{=}[u] &
S(A) \ar[r]^i \ar@{=}[u] &
E \ar[r]^p \ar@{..>}[u]^\varphi &
S(C) \ar[r]^{S(h)} \ar@{=}[u] &
S(A)[1] \ar@{=}[u]
}
$$
Namely, if we have $\varphi$, then we claim for any $X$ the resulting
map $\Hom(X, E) \to \Hom(X, S(B))$ will be an isomorphism of $k$-vector
spaces. Namely, we will obtain a commutative diagram
$$
\xymatrix{
\Hom(X, S(C)[-1]) \ar[r] &
\Hom(X, S(A)) \ar[r] &
\Hom(X, S(B)) \ar[r] &
\Hom(X, S(C)) \ar[r] &
\Hom(X, S(A)[1]) \\
\Hom(X, S(C)[-1]) \ar[r] \ar@{=}[u] &
\Hom(X, S(A)) \ar[r] \ar@{=}[u] &
\Hom(X, E) \ar[r] \ar[u]^\varphi &
\Hom(X, S(C)) \ar[r] \ar@{=}[u] &
\Hom(X, S(A)[1]) \ar@{=}[u]
}
$$
with exact rows (see above) and we can apply the 5 lemma
(Homology, Lemma \ref{homology-lemma-five-lemma}) to see
that the middle arrow is an isomorphism. By the Yoneda lemma
we conclude that $\varphi$ is an isomorphism.
To find $\varphi$ consider the following diagram
$$
\xymatrix{
\Hom(E, S(C)) \ar[r] &
\Hom(S(A), S(C)) \\
\Hom(E, S(B)) \ar[u] \ar[r] &
\Hom(S(A), S(B)) \ar[u]
}
$$
The elements $p$ and $S(f)$ in positions $(0, 1)$ and
$(1, 0)$ define a cohomology class $\xi$ in the total complex
of this double complex. The existence of $\varphi$ is
equivalent to whether $\xi$ is zero. If we take $k$-linear duals
of this and we use the defining property of $S$ we obtain
$$
\xymatrix{
\Hom(C, E) \ar[d] &
\Hom(C, S(A)) \ar[l] \ar[d] \\
\Hom(B, E) &
\Hom(B, S(A)) \ar[l]
}
$$
Since both $A \to B \to C$ and $S(A) \to E \to S(C)$ are distinguished
triangles, we know by TR3 that given elements $\alpha \in \Hom(C, E)$
and $\beta \in \Hom(B, S(A))$ mapping to the same element in
$\Hom(B, E)$, there exists an element in $\Hom(C, S(A))$ mapping
to both $\alpha$ and $\beta$. In other words, the cohomology of
the total complex associated to this double complex is zero in degree
$1$, i.e., the degree corresponding to $\Hom(C, E) \oplus \Hom(B, S(A))$.
Taking duals the same must be true for the previous one which concludes
the proof.
\end{proof}






\section{Examples of Serre functors}
\label{section-examples-Serre-functors}

\noindent
The lemma below is the standard example.

\begin{lemma}
\label{lemma-Serre-functor-Gorenstein-proper}
Let $k$ be a field. Let $X$ be a proper scheme over $k$ which is Gorenstein.
Consider the complex $\omega_X^\bullet$ of
Duality for Schemes, Lemmas \ref{duality-lemma-duality-proper-over-field}.
Then the functor
$$
S : D_{perf}(\mathcal{O}_X) \longrightarrow D_{perf}(\mathcal{O}_X),\quad
K \longmapsto S(K) = \omega_X^\bullet \otimes_{\mathcal{O}_X}^\mathbf{L} K
$$
is a Serre functor.
\end{lemma}

\begin{proof}
The statement make sense because $\dim \Hom_X(K, L) < \infty$
for $K, L \in D_{perf}(\mathcal{O}_X)$ by
Derived Categories of Schemes, Lemma \ref{perfect-lemma-ext-finite}.
Since $X$ is Gorenstein the dualizing complex $\omega_X^\bullet$
is an invertible object of $D(\mathcal{O}_X)$, see
Duality for Schemes, Lemma \ref{duality-lemma-gorenstein}.
In particular, locally on $X$ the complex $\omega_X^\bullet$
has one nonzero cohomology sheaf which is an invertible module, see
Cohomology, Lemma \ref{cohomology-lemma-invertible-derived}.
Thus $S(K)$ lies in $D_{perf}(\mathcal{O}_X)$.
On the other hand, the invertibility of $\omega_X^\bullet$
clearly implies that $S$ is a self-equivalence of $D_{perf}(\mathcal{O}_X)$.
Finally, we have to find an isomorphism
$$
c_{K, L} : \Hom_X(K, L) \longrightarrow
\Hom_X(L, \omega_X^\bullet \otimes_{\mathcal{O}_X}^\mathbf{L} K)^\vee
$$
bifunctorially in $K, L$. To do this we use the canonical isomorphisms
$$
\Hom_X(K, L) = H^0(X, L \otimes_{\mathcal{O}_X}^\mathbf{L} K^\vee)
$$
and
$$
\Hom_X(L, \omega_X^\bullet \otimes_{\mathcal{O}_X}^\mathbf{L} K) =
H^0(X, 
\omega_X^\bullet \otimes_{\mathcal{O}_X}^\mathbf{L} K
\otimes_{\mathcal{O}_X}^\mathbf{L} L^\vee)
$$
given in Cohomology, Lemma \ref{cohomology-lemma-dual-perfect-complex}.
Since $(L \otimes_{\mathcal{O}_X}^\mathbf{L} K^\vee)^\vee =
(K^\vee)^\vee \otimes_{\mathcal{O}_X}^\mathbf{L} L^\vee$
and since there is a canonical isomorphism $K \to (K^\vee)^\vee$
we find these $k$-vector spaces are canonically dual by
Duality for Schemes, Lemma
\ref{duality-lemma-duality-proper-over-field-perfect}.
This produces the isomorphisms $c_{K, L}$.
We omit the proof that these isomorphisms are functorial.
\end{proof}





\section{Characterizing coherent modules}
\label{section-coherent}

\noindent
This section is in some sense a continuation of the discussion
in Derived Categories of Schemes, Section \ref{perfect-section-pseudo-coherent}
and More on Morphisms, Section
\ref{more-morphisms-section-characterize-pseudo-coherent}.

\medskip\noindent
Before we can state the result we need some notation.
Let $k$ be a field. Let $n \geq 0$ be an integer.
Let $S = k[X_0, \ldots, X_n]$. For an integer $e$ denote
$S_e \subset S$ the homogeneous polynomials of degree $e$.
Consider the (noncommutative) $k$-algebra
$$
R =
\left(
\begin{matrix}
S_0 & S_1 & S_2 & \ldots & \ldots \\
0 & S_0 & S_1 & \ldots & \ldots\\
0 & 0 & S_0 & \ldots & \ldots \\
\ldots & \ldots & \ldots & \ldots & \ldots \\
0 & \ldots & \ldots & \ldots & S_0
\end{matrix}
\right)
$$
(with $n + 1$ rows and columns) with obvious multiplication and addition.

\begin{lemma}
\label{lemma-perfect-for-R}
With $k$, $n$, and $R$ as above, for an object $K$ of $D(R)$
the following are equivalent
\begin{enumerate}
\item $\sum_{i \in \mathbf{Z}} \dim_k H^i(K) < \infty$, and
\item $K$ is a compact object.
\end{enumerate}
\end{lemma}

\begin{proof}
If $K$ is a compact object, then $K$ can be represented by a complex
$M^\bullet$ which is finite projective as a graded $R$-module, see
Differential Graded Algebra, Lemma \ref{dga-lemma-compact}.
Since $\dim_k R < \infty$ we conclude $\sum \dim_k M^i < \infty$
and a fortiori $\sum \dim_k H^i(M^\bullet) < \infty$.
(One can also easily deduce this implication from the easier
Differential Graded Algebra, Proposition \ref{dga-proposition-compact}.)

\medskip\noindent
Assume $K$ satisfies (1). Consider the distinguished triangle
of trunctions $\tau_{\leq m}K \to K \to \tau_{\geq m + 1}K$, see
Derived Categories, Remark
\ref{derived-remark-truncation-distinguished-triangle}.
It is clear that both $\tau_{\leq m}K$ and $\tau_{\geq m + 1} K$
satisfy (1). If we can show both are compact, then so is $K$, see
Derived Categories, Lemma \ref{derived-lemma-compact-objects-subcategory}.
Hence, arguing on the number of nonzero cohomology modules of $K$
we may assume $H^i(K)$ is nonzero only for one $i$.
Shifting, we may assume $K$ is given by the complex
consisting of a single finite dimensional $R$-module $M$ sitting
in degree $0$.

\medskip\noindent
Since $\dim_k(M) < \infty$ we see that $M$ is Artinian as an $R$-module.
Thus it suffices to show that every simple $R$-module represents a
compact object of $D(R)$. Observe that
$$
I =
\left(
\begin{matrix}
0 & S_1 & S_2 & \ldots & \ldots \\
0 & 0 & S_1 & \ldots & \ldots\\
0 & 0 & 0 & \ldots & \ldots \\
\ldots & \ldots & \ldots & \ldots & \ldots \\
0 & \ldots & \ldots & \ldots & 0
\end{matrix}
\right)
$$
is a nilpotent two sided ideal of $R$ and that $R/I$
is a commutative $k$-algebra isomorphic to a product of $n + 1$ copies of
$k$ (placed along the diagonal in the matrix, i.e., $R/I$ can be lifted
to a $k$-subalgebra of $R$). It follows that $R$ has exactly $n + 1$
isomorphism classes of simple modules $M_0, \ldots, M_n$ (sitting along
the diagonal). Consider the right $R$-module $P_i$ of row vectors
$$
P_i =
\left(
\begin{matrix}
0 &
\ldots &
0 &
S_0 &
\ldots &
S_{i - 1} &
S_i
\end{matrix}
\right)
$$
with obvious multiplication $P_i \times R \to P_i$. Then we see that
$R \cong P_0 \oplus \ldots \oplus P_n$ as a right $R$-module. Since clearly
$R$ is a compact object of $D(R)$, we conclude each $P_i$ is a compact
object of $D(R)$. (We of course also conclude each $P_i$ is projective
as an $R$-module, but this isn't what we have to show in this proof.)
Clearly, $P_0 = M_0$ is the first of our simple $R$-modules.
For $P_1$ we have a short exact sequence
$$
0 \to P_0^{\oplus n + 1} \to P_1 \to M_1 \to 0
$$
which proves that $M_1$ fits into a distinguished triangle whose
other members are compact objects and hence $M_1$ is a compact
object of $D(R)$. More generally, there exists a short exact sequence
$$
0 \to C_i \to P_i \to M_i \to 0
$$
where $C_i$ is a finite dimensional $R$-module whose simple contituents
are isomorphic to $S_j$ for $j < i$. By induction, we first conclude that
$C_i$ determines a compact object of $D(R)$ whereupon we conclude that $M_i$
does too as desired.
\end{proof}

\begin{lemma}
\label{lemma-coherent-on-projective-space}
Let $k$ be a field. Let $n \geq 0$. Let
$K \in D_\QCoh(\mathcal{O}_{\mathbf{P}^n_k})$.
The following are equivalent
\begin{enumerate}
\item $K$ is in $D^b_{\textit{Coh}}(\mathcal{O}_{\mathbf{P}^n_k})$,
\item $\sum_{i \in \mathbf{Z}}
\dim_k H^i(\mathbf{P}^n_k, E \otimes^\mathbf{L} K) < \infty$
for each perfect object $E$ of
$D(\mathcal{O}_{\mathbf{P}^n_k})$,
\item $\sum_{i \in \mathbf{Z}}
\dim_k \Ext^i_{\mathbf{P}^n_k}(E, K) < \infty$
for each perfect object $E$ of $D(\mathcal{O}_{\mathbf{P}^n_k})$,
\item $\sum_{i \in \mathbf{Z}} \dim_k H^i(\mathbf{P}^n_k,
K \otimes^\mathbf{L} \mathcal{O}_{\mathbf{P}^n_k}(d)) < \infty$
for $d = 0, 1, \ldots, n$.
\end{enumerate}
\end{lemma}

\begin{proof}
Parts (2) and (3) are equivalent by
Cohomology, Lemma \ref{cohomology-lemma-dual-perfect-complex}.
If (1) is true, then for $E$ perfect the derived tensor product
$E \otimes^\mathbf{L} K$ is in
$D^b_{\textit{Coh}}(\mathcal{O}_{\mathbf{P}^n_k})$
and we see that (2) holds by 
Derived Categories of Schemes, Lemma \ref{perfect-lemma-direct-image-coherent}.
It is clear that (2) implies (4) as $\mathcal{O}_{\mathbf{P}^n_k}(d)$
can be viewed
as a perfect object of the derived category of $\mathbf{P}^n_k$.
Thus it suffices to prove that (4) implies (1).

\medskip\noindent
Assume (4). Let $R$ be as in Lemma \ref{lemma-perfect-for-R}.
Let $P = \bigoplus_{d = 0, \ldots, n} \mathcal{O}_{\mathbf{P}^n_k}(-d)$.
Recall that $R = \text{End}_{\mathbf{P}^n_k}(P)$ whereas all other
self-Exts of $P$ are zero and that $P$ determines an equivalence
$- \otimes^\mathbf{L} P : D(R) \to D_\QCoh(\mathcal{O}_{\mathbf{P}^n_k})$
by Derived Categories of Schemes, Lemma \ref{perfect-lemma-Pn-module-category}.
Say $K$ corresponds to $L$ in $D(R)$. Then
\begin{align*}
H^i(L)
& =
\Ext^i_{D(R)}(R, L) \\
& =
\Ext^i_{\mathbf{P}^n_k}(P, K) \\
& =
H^i(\mathbf{P}^n_k, K \otimes P^\vee) \\
& =
\bigoplus\nolimits_{d = 0, \ldots, n}
H^i(\mathbf{P}^n_k, K \otimes \mathcal{O}(d))
\end{align*}
by Differential Graded Algebra, Lemma
\ref{dga-lemma-upgrade-tensor-with-complex-derived}
(and the fact that $- \otimes^\mathbf{L} P$ is an equivalence)
and Cohomology, Lemma \ref{cohomology-lemma-dual-perfect-complex}.
Thus our assumption (4) implies that $L$ satisfies condition (2) of
Lemma \ref{lemma-perfect-for-R} and hence is a compact object of $D(R)$.
Therefore $K$ is a compact object of
$D_\QCoh(\mathcal{O}_{\mathbf{P}^n_k})$
and the proof is complete.
\end{proof}

\begin{lemma}
\label{lemma-finiteness}
Let $X$ be a scheme proper over a field $k$. Let
$K \in D^b_{\textit{Coh}}(\mathcal{O}_X)$ and let $E$ in $D(\mathcal{O}_X)$
be perfect. Then
$\sum_{i \in \mathbf{Z}} \dim_k \Ext^i_X(E, K) < \infty$.
\end{lemma}

\begin{proof}
This follows for example by combining
Derived Categories of Schemes, Lemmas \ref{perfect-lemma-ext-finite} and
\ref{perfect-lemma-ext-from-perfect-into-bounded-QCoh}.
Alternative proof: combine
Derived Categories of Schemes, Lemmas
\ref{perfect-lemma-perfect-on-noetherian} and
\ref{perfect-lemma-direct-image-coherent}.
\end{proof}

\begin{lemma}
\label{lemma-characterize-dbcoh-projective}
\begin{reference}
\cite[Lemma 7.46]{Rouqier-dimensions} and implicit in
\cite[Theorem A.1]{BvdB}
\end{reference}
Let $X$ be a projective scheme over a field $k$. Let
$K \in \Ob(D_\QCoh(\mathcal{O}_X))$. The following are equivalent
\begin{enumerate}
\item $K \in D^b_{\textit{Coh}}(\mathcal{O}_X)$, and
\item $\sum_{i \in \mathbf{Z}} \dim_k \Ext^i_X(E, K) < \infty$
for all perfect $E$ in $D(\mathcal{O}_X)$.
\end{enumerate}
\end{lemma}

\begin{proof}
The implication (1) $\Rightarrow$ (2) follows from
Lemma \ref{lemma-finiteness}.

\medskip\noindent
Assume (2).
Choose a closed immersion $i : X \to \mathbf{P}^n_k$. It suffices to show
that $Ri_*K$ is in $D^b_{\textit{Coh}}(\mathbf{P}^n_k)$ since a quasi-coherent
module $\mathcal{F}$ on $X$ is coherent, resp.\ zero if and only if
$i_*\mathcal{F}$ is coherent, resp.\ zero. For a perfect object $E$
of $D(\mathcal{O}_{\mathbf{P}^n_k})$ we have
$$
\Ext^q_{\mathbf{P}^n_k}(E, Ri_*K) = \Ext^q_X(Li^*E, K) = F(Li^*E[q])
$$
Hence by our assumption we see that
$\sum_{q \in \mathbf{Z}} \dim_k \Ext^q_{\mathbf{P}^n_k}(E, Ri_*K) < \infty$.
We conclude by Lemma \ref{lemma-coherent-on-projective-space}.
\end{proof}





\section{A representability theorem}
\label{section-bondal-van-den-bergh}

\noindent
The material in this section is taken from \cite{BvdB}.

\medskip\noindent
Let $\mathcal{T}$ be a $k$-linear triangulated category.
In this section we consider $k$-linear cohomological functors
$H$ from $\mathcal{T}$ to the category of $k$-vector spaces.
This will mean $H$ is a functor
$$
H : \mathcal{T}^{opp} \longrightarrow \text{Vect}_k
$$
which is $k$-linear such that for any distinguished triangle
$X \to Y \to Z$ in $\mathcal{T}$ the sequence $H(Z) \to H(Y) \to H(X)$
is an exact sequence of $k$-vector spaces. See
Derived Categories, Definition \ref{derived-definition-homological}
and Differential Graded Algebra, Section \ref{dga-section-linear}.

\begin{lemma}
\label{lemma-maps-from-compact-filtered}
Let $\mathcal{D}$ be a triangulated category. Let
$\mathcal{D}' \subset \mathcal{D}$ be a full triangulated subcategory. Let
$X \in \Ob(\mathcal{D})$. The category of arrows $E \to X$ with
$E \in \Ob(\mathcal{D}')$ is filtered.
\end{lemma}

\begin{proof}
We check the conditions of
Categories, Definition \ref{categories-definition-directed}.
The category is nonempty because it contains $0 \to X$.
If $E_i \to X$, $i = 1, 2$ are objects, then $E_1 \oplus E_2 \to X$
is an object and there are morphisms $(E_i \to X) \to (E_1 \oplus E_2 \to X)$.
Finally, suppose that $a, b : (E \to X) \to (E' \to X)$ are morphisms.
Choose a distinguished triangle $E \xrightarrow{a - b} E' \to E''$
in $\mathcal{D}'$. By Axiom TR3 we obtain a morphism of triangles
$$
\xymatrix{
E \ar[r]_{a - b} \ar[d] &
E' \ar[d] \ar[r] & E'' \ar[d] \\
0 \ar[r] &
X \ar[r] &
X
}
$$
and we find that the resulting arrow $(E' \to X) \to (E'' \to X)$
equalizes $a$ and $b$.
\end{proof}

\begin{lemma}
\label{lemma-van-den-bergh}
\begin{reference}
\cite[Lemma 2.14]{CKN}
\end{reference}
Let $k$ be a field. Let $\mathcal{D}$ be a $k$-linear triangulated category
which has direct sums and is compactly generated.
Denote $\mathcal{D}_c$ the full
subcategory of compact objects. Let $H : \mathcal{D}_c^{opp} \to \text{Vect}_k$
be a $k$-linear cohomological functor such that
$\dim_k H(X) < \infty$ for all $X \in \Ob(\mathcal{D}_c)$.
Then $H$ is isomorphic to the functor $X \mapsto \Hom(X, Y)$
for some $Y \in \Ob(\mathcal{D})$.
\end{lemma}

\begin{proof}
We will use Derived Categories, Lemma
\ref{derived-lemma-compact-objects-subcategory} without further mention.
Denote $G : \mathcal{D}_c \to \text{Vect}_k$ the $k$-linear homological
functor which sends $X$ to $H(X)^\vee$. For any object $Y$ of $\mathcal{D}$
we set
$$
G'(Y) = \colim_{X \to Y, X \in \Ob(\mathcal{D}_c)} G(X)
$$
The colimit is filtered by Lemma \ref{lemma-maps-from-compact-filtered}.
We claim that $G'$ is a $k$-linear homological functor,
the restriction of $G'$ to $\mathcal{D}_c$ is $G$, and $G'$
sends direct sums to direct sums.

\medskip\noindent
Namely, suppose that $Y_1 \to Y_2 \to Y_3$ is a distinguished triangle.
Let $\xi \in G'(Y_2)$ map to zero in $G'(Y_3)$. Since the colimit is
filtered $\xi$ is represented by some $X \to Y_2$ with
$X \in \Ob(\mathcal{D}_c)$ and $g \in G(X)$.
The fact that $\xi$ maps to zero in $G'(Y_3)$ means the composition
$X \to Y_2 \to Y_3$ factors as $X \to X' \to Y_3$ with $X' \in \mathcal{D}_c$
and $g$ mapping to zero in $G(X')$. Choose a distinguished
triangle $X'' \to X \to X'$. Then $X'' \in \Ob(\mathcal{D}_c)$.
Since $G$ is homological we find that $g$ is the image of some
$g'' \in G'(X'')$. By Axiom TR3 the maps $X \to Y_2$ and $X' \to Y_3$ fit into
a morphism of distinguished triangles
$(X'' \to X \to X') \to (Y_1 \to Y_2 \to Y_3)$
and we find that indeed $\xi$ is the image of the
element of $G'(Y_1)$ represented by $X'' \to Y_1$ and $g'' \in G(X'')$.

\medskip\noindent
If $Y \in \Ob(\mathcal{D}_c)$, then $\text{id} : Y \to Y$ is the final
object in the category of arrows $X \to Y$ with $X \in \Ob(\mathcal{D}_c)$.
Hence we see that $G'(Y) = G(Y)$ in this case and the
statement on restriction holds. Let $Y = \bigoplus_{i \in I} Y_i$
be a direct sum. Let $a : X \to Y$ with $X \in \Ob(\mathcal{D}_c)$
and $g \in G(X)$ represent an element $\xi$ of $G'(Y)$.
The morphism $a : X \to Y$ can be uniquely written as a sum of morphisms
$a_i : X \to Y_i$ almost all zero as $X$ is a compact object of $\mathcal{D}$.
Let $I' = \{i \in I \mid a_i \not = 0\}$. Then we can factor
$a$ as the composition
$$
X \xrightarrow{(1, \ldots, 1)}
\bigoplus\nolimits_{i \in I'} X
\xrightarrow{\bigoplus_{i \in I'} a_i}
\bigoplus\nolimits_{i \in I} Y_i = Y
$$
We conclude that $\xi = \sum_{i \in I'} \xi_i$
is the sum of the images of the elements
$\xi_i \in G'(Y_i)$ corresponding to $a_i : X \to Y_i$
and $g \in G(X)$. Hence $\bigoplus G'(Y_i) \to G'(Y)$
is surjective. We omit the (trivial) verification that it is injective.

\medskip\noindent
It follows that the functor $Y \mapsto G'(Y)^\vee$ is cohomological
and sends direct sums to direct products. Hence by Brown representability,
see Derived Categories, Proposition \ref{derived-proposition-brown}
we conclude that there exists a $Y \in \Ob(\mathcal{D})$
and an isomorphism
$G'(Z)^\vee = \Hom(Z, Y)$ functorially in $Z$.
For $X \in \Ob(\mathcal{D}_c)$ we have
$G'(X)^\vee = G(X)^\vee = (H(X)^\vee)^\vee = H(X)$
because $\dim_k H(X) < \infty$ and the proof is complete.
\end{proof}

\begin{theorem}
\label{theorem-bondal-van-den-bergh}
\begin{reference}
\cite[Theorem A.1]{BvdB}
\end{reference}
Let $X$ be a projective scheme over a field $k$.
Let $F : D_{perf}(\mathcal{O}_X)^{opp} \to \text{Vect}_k$
be a $k$-linear cohomological functor such that
$$
\sum\nolimits_{n \in \mathbf{Z}} \dim_k F(E[n]) < \infty
$$
for all $E \in D_{perf}(\mathcal{O}_X)$. Then $F$ is isomorphic to a functor
of the form $E \mapsto \Hom_X(E, K)$ for some
$K \in D^b_{\textit{Coh}}(\mathcal{O}_X))$.
\end{theorem}

\begin{proof}
The derived category $D_\QCoh(\mathcal{O}_X)$ has direct sums,
is compactly generated, and $D_{perf}(\mathcal{O}_X)$ is the full subcategory
of compact objects, see
Derived Categories of Schemes, Lemma
\ref{perfect-lemma-quasi-coherence-direct-sums},
Theorem \ref{perfect-theorem-bondal-van-den-Bergh}, and
Proposition \ref{perfect-proposition-compact-is-perfect}.
By Lemma \ref{lemma-van-den-bergh} we may assume
$F(E) = \Hom_X(E, K)$ for some $K \in \Ob(D_\QCoh(\mathcal{O}_X))$.
Then it follows that $K$ is in $D^b_{\textit{Coh}}(X)$
by Lemma \ref{lemma-characterize-dbcoh-projective}.
\end{proof}




\section{Representability in the regular proper case}
\label{section-regular-proper}

\noindent
Theorem \ref{theorem-bondal-van-den-bergh}
also holds for regular (for example smooth) proper varieties. This
is proven in \cite{BvdB} using their general characterization
of ``right saturated'' $k$-linear triangulated categories. In this
section we give a quick and dirty proof of this result using a little
bit of duality.

\begin{lemma}
\label{lemma-trace-map}
\begin{reference}
The proof given here follows the argument given in
\cite[Remark 3.4]{MS}
\end{reference}
Let $f : X' \to X$ be a proper birational morphism of integral Noetherian
schemes with $X$ regular. The map $\mathcal{O}_X \to Rf_*\mathcal{O}_{X'}$
canonically splits in $D(\mathcal{O}_X)$.
\end{lemma}

\begin{proof}
Set $E = Rf_*\mathcal{O}_{X'}$ in $D(\mathcal{O}_X)$.
Observe that $E$ is in $D^b_{\textit{Coh}}(X)$ by
Derived Categories of Schemes, Lemma \ref{perfect-lemma-direct-image-coherent}.
By 
Derived Categories of Schemes, Lemma \ref{perfect-lemma-perfect-on-regular}
we find that $E$ is a perfect object of $D(\mathcal{O}_X)$.
Since $\mathcal{O}_{X'}$ is a sheaf of algebras, we have the
relative cup product $\mu : E \otimes_{\mathcal{O}_X}^\mathbf{L} E \to E$
by Cohomology, Remark \ref{cohomology-remark-cup-product}.
Let $\sigma : E \otimes E^\vee \to E^\vee \otimes E$ be the commutativity
constraint on the symmetric monoidal category $D(\mathcal{O}_X)$
(Cohomology, Lemma \ref{cohomology-lemma-symmetric-monoidal-derived}).
Denote $\eta : \mathcal{O}_X \to E \otimes E^\vee$ and
$\epsilon : E^\vee \otimes E \to \mathcal{O}_X$ the map
constructed in Cohomology, Example \ref{cohomology-example-dual-derived}.
Then we can consider the map
$$
E \xrightarrow{\eta \otimes 1} E \otimes E^\vee \otimes E
\xrightarrow{\sigma \otimes 1} E^\vee \otimes E \otimes E
\xrightarrow{1 \otimes \mu} E^\vee \otimes E
\xrightarrow{\epsilon} \mathcal{O}_X
$$
We claim that this map is a one sided inverse to the map in the
statement of the lemma. To see this it suffices to show that
the composition $\mathcal{O}_X \to \mathcal{O}_X$ is the identity
map. This we may do in the generic point of $X$ (or on an open
subscheme of $X$ over which $f$ is an isomorphism). In this
case $E = \mathcal{O}_X$ and $\mu$ is the usual multiplication map
and the result is clear.
\end{proof}

\begin{lemma}
\label{lemma-characterize-dbcoh-proper-regular}
Let $X$ be a proper scheme over a field $k$ which is regular. Let
$K \in \Ob(D_\QCoh(\mathcal{O}_X))$. The following are equivalent
\begin{enumerate}
\item $K \in D^b_{\textit{Coh}}(\mathcal{O}_X) = D_{perf}(\mathcal{O}_X)$, and
\item $\sum_{i \in \mathbf{Z}} \dim_k \Ext^i_X(E, K) < \infty$
for all perfect $E$ in $D(\mathcal{O}_X)$.
\end{enumerate}
\end{lemma}

\begin{proof}
The equality in (1) holds by Derived Categories of Schemes,
Lemma \ref{perfect-lemma-perfect-on-regular}.
The implication (1) $\Rightarrow$ (2) follows from
Lemma \ref{lemma-finiteness}.

\medskip\noindent
Assume (2). We may replace $X$ by one of its connected components
and assume $X$ is a proper regular variety over $k$.
By Chow's lemma we can choose a birational proper morphism
$f : X' \to X$ with $X'$ a projective variety over $k$, see
Cohomology of Schemes, Lemma \ref{coherent-lemma-chow-Noetherian}
and Remark \ref{coherent-remark-chow-Noetherian}.
Denote $a : D_\QCoh(\mathcal{O}_X) \to D_\QCoh(\mathcal{O}_{X'})$
the right adjoint to $Rf_*$, see
Duality for Schemes, Lemma \ref{duality-lemma-twisted-inverse-image}.
If $E$ in $D(\mathcal{O}_{X'})$ is perfect, then so is
$Rf_*E$ in $D(\mathcal{O}_X)$ by
Derived Categories of Schemes, Lemmas
\ref{perfect-lemma-direct-image-coherent} and
\ref{perfect-lemma-perfect-on-regular}.
Hence we see that
$$
\Ext^i_{X'}(E, a(K)) = \Ext^i_X(Rf_*E, K)
$$
is finite dimensional and nonzero for only a finite number of $i$
by our assumption on $K$. By
Lemma \ref{lemma-characterize-dbcoh-projective}
we find that $a(K)$ is in $D^b_{\textit{Coh}}(X')$.
By Duality for Schemes, Lemma \ref{duality-lemma-iso-on-RSheafHom} we have
$$
Rf_*a(K) = R\SheafHom_{\mathcal{O}_X}(Rf_*\mathcal{O}_{X'}, K)
$$
The left hand side is in $D^b_{\textit{Coh}}(X)$ by the already used
Derived Categories of Schemes, Lemmas
\ref{perfect-lemma-direct-image-coherent}.
By Lemma \ref{lemma-trace-map} we have that $Rf_*\mathcal{O}_{X'}$
contains $\mathcal{O}_X$ as a summand. Hence we conclude that
$K$ is in $D^b_{\textit{Coh}}(\mathcal{O}_X)$
as desired.
\end{proof}

\begin{lemma}
\label{lemma-bondal-van-den-bergh}
Let $X$ be a proper scheme over a field $k$ which is regular.
\begin{enumerate}
\item Let $F : D_{perf}(\mathcal{O}_X)^{opp} \to \text{Vect}_k$
be a $k$-linear cohomological functor such that
$$
\sum\nolimits_{n \in \mathbf{Z}} \dim_k F(E[n]) < \infty
$$
for all $E \in D_{perf}(\mathcal{O}_X)$. Then $F$ is isomorphic to a functor
of the form $E \mapsto \Hom_X(E, K)$ for some $K \in D_{perf}(\mathcal{O}_X)$.
\item Let $G : D_{perf}(\mathcal{O}_X) \to \text{Vect}_k$
be a $k$-linear homological functor such that
$$
\sum\nolimits_{n \in \mathbf{Z}} \dim_k G(E[n]) < \infty
$$
for all $E \in D_{perf}(\mathcal{O}_X)$. Then $G$ is isomorphic to a functor
of the form $E \mapsto \Hom_X(K, E)$ for some $K \in D_{perf}(\mathcal{O}_X)$.
\end{enumerate}
\end{lemma}

\begin{proof}
Proof of (1). The derived category $D_\QCoh(\mathcal{O}_X)$ has direct sums,
is compactly generated, and $D_{perf}(\mathcal{O}_X)$ is the full subcategory
of compact objects, see
Derived Categories of Schemes, Lemma
\ref{perfect-lemma-quasi-coherence-direct-sums},
Theorem \ref{perfect-theorem-bondal-van-den-Bergh}, and
Proposition \ref{perfect-proposition-compact-is-perfect}.
By Lemma \ref{lemma-van-den-bergh} we may assume
$F(E) = \Hom_X(E, K)$ for some $K \in \Ob(D_\QCoh(\mathcal{O}_X))$.
Then it follows that $K$ is in $D^b_{\textit{Coh}}(X)$
by Lemma \ref{lemma-characterize-dbcoh-proper-regular}.

\medskip\noindent
Proof of (2). Consider the contravariant functor $E \mapsto E^\vee$
on $D_{perf}(\mathcal{O}_X)$, see
Cohomology, Lemma \ref{cohomology-lemma-dual-perfect-complex}.
This functor is an exact anti-self-equivalence of $D_{perf}(\mathcal{O}_X)$.
Hence we may apply part (1) to the functor $F(E) = G(E^\vee)$ to find
$K \in D_{perf}(\mathcal{O}_X)$ such that $G(E^\vee) = \Hom_X(E, K)$.
It follows that $G(E) = \Hom_X(E^\vee, K) = \Hom_X(K^\vee, E)$
and we conclude that taking $K^\vee$ works.
\end{proof}






\section{Existence of adjoints}
\label{section-adjoints}

\noindent
As a consequence of the results in the paper of Bondal and van den Bergh
we get the following automatic existence of adjoints.

\begin{lemma}
\label{lemma-always-right-adjoints}
Let $k$ be a field. Let $X$ and $Y$ be proper schemes over $k$.
If $X$ is regular, then any exact functor
$F : D_{perf}(\mathcal{O}_X) \to D_{perf}(\mathcal{O}_Y)$
has an exact right adjoint and an exact left adjoint.
\end{lemma}

\begin{proof}
If an adjoint exists it is an exact functor by the very general
Derived Categories, Lemma \ref{derived-lemma-adjoint-is-exact}.

\medskip\noindent
Let us prove the existence of a right adjoint.
To see existence, it suffices to show that for
$M \in D_{perf}(Y)$ the contravariant functor
$K \mapsto \Hom_Y(F(K), M)$ is representable.
This functor is contravariant, $k$-linear, and cohomological.
Hence by Lemma \ref{lemma-bondal-van-den-bergh} part (1)
it suffices to show that
$$
\sum\nolimits_{i \in \mathbf{Z}} \dim_k \Ext^i_Y(F(K), M) < \infty
$$
This follows from Lemma \ref{lemma-finiteness}.

\medskip\noindent
For the existence of the left adjoint we argue in the same
manner using part (2) of Lemma \ref{lemma-bondal-van-den-bergh}.
\end{proof}






\section{Fourier-Mukai functors}
\label{section-fourier-mukai}

\noindent
These functors were first introduced in \cite{Mukai}.

\begin{definition}
\label{definition-fourier-mukai-functor}
Let $S$ be a scheme. Let $X$ and $Y$ be schemes over $S$.
Let $K \in D(\mathcal{O}_{X \times_S Y})$. The exact functor
$$
\Phi_K : D(\mathcal{O}_X) \longrightarrow D(\mathcal{O}_Y),\quad
M \longmapsto R\text{pr}_{2, *}(
L\text{pr}_1^*M \otimes_{\mathcal{O}_{X \times_S Y}}^\mathbf{L} K)
$$
of triangulated categories is called a {\it Fourier-Mukai functor}
and $K$ is called a {\it Fourier-Mukai kernel} for this functor.
Moreover,
\begin{enumerate}
\item if $\Phi_K$ sends $D_\QCoh(\mathcal{O}_X)$ into $D_\QCoh(\mathcal{O}_Y)$
then the resulting exact functor
$\Phi_K : D_\QCoh(\mathcal{O}_X) \to D_\QCoh(\mathcal{O}_Y)$
is called a Fourier-Mukai functor,
\item if $\Phi_K$ sends $D_{perf}(\mathcal{O}_X)$ into
$D_{perf}(\mathcal{O}_Y)$ then the resulting exact functor
$\Phi_K : D_{perf}(\mathcal{O}_X) \to D_{perf}(\mathcal{O}_Y)$
is called a Fourier-Mukai functor, and
\item if $X$ and $Y$ are Noetherian and $\Phi_K$ sends
$D^b_{\textit{Coh}}(\mathcal{O}_X)$ into $D^b_{\textit{Coh}}(\mathcal{O}_Y)$
then the resulting exact functor
$\Phi_K : D^b_{\textit{Coh}}(\mathcal{O}_X) \to
D^b_{\textit{Coh}}(\mathcal{O}_Y)$
is called a Fourier-Mukai functor.
Similarly for $D_{\textit{Coh}}$, $D^+_{\textit{Coh}}$, $D^-_{\textit{Coh}}$.
\end{enumerate}
\end{definition}

\begin{lemma}
\label{lemma-fourier-Mukai-QCoh}
Let $S$ be a scheme. Let $X$ and $Y$ be schemes over $S$.
Let $K \in D(\mathcal{O}_{X \times_S Y})$.
The corresponding Fourier-Mukai functor $\Phi_K$ sends
$D_\QCoh(\mathcal{O}_X)$ into $D_\QCoh(\mathcal{O}_Y)$
if $K$ is in $D_\QCoh(X \times_S Y)$ and $X \to S$ is
quasi-compact and quasi-separated.
\end{lemma}

\begin{proof}
This follows from the fact that derived pullback preserves
$D_\QCoh$
(Derived Categories of Schemes, Lemma
\ref{perfect-lemma-quasi-coherence-pullback}),
derived tensor products preserve $D_\QCoh$
(Derived Categories of Schemes, Lemma
\ref{perfect-lemma-quasi-coherence-tensor-product}),
the projection $\text{pr}_2 : X \times_S Y \to Y$ is
quasi-compact and quasi-separated
(Schemes, Lemmas
\ref{schemes-lemma-quasi-compact-preserved-base-change} and
\ref{schemes-lemma-separated-permanence}), and
total direct image along a quasi-separated and quasi-compact
morphism preserves $D_\QCoh$
(Derived Categories of Schemes, Lemma
\ref{perfect-lemma-quasi-coherence-direct-image}).
\end{proof}

\begin{lemma}
\label{lemma-compose-fourier-mukai}
Let $S$ be a scheme. Let $X, Y, Z$ be schemes over $S$. Assume
$X \to S$ and $Y \to S$ are quasi-compact and quasi-separated.
Let $K \in D_\QCoh(\mathcal{O}_{X \times_S Y})$.
Let $K' \in D_\QCoh(\mathcal{O}_{Y \times_S Z})$.
Consider the Fourier-Mukai functors
$\Phi_K : D_\QCoh(\mathcal{O}_X) \to D_\QCoh(\mathcal{O}_Y)$
and $\Phi_{K'} : D_\QCoh(\mathcal{O}_Y) \to D_\QCoh(\mathcal{O}_Z)$.
If $X$ and $Z$ are tor independent over $S$ and $Y \to S$ is flat,
then
$$
\Phi_{K'} \circ \Phi_K = \Phi_{K''} :
D_\QCoh(\mathcal{O}_X)
\longrightarrow
D_\QCoh(\mathcal{O}_Z)
$$
where
$$
K'' = R\text{pr}_{13, *}(
L\text{pr}_{12}^*K
\otimes_{\mathcal{O}_{X \times_S Y \times_S Z}}^\mathbf{L}
L\text{pr}_{23}^*K')
$$
in $D_\QCoh(\mathcal{O}_{X \times_S Z})$.
\end{lemma}

\begin{proof}
The statement makes sense by Lemma \ref{lemma-fourier-Mukai-QCoh}.
We are going to use
Derived Categories of Schemes, Lemmas
\ref{perfect-lemma-quasi-coherence-pullback},
\ref{perfect-lemma-quasi-coherence-tensor-product}, and
\ref{perfect-lemma-quasi-coherence-direct-image}
and Schemes, Lemmas
\ref{schemes-lemma-quasi-compact-preserved-base-change} and
\ref{schemes-lemma-separated-permanence}
without further mention.
By Derived Categories of Schemes, Lemma
\ref{perfect-lemma-flat-base-change-tor-independent}
we see that $X \times_S Y$ and $Y \times_S Z$ are tor independent
over $Y$. This means that we have base change for the cartesian diagram
$$
\xymatrix{
X \times_S Y \times_S Z \ar[d] \ar[r] &
Y \times_S Z \ar[d]^{p^{YZ}_Y} \\
X \times_S Y \ar[r]^{p^{XY}_Y} & Y
}
$$
for complexes with quasi-coherent cohomology sheaves, see
Derived Categories of Schemes, Lemma \ref{perfect-lemma-compare-base-change}.
Abbreviating $p^* = Lp^*$, $p_* = Rp_*$ and $\otimes = \otimes^\mathbf{L}$
we have for $M \in D_\QCoh(\mathcal{O}_X)$ the sequence of equalities
\begin{align*}
\Phi_{K'}(\Phi_K(M))
& =
p^{YZ}_{Z, *}(p^{YZ, *}_Y p^{XY}_{Y, *}(p^{XY, *}_X M \otimes K) \otimes K') \\
& =
p^{YZ}_{Z, *}(\text{pr}_{23, *} \text{pr}_{12}^*(p^{XY, *}_X M \otimes K)
\otimes K') \\
& =
p^{YZ}_{Z, *}(\text{pr}_{23, *}(\text{pr}_1^*M \otimes \text{pr}_{12}^*K)
\otimes K') \\
& =
p^{YZ}_{Z, *}(\text{pr}_{23, *}(\text{pr}_1^*M \otimes \text{pr}_{12}^*K
\otimes \text{pr}_{23}^*K')) \\
& =
\text{pr}_{3, *}(\text{pr}_1^*M \otimes \text{pr}_{12}^*K
\otimes \text{pr}_{23}^*K') \\
& =
p^{XZ}_{Z, *}\text{pr}_{13, *}(\text{pr}_1^*M \otimes \text{pr}_{12}^*K
\otimes \text{pr}_{23}^*K') \\
& =
p^{XZ}_{Z, *} (p^{XZ, *}_X M \otimes \text{pr}_{13, *}(\text{pr}_{12}^*K
\otimes \text{pr}_{23}^*K'))
\end{align*}
as desired. Here we have used the remark on base change in the
second equality and we have use Derived Categories of Schemes, Lemma
\ref{perfect-lemma-cohomology-base-change} in the $4$th and
last equality.
\end{proof}

\begin{lemma}
\label{lemma-fourier-mukai}
Let $S$ be a scheme. Let $X$ and $Y$ be schemes over $S$.
Let $K \in D(\mathcal{O}_{X \times_S Y})$.
The corresponding Fourier-Mukai functor $\Phi_K$ sends
$D_{perf}(\mathcal{O}_X)$ into $D_{perf}(\mathcal{O}_Y)$ if at least
one of the following conditions is satisfied:
\begin{enumerate}
\item $S$ is Noetherian, $X \to S$ and $Y \to S$ are of finite type,
$K \in D^b_{\textit{Coh}}(X \times_S Y)$, the support of $H^i(K)$
is proper over $Y$ for all $i$, and $K$ has finite tor dimension
as an object of $D(\text{pr}_2^{-1}\mathcal{O}_Y)$,
\item $X \to S$ is of finite presentation and $K$ can be represented
by a bounded complex $\mathcal{K}^\bullet$ of finitely presented
$\mathcal{O}_{X \times_S Y}$-modules, flat over $Y$, with support
proper over $Y$,
\item $X \to S$ is a proper flat morphism of finite presentation
and $K$ is perfect,
\item $S$ is Noetherian, $X \to S$ is flat and proper, and $K$ is perfect
\item $X \to S$ is a proper flat morphism of finite presentation
and $K$ is $Y$-perfect,
\item $S$ is Noetherian, $X \to S$ is flat and proper, and $K$ is
$Y$-perfect.
\end{enumerate}
\end{lemma}

\begin{proof}
If $M$ is perfect on $X$, then $L\text{pr}_1^*M$
is perfect on $X \times_S Y$, see
Cohomology, Lemma \ref{cohomology-lemma-perfect-pullback}.
We will use this without further mention below.
We will also use that if $X \to S$ is of finite type, or proper, or
flat, or of finite presentation, then the same thing is true for
the base change $\text{pr}_2 : X \times_S Y \to Y$, see
Morphisms, Lemmas
\ref{morphisms-lemma-base-change-finite-type},
\ref{morphisms-lemma-base-change-proper},
\ref{morphisms-lemma-base-change-flat}, and
\ref{morphisms-lemma-base-change-finite-presentation}.

\medskip\noindent
Part (1) follows from
Derived Categories of Schemes, Lemma \ref{perfect-lemma-perfect-direct-image}
combined with
Derived Categories of Schemes, Lemma \ref{perfect-lemma-perfect-on-noetherian}.

\medskip\noindent
Part (2) follows from
Derived Categories of Schemes, Lemma
\ref{perfect-lemma-base-change-tensor-perfect}.

\medskip\noindent
Part (3) follows from
Derived Categories of Schemes, Lemma
\ref{perfect-lemma-flat-proper-perfect-direct-image-general}.

\medskip\noindent
Part (4) follows from part (3) and the fact that a finite type
morphism of Noetherian schemes is of finite presentation by Morphisms, Lemma
\ref{morphisms-lemma-noetherian-finite-type-finite-presentation}.

\medskip\noindent
Part (5) follows from
Derived Categories of Schemes, Lemma
\ref{perfect-lemma-derived-pushforward-rel-perfect} combined with
Derived Categories of Schemes, Lemma
\ref{perfect-lemma-perfect-relatively-perfect}.

\medskip\noindent
Part (6) follows from part (5) in the same way that part (4) follows from
part (3).
\end{proof}

\begin{example}
\label{example-diagonal-fourier-mukai}
Let $X \to S$ be a separated morphism of schemes. Then the diagonal
$\Delta : X \to X \times_S X$ is a closed immersion and hence
$\mathcal{O}_\Delta = \Delta_*\mathcal{O}_X = R\Delta_*\mathcal{O}_X$
is a quasi-coherent $\mathcal{O}_{X \times_S X}$-module of finite type
which is flat over $X$ (under either projection). The Fourier-Mukai functor
$\Phi_{\mathcal{O}_\Delta}$ is equal to the identity in this case.
Namely, if we represent any $M \in D(\mathcal{O}_X)$ by a K-flat
complex $\mathcal{M}^\bullet$, then $\text{pr}_1^{-1}\mathcal{M}^\bullet$
is a K-flat complex of $\text{pr}_1^{-1}\mathcal{O}_X$-modules
(Cohomology, Lemma \ref{cohomology-lemma-pullback-K-flat})
and hence we have
$$
L\text{pr}_1^*M \otimes_{\mathcal{O}_{X \times_S X}}^\mathbf{L}
\mathcal{O}_\Delta =
\text{pr}_1^{-1}\mathcal{M}^\bullet
\otimes_{\text{pr}_1^{-1}\mathcal{O}_X}^\mathbf{L}
\mathcal{O}_\Delta =
R\Delta_*(\mathcal{M}^\bullet)
$$
The first equality by Cohomology, Lemma
\ref{cohomology-lemma-variant-derived-pullback} and
the second equality by Cohomology, Lemma
\ref{cohomology-lemma-projection-formula-closed-immersion}
for the morphism of ringed spaces $\Delta : (X, \mathcal{O}_X) \to
(X \times_S X, \text{pr}_1^{-1}\mathcal{O}_X)$.
If we push this to $X$ using $R\text{pr}_{2, *}$
we obtain $\mathcal{M}^\bullet$ as desired. Some details omitted.
\end{example}

\begin{lemma}
\label{lemma-fourier-mukai-right-adjoint}
\begin{reference}
Compare with discussion in \cite{Rizzardo}.
\end{reference}
Let $X \to S$ and $Y \to S$ be morphisms of quasi-compact and quasi-separated
schemes. Let $\Phi : D_\QCoh(\mathcal{O}_X) \to D_\QCoh(\mathcal{O}_Y)$
be a Fourier-Mukai functor with pseudo-coherent kernel
$K \in D_\QCoh(X \times_S Y)$.
Let $a : D_\QCoh(\mathcal{O}_Y) \to  D_\QCoh(X \times_S Y)$
be the right adjoint to $R\text{pr}_{2, *}$, see
Duality for Schemes, Lemma \ref{duality-lemma-twisted-inverse-image}.
Denote
$$
K' = (Y \times_S X \to X \times_S Y)^*
R\SheafHom_{\mathcal{O}_{X \times_S Y}}(K, a(\mathcal{O}_Y)) \in
D_\QCoh(\mathcal{O}_{Y \times_S X})
$$
and denote $\Phi' : D_\QCoh(\mathcal{O}_Y) \to D_\QCoh(\mathcal{O}_X)$
the corresponding Fourier-Mukai transform. There is a canonical map
$$
\Hom_X(M, \Phi'(N)) \longrightarrow \Hom_Y(\Phi(M), N)
$$
functorial in $M$ in $D_\QCoh(\mathcal{O}_X)$ and $N$ in
$D_\QCoh(\mathcal{O}_Y)$ which is an isomorphism if
\begin{enumerate}
\item $N$ is perfect, or
\item $K$ is perfect and $X \to S$ is proper flat and of finite presentation.
\end{enumerate}
\end{lemma}

\begin{proof}
By Lemma \ref{lemma-fourier-Mukai-QCoh} we obtain a functor $\Phi$
as in the statement. Observe that $a(\mathcal{O}_Y)$ is in
$D^+_\QCoh(\mathcal{O}_{X \times_S Y})$ by Duality for Schemes,
Lemma \ref{duality-lemma-twisted-inverse-image-bounded-below}.
Hence for $K$ pseudo-coherent we have
$K' \in D_\QCoh(\mathcal{O}_{Y \times_S X})$
by Derived Categories of Schemes, Lemma
\ref{perfect-lemma-quasi-coherence-internal-hom}
we we obtain $\Phi'$ as indicated.

\medskip\noindent
We abbreviate
$\otimes^\mathbf{L} = \otimes_{\mathcal{O}_{X \times_S Y}}^\mathbf{L}$
and
$\SheafHom = R\SheafHom_{\mathcal{O}_{X \times_S Y}}$.
Let $M$ be in $D_\QCoh(\mathcal{O}_X)$ and let
$N$ be in $D_\QCoh(\mathcal{O}_Y)$. We have
\begin{align*}
\Hom_Y(\Phi(M), N)
& =
\Hom_Y(R\text{pr}_{2, *}(L\text{pr}_1^*M \otimes^\mathbf{L} K), N) \\
& =
\Hom_{X \times_S Y}(L\text{pr}_1^*M \otimes^\mathbf{L} K, a(N)) \\
& =
\Hom_{X \times_S Y}(L\text{pr}_1^*M,
R\SheafHom(K, a(N))) \\
& =
\Hom_X(M, R\text{pr}_{1, *}R\SheafHom(K, a(N)))
\end{align*}
where we have used Cohomology, Lemmas \ref{cohomology-lemma-internal-hom}
and \ref{cohomology-lemma-adjoint}. There are canonical maps
$$
L\text{pr}_2^*N \otimes^\mathbf{L} R\SheafHom(K, a(\mathcal{O}_Y))
\xrightarrow{\alpha}
R\SheafHom(K, L\text{pr}_2^*N \otimes^\mathbf{L} a(\mathcal{O}_Y))
\xrightarrow{\beta}
R\SheafHom(K, a(N))
$$
Here $\alpha$ is
Cohomology, Lemma \ref{cohomology-lemma-internal-hom-diagonal-better}
and $\beta$ is Duality for Schemes, Equation
(\ref{duality-equation-compare-with-pullback}).
Combining all of these arrows we obtain the functorial displayed
arrow in the statement of the lemma.

\medskip\noindent
The arrow $\alpha$ is an isomorphism by
Derived Categories of Schemes, Lemma
\ref{perfect-lemma-internal-hom-evaluate-tensor-isomorphism}
as soon as either $K$ or $N$ is perfect.
The arrow $\beta$ is an isomorphism if $N$ is perfect by
Duality for Schemes, Lemma \ref{duality-lemma-compare-with-pullback-perfect}
or in general if $X \to S$ is
flat proper of finite presentation by
Duality for Schemes, Lemma
\ref{duality-lemma-compare-with-pullback-flat-proper}.
\end{proof}

\begin{lemma}
\label{lemma-fourier-mukai-left-adjoint}
\begin{reference}
Compare with discussion in \cite{Rizzardo}.
\end{reference}
Let $S$ be a Noetherian scheme. Let $X \to S$ be a flat proper
morphism and let $Y \to S$ be a finite type morphism. Let
$\Phi : D_\QCoh(\mathcal{O}_X) \to D_\QCoh(\mathcal{O}_Y)$
be a Fourier-Mukai functor with perfect kernel
$K \in D_\QCoh(X \times_S Y)$.
Let $a : D_\QCoh(\mathcal{O}_X) \to  D_\QCoh(X \times_S Y)$
be the right adjoint to $R\text{pr}_{1, *}$, see
Duality for Schemes, Lemma \ref{duality-lemma-twisted-inverse-image}.
Denote
$$
K' = (Y \times_S X \to X \times_S Y)^*
R\SheafHom_{\mathcal{O}_{X \times_S Y}}(K, a(\mathcal{O}_X)) \in
D_\QCoh(\mathcal{O}_{Y \times_S X})
$$
and denote $\Phi' : D_\QCoh(\mathcal{O}_Y) \to D_\QCoh(\mathcal{O}_X)$
the corresponding Fourier-Mukai transform. There is a canonical
isomorphism
$$
\Hom_Y(N, \Phi(M)) \longrightarrow \Hom_X(\Phi'(N), M)
$$
functorial in $M$ in $D_\QCoh(\mathcal{O}_X)$ and $N$ in
$D_\QCoh(\mathcal{O}_Y)$.
\end{lemma}

\begin{proof}
By Lemma \ref{lemma-fourier-Mukai-QCoh} we obtain a functor $\Phi$
as in the statement. Observe that $a(\mathcal{O}_X)$ is in
$D^+_\QCoh(\mathcal{O}_{X \times_S Y})$ by Duality for Schemes,
Lemma \ref{duality-lemma-twisted-inverse-image-bounded-below}.
Hence we have $K' \in D_\QCoh(\mathcal{O}_{Y \times_S X})$

\medskip\noindent
To actually prove the lemma we're going to cheat. Namely, we will
show that if we replace the roles of $X$ and $Y$ and $K$ and $K'$
then these are as in Lemma \ref{lemma-fourier-mukai-right-adjoint}
and we get the result. First, observe that by
Derived Categories of Schemes, Lemma
\ref{perfect-lemma-quasi-coherence-internal-hom}
the complex $a(\mathcal{O}_X)$ is in
$D^b_{\textit{Coh}}(\mathcal{O}_{X \times_S Y})$
(because it is pseudo-coherent and bounded) and
hence $K'$ is in $D^b_{\textit{Coh}}(Y \times_S X)$
by Derived Categories of Schemes, Lemma
\ref{perfect-lemma-perfect-on-noetherian}
so that the discussion in Lemma \ref{lemma-fourier-mukai-right-adjoint}
applies to it. To show that the procedure of
Lemma \ref{lemma-fourier-mukai-right-adjoint} applied to $K'$ on $Y \times_S X$
produces a complex isomorphic to $K$ it suffices
(details omitted) to show that
$$
R\SheafHom(R\SheafHom(K, a(\mathcal{O}_X)), a(\mathcal{O}_X)) = K
$$
By Duality for Schemes, Lemma \ref{duality-lemma-properties-relative-dualizing}
we have $R\SheafHom(a(\mathcal{O}_X), a(\mathcal{O}_X)) =
\mathcal{O}_{X \times_S Y}$ and the displayed equality follows easily
from this and the fact that $K$ is assumed perfect (hint: use the
canonical map of
Cohomology, Lemma \ref{cohomology-lemma-internal-hom-evaluate} and work
locally on $X \times_S Y$).
\end{proof}

\begin{lemma}
\label{lemma-fourier-mukai-flat-proper-over-noetherian}
Let $S$ be a Noetherian scheme.
\begin{enumerate}
\item For $X$, $Y$ proper and flat over $S$ and $K$ in
$D_{perf}(\mathcal{O}_{X \times_S Y})$ we obtain a Fourier-Mukai functor
$\Phi_K : D_{perf}(\mathcal{O}_X) \to D_{perf}(\mathcal{O}_Y)$.
\item For $X$, $Y$, $Z$ proper and flat over $S$, $K \in
D_{perf}(\mathcal{O}_{X \times_S Y})$, $K' \in
D_{perf}(\mathcal{O}_{Y \times_S Z})$ the composition
$\Phi_{K'} \circ \Phi_K : D_{perf}(\mathcal{O}_X) \to D_{perf}(\mathcal{O}_Z)$
is equal to $\Phi_{K''}$ with $K'' \in D_{perf}(\mathcal{O}_{X \times_S Z})$
computed as in Lemma \ref{lemma-compose-fourier-mukai},
\item For $X$, $Y$, $K$, $\Phi_K$ as in (1) if $X \to S$ is Gorenstein, then
$\Phi_{K'} : D_{perf}(\mathcal{O}_Y) \to D_{perf}(\mathcal{O}_X)$ is a right
adjoint to $\Phi_K$ where $K' \in D_{perf}(\mathcal{O}_{Y \times_S X})$
is the pullback of $L\text{pr}_1^*\omega_{X/S}^\bullet
\otimes_{\mathcal{O}_{X \times_S Y}}^\mathbf{L} K^\vee$ by
$Y \times_S X \to X \times_S Y$.
\item For $X$, $Y$, $K$, $\Phi_K$ as in (1) if $Y \to S$ is Gorenstein, then
$\Phi_{K''} : D_{perf}(\mathcal{O}_Y) \to D_{perf}(\mathcal{O}_X)$ is a left
adjoint to $\Phi_K$ where $K'' \in D_{perf}(\mathcal{O}_{Y \times_S X})$
is the pullback of $L\text{pr}_2^*\omega_{Y/S}^\bullet
\otimes_{\mathcal{O}_{X \times_S Y}}^\mathbf{L} K^\vee$ by
$Y \times_S X \to X \times_S Y$.
\end{enumerate}
\end{lemma}

\begin{proof}
Part (1) is immediate from Lemma \ref{lemma-fourier-mukai} part (4).

\medskip\noindent
Part (2) follows from Lemma \ref{lemma-compose-fourier-mukai} and the
fact that
$K'' = R\text{pr}_{13, *}(
L\text{pr}_{12}^*K
\otimes_{\mathcal{O}_{X \times_S Y \times_S Z}}^\mathbf{L}
L\text{pr}_{23}^*K')$ is perfect for example by
Derived Categories of Schemes, Lemma
\ref{perfect-lemma-flat-proper-perfect-direct-image}.

\medskip\noindent
The adjointness in part (3) on all complexes with quasi-coherent cohomology
sheaves follows from Lemma \ref{lemma-fourier-mukai-right-adjoint} with
$K'$ equal to the pullback of
$R\SheafHom_{\mathcal{O}_{X \times_S Y}}(K, a(\mathcal{O}_Y))$
by $Y \times_S X \to X \times_S Y$ where $a$ is the right adjoint
to $R\text{pr}_{2, *} : D_\QCoh(\mathcal{O}_{X \times_S Y}) \to
D_\QCoh(\mathcal{O}_Y)$. Denote $f : X \to S$ the structure morphism of $X$.
Since $f$ is proper the functor
$f^! : D_\QCoh^+(\mathcal{O}_S) \to D_\QCoh^+(\mathcal{O}_X)$
is the restriction to $D_\QCoh^+(\mathcal{O}_S)$
of the right adjoint to
$Rf_* : D_\QCoh(\mathcal{O}_X) \to D_\QCoh(\mathcal{O}_S)$, see
Duality for Schemes, Section \ref{duality-section-upper-shriek}.
Hence the relative dualizing complex $\omega_{X/S}^\bullet$ as defined in
Duality for Schemes, Remark
\ref{duality-remark-relative-dualizing-complex}
is equal to $\omega_{X/S}^\bullet = f^!\mathcal{O}_S$.
Since formation of the relative dualizing complex
commutes with base change (see Duality for Schemes, Remark
\ref{duality-remark-relative-dualizing-complex}) we see that
$a(\mathcal{O}_Y) = L\text{pr}_1^*\omega_{X/S}^\bullet$.
Thus
$$
R\SheafHom_{\mathcal{O}_{X \times_S Y}}(K, a(\mathcal{O}_Y))
\cong
L\text{pr}_1^*\omega_{X/S}^\bullet
\otimes_{\mathcal{O}_{X \times_S Y}}^\mathbf{L} K^\vee
$$
by Cohomology, Lemma \ref{cohomology-lemma-dual-perfect-complex}.
Finally, since $X \to S$ is assumed Gorenstein the relative dualizing complex
is invertible: this follows from Duality for Schemes, Lemma
\ref{duality-lemma-affine-flat-Noetherian-gorenstein}.
We conclude that $\omega_{X/S}^\bullet$ is perfect
(Cohomology, Lemma \ref{cohomology-lemma-invertible-derived})
and hence $K'$ is perfect.
Therefore $\Phi_{K'}$ does indeed map $D_{perf}(\mathcal{O}_Y)$
into $D_{perf}(\mathcal{O}_X)$ which finishes the proof of (3).

\medskip\noindent
The proof of (4) is the same as the proof of (3) except one uses
Lemma \ref{lemma-fourier-mukai-left-adjoint} instead of
Lemma \ref{lemma-fourier-mukai-right-adjoint}.
\end{proof}














\section{Resolutions and bounds}
\label{section-tricks-smooth}

\noindent
The diagonal of a smooth proper scheme has a nice resolution.

\begin{lemma}
\label{lemma-on-product}
Let $R$ be a Noetherian ring. Let $X$, $Y$ be finite type schemes over $R$
having the resolution property. For any coherent
$\mathcal{O}_{X \times_R Y}$-module $\mathcal{F}$ there exist
a surjection $\mathcal{E} \boxtimes \mathcal{G} \to \mathcal{F}$
where $\mathcal{E}$ is a finite locally free $\mathcal{O}_X$-module
and $\mathcal{G}$ is a finite locally free $\mathcal{O}_Y$-module.
\end{lemma}

\begin{proof}
Let $U \subset X$ and $V \subset Y$ be affine open subschemes. Let
$\mathcal{I} \subset \mathcal{O}_X$ be the ideal sheaf of the
reduced induced closed subscheme structure on $X \setminus U$.
Similarly, let $\mathcal{I}' \subset \mathcal{O}_Y$ be the ideal sheaf of the
reduced induced closed subscheme structure on $Y \setminus V$.
Then the ideal sheaf
$$
\mathcal{J} = \Im(\text{pr}_1^*\mathcal{I} \otimes_{\mathcal{O}_{X \times_R Y}}
\text{pr}_2^*\mathcal{I}' \to \mathcal{O}_{X \times_R Y})
$$
satisfies $V(\mathcal{J}) = X \times_R Y \setminus U \times_R V$.
For any section $s \in \mathcal{F}(U \times_R V)$ we can find an integer
$n > 0$ and a map $\mathcal{J}^n \to \mathcal{F}$ whose restriction to
$U \times_R V$ gives $s$, see
Cohomology of Schemes, Lemma \ref{coherent-lemma-homs-over-open}.
By assumption we can choose surjections
$\mathcal{E} \to \mathcal{I}$ and $\mathcal{G} \to \mathcal{I}'$.
These produce corresponding surjections
$$
\mathcal{E} \boxtimes \mathcal{G} \to \mathcal{J}
\quad\text{and}\quad
\mathcal{E}^{\otimes n} \boxtimes \mathcal{G}^{\otimes n} \to \mathcal{J}^n
$$
and hence a map
$\mathcal{E}^{\otimes n} \boxtimes \mathcal{G}^{\otimes n} \to \mathcal{F}$
whose image contains the section $s$ over $U \times_R V$.
Since we can cover $X \times_R Y$ by a finite number of affine opens
of the form $U \times_R V$ and since $\mathcal{F}|_{U \times_R V}$
is generated by finitely many sections (Properties, Lemma
\ref{properties-lemma-finite-type-module})
we conclude that there exists a surjection
$$
\bigoplus\nolimits_{j = 1, \ldots, N}
\mathcal{E}_j^{\otimes n_j} \boxtimes \mathcal{G}_j^{\otimes n_j}
\to \mathcal{F}
$$
where $\mathcal{E}_j$ is finite locally free on $X$ and
$\mathcal{G}_j$ is finite locally free on $Y$.
Setting $\mathcal{E} = \bigoplus \mathcal{E}_j^{\otimes n_j}$
and $\mathcal{G} = \bigoplus \mathcal{G}_j^{\otimes n_j}$
we conclude that the lemma is true.
\end{proof}

\begin{lemma}
\label{lemma-on-product-general}
Let $R$ be a ring. Let $X$, $Y$ be quasi-compact and quasi-separated
schemes over $R$ having the resolution property. For any finite
type quasi-coherent $\mathcal{O}_{X \times_R Y}$-module $\mathcal{F}$
there exist a surjection $\mathcal{E} \boxtimes \mathcal{G} \to \mathcal{F}$
where $\mathcal{E}$ is a finite locally free $\mathcal{O}_X$-module
and $\mathcal{G}$ is a finite locally free $\mathcal{O}_Y$-module.
\end{lemma}

\begin{proof}
Follows from Lemma \ref{lemma-on-product} by a limit argument.
We urge the reader to skip the proof.
Since $X \times_R Y$ is a closed subscheme of $X \times_\mathbf{Z} Y$
it is harmless if we replace $R$ by $\mathbf{Z}$.
We can write $\mathcal{F}$ as the quotient of
a finitely presented $\mathcal{O}_{X \times_R Y}$-module by
Properties, Lemma \ref{properties-lemma-finite-directed-colimit-surjective-maps}.
Hence we may assume $\mathcal{F}$ is of
finite presentation. Next we can write $X = \lim X_i$
with $X_i$ of finite presentation over $\mathbf{Z}$ and similarly
$Y = \lim Y_j$, see Limits, Proposition \ref{limits-proposition-approximate}. Then
$\mathcal{F}$ will descend to $\mathcal{F}_{ij}$ on some $X_i \times_R Y_j$
(Limits, Lemma \ref{limits-lemma-descend-modules-finite-presentation}) and
so does the property of having the resolution property
(Derived Categories of Schemes, Lemma
\ref{perfect-lemma-resolution-property-descends}).
THen we apply Lemma \ref{lemma-on-product}
to $\mathcal{F}_{ij}$ and we pullback.
\end{proof}

\begin{lemma}
\label{lemma-diagonal-resolution}
Let $R$ be a Noetherian ring. Let $X$ be a separated finite type scheme
over $R$ which has the resolution property. Set
$\mathcal{O}_\Delta = \Delta_*(\mathcal{O}_X)$ where
$\Delta : X \to X \times_R X$ is the diagonal of $X/k$.
There exists a resolution
$$
\ldots \to
\mathcal{E}_2 \boxtimes \mathcal{G}_2 \to
\mathcal{E}_1 \boxtimes \mathcal{G}_1 \to
\mathcal{E}_0 \boxtimes \mathcal{G}_0 \to
\mathcal{O}_\Delta \to 0
$$
where each $\mathcal{E}_i$ and $\mathcal{G}_i$ is a finite locally
free $\mathcal{O}_X$-module.
\end{lemma}

\begin{proof}
Since $X$ is separated, the diagonal morphism $\Delta$ is a closed
immersion and hence $\mathcal{O}_\Delta$ is a coherent
$\mathcal{O}_{X \times_R X}$-module (Cohomology of Schemes, Lemma
\ref{coherent-lemma-i-star-equivalence}).
Thus the lemma follows immediately from Lemma \ref{lemma-on-product}.
\end{proof}

\begin{lemma}
\label{lemma-diagonal-trick}
Let $k$ be a field. Let $X$ be a separated smooth scheme over $k$.
There exist finite locally free $\mathcal{O}_X$-modules
$\mathcal{E}$ and $\mathcal{G}$ such that
$$
\mathcal{O}_\Delta \in \langle \mathcal{E} \boxtimes \mathcal{G} \rangle
$$
in $D(\mathcal{O}_{X \times X})$ where the notation is as in
Derived Categories, Section \ref{derived-section-generators}.
\end{lemma}

\begin{proof}
Recall that $X$ is regular by
Varieties, Lemma \ref{varieties-lemma-smooth-regular}.
Hence $X$ has the resolution property by
Derived Categories of Schemes, Lemma
\ref{perfect-lemma-regular-resolution-property}.
Hence we may choose a resolution as in Lemma \ref{lemma-diagonal-resolution}.
Write $\mathcal{F}^{-i} = \mathcal{E}_i \boxtimes \mathcal{G}_i$
so that $\mathcal{O}_\Delta$ is represented by the complex
$\mathcal{F}^\bullet$ in $D(\mathcal{O}_{X \times X})$.
For every $t \leq 0$ this produces a distinuished triangle
$$
\sigma_{\geq t + 1}\mathcal{F}^\bullet \to
\mathcal{O}_\Delta \to \sigma_{\leq t}\mathcal{F}^\bullet
$$
in $D(\mathcal{O}_{X \times X})$. Since $X \times X$ is smooth over $k$
and hence regular we see that $\mathcal{O}_\Delta$ is a perfect object of
$D(\mathcal{O}_{X \times X})$, see
Derived Categories of Schemes, Lemma \ref{perfect-lemma-perfect-on-regular}.
Hence for $t \ll 0$ the arrow
$\mathcal{O}_\Delta \to \sigma_{\leq t}\mathcal{F}^\bullet$
is zero in $D(\mathcal{O}_{X \times X})$ by
Derived Categories of Schemes, Lemma
\ref{perfect-lemma-ext-from-perfect-into-bounded-QCoh}.
Then it follows that $\mathcal{O}_\Delta$ is a summand
in $D(\mathcal{O}_{X \times X})$
of $\sigma_{\geq t}\mathcal{F}^\bullet$, see
Derived Categories, Lemma \ref{derived-lemma-split}.
Clearly, the object $\sigma_{\geq t}\mathcal{F}^\bullet$
is in
$$
\left\langle
\bigoplus\nolimits_{i, j = 0, \ldots, -t} \mathcal{E}_i \boxtimes \mathcal{G}_i
\right\rangle
\subset
\left\langle
\left(\bigoplus\nolimits_{i, j = 0, \ldots, -t} \mathcal{E}_i\right)
\boxtimes
\left(\bigoplus\nolimits_{i, j = 0, \ldots, -t} \mathcal{G}_i\right)
\right\rangle
$$
which finishes the proof. (The reader may consult
Derived Categories, Lemmas \ref{derived-lemma-generated-by-E-explicit} and
\ref{derived-lemma-in-cone-n} to see that our object is contained in this
category.)
\end{proof}

\begin{lemma}
\label{lemma-smooth-proper-strong-generator}
Let $k$ be a field. Let $X$ be a scheme proper and smooth over $k$.
Then $D_{perf}(\mathcal{O}_X)$
has a strong generator.
\end{lemma}

\begin{proof}
Using Lemma \ref{lemma-diagonal-trick} choose finite locally free
$\mathcal{O}_X$-modules $\mathcal{E}$ and $\mathcal{G}$ such that
$\mathcal{O}_\Delta \in \langle \mathcal{E} \boxtimes \mathcal{G} \rangle$
in $D(\mathcal{O}_{X \times X})$. We claim that $\mathcal{G}$
is a strong generator for $D_{perf}(\mathcal{O}_X)$. With notation as in
Derived Categories, Section \ref{derived-section-operate-on-full}
choose $m, n \geq 1$ such that
$$
\mathcal{O}_\Delta \in
smd(add(\mathcal{E} \boxtimes \mathcal{G}[-m, m])^{\star n})
$$
This is possible by Derived Categories, Lemma
\ref{derived-lemma-find-smallest-containing-E}.
Let $K$ be an object of $D_{perf}(\mathcal{O}_X)$. Since
$L\text{pr}_1^*K \otimes_{\mathcal{O}_{X \times Y}}^\mathbf{L} -$
is an exact functor and since
$$
L\text{pr}_1^*K \otimes_{\mathcal{O}_{X \times Y}}^\mathbf{L}
(\mathcal{E} \boxtimes \mathcal{G}) =
(K \otimes_{\mathcal{O}_X}^\mathbf{L} \mathcal{E}) \boxtimes \mathcal{G}
$$
we conclude from
Derived Categories, Remark \ref{derived-remark-operations-functor} that
$$
L\text{pr}_1^*K
\otimes_{\mathcal{O}_{X \times Y}}^\mathbf{L}
\mathcal{O}_\Delta
\in
smd(add(
(K \otimes_{\mathcal{O}_X}^\mathbf{L} \mathcal{E})
\boxtimes \mathcal{G}[-m, m])^{\star n})
$$
Applying the exact functor $R\text{pr}_{2, *}$ and observing that
$$
R\text{pr}_{2, *}
\left((K \otimes_{\mathcal{O}_X}^\mathbf{L} \mathcal{E}) \boxtimes
\mathcal{G}\right) =
R\Gamma(X, K \otimes_{\mathcal{O}_X}^\mathbf{L} \mathcal{E})
\otimes_k \mathcal{G}
$$
by Derived Categories of Schemes, Lemma
\ref{perfect-lemma-cohomology-base-change} we conclude that
$$
K = R\text{pr}_{2, *}(L\text{pr}_1^*K
\otimes_{\mathcal{O}_{X \times Y}}^\mathbf{L} \mathcal{O}_\Delta)
\in
smd(add(R\Gamma(X, K \otimes_{\mathcal{O}_X}^\mathbf{L} \mathcal{E})
\otimes_k \mathcal{G}[-m, m])^{\star n})
$$
The equality follows from the discussion in
Example \ref{example-diagonal-fourier-mukai}.
Since $K$ is perfect, there exist $a \leq b$ such that
$H^i(X, K)$ is nonzero only for $i \in [a, b]$. We conclude that
the right hand side is contained in
$smd(add(\mathcal{G}[-m + a, m + b])^{\star n})$ which is
itself contained in $\langle \mathcal{G} \rangle_n$ by one of the
references given above. This finishes the proof.
\end{proof}

\begin{lemma}
\label{lemma-diagonal-trick-proper}
Let $k$ be a field. Let $X$ be a proper smooth scheme over $k$.
There exists integers $m, n \geq 1$ and a finite locally free
$\mathcal{O}_X$-module $\mathcal{G}$ such that every coherent
$\mathcal{O}_X$-module is contained in $smd(add(\mathcal{G}[-m, m])^{\star n})$
with notation as in Derived Categories, Section
\ref{derived-section-operate-on-full}.
\end{lemma}

\begin{proof}
In the proof of Lemma \ref{lemma-smooth-proper-strong-generator}
we have shown that there exist $m', n \geq 1$ such that
$$
\mathcal{F} \in smd(add(\mathcal{G}[-m' + a, m' + b])^{\star n})
$$
for any $a \leq b$ such that $H^i(X, \mathcal{F})$ is zero only
for $i \in [a, b]$. Thus we can take $a = 0$ and $b = \dim(X)$.
Taking $m = \max(m', m' + b)$ finishes the proof.
\end{proof}

\noindent
The following lemma is the boundedness result referred to
in the title of this section.

\begin{lemma}
\label{lemma-boundedness}
Let $k$ be a field. Let $X$ be a smooth proper scheme over $k$.
Let $\mathcal{A}$ be an abelian category. Let
$H : D_{perf}(\mathcal{O}_X) \to \mathcal{A}$ be a homological
functor (Derived Categories, Definition \ref{derived-definition-homological})
such that for all $K$ in $D_{perf}(\mathcal{O}_X)$ the object
$H^i(K)$ is nonzero for only a finite number of $i \in \mathbf{Z}$.
Then there exists an integer $m \geq 1$ such that
$H^i(F(\mathcal{F})) = 0$ for $i \not \in [-m, m]$.
Similarly for cohomological functors.
\end{lemma}

\begin{proof}
Combine Lemma \ref{lemma-diagonal-trick-proper} with
Derived Categories, Lemma \ref{derived-lemma-forward-cone-n}.
\end{proof}








\section{Functors between categories of quasi-coherent modules}
\label{section-functor-quasi-coherent}

\noindent
In this section we briefly study functors between categories of
quasi-coherent modules.

\begin{example}
\label{example-functor-quasi-coherent}
Let $R$ be a ring. Let $X$ and $Y$ be
schemes over $R$ with $X$ quasi-compact and quasi-separated.
Let $\mathcal{K}$ be a quasi-coherent $\mathcal{O}_{X \times_R Y}$-module.
Then we can consider the functor
\begin{equation}
\label{equation-FM-QCoh}
F : \QCoh(\mathcal{O}_X) \longrightarrow \QCoh(\mathcal{O}_Y),\quad
\mathcal{F} \longmapsto
\text{pr}_{2, *}(\text{pr}_1^*\mathcal{F}
\otimes_{\mathcal{O}_{X \times_R Y}} \mathcal{K})
\end{equation}
The morphism $\text{pr}_2$ is quasi-compact and quasi-separated
(Schemes, Lemmas \ref{schemes-lemma-quasi-compact-preserved-base-change}
and \ref{schemes-lemma-separated-permanence}). Hence pushforward along
this morphism preserves quasi-coherent modules, see
Schemes, Lemma \ref{schemes-lemma-push-forward-quasi-coherent}.
Moreover, our functor is $R$-linear and commutes with arbitrary direct sums,
see Cohomology of Schemes, Lemma \ref{coherent-lemma-colimit-cohomology}.
\end{example}

\begin{lemma}
\label{lemma-functor-quasi-coherent-from-affine}
Let $R$ be a ring. Let $X$ and $Y$ be schemes over $R$ with $X$ affine.
There is an equivalence of categories between
\begin{enumerate}
\item the category of $R$-linear functors
$F : \QCoh(\mathcal{O}_X) \to \QCoh(\mathcal{O}_Y)$
which are right exact and commute with arbitrary direct sums, and
\item the category $\QCoh(\mathcal{O}_{X \times_R Y})$
\end{enumerate}
given by sending $\mathcal{K}$ to the functor $F$ in (\ref{equation-FM-QCoh}).
\end{lemma}

\begin{proof}
First we observe that since $\text{pr}_2 : X \times_R Y Y$ is affine
(Morphisms, Lemma \ref{morphisms-lemma-base-change-affine}) the functor
$\text{pr}_{2, *}$ is exact (see for example Cohomology of Schemes, Lemma
\ref{coherent-lemma-relative-affine-vanishing}). Hence the functor
(\ref{equation-FM-QCoh}) is right exact in this case.

\medskip\noindent
Let us construct the quasi-inverse to the construction. Let $F$ be
as in (1). Say $X = \Spec(A)$. Consider the quasi-coherent
$\mathcal{O}_Y$-module $\mathcal{G} = F(\mathcal{O}_X)$.
Every element $a \in A$ induces an endomorphism of $\mathcal{G}$
and this defines an $R$-linear map
$A \to \text{End}_{\mathcal{O}_Y}(\mathcal{G})$. Hence we see that
$\mathcal{G}$ is a sheaf of modules over
$$
A \otimes_R \mathcal{O}_Y = \text{pr}_{2, *}\mathcal{O}_{X \times_R Y}
$$
By Morphisms, Lemma \ref{morphisms-lemma-affine-equivalence-modules}
we find that there is a unique
quasi-coherent module $\mathcal{K}$ on $X \times_R Y$ such that
$\mathcal{G} = \text{pr}_{2, *}\mathcal{K}$ compatible with action
of $A$ and $\mathcal{O}_Y$. Commutation with direct sums shows that
$F(\bigoplus_{i \in I} \mathcal{O}_X) = \bigoplus_{i \in I} \mathcal{G}$.
Finally, since $X = \Spec(A)$ for every quasi-coherent $\mathcal{O}_X$-module
$\mathcal{F}$ we can choose an exact sequence
$$
\bigoplus\nolimits_{j \in J} \mathcal{O}_X \to
\bigoplus\nolimits_{i \in I} \mathcal{O}_X \to \mathcal{F} \to 0
$$
This leads to an exact sequence
$$
\bigoplus\nolimits_{j \in J} \mathcal{K} \to
\bigoplus\nolimits_{i \in I} \mathcal{K} \to
\text{pr}_1^*\mathcal{F} \otimes_{\mathcal{O}_{X \times_R Y}} \mathcal{K} \to 0
$$
which using the exact functor $\text{pr}_{2, *}$ gives the exact sequence
$$
\bigoplus\nolimits_{j \in J} \mathcal{G} \to
\bigoplus\nolimits_{i \in I} \mathcal{G} \to
\text{pr}_{2, *}(\text{pr}_1^*\mathcal{F}
\otimes_{\mathcal{O}_{X \times_R Y}} \mathcal{K})
\to 0
$$
which as $F$ commutes with direct sums we may rewrite as
$$
F(\bigoplus\nolimits_{j \in J} \mathcal{O}_X) \to
F(\bigoplus\nolimits_{i \in I} \mathcal{O}_X) \to
\text{pr}_{2, *}(\text{pr}_1^*\mathcal{F}
\otimes_{\mathcal{O}_{X \times_R Y}} \mathcal{K})
\to 0
$$
By right exactness of $F$ we conclude $F$ is isomorphic to
the functor (\ref{equation-FM-QCoh}).
\end{proof}

\begin{remark}
\label{remark-affine-morphism}
Below we will use that for an affine morphism
$h : T \to S$ we have $h_*\mathcal{G} \otimes \mathcal{H} =
h_*(\mathcal{G} \otimes h^*\mathcal{H})$ for
$\mathcal{G} \in \QCoh(\mathcal{O}_T)$ and
$\mathcal{H} \in \QCoh(\mathcal{O}_S)$. This follows
immediately on translating into algebra.
\end{remark}

\begin{lemma}
\label{lemma-functor-quasi-coherent-from-affine-compose}
In Lemma \ref{lemma-functor-quasi-coherent-from-affine} let $F$
correspond to $\mathcal{K}$ in $\QCoh(\mathcal{O}_{X \times_R Y})$.
We have
\begin{enumerate}
\item If $f : X' \to X$ is an affine morphism, then $F \circ f_*$
corresponds to $(f \times \text{id}_Y)^*\mathcal{K}$.
\item If $g : Y' \to Y$ is a quasi-compact and quasi-separated flat
morphism, then $g^* \circ F$ corresponds to
$(\text{id}_X \times g)^*\mathcal{K}$.
\item If $j : V \to Y$ is an open immersion, then $j^* \circ F$
corresponds to $\mathcal{K}|_{X \times_R V}$.
\end{enumerate}
\end{lemma}

\begin{proof}
For part (1) let $\mathcal{F}'$ be a quasi-coherent module on $X'$.
With obvious notation we have
\begin{align*}
\text{pr}_{2, *}(\text{pr}_1^*f_*\mathcal{F}'
\otimes_{\mathcal{O}_{X \times_R Y}} \mathcal{K})
& =
\text{pr}_{2, *}((f \times \text{id}_Y)_*
(\text{pr}'_1)^*\mathcal{F}'
\otimes_{\mathcal{O}_{X \times_R Y}} \mathcal{K}) \\
& =
\text{pr}_{2, *}(f \times \text{id}_Y)_*
\left((\text{pr}'_1)^*\mathcal{F}'
\otimes_{\mathcal{O}_{X' \times_R Y}}
(f \times \text{id}_Y)^*\mathcal{K})\right)  \\
& =
\text{pr}'_{2, *}((\text{pr}'_1)^*\mathcal{F}'
\otimes_{\mathcal{O}_{X' \times_R Y}} (f \times \text{id}_Y)^*\mathcal{K})
\end{align*}
Here the first equality is affine base change, see
Cohomology of Schemes, Lemma \ref{coherent-lemma-affine-base-change}.
The second equality hold by Remark \ref{remark-affine-morphism}.
The third equality is functoriality of pushforwards for modules.
For part (2) we have
$$
g^*\text{pr}_{2, *}(\text{pr}_1^*\mathcal{F}
\otimes_{\mathcal{O}_{X \times_R Y}} \mathcal{K}) =
\text{pr}'_{2, *}((\text{pr}'_1)^*\mathcal{F}
\otimes_{\mathcal{O}_{X \times_R Y'}}
(\text{id}_X \times g)^*\mathcal{K})
$$
by flat base change, see
Cohomology of Schemes, Lemma \ref{coherent-lemma-flat-base-change-cohomology}.
For part (3) we only have to remark that formation of
$\text{pr}_2$ commutes with localization on the target.
\end{proof}

\begin{lemma}
\label{lemma-coh-noetherian-from-affine-flat}
In Lemma \ref{lemma-functor-quasi-coherent-from-affine}
if $F$ is an exact functor, then the corresponding object
$\mathcal{K}$ of $\QCoh(\mathcal{O}_{X \times_R Y})$ is flat over $X$.
\end{lemma}

\begin{proof}
By Lemma \ref{lemma-functor-quasi-coherent-from-affine-compose}
we may assume $Y$ is affine. In this case we can translate the statement
into algebra as follows: Given a ring $R$ and $R$-algebras $A$, $B$
for an $A \otimes_R B$-module $K$ the functor
$\text{Mod}_A \to \text{Mod}_B, M \mapsto M \otimes_A K$
is exact if and only if $K$ is flat as an $A$-module.
This is obvious.
\end{proof}

\begin{lemma}
\label{lemma-functor-quasi-coherent-from-affine-diagonal}
Let $R$ be a ring. Let $X$ and $Y$ be schemes over $R$. Assume $X$ is
quasi-compact and that the diagonal morphism of $X$ is affine.
There is an equivalence of categories between
\begin{enumerate}
\item the category of $R$-linear exact functors
$F : \QCoh(\mathcal{O}_X) \to \QCoh(\mathcal{O}_Y)$
which commute with arbitrary direct sums, and
\item the full subcategory of $\QCoh(\mathcal{O}_{X \times_R Y})$ consisting
of $\mathcal{K}$ such that
\begin{enumerate}
\item $\mathcal{K}$ is flat over $X$,
\item for $\mathcal{F} \in \QCoh(\mathcal{O}_X)$ we have
$R^q\text{pr}_{2, *}(\text{pr}_1^*\mathcal{F}
\otimes_{\mathcal{O}_{X \times_R Y}} \mathcal{K}) = 0$ for $q > 0$.
\end{enumerate}
\end{enumerate}
given by sending $\mathcal{K}$ to the functor $F$ in (\ref{equation-FM-QCoh}).
\end{lemma}

\begin{proof}
Let $\mathcal{K}$ be as in (2). The functor $F$ in
(\ref{equation-FM-QCoh}) commutes with direct sums.
Since by (1) (a) the modules $\mathcal{K}$ is $X$-flat,
we see that given a short exact
sequence $0 \to \mathcal{F}_1 \to \mathcal{F}_2 \to \mathcal{F}_3 \to 0$
we obtain a short exact sequence
$$
0 \to
\text{pr}_1^*\mathcal{F}_1 \otimes_{\mathcal{O}_{X \times_R Y}} \mathcal{K} \to
\text{pr}_1^*\mathcal{F}_2 \otimes_{\mathcal{O}_{X \times_R Y}} \mathcal{K} \to
\text{pr}_1^*\mathcal{F}_3 \otimes_{\mathcal{O}_{X \times_R Y}} \mathcal{K} \to
0
$$
Since by (2)(b) the higher direct image $R^1\text{pr}_{2, *}$
on the first term is zero, we conclude that
$0 \to F(\mathcal{F}_1) \to F(\mathcal{F}_2) \to F(\mathcal{F}_3) \to 0$
and we see that $F$ is as in (1).

\medskip\noindent
Let us construct the quasi-inverse to the construction. Let $F$ be
as in (1). Choose an affine open covering $X = \bigcup_{i = 1, \ldots, n} U_i$.
Since the diagonal of $X$ is affine, we see that the intersections
$U_{i_0 \ldots i_p} = U_{i_0} \cap \ldots \cap U_{i_p}$ are affine
and that the inclusion morphisms
$j_{i_0 \ldots i_p} : U_{i_0 \ldots i_p} \to X$
are affine. See Morphisms, Lemma \ref{morphisms-lemma-affine-permanence}.
In particular, the composition
$$
\QCoh(\mathcal{O}_{U_{i_0 \ldots i_p}})
\xrightarrow{j_{i_0 \ldots i_p *}}
\QCoh(\mathcal{O}_X) \xrightarrow{F}
\QCoh(\mathcal{O}_Y)
$$
is an exact functor commuting with direct sums as a composition of such
functors. By Lemmas \ref{lemma-functor-quasi-coherent-from-affine} and
\ref{lemma-coh-noetherian-from-affine-flat}
this functor is given by a quasi-coherent module
$\mathcal{K}_{i_0 \ldots i_p}$ on $U_{i_0 \ldots i_p} \times_R Y$
flat over $U_{i_0 \ldots i_p}$. Since
$$
\QCoh(\mathcal{O}_{U_{i_0 \ldots i_p i_{p + 1}}})
\xrightarrow{(U_{i_0 \ldots i_p i_{p + 1}} \to U_{i_0 \ldots i_p})_*}
\QCoh(\mathcal{O}_{U_{i_0 \ldots i_p}})
\xrightarrow{j_{i_0 \ldots i_p *}}
\QCoh(\mathcal{O}_X)
$$
is equal to $j_{i_0 \ldots i_p i_{p + 1} *}$ we conclude from
Lemma \ref{lemma-functor-quasi-coherent-from-affine-compose}
and the equivalence of categories of the already used
Lemma \ref{lemma-functor-quasi-coherent-from-affine}
that we obtain identifications
$$
\mathcal{K}_{i_0 \ldots i_p i_{p + 1}} =
\mathcal{K}_{i_0 \ldots i_p}|_{U_{i_0 \ldots i_p i_{p + 1}} \times_R Y}
$$
which satisfy the usual compatibilites for glueing.
In other words, there exists a unique $\mathcal{K} \in \QCoh(X \times_R Y)$
flat over $X$ which restricts to each $\mathcal{K}_{i_0 \ldots i_p}$
on $U_{i_0 \ldots i_p} \times_R Y$ compatible with these identifications.
For every quasi-coherent $\mathcal{O}_X$-module
we have the sheafified {\v C}ech complex
$$
0 \to \mathcal{F} \to
\bigoplus\nolimits_{i_0} j_{i_0 *}\mathcal{F}|_{U_{i_0}} \to
\bigoplus\nolimits_{i_0i_1} j_{i_0 i_1 *}\mathcal{F}|_{U_{i_0 i_1}} \to
\ldots
$$
which is exact.
See Cohomology, Lemma \ref{cohomology-lemma-covering-resolution}.
Applying the exact functor $F$ we find that $F(\mathcal{F})$
maps quasi-isomorphically to the relative {\v C}ech complex with terms
$$
\bigoplus\nolimits_{i_0 \ldots i_p}
(U_{i_0 \ldots i_p} \times_R Y \to Y)_*(
\text{pr}_1^*\mathcal{F} \otimes_{\mathcal{O}_{X \times_R Y}} \mathcal{K}
)|_{U_{i_0 \ldots i_p} \times_R Y}
$$
Since this {\v C}ech complex computes the pushfoward and
higher direct images of
$\text{pr}_1^*\mathcal{F} \otimes_{\mathcal{O}_{X \times_R Y}} \mathcal{K}$
by $\text{pr}_2$ (by Cohomology of Schemes, Lemma
\ref{coherent-lemma-separated-case-relative-cech})
we conclude $F$ and $\mathcal{K}$ correspond and
that we have property (2)(b).
\end{proof}

\begin{lemma}
\label{lemma-persistence-exactness}
Let $R$, $X$, $Y$, and $\mathcal{K}$ be as in
Lemma \ref{lemma-functor-quasi-coherent-from-affine-diagonal} part (2).
Then for any scheme $T$ over $R$ we have
$$
R^q\text{pr}_{13, *}(\text{pr}_{12}^*\mathcal{F}
\otimes_{\mathcal{O}_{T \times_R X \times_R Y}}
\text{pr}_{23}^*\mathcal{K}) = 0
$$
for $\mathcal{F}$ quasi-coherent on $T \times_R X$ and $q > 0$.
\end{lemma}

\begin{proof}
The question is local on $T$ hence we may assume $T$ is affine.
In this case we can consider the diagram
$$
\xymatrix{
T \times_R X \ar[d] &
T \times_R X \times_R Y \ar[d] \ar[l] \ar[r] &
T \times_R Y \ar[d] \\
X &
X \times_R Y \ar[l] \ar[r] &
Y
}
$$
whose vertical arrows are affine. In particular the pushforward along
$T \times_R Y \to Y$ is faithful and exact. Chasing around in the diagram
using that higher direct images along affine morphisms vanish we see that
it suffices to prove
$$
R^q\text{pr}_{2, *}(
\text{pr}_{23, *}(\text{pr}_{12}^*\mathcal{F}
\otimes_{\mathcal{O}_{T \times_R X \times_R Y}}
\text{pr}_{23}^*\mathcal{K})) =
R^q\text{pr}_{2, *}(
\text{pr}_{23, *}(\text{pr}_{12}^*\mathcal{F})
\otimes_{\mathcal{O}_{X \times_R Y}}
\mathcal{K}))
$$
is zero which is true by assumption on $\mathcal{K}$.
The equality holds by Remark \ref{remark-affine-morphism}.
\end{proof}

\begin{lemma}
\label{lemma-functor-quasi-coherent-from-separated}
In Lemma \ref{lemma-functor-quasi-coherent-from-affine-diagonal}
let $F$ and $\mathcal{K}$ correspond. If $X$ is separated and
flat over $R$, then there is a surjection
$\mathcal{O}_X \boxtimes F(\mathcal{O}_X) \to \mathcal{K}$.
\end{lemma}

\begin{proof}
Let $\Delta : X \to X \times_R X$ be the diagonal morphism and
set $\mathcal{O}_\Delta = \Delta_*\mathcal{O}_X$.
Since $\Delta$ is a closed immersion have a short exact sequence
$$
0 \to \mathcal{I} \to 
\mathcal{O}_{X \times_R X} \to \mathcal{O}_\Delta \to 0
$$
Since $\mathcal{K}$ is flat over $X$, the pullback
$\text{pr}_{23}^*\mathcal{K}$ to $X \times_R X \times_R Y$
is flat over $X \times_R X$ and we obtain a short exact sequence
$$
0 \to 
\text{pr}_{12}^*\mathcal{I}
\otimes
\text{pr}_{23}^*\mathcal{K} \to
\text{pr}_{12}^*\mathcal{O}_{X \times_R X}
\otimes
\text{pr}_{23}^*\mathcal{K} \to
\text{pr}_{12}^*\mathcal{O}_\Delta
\otimes
\text{pr}_{23}^*\mathcal{K} \to 0
$$
on $X \times_R X \times_R Y$. Thus, by Lemma \ref{lemma-persistence-exactness}
we obtain a surjection
$$
\text{pr}_{13, *}(
\text{pr}_{12}^*\mathcal{O}_{X \times_R X}
\otimes
\text{pr}_{23}^*\mathcal{K})
\to
\text{pr}_{13, *}(
\text{pr}_{12}^*\mathcal{O}_\Delta
\otimes
\text{pr}_{23}^*\mathcal{K})
$$
By flat base change (
Cohomology of Schemes, Lemma \ref{coherent-lemma-flat-base-change-cohomology})
the source of this arrow is equal to $\mathcal{O}_X \boxtimes F(\mathcal{O}_X)$.
On the other hand the target is equal to
$$
\text{pr}_{13, *}(
\text{pr}_{12}^*\mathcal{O}_\Delta
\otimes
\text{pr}_{23}^*\mathcal{K}) =
\text{pr}_{13, *} (\Delta \times \text{id}_Y)_* \mathcal{K} =
\mathcal{K}
$$
which finishes the proof. The first equality holds for example by
Cohomology, Lemma \ref{cohomology-lemma-projection-formula-closed-immersion}
and the fact that $\text{pr}_{12}^*\mathcal{O}_\Delta =
(\Delta \times \text{id}_Y)_*\mathcal{O}_{X \times_R Y}$.
\end{proof}










\section{Functors between categories of coherent modules}
\label{section-functor-coherent}


\noindent
We need a supply of lemmas telling us certain exact functors have
a certain shape.

\begin{lemma}
\label{lemma-functor-coherent}
Let $X$ and $Y$ be Noetherian schemes. Let
$F : \textit{Coh}(\mathcal{O}_X) \to \textit{Coh}(\mathcal{O}_Y)$
be a functor. Then $F$ extends uniquely to a functor
$\QCoh(\mathcal{O}_X) \to \QCoh(\mathcal{O}_Y)$
which commutes with filtered colimits.
If $F$ is additive, then its extension commutes with arbitrary direct sums.
If $F$ is exact, left exact, or right exact, so is its extension.
\end{lemma}

\begin{proof}
The existence and uniqueness of the extension is a general fact, see
Categories, Lemma \ref{categories-lemma-extend-functor-by-colim}.
To see that the lemma applies observe that coherent modules
are of finite presentation
(Modules, Lemma \ref{modules-lemma-coherent-finite-presentation}) and hence
categorically compact objects of $\textit{Mod}(\mathcal{O}_X)$ by
Modules, Lemma \ref{modules-lemma-finite-presentation-quasi-compact-colimit}.
Finally, every quasi-coherent module is a filtered colimit
of coherent ones for example by
Properties, Lemma \ref{properties-lemma-quasi-coherent-colimit-finite-type}.

\medskip\noindent
Assume $F$ is additive. If $\mathcal{F} = \bigoplus_{j \in J} \mathcal{H}_j$
with $\mathcal{H}_j$ quasi-coherent, then
$\mathcal{F} = \colim_{J' \subset J\text{ finite}}
\bigoplus_{j \in J'} \mathcal{H}_j$.
Denoting the extension of $F$ also by $F$ we obtain
\begin{align*}
F(\mathcal{F})
& =
\colim_{J' \subset J\text{ finite}}
F(\bigoplus\nolimits_{j \in J'} \mathcal{H}_j) \\
& =
\colim_{J' \subset J\text{ finite}}
\bigoplus\nolimits_{j \in J'} F(\mathcal{H}_j) \\
& =
\bigoplus\nolimits_{j \in J} F(\mathcal{H}_j)
\end{align*}
Thus $F$ commutes with arbitrary direct sums.

\medskip\noindent
Suppose $0 \to \mathcal{F} \to \mathcal{F}' \to \mathcal{F}'' \to 0$
is a short exact sequence of quasi-coherent $\mathcal{O}_X$-modules.
Then we write $\mathcal{F}' = \bigcup \mathcal{F}'_i$ as the
union of its coherent submodules, see
Properties, Lemma \ref{properties-lemma-quasi-coherent-colimit-finite-type}.
Denote $\mathcal{F}''_i \subset \mathcal{F}''$ the image of $\mathcal{F}'_i$
and denote $\mathcal{F}_i = \mathcal{F} \cap \mathcal{F}'_i =
\Ker(\mathcal{F}'_i \to \mathcal{F}''_i)$. Then it is clear that
$\mathcal{F} = \bigcup \mathcal{F}_i$ and
$\mathcal{F}'' = \bigcup \mathcal{F}''_i$
and that we have short exact sequences
$$
0 \to \mathcal{F}_i \to \mathcal{F}_i' \to \mathcal{F}_i'' \to 0
$$
Since the extension commutes with filtered colimits we have
$F(\mathcal{F}) = \colim_{i \in I} F(\mathcal{F}_i)$,
$F(\mathcal{F}') = \colim_{i \in I} F(\mathcal{F}'_i)$, and
$F(\mathcal{F}'') = \colim_{i \in I} F(\mathcal{F}''_i)$.
Since filtered colimits are exact
(Modules, Lemma \ref{modules-lemma-limits-colimits}) we
conclude that exactness properties of $F$ are inherited by
its extension.
\end{proof}

\begin{lemma}
\label{lemma-characterize-finite}
Let $f : V \to X$ be a quasi-finite separated morphism of Noetherian
schemes. If there exists a coherent $\mathcal{O}_V$-module $\mathcal{K}$
whose support is $V$ such that $f_*\mathcal{K}$ is coherent and
$R^qf_*\mathcal{K} = 0$, then $f$ is finite.
\end{lemma}

\begin{proof}
By Zariski's main theorem we can find an open immersion
$j : V \to Y$ over $X$ with $\pi : Y \to X$ finite, see
More on Morphisms, Lemma
\ref{more-morphisms-lemma-quasi-finite-separated-pass-through-finite}.
Since $\pi$ is affine the functor $\pi_*$ is exact and faithful
on the category of coherent $\mathcal{O}_X$-modules.
Hence we see that $j_*\mathcal{K}$ is coherent and
that $R^qj_*\mathcal{K}$ is zero for $q > 0$.
In other words, we reduce to the case discussed in the next paragraph.

\medskip\noindent
Assume $f$ is an open immersion. We may replace $X$ by the
scheme theoretic closure of $V$. Assume $X \setminus V$ is nonempty
to get a contradiction. Choose a generic point $\xi \in X \setminus V$
of an irreducible component of $X \setminus V$. Looking at the situation
after base change by $\Spec(\mathcal{O}_{X, \xi}) \to X$ using flat base
change and using
Local Cohomology, Lemma
\ref{local-cohomology-lemma-finiteness-pushforwards-and-H1-local}
we reduce to the algebra problem discussed in the next paragraph.

\medskip\noindent
Let $(A, \mathfrak m)$ be a Noetherian local ring. Let $M$ be a finite $A$-module
whose support is $\Spec(A)$. Then $H^i_\mathfrak m(A) \not = 0$ for some $i$.
This is true by Dualizing Complexes, Lemma \ref{dualizing-lemma-depth}
and the fact that $M$ is not zero hence has finite depth.
\end{proof}

\begin{lemma}
\label{lemma-functor-coherent-over-field}
Let $k$ be a field. Let $X$, $Y$ be finite type schemes over $k$ with $X$ separated.
There is an equivalence of categories between
\begin{enumerate}
\item the category of $k$-linear exact functors
$F : \textit{Coh}(\mathcal{O}_X) \to \textit{Coh}(\mathcal{O}_Y)$, and
\item the category of coherent $\mathcal{O}_{X \times Y}$-modules
$\mathcal{K}$ which are flat over $X$ and have support finite over $Y$
\end{enumerate}
given by sending $\mathcal{K}$ to the restriction of the functor
(\ref{equation-FM-QCoh}) to $\textit{Coh}(\mathcal{O}_X)$.
\end{lemma}

\begin{proof}
Let $\mathcal{K}$ be as in (2). By
Lemma \ref{lemma-functor-quasi-coherent-from-affine}
the functor $F$ given by (\ref{equation-FM-QCoh}) is exact and $k$-linear.
Moreover, $F$ sends $\textit{Coh}(\mathcal{O}_X)$ into
$\textit{Coh}(\mathcal{O}_Y)$ for example by
Cohomology of Schemes, Lemma
\ref{coherent-lemma-support-proper-over-base-pushforward}.

\medskip\noindent
Let us construct the quasi-inverse to the construction. Let $F$ be
as in (1). By Lemma \ref{lemma-functor-coherent} we can extend $F$
to a $k$-linear exact functor on the
categories of quasi-coherent modules which commutes with arbitrary direct sums.
By Lemma \ref{lemma-functor-quasi-coherent-from-affine-diagonal}
the extension corresponds to a unique quasi-coherent module
$\mathcal{K}$, flat over $X$, such that
$R^q\text{pr}_{2, *}(\text{pr}_1^*\mathcal{F}
\otimes_{\mathcal{O}_{X \times Y}} \mathcal{K}) = 0$ for $q > 0$
for all quasi-coherent $\mathcal{O}_X$-modules $\mathcal{F}$.
Since $F(\mathcal{O}_X)$ is a coherent $\mathcal{O}_Y$-module, we
conclude from Lemma \ref{lemma-functor-quasi-coherent-from-separated}
that $\mathcal{K}$ is coherent.

\medskip\noindent
For a closed point $x \in X$ denote $\mathcal{O}_x$ the skyscraper sheaf
at $x$ with value the residue field of $x$. We have
$$
F(\mathcal{O}_x) =
\text{pr}_{2, *}(\text{pr}_1^*\mathcal{O}_x \otimes \mathcal{K}) =
(x \times Y \to Y)_*(\mathcal{K}|_{x \times Y})
$$
Since $x \times Y \to Y$ is finite, we see that the pushforward along
this morphism is faithful. Hence if $y \in Y$ is in the image of the
support of $\mathcal{K}|_{x \times Y}$, then $y$ is in the support of
$F(\mathcal{O}_x)$.

\medskip\noindent
Let $Z \subset X \times Y$ be the scheme theoretic support $Z$ of $\mathcal{K}$, see
Morphisms, Definition \ref{morphisms-definition-scheme-theoretic-support}.
We first prove that $Z \to Y$ is quasi-finite, by proving that its fibres
over closed points are finite. Namely, if the fibre of $Z \to Y$ over a
closed point $y \in Y$ has dimension $> 0$, then we can find infinitely
many pairwise distinct closed points $x_1, x_2, \ldots$ in the image of
$Z_y \to X$. Since we have a surjection
$\mathcal{O}_X \to \bigoplus_{i = 1, \ldots, n} \mathcal{O}_{x_i}$
we obtain a surjection
$$
F(\mathcal{O}_X) \to \bigoplus\nolimits_{i = 1, \ldots, n} F(\mathcal{O}_{x_i})
$$
By what we said above, the point $y$ is in the support of each
of the coherent modules $F(\mathcal{O}_{x_i})$. Since $F(\mathcal{O}_X)$
is a coherent module, this will lead to a contradiction because
the stalk of $F(\mathcal{O}_X)$ at $y$ will be generated by $< n$ elements
if $n$ is large enough. Hence $Z \to Y$ is quasi-finite.
Since $\text{pr}_{2, *}\mathcal{K}$ is coherent and
$R^q\text{pr}_{2, *}\mathcal{K} = 0$ for $q > 0$ we conclude
that $Z \to Y$ is finite by Lemma \ref{lemma-characterize-finite}.
\end{proof}














\input{chapters}

\bibliography{my}
\bibliographystyle{amsalpha}

\end{document}

