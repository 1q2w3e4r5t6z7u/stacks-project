\input{preamble}

% OK, start here.
%
\begin{document}

\title{Constructions of schemes}


\maketitle

\tableofcontents

\section{Introduction}
\label{section-introduction}

\noindent
In this chapter we introduce ways of constructing schemes out of others.
A basic reference is \cite{EGA}.








\section{Relative spectrum}
\label{section-spec}



\noindent
Let $S$ be a scheme.
Let $\mathcal{A}$ be a quasi-coherent sheaf of $\mathcal{O}_S$-algebras.
This means that $\mathcal{A}$ is a sheaf of $\mathcal{O}_S$-algebras
which is quasi-coherent as an $\mathcal{O}_S$-module.

\medskip\noindent
For any $f : T \to S$ the pullback
$f^*\mathcal{A}$ is a quasi-coherent sheaf of $\mathcal{O}_T$-algebras.
We are going to consider pairs $(f : T \to S, \varphi)$ where
$f$ is a morphism of schemes and $\varphi : f^*\mathcal{A} \to \mathcal{O}_T$
is a morphism of $\mathcal{O}_T$-algebras. Note that this is the
same as giving a $f^{-1}\mathcal{O}_S$-algebra homomorphism
$\varphi : f^{-1}\mathcal{A} \to \mathcal{O}_T$, see
Sheaves, Lemma \ref{sheaves-lemma-adjointness-tensor-restrict}.
This is also the same as giving a $\mathcal{O}_S$-algebra map
$\varphi : \mathcal{A} \to f_*\mathcal{O}_T$, see
Sheaves, Lemma \ref{sheaves-lemma-adjoint-push-pull-modules}.
We will use all three ways of thinking about $\varphi$,
without further mention.

\medskip\noindent
Given such a
pair $(f : T \to S, \varphi)$ and a morphism $a : T' \to T$ we get
a second pair $(f' = f \circ a, \varphi' = a^*\varphi)$ which we
call the pull back of $(f, \varphi)$. One way to describe
$\varphi' = a^*\varphi$ is as the composition
$\mathcal{A} \to f_*\mathcal{O}_T \to f'_*\mathcal{O}_{T'}$
where the second map is $f_*a^\sharp$ with
$a^\sharp : \mathcal{O}_T \to a_*\mathcal{O}_{T'}$.
In this way we have defined a contravariant functor
\begin{eqnarray}
\label{equation-spec}
F : \textit{Sch} & \longrightarrow & \textit{Sets} \\
T & \longmapsto & F(T) = \{\text{pairs }(f, \varphi) \text{ as above}\}
\nonumber
\end{eqnarray}

\begin{lemma}
\label{lemma-spec-base-change}
Let $S$ be a scheme. Let $\mathcal{A}$ be a quasi-coherent
sheaf of $\mathcal{O}_S$-algebras. Let $F$ be the functor
associated to $(S, \mathcal{A})$ above.
Let $g : S' \to S$ be a morphism of schemes.
Set $\mathcal{A}' = g^*\mathcal{A}$. Let $F'$ be the
functor associated to $(S', \mathcal{A}')$ above.
Then there is a canonical isomorphism
$$
F' \cong h_{S'} \times_{h_S} F
$$
of functors.
\end{lemma}

\begin{proof}
A pair $(f' : T \to S', \varphi' : (f')^*\mathcal{A}' \to \mathcal{O}_T)$
is the same as a pair $(f, \varphi : f^*\mathcal{A} \to \mathcal{O}_T)$
together with a factorization of $f$ as $f = g \circ f'$. Namely with
this notation we have
$(f')^* \mathcal{A}' = (f')^*g^*\mathcal{A} = f^*\mathcal{A}$.
Hence the lemma.
\end{proof}

\begin{lemma}
\label{lemma-spec-affine}
Let $S$ be a scheme. Let $\mathcal{A}$ be a quasi-coherent
sheaf of $\mathcal{O}_S$-algebras. Let $F$ be the functor
associated to $(S, \mathcal{A})$ above.
If $S$ is affine, then $F$ is representable by the
affine scheme $\text{Spec}(\Gamma(S, \mathcal{A}))$.
\end{lemma}

\begin{proof}
Write $S = \text{Spec}(R)$ and $A = \Gamma(S, \mathcal{A})$.
Then $A$ is an $R$-algebra and $\mathcal{A} = \widetilde A$.
The ring map $R \to A$ gives rise to a canonical map
$$
f_{univ} : \text{Spec}(A)
\longrightarrow
S = \text{Spec}(R).
$$
We have
$f_{univ}^*\mathcal{A} =  \widetilde{A \otimes_R A}$
by Schemes, Lemma \ref{schemes-lemma-widetilde-pullback}.
Hence there is a canonical map
$$
\varphi_{univ} :
f_{univ}^*\mathcal{A} = \widetilde{A \otimes_R A}
\longrightarrow
\widetilde A = \mathcal{O}_{\text{Spec}(A)}
$$
coming from the $A$-module map $A \otimes_R A \to A$,
$a \otimes a' \mapsto aa'$. We claim that the pair
$(f_{univ}, \varphi_{univ})$ represents $F$ in this case.
In other words we claim that for any scheme $T$ the map
$$
\text{Mor}(T, \text{Spec}(A)) \longrightarrow
\{\text{pairs } (f, \varphi)\},\ \ 
a \longmapsto (a^*f_{univ}, a^*\varphi)
$$
is bijective.

\medskip\noindent
Let us construct the inverse map.
For any pair $(f : T \to S, \varphi)$ we get the induced
ring map
$$
\xymatrix{
A = \Gamma(S, \mathcal{A}) \ar[r]^{f^*} &
\Gamma(T, f^*\mathcal{A}) \ar[r]^{\varphi} &
\Gamma(T, \mathcal{O}_T)
}
$$
This induces a morphism of schemes $T \to \text{Spec}(A)$
by Schemes, Lemma \ref{schemes-lemma-morphism-into-affine}.

\medskip\noindent
The verification that this map is inverse to the map
displayed above is omitted.
\end{proof}

\begin{lemma}
\label{lemma-spec}
The functor $F$ is representable by a scheme.
\end{lemma}

\begin{proof}
We are going to use Schemes, Lemma \ref{schemes-lemma-glue-functors}.

\medskip\noindent
First we check that $F$ satisfies the sheaf property for the
Zariski topology. Namely, suppose that $T$ is a scheme,
that $T = \bigcup_{i \in I} U_i$ is an open covering,
and that $(f_i, \varphi_i) \in F(U_i)$ such that
$(f_i, \varphi_i)|_{U_i \cap U_j} = (f_j, \varphi_j)|_{U_i \cap U_j}$.
This implies that the morphisms $f_i : U_i \to S$
glue to a morphism of schemes $f : T \to S$ such that
$f|_{I_i} = f_i$, see Schemes, Section \ref{schemes-section-glueing-schemes}.
Thus $f_i^*\mathcal{A} = f^*\mathcal{A}|_{U_i}$ and by assumption the
morphisms $\varphi_i$ agree on $U_i \cap U_j$. Hence by Sheaves,
Section \ref{sheaves-section-glueing-sheaves} these glue to a
morphism of $\mathcal{O}_T$-algebras $f^*\mathcal{A} \to \mathcal{O}_T$.
This proves that $F$ satisfies the sheaf condition with respect to
the Zariski topology.

\medskip\noindent
Let $S = \bigcup_{i \in I} U_i$ be an affine open covering.
Let $F_i \subset F$ be the subfunctor consisting of
those pairs $(f : T \to S, \varphi)$ such that
$f(T) \subset U_i$.

\medskip\noindent
We have to show each $F_i$ is representable.
This is the case because $F_i$ is identified with
the functor associated to $U_i$ equipped with
the quasi-coherent $\mathcal{O}_{U_i}$-algebra $\mathcal{A}|_{U_i}$,
by Lemma \ref{lemma-spec-base-change}.
Thus the result follows from Lemma \ref{lemma-spec-affine}.

\medskip\noindent
Next we show that $F_i \subset F$ is representable by open immersions.
Let $(f : T \to S, \varphi) \in F(T)$. Consider $V_i = f^{-1}(U_i)$.
It follows from the definition of $F_i$ that given $a : T' \to T$
we gave $a^*(f, \varphi) \in F_i(T')$ if and only if $a(T') \subset V_i$.
This is what we were required to show.

\medskip\noindent
Finally, we have to show that the collection $(F_i)_{i \in I}$
covers $F$. Let $(f : T \to S, \varphi) \in F(T)$.
Consider $V_i = f^{-1}(U_i)$. Since $S = \bigcup_{i \in I} U_i$
is an open covering of $S$ we see that $T = \bigcup_{i \in I} V_i$
is an open covering of $T$. Moreover $(f, \varphi)|_{V_i} \in F_i(V_i)$.
This finishes the proof of the lemma.
\end{proof}

\begin{definition}
\label{definition-spec}
Let $S$ be a scheme. Let $\mathcal{A}$ be a quasi-coherent
sheaf of $\mathcal{O}_S$-algebras. We denote
$\underline{\text{Spec}}_S(\mathcal{A})$ a scheme
representing the functor $F$ introduced in Equation
\ref{equation-spec} above. This is called the {\it relative
spectrum of $\mathcal{A}$ over $S$}. The universal family
is a pair $f_{univ} : \underline{\text{Spec}}_S(\mathcal{A}) \to S$\ and a morphism of $\mathcal{O}_S$-algebras
$$
\mathcal{A}
\longrightarrow
f_{univ, *}\mathcal{O}_{\underline{\text{Spec}}_S(\mathcal{A})}
$$
\end{definition}

\noindent
The following lemma says among other things that forming the
relative spectrum commutes with base change.

\begin{lemma}
\label{lemma-spec-properties}
Let $S$ be a scheme. Let $\mathcal{A}$ be a quasi-coherent
sheaf of $\mathcal{O}_S$-algebras. Let
$f_{univ} : \underline{\text{Spec}}_S(\mathcal{A}) \to S$
be the relative spectrum of $\mathcal{A}$ over $S$.
\begin{enumerate}
\item For every affine open $U \subset S$ the inverse image
$f^{-1}(U)$ is affine.
\item For every morphism $g : S' \to S$ we have
$S' \times_S \underline{\text{Spec}}_S(\mathcal{A}) =
\underline{\text{Spec}}_{S'}(g^*\mathcal{A})$.
\item
The universal
map
$$
\mathcal{A}
\longrightarrow
f_{univ, *}\mathcal{O}_{\underline{\text{Spec}}_S(\mathcal{A})}
$$
is an isomorphism of $\mathcal{O}_S$-algebras.
\end{enumerate}
\end{lemma}

\begin{proof}
We first note that (2) follows immediately from
Lemma \ref{lemma-spec-base-change}. Then (1) follows because
$f^{-1}(U) = U \times_S \underline{\text{Spec}}_S(\mathcal{A}) =
\underline{\text{Spec}}_U(\mathcal{A}|_U)$ combined with
Lemma \ref{lemma-spec-affine}. Finally, (3) follows because
it is local on $S$ and it is clear in case $S$ is affine
by Lemma \ref{lemma-spec-affine} again.
\end{proof}






\section{Vector bundles}
\label{section-vector-bundle}

\noindent
Let $S$ be a scheme.
Let $\mathcal{E}$ be a quasi-coherent sheaf of $\mathcal{O}_S$-modules.
By Modules, Lemma \ref{modules-lemma-whole-tensor-algebra-permanence}
the symmetric algebra $\text{Sym}(\mathcal{E})$ of
$\mathcal{E}$ over $\mathcal{O}_S$
is a quasi-coherent sheaf of $\mathcal{O}_S$-algebras.
Hence it makes sense to apply the construction of the
previous section to it.

\begin{definition}
\label{definition-vector-bundle}
Let $S$ be a scheme.
Let $\mathcal{E}$ be a quasi-coherent sheaf of $\mathcal{O}_S$-modules.
We denote
$$
\mathbf{V}(\mathcal{E}) = \underline{\text{Spec}}_S(\text{Sym}(\mathcal{E}))
$$
and we call it the {\it vector bundle associated to the
quasi-coherent sheaf of $\mathcal{O}_S$-modules $\mathcal{E}$}.
\end{definition}







\section{Proj of a graded ring}
\label{section-proj}

\noindent
Let $S$ be a graded ring. Consider the topological space $\text{Proj}(S)$
associated to $S$, see Algebra, Section \ref{algebra-section-proj}.
We will endow this space with a sheaf of rings $\mathcal{O}_{\text{Proj}(S)}$
such that the resulting pair $(\text{Proj}(R), \mathcal{O}_{\text{Proj}(R)})$
will be a scheme.

\medskip\noindent
Recall that $\text{Proj}(S)$ has a basis of open sets $D_{+}(f)$,
$f \in S_d$, $d \geq 1$ which we call {\it standard opens}, see Algebra,
Section \ref{algebra-section-proj}. This terminology will always
imply that $f$ is homogeneous of positive degree even if we forget to
mention it. In addition, the intersection of two standard opens is another:
$D_{+}(f) \cap D_{+}(g) = D_{+}(fg)$, for $f, g \in S$ homogeneous of positive
degree.

\begin{lemma}
\label{lemma-standard-open}
Let $S$ be a graded ring. Let $f \in S$ homogeneous of positive degree.
\begin{enumerate}
\item If $g\in S$ homogeneous of positive degree
and $D_{+}(g) \subset D_{+}(f)$, then
\begin{enumerate}
\item $f$ is invertible in $S_g$, and
$f^{\deg(g)}/g^{\deg(f)}$ is invertible in $S_{(g)}$,
\item $g^e = af$ for some $e \geq 1$ and $a \in S$ homogeneous,
\item there is a canonical $S$-algebra map $S_f \to S_g$, 
\item there is a canonical $S_0$-algebra map $S_{(f)} \to S_{(g)}$
compatible with the map $S_f \to S_g$,
\item the map $S_{(f)} \to S_{(g)}$ induces an isomorphism
$$
(S_{(f)})_{g^{\deg(f)}/f^{\deg(g)}} \cong S_{(g)},
$$
\item these maps induce a commutative diagram of
topological spaces
$$
\xymatrix{
D_{+}(g) \ar[d] &
\{\mathbf{Z}\text{-graded primes of }S_g\} \ar[l] \ar[r] \ar[d] &
\text{Spec}(S_{(g)}) \ar[d] \\
D_{+}(f) &
\{\mathbf{Z}\text{-graded primes of }S_f\} \ar[l] \ar[r] &
\text{Spec}(S_{(f)})
}
$$
where the horizontal maps are homeomorphisms and the vertical maps
are open immersions,
\item there are a compatible canonical $S_f$ and $S_{(f)}$-module
maps $M_f \to M_g$ and $M_{(f)} \to M_{(g)}$ for any graded $S$-module $M$,
and
\item the map $M_{(f)} \to M_{(g)}$ induces an isomorphism
$$
(M_{(f)})_{g^{\deg(f)}/f^{\deg(g)}} \cong M_{(g)}.
$$
\end{enumerate}
\item Any open covering of $D_{+}(f)$ can be refined to a finite
open covering of the form $D_{+}(f) = \bigcup_{i = 1}^n D_{+}(g_i)$.
\item If $g_1, \ldots, g_n \in S$ are homogeneous of positive degree,
then $D_{+}(f) \subset \bigcup D_{+}(g_i)$
if and only if
$g_1^{\deg(f)}/f^{\deg(g_1)}, \ldots, g_n^{\deg(f)}/f^{\deg(g_n)}$
generate the unit ideal in $S_{(f)}$.
\end{enumerate}
\end{lemma}

\begin{proof}
Recall that $D_{+}(g) = \text{Spec}(S_{(g)})$, see
Algebra, Lemma \ref{algebra-lemma-topology-proj}.
Thus (a) holds because $f^{\deg(g)}/g^{\deg(f)}$
is an element of $S_{(g)}$ which is not
contained in any prime ideal, and hence invertible,
see Algebra, Lemma \ref{algebra-lemma-Zariski-topology}.
Write the inverse of $f$ in $S_g$ as $a/g^d$.
We may replace $a$ by its homogeneous part of degree $d\deg(g) - \deg(f)$.
This means $g^d - af$ is annihilated by a power of $g$, whence 
$g^e = af$ for some $a \in S$ homogeneous of degree $e\deg(g) - \deg(f)$.
This proves (b).
For (c), the map $S_f \to S_g$ exists by (a) from the universal property
of localization, or we can define it by mapping $b/f^n$
to $a^nb/g^{ne}$. This clearly induces a map of the subrings
$S_{(f)} \to S_{(g)}$ of degree zero elements as well.
We can similarly define $M_f \to M_g$ and $M_{(f)} \to M_{(g)}$ by mapping
$x/f^n$ to $a^nx/g^{ne}$. The statements writing $S_{(g)}$ resp.\ 
$M_{(g)}$ as principal localizations of $S_{(f)}$ resp.\ $M_{(f)}$
are clear from the formulas above. The maps in the commutative diagram
of topological spaces correspond to the ring maps given above. The
horizontal arrows are homeomorphisms by
Algebra, Lemma \ref{algebra-lemma-topology-proj}.
The vertical arrows are open immersions since the left
one is the inclusion of an open subset.

\medskip\noindent
The open $D_{+}(f)$ is quasi-compact because it is homeomorphic
to $\text{Spec}(S_{(f)})$, see  Algebra, Lemma \ref{algebra-lemma-qc-open}.
Hence the second statement follows directly
from the fact that the standard opens form
a basis for the topology.

\medskip\noindent
The third statement follows directly from
Algebra, Lemma \ref{algebra-lemma-Zariski-topology}.
\end{proof}

\noindent
In Sheaves, Section \ref{sheaves-section-bases} we defined
the notion of a sheaf on a basis, and we showed that it is
essentially equivalent to the notion of a sheaf on the space,
see Sheaves, Lemmas \ref{sheaves-lemma-extend-off-basis} and
\ref{sheaves-lemma-extend-off-basis-structures}. Moreover,
we showed in
Sheaves, Lemma \ref{sheaves-lemma-cofinal-systems-coverings-standard-case}
that it is sufficient to check the sheaf
condition on a cofinal system of open coverings for each
standard open. By the lemma above it suffices to check
on the finite coverings by standard opens.

\begin{definition}
\label{definition-standard-covering}
Let $S$ be a graded ring.
Suppose that $D_{+}(f) \subset \text{Proj}(S)$ is a standard
open. A {\it standard open covering} of $D_{+}(f)$
is a covering $D_{+}(f) = \bigcup_{i=1}^n D_{+}(g_i)$,
where $g_1,\ldots, g_n \in S$ are homogeneous of positive degree.
\end{definition}

\noindent
Let $S$ be a graded ring. Let $M$ be a graded $S$-module. We will define
a presheaf $\widetilde M$ on the basis of standard opens.
Suppose that $U \subset \text{Proj}(S)$ is a standard open.
If $f, g \in S$ are homogeneous of positive degree
such that $D_{+}(f) = D_{+}(g)$, then
by Lemma \ref{lemma-standard-open} above there are canonical
maps $M_{(f)} \to M_{(g)}$ and $M_{(g)} \to M_{(f)}$ which are
mutually inverse. Hence we may choose any $f$ such that $U = D_{+}(f)$
and define
$$
\widetilde M(U) = M_{(f)}.
$$
Note that if $D_{+}(g) \subset D_{+}(f)$, then by
Lemma \ref{lemma-standard-open} above we have
a canonical map
$$
\widetilde M(D_{+}(f)) = M_{(f)} \longrightarrow
M_{(g)} = \widetilde M(D_{+}(g)).
$$
Clearly, this defines a presheaf of abelian groups on the basis
of standard opens. If $M = S$, then $\widetilde S$ is a presheaf
of rings on the basis of standard opens. And for general $M$ we
see that $\widetilde M$ is a presheaf of $\widetilde S$-modules
on the basis of standard opens.

\medskip\noindent
Let us compute the stalk of $\widetilde M$ at a point
$x \in \text{Proj}(S)$.
Suppose that $x$ corresponds to the homogeneous prime
ideal $\mathfrak p \subset S$.
By definition of the stalk we see that
$$
\widetilde M_x
=
\text{colim}_{f\in S_d, d > 0, f\not\in \mathfrak p}\ M_{(f)}
$$
Here the set $\{f\in S_d, d > 0, f\not\in \mathfrak p\}$ is partially
ordered by the rule $f \geq f' \Leftrightarrow D_{+}(f) \subset D_{+}(f')$.
If $f_1, f_2 \in S \setminus \mathfrak p$ are homogeneous of positive
degree, then we have
$f_1f_2 \geq f_1$ in this ordering. In
Algebra, Section \ref{algebra-section-proj}
we defined $M_{(\mathfrak p)}$ as the ring whose elements are fractions
$x/f$ with $x, f$ homogeneous, $\deg(x) = \deg(f)$, $f \not \in \mathfrak p$.
Since $\mathfrak p \in \text{Proj}(S)$ there exists at least
one $f_0 \in S$ homogeneous of positive degree with $f_0 \not\in \mathfrak p$.
Hence $x/f = f_0x/ff_0$ and we see that we may always assume
the denominator of an element in $M_{(\mathfrak p)}$ has positive degree.
From these remarks it follows easily that
$$
\widetilde M_x = M_{(\mathfrak p)}.
$$

\medskip\noindent
Next, we check the sheaf condition for the standard open coverings.
If $D_{+}(f) = \bigcup_{i=1}^n D_{+}(g_i)$, then the sheaf condition
for this covering is equivalent with the exactness of the
sequence
$$
0 \to M_{(f)} \to \bigoplus M_{(g_i)} \to \bigoplus M_{(g_ig_j)}.
$$
Note that $D_{+}(g_i) = D_{+}(fg_i)$, and hence we can rewrite this
sequence as the sequence
$$
0 \to M_{(f)} \to \bigoplus M_{(fg_i)} \to \bigoplus M_{(fg_ig_j)}.
$$
By Lemma \ref{lemma-standard-open} we see that
$g_1^{\deg(f)}/f^{\deg(g_1)}, \ldots, g_n^{\deg(f)}/f^{\deg(g_n)}$
generate the unit ideal in $S_{(f)}$, and that the modules
$M_{(fg_i)}$, $M_{(fg_ig_j)}$ are the principal localizations
of the $S_{(f)}$-module $M_{(f)}$ at these elements and their products.
Thus we may apply Algebra, Lemma \ref{algebra-lemma-cover-module}
to the module $M_{(f)}$ over $S_{(f)}$ and the elements
$g_1^{\deg(f)}/f^{\deg(g_1)}, \ldots, g_n^{\deg(f)}/f^{\deg(g_n)}$.
We conclude that the sequence is exact. By the remarks
made above, we see that $\widetilde M$ is a sheaf
on the basis of standard opens.

\medskip\noindent
Thus we conclude from the material in
Sheaves, Section \ref{sheaves-section-bases}
that there exists a
unique sheaf of rings $\mathcal{O}_{\text{Proj}(S)}$
which agrees with $\widetilde S$ on the standard opens.
Note that by our computation of stalks above and
Algebra, Lemma \ref{algebra-lemma-proj-prime} the
stalks of this sheaf of rings are all local rings.

\medskip\noindent
Similarly, for any graded $S$-module $M$ there exists
a unique sheaf of $\mathcal{O}_{\text{Proj}(S)}$-modules
$\mathcal{F}$ which agrees with $\widetilde M$ on the
standard opens, see
Sheaves, Lemma \ref{sheaves-lemma-extend-off-basis-module}.

\begin{definition}
\label{definition-structure-sheaf}
Let $S$ be a ring.
\begin{enumerate}
\item The {\it structure sheaf $\mathcal{O}_{\text{Proj}(S)}$ of the
homogeneous spectrum of $S$} is the unique sheaf of rings
$\mathcal{O}_{\text{Proj}(S)}$
which agrees with $\widetilde S$ on the basis of standard opens.
\item The locally ringed space
$(\text{Proj}(S), \mathcal{O}_{\text{Proj}(S)})$ is called
the {\it homogeneous spectrum} of $S$ and denoted $\text{Proj}(S)$.
\item The sheaf of $\mathcal{O}_{\text{Proj}(S)}$-modules
extending $\widetilde M$ to all opens of $\text{Proj}(S)$
is called the sheaf of $\mathcal{O}_{\text{Proj}(S)}$-modules
associated to $M$. This sheaf is denoted $\widetilde M$ as
well.
\end{enumerate}
\end{definition}

\noindent
We summarize the results obtained so far.

\begin{lemma}
\label{lemma-proj-sheaves}
Let $S$ be a graded ring. Let $M$ be a graded $S$-module.
Let $\widetilde M$ be the sheaf of $\mathcal{O}_{\text{Proj}(S)}$-modules
associated to $M$.
\begin{enumerate}
\item For every $f \in S$ homogeneous of positive degree we have
$\Gamma(D_{+}(f), \mathcal{O}_{\text{Proj}(S)}) = S_{(f)}$.
\item For every $f\in S$ homogeneous of positive degree
we have $\Gamma(D_{+}(f), \widetilde M) = M_{(f)}$
as an $S_{(f)}$-module.
\item Whenever $D_{+}(g) \subset D_{+}(f)$ the restriction mappings
on $\mathcal{O}_{\text{Proj}(S)}$ and $\widetilde M$
are the maps
$S_{(f)} \to S_{(g)}$ and $M_{(f)} \to M_{(g)}$ from Lemma
\ref{lemma-standard-open}.
\item Let $\mathfrak p$ be a homogeneous prime of $S$ not containing
$S_{+}$, and let $x \in \text{Proj}(S)$
be the corresponding point. We have
$\mathcal{O}_{\text{Proj}(S), x} = S_{(\mathfrak p)}$.
\item Let $\mathfrak p$ be a homogeneous prime of $S$ not containing
$S_{+}$, and let $x \in \text{Proj}(S)$
be the corresponding point. We have $\mathcal{F}_x = M_{(\mathfrak p)}$
as an $S_{(\mathfrak p)}$-module.
\item
\label{map}
There is a canonical ring map
$
S_0 \longrightarrow \Gamma(\text{Proj}(S), \widetilde S)
$
and a canonical $S_0$-module map
$
M_0 \longrightarrow \Gamma(\text{Proj}(S), \widetilde M)
$
compatible with the descriptions of sections over standard opens
above and stalks above.
\end{enumerate}
Moreover, all these identifications are functorial in the $S$
module $M$. In particular, the functor $M \mapsto \widetilde M$
is an exact functor from the category of $S$-modules
to the category of $\mathcal{O}_{\text{Proj}(S)}$-modules.
\end{lemma}

\begin{proof}
Assertions (1) - (5) are clear from the discussion above.
We see (6) since there are canonical maps $M_0 \to M_{(f)}$,
$x \mapsto x/1$ compatible with the restriction maps
described in (3). The exactness of the functor $M \mapsto \widetilde M$
follows from the fact that the functor $M \mapsto M_{(\mathfrak p)}$
is exact (see Algebra, Lemma \ref{algebra-lemma-proj-prime})
and the fact that exactness of short exact sequences
may be checked on stalks, see
Modules, Lemma \ref{modules-lemma-abelian}.
\end{proof}

\begin{remark}
\label{remark-global-sections-not-isomorphism}
The map from $M_0$ to the global sections of $\widetilde M$
is generally far from being an isomorphism. A trivial
example is to take $S = k[x, y, z]$ with $1 = \deg(x) = \deg(y) = \deg(z)$
(or any number of variables) and to take $M = S/(x^{100}, y^{100}, z^{100})$.
It is easy to see that $\widetilde M = 0$, but $M_0 = k$.
\end{remark}

\begin{lemma}
\label{lemma-standard-open-proj}
Let $S$ be a graded ring. Let $f \in S$ be homogeneous of positive degree.
Suppose that $D(g) \subset \text{Spec}(S_{(f)})$ is a standard open.
Then there exists a $h \in S$ homogeneous of positive degree such that
$D(g)$ corresponds to $D_{+}(h) \subset D_{+}(f)$ via the homeomorphism
of Algebra, Lemma \ref{algebra-lemma-topology-proj}. In fact we can
take $h$ such that $g = h/f^n$ for some $n$.
\end{lemma}

\begin{proof}
Write $g = h/f^n$ for some $h$ homogeneous of positive degree
and some $n \geq 1$. If $D_{+}(h)$ is not contained in
$D_{+}(f)$ then we replace $h$ by $hf$ and $n$ by $n + 1$.
Then $h$ has the required shape and $D_{+}(h) \subset D_{+}(f)$
corresponds to $D(g) \subset \text{Spec}(S_{(f)})$.
\end{proof}

\begin{lemma}
\label{lemma-proj-scheme}
Let $S$ be a graded ring.
The locally ringed space $\text{Proj}(S)$ is a scheme.
The standard opens $D_{+}(f)$ are affine opens.
For any graded $S$-module $M$ the sheaf
$\widetilde M$ is a quasi-coherent sheaf of
$\mathcal{O}_{\text{Proj}(S)}$-modules.
\end{lemma}

\begin{proof}
Consider a standard open $D_{+}(f) \subset \text{Proj}(S)$.
We have $\Gamma(D_{+}(f), \mathcal{O}_{\text{Proj}(S)}) = S_{(f)}$
by Lemma \ref{lemma-proj-sheaves} above, and
we have a homeomorphism $\varphi : D_{+}(f) \to \text{Spec}(S_{(f)})$.
For any standard open $D(g) \subset \text{Spec}(S_{(f)})$ we may
pick a $h \in S_{+}$ as in Lemma \ref{lemma-standard-open-proj}.
Then $\varphi^{-1}(D(g)) = D_{+}(h)$, and by
Lemmas \ref{lemma-proj-sheaves} and \ref{lemma-standard-open} we see
$$
\Gamma(D_{+}(h), \mathcal{O}_{\text{Proj}(S)})
=
S_{(h)}
=
(S_{(f)})_{h^{\deg(f)}/f^{\deg(h)}}
=
(S_{(f)})_g
=
\Gamma(D(g), \mathcal{O}_{\text{Spec}(S_{(f)})}).
$$
Thus the restriction of $\mathcal{O}_{\text{Proj}(S)}$ to
$D_{+}(f)$ corresponds via the homeomorphism $\varphi$
exactly to the sheaf $\mathcal{O}_{\text{Spec}(S_{(f)})}$
as defined in Schemes, Section \ref{schemes-section-affine-schemes}.
We conclude that $D_{+}(f)$ is an affine scheme isomorphic to
$\text{Spec}(S_{(f)})$ via $\varphi$ and
hence that $\text{Proj}(S)$ is a scheme.

\medskip\noindent
In exactly the same way we show that $\widetilde M$ is a
quasi-coherent sheaf of $\mathcal{O}_{\text{Proj}(S)}$-modules.
Namely, the argument above will show that
$$
\widetilde M|_{D_{+}(f)} \cong \varphi^*\left(\widetilde{M_{(f)}}\right)
$$
which shows that $\widetilde M$ is quasi-coherent.
\end{proof}

\begin{lemma}
\label{lemma-proj-separated}
Let $S$ be a graded ring.
The scheme $\text{Proj}(S)$ is separated.
\end{lemma}

\begin{proof}
We have to show that the canonical morphism
$\text{Proj}(S) \to \text{Spec}(\mathbf{Z})$
is separated.
We will use Schemes, Lemma \ref{schemes-lemma-characterize-separated}.
Thus it suffices to show given any pair of standard opens
$D_{+}(f)$ and $D_{+}(g)$ that $D_{+}(f) \cap D_{+}(g) = D_{+}(fg)$
is affine (clear) and that the ring map
$$
S_{(f)} \otimes_{\mathbf{Z}} S_{(g)} \longrightarrow S_{(fg)}
$$
is surjective. Any element $s$ in $S_{(fg)}$ is of
the form $s = h/(f^ng^m)$ with $h \in S$ homogeneous of degree
$n\deg(f) + m\deg(g)$. We may multiply $h$ by a suitable
monomial $f^ig^j$ and assume that $n = n' \deg(g)$, and
$m = m' \deg(f)$. Then we can rewrite $s$ as
$s = h/f^{(n' + m')\deg(g)} \cdot f^{m'\deg(g)}/g^{m'\deg(f)}$.
So $s$ is indeed in the image of the displayed arrow.
\end{proof}

\begin{lemma}
\label{lemma-proj-quasi-compact}
Let $S$ be a graded ring.
The scheme $\text{Proj}(S)$ is quasi-compact if and only
if there exist finitely many homogeneous elements
$f_1, \ldots, f_n \in S_{+}$ such that
$S_{+} \subset \sqrt{(f_1, \ldots, f_n)}$.
\end{lemma}

\begin{proof}
Given such a collection of elements the standard affine opens
$D_{+}(f_i)$ cover $\text{Proj}(S)$ by
Algebra, Lemma \ref{algebra-lemma-topology-proj}.
Conversely, if $\text{Proj}(S)$ is quasi-compact, then we
may cover it by finitely many standard opens 
$D_{+}(f_i)$, $i = 1, \ldots, n$ and we see that
$S_{+} \subset \sqrt{(f_1, \ldots, f_n)}$ by the
lemma referenced above.
\end{proof}

\begin{lemma}
\label{lemma-structural-morphism-proj}
Let $S$ be a graded ring. The scheme $\text{Proj}(S)$ has a canonical morphism
towards the affine scheme $\text{Spec}(S_0)$, agreeing with the map on
topological spaces coming from
Algebra, Definition \ref{algebra-definition-proj}.
\end{lemma}

\begin{proof}
We saw above that our construction of $\widetilde S$, resp.\ 
$\widetilde M$ gives a sheaf of $S_0$-algebras, resp.\ $S_0$-modules.
Hence we get a morphism by
Schemes, Lemma \ref{schemes-lemma-morphism-into-affine}.
This morphism, when restricted to $D_{+}(f)$ comes from the
canonical ring map $S_0 \to S_{(f)}$. The maps
$S \to S_f$, $S_{(f)} \to S_f$ are $S_0$-algebra maps, see
Lemma \ref{lemma-standard-open}.
Hence if the homogeneous prime $\mathfrak p \subset S$
correspond to the $\mathbf{Z}$-graded prime $\mathfrak p \subset S_f$
and the (usual) prime $\mathfrak p'' \subset S_{(f)}$, then
each of these has the same inverse image in $S_0$.
\end{proof}

\begin{lemma}
\label{lemma-widetilde-tensor}
Let $S$ be a graded ring.
Let $(X, \mathcal{O}_X) = (\text{Proj}(S), \mathcal{O}_{\text{Proj}(S)})$
be the scheme of Lemma \ref{lemma-proj-scheme}.
Let $f \in S_{+}$ be homogeneous. Let $x \in X$ be a point
corresponding to the homogeneous prime $\mathfrak p \subset S$.
Let $M$, $N$ be graded $S$-modules.
There is a canonical map of $\mathcal{O}_{\text{Proj}(S)}$-modules
$$
\widetilde M \otimes_{\mathcal{O}_X} \widetilde N
\longrightarrow
\widetilde{M \otimes_R N}
$$
which induces the canonical map
$
M_{(f)} \otimes_{S_{(f)}} N_{(f)}
\to
(M \otimes_S N)_{(f)}
$
on sections over $D_{+}(f)$ and the canonical map
$
M_{(\mathfrak p)} \otimes_{S_{(\mathfrak p)}} N_{(\mathfrak p)}
\to
(M \otimes_S N)_{(\mathfrak p)}
$
on stalks at $x$. Moreover, the following diagram
$$
\xymatrix{
M_0 \otimes_{S_0} N_0 \ar[r] \ar[d] &
(M \otimes_S N)_0 \ar[d] \\
\Gamma(X, \widetilde M \otimes_{\mathcal{O}_X} \widetilde N) \ar[r] &
\Gamma(X, \widetilde{M \otimes_R N})
}
$$
is commutative.
\end{lemma}

\begin{proof}
To construct a morphism as displayed is the same as constructing
a $\mathcal{O}_X$-bilinear map
$$
\widetilde M \times \widetilde N
\longrightarrow
\widetilde{M \otimes_R N}
$$
see Modules, Section \ref{modules-section-tensor-product}.
It suffices to define this on sections over the opens $D_{+}(f)$
compatible with restriction mappings. On $D_{+}(f)$ we use the
$S_{(f)}$-bilinear map
$M_{(f)} \times N_{(f)} \to (M \otimes_S N)_{(f)}$,
$(x/f^n, y/f^m) \mapsto (x \otimes y)/f^{n + m}$. Details omitted.
\end{proof}

\begin{remark}
\label{remark-not-isomorphism}
In general the map constructed in Lemma \ref{lemma-widetilde-tensor}
above is not an isomorphism. Here is an example. Let $k$
be a field. Let $S = k[x, y, z]$ with $k$ in degree $0$ and
$\deg(x) = 1$, $\deg(y) = 2$, $\deg(z) = 3$.
Let $\mathfrak p = (x, y) \in \text{Proj}(S)$.
Let $M = S(1)$ and $N = S(2)$, see
Algebra, Section \ref{algebra-section-graded}
for notation. Then $M \otimes_S N = S(3)$.
Note that
\begin{eqnarray*}
S_z
& = &
k[x, y, z, 1/z] \\
S_{(z)}
& = &
k[x^3/z, xy/z, y^3/z^2]
\cong
k[u, v, w]/(uw - v^3) \\
M_{(z)} & = & S_{(z)} \cdot x + S_{(z)} \cdot y^2/z \subset S_z \\
N_{(z)} & = & S_{(z)} \cdot y + S_{(z)} \cdot x^2/z \subset S_z \\
S(3)_{(z)} & = & S_{(z)} \cdot z \subset S_z
\end{eqnarray*}
Consider the maximal ideal $\mathfrak m = (u, v, w) \subset S_{(z)}$.
It is not hard to see that both $M_{(z)}/\mathfrak mM_{(z)}$
and $N_{(z)}/\mathfrak mN_{(z)}$ have dimension $2$ over
$\kappa(\mathfrak m)$. But
$S(3)_{(z)}/\mathfrak mS(3)_{(z)}$ has dimension $1$.
Thus the map $M_{(z)}\otimes N_{(z)} \to S(3)_{(z)}$ is not
an isomorphism.
\end{remark}









\section{Invertible sheaves on Proj}
\label{section-invertible-on-proj}

\noindent
Recall from Algebra, Section \ref{algebra-section-graded}
the construction of the twisted module $M(n)$ associated
to a graded module over a graded ring.

\begin{definition}
\label{definition-twist}
Let $S$ be a graded ring. Let $X = \text{Proj}(S)$.
\begin{enumerate}
\item We define $\mathcal{O}_X(n) = \widetilde{S(n)}$.
This is called the
{\it $n$th twist of the structure sheaf of $\text{Proj}(S)$}.
\item For any sheaf of $\mathcal{O}_X$-modules $\mathcal{F}$ we set
$\mathcal{F}(n) = \mathcal{F} \otimes_{\mathcal{O}_X} \mathcal{O}_X(n)$.
\end{enumerate}
\end{definition}

\noindent
Since $S(n) \otimes_S S(m) = S(n + m)$ we see that there
are canonical maps
\begin{equation}
\label{equation-multiply}
\mathcal{O}_X(n) \otimes_{\mathcal{O}_X} \mathcal{O}_X(m)
\longrightarrow
\mathcal{O}_X(n + m).
\end{equation}
These maps are not isomorphisms in general, see the example in
Remark \ref{remark-not-isomorphism}. The same example shows
that $\mathcal{O}_X(n)$ is {\it not} an invertible sheaf on $X$ in
general. Slightly more generally, given any graded module
$M$ we get maps
\begin{equation}
\label{equation-multiply-more-generally}
\widetilde M(n)
=
\widetilde M
\otimes_{\mathcal{O}_X}
\mathcal{O}_X(n)
\longrightarrow
\widetilde{M(n)}.
\end{equation}

\begin{lemma}
\label{lemma-when-invertible}
Let $S$ be a graded ring.
Let $f \in S$ be homogeneous of degree $d > 0$.
Let $n \in \mathbf{Z}$.
Assume $d | n$.
The sheaves $\mathcal{O}_X(n)|_{D_{+}(f)}$ are invertible,
and in fact trivial
(see Modules, Definition \ref{modules-definition-invertible}).
With the same condition on $n$
the maps from Equations (\ref{equation-multiply}) and
(\ref{equation-multiply-more-generally}) are isomorphisms
when restricted to the open subscheme $D_{+}(f)$.
\end{lemma}

\begin{proof}
The (not graded) $S$-module maps
$S \to S(n)$, and $M \to M(n)$, given by
$x \mapsto f^{n/d}x$ become isomorphisms
after inverting $f$. The first shows that
$S_{(f)} \cong S(n)_{(f)}$ which gives an isomorphism
$\mathcal{O}_{D_{+}(f)} \cong \mathcal{O}_X(n)|_{D_{+}(f)}$.
The second shows that the map
$S(n)_{(f)} \otimes_{S_{(f)}} M_{(f)} \to M(n)_{(f)}$
is an isomorphism.
\end{proof}

\noindent
The following lemma states the properties that we will later use to
characterize schemes with an ample invertible sheaf.
Recall from Modules, Lemma \ref{modules-lemma-s-open}
that given an invertible sheaf $\mathcal{L}$ on a locally ringed
space $X$, and given a global section $s$ of $\mathcal{L}$
the set $X_s = \{x \in X \mid s \not \in \mathfrak m_x\mathcal{L}_x\}$
is open.

\begin{lemma}
\label{lemma-ample-on-proj}
Let $S$ be a graded ring.
Let $X \subset \text{Proj}(S)$ be a quasi-compact open subscheme.
Denote $\mathcal{O}_X(n)$ the restriction of
$\mathcal{O}_{\text{Proj}(S)}(n)$ to $X$.
There exists an integer $d$ such that
\begin{enumerate}
\item the sheaf $\mathcal{O}_X(dn)$ is invertible for all $n \in \mathbf{Z}$,
\item all the maps
$\mathcal{O}_X(nd) \otimes_{\mathcal{O}_X} \mathcal{O}_X(md)
\longrightarrow
\mathcal{O}_X((n + m)d)$
of Equation (\ref{equation-multiply}) are isomorphisms,
\item the map
$\psi_n : S_{nd} = S(nd)_0 \to \Gamma(X, \mathcal{O}_X(nd))$
from Lemma \ref{lemma-proj-sheaves} (\ref{map})
composed with restriction to $X$
maps $f \in S_{nd}$ to a global section
$s = \psi_n(f)$ such that $D_{+}(f) \cap X = X_s$, and
\item a basis for the topology of $X$ is given
by the sets $X_s$, where $s \in \Gamma(X, \mathcal{O}_X(nd))$,
$n \geq 1$.
\end{enumerate}
\end{lemma}

\begin{proof}
Since $X$ is quasi-compact there exist finitely many homogeneous
$f_i \in S_{+}$, $i = 1, \ldots, n$ such that the standard opens
$D_{+}(f_i)$ give an open covering of $X$. Let $d_i = \deg(f_i)$ and set
$d = d_1 \ldots d_n$.
By Lemma \ref{lemma-when-invertible} the first two assertions hold.
The restriction $\mathcal{O}_X(nd)|_{D_{+}(f_i)}$ is trivialized
using $\psi_n(f_i^{nd/d_i})$, see proof of Lemma \ref{lemma-when-invertible}.
Hence $s|_{D_{+}(f_i)} = \psi_n(f)|_{D_{+}(f_i)}$
corresponds to the element $f/f_i^{nd/d_i}$. Thus it is clear that
$X_s \cap D_{+}(f_i) = D_{+}(f) \cap D_{+}(f_i)$ for all $i$. This
proves (3). A basis for the topology is given by the standard opens
$D_{+}(f)$ which are contained in $X$.
Since $D_{+}(f) = D_{+}(f^d)$ assertion (4) follows from (3).
\end{proof}




\section{Morphisms into Proj}
\label{section-morphisms-proj}

\noindent
Let $S$ be a graded ring.
Let $X = \text{Proj}(S)$ be the homogeneous spectrum of $S$.
Let $d \geq 1$ be an integer.
Consider the open subscheme
$$
U_d = \bigcup\nolimits_{f  \in S_d} D_{+}(f)
\ \ \subset\ \ 
X = \text{Proj}(S)
$$
Note that $d | d' \Rightarrow U_d \subset U_{d'}$ and
$X = \bigcup_d U_d$. Neither $X$ nor $U_d$ need
be quasi-compact, see Algebra, Lemma \ref{algebra-lemma-topology-proj}.
Let us write $\mathcal{O}_{U_d}(n) = \mathcal{O}_X(n)|_{U_d}$.
By Lemma \ref{lemma-when-invertible}
we know that $\mathcal{O}_{U_d}(nd)$, $n \in \mathbf{Z}$
is an invertible $\mathcal{O}_{U_d}$-module and
that all the multiplication maps
$\mathcal{O}_{U_d}(nd) \otimes_{\mathcal{O}_{U_d}} \mathcal{O}_X(m)
\to \mathcal{O}_{U_d}(nd + m)$ of
(\ref{equation-multiply}) are isomorphisms. In particular we have
$
\mathcal{O}_{U_d}(nd) \cong \mathcal{O}_{U_d}(d)^{\otimes n}
$
The maps on global sections
$S_{nd} \to \Gamma(X, \mathcal{O}_X(nd))
\to \Gamma(U_d, \mathcal{O}_{U_d}(d)^{\otimes n})$ 
fit together to a homomorphism of graded rings
$$
\psi^d : S^{(d)} \longrightarrow \Gamma_*(U_d, \mathcal{O}_{U_d}(d))
$$
For the notation $S^{(d)}$, see Algebra, Section \ref{algebra-section-graded}.
For the notation $\Gamma_*$ see
Modules, Definition \ref{modules-definition-gamma-star}. 
Moreover, since $U_d$ is covered by the opens $D_{+}(f)$, $f \in S_d$
we see that $\mathcal{O}_{U_d}(d)$ is globally generated
by the sections
in the image of
$\psi^d_1 : S^{(d)}_1 = S_d \to \Gamma(U_d, \mathcal{O}_{U_d}(d))$ , see
Modules, Definition \ref{modules-definition-globally-generated}.

\medskip\noindent
Let $Y$ be a scheme, and let $\varphi : Y \to X$ be a morphism of schemes.
Assume the image $\varphi(Y)$ is contained in the open subscheme
$U_d$ of $X$.
By the discussion following  
Modules, Definition \ref{modules-definition-gamma-star}
we obtain a homomorphism of graded rings
$$
\Gamma_*(U_d, \mathcal{O}_{U_d}(d))
\longrightarrow
\Gamma_*(Y, \varphi^*\mathcal{O}_X(d)).
$$
The composition of this and $\psi^d$ gives a graded ring
homomorphism
$$
\psi_\varphi^d :
S^{(d)}
\longrightarrow
\Gamma_*(Y, \varphi^*\mathcal{O}_X(d))
$$
which has the property that the invertible sheaf
$\varphi^*\mathcal{O}_X(d)$ is globally generated
by the sections in the image of
$S^{(d)}_1 = S_d \to \Gamma(Y, \varphi^*\mathcal{O}_X(d))$.

\begin{lemma}
\label{lemma-converse-construction}
Let $S$ be a graded ring, and $X = \text{Proj}(S)$.
Let $d \geq 1$ and $U_d \subset X$ as above.
Let $Y$ be a scheme.
Let $\mathcal{L}$ be an invertible sheaf on $Y$.
Let $\psi : S^{(d)} \to \Gamma_*(Y, \mathcal{L})$ be
a graded ring homomorphism such that $\mathcal{L}$ is
generated by the sections in the image of
$\psi_1 : S_d \to \Gamma(Y, \mathcal{L})$.
Then there exists a morphism
$\varphi : Y \to X$ such that $\varphi(Y) \subset U_d$ and
an isomorphism $\alpha : \varphi^*\mathcal{O}_{U_d}(d) \to \mathcal{L}$
such that $\psi_\varphi^d$ agrees with $\psi$ via $\alpha$:
$$
\xymatrix{
\Gamma_*(Y, \mathcal{L}) &
\Gamma_*(Y, \varphi^*\mathcal{O}_{U_d}(d)) \ar[l]^-\alpha &
\Gamma_*(U_d, \mathcal{O}_{U_d}(d)) \ar[l]^-{\varphi^*} \\
S^{(d)} \ar[u]^\psi & &
S^{(d)} \ar[u]^{\psi^d} \ar[ul]^{\psi^d_\varphi} \ar[ll]_{\text{id}}
}
$$
commutes. Moreover, the pair $(\varphi, \alpha)$ is unique.
\end{lemma}

\begin{proof}
Pick $f \in S_d$. Denote $s = \psi(f) \in \Gamma(Y, \mathcal{L})$.
On the open set $Y_s$ where $s$ does not vanish multiplication
by $s$ induces an isomorphism $\mathcal{O}_{Y_s} \to \mathcal{L}|_{Y_s}$,
see Modules, Lemma \ref{modules-lemma-s-open}. We will denote
the inverse of this map $x \mapsto x/s$, and similarly for
powers of $\mathcal{L}$. Using this we
define a ring map $\psi_{(f)} : S_{(f)} \to \Gamma(Y_s, \mathcal{O})$
by mapping the fraction $a/f^n$ to $\psi(a)/s^n$. 
By Schemes, Lemma \ref{schemes-lemma-morphism-into-affine}
this corresponds to a morphism
$\varphi_f : Y_s \to \text{Spec}(S_{(f)}) = D_{+}(f)$.
We also introduce the isomorphism
$\alpha_f : \varphi_f^*\mathcal{O}_{D_{+}(f)}(d) \to \mathcal{L}|_{Y_s}$
which maps the pullback of the trivializing section
$f$ over $D_{+}(f)$ to the trivializing section $s$ over $Y_s$.
With this choice the commutativity of the diagram in the lemma
holds with $Y$ replace by $Y_s$, $\varphi$ replaced by $\varphi_f$,
and $\alpha$ replaced by $\alpha_f$; verification omitted.

\medskip\noindent
Suppose that $f' \in S_d$ is a second element, and denote
$s' = \psi(f') \in \Gamma(Y, \mathcal{L})$. Then
$Y_s \cap Y_{s'} = Y_{ss'}$ and similarly
$D_{+}(f) \cap D_{+}(f') = D_{+}(ff')$.
In Lemma \ref{lemma-ample-on-proj} we saw that
$D_{+}(f') \cap D_{+}(f)$ is the same as the set
of points of $D_{+}(f)$ where the section of
$\mathcal{O}_X(d)$ defined by $f'$ does not vanish.
Hence
$\varphi_f^{-1}(D_{+}(f') \cap D_{+}(f)) = Y_s \cap Y_{s'}
= \varphi_{f'}^{-1}(D_{+}(f') \cap D_{+}(f))$.
On $D_{+}(f) \cap D_{+}(f')$ the fraction $f/f'$ is an
invertible section of the structure sheaf with inverse
$f'/f$. Note that $\psi_{(f')}(f/f') = \psi(f)/s' = s/s'$
and $\psi_{(f)}(f'/f) = \psi(f')/s = s'/s$. We claim there
is a unique ring map
$S_{(ff')} \to \Gamma(Y_{ss'}, \mathcal{O})$ making the
following diagram commute
$$
\xymatrix{
\Gamma(Y_s, \mathcal{O}) \ar[r] &
\Gamma(Y_{ss'}, \mathcal{O}) &
\Gamma(Y_{s,'} \mathcal{O}) \ar[l]\\
S_{(f)} \ar[r] \ar[u]^{\psi_{(f)}} &
S_{(ff')} \ar[u] &
S_{(f')} \ar[l] \ar[u]^{\psi_{(f')}}
}
$$
It exists because we may use the rule
$x/(ff')^n \mapsto \psi(x)/(ss')^n$, which ``works'' by the formulas
above. Uniqueness follows as $\text{Proj}(S)$ is separated, see
Lemma \ref{lemma-proj-separated} and its proof. This shows that the
morphisms $\varphi_f$ and $\varphi_{f'}$ agree over $Y_s \cap Y_{s'}$.
The restrictions of $\alpha_f$ and $\alpha_{f'}$ agree over
$Y_s \cap Y_{s'}$ because the regular functions $s/s'$ and 
$\psi_{(f')}(f)$ agree. This proves that the morphisms $\psi_f$
glue to a global morphism from $Y$ into $U_d \subset X$, and
that the maps $\alpha_f$ glue to an isomorphism satsifying the
conditions of the lemma.

\medskip\noindent
We still have to show the pair $(\varphi, \alpha)$ is unique.
Suppose $(\varphi', \alpha')$ is a second such pair.
Let $f \in S_d$. By the commutativity of the diagrams in the lemma we have
that the inverse images of $D_{+}(f)$ under both $\varphi$ and $\varphi'$
are equal to $Y_{\psi(f)}$. Since the opens $D_{+}(f)$ are a basis
for the topology on $X$, and since $X$ is a sober topological
space (see Schemes, Lemma \ref{schemes-lemma-scheme-sober})
this means the maps $\varphi$ and $\varphi'$ are the same
on underlying topological spaces. Let us use $s = \psi(f)$ to
trivialize the invertible sheaf $\mathcal{L}$ over $Y_{\psi(f)}$.
By the commutativity of the diagrams we have that
$\alpha^{\otimes n}(\psi^d_{\varphi}(x)) = 
\psi(x) = (\alpha')^{\otimes n}(\psi^d_{\varphi'}(x))$
for all $x \in S_{nd}$. By construction of $\psi^d_{\varphi}$
and $\psi^d_{\varphi'}$ we have
$\psi^d_{\varphi}(x) = \varphi^\sharp(x/f^n) \psi^d_{\varphi}(f^n)$
over $Y_{\psi(f)}$,
and similarly for $\psi^d_{\varphi'}$. by the commutativity of
the diagrams of the lemma we deduce that
$\varphi^\sharp(x/f^n) = (\varphi')^\sharp(x/f^n)$.
This proves that $\varphi$ and $\varphi'$ induce the same morphism
from $Y_{\psi(f)}$ into the affine scheme $D_{+}(f) = \text{Spec}(S_{(f)})$.
Hence $\varphi$ and $\varphi'$ are the same as morphisms.
Finally, it remains to show that the commutativity of the
diagram of the lemma singles out, given $\varphi$, a unique
$\alpha$. We omit the verification.
\end{proof}

\noindent
We continue the discussion from above the lemma.
Let $Y$ be a scheme. We will consider triples
$(d, \mathcal{L}, \psi)$ where
\begin{enumerate}
\item $d \geq 1$ is an integer,
\item $\mathcal{L}$ is an invertible $\mathcal{O}_Y$-module, and
\item $\psi : S^{(d)} \to \Gamma_*(Y, \mathcal{L})$ is a graded
ring homomorphism such that $\mathcal{L}$ is generated by
the global sections $\psi(f)$, with $f \in S_d$.
\end{enumerate}
Given a morphism $h : Y' \to Y$ and a triple
$(d, \mathcal{L}, \psi)$ over $Y$ we can pull it back to the
triple $(d, h^*\mathcal{L}, h^* \circ \psi)$.
Given two triples $(d, \mathcal{L}, \psi)$ and
$(d, \mathcal{L}', \psi')$ with the same integer $d$
we say they are {\it strictly equivalent} if there exists
an isomorphism $\beta : \mathcal{L} \to \mathcal{L}'$
such that $\beta \circ \psi = \psi'$ as graded
ring maps $S^{(d)} \to \Gamma_*(Y, \mathcal{L}')$.

\medskip\noindent
For each integer $d \geq 1$ we define
\begin{eqnarray*}
F_d : \textit{Sch}^{opp} & \longrightarrow & \textit{Sets},\\
Y & \longmapsto &
\{\text{strict equivalence classes of triples }
(d, \mathcal{L}, \psi)
\text{ as above}\}
\end{eqnarray*}
with pullbacks as defined above.

\begin{lemma}
\label{lemma-proj-functor-strict}
Let $S$ be a graded ring.
Let $X = \text{Proj}(S)$.
The triple $(d, \mathcal{O}_{U_d}(d), \psi^d)$
represents the functor $F_d$.
\end{lemma}

\begin{proof}
This is a reformulation of Lemma \ref{lemma-converse-construction}
\end{proof}

\begin{lemma}
\label{lemma-apply}
Let $S$ be a graded ring generated as an $S_0$-algebra by
the elements of $S_1$. In this case the scheme $X = \text{Proj}(S)$
represents the functor which associates to a scheme
$Y$ the set of pairs $(\mathcal{L}, \psi)$, where
\begin{enumerate}
\item $\mathcal{L}$ is an invertible $\mathcal{O}_Y$-module, and
\item $\psi : S \to \Gamma_*(Y, \mathcal{L})$ is a graded
ring homomorphism such that $\mathcal{L}$ is generated by
the global sections $\psi(f)$, with $f \in S_1$
\end{enumerate}
up to strict equivalence as above.
\end{lemma}

\begin{proof}
Under the assumptions of the lemma we have $X = U_1$ and the
lemma is a reformulation of Lemma \ref{lemma-proj-functor-strict} above.
\end{proof}

\begin{lemma}
\label{lemma-projective-space}
Let $S = \mathbf{Z}[X_0, \ldots, X_n]$ with $\deg(X_i) = 1$.
The scheme $\mathbf{P}^n_{\mathbf{Z}} = \text{Proj}(S)$ represents
the functor which associates to a scheme $Y$ the pairs
$(\mathcal{L}, (s_0, \ldots, s_n))$ where
\begin{enumerate}
\item $\mathcal{L}$ is an invertible $\mathcal{O}_Y$-module, and
\item $s_0, \ldots, s_n$ are global sections of $\mathcal{L}$
which generate $\mathcal{L}$
\end{enumerate}
up to the following equivalence:
$(\mathcal{L}, (s_0, \ldots, s_n)) \sim
(\mathcal{N}, (t_0, \ldots, t_n))$ $\Leftrightarrow$ there exists
an isomorphism $\beta : \mathcal{L} \to \mathcal{N}$
with $\beta(s_i) = t_i$ for $i = 0, \ldots, n$.
\end{lemma}

\begin{proof}
This is a special case of Lemma \ref{lemma-apply} above.
Namely, for any graded ring $A$ we have
\begin{eqnarray*}
\text{Mor}_{graded rings}(\mathbf{Z}[X_0, \ldots, X_n], A)
& = &
A_1 \times \ldots \times A_1 \\
\psi & \mapsto & (\psi(X_0), \ldots, \psi(X_n))
\end{eqnarray*}
and the degree $1$ part of $\Gamma_*(Y, \mathcal{L})$ is
just $\Gamma(Y, \mathcal{L})$.
\end{proof}

\begin{definition}
\label{definition-projective-space}
The scheme
$\mathbf{P}^n_{\mathbf{Z}} = \text{Proj}(\mathbf{Z}[X_0, \ldots, X_n])$
is called {\it projective $n$-space over $\mathbf{Z}$}.
Its base change $\mathbf{P}^n_S$ to a scheme $S$ is called
{\it projective $n$-space over $S$}. Given a scheme $Y$ over $S$
and a pair $(\mathcal{L}, (s_0, \ldots, s_n))$ as in
Lemma \ref{lemma-projective-space}
the induced morphism to $\mathbf{P}^n_S$ is denoted
$$
\varphi_{(\mathcal{L}, (s_0, \ldots, s_n))} :
Y \longrightarrow \mathbf{P}^n_S
$$
\end{definition}

\noindent
This makes sense since the pair defines a morphism into
$\mathbf{P}^n_{\mathbf{Z}}$ and we already have the structural
morphism into $S$ so combined we get a morphism into $\mathbf{P}^n_S$.

\medskip\noindent
We end this section with a discussion of a functor corresponding
to $\text{Proj}(S)$ for a general graded ring $S$.
We advise the reader to skip the
rest of this section. We will say two triples $(d, \mathcal{L}, \psi)$ and
$(d', \mathcal{L}', \psi')$ with possibly different integers
$d$, $d'$ are {\it equivalent} if there exists
an isomorphism
$\beta : \mathcal{L}^{\otimes d'} \to (\mathcal{L}')^{\otimes d}$
such that $\beta \circ \psi|_{S^{(dd')}}$ and $\psi'|_{S^{(dd')}}$ agree
as graded ring maps $S^{(dd')} \to \Gamma_*(Y, (\mathcal{L}')^{\otimes d})$.
We omit the verification that this defines an equivalence relation
on triples.

\medskip\noindent
Over the scheme $U_d$ (see above) we have the triple
$(d, \mathcal{O}_{U_d}(d), \psi^d)$. Clearly, if $d | d'$ the triples
$(d, \mathcal{O}_{U_d}(d), \psi^d)$ and
$(d', \mathcal{O}_{U_{d'}}(d'), \psi^{d'})$ are equivalent
when restricted to the open $U_{d'}$ (which is a subset of $U_d$).
This, combined with Lemma \ref{lemma-converse-construction} shows
that morphisms into $X = \text{Proj}(S)$ correspond
with equivalence classes of triples. This is not quite
true since if $Y$ is not quasi-compact, then there may not be
a single triple which works. Thus we have to be slightly
careful in defining the corresponding functor.

\medskip\noindent
On possible way to do this is to consider
open coverings $\mathcal{V} : Y = \bigcup_{d \geq 1} V_d$,
for each $d$ a triple $(d, \mathcal{L}_d, \psi^d)$ over $V_d$
such that for any pair of positive integers $(d, d')$ the
triples $(d, \mathcal{L}_d, \psi^d)$ and
$(d', \mathcal{L}_{d'}, \psi^{d'})$ are equivalent when
restricted to $V_d \cap V_{d'}$. In addition we
say that two sets of data
$(\mathcal{V} : Y = \bigcup_{d \geq 1} V_d,
(d, \mathcal{L}_d, \psi^d)_{d \geq 1})$ and
$(\mathcal{V}' : Y = \bigcup_{d \geq 1} V'_d,
(d, \mathcal{L}'_d, (\psi')^d)_{d \geq 1})$
are equivalent if for any pair of positive integers
$(d, d')$ the triples
$(d, \mathcal{L}_d, \psi^d)_{d \geq 1})$
and $(d, \mathcal{L}'_{d'}, (\psi')^{d'})_{d' \geq 1})$
are equivalent over $V_d \cap V'_{d'}$.
We define
\begin{eqnarray*}
F : \textit{Sch}^{opp} & \longrightarrow & \textit{Sets},\\
Y & \longmapsto &
\{\text{equivalence classes of }
(\mathcal{V} : Y = \bigcup_{d \geq 1} V_d,
(d, \mathcal{L}_d, \psi^d)_{d \geq 1})\}
\end{eqnarray*}

\begin{lemma}
\label{lemma-proj-functor}
Let $S$ be a graded ring.
Let $X = \text{Proj}(S)$.
The functor $F$ is representable by the scheme $X$.
\end{lemma}

\begin{proof}
This is true by construction.
\end{proof}






\section{Relative Proj}
\label{section-relative-proj}

\noindent
Let $S$ be a scheme.
Let $\mathcal{A} = \bigoplus_{d \geq 0} \mathcal{A}_d$
be a quasi-coherent graded $\mathcal{O}_S$-algebra.
In this section we relativize the construction of
$\text{Proj}$ of the previous section.
Namely we will construct a morphism of schemes
$$
\underline{\text{Proj}}_S(\mathcal{A}) \longrightarrow S
$$
which above affine opens of $S$ will look like the homogeneous spectrum 
of a graded ring. The discussion will be modeled after our
discussion of the relative spectrum in Section \ref{section-spec}.
It is probably easier for the reader to prove the existence
of such a scheme directly by glueing schemes of the form
$\text{Proj}(A)$, $A = \Gamma(U, \mathcal{A})$, $U \subset S$
affine open, than to read the material in this section.

\medskip\noindent
Fix for the moment an integer $d \geq 1$.
We denote $\mathcal{A}^{(d)} = \bigoplus_{n \geq 0} \mathcal{A}_{nd}$
similarly to the notation in Algebra, Section \ref{algebra-section-graded}.
Let $T$ be a scheme.
Let us consider quadruples $(d, f : T \to S, \mathcal{L}, \psi)$ where
\begin{enumerate}
\item $d$ is the integer we fixed above,
\item $f : T \to S$ is a morphism of schemes,
\item $\mathcal{L}$ is an invertible $\mathcal{O}_T$-module, and
\item
$\psi : f^*\mathcal{A}^{(d)} \to \bigoplus_{n \geq 0}\mathcal{L}^{\otimes n}$
is a homomorphism of graded $\mathcal{O}_T$-algebras
such that $f^*\mathcal{A}_d \to \mathcal{L}$ is surjective.
\end{enumerate}
Equivalently $\psi$ is a homomorphism of graded $\mathcal{O}_S$-algebras
$\mathcal{A}^{(d)} \to \bigoplus_{n \geq 0} f_*(\mathcal{L}^{\otimes n})$.
Given a morphism $h : Y' \to Y$ and a quadruple
$(d, f, \mathcal{L}, \psi)$ over $Y$ we can pull it back to the
triple $(d, f \circ h, h^*\mathcal{L}, h^* \circ \psi)$.
Given two quadruples $(d, f, \mathcal{L}, \psi)$ and
$(d, f', \mathcal{L}', \psi')$ over $Y$ with the same integer $d$
we say they are {\it strictly equivalent} if $f = f'$ and there exists
an isomorphism $\beta : \mathcal{L} \to \mathcal{L}'$
such that $\beta \circ \psi = \psi'$ as graded $\mathcal{O}_T$-algebra maps
$f^*\mathcal{A}^{(d)} \to \bigoplus_{n \geq 0} (\mathcal{L}')^{\otimes n}$.

\medskip\noindent
For each integer $d \geq 1$ we define
\begin{eqnarray*}
F_d : \textit{Sch}^{opp} & \longrightarrow & \textit{Sets},\\
T & \longmapsto &
\{\text{strict equivalence classes of }
(d, f : T \to S, \mathcal{L}, \psi)
\text{ as above}\}
\end{eqnarray*}
with pullbacks as defined above.

\begin{lemma}
\label{lemma-proj-base-change}
Let $S$ be a scheme. Let $\mathcal{A}$ be a quasi-coherent
sheaf of graded $\mathcal{O}_S$-algebras. Let $d \geq 1$.
Let $F_d$ be the functor
associated to $(S, \mathcal{A})$ above.
Let $g : S' \to S$ be a morphism of schemes.
Set $\mathcal{A}' = g^*\mathcal{A}$. Let $F_d'$ be the
functor associated to $(S', \mathcal{A}')$ above.
Then there is a canonical isomorphism
$$
F'_d \cong h_{S'} \times_{h_S} F_d
$$
of functors.
\end{lemma}

\begin{proof}
A quadruple
$(d, f' : T \to S', \mathcal{L}',
\psi' : (f')^*(\mathcal{A}')^{(d)} \to
\bigoplus_{n \geq 0} (\mathcal{L}')^{\otimes n})$
is the same as a quadruple
$(d, f, \mathcal{L},
\psi : f^*\mathcal{A}^{(d)} \to
\bigoplus_{n \geq 0} \mathcal{L}^{\otimes n})$
together with a factorization of $f$ as $f = g \circ f'$. Namely,
the correspondence is $f = g \circ f'$, $\mathcal{L} = \mathcal{L}'$
and $\psi = \psi'$ via the identifications
$(f')^*(\mathcal{A}')^{(d)} = (f')^*g^*(\mathcal{A}^{(d)}) =
f^*\mathcal{A}^{(d)}$. Hence the lemma.
\end{proof}

\begin{lemma}
\label{lemma-relative-proj-affine}
Let $S$ be a scheme. Let $\mathcal{A}$ be a quasi-coherent
sheaf of graded $\mathcal{O}_S$-algebras. Let $F_d$ be the functor
associated to $(d, S, \mathcal{A})$ above.
If $S$ is affine, then $F_d$ is representable by the open subscheme
$U_d$ (see Section \ref{section-morphisms-proj})
of the scheme $\text{Proj}(\Gamma(S, \mathcal{A}))$.
\end{lemma}

\begin{proof}
Write $S = \text{Spec}(R)$ and $A = \Gamma(S, \mathcal{A})$.
Then $A$ is a graded $R$-algebra and $\mathcal{A} = \widetilde A$.
To prove the lemma we have to identify the functor $F_d$
with the functor $F_d^{prev}$ from the previous section.

\medskip\noindent
Let $(d, f : T \to S, \mathcal{L}, \psi)$ be a quadruple.
We may think of $\psi$ as a $\mathcal{O}_S$-module map
$\mathcal{A}^{(d)} \to \bigoplus_{n \geq 0} f_*\mathcal{L}^{\otimes n}$.
Since $\mathcal{A}^{(d)}$ is quasi-coherent this is the same
thing as an $R$-linear homomorphism of graded rings
$A^{(d)} \to \Gamma(S, \bigoplus_{n \geq 0} f_*\mathcal{L}^{\otimes n})$.
Clearly, $\Gamma(S, \bigoplus_{n \geq 0} f_*\mathcal{L}^{\otimes n}) = 
\Gamma_*(T, \mathcal{L})$. Thus we may associate to
the quadruple the triple $(d, \mathcal{L}, \psi)$.

\medskip\noindent
Conversely, let $(d, \mathcal{L}, \psi)$ be a triple.
The composition $R \to A_0 \to \Gamma(T, \mathcal{O}_T)$
determines a morphism $f : T \to S = \text{Spec}(R)$, see
Schemes, Lemma \ref{schemes-lemma-morphism-into-affine}.
With this choice of $f$ the map
$A^{(d)} \to \Gamma(S, \bigoplus_{n \geq 0} f_*\mathcal{L}^{\otimes n})$
is $R$-linear, and hence corresponds to a $\psi$ which we
can use for a quadruple $(d, f : T \to S, \mathcal{L}, \psi)$.
We omit the verification that this establishes an isomorphism
of functors $F_d = F_d^{prev}$.
\end{proof}

\begin{lemma}
\label{lemma-relative-proj-d}
The functor $F_d$ is representable by a scheme.
\end{lemma}

\begin{proof}
We are going to use Schemes, Lemma \ref{schemes-lemma-glue-functors}.

\medskip\noindent
First we check that $F_d$ satisfies the sheaf property for the
Zariski topology. Namely, suppose that $T$ is a scheme,
that $T = \bigcup_{i \in I} U_i$ is an open covering,
and that $(d, f_i, \mathcal{L}_i, \psi_i) \in F_d(U_i)$ such that
$(d, f_i, \mathcal{L}_i, \psi_i)|_{U_i \cap U_j}$ and
$(d, f_j, \mathcal{L}_j, \psi_j)|_{U_i \cap U_j}$ are strictly
equivalent. This implies that the morphisms $f_i : U_i \to S$
glue to a morphism of schemes $f : T \to S$ such that
$f|_{I_i} = f_i$, see Schemes, Section \ref{schemes-section-glueing-schemes}.
Thus $f_i^*\mathcal{A}^{(d)} = f^*\mathcal{A}^{(d)}|_{U_i}$.
It also implies there exist isomorphisms
$\beta_{ij} : \mathcal{L}_i|_{U_i \cap U_j} \to \mathcal{L}_j|_{U_i \cap U_j}$
such that $\beta_{ij} \circ \psi_i = \psi_j$ on $U_i \cap U_j$.
Note that the isomorphisms $\beta_{ij}$ are uniquely determined
by this requirement because the maps $f_i^*\mathcal{A}_d \to \mathcal{L}_i$
are surjective. In particular we see that
$\beta_{jk} \circ \beta_{ij} = \beta_{ik}$ on $U_i \cap U_j \cap U_k$.
Hence by Sheaves,
Section \ref{sheaves-section-glueing-sheaves} the invertible sheaves
$\mathcal{L}_i$ glue to an invertible $\mathcal{O}_T$-module
$\mathcal{L}$ and the morphisms $\psi_i$ glue to
morphism of $\mathcal{O}_T$-algebras
$\psi : f^*\mathcal{A}^{(d)} \to \bigoplus_{n \geq 0} \mathcal{L}^{\otimes n}$.
This proves that $F_d$ satisfies the sheaf condition with respect to
the Zariski topology.

\medskip\noindent
Let $S = \bigcup_{i \in I} U_i$ be an affine open covering.
Let $F_{d, i} \subset F_d$ be the subfunctor consisting of
those pairs $(f : T \to S, \varphi)$ such that
$f(T) \subset U_i$.

\medskip\noindent
We have to show each $F_{d, i}$ is representable.
This is the case because $F_{d, i}$ is identified with
the functor associated to $U_i$ equipped with
the quasi-coherent graded $\mathcal{O}_{U_i}$-algebra
$\mathcal{A}|_{U_i})$ by Lemma \ref{lemma-proj-base-change}.
Thus the result follows from Lemma \ref{lemma-relative-proj-affine}.

\medskip\noindent
Next we show that $F_{d, i} \subset F_d$ is representable by open immersions.
Let $(f : T \to S, \varphi) \in F_d(T)$. Consider $V_i = f^{-1}(U_i)$.
It follows from the definition of $F_{d, i}$ that given $a : T' \to T$
we gave $a^*(f, \varphi) \in F_{d, i}(T')$ if and only if $a(T') \subset V_i$.
This is what we were required to show.

\medskip\noindent
Finally, we have to show that the collection $(F_{d, i})_{i \in I}$
covers $F_d$. Let $(f : T \to S, \varphi) \in F_d(T)$.
Consider $V_i = f^{-1}(U_i)$. Since $S = \bigcup_{i \in I} U_i$
is an open covering of $S$ we see that $T = \bigcup_{i \in I} V_i$
is an open covering of $T$. Moreover $(f, \varphi)|_{V_i} \in F_{d, i}(V_i)$.
This finishes the proof of the lemma.
\end{proof}

\noindent
At this point we could imitate the material at the end of
Section \ref{section-morphisms-proj} and define a functor
which is representable by the desired scheme
$\underline{\text{Proj}}_S(\mathcal{A})$. Instead we glue the
schemes representing the functors $F_d$ directly (with the same
effect of course). To do this we briefly introduce the
notion of equivalence between two 
quadruples $(d, f : T \to S, \mathcal{L}, \psi)$ and
$(d', f' : T \to S, \mathcal{L}', \psi')$ with possibly different
values of the integers $d, d'$. Namely, we say these
are {\it equivalent} if $f = f'$, and there exists an
isomorphism $\beta : \mathcal{L}^{\otimes d'} \to (\mathcal{L}')^{\otimes d}$
such that
$\beta \circ \psi|_{f^*\mathcal{A}^{(dd')}} = \psi'|_{f^*\mathcal{A}^{(dd')}}$.

\medskip\noindent
Before we state the main existence result we briefly discuss how
to deal with graded modules in this setting.

\medskip\noindent
Let $S$ be a scheme.
Let $\mathcal{A}$ be a quasi-coherent graded $\mathcal{O}_S$-module.
Let $\mathcal{M} = \bigoplus_{n \in \mathbf{Z}} \mathcal{M}_n$
be a graded $\mathcal{A}$-module, quasi-coherent as an $\mathcal{O}_S$-module.
Given a quadruple $(d, f : T \to S, \mathcal{L}, \psi)$
as above we define a quasi-coherent sheaf
$\widetilde{\mathcal{M}}$ of $\mathcal{O}_T$-modules
as follows
\begin{equation}
\label{equation-widetilde-M}
\widetilde{\mathcal{M}} =
\left(
f^*\mathcal{M}^{(d)}
\otimes_{\mathcal{A}^{(d)}}
\left(\bigoplus\nolimits_{n \in \mathbf{Z}} \mathcal{L}^{\otimes n}\right)
\right)_0
\end{equation}
In words: $\widetilde{\mathcal{M}}$ is the degree $0$ part
of the tensor product of the graded $f^*\mathcal{A}^{(d)}$-modules
$\mathcal{M}^{(d)}$ and
$\bigoplus\nolimits_{n \in \mathbf{Z}} \mathcal{L}^{\otimes n}$.
Since all sheaves are quasi-coherent we can spell out what this
means over an affine open $\text{Spec}(B) = V \subset T$.
Namely, suppose that $f^*\mathcal{M}|_V$ corresponds to the
graded $B$-module $M$, that $\mathcal{L}|_V$ corresponds to the
invertible $B$-module $L$, and that $f^*\mathcal{A}|_V$ corresponds
to the graded $B$-algebra $A$. Then $\widetilde{\mathcal{M}}|_V$
is the quasi-coherent sheaf associated to the $B$-module
$$
\widetilde M = 
(M^{(d)} \otimes_{A^{(d)}} \bigoplus L^{\otimes n})_0
$$
By assumption we may even cover $T$ by affine opens
$V$ such that there exists some $a \in A_d$ such that
$\psi(a) \in L$ is a $B$-basis for the module $L$.
In that case any element of $\widetilde M$ is a sum
of pure tensors $\sum m_i \otimes \psi(a)^{-n_i}$ with $m \in M_{n_id}$.
In fact we may multiply each $m_i$ with a suitable positive power
of $a$ and collect terms to see that each element of $\widetilde M$
can be written as $m \otimes \psi(a)^{-n}$ with $m \in M_{nd}$ and
$n \gg 0$. In other words we see that in this case
$$
\widetilde M = M_{(a)}\otimes_{A_{(a)}} B
$$
where the map $A_{(a)} \to B$ is the map $x/a^n \mapsto \psi(x)/\psi(a)^n$.

\begin{lemma}
\label{lemma-quasi-coherent-sheaf-proj}
Let $S$ be a scheme.
Let $\mathcal{A}$ be a quasi-coherent graded $\mathcal{O}_S$-module.
Let $\mathcal{M} = \bigoplus_{n \in \mathbf{Z}} \mathcal{M}_n$
be a graded $\mathcal{A}$-module, quasi-coherent as an $\mathcal{O}_S$-module.
Let $\pi_d : U_d \to S$ be the scheme representing the functor $F_d$.
Let
$(d, \pi_d : U_d \to S, \mathcal{L}_d,
\psi^d : \pi_d^*\mathcal{A}^{(d)} \to
\bigoplus_{n \geq 0} \mathcal{L}_d^{\otimes n}$ be the universal object.
Formation of the quasi-coherent sheaf $\widetilde{\mathcal{M}}$ on $U_d$
commutes with any base change $S' \to S$.
Furthermore, if $S$ is affine, then $\widetilde{\mathcal{M}}$ agrees
with $\widetilde{\Gamma(S, \mathcal{M})}$ restricted to the
open $U_d \subset \text{Proj}(\Gamma(S, \mathcal{A}))$.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-relative-proj}
Let $S$ be a scheme.
Let $\mathcal{A}$ be a quasi-coherent sheaf of graded
$\mathcal{O}_S$-algebras. There exist
\begin{enumerate}
\item a scheme
$$
\pi :
\underline{\text{Proj}}(\mathcal{A}) =
\underline{\text{Proj}}_S(\mathcal{A})
\longrightarrow
S
$$
over $S$,
\item a quasi-coherent $\mathbf{Z}$-graded sheaf
of $\mathcal{O}_{\underline{\text{Proj}}(\mathcal{A})}$-algebras
$\bigoplus_n \mathcal{O}_{\underline{\text{Proj}}(\mathcal{A})}(n)$, and
\item a morphism of graded $\mathcal{O}_S$-algebras
$$
\mathcal{A} \longrightarrow 
\pi_*\left(\bigoplus\nolimits_{n \geq 0}
\mathcal{O}_{\underline{\text{Proj}}(\mathcal{A})}(n)\right)
$$
\end{enumerate}
with the following properties:
\begin{enumerate}
\item For every affine open $\text{Spec}(R) = U \subset S$,
letting $A = \Gamma(U, \mathcal{A})$, 
there exist an isomorphism
$\varphi : \text{Proj}(A) \to \pi^{-1}(U)$,
and isomorphisms
$\varphi^*\mathcal{O}_{\underline{\text{Proj}}(\mathcal{A})}(n) \to
\mathcal{O}_{\text{Proj}(A)}(n)$ 
such that the multiplication in (2) above corresponds to
Equation (\ref{equation-multiply}) and the map (3) corresponds
to Lemma \ref{lemma-proj-sheaves} part (\ref{map}).
\item If $T$ is a quasi-compact scheme then the set of morphisms
from $T$ into $\underline{\text{Proj}}(\mathcal{A})$ correspond
to equivalence classes of quadruples
$(d, f : T \to S, \mathcal{L}, \psi :
f^*\mathcal{A}^{(d)} \to \bigoplus_{n \geq 0}\mathcal{L}^{\otimes n})$
as above.
\item For any quasi-coherent sheaf of graded $\mathcal{A}$-modules
$\mathcal{M}$ on $S$, there exists a canonical associated sheaf
of $\mathcal{O}_{\underline{\text{Proj}}(\mathcal{A})}$-modules.
This sheaf $\widetilde{\mathcal{M}}$ agrees on affine opens, as in (1)
above, with the usual construction $\widetilde{M}$,
$M = \Gamma(U, \mathcal{M})$ on $\text{Proj}(A)$. For $T$ quasi-compact
as in (2) above, the pullback of $\widetilde{\mathcal{M}}$ to
$T$ via a morphism $T \to \underline{\text{Proj}}(\mathcal{A})$
agrees with the construction of $\widetilde{\mathcal{M}}$ on $T$
in Equation (\ref{equation-widetilde-M}).
\end{enumerate}
\end{lemma}

\begin{proof}
Let $\pi_d : U_d \to S$
be the scheme representing the functor $F_d$ defined above.
Let $\mathcal{L}_d$,
$\psi^d : \pi_d^*\mathcal{A}^{(d)} \to
\bigoplus_{n \geq 0} \mathcal{L}_d^{\otimes n}$ be the universal object.
If $d | d'$, then we may consider the quadruple
$(d', \pi_d, \mathcal{L}_d^{\otimes d'/d}, \psi^d|_{\mathcal{A}^{(d')}})$
which determines a canonical morphism $U_d \to U_{d'}$ over $S$.

\medskip\noindent
For every affine open $\text{Spec}(R) = U \subset S$
setting $A = \Gamma(U, \mathcal{A})$
we have a canonical
identification of $\pi_d^{-1}(U)$ with the corresponding open
subscheme of $\text{Proj}(A)$, see
Lemma \ref{lemma-relative-proj-affine}.
Moreover, the morphisms $U_d \to U_{d'}$ constructed above
correspond to the inclusions of opens in $\text{Proj}(A)$.
Thus we conclude that $U_d \to U_{d'}$ is an open immersion.

\medskip\noindent
This allows us to construct $\underline{\text{Proj}}(\mathcal{A})$
by glueing the schemes $U_d$ along the open immersions $U_d \to U_{d'}$.
Technically, it is convenient to choose a sequence
$d_1 | d_2 | d_3 | \ldots$ such that every positive integer 
divides one of the $d_i$ and to glue the schemes $U_{d_i}$
along the open immersions constructed above. The resulting
scheme $\underline{\text{Proj}}(\mathcal{A}) \to S$ is identified
over each affine open of $S$ with the homogeneous spectrum
of the sections of $\mathcal{A}$ over that open, since this was
true for the opens $U_d$. Also, property (2) of the statement
of the lemma holds, by construction.

\medskip\noindent
Apply the construction of Equation (\ref{equation-widetilde-M}) to
the quadruples $(d, \pi_d, \mathcal{L}_d, \psi^d)$
and the graded $\mathcal{A}$-modules $\mathcal{A}(n)$.
This gives rise to quasi-coherent $\mathcal{O}_{U_d}$-modules
which we denote $\mathcal{O}_{U_d}(n)$.
If $d | d'$ then the pullback of $\mathcal{O}_{U_{d'}}(n)$
via $U_d \to U_{d'}$ is identified with
$\mathcal{O}_{U_d}(n)$ compatibly with what happens over
an affine open of $S$ as in Lemma \ref{lemma-quasi-coherent-sheaf-proj}
(verification omitted). Hence we obtain quasi-coherent sheaves
of $\mathcal{O}_{\underline{\text{Proj}}(\mathcal{A})}$-modules
$\mathcal{O}_{\underline{\text{Proj}}(\mathcal{A})}(n)$ for all
$n \in \mathbf{Z}$.

\medskip\noindent
We omit the definition of the multiplication maps
which turn $\bigoplus_n \mathcal{O}_{\underline{\text{Proj}}(\mathcal{A})}(n)$
into a quasi-coherent $\mathbf{Z}$-graded sheaf of
$\mathcal{O}_{\underline{\text{Proj}}(\mathcal{A})}$-algebras.
With this definitions the verification of assertion (1) of the
lemma is a matter of unwiding the definitions. Omitted.

\medskip\noindent
We omit the proof of (3).
\end{proof}

\begin{lemma}
\label{lemma-apply-relative}
Let $S$ be a scheme.
Let $\mathcal{A}$ be a quasi-coherent sheaf of graded $\mathcal{O}_S$-modules
generated as an $\mathcal{A}_0$-algebra by $\mathcal{A}_1$.
In this case the scheme $X = \underline{\text{Proj}}_S(\mathcal{A})$
represents the functor $F_1$ which associates to a scheme
$f : T \to S$ over $S$ the set of pairs $(\mathcal{L}, \psi)$, where
\begin{enumerate}
\item $\mathcal{L}$ is an invertible $\mathcal{O}_T$-module, and
\item $\psi : f^*\mathcal{A} \to \bigoplus_{n \geq 0} \mathcal{L}^{\otimes n}$
is a graded ring homomorphism such that $f^*\mathcal{A}_1 \to \mathcal{L}$
is surjective
\end{enumerate}
up to strict equivalence as above. Moreover, in this case all the
quasi-coherent sheaves
$\mathcal{O}_{\underline{\text{Proj}}(\mathcal{A})}(n)$
are invertible 
$\mathcal{O}_{\underline{\text{Proj}}(\mathcal{A})}$-modules
and the multiplication maps induce isomorphsms
$
\mathcal{O}_{\underline{\text{Proj}}(\mathcal{A})}(n)
\otimes_{\mathcal{O}_{\underline{\text{Proj}}(\mathcal{A})}}
\mathcal{O}_{\underline{\text{Proj}}(\mathcal{A})}(m) =
\mathcal{O}_{\underline{\text{Proj}}(\mathcal{A})}(n + m)$.
\end{lemma}

\begin{proof}
Under the assumptions of the lemma the sheaves
$\mathcal{O}_{\underline{\text{Proj}}(\mathcal{A})}(n)$
are invertible and the multiplication maps isomorphisms
by Lemma \ref{lemma-relative-proj} and Lemma \ref{lemma-apply}
over affine opens of $S$. Thus $X$ actually represents the
functor $F_1$, see proof of Lemma \ref{lemma-relative-proj}.
\end{proof}



















\section{Projective bundles}
\label{section-projective-bundle}

\noindent
Let $S$ be a scheme.
Let $\mathcal{E}$ be a quasi-coherent sheaf of $\mathcal{O}_S$-modules.
By Modules, Lemma \ref{modules-lemma-whole-tensor-algebra-permanence}
the symmetric algebra $\text{Sym}(\mathcal{E})$ of
$\mathcal{E}$ over $\mathcal{O}_S$
is a quasi-coherent sheaf of $\mathcal{O}_S$-algebras.
Note that it is generated in degree $1$ over $\mathcal{O}_S$.
Hence it makes sense to apply the construction of the
previous section to it, specifically Lemmas
\ref{lemma-relative-proj} and \ref{lemma-apply-relative}. 

\begin{definition}
\label{definition-projective-bundle}
Let $S$ be a scheme.
Let $\mathcal{E}$ be a quasi-coherent sheaf of $\mathcal{O}_S$-modules.
We denote
$$
\pi :
\mathbf{P}(\mathcal{E}) = \underline{\text{Proj}}_S(\text{Sym}(\mathcal{E}))
\longrightarrow
S
$$
and we call it the {\it projective bundle associated to the
quasi-coherent sheaf of $\mathcal{O}_S$-modules $\mathcal{E}$}.
The symbol $\mathcal{O}_{\mathbf{P}(\mathcal{E})}(n)$
indicates the invertible $\mathcal{O}_{\mathbf{P}(\mathcal{E})}$-modules
introduced in Lemma \ref{lemma-relative-proj} and is called the
{\it $n$th twist of the structure sheaf}.
\end{definition}

\noindent
Note that according to Lemma \ref{lemma-relative-proj} there are canonical
$\mathcal{O}_S$-module homomorphisms
$$
\text{Sym}^n(\mathcal{E})
\longrightarrow
\pi_*(\mathcal{O}_{\mathbf{P}(\mathcal{E})}(n))
$$
for all $n \geq 0$.












\input{chapters}

\bibliography{my}
\bibliographystyle{alpha}

\end{document}
