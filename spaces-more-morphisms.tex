\input{preamble}

% OK, start here.
%
\begin{document}

\title{More on Morphisms of Spaces}


\maketitle

\phantomsection
\label{section-phantom}

\tableofcontents

\section{Introduction}
\label{section-introduction}

\noindent
In this chapter we continue our study of properties of morphisms of algebraic
spaces. A fundamental reference is \cite{Kn}.





\section{Conventions}
\label{section-conventions}

\noindent
The standing assumption is that all schemes are contained in
a big fppf site $\textit{Sch}_{fppf}$. And all rings $A$ considered
have the property that $\text{Spec}(A)$ is (isomorphic) to an
object of this big site.

\medskip\noindent
Let $S$ be a scheme and let $X$ be an algebraic space over $S$.
In this chapter and the following we will write $X \times_S X$
for the product of $X$ with itself (in the category of algebraic
spaces over $S$), instead of $X \times X$.




\section{Morphisms of finite presentation}
\label{section-finite-presentation}

\noindent
In this section we generalize
Limits, Proposition
\ref{limits-proposition-characterize-locally-finite-presentation}
to morphisms of algebraic spaces.
The motivation for the following definition comes from
the proposition just cited.

\begin{definition}
\label{definition-finite-presentation}
Let $S$ be a scheme.
\begin{enumerate}
\item A functor $F : (\textit{Sch}/S)_{fppf}^{opp} \to \textit{Sets}$
is said to be {\it locally of finite presentation} if 
for every affine scheme $T$ over $S$ which is a limit $T = \text{lim}\ T_i$
of a directed inverse system of affine schemes $T_i$ over $S$, we have
$$
F(T) = \text{colim}\ F(T_i).
$$
We sometimes say that $F$ is {\it locally of finite presentation over $S$}.
\item Let $F, G : (\textit{Sch}/S)_{fppf}^{opp} \to \textit{Sets}$.
A transformation of functors $a : F \to G$
is {\it locally of finite presentation} if for every scheme $T$ over $S$
and every $y \in G(T)$ the functor
$$
F_y : (\textit{Sch}/T)_{fppf}^{opp} \longrightarrow \textit{Sets}, \quad
T'/T \longmapsto \{x \in F(T') \mid a(x) = y|_{T'}\}
$$
is locally of finite presentation over $T$.
\end{enumerate}
\end{definition}

\noindent
The functor $F_y$ of the definition is in some sense the fiber of
$a : F \to G$ over $y$, except that it is a sheaf on the big fppf
site of $T$. We have
\begin{equation}
\label{equation-fibre-map-functors}
F_y =
F|_{(\textit{Sch}/T)_{fppf}}
{\times}_{G|_{(\textit{Sch}/T)_{fppf}}}
*
\end{equation}
Here $*$ is the final object in the category of (pre)sheaves
on $(\textit{Sch}/T)_{fppf}$ (see
Sites, Example \ref{sites-example-singleton-sheaf})
and the map $* \to G_{(\textit{Sch}/T)_{fppf}}$ is given by $y$.
Note that if $j : (\textit{Sch}/T)_{fppf} \to (\textit{Sch}/S)_{fppf}$
is the localization functor, then the formula above becomes
$F_y = j^{-1}F \times_{j^{-1}G} *$ and $j_!F_y$ is just the fiber product
$F \times_{G, y} T$. (See
Sites, Section \ref{sites-section-localization},
for information on localization, and especially
Sites, Remark \ref{sites-remark-localization-presheaves}
for information on $j_!$ for presheaves.)

\medskip\noindent
At this point we temporarily have two definitions of what it means
for a morphism $X \to Y$ of algebraic spaces over $S$ to be locally of finite
presentation. Namely, one by
Morphisms of Spaces,
Definition \ref{spaces-morphisms-definition-locally-finite-presentation}
and one using that $X \to Y$ is a transformation of functors so that
Definition \ref{definition-finite-presentation}
applies. We will show below (insert future reference here)
that these two definitions agree.

\begin{lemma}
\label{lemma-composition-locally-finite-presentation}
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
Let $F, G, H : (\textit{Sch}/S)_{fppf}^{opp} \to \textit{Sets}$.
Let $a : F \to G$, $b : G \to H$ be transformations of functors.
If $a$ and $b$ are locally of finite presentation, then
$$
b \circ a : F \longrightarrow H
$$
is locally of finite presentation.
\end{lemma}

\begin{proof}
Let $T$ be a scheme over $S$. Let $z \in H(T)$.
We have to show that $F_z$ (notation as in
Definition \ref{definition-finite-presentation}
is locally of finite presentation over $T$.
Let $T'$ be an affine scheme over $T$.
Suppose that $T' = \text{lim}\ T'_i$ is written as a limit of
a directed inverse system of affine schemes over $T$.
Finally, let $x \in F(T')$ with $b(a(x)) = z|_{T'}$.
By assumption on $b$ there exists an index $i$ and an
element $y_i \in G(T'_i)$ with $b(y_i) = z|_{T'_i}$ and
$y_i|_{T'} = a(x)$.
Then, by assumption on $a$, there exists an index $i' \geq i$
and an element $x_{i'} \in F(T'_{i'})$ with $a(x_{i'}) = y_i|_{T'_{i'}}$
and $x_{i'}|_{T'} = x$. It follows that $(b \circ a)(x_{i'}) = z|_{T'_{i'}}$
and $x_{i'}|_{T'} = x$. In this way we see that the map
$\text{colim}\ F_z(T'_i) \to F_z(T')$ is surjective.
We omit the proof of injectivity.
\end{proof}

\begin{lemma}
\label{lemma-base-change-locally-finite-presentation}
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
Let $F, G, H : (\textit{Sch}/S)_{fppf}^{opp} \to \textit{Sets}$.
Let $a : F \to G$, $b : H \to G$ be transformations of functors.
Consider the fibre product diagram
$$
\xymatrix{
H \times_{b, G, a} F \ar[r]_-{b'} \ar[d]_{a'} & F \ar[d]^a \\
H \ar[r]^b & G
}
$$
If $a$ is locally of finite presentation, then the base change $a'$ is
locally of finite presentation.
\end{lemma}

\begin{proof}
Omitted. Hint: This is formal.
\end{proof}

\begin{lemma}
\label{lemma-limit-fppf-topology}
Let $T$ be an affine scheme which is written as a limit
$T = \text{lim}_{i \in I}\ T_i$ of a directed inverse system of affine schemes.
\begin{enumerate}
\item Let $\mathcal{V} = \{V_j \to T\}_{j = 1, \ldots, m}$ be a standard fppf
covering of $T$, see
Topologies, Definition \ref{topologies-definition-standard-fppf}.
Then there exists an index $i$ and a standard fppf covering
$\mathcal{V}_i = \{V_{i, j} \to T_i\}_{j = 1, \ldots, m}$
whose base change $T \times_{T_i} \mathcal{V}_i$ to $T$
is isomorphic to $\mathcal{V}$.
\item Let $\mathcal{V}_i$, $\mathcal{V}'_i$ be a pair of standard
fppf coverings of $T_i$. If
$f : T \times_{T_i} \mathcal{V} \to T \times_{T_i} \mathcal{V}'_i$ is
a morphism of coverings of $T$, then there exists an index
$i' \geq i$ and a morphism
$f_{i'} : T_{i'} \times_{T_i} \mathcal{V} \to
T_{i'} \times_{T_i} \mathcal{V}'_i$
whose base change to $T$ is $f$.
\item If
$f, g : \mathcal{V} \to \mathcal{V}'_i$
are morphisms of standard fppf coverings of $T_i$ whose
base changes $f_T, g_T$ to $T$ are equal then there exists an
index $i' \geq i$ such that $f_{T_{i'}} = g_{T_{i'}}$.
\end{enumerate}
In other words, the category of standard fppf coverings of $T$ is
the colimit over $I$ of the categories of standard fppf coverings of $T_i$
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-sheafify-finite-presentation}
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
Let $F : (\textit{Sch}/S)_{fppf}^{opp} \to \textit{Sets}$ be a functor.
If $F$ is locally of finite presentation over $S$ then its sheafification
$F^\#$ is locally of finite presentation over $S$.
\end{lemma}

\begin{proof}
Assume $F$ is locally of finite presentation.
Let $T$ be an affine scheme over $S$, and let $T = \lim T_i$ be written
as the directed limit of an inverse system of affine $S$ schemes.
Recall that $F^\#(T)$ is the colimit of $\check H^0(\mathcal{V}, F)$
where the limit is over all coverings of $T$ in $(\textit{Sch}/S)_{fppf}$.
Any fppf covering of an affine scheme can be refined by a standard
fppf covering, see
Topologies, Lemma \ref{topologies-lemma-fppf-affine}.
Hence we can write
$$
F^\#(T)
=
\text{colim}_{\mathcal{V}\text{ standard covering }T}\ 
\check H^0(\mathcal{V}, F).
$$
By
Lemma \ref{lemma-limit-fppf-topology}
we may rewrite this as
$$
\text{colim}_{i \in I}\ 
\text{colim}_{\mathcal{V}_i\text{ standard covering }T_i}\ 
\check H^0(T \times_{T_i}\mathcal{V}_i, F).
$$
(The order of the colimits is irrelevant by
Categories, Lemma \ref{categories-lemma-colimits-commute}.)
Given a standard fppf covering
$\mathcal{V}_i = \{V_j \to T_i\}_{j = 1, \ldots, m}$ of $T_i$ we see that
$$
T \times_{T_i} V_j = \text{lim}_{i' \geq i}\ T_{i'} \times_T V_j
$$
by 
Limits, Lemma \ref{limits-lemma-scheme-over-limit}, and similarly
$$
T \times_{T_i} (V_j \times_{T_i} V_{j'}) =
\text{lim}_{i' \geq i}\ T_{i'} \times_T (V_j \times_{T_i} V_{j'}).
$$
As the presheaf $F$ is locally of finite presentation this means that
$$
\check H^0(T \times_{T_i}\mathcal{V}_i, F)
=
\text{colim}_{i' \geq i}
\check H^0(T_{i'} \times_{T_i}\mathcal{V}_i, F).
$$
Hence the colimit expression for $F^\#(T)$ above collapses to
$$
\text{colim}_{i \in I}\ 
\text{colim}_{\mathcal{V}\text{ standard covering }T_i}\ 
\check H^0(\mathcal{V}, F).
=
\text{colim}_{i \in I} F^\#(T_i).
$$
In other words $F^\#(T) = \text{colim}_i\ F^\#(T_i)$ and hence
the lemma holds.
\end{proof}

\begin{lemma}
\label{lemma-sheaf-finite-presentation}
Let $S$ be a scheme. 
Let $F : (\textit{Sch}/S)_{fppf}^{opp} \to \textit{Sets}$ be a functor.
Assume that
\begin{enumerate}
\item $F$ is a sheaf, and
\item there exists an fppf covering $\{U_i \to S\}$ such that
the restrictions $F|_{(\textit{Sch}/U_i)_{fppf}}$ are locally
of finite presentation.
\end{enumerate}
Then $F$ is locally of finite presentation.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-sheafify-finite-presentation-map}
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
Let $F, G : (\textit{Sch}/S)_{fppf}^{opp} \to \textit{Sets}$ be functors.
If $a : F \to G$ is a transformation which is locally of finite
presentation, then the induced transformation of sheaves
$F^\# \to G^\#$ is of finite presentation.
\end{lemma}

\begin{proof}
Suppose that $T$ is a scheme and $y \in G^\#(T)$.
We have to show the functor
$F^\#_y : (\textit{Sch}/T)_{fppf}^{opp} \to \textit{Sets}$
constructed from $F^\# \to G^\#$ and $y$ as in
Definition \ref{definition-finite-presentation}
is locally of finite presentation.
By Equation (\ref{equation-fibre-map-functors})
we see that $F^\#_y$ is a sheaf. Choose an fppf covering
$\{V_j \to T\}_{j \in J}$ such that $y|_{V_j}$ comes from
an element $y_j \in F(V_j)$.
Note that the restriction of $F^\#$ to $(\textit{Sch}/V_j)_{fppf}$
is just $F^\#_{y_j}$. If we can show that $F^\#_{y_j}$ is
locally of finite presentation then
Lemma \ref{lemma-sheaf-finite-presentation}
garantees that $F^\#_y$ is locally of finite presentation and
we win. This reduces us to the case $y \in G(T)$.

\medskip\noindent
Let $y \in G(T)$. In this case we claim that $F^\#_y = (F_y)^\#$.
This follows from 
Equation (\ref{equation-fibre-map-functors}.
Thus this case follows from
Lemma \ref{lemma-sheafify-finite-presentation}.
\end{proof}






\section{Formally smooth morphisms}
\label{section-formally-smooth}

\noindent
Michael Artin's position on differential criteria of smoothness (e.g.,
Morphisms, Lemma \ref{morphisms-lemma-smooth-at-point}) is that they are
basically useless (in practice). In this section we introduce the
notion of a formally smooth morphism $X \to Y$. Such a morphism is
characterized by the property that $T$-valued points of $X$ lift
to inifinitesimal thickenings of $T$ provided $T$ is affine.
The main result is that a morphism which is formally smooth and
locally of finite presentation is smooth, see
Lemma \ref{lemma-smooth-formally-smooth}.
It turns out that this criterion is often easier to use than the
differential criteria mentioned above.


\medskip\noindent
Recall that a ring map $R \to A$ is called {\it formally smooth}
(see Algebra, Definition \ref{algebra-definition-formally-smooth})
if for every commutative solid diagram
$$
\xymatrix{
A \ar[r] \ar@{-->}[rd] & B/I \\
R \ar[r] \ar[u] & B \ar[u]
}
$$
where $I \subset B$ is an ideal of square zero, a dotted
arrow exists which makes the diagram commute. This motivates
the following analogue for morphisms of schemes.

\begin{definition}
\label{definition-formally-smooth}
Let $S$ be a scheme.
Let $a : F \to G$ be a transformation of functors
$F, G : (\textit{Sch}/S)_{fppf}^{opp} \to \textit{Sets}$.
We say $a$ is {\it formally smooth} if given any solid commutative diagram
$$
\xymatrix{
F \ar[d]_a & T \ar[d]^i \ar[l] \\
G & T' \ar[l] \ar@{-->}[lu]
}
$$
where $T$ and $T'$ are affine schemes and $i$ is a closed immersion defined
by an ideal of square zero there exists a dotted arrow making the diagram
commute.
\end{definition}

\begin{lemma}
\label{lemma-composition-formally-smooth}
A composition of formally smooth transformations of functors is formally
smooth.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-base-change-formally-smooth}
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
Let $F, G, H : (\textit{Sch}/S)_{fppf}^{opp} \to \textit{Sets}$.
Let $a : F \to G$, $b : H \to G$ be transformations of functors.
Consider the fibre product diagram
$$
\xymatrix{
H \times_{b, G, a} F \ar[r]_-{b'} \ar[d]_{a'} & F \ar[d]^a \\
H \ar[r]^b & G
}
$$
If $a$ is formally smooth, then the base change $a'$ is
formally smooth.
\end{lemma}

\begin{proof}
Omitted, but see Algebra, Lemma \ref{algebra-lemma-base-change-fs}
for the algebraic version.
\end{proof}











\input{chapters}

\bibliography{my}
\bibliographystyle{amsalpha}

\end{document}
