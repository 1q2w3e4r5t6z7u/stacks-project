\input{preamble}

% OK, start here.
%
\begin{document}

\title{Cohomology of Sheaves}


\maketitle

\phantomsection
\label{section-phantom}

\tableofcontents

\section{Introduction}
\label{section-introduction}

\noindent
In this document we work out some topics on cohomology of sheaves
on topological spaces. We mostly work in the generality of modules
over a sheaf of rings and we work with morphisms of ringed spaces.
To see what happens for sheaves on sites as well,
see the chapter
Cohomology on Sites, Section \ref{sites-cohomology-section-phantom}.
Basic references are \cite{Godement} and \cite{Iversen}.


\section{Topics}
\label{section-topics}

\noindent
Here are some topics that should be discussed in this chapter,
and have not yet been written.
\begin{enumerate}
\item Ext-groups.
\item Ext sheaves.
\item Tor functors.
\item Derived pullback for morphisms between ringed spaces.
\item Cup-product.
\item Etc, etc, etc.
\end{enumerate}



\section{Cohomology of sheaves}
\label{section-cohomology-sheaves}

\noindent
Let $X$ be a topological space. Let $\mathcal{F}$ be a abelian sheaf.
We know that the category of abelian sheaves on $X$ has enough injectives, see
Injectives, Lemma \ref{injectives-lemma-abelian-sheaves-space}.
Hence we can choose an injective resolution
$\mathcal{F}[0] \to \mathcal{I}^\bullet$. As is customary we define
\begin{equation}
\label{equation-cohomology}
H^i(X, \mathcal{F}) = H^i(\Gamma(X, \mathcal{I}^\bullet))
\end{equation}
to be the {\it $i$th cohomology group of the abelian sheaf $\mathcal{F}$}.
The family of functors $H^i((X, -)$ forms a universal $\delta$-functor
from $\textit{Ab}(X) \to \textit{Ab}$.

\medskip\noindent
Let $f : X \to Y$ be a continuous map of topological spaces. With
$\mathcal{F}[0] \to \mathcal{I}^\bullet$ as above
we define
\begin{equation}
\label{equation-higher-direct-image}
R^if_*\mathcal{F} = H^i(f_*\mathcal{I}^\bullet)
\end{equation}
to be the {\it $i$th higher direct image of $\mathcal{F}$}.
The family of functors $R^if_*$ forms a universal $\delta$-functor
from $\textit{Ab}(X) \to \textit{Ab}(Y)$.

\medskip\noindent
Let $(X, \mathcal{O}_X)$ be a ringed space. Let $\mathcal{F}$ be an
$\mathcal{O}_X$-module. We know that the category of $\mathcal{O}_X$-modules
on $X$ has enough injectives, see
Injectives, Lemma \ref{injectives-lemma-sheaves-modules-space}.
Hence we can choose an injective resolution
$\mathcal{F}[0] \to \mathcal{I}^\bullet$. As is customary we define
\begin{equation}
\label{equation-cohomology-modules}
H^i(X, \mathcal{F}) = H^i(\Gamma(X, \mathcal{I}^\bullet))
\end{equation}
to be the {\it $i$th cohomology group of $\mathcal{F}$}.
The family of functors $H^i((X, -)$ forms a universal $\delta$-functor
from $\textit{Mod}(\mathcal{O}_X) \to \text{Mod}(\mathcal{O}_X(X))$.

\medskip\noindent
Let $f : (X, \mathcal{O}_X) \to (Y, \mathcal{O}_Y)$ be a morphism of ringed
spaces. With $\mathcal{F}[0] \to \mathcal{I}^\bullet$ as above
we define
\begin{equation}
\label{equation-higher-direct-image-modules}
R^if_*\mathcal{F} = H^i(f_*\mathcal{I}^\bullet)
\end{equation}
to be the {\it $i$th higher direct image of $\mathcal{F}$}.
The family of functors $R^if_*$ forms a universal $\delta$-functor
from $\textit{Mod}(\mathcal{O}_X) \to \textit{Mod}(\mathcal{O}_Y)$.





\section{Derived functors}
\label{section-derived-functors}

\noindent
We briefly explain an approach to right derived functors using resolution
functors. Let $(X, \mathcal{O}_X)$ be a ringed space. The category
$\textit{Mod}(\mathcal{O}_X)$ is abelian, see
Modules, Lemma \ref{modules-lemma-abelian}.
In this chapter we will write
$$
K(X) = K(\mathcal{O}_X) = K(\textit{Mod}(\mathcal{O}_X))
\quad
\text{and}
\quad
D(X) = D(\mathcal{O}_X) = D(\textit{Mod}(\mathcal{O}_X)).
$$
and similarly for the bounded versions for the triangulated categories
introduced in
Derived Categories, Definition \ref{derived-definition-complexes-notation} and
Definition \ref{derived-definition-unbounded-derived-category}.
By
Derived Categories, Remark \ref{derived-remark-big-abelian-category}
there exists a resolution functor
$$
j = j_X :
K^{+}(\textit{Mod}(\mathcal{O}_X))
\longrightarrow
K^{+}(\mathcal{I})
$$
where $\mathcal{I}$ is the strictly full additive subcategory of
$\textit{Mod}(\mathcal{O}_X)$ consisting of injective sheaves.
For any left exact functor
$F : \textit{Mod}(\mathcal{O}_X) \to \mathcal{B}$
into any abelian category $\mathcal{B}$ we will denote $RF$ the
right derived functor described in
Derived Categories, Section \ref{derived-section-right-derived-functor}
and constructed using the resolution functor $j_X$ just described:
\begin{equation}
\label{equation-RF}
RF = F \circ j_X' : D^{+}(X) \longrightarrow D^{+}(\mathcal{B})
\end{equation}
see
Derived Categories, Lemma \ref{derived-lemma-right-derived-functor}
for notation. Note that we may think of $RF$ as defined on
$\textit{Mod}(\mathcal{O}_X)$,
$\text{Comp}^{+}(\textit{Mod}(\mathcal{O}_X))$,
$K^{+}(X)$, or $D^{+}(X)$
depending on the situation. According to
Derived Categories, Definition \ref{derived-definition-higher-derived-functors}
we obtain the $i$th right derived functor
\begin{equation}
\label{equation-RFi}
R^iF = H^i \circ RF : \textit{Mod}(\mathcal{O}_X) \longrightarrow \mathcal{B}
\end{equation}
so that $R^0F = F$ and $\{R^iF, \delta\}_{i \geq 0}$ is universal
$\delta$-functor, see
Derived Categories, Lemma \ref{derived-lemma-higher-derived-functors}.

\medskip\noindent
Here are two special cases of this construction.
Given a ring $R$ we write $K(R) = K(\text{Mod}_R)$ and
$D(R) = D(\text{Mod}_R)$ and similarly for bounded versions.
For any open $U \subset X$ we have a left exact functor
$
\Gamma(U, -) :
\textit{Mod}(\mathcal{O}_X)
\longrightarrow
\text{Mod}(\mathcal{O}_X(U))
$
which gives rise to
\begin{equation}
\label{equation-total-derived-cohomology}
R\Gamma(U, -) :
D^{+}(X)
\longrightarrow
D^{+}(\mathcal{O}_X(U))
\end{equation}
by the discussion above. We set $H^i(U, -) = R^i\Gamma(U, -)$.
If $U = X$ we recover (\ref{equation-cohomology-modules}).
If $f : X \to Y$ is a morphism of ringed spaces, then we have
the left exact functor
$
f_* :
\textit{Mod}(\mathcal{O}_X)
\longrightarrow
\textit{Mod}(\mathcal{O}_Y)
$
which gives rise to the {\it derived pushforward}
\begin{equation}
\label{equation-total-derived-direct-image}
Rf_* :
D^{+}(X)
\longrightarrow
D^{+}(Y)
\end{equation}
The $i$th cohomology sheaf of $Rf_*\mathcal{F}^\bullet$ is denoted
$R^if_*\mathcal{F}^\bullet$ and called the $i$th {\it higher direct image}
in accordance with (\ref{equation-higher-direct-image-modules}).
The two displayed functors above are exact functor
of derived categories.

\medskip\noindent
{\bf Abuse of notation:} When the functor $Rf_*$, or any other
derived functor, is applied to a sheaf $\mathcal{F}$ on $X$ or a complex
of sheaves it is understood that $\mathcal{F}$ has been replaced by a
suitable resolution of $\mathcal{F}$. To facilitate this kind of
operation we will say, given an object $\mathcal{F}^\bullet \in D(X)$,
that a bounded below complex $\mathcal{I}^\bullet$ of injectives of
$\textit{Mod}(\mathcal{O}_X)$
{\it represents $\mathcal{F}^\bullet$ in the derived category}
if there exists a quasi-isomorphism
$\mathcal{F}^\bullet \to \mathcal{I}^\bullet$. In the same vein the phrase
``let $\alpha : \mathcal{F}^\bullet \to \mathcal{G}^\bullet$ be
a morphism of $D(X)$'' does not mean that $\alpha$ is represented by a
morphism of complexes. If we have an actual morphism of complexes we will
say so.









\section{First cohomology and torsors}
\label{section-h1-torsors}

\begin{definition}
\label{definition-torsor}
Let $X$ be a topological space.
Let $\mathcal{G}$ be a sheaf of (possibly non-commutative) groups on $X$.
A {\it torsor}, or more precisely a {\it $\mathcal{G}$-torsor}, is a sheaf
of sets $\mathcal{F}$ on $X$ endowed with an action
$\mathcal{G} \times \mathcal{F} \to \mathcal{F}$ such that
\begin{enumerate}
\item whenever $\mathcal{F}(U)$ is nonempty the action
$\mathcal{G}(U) \times \mathcal{F}(U) \to \mathcal{F}(U)$
is simply transitive, and
\item for every $x \in X$ the stalk $\mathcal{F}_x$ is nonempty.
\end{enumerate}
A {\it morphism of $\mathcal{G}$-torsors} $\mathcal{F} \to \mathcal{F}'$
is simply a morphism of sheaves of sets compatible with the
$\mathcal{G}$-actions. The {\it trivial $\mathcal{G}$-torsor}
is the sheaf $\mathcal{G}$ endowed with the obvious left
$\mathcal{G}$-action.
\end{definition}

\noindent
It is clear that a morphism of torsors is automatically an isomorphism.

\begin{lemma}
\label{lemma-trivial-torsor}
Let $X$ be a topological space.
Let $\mathcal{G}$ be a sheaf of (possibly non-commutative) groups on $X$.
A $\mathcal{G}$-torsor $\mathcal{F}$ is trivial if and only if
$\mathcal{F}(X) \not = \emptyset$.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-torsors-h1}
Let $X$ be a topological space.
Let $\mathcal{H}$ be an abelian sheaf on $X$.
There is a canonical bijection between the set of isomorphism
classes of $\mathcal{H}$-torsors and $H^1(X, \mathcal{H})$.
\end{lemma}

\begin{proof}
Let $\mathcal{F}$ be a $\mathcal{H}$-torsor.
Consider the free abelian sheaf $\mathbf{Z}[\mathcal{F}]$
on $\mathcal{F}$. It is the sheafification of the rule
which associates to $U \subset X$ open the collection of finite
formal sums $\sum n_i[s_i]$ with $n_i \in \mathbf{Z}$
and $s_i \in \mathcal{F}(U)$. There is a natural map
$$
\sigma : \mathbf{Z}[\mathcal{F}] \longrightarrow \underline{\mathbf{Z}}
$$
which to a local section $\sum n_i[s_i]$ associates $\sum n_i$.
The kernel of $\sigma$ is generated by the local section of the form
$[s] - [s']$. There is a canonical map
$a : \text{Ker}(\sigma) \to \mathcal{H}$
which maps $[s] - [s'] \mapsto h$ where $h$ is the local section of
$\mathcal{H}$ such that $h \cdot s = s'$. Consider the pushout diagram
$$
\xymatrix{
0 \ar[r] &
\text{Ker}(\sigma) \ar[r] \ar[d]^a &
\mathbf{Z}[\mathcal{F}] \ar[r] \ar[d] &
\underline{\mathbf{Z}} \ar[r] \ar[d] &
0 \\
0 \ar[r] &
\mathcal{H} \ar[r] &
\mathcal{E} \ar[r] &
\underline{\mathbf{Z}} \ar[r] &
0
}
$$
Here $\mathcal{E}$ is the extension obtained by pushout.
From the long exact cohomology sequence associated to the lower
short exact sequence we obtain an element
$\xi = \xi_\mathcal{F} \in H^1(X, \mathcal{H})$
by applying the boundary operator to $1 \in H^0(X, \underline{\mathbf{Z}})$.

\medskip\noindent
Conversely, given $\xi \in H^1(X, \mathcal{H})$ we can associate to
$\xi$ a torsor as follows. Choose an embedding $\mathcal{H} \to \mathcal{I}$
of $\mathcal{H}$ into an injective abelian sheaf $\mathcal{I}$. We set
$\mathcal{Q} = \mathcal{I}/\mathcal{H}$ so that we have a short exact
sequence
$$
\xymatrix{
0 \ar[r] &
\mathcal{H} \ar[r] &
\mathcal{I} \ar[r] &
\mathcal{Q} \ar[r] &
0
}
$$
The element $\xi$ is the image of a global section $q \in H^0(X, \mathcal{Q})$
because $H^1(X, \mathcal{I}) = 0$ (see
Derived Categories, Lemma \ref{derived-lemma-higher-derived-functors}).
Let $\mathcal{F} \subset \mathcal{I}$ be the subsheaf (of sets) of sections
that map to $q$ in the sheaf $\mathcal{Q}$. It is easy to verify that
$\mathcal{F}$ is a torsor.

\medskip\noindent
We omit the verification that the two constructions given
above are mutually inverse.
\end{proof}
























\section{Locality of cohomology}
\label{section-locality}

\noindent
The following lemma says there is no ambguity in defining the cohomology
of a sheaf $\mathcal{F}$ over an open.

\begin{lemma}
\label{lemma-cohomology-of-open}
Let $X$ be a ringed space.
Let $U \subset X$ be an open subspace.
\begin{enumerate}
\item If $\mathcal{I}$ is an injective $\mathcal{O}_X$-module
then $\mathcal{I}|_U$ is an injective $\mathcal{O}_U$-module.
\item For any sheaf of $\mathcal{O}_X$-modules $\mathcal{F}$ we have
$H^p(U, \mathcal{F}) = H^p(U, \mathcal{F}|_U)$.
\end{enumerate}
\end{lemma}

\begin{proof}
Denote $j : U \to X$ the open immersion.
Recall that the functor $j^{-1}$ of restriction to $U$ is a right adjoint
to the functor $j_!$ of extension by $0$, see
Sheaves, Lemma \ref{sheaves-lemma-j-shriek-modules}.
Moreover, $j_!$ is exact. Hence (1) follows from
Homology, Lemma \ref{homology-lemma-adjoint-preserve-injectives}.

\medskip\noindent
By definition $H^p(U, \mathcal{F}) = H^p(\Gamma(U, \mathcal{I}^\bullet))$
where $\mathcal{F} \to \mathcal{I}^\bullet$ is an injective resolution
in $\textit{Mod}(\mathcal{O}_X)$.
By the above we see that $\mathcal{F}|_U \to \mathcal{I}^\bullet|_U$
is an injective resolution in $\textit{Mod}(\mathcal{O}_U)$.
Hence $H^p(U, \mathcal{F}|_U)$ is equal to
$H^p(\Gamma(U, \mathcal{I}^\bullet|_U))$.
Of course $\Gamma(U, \mathcal{F}) = \Gamma(U, \mathcal{F}|_U)$ for
any sheaf $\mathcal{F}$ on $X$.
Hence the equality
in (2).
\end{proof}

\noindent
Let $X$ be a ringed space.
Let $\mathcal{F}$ be a sheaf of $\mathcal{O}_X$-modules.
Let $U \subset V \subset X$ be open subsets.
Then there is a canonical {\it restriction mapping}
\begin{equation}
\label{equation-restriction-mapping}
H^n(V, \mathcal{F})
\longrightarrow
H^n(U, \mathcal{F}), \quad
\xi \longmapsto \xi|_U
\end{equation}
functorial in $\mathcal{F}$. Namely, choose any injective
resolution $\mathcal{F} \to \mathcal{I}^\bullet$. The restriction
mappings of the sheaves $\mathcal{I}^p$ give a morphism of complexes
$$
\Gamma(V, \mathcal{I}^\bullet)
\longrightarrow
\Gamma(U, \mathcal{I}^\bullet)
$$
The LHS is a complex representing $R\Gamma(V, \mathcal{F})$
and the RHS is a complex representing $R\Gamma(U, \mathcal{F})$.
We get the map on cohomology groups by applying the functor $H^n$.
As indicated we will use the notation $\xi \mapsto \xi|_U$ to denote this map.
Thus the rule $U \mapsto H^n(U, \mathcal{F})$ is a presheaf of
$\mathcal{O}_X$-modules. This presheaf is customarily denoted
$\underline{H}^n(\mathcal{F})$. We will give another interpretation
of this presheaf in Lemma \ref{lemma-include}.

\begin{lemma}
\label{lemma-kill-cohomology-class-on-covering}
Let $X$ be a ringed space.
Let $\mathcal{F}$ be a sheaf of $\mathcal{O}_X$-modules.
Let $U \subset X$ be an open subspace.
Let $n > 0$ and let $\xi \in H^n(U, \mathcal{F})$.
Then there exists an open covering
$U = \bigcup_{i\in I} U_i$ such that $\xi|_{U_i} = 0$ for
all $i \in I$.
\end{lemma}

\begin{proof}
Let $\mathcal{F} \to \mathcal{I}^\bullet$ be an injective resolution.
Then
$$
H^n(U, \mathcal{F}) =
\frac{\text{Ker}(\mathcal{I}^n(U) \to \mathcal{I}^{n + 1}(U))}
{\text{Im}(\mathcal{I}^{n - 1}(U) \to \mathcal{I}^n(U))}.
$$
Pick an element $\tilde \xi \in \mathcal{I}^n(U)$ representing the
cohomology class in the presentation above. Since $\mathcal{I}^\bullet$
is an injective resolution of $\mathcal{F}$ and $n > 0$ we see that
the complex $\mathcal{I}^\bullet$ is exact in degree $n$. Hence
$\text{Im}(\mathcal{I}^{n - 1} \to \mathcal{I}^n) =
\text{Ker}(\mathcal{I}^n \to \mathcal{I}^{n + 1})$ as sheaves.
Since $\tilde \xi$ is a section of the kernel sheaf over $U$
we conclude there exists an open covering $U = \bigcup_{i \in I} U_i$
such that $\tilde \xi|_{U_i}$ is the image under $d$ of a section
$\xi_i \in \mathcal{I}^{n - 1}(U_i)$. By our definition of the
restriction $\xi|_{U_i}$ as corresponding to the class of
$\tilde \xi|_{U_i}$ we conclude.
\end{proof}

\begin{lemma}
\label{lemma-describe-higher-direct-images}
Let $f : X \to Y$ be a morphism of ringed spaces.
Let $\mathcal{F}$ be a $\mathcal{O}_X$-module.
The sheaves $R^if_*\mathcal{F}$ are the sheaves
associated to the presheaves
$$
V \longmapsto H^i(f^{-1}(V), \mathcal{F})
$$
with restriction mappings as in Equation (\ref{equation-restriction-mapping}).
There is a similar statement for $R^if_*$ applied to a
bounded below complex $\mathcal{F}^\bullet$.
\end{lemma}

\begin{proof}
Let $\mathcal{F} \to \mathcal{I}^\bullet$ be an injective resolution.
Then $R^if_*\mathcal{F}$ is by definition the $i$th cohomology sheaf
of the complex
$$
f_*\mathcal{I}^0 \to f_*\mathcal{I}^1 \to f_*\mathcal{I}^2 \to \ldots
$$
By definition of the abelian category structure on $\mathcal{O}_Y$-modules
this cohomology sheaf is the sheaf associated to the presheaf
$$
V
\longmapsto
\frac{\text{Ker}(f_*\mathcal{I}^i(V) \to f_*\mathcal{I}^{i + 1}(V))}
{\text{Im}(f_*\mathcal{I}^{i - 1}(V) \to f_*\mathcal{I}^i(V))}
$$
and this is obviously equal to
$$
\frac{\text{Ker}(\mathcal{I}^i(f^{-1}(V)) \to \mathcal{I}^{i + 1}(f^{-1}(V)))}
{\text{Im}(\mathcal{I}^{i - 1}(f^{-1}(V)) \to \mathcal{I}^i(f^{-1}(V)))} \\
$$
which is equal to $H^i(f^{-1}(V), \mathcal{F})$
and we win.
\end{proof}

\begin{lemma}
\label{lemma-localize-higher-direct-images}
Let $f : X \to Y$ be a morphism of ringed spaces.
Let $\mathcal{F}$ be an $\mathcal{O}_X$-module.
Let $V \subset Y$ be an open subspace.
Denote $g : f^{-1}(V) \to V$ the restriction of $f$.
Then we have
$$
R^pg_*(\mathcal{F}|_{f^{-1}(V)}) = (R^pf_*\mathcal{F})|_V
$$
There is a similar statement for the
derived image $Rf_*\mathcal{F}^\bullet$ where $\mathcal{F}^\bullet$
is a bounded below complex of $\mathcal{O}_X$-modules.
\end{lemma}

\begin{proof}
First proof. Apply Lemmas \ref{lemma-describe-higher-direct-images}
and \ref{lemma-cohomology-of-open} to see the displayed equality.
Second proof. Choose an injective resolution
$\mathcal{F} \to \mathcal{I}^\bullet$
and use that $\mathcal{F}|_{f^{-1}(V)} \to \mathcal{I}^\bullet|_{f^{-1}(V)}$
is an injective resolution also.
\end{proof}

\begin{remark}
\label{remark-daniel}
Here is a different approach to the proofs of
Lemmas \ref{lemma-kill-cohomology-class-on-covering} and
\ref{lemma-describe-higher-direct-images} above.
Let $(X, \mathcal{O}_X)$ be a ringed space.
Let $i_X : \textit{Mod}(\mathcal{O}_X) \to \textit{Mod}(\mathcal{O}_X)$
be the inclusion functor and let $\#$ be the sheafification functor.
Recall that $i_X$ is left exact and $\#$ is exact.
\begin{enumerate}
\item First prove Lemma \ref{lemma-include} below which says that the
right derived functors of $i_X$ are given by
$R^pi_X\mathcal{F} = \underline{H}^p(\mathcal{F})$.
Here is another proof: The equality is clear for $p = 0$.
Both $(R^pi_X)_{p \geq 0}$ and $(\underline{H}^p)_{p \geq 0}$
are delta functors vanishing on injectives, hence both are universal,
hence they are isomorphic. See Homology,
Section \ref{homology-section-cohomological-delta-functor}.
\item A restatement of Lemma \ref{lemma-kill-cohomology-class-on-covering}
is that $(\underline{H}^p(\mathcal{F}))^\# = 0$, $p > 0$ for any sheaf of
$\mathcal{O}_X$-modules $\mathcal{F}$.
To see this is true, use that ${}^\#$ is exact so
$$
(\underline{H}^p(\mathcal{F}))^\# =
(R^pi_X\mathcal{F})^\# =
R^p(\# \circ i_X)(\mathcal{F}) = 0
$$
because $\# \circ i_X$ is the identity functor.
\item Let $f : X \to Y$ be a morphism of ringed spaces.
Let $\mathcal{F}$ be an $\mathcal{O}_X$-module. The presheaf
$V \mapsto H^p(f^{-1}V, \mathcal{F})$ is equal to
$R^p (i_Y \circ f_*)\mathcal{F}$. You can prove this by noticing that
both give universal delta functors as in the argument of (1) above.
Hence Lemma \ref{lemma-describe-higher-direct-images}
says that $R^p f_* \mathcal{F}= (R^p (i_Y \circ f_*)\mathcal{F})^\#$.
Again using that $\#$ is exact a that $\# \circ i_Y$ is the identity
functor we see that
$$
R^p f_* \mathcal{F} =
R^p(\# \circ i_Y \circ f_*)\mathcal{F} =
(R^p (i_Y \circ f_*)\mathcal{F})^\#
$$
as desired.
\end{enumerate}
\end{remark}











\section{Projection formula}
\label{section-projection-formula}

\noindent
In this section we collect variants of the projection formula.
The most basic version is Lemma \ref{lemma-projection-formula}.

\begin{lemma}
\label{lemma-injective-tensor-finite-locally-free}
Let $X$ be a ringed space.
Let $\mathcal{I}$ be an injective $\mathcal{O}_X$-module.
Let $\mathcal{E}$ be an $\mathcal{O}_X$-module.
Assume $\mathcal{E}$ is finite locally free on $X$, see
Modules, Definition \ref{modules-definition-locally-free}.
Then $\mathcal{E} \otimes_{\mathcal{O}_X} \mathcal{I}$ is
an injective $\mathcal{O}_X$-module.
\end{lemma}

\begin{proof}
This is true because under the assumptions of the lemma we have
$$
\Hom_{\mathcal{O}_X}(\mathcal{F},
\mathcal{E} \otimes_{\mathcal{O}_X} \mathcal{I})
=
\Hom_{\mathcal{O}_X}(
\mathcal{F} \otimes_{\mathcal{O}_X} \mathcal{E}^\wedge, \mathcal{I})
$$
where
$\mathcal{E}^\wedge = \SheafHom_{\mathcal{O}_X}(\mathcal{E}, \mathcal{O}_X)$
is the dual of $\mathcal{E}$ which is finite locally free also. Since tensoring
with a finite locally free sheaf is an exact functor we win by
Homology, Lemma \ref{homology-lemma-characterize-injectives}.
\end{proof}

\begin{lemma}
\label{lemma-projection-formula}
Let $f : X \to Y$ be a morphism of ringed spaces.
Let $\mathcal{F}$ be an $\mathcal{O}_X$-module.
Let $\mathcal{E}$ be an $\mathcal{O}_Y$-module.
Assume $\mathcal{E}$ is finite locally free on $Y$, see
Modules, Definition \ref{modules-definition-locally-free}.
Then there exist isomorphisms
$$
\mathcal{E} \otimes_{\mathcal{O}_Y} R^qf_*\mathcal{F}
\longrightarrow
R^qf_*(f^*\mathcal{E} \otimes_{\mathcal{O}_X} \mathcal{F})
$$
for all $q \geq 0$. In fact there exists an isomorphism
$$
\mathcal{E} \otimes_{\mathcal{O}_Y} Rf_*\mathcal{F}
\longrightarrow
Rf_*(f^*\mathcal{E} \otimes_{\mathcal{O}_X} \mathcal{F})
$$
in $D^{+}(Y)$ functorial in $\mathcal{F}$.
\end{lemma}

\begin{proof}
Choose an injective resolution $\mathcal{F} \to \mathcal{I}^\bullet$
on $X$. Note that $f^*\mathcal{E}$ is finite locally free also, hence
we get a resolution
$$
f^*\mathcal{E} \otimes_{\mathcal{O}_X} \mathcal{F}
\longrightarrow
f^*\mathcal{E} \otimes_{\mathcal{O}_X} \mathcal{I}^\bullet
$$
which is an injective resolution by
Lemma \ref{lemma-injective-tensor-finite-locally-free}.
Apply $f_*$ to see that
$$
Rf_*(f^*\mathcal{E} \otimes_{\mathcal{O}_X} \mathcal{F})
=
f_*(f^*\mathcal{E} \otimes_{\mathcal{O}_X} \mathcal{I}^\bullet).
$$
Hence the lemma follows if we can show that
$f_*(f^*\mathcal{E} \otimes_{\mathcal{O}_X} \mathcal{F}) =
\mathcal{E} \otimes_{\mathcal{O}_Y} f_*(\mathcal{F})$ functorially
in the $\mathcal{O}_X$-module $\mathcal{F}$. This is clear when
$\mathcal{E} = \mathcal{O}_Y^{\oplus n}$, and follows in general
by working locally on $Y$. Details omitted.
\end{proof}






\section{Mayer-Vietoris}
\label{section-mayer-vietoris}

\noindent
Below will construct the {\v C}ech-to-cohomology spectral sequence, see
Lemma \ref{lemma-cech-spectral-sequence}.
A special case of that spectral sequence is the Mayer-Vietoris
long exact sequence. Since it is such a basic, useful and easy to understand
variant of the spectral sequence we treat it here separately.

\begin{lemma}
\label{lemma-injective-restriction-surjective}
Let $X$ be a ringed space.
Let $U' \subset U \subset X$ be open subspaces.
For any injective $\mathcal{O}_X$-module $\mathcal{I}$ the
restriction mapping
$\mathcal{I}(U) \to \mathcal{I}(U')$ is surjective.
\end{lemma}

\begin{proof}
Let $j : U \to X$ and $j' : U' \to X$ be the open immersions.
Recall that $j_!\mathcal{O}_U$ is the extension by zero of
$\mathcal{O}_U = \mathcal{O}_X|_U$, see
Sheaves, Section \ref{sheaves-section-open-immersions}.
Since $j_!$ is a left adjoint to restriction we see that
for any sheaf $\mathcal{F}$ of $\mathcal{O}_X$-modules
$$
\Hom_{\mathcal{O}_X}(j_!\mathcal{O}_U, \mathcal{F})
=
\Hom_{\mathcal{O}_U}(\mathcal{O}_U, \mathcal{F}|_U)
=
\mathcal{F}(U)
$$
see Sheaves, Lemma \ref{sheaves-lemma-j-shriek-modules}.
Similarly, the sheaf $j'_!\mathcal{O}_{U'}$ represents the
functor $\mathcal{F} \mapsto \mathcal{F}(U')$.
Moreover there
is an obvious canonical map of $\mathcal{O}_X$-modules
$$
j'_!\mathcal{O}_{U'} \longrightarrow j_!\mathcal{O}_U
$$
which corresponds to the restriction mapping
$\mathcal{F}(U) \to \mathcal{F}(U')$ via Yoneda's lemma
(Categories, Lemma \ref{categories-lemma-yoneda}). By the description
of the stalks of the sheaves
$j'_!\mathcal{O}_{U'}$, $j_!\mathcal{O}_U$
we see that the displayed map above is injective (see lemma cited above).
Hence if $\mathcal{I}$ is an injective $\mathcal{O}_X$-module,
then the map
$$
\Hom_{\mathcal{O}_X}(j_!\mathcal{O}_U, \mathcal{F})
\longrightarrow
\Hom_{\mathcal{O}_X}(j'_!\mathcal{O}_{U'}, \mathcal{F})
$$
is surjective, see
Homology, Lemma \ref{homology-lemma-characterize-injectives}.
Putting everything together we obtain the lemma.
\end{proof}

\begin{lemma}[Mayer-Vietoris]
\label{lemma-mayer-vietoris}
Let $X$ be a ringed space. Suppose that $X = U \cup V$ is a
union of two open subsets. For every $\mathcal{O}_X$-module $\mathcal{F}$
there exists a long exact cohomology sequence
$$
0 \to
H^0(X, \mathcal{F}) \to
H^0(U, \mathcal{F}) \oplus H^0(V, \mathcal{F}) \to
H^0(U \cap V, \mathcal{F}) \to
H^1(X, \mathcal{F}) \to \ldots
$$
This long exact sequence is functorial in $\mathcal{F}$.
\end{lemma}

\begin{proof}
The sheaf condition says that the kernel of
$(1, -1) : \mathcal{F}(U) \oplus \mathcal{F}(V) \to \mathcal{F}(U \cap V)$
is equal to the image of $\mathcal{F}(X)$ by the first map
for any abelian sheaf $\mathcal{F}$.
Lemma \ref{lemma-injective-restriction-surjective} above implies that the map
$(1, -1) : \mathcal{I}(U) \oplus \mathcal{I}(V) \to \mathcal{I}(U \cap V)$
is surjective whenever $\mathcal{I}$ is an injective $\mathcal{O}_X$-module.
Hence if $\mathcal{F} \to \mathcal{I}^\bullet$ is an injective resolution
of $\mathcal{F}$, then we get a short exact sequence of complexes
$$
0 \to
\mathcal{I}^\bullet(X) \to
\mathcal{I}^\bullet(U) \oplus \mathcal{I}^\bullet(V) \to
\mathcal{I}^\bullet(U \cap V) \to
0.
$$
Taking cohomology gives the result (use
Homology, Lemma \ref{homology-lemma-long-exact-sequence-cochain}).
We omit the proof of the functoriality of the sequence.
\end{proof}

\begin{lemma}[Relative Mayer-Vietoris]
\label{lemma-relative-mayer-vietoris}
Let $f : X \to Y$ be a morphism of ringed spaces.
Suppose that $X = U \cup V$ is a union of two open subsets.
Denote $a = f|_U : U \to Y$, $b = f|_V : V \to Y$, and
$c = f|_{U \cap V} : U \cap V \to Y$.
For every $\mathcal{O}_X$-module $\mathcal{F}$
there exists a long exact sequence
$$
0 \to
f_*\mathcal{F} \to
a_*(\mathcal{F}|_U) \oplus b_*(\mathcal{F}|_V) \to
c_*(\mathcal{F}|_{U \cap V}) \to
R^1f_*\mathcal{F} \to \ldots
$$
This long exact sequence is functorial in $\mathcal{F}$.
\end{lemma}

\begin{proof}
Let $\mathcal{F} \to \mathcal{I}^\bullet$ be an injective resolution
of $\mathcal{F}$. We claim that we
get a short exact sequence of complexes
$$
0 \to
f_*\mathcal{I}^\bullet \to
a_*\mathcal{I}^\bullet|_V \oplus b_*\mathcal{I}^\bullet|_V \to
c_*\mathcal{I}^\bullet|_{U \cap V} \to
0.
$$
Namely, for any open $W \subset Y$, and for any $n \geq 0$ the
corresponding sequence of groups of sections over $W$
$$
0 \to
\mathcal{I}^n(f^{-1}(W)) \to
\mathcal{I}^n(V \cap f^{-1}(W))
\oplus \mathcal{I}^n(V \cap f^{-1}(W)) \to
\mathcal{I}^n(U \cap V \cap f^{-1}(W)) \to
0
$$
was shown to be short exact in the proof of Lemma \ref{lemma-mayer-vietoris}.
The lemma follows by taking cohomology sheaves and using the fact that
$\mathcal{I}^\bullet|_U$ is an injective resolution of $\mathcal{F}|_U$
and similarly for $\mathcal{I}^\bullet|_V$, $\mathcal{I}^\bullet|_{U \cap V}$
see Lemma \ref{lemma-cohomology-of-open}.
\end{proof}




















\section{The {\v C}ech complex and {\v C}ech cohomology}
\label{section-cech}

\noindent
Let $X$ be a topological space.
Let $\mathcal{U} : U = \bigcup_{i \in I} U_i$ be an open covering,
see Topology, Basic notion (\ref{topology-item-covering}).
As is customary we denote
$U_{i_0\ldots i_p} = U_{i_0} \cap \ldots \cap U_{i_p}$ for the
$(p + 1)$-fold intersection of members of $\mathcal{U}$.
Let $\mathcal{F}$ be an abelian presheaf on $X$.
Set
$$
\check{\mathcal{C}}^p(\mathcal{U}, \mathcal{F})
=
\prod\nolimits_{(i_0, \ldots, i_p) \in I^{p + 1}}
\mathcal{F}(U_{i_0\ldots i_p}).
$$
This is an abelian group. For
$s \in \check{\mathcal{C}}^p(\mathcal{U}, \mathcal{F})$ we denote
$s_{i_0\ldots i_p}$ its value in $\mathcal{F}(U_{i_0\ldots i_p})$.
Note that if $s \in \check{\mathcal{C}}^2(\mathcal{U}, \mathcal{F})$
and $i, j \in I$ then $s_{ij}$ and $s_{ji}$ are both elements
of $\mathcal{F}(U_i \cap U_j)$ but there is no imposed
relation between $s_{ij}$ and $s_{ji}$. In other words, we are {\it not}
working with alternating cochains (these will be defined
in Section \ref{section-alternating-cech}). We define
$$
d : \check{\mathcal{C}}^p(\mathcal{U}, \mathcal{F})
\longrightarrow
\check{\mathcal{C}}^{p + 1}(\mathcal{U}, \mathcal{F})
$$
by the formula
\begin{equation}
\label{equation-d-cech}
d(s)_{i_0\ldots i_{p + 1}}
=
\sum\nolimits_{j = 0}^{p + 1}
(-1)^j
s_{i_0\ldots \hat i_j \ldots i_{p + 1}}|_{U_{i_0\ldots i_{p + 1}}}
\end{equation}
It is straightforward to see that $d \circ d = 0$. In other words
$\check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{F})$ is a complex.

\begin{definition}
\label{definition-cech-complex}
Let $X$ be a topological space.
Let $\mathcal{U} : U = \bigcup_{i \in I} U_i$ be an open covering.
Let $\mathcal{F}$ be an abelian presheaf on $X$.
The complex $\check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{F})$
is the {\it {\v C}ech complex} associated to $\mathcal{F}$ and the
open covering $\mathcal{U}$. Its cohomology groups
$H^i(\check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{F}))$ are
called the {\it {\v C}ech cohomology groups} associated to
$\mathcal{F}$ and the covering $\mathcal{U}$.
They are denoted $\check H^i(\mathcal{U}, \mathcal{F})$.
\end{definition}

\begin{lemma}
\label{lemma-cech-h0}
Let $X$ be a topological space.
Let $\mathcal{F}$ be an abelian presheaf on $X$.
The following are equivalent
\begin{enumerate}
\item $\mathcal{F}$ is an abelian sheaf and
\item for every open covering $\mathcal{U} : U = \bigcup_{i \in I} U_i$
the natural map
$$
\mathcal{F}(U) \to \check{H}^0(\mathcal{U}, \mathcal{F})
$$
is bijective.
\end{enumerate}
\end{lemma}

\begin{proof}
This is true since the sheaf condition is exactly that
$\mathcal{F}(U) \to \check{H}^0(\mathcal{U}, \mathcal{F})$
is bijective for every open covering.
\end{proof}






\section{{\v C}ech cohomology as a functor on presheaves}
\label{section-cech-functor}

\noindent
Warning: In this section we work almost exclusively with presheaves and
categories of presheaves and the results are completely wrong in the
setting of sheaves and categories of sheaves!

\medskip\noindent
Let $X$ be a ringed space.
Let $\mathcal{U} : U = \bigcup_{i \in I} U_i$ be an open covering.
Let $\mathcal{F}$ be a presheaf of $\mathcal{O}_X$-modules.
We have the {\v C}ech complex
$\check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{F})$
of $\mathcal{F}$ just by thinking of $\mathcal{F}$
as a presheaf of abelian groups. However, each term
$\check{\mathcal{C}}^p(\mathcal{U}, \mathcal{F})$ has a natural
structure of a $\mathcal{O}_X(U)$-module and the differential is given by
$\mathcal{O}_X(U)$-module maps. Moreover, it is clear that the
construction
$$
\mathcal{F} \longmapsto \check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{F})
$$
is functorial in $\mathcal{F}$. In fact, it is a functor
\begin{equation}
\label{equation-cech-functor}
\check{\mathcal{C}}^\bullet(\mathcal{U}, -) :
\textit{PMod}(\mathcal{O}_X)
\longrightarrow
\text{Comp}^{+}(\text{Mod}(\mathcal{O}_X(U)))
\end{equation}
see
Derived Categories, Definition \ref{derived-definition-complexes-notation}
for notation. Recall that the category of bounded below complexes
in an abelian category is an abelian category, see
Homology, Lemma \ref{homology-lemma-cat-cochain-abelian}.

\begin{lemma}
\label{lemma-cech-exact-presheaves}
The functor given by Equation (\ref{equation-cech-functor})
is an exact functor (see Homology, Lemma \ref{homology-lemma-exact-functor}).
\end{lemma}

\begin{proof}
For any open $W \subset U$ the functor
$\mathcal{F} \mapsto \mathcal{F}(W)$ is an additive exact functor
from $\textit{PMod}(\mathcal{O}_X)$ to $\text{Mod}(\mathcal{O}_X(U))$.
The terms
$\check{\mathcal{C}}^p(\mathcal{U}, \mathcal{F})$
of the complex are products of these exact functors and hence exact.
Moreover a sequence of complexes is exact if and only if the sequence
of terms in a given degree is exact. Hence the lemma follows.
\end{proof}

\begin{lemma}
\label{lemma-cech-cohomology-delta-functor-presheaves}
Let $X$ be a ringed space.
Let $\mathcal{U} : U = \bigcup_{i \in I} U_i$ be an open covering.
The functors $\mathcal{F} \mapsto \check{H}^n(\mathcal{U}, \mathcal{F})$
form a $\delta$-functor from the abelian category of
presheaves of $\mathcal{O}_X$-modules to the category
of $\mathcal{O}_X(U)$-modules (see
Homology, Definition \ref{homology-definition-cohomological-delta-functor}).
\end{lemma}

\begin{proof}
By
Lemma \ref{lemma-cech-exact-presheaves}
a short exact sequence of presheaves of
$\mathcal{O}_X$-modules
$0 \to \mathcal{F}_1 \to \mathcal{F}_2 \to \mathcal{F}_3 \to 0$
is turned into a short exact sequence of complexes of
$\mathcal{O}_X(U)$-modules. Hence we can use
Homology, Lemma \ref{homology-lemma-long-exact-sequence-cochain}
to get the boundary maps
$\delta_{\mathcal{F}_1 \to \mathcal{F}_2 \to \mathcal{F}_3} :
\check{H}^n(\mathcal{U}, \mathcal{F}_3) \to
\check{H}^{n + 1}(\mathcal{U}, \mathcal{F}_1)$
and a corresponding long exact sequence. We omit the verification
that these maps are compatible with maps between short exact
sequences of presheaves.
\end{proof}


\noindent
In the formulation of the following lemma we use the functor $j_{p!}$ of
extension by $0$ for presheaves of modules
relative to an open immersion $j : U \to X$.
See Sheaves, Section \ref{sheaves-section-open-immersions}. For any open
$W \subset X$ and any presheaf $\mathcal{G}$ of $\mathcal{O}_X|_U$-modules
we have
$$
(j_{p!}\mathcal{G})(W) =
\left\{
\begin{matrix}
\mathcal{G}(W) & \text{if } W \subset U \\
0 & \text{else.}
\end{matrix}
\right.
$$
Moreover, the functor $j_{p!}$ is a left adjoint to the restriction functor
see Sheaves, Lemma \ref{sheaves-lemma-j-shriek-modules}.
In particular we have the following formula
$$
\Hom_{\mathcal{O}_X}(j_{p!}\mathcal{O}_U, \mathcal{F})
=
\Hom_{\mathcal{O}_U}(\mathcal{O}_U, \mathcal{F}|_U)
=
\mathcal{F}(U).
$$
Since the functor $\mathcal{F} \mapsto \mathcal{F}(U)$ is an exact functor
on the category of presheaves we conclude that the presheaf
$j_{p!}\mathcal{O}_U$ is a projective object in the category
$\textit{PMod}(\mathcal{O}_X)$, see
Homology, Lemma \ref{homology-lemma-characterize-projectives}.

\medskip\noindent
Note that if we are given open subsets $U \subset V \subset X$
with associated open immersions $j_U, j_V$, then we have a canonical
map $(j_U)_{p!}\mathcal{O}_U \to (j_V)_{p!}\mathcal{O}_V$. It is the
identity on sections over any open $W \subset U$ and $0$ else.
In terms of the identification
$\Hom_{\mathcal{O}_X}((j_U)_{p!}\mathcal{O}_U, (j_V)_{p!}\mathcal{O}_V) =
(j_V)_{p!}\mathcal{O}_V(U) = \mathcal{O}_V(U)$ it corresponds to
the element $1 \in \mathcal{O}_V(U)$.

\begin{lemma}
\label{lemma-cech-map-into}
Let $X$ be a ringed space.
Let $\mathcal{U} : U = \bigcup_{i \in I} U_i$ be a covering.
Denote $j_{i_0\ldots i_p} : U_{i_0 \ldots i_p} \to X$ the open immersion.
Consider the chain complex $K(\mathcal{U})_\bullet$
of presheaves of $\mathcal{O}_X$-modules
$$
\ldots
\to
\bigoplus_{i_0i_1i_2} (j_{i_0i_1i_2})_{p!}\mathcal{O}_{U_{i_0i_1i_2}}
\to
\bigoplus_{i_0i_1} (j_{i_0i_1})_{p!}\mathcal{O}_{U_{i_0i_1}}
\to
\bigoplus_{i_0} (j_{i_0})_{p!}\mathcal{O}_{U_{i_0}}
\to 0 \to \ldots
$$
where the last nonzero term is placed in degree $0$
and where the map
$$
(j_{i_0\ldots i_{p + 1}})_{p!}\mathcal{O}_{U_{i_0\ldots i_{p + 1}}}
\longrightarrow
(j_{i_0\ldots \hat i_j \ldots i_{p + 1}})_{p!}
\mathcal{O}_{U_{i_0\ldots \hat i_j \ldots i_{p + 1}}}
$$
is given by $(-1)^j$ times the canonical map.
Then there is an isomorphism
$$
\Hom_{\mathcal{O}_X}(K(\mathcal{U})_\bullet, \mathcal{F})
=
\check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{F})
$$
functorial in $\mathcal{F} \in \Ob(\textit{PMod}(\mathcal{O}_X))$.
\end{lemma}

\begin{proof}
We saw in the discussion just above the lemma that
$$
\Hom_{\mathcal{O}_X}(
(j_{i_0\ldots i_p})_{p!}\mathcal{O}_{U_{i_0\ldots i_p}},
\mathcal{F})
=
\mathcal{F}(U_{i_0\ldots i_p}).
$$
Hence we see that it is indeed the case that the direct sum
$$
\bigoplus\nolimits_{i_0 \ldots i_p}
(j_{i_0 \ldots i_p})_{p!}\mathcal{O}_{U_{i_0 \ldots i_p}}
$$
represents the functor
$$
\mathcal{F}
\longmapsto
\prod\nolimits_{i_0\ldots i_p} \mathcal{F}(U_{i_0\ldots i_p}).
$$
Hence by Categories, Yoneda Lemma \ref{categories-lemma-yoneda}
we see that there is a complex $K(\mathcal{U})_\bullet$ with terms
as given. It is a simple matter to see that the maps are as given
in the lemma.
\end{proof}

\begin{lemma}
\label{lemma-homology-complex}
Let $X$ be a ringed space.
Let $\mathcal{U} : U = \bigcup_{i \in I} U_i$ be a covering.
Let $\mathcal{O}_\mathcal{U} \subset \mathcal{O}_X$
be the image presheaf of the map
$\bigoplus j_{p!}\mathcal{O}_{U_i} \to \mathcal{O}_X$.
The chain complex $K(\mathcal{U})_\bullet$ of presheaves
of Lemma \ref{lemma-cech-map-into} above has homology presheaves
$$
H_i(K(\mathcal{U})_\bullet) =
\left\{
\begin{matrix}
0 & \text{if} & i \not = 0 \\
\mathcal{O}_\mathcal{U} & \text{if} & i = 0
\end{matrix}
\right.
$$
\end{lemma}

\begin{proof}
Consider the extended complex $K^{ext}_\bullet$ one gets by putting
$\mathcal{O}_\mathcal{U}$ in degree $-1$ with the obvious map
$K(\mathcal{U})_0 =
\bigoplus_{i_0} (j_{i_0})_{p!}\mathcal{O}_{U_{i_0}} \to
\mathcal{O}_\mathcal{U}$.
It suffices to show that taking sections of this extended complex over
any open $W \subset X$ leads to an acyclic complex.
In fact, we claim that for every $W \subset X$ the complex
$K^{ext}_\bullet(W)$ is homotopy equivalent to the zero complex.
Write $I = I_1 \sqcup I_2$ where $W \subset U_i$ if and only
if $i \in I_1$.

\medskip\noindent
If $I_1 = \emptyset$, then the complex $K^{ext}_\bullet(W) = 0$ so there is
nothing to prove.

\medskip\noindent
If $I_1 \not = \emptyset$, then
$\mathcal{O}_\mathcal{U}(W) = \mathcal{O}_X(W)$
and
$$
K^{ext}_p(W) =
\bigoplus\nolimits_{i_0 \ldots i_p \in I_1} \mathcal{O}_X(W).
$$
This is true because of the simple description of the presheaves
$(j_{i_0 \ldots i_p})_{p!}\mathcal{O}_{U_{i_0 \ldots i_p}}$.
Moreover, the differential of the complex $K^{ext}_\bullet(W)$
is given by
$$
d(s)_{i_0 \ldots i_p} =
\sum\nolimits_{j = 0, \ldots, p + 1} \sum\nolimits_{i \in I_1}
(-1)^j s_{i_0 \ldots i_{j - 1} i i_j \ldots i_p}.
$$
The sum is finite as the element $s$ has finite support.
Fix an element $i_{\text{fix}} \in I_1$. Define a map
$$
h : K^{ext}_p(W) \longrightarrow K^{ext}_{p + 1}(W)
$$
by the rule
$$
h(s)_{i_0 \ldots i_{p + 1}} =
\left\{
\begin{matrix}
0 & \text{if} & i_0 \not = i \\
s_{i_1 \ldots i_{p + 1}} & \text{if} & i_0 = i_{\text{fix}}
\end{matrix}
\right.
$$
We will use the shorthand
$h(s)_{i_0 \ldots i_{p + 1}} = (i_0 = i_{\text{fix}}) s_{i_1 \ldots i_p}$
for this. Then we compute
\begin{eqnarray*}
& & (dh + hd)(s)_{i_0 \ldots i_p} \\
& = &
\sum_j \sum_{i \in I_1} (-1)^j h(s)_{i_0 \ldots i_{j - 1} i i_j \ldots i_p}
+
(i = i_0) d(s)_{i_1 \ldots i_p} \\
& = &
s_{i_0 \ldots i_p} +
\sum_{j \geq 1}\sum_{i \in I_1}
(-1)^j (i_0 = i_{\text{fix}}) s_{i_1 \ldots i_{j - 1} i i_j \ldots i_p}
+
(i_0 = i_{\text{fix}}) d(s)_{i_1 \ldots i_p}
\end{eqnarray*}
which is equal to $s_{i_0 \ldots i_p}$ as desired.
\end{proof}

\begin{lemma}
\label{lemma-cech-cohomology-derived-presheaves}
Let $X$ be a ringed space.
Let $\mathcal{U} : U = \bigcup_{i \in I} U_i$
be an open covering of $U \subset X$.
The {\v C}ech cohomology functors $\check{H}^p(\mathcal{U}, -)$
are canonically isomomorphic as a $\delta$-functor to
the right derived functors of the functor
$$
\check{H}^0(\mathcal{U}, -) :
\textit{PMod}(\mathcal{O}_X)
\longrightarrow
\text{Mod}(\mathcal{O}_X(U)).
$$
Moreover, there is a functorial quasi-isomorphism
$$
\check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{F})
\longrightarrow
R\check{H}^0(\mathcal{U}, \mathcal{F})
$$
where the right hand side indicates the right derived functor
$$
R\check{H}^0(\mathcal{U}, -) :
D^{+}(\textit{PMod}(\mathcal{O}_X))
\longrightarrow
D^{+}(\mathcal{O}_X(U))
$$
of the left exact functor $\check{H}^0(\mathcal{U}, -)$.
\end{lemma}

\begin{proof}
Note that the category of presheaves of $\mathcal{O}_X$-modules
has enough injectives, see
Injectives, Proposition \ref{injectives-proposition-presheaves-modules}.
Note that $\check{H}^0(\mathcal{U}, -)$ is a left exact functor
from the category of presheaves of $\mathcal{O}_X$-modules
to the category of $\mathcal{O}_X(U)$-modules.
Hence the derived functor and the right derived fuctor exist, see
Derived Categories, Section \ref{derived-section-right-derived-functor}.

\medskip\noindent
Let $\mathcal{I}$ be a injective presheaf of $\mathcal{O}_X$-modules.
In this case the functor $\Hom_{\mathcal{O}_X}(-, \mathcal{I})$
is exact on $\textit{PMod}(\mathcal{O}_X)$. By
Lemma \ref{lemma-cech-map-into} we have
$$
\Hom_{\mathcal{O}_X}(K(\mathcal{U})_\bullet, \mathcal{I})
=
\check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{I}).
$$
By Lemma \ref{lemma-homology-complex} we have that $K(\mathcal{U})_\bullet$ is
quasi-isomorphic to $\mathcal{O}_\mathcal{U}[0]$. Hence by
the exactness of Hom into $\mathcal{I}$ mentioned above we see
that $\check{H}^i(\mathcal{U}, \mathcal{I}) = 0$ for all
$i > 0$. Thus the $\delta$-functor $(\check{H}^n, \delta)$
(see Lemma \ref{lemma-cech-cohomology-delta-functor-presheaves})
satisfies the assumptions of
Homology, Lemma \ref{homology-lemma-efface-implies-universal},
and hence is a universal $\delta$-functor.

\medskip\noindent
By
Derived Categories, Lemma \ref{derived-lemma-higher-derived-functors}
also the sequence $R^i\check{H}^0(\mathcal{U}, -)$
forms a universal $\delta$-functor. By the uniqueness of universal
$\delta$-functors, see
Homology, Lemma \ref{homology-lemma-uniqueness-universal-delta-functor}
we conclude that
$R^i\check{H}^0(\mathcal{U}, -) = \check{H}^i(\mathcal{U}, -)$.
This is enough for most applications
and the reader is suggested to skip the rest of the proof.

\medskip\noindent
Let $\mathcal{F}$ be any presheaf of $\mathcal{O}_X$-modules.
Choose an injective resolution $\mathcal{F} \to \mathcal{I}^\bullet$
in the category $\textit{PMod}(\mathcal{O}_X)$.
Consider the double complex $A^{\bullet, \bullet}$ with terms
$$
A^{p, q} =
\check{\mathcal{C}}^p(\mathcal{U}, \mathcal{I}^q).
$$
Consider the simple complex $sA^\bullet$ associated to this double
complex. There is a map of complexes
$$
\check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{F})
\longrightarrow
sA^\bullet
$$
coming from the maps
$\check{\mathcal{C}}^p(\mathcal{U}, \mathcal{F})
\to A^{p, 0} = \check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{I}^0)$
and there is a map of complexes
$$
\check{H}^0(\mathcal{U}, \mathcal{I}^\bullet)
\longrightarrow
sA^\bullet
$$
coming from the maps
$\check{H}^0(\mathcal{U}, \mathcal{I}^q) \to
A^{0, q} = \check{\mathcal{C}}^0(\mathcal{U}, \mathcal{I}^q)$.
Both of these maps are quasi-isomorphisms by an application of
Homology, Lemma \ref{homology-lemma-double-complex-gives-resolution}.
Namely, the columns of the double complex are exact in positive degrees
because the {\v C}ech complex as a functor is exact
(Lemma \ref{lemma-cech-exact-presheaves})
and the rows of the double complex are exact in positive degrees
since as we just saw the higher {\v C}ech cohomology groups of the injective
presheaves $\mathcal{I}^q$ are zero.
Since quasi-isomorphisms become invertible
in $D^{+}(\mathcal{O}_X(U))$ this gives the last displayed morphism
of the lemma. We omit the verification that this morphism is
functorial.
\end{proof}





\section{{\v C}ech cohomology and cohomology}
\label{section-cech-cohomology-cohomology}

\begin{lemma}
\label{lemma-injective-trivial-cech}
Let $X$ be a ringed space.
Let $\mathcal{U} : U = \bigcup_{i \in I} U_i$ be a covering.
Let $\mathcal{I}$ be an injective $\mathcal{O}_X$-module.
Then
$$
\check{H}^p(\mathcal{U}, \mathcal{I}) =
\left\{
\begin{matrix}
\mathcal{I}(U) & \text{if} & p = 0 \\
0 & \text{if} & p > 0
\end{matrix}
\right.
$$
\end{lemma}

\begin{proof}
An injective $\mathcal{O}_X$-module is also injective as an object in
the category $\textit{PMod}(\mathcal{O}_X)$ (for example since
sheafification is an exact left adjoint to the inclusion functor,
using Homology, Lemma \ref{homology-lemma-adjoint-preserve-injectives}).
Hence we can apply Lemma \ref{lemma-cech-cohomology-derived-presheaves}
(or its proof) to see the result.
\end{proof}

\begin{lemma}
\label{lemma-cech-cohomology}
Let $X$ be a ringed space.
Let $\mathcal{U} : U = \bigcup_{i \in I} U_i$ be a covering.
There is a transformation
$$
\check{\mathcal{C}}^\bullet(\mathcal{U}, -)
\longrightarrow
R\Gamma(U, -)
$$
of functors
$\textit{Mod}(\mathcal{O}_X) \to D^{+}(\mathcal{O}_X(U))$.
In particular this provides canonical maps
$\check{H}^p(\mathcal{U}, \mathcal{F}) \to H^p(U, \mathcal{F})$ for
$\mathcal{F}$ ranging over $\textit{Mod}(\mathcal{O}_X)$.
\end{lemma}

\begin{proof}
Let $\mathcal{F}$ be an $\mathcal{O}_X$-module. Choose an injective resolution
$\mathcal{F} \to \mathcal{I}^\bullet$. Consider the double complex
$A^{\bullet, \bullet}$ with terms
$A^{p, q} = \check{\mathcal{C}}^p(\mathcal{U}, \mathcal{I}^q)$.
Moreover, consider the associated simple complex
$sA^\bullet$, see
Homology, Definition \ref{homology-definition-associated-simple-complex}.
There is a map of complexes
$$
\alpha :
\Gamma(U, \mathcal{I}^\bullet)
\longrightarrow
sA^\bullet
$$
coming from the maps
$\mathcal{I}^q(U) \to \check{H}^0(\mathcal{U}, \mathcal{I}^q)$
and a map of complexes
$$
\beta :
\check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{F})
\longrightarrow
sA^\bullet
$$
coming from the map $\mathcal{F} \to \mathcal{I}^0$.
We can apply
Homology, Lemma \ref{homology-lemma-double-complex-gives-resolution}
to see that $\alpha$ is a quasi-isomorphism.
Namely, Lemma \ref{lemma-injective-trivial-cech} implies that
the $q$th row of the double complex $A^{\bullet, \bullet}$ is a
resolution of $\Gamma(U, \mathcal{I}^q)$.
Hence $\alpha$ becomes invertible in $D^{+}(\mathcal{O}_X(U))$ and
the transformation of the lemma is the composition of $\beta$
followed by the inverse of $\alpha$. We omit the verification
that this is functorial.
\end{proof}

\begin{lemma}
\label{lemma-include}
Let $X$ be a ringed space.
Consider the functor
$i : \textit{Mod}(\mathcal{O}_X) \to \textit{PMod}(\mathcal{O}_X)$.
It is a left exact functor with right derived functors given by
$$
R^pi(\mathcal{F}) = \underline{H}^p(\mathcal{F}) :
U \longmapsto H^p(U, \mathcal{F})
$$
see discussion in Section \ref{section-locality}.
\end{lemma}

\begin{proof}
It is clear that $i$ is left exact.
Choose an injective resolution $\mathcal{F} \to \mathcal{I}^\bullet$.
By definition $R^pi$ is the $p$th cohomology {\it presheaf}
of the complex $\mathcal{I}^\bullet$. In other words, the
sections of $R^pi(\mathcal{F})$ over an open $U$ are given by
$$
\frac{\text{Ker}(\mathcal{I}^n(U) \to \mathcal{I}^{n + 1}(U))}
{\text{Im}(\mathcal{I}^{n - 1}(U) \to \mathcal{I}^n(U))}.
$$
which is the definition of $H^p(U, \mathcal{F})$.
\end{proof}

\begin{lemma}
\label{lemma-cech-spectral-sequence}
Let $X$ be a ringed space.
Let $\mathcal{U} : U = \bigcup_{i \in I} U_i$ be a covering.
For any sheaf of $\mathcal{O}_X$-modules $\mathcal{F}$ there
is a spectral sequence $(E_r, d_r)_{r \geq 0}$ with
$$
E_2^{p, q} = \check{H}^p(\mathcal{U}, \underline{H}^q(\mathcal{F}))
$$
converging to $H^{p + q}(U, \mathcal{F})$.
This spectral sequence is functorial in $\mathcal{F}$.
\end{lemma}

\begin{proof}
This is a Grothendieck spectral sequence
(see
Derived Categories, Lemma \ref{derived-lemma-grothendieck-spectral-sequence})
for the functors
$$
i :  \textit{Mod}(\mathcal{O}_X) \to \textit{PMod}(\mathcal{O}_X)
\quad\text{and}\quad
\check{H}^0(\mathcal{U}, - ) : \textit{PMod}(\mathcal{O}_X)
\to \text{Mod}(\mathcal{O}_X(U)).
$$
Namely, we have $\check{H}^0(\mathcal{U}, i(\mathcal{F})) = \mathcal{F}(U)$
by Lemma \ref{lemma-cech-h0}. We have that $i(\mathcal{I})$ is
{\v C}ech acyclic by Lemma \ref{lemma-injective-trivial-cech}. And we
have that $\check{H}^p(\mathcal{U}, -) = R^p\check{H}^0(\mathcal{U}, -)$
as functors on $\textit{PMod}(\mathcal{O}_X)$
by Lemma \ref{lemma-cech-cohomology-derived-presheaves}.
Putting everything together gives the lemma.
\end{proof}

\begin{lemma}
\label{lemma-cech-spectral-sequence-application}
Let $X$ be a ringed space.
Let $\mathcal{U} : U = \bigcup_{i \in I} U_i$ be a covering.
Let $\mathcal{F}$ be an $\mathcal{O}_X$-module.
Assume that $H^i(U_{i_0 \ldots i_p}, \mathcal{F}) = 0$
for all $i > 0$, all $p \geq 0$ and all $i_0, \ldots, i_p \in I$.
Then $\check{H}^p(\mathcal{U}, \mathcal{F}) = H^p(U, \mathcal{F})$
as $\mathcal{O}_X(U)$-modules.
\end{lemma}

\begin{proof}
We will use the spectral sequence of
Lemma \ref{lemma-cech-spectral-sequence}.
The assumptions mean that $E_2^{p, q} = 0$ for all $(p, q)$ with
$q \not = 0$. Hence the spectral sequence degenerates at $E_2$
and the result follows.
\end{proof}

\begin{lemma}
\label{lemma-ses-cech-h1}
Let $X$ be a ringed space.
Let
$$
0 \to \mathcal{F} \to \mathcal{G} \to \mathcal{H} \to 0
$$
be a short exact sequence of $\mathcal{O}_X$-modules.
Let $U \subset X$ be an open subset.
If there exists a cofinal system of open coverings $\mathcal{U}$
of $U$ such that $\check{H}^1(\mathcal{U}, \mathcal{F}) = 0$,
then the map $\mathcal{G}(U) \to \mathcal{H}(U)$ is
surjective.
\end{lemma}

\begin{proof}
Take an element $s \in \mathcal{H}(U)$. Choose an open covering
$\mathcal{U} : U = \bigcup_{i \in I} U_i$ such that
(a) $\check{H}^1(\mathcal{U}, \mathcal{F}) = 0$ and (b)
$s|_{U_i}$ is the image of a section $s_i \in \mathcal{G}(U_i)$.
Since we can certainly find a covering such that (b) holds
it follows from the assumptions of the lemma that we can find
a covering such that (a) and (b) both hold.
Consider the sections
$$
s_{i_0i_1} = s_{i_1}|_{U_{i_0i_1}} - s_{i_0}|_{U_{i_0i_1}}.
$$
Since $s_i$ lifts $s$ we see that $s_{i_0i_1} \in \mathcal{F}(U_{i_0i_1})$.
By the vanishing of $\check{H}^1(\mathcal{U}, \mathcal{F})$ we can
find sections $t_i \in \mathcal{F}(U_i)$ such that
$$
s_{i_0i_1} = t_{i_1}|_{U_{i_0i_1}} - t_{i_0}|_{U_{i_0i_1}}.
$$
Then clearly the sections $s_i - t_i$ satsify the sheaf condition
and glue to a section of $\mathcal{G}$ over $U$ which maps to $s$.
Hence we win.
\end{proof}

\begin{lemma}
\label{lemma-cech-vanish}
Let $X$ be a ringed space.
Let $\mathcal{F}$ be an $\mathcal{O}_X$-module such that
$$
\check{H}^p(\mathcal{U}, \mathcal{F}) = 0
$$
for all $p > 0$ and
any open covering $\mathcal{U} : U = \bigcup_{i \in I} U_i$ of $X$.
Then $H^p(U, \mathcal{F}) = 0$ for all $p > 0$
and any open $U \subset X$.
\end{lemma}

\begin{proof}
Let $\mathcal{F}$ be a sheaf satisfying the assumption of the lemma.
We will indicate this by saying ``$\mathcal{F}$ has vanishing higher
{\v C}ech cohomology for any open covering''.
Choose an embedding $\mathcal{F} \to \mathcal{I}$ into an
injective $\mathcal{O}_X$-module.
By Lemma \ref{lemma-injective-trivial-cech} $\mathcal{I}$ has vanishing higher
{\v C}ech cohomology for any open covering.
Let $\mathcal{Q} = \mathcal{I}/\mathcal{F}$
so that we have a short exact sequence
$$
0 \to \mathcal{F} \to \mathcal{I} \to \mathcal{Q} \to 0.
$$
By Lemma \ref{lemma-ses-cech-h1} and our assumptions
this sequence is actually exact as a sequence of presheaves!
In particular we have a long exact sequence of {\v C}ech cohomology
groups for any open covering $\mathcal{U}$, see
Lemma \ref{lemma-cech-cohomology-delta-functor-presheaves}
for example. This implies that $\mathcal{Q}$ is also an $\mathcal{O}_X$-module
with vanishing higher {\v C}ech cohomology for all open coverings.

\medskip\noindent
Next, we look at the long exact cohomology sequence
$$
\xymatrix{
0 \ar[r] &
H^0(U, \mathcal{F}) \ar[r] &
H^0(U, \mathcal{I}) \ar[r] &
H^0(U, \mathcal{Q}) \ar[lld] \\
&
H^1(U, \mathcal{F}) \ar[r] &
H^1(U, \mathcal{I}) \ar[r] &
H^1(U, \mathcal{Q}) \ar[lld] \\
&
\ldots & \ldots & \dots \\
}
$$
for any open $U \subset X$. Since $\mathcal{I}$ is injective we
have $H^n(U, \mathcal{I}) = 0$ for $n > 0$ (see
Derived Categories, Lemma \ref{derived-lemma-higher-derived-functors}).
By the above we see that $H^0(U, \mathcal{I}) \to H^0(U, \mathcal{Q})$
is surjective and hence $H^1(U, \mathcal{F}) = 0$.
Since $\mathcal{F}$ was an arbitrary $\mathcal{O}_X$-module with
vanishing higher {\v C}ech cohomology we conclude that also
$H^1(U, \mathcal{Q}) = 0$ since $\mathcal{Q}$ is another of these
sheaves (see above). By the long exact sequence this in turn implies
that $H^2(U, \mathcal{F}) = 0$. And so on and so forth.
\end{proof}

\begin{lemma}
\label{lemma-cech-vanish-basis}
(Variant of Lemma \ref{lemma-cech-vanish}.)
Let $X$ be a ringed space.
Let $\mathcal{B}$ be a basis for the topology on $X$.
Let $\mathcal{F}$ be an $\mathcal{O}_X$-module.
Assume there exists a set of open coverings $\text{Cov}$
with the following properties:
\begin{enumerate}
\item For every $\mathcal{U} \in \text{Cov}$
with $\mathcal{U} : U = \bigcup_{i \in I} U_i$ we have
$U, U_i \in \mathcal{B}$ and every $U_{i_0 \ldots i_p} \in \mathcal{B}$.
\item For every $U \in \mathcal{B}$ the open coverings of $U$
occuring in $\text{Cov}$ is a cofinal system of open coverings
of $U$.
\item For every $\mathcal{U} \in \text{Cov}$ we have
$\check{H}^p(\mathcal{U}, \mathcal{F}) = 0$ for all $p > 0$.
\end{enumerate}
Then $H^p(U, \mathcal{F}) = 0$ for all $p > 0$ and any $U \in \mathcal{B}$.
\end{lemma}

\begin{proof}
Let $\mathcal{F}$ and $\text{Cov}$ be as in the lemma.
We will indicate this by saying ``$\mathcal{F}$ has vanishing higher
{\v C}ech cohomology for any $\mathcal{U} \in \text{Cov}$''.
Choose an embedding $\mathcal{F} \to \mathcal{I}$ into an
injective $\mathcal{O}_X$-module.
By Lemma \ref{lemma-injective-trivial-cech} $\mathcal{I}$
has vanishing higher {\v C}ech cohomology for any $\mathcal{U} \in \text{Cov}$.
Let $\mathcal{Q} = \mathcal{I}/\mathcal{F}$
so that we have a short exact sequence
$$
0 \to \mathcal{F} \to \mathcal{I} \to \mathcal{Q} \to 0.
$$
By Lemma \ref{lemma-ses-cech-h1} and our assumption (2)
this sequence gives rise to an exact sequence
$$
0 \to \mathcal{F}(U) \to \mathcal{I}(U) \to \mathcal{Q}(U) \to 0.
$$
for every $U \in \mathcal{B}$. Hence for any $\mathcal{U} \in \text{Cov}$
we get a short exact sequence of {\v C}ech complexes
$$
0 \to
\check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{F}) \to
\check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{I}) \to
\check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{Q}) \to 0
$$
since each term in the {\v C}ech complex is made up out of a product of
values over elements of $\mathcal{B}$ by assumption (1).
In particular we have a long exact sequence of {\v C}ech cohomology
groups for any open covering $\mathcal{U} \in \text{Cov}$.
This implies that $\mathcal{Q}$ is also an $\mathcal{O}_X$-module
with vanishing higher {\v C}ech cohomology for all
$\mathcal{U} \in \text{Cov}$.

\medskip\noindent
Next, we look at the long exact cohomology sequence
$$
\xymatrix{
0 \ar[r] &
H^0(U, \mathcal{F}) \ar[r] &
H^0(U, \mathcal{I}) \ar[r] &
H^0(U, \mathcal{Q}) \ar[lld] \\
&
H^1(U, \mathcal{F}) \ar[r] &
H^1(U, \mathcal{I}) \ar[r] &
H^1(U, \mathcal{Q}) \ar[lld] \\
&
\ldots & \ldots & \dots \\
}
$$
for any $U \in \mathcal{B}$. Since $\mathcal{I}$ is injective we
have $H^n(U, \mathcal{I}) = 0$ for $n > 0$ (see
Derived Categories, Lemma \ref{derived-lemma-higher-derived-functors}).
By the above we see that $H^0(U, \mathcal{I}) \to H^0(U, \mathcal{Q})$
is surjective and hence $H^1(U, \mathcal{F}) = 0$.
Since $\mathcal{F}$ was an arbitrary $\mathcal{O}_X$-module with
vanishing higher {\v C}ech cohomology for all $\mathcal{U} \in \text{Cov}$
we conclude that also $H^1(U, \mathcal{Q}) = 0$ since $\mathcal{Q}$ is
another of these sheaves (see above). By the long exact sequence this in
turn implies that $H^2(U, \mathcal{F}) = 0$. And so on and so forth.
\end{proof}

\begin{lemma}
\label{lemma-pushforward-injective}
Let $f : X \to Y$ be a morphism of ringed spaces.
Let $\mathcal{I}$ be an injective $\mathcal{O}_X$-module.
Then
\begin{enumerate}
\item $\check{H}^p(\mathcal{V}, f_*\mathcal{I}) = 0$
for all $p > 0$ and any open covering
$\mathcal{V} : V = \bigcup_{j \in J} V_j$ of $Y$.
\item $H^p(V, f_*\mathcal{I}) = 0$ for all $p > 0$ and
every open $V \subset Y$.
\end{enumerate}
In other words, $f_*\mathcal{I}$ is right acyclic for $\Gamma(U, -)$
(see
Derived Categories, Definition \ref{derived-definition-derived-functor})
for any $U \subset X$ open.
\end{lemma}

\begin{proof}
Set $\mathcal{U} : f^{-1}(V) = \bigcup_{j \in J} f^{-1}(V_j)$.
It is an open covering of $X$ and
$$
\check{\mathcal{C}}^\bullet(\mathcal{V}, f_*\mathcal{I}) =
\check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{I}).
$$
This is true because
$$
f_*\mathcal{I}(V_{j_0 \ldots j_p})
= \mathcal{I}(f^{-1}(V_{j_0 \ldots j_p})) =
\mathcal{I}(f^{-1}(V_{j_0}) \cap \ldots \cap f^{-1}(V_{j_p}))
= \mathcal{I}(U_{j_0 \ldots j_p}).
$$
Thus the first statement of the lemma follows from
Lemma \ref{lemma-injective-trivial-cech}. The second statement
follows from the first and Lemma \ref{lemma-cech-vanish}.
\end{proof}

\noindent
The following lemma implies in particular that
$f_* : \textit{Ab}(X) \to \textit{Ab}(Y)$ transforms injective
abelian sheaves into injective abelian sheaves.

\begin{lemma}
\label{lemma-pushforward-injective-flat}
Let $f : X \to Y$ be a morphism of ringed spaces.
Assume $f$ is flat.
Then $f_*\mathcal{I}$ is an injective $\mathcal{O}_Y$-module
for any injective $\mathcal{O}_X$-module $\mathcal{I}$.
\end{lemma}

\begin{proof}
In this case the functor $f^*$ transforms injections into injections.
Hence the result follows from
Modules, Lemma \ref{modules-lemma-pullback-flat} and
Homology, Lemma \ref{homology-lemma-adjoint-preserve-injectives}
\end{proof}













\section{The Leray spectral sequence}
\label{section-Leray}

\begin{lemma}
\label{lemma-before-Leray}
Let $f : X \to Y$ be a morphism of ringed spaces.
There is a commutative diagram
$$
\xymatrix{
D^{+}(X) \ar[rr]_-{R\Gamma(X, -)} \ar[d]_{Rf_*} & &
D^{+}(\mathcal{O}_X(X)) \ar[d]^{\text{restriction}} \\
D^{+}(Y) \ar[rr]^-{R\Gamma(Y, -)} & &
D^{+}(\mathcal{O}_Y(Y))
}
$$
More generally for any $V \subset Y$ open and $U = f^{-1}(V)$ there
is a commutative diagram
$$
\xymatrix{
D^{+}(X) \ar[rr]_-{R\Gamma(U, -)} \ar[d]_{Rf_*} & &
D^{+}(\mathcal{O}_X(U)) \ar[d]^{\text{restriction}} \\
D^{+}(Y) \ar[rr]^-{R\Gamma(V, -)} & &
D^{+}(\mathcal{O}_Y(V))
}
$$
See also Remark \ref{remark-elucidate-lemma} for more explanation.
\end{lemma}

\begin{proof}
Let
$\Gamma_{res} : \textit{Mod}(\mathcal{O}_X) \to \text{Mod}(\mathcal{O}_Y(Y))$
be the functor which associates to an $\mathcal{O}_X$-module $\mathcal{F}$
the global sections of $\mathcal{F}$ viewed as a $\mathcal{O}_Y(Y)$-module
via the map $f^\sharp : \mathcal{O}_Y(Y) \to \mathcal{O}_X(X)$. Let
$restriction : \text{Mod}(\mathcal{O}_X(X)) \to \text{Mod}(\mathcal{O}_Y(Y))$
be the restriction functor induced by
$f^\sharp : \mathcal{O}_Y(Y) \to \mathcal{O}_X(X)$. Note that $restriction$
is exact so that
its right derived functor is computed by simply applying the restriction
functor, see
Derived Categories, Lemma \ref{derived-lemma-right-derived-exact-functor}.
It is clear that
$$
\Gamma_{res}
=
restriction \circ \Gamma(X, -)
=
\Gamma(Y, -) \circ f_*
$$
We claim that
Derived Categories, Lemma \ref{derived-lemma-compose-derived-functors}
applies to both compositions. For the first this is clear by our remarks
above. For the second, it follows from
Lemma \ref{lemma-pushforward-injective} which implies that
injective $\mathcal{O}_X$-modules are mapped to $\Gamma(Y, -)$-acyclic
sheaves on $Y$.
\end{proof}

\begin{remark}
\label{remark-elucidate-lemma}
Here is a down-to-earth explanation of the meaning of
Lemma \ref{lemma-before-Leray}. It says that given
$f : X \to Y$ and $\mathcal{F} \in \textit{Mod}(\mathcal{O}_X)$
and given an injective resolution $\mathcal{F} \to \mathcal{I}^\bullet$
we have
$$
\begin{matrix}
R\Gamma(X, \mathcal{F}) & \text{is represented by} &
\Gamma(X, \mathcal{I}^\bullet) \\
Rf_*\mathcal{F} & \text{is represented by} & f_*\mathcal{I}^\bullet \\
R\Gamma(Y, Rf_*\mathcal{F}) & \text{is represented by} &
\Gamma(Y, f_*\mathcal{I}^\bullet)
\end{matrix}
$$
the last fact coming from Leray's acyclicity lemma
(Derived Categories, Lemma \ref{derived-lemma-leray-acyclicity})
and Lemma \ref{lemma-pushforward-injective}.
Finally, it combines this with the trivial observation that
$$
\Gamma(X, \mathcal{I}^\bullet)
=
\Gamma(Y, f_*\mathcal{I}^\bullet).
$$
to arrive at the commutativity of the diagram of the lemma.
\end{remark}

\begin{lemma}
\label{lemma-modules-abelian}
Let $X$ be a ringed space.
Let $\mathcal{F}$ be an $\mathcal{O}_X$-module.
\begin{enumerate}
\item The cohomology groups $H^i(U, \mathcal{F})$ for $U \subset X$ open
of $\mathcal{F}$ computed as an $\mathcal{O}_X$-module, or computed as an
abelian sheaf are identical.
\item Let $f : X \to Y$ be a morphism of ringed spaces.
The higher direct images $R^if_*\mathcal{F}$ of $\mathcal{F}$
computed as an $\mathcal{O}_X$-module, or computed as an abelian sheaf
are identical.
\end{enumerate}
There are similar statements in the case of bounded below
complexes of $\mathcal{O}_X$-modules.
\end{lemma}

\begin{proof}
Consider the morphism of ringed spaces
$(X, \mathcal{O}_X) \to (X, \underline{\mathbf{Z}}_X)$ given
by the identity on the underlying topological space and by
the unique map of sheaves of rings
$\underline{\mathbf{Z}}_X \to \mathcal{O}_X$.
Let $\mathcal{F}$ be an $\mathcal{O}_X$-module.
Denote $\mathcal{F}_{ab}$ the same sheaf seens as an
$\underline{\mathbf{Z}}_X$-module, i.e., seens as a sheaf of
abelian groups. Let
$\mathcal{F} \to \mathcal{I}^\bullet$ be an injective resolution.
By Remark \ref{remark-elucidate-lemma} we see that
$\Gamma(X, \mathcal{I}^\bullet)$ computes both
$R\Gamma(X, \mathcal{F})$ and $R\Gamma(X, \mathcal{F}_{ab})$.
This proves (1).

\medskip\noindent
To prove (2) we use (1) and Lemma \ref{lemma-describe-higher-direct-images}.
The result follows immediately.
\end{proof}

\begin{lemma}[Leray spectral sequence]
\label{lemma-Leray}
Let $f : X \to Y$ be a morphism of ringed spaces.
Let $\mathcal{F}^\bullet$ be
a bounded below complex of $\mathcal{O}_X$-modules.
There is a spectral sequence
$$
E_2^{p, q} = H^p(Y, R^qf_*(\mathcal{F}^\bullet))
$$
converging to $H^{p + q}(X, \mathcal{F}^\bullet)$.
\end{lemma}

\begin{proof}
This is just the Grothendieck spectral sequence
Derived Categories, Lemma \ref{derived-lemma-grothendieck-spectral-sequence}
coming from the composition of functors
$\Gamma_{res} = \Gamma(Y, -) \circ f_*$ where $\Gamma_{res}$ is as
in the proof of Lemma \ref{lemma-before-Leray}.
To see that the assumptions of
Derived Categories, Lemma \ref{derived-lemma-grothendieck-spectral-sequence}
are satisfied, see the proof of Lemma \ref{lemma-before-Leray} or
Remark \ref{remark-elucidate-lemma}.
\end{proof}

\begin{remark}
\label{remark-Leray-ss-more-structure}
The Leray spectral sequence, the way we proved it in Lemma \ref{lemma-Leray}
is a spectral sequence of $\Gamma(Y, \mathcal{O}_Y)$-modules. However, it
is quite easy to see that it is in fact a spectral sequence of
$\Gamma(X, \mathcal{O}_X)$-modules. For example $f$ gives rise to
a morphism of ringed spaces
$f' :  (X, \mathcal{O}_X) \to (Y, f_*\mathcal{O}_X)$.
By Lemma \ref{lemma-modules-abelian} the terms $E_r^{p, q}$ of the
Leray spectral sequence for an $\mathcal{O}_X$-module $\mathcal{F}$
and $f$ are identical with those for $\mathcal{F}$ and $f'$
at least for $r \geq 2$. Namely, they both agree with the terms of the Leray
spectral sequence for $\mathcal{F}$ as an abelian sheaf.
And since $(f_*\mathcal{O}_X)(Y) = \mathcal{O}_X(X)$ we see the result.
It is often the case
that the Leray spectral sequence carries additional structure.
\end{remark}

\begin{lemma}
\label{lemma-apply-Leray}
Let $f : X \to Y$ be a morphism of ringed spaces.
Let $\mathcal{F}$ be an $\mathcal{O}_X$-module.
\begin{enumerate}
\item If $R^qf_*\mathcal{F} = 0$ for $q > 0$, then
$H^p(X, \mathcal{F}) = H^p(Y, f_*\mathcal{F})$ for all $p$.
\item If $H^p(Y, R^qf_*\mathcal{F}) = 0$ for all $q$ and $p > 0$, then
$H^q(X, \mathcal{F}) = H^0(Y, R^qf_*\mathcal{F})$ for all $q$.
\end{enumerate}
\end{lemma}

\begin{proof}
These are two simple conditions that force the Leray spectral sequence to
converge. You can also prove these facts directly (without using the
spectral sequence) which is a good exercise in cohomology of sheaves.
\end{proof}

\begin{lemma}
\label{lemma-higher-direct-images-compose}
Let $f : X \to Y$ and $g : Y \to Z$ be morphisms of ringed spaces.
In this case $Rg_* \circ Rf_* = R(g \circ f)_*$ as functors
from $D^{+}(X) \to D^{+}(Z)$.
\end{lemma}

\begin{proof}
We are going to apply
Derived Categories, Lemma \ref{derived-lemma-compose-derived-functors}.
It is clear that $g_* \circ f_* = (g \circ f)_*$, see
Sheaves, Lemma \ref{sheaves-lemma-pushforward-composition}.
It remains to show that $f_*\mathcal{I}$ is $g_*$-acyclic.
This follows from Lemma \ref{lemma-pushforward-injective}
and the description of the
higher direct images $R^ig_*$ in
Lemma \ref{lemma-describe-higher-direct-images}.
\end{proof}

\begin{lemma}[Relative Leray spectral sequence]
\label{lemma-relative-Leray}
Let $f : X \to Y$ and $g : Y \to Z$ be morphisms of ringed spaces.
Let $\mathcal{F}$ be an $\mathcal{O}_X$-module.
There is a spectral sequence with
$$
E_2^{p, q} = R^pg_*(R^qf_*\mathcal{F})
$$
converging to $R^{p + q}(g \circ f)_*\mathcal{F}$.
This spectral sequence is functorial in $\mathcal{F}$, and there
is a version for bounded below complexes of $\mathcal{O}_X$-modules.
\end{lemma}

\begin{proof}
This is a Grothendieck spectral sequence for composition of functors
and follows from Lemma \ref{lemma-higher-direct-images-compose} and
Derived Categories, Lemma \ref{derived-lemma-grothendieck-spectral-sequence}.
\end{proof}














\section{Functoriality of cohomology}
\label{section-functoriality}

\begin{lemma}
\label{lemma-functoriality}
Let $f : X \to Y$ be a morphism of ringed spaces.
Let $\mathcal{G}^\bullet$, resp.\ $\mathcal{F}^\bullet$ be
a bounded below complex of $\mathcal{O}_Y$-modules,
resp.\ $\mathcal{O}_X$-modules. Let
$\varphi : \mathcal{G}^\bullet \to f_*\mathcal{F}^\bullet$
be a morphism of complexes. There is a canonical morphism
$$
\mathcal{G}^\bullet
\longrightarrow
Rf_*(\mathcal{F}^\bullet)
$$
in $D^{+}(Y)$. Moreover this construction is functorial in the triple
$(\mathcal{G}^\bullet, \mathcal{F}^\bullet, \varphi)$.
\end{lemma}

\begin{proof}
Choose an injective resolution $\mathcal{F}^\bullet \to \mathcal{I}^\bullet$.
By definition $Rf_*(\mathcal{F}^\bullet)$ is represented by
$f_*\mathcal{I}^\bullet$ in $K^{+}(\mathcal{O}_Y)$.
The composition
$$
\mathcal{G}^\bullet \to f_*\mathcal{F}^\bullet \to f_*\mathcal{I}^\bullet
$$
is a morphism in $K^{+}(Y)$ which turns
into the morphism of the lemma upon applying the
localization functor $j_Y : K^{+}(Y) \to D^{+}(Y)$.
\end{proof}

\noindent
Let $f : X \to Y$ be a morphism of ringed spaces.
Let $\mathcal{G}$ be an $\mathcal{O}_Y$-module and let
$\mathcal{F}$ be an $\mathcal{O}_X$-module. Recall that an
$f$-map $\varphi$ from $\mathcal{G}$ to $\mathcal{F}$ is a map
$\varphi : \mathcal{G} \to f_*\mathcal{F}$, or what is the same
thing, a map $\varphi : f^*\mathcal{G} \to \mathcal{F}$.
See Sheaves, Definition \ref{sheaves-definition-f-map}.
Such an $f$-map gives rise to a morphism of complexes
\begin{equation}
\label{equation-functorial-derived}
\varphi :
R\Gamma(Y, \mathcal{G})
\longrightarrow
R\Gamma(X, \mathcal{F})
\end{equation}
in $D^{+}(\mathcal{O}_Y(Y))$. Namely, we use the morphism
$\mathcal{G} \to Rf_*\mathcal{F}$ in $D^{+}(Y)$ of
Lemma \ref{lemma-functoriality}, and we apply $R\Gamma(Y, -)$.
By Lemma \ref{lemma-before-Leray} we see that
$R\Gamma(X, \mathcal{F}) = R\Gamma(Y, Rf_*\mathcal{F})$
and we get the displayed arrow. We spell this out completely in
Remark \ref{remark-explain-arrow} below.
In particular it gives
rise to maps on cohomology
\begin{equation}
\label{equation-functorial}
\varphi : H^i(Y, \mathcal{G}) \longrightarrow H^i(X, \mathcal{F}).
\end{equation}

\begin{remark}
\label{remark-explain-arrow}
Let $f : X \to Y$ be a morphism of ringed spaces.
Let $\mathcal{G}$ be an $\mathcal{O}_Y$-module.
Let $\mathcal{F}$ be an $\mathcal{O}_X$-module.
Let $\varphi$ be an $f$-map from $\mathcal{G}$ to $\mathcal{F}$.
Choose a resolution $\mathcal{F} \to \mathcal{I}^\bullet$
by a complex of injective $\mathcal{O}_X$-modules.
Choose resolutions $\mathcal{G} \to J^\bullet$ and
$f_*\mathcal{I} \to (\mathcal{J}')^\bullet$ by complexes
of injective $\mathcal{O}_Y$-modules. By
Derived Categories, Lemma \ref{derived-lemma-morphisms-lift}
there exists a map of complexes
$\beta$ such that the diagram
\begin{equation}
\label{equation-choice}
\xymatrix{
\mathcal{G} \ar[d] \ar[r] &
f_*\mathcal{F} \ar[r] &
f_*\mathcal{I}^\bullet \ar[d] \\
\mathcal{J}^\bullet \ar[rr]^\beta & &
(\mathcal{J}')^\bullet
}
\end{equation}
commutes. Applying global section functors we see
that we get a diagram
$$
\xymatrix{
 & & \Gamma(Y, f_*\mathcal{I}^\bullet) \ar[d]_{qis} \ar@{=}[r] &
\Gamma(X, \mathcal{I}^\bullet) \\
\Gamma(Y, \mathcal{J}^\bullet) \ar[rr]^\beta & &
\Gamma(Y, (\mathcal{J}')^\bullet) &
}
$$
The complex on the bottom left represents $R\Gamma(Y, \mathcal{G})$
and the complex on the top right represents $R\Gamma(X, \mathcal{F})$.
The vertical arrow is a quasi-isomorphism by
Lemma \ref{lemma-before-Leray} which becomes invertible after
applying the localization functor
$K^{+}(\mathcal{O}_Y(Y)) \to D^{+}(\mathcal{O}_Y(Y))$.
The arrow (\ref{equation-functorial-derived}) is given by the
composition of the horizontal map by the inverse of the vertical map.
\end{remark}

\begin{lemma}
\label{lemma-functoriality-cech}
Let $f : X \to Y$ be a morphism of ringed spaces.
Let $\mathcal{F}$ be an $\mathcal{O}_X$-module.
Let $\mathcal{G}$ be an $\mathcal{O}_Y$-module.
Let $\varphi : f^*\mathcal{G} \to \mathcal{F}$ be an $f$-map.
Let $\mathcal{U} : X = \bigcup_{i \in I} U_i$ be an open covering.
Let $\mathcal{V} : Y = \bigcup_{j \in J} V_j$ be an open covering.
Assume that $\mathcal{U}$ is a refinement of
$f^{-1}\mathcal{V} : X = \bigcup_{j \in J} f^{-1}(V_j)$.
In this case there exists a commutative diagram
$$
\xymatrix{
\check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{F}) \ar[r] &
R\Gamma(X, \mathcal{F}) \\
\check{\mathcal{C}}^\bullet(\mathcal{V}, \mathcal{G}) \ar[r]
\ar[u]^\gamma &
R\Gamma(Y, \mathcal{G}) \ar[u]
}
$$
in $D^{+}(\mathcal{O}_X(X))$ where the
horizontal arrows come from Lemma \ref{lemma-cech-cohomology}
and the right vertical arrow is Equation (\ref{equation-functorial-derived}).
In particular we get commutative diagrams of cohomology groups
$$
\xymatrix{
\check{H}^p(\mathcal{U}, \mathcal{F}) \ar[r] &
H^p(X, \mathcal{F}) \\
\check{H}^p(\mathcal{V}, \mathcal{G}) \ar[r]
\ar[u]^\gamma &
H^p(Y, \mathcal{G}) \ar[u]
}
$$
where the right vertical arrow is (\ref{equation-functorial})
\end{lemma}

\begin{proof}
We first define the left vertical arrow. Namely, choose a map
$c : I \to J$ such that $U_i \subset f^{-1}(V_{c(i)})$ for all
$i \in I$. In degree $p$ we define the map by the rule
$$
\gamma(s)_{i_0 \ldots i_p} = \varphi(s)_{c(i_0) \ldots c(i_p)}
$$
This makes sense because $\varphi$ does indeed induce maps
$\mathcal{G}(V_{c(i_0) \ldots c(i_p)}) \to \mathcal{F}(U_{i_0 \ldots i_p})$
by assumption. It is also clear that this defines a morphism of complexes.
Choose injective resolutions
$\mathcal{F} \to \mathcal{I}^\bullet$ on $X$ and
$\mathcal{G} \to J^\bullet$ on $Y$. According to
the proof of Lemma \ref{lemma-cech-cohomology} we introduce the double
complexes $A^{\bullet, \bullet}$ and $B^{\bullet, \bullet}$
with terms
$$
B^{p, q} = \check{\mathcal{C}}^p(\mathcal{V}, \mathcal{J}^q)
\quad
\text{and}
\quad
A^{p, q} = \check{\mathcal{C}}^p(\mathcal{U}, \mathcal{I}^q).
$$
As in Remark \ref{remark-explain-arrow} above we also choose an
injective resolution
$f_*\mathcal{I} \to (\mathcal{J}')^\bullet$ on $Y$ and a morphism
of complexes $\beta : \mathcal{J} \to (\mathcal{J}')^\bullet$
making (\ref{equation-choice}) commutes. We introduce some more
double complexes, namely $(B')^{\bullet, \bullet}$ and
$(B''){\bullet, \bullet}$ with
$$
(B')^{p, q} = \check{\mathcal{C}}^p(\mathcal{V}, (\mathcal{J}')^q)
\quad
\text{and}
\quad
(B'')^{p, q} = \check{\mathcal{C}}^p(\mathcal{V}, f_*\mathcal{I}^q).
$$
Note that there is an $f$-map of complexes from
$f_*\mathcal{I}^\bullet$ to $\mathcal{I}^\bullet$. Hence
it is clear that the same rule as above defines a morphism
of double complexes
$$
\gamma : (B'')^{\bullet, \bullet} \longrightarrow A^{\bullet, \bullet}.
$$
Consider the diagram of complexes
$$
\xymatrix{
\check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{F})
\ar[r] &
sA^\bullet & & &
\Gamma(X, \mathcal{I}^\bullet) \ar[lll]^{qis}
\ar@{=}[ddl]\\
\check{\mathcal{C}}^\bullet(\mathcal{V}, \mathcal{G})
\ar[r] \ar[u]^\gamma &
sB^\bullet \ar[r]^\beta &
s(B')^\bullet &
s(B'')^\bullet \ar[l] \ar[llu]_{s\gamma} \\
& \Gamma(Y, \mathcal{J}^\bullet) \ar[u]^{qis} \ar[r]^\beta &
\Gamma(Y, (\mathcal{J}')^\bullet) \ar[u] &
\Gamma(Y, f_*\mathcal{I}^\bullet) \ar[u] \ar[l]_{qis}
}
$$
The two horizontal arrows with targets $sA^\bullet$ and
$sB^\bullet$ are the ones explained in Lemma \ref{lemma-cech-cohomology}.
The left upper shape (a pentagon) is commutative simply
because (\ref{equation-choice}) is commutative.
The two lower squares are trivially commutative.
It is also immediate from the definitions that the
right upper shape (a square) is commutative.
The result of the lemma now follows from the definitions
and the fact that going around the diagram on the outer sides
from $\check{\mathcal{C}}^\bullet(\mathcal{V}, \mathcal{G})$
to $\Gamma(X, \mathcal{I}^\bullet)$ either on top or on bottom
is the same (where you have to invert any quasi-isomorphisms along the way).
\end{proof}






\section{The base change map}
\label{section-base-change-map}

\noindent
We will need to know how to construct the base change map in some cases.
Since we have not yet discussed derived pullback we only discuss
this in the case of a base change by a flat morphism of ringed spaces.
Before we state the result, let us discuss flat pullback on the derived
category. Namely, suppose that $g : X \to Y$ is a flat morphism of
ringed spaces. By Modules, Lemma \ref{modules-lemma-pullback-flat}
the functor $g^* : \textit{Mod}(\mathcal{O}_Y) \to
\textit{Mod}(\mathcal{O}_X)$ is exact. Hence it has a derived functor
$$
g^* : D^{+}(Y) \to D^{+}(X)
$$
which is computed by simply pulling back an representative of a given
object in $D^{+}(Y)$, see
Derived Categories, Lemma \ref{derived-lemma-right-derived-exact-functor}.
Hence as indicated we indicate this functor by $g^*$ rather than
$Lg^*$.

\begin{lemma}
\label{lemma-base-change-map-flat-case}
Let
$$
\xymatrix{
X' \ar[r]_{g'} \ar[d]_{f'} &
X \ar[d]^f \\
S' \ar[r]^g &
S
}
$$
be a commutative diagram of ringed spaces.
Let $\mathcal{F}^\bullet$ be a bounded below complex of
$\mathcal{O}_X$-modules.
Assume both $g$ and $g'$ are flat.
Then there exists a canonical base change map
$$
g^*Rf_*\mathcal{F}^\bullet
\longrightarrow
R(f')_*(g')^*\mathcal{F}^\bullet
$$
in $D^{+}(S')$.
\end{lemma}

\begin{proof}
Choose injective resolutions $\mathcal{F}^\bullet \to \mathcal{I}^\bullet$
and $(g')^*\mathcal{F}^\bullet \to \mathcal{J}^\bullet$.
By Lemma \ref{lemma-pushforward-injective-flat} we see that
$(g')_*\mathcal{J}^\bullet$ is a complex of injectives representing
$R(g')_*(g')^*\mathcal{F}^\bullet$. Hence by
Derived Categories, Lemmas \ref{derived-lemma-morphisms-lift}
and \ref{derived-lemma-morphisms-equal-up-to-homotopy}
the arrow $\beta$ in the diagram
$$
\xymatrix{
(g')_*(g')^*\mathcal{F}^\bullet \ar[r] &
(g')_*\mathcal{J}^\bullet \\
\mathcal{F}^\bullet \ar[u]^{adjunction} \ar[r] &
\mathcal{I}^\bullet \ar[u]_\beta
}
$$
exists and is unique up to homotopy.
Pushing down to $S$ we get
$$
f_*\beta :
f_*\mathcal{I}^\bullet
\longrightarrow
f_*(g')_*\mathcal{J}^\bullet
=
g_*(f')_*\mathcal{J}^\bullet
$$
By adjunction of $g^*$ and $g_*$ we get a map of complexes
$g^*f_*\mathcal{I}^\bullet \to (f')_*\mathcal{J}^\bullet$.
Note that this map is unique up to homotopy since the only
choice in the whole process was the choice of the map $\beta$
and everything was done on the level of complexes.
\end{proof}

\begin{remark}
\label{remark-correct-version-base-change-map}
The ``correct'' version of the base change map is map
$$
Lg^* Rf_* \mathcal{F}^\bullet
\longrightarrow
R(f')_* L(g')^*\mathcal{F}^\bullet.
$$
The construction of this map really involves dealing with
unbounded complexes and having adjoint functors $Lj^*$, $Rj_*$
on unbounded complexes. We will deal with this later
(insert future reference here).
\end{remark}



\section{Cohomology and colimits}
\label{section-limits}

\noindent
Let $X$ be a ringed space. Let $(\mathcal{F}_i, \varphi_{ii'})$
be a directed system of sheaves of $\mathcal{O}_X$-modules
over the partially ordered set $I$, see
Categories, Section \ref{categories-section-posets-limits}.
Since for each $i$ there is a canonical map
$\mathcal{F}_i \to \colim_i \mathcal{F}_i$ we get a
canonical map
$$
\colim_i H^p(X, \mathcal{F}_i)
\longrightarrow
H^p(X, \colim_i \mathcal{F}_i)
$$
for every $p \geq 0$. Of course there is a similar map for
every open $U \subset X$. These maps are in general not isomorphisms,
even for $p = 0$. In this section we generalize the results of
Sheaves, Lemma \ref{sheaves-lemma-directed-colimits-sections}.
See also
Modules, Lemma \ref{modules-lemma-finite-presentation-quasi-compact-colimit}
(in the special case $\mathcal{G} = \mathcal{O}_X$).

\begin{lemma}
\label{lemma-quasi-separated-cohomology-colimit}
Let $X$ be a ringed space. Assume that the underlying topological space
of $X$ has the following properties:
\begin{enumerate}
\item there exists a basis of quasi-compact open subsets, and
\item the intersection of any two quasi-compact opens is quasi-compact.
\end{enumerate}
Then for any directed system $(\mathcal{F}_i, \varphi_{ii'})$
of sheaves of $\mathcal{O}_X$-modules and for any quasi-compact open
$U \subset X$ the canonical map
$$
\colim_i H^q(U, \mathcal{F}_i)
\longrightarrow
H^q(U, \colim_i \mathcal{F}_i)
$$
is an isomorphism for every $q \geq 0$.
\end{lemma}

\begin{proof}
It is important in this proof to argue for all quasi-compact opens
$U \subset X$ at the same time.
The result is true for $i = 0$ and any quasi-compact open $U \subset X$ by
Sheaves, Lemma \ref{sheaves-lemma-directed-colimits-sections}
(combined with
Topology, Lemma \ref{topology-lemma-topology-quasi-separated-scheme}).
Assume that we have proved the result for all $q \leq q_0$ and let
us prove the result for $q = q_0 + 1$.

\medskip\noindent
By our conventions on directed systems the index set $I$ is directed,
and any system of $\mathcal{O}_X$-modules $(\mathcal{F}_i, \varphi_{ii'})$
over $I$ is directed.
By Injectives, Lemma \ref{injectives-lemma-sheaves-modules-space} the category
of $\mathcal{O}_X$-modules has functorial injective embeddings.
Thus for any system $(\mathcal{F}_i, \varphi_{ii'})$ there exists a
system $(\mathcal{I}_i, \varphi_{ii'})$ with each $\mathcal{I}_i$ an
injective $\mathcal{O}_X$-module and a morphism of systems given
by injective $\mathcal{O}_X$-module maps
$\mathcal{F}_i \to \mathcal{I}_i$. Denote $\mathcal{Q}_i$ the
cokernel so that we have short exact sequences
$$
0 \to
\mathcal{F}_i \to
\mathcal{I}_i \to
\mathcal{Q}_i \to 0.
$$
We claim that the sequence
$$
0 \to
\colim_i \mathcal{F}_i \to
\colim_i \mathcal{I}_i \to
\colim_i \mathcal{Q}_i \to 0.
$$
is also a short exact sequence of $\mathcal{O}_X$-modules.
We may check this on stalks. By
Sheaves, Sections \ref{sheaves-section-limits-presheaves}
and \ref{sheaves-section-limits-sheaves}
taking stalks commutes with colimits. Since a directed colimit
of short exact sequences of abelian groups is short exact
(see Algebra, Lemma \ref{algebra-lemma-directed-colimit-exact})
we deduce the result. We claim that
$H^q(U, \colim_i \mathcal{I}_i) = 0$ for all quasi-compact
open $U \subset X$ and all $q \geq 1$. Accepting this claim
for the moment consider the diagram
$$
\xymatrix{
\colim_i H^{q_0}(U, \mathcal{I}_i) \ar[d] \ar[r] &
\colim_i H^{q_0}(U, \mathcal{Q}_i) \ar[d] \ar[r] &
\colim_i H^{q_0 + 1}(U, \mathcal{F}_i) \ar[d] \ar[r] &
0 \ar[d] \\
H^{q_0}(U, \colim_i \mathcal{I}_i) \ar[r] &
H^{q_0}(U, \colim_i \mathcal{Q}_i) \ar[r] &
H^{q_0 + 1}(U, \colim_i \mathcal{F}_i) \ar[r] &
0
}
$$
The zero at the lower right corner comes from the claim and the
zero at the upper right corner comes from the fact that the sheaves
$\mathcal{I}_i$ are injective.
The top row is exact by an application of
Algebra, Lemma \ref{algebra-lemma-directed-colimit-exact}.
Hence by the snake lemma we deduce the
result for $q = q_0 + 1$.

\medskip\noindent
It remains to show that the claim is true. We will use
Lemma \ref{lemma-cech-vanish-basis}.
Let $\mathcal{B}$ be the collection of all quasi-compact open
subsets of $X$. This is a basis for the topology on $X$ by assumption.
Let $\text{Cov}$ be the collection of finite open coverings
$\mathcal{U} : U = \bigcup_{j = 1, \ldots, m} U_j$ with each
of $U$, $U_j$ quasi-compact open in $X$. By the result for $q = 0$
we see that for $\mathcal{U} \in \text{Cov}$ we have
$$
\check{\mathcal{C}}^\bullet(\mathcal{U}, \colim_i \mathcal{I}_i)
=
\colim_i \check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{I}_i)
$$
because all the multiple intersections $U_{j_0 \ldots j_p}$
are quasi-compact. By Lemma \ref{lemma-injective-trivial-cech}
each of the complexes in the colimit of {\v C}ech complexes is
acyclic in degree $\geq 1$. Hence by
Algebra, Lemma \ref{algebra-lemma-directed-colimit-exact}
we see that also the {\v C}ech complex
$\check{\mathcal{C}}^\bullet(\mathcal{U}, \colim_i \mathcal{I}_i)$
is acyclic in degrees $\geq 1$. In other words we see that
$\check{H}^p(\mathcal{U},  \colim_i \mathcal{I}_i) = 0$
for all $p \geq 1$. Thus the assumptions of
Lemma \ref{lemma-cech-vanish-basis} are satisfied and the claim follows.
\end{proof}











\section{Vanishing on Noetherian topological spaces}
\label{section-vanishing-Noetherian}

\noindent
The aim is to prove a theorem of Grothendieck namely
Lemma \ref{lemma-vanishing-Noetherian}. See \cite{Tohoku}.

\begin{lemma}
\label{lemma-cohomology-and-closed-immersions}
Let $i : Z \to X$ be a closed immersion of topological spaces.
For any abelian sheaf $\mathcal{F}$ on $Z$ we have
$H^p(Z, \mathcal{F}) = H^p(X, i_*\mathcal{F})$.
\end{lemma}

\begin{proof}
This is true because $i_*$ is exact (see
Modules, Lemma \ref{modules-lemma-i-star-exact}),
and hence $R^pi_* = 0$ as a functor
(Derived Categories, Lemma \ref{derived-lemma-right-derived-exact-functor}).
Thus we may apply Lemma \ref{lemma-apply-Leray}.
\end{proof}

\begin{lemma}
\label{lemma-irreducible-constant-cohomology-zero}
Let $X$ be an irreducible topological space.
Then $H^p(X, \underline{A}) = 0$ for all $p > 0$
and any abelian group $A$.
\end{lemma}

\begin{proof}
Recall that $\underline{A}$ is the constant sheaf as defined
in Sheaves, Definition \ref{sheaves-definition-constant-sheaf}.
It is clear that for any nonempty
open $U \subset X$ we have $\underline{A}(U) = A$ as $X$ is
irreducible (and hence $U$ is connected).
We will show that the higher {\v C}ech cohomology groups
$\check{H}^p(\mathcal{U}, \underline{A})$ are zero for
any open covering $\mathcal{U} : U = \bigcup_{i\in I} U_i$
of an open $U \subset X$. Then the lemma will follow
from Lemma \ref{lemma-cech-vanish}.

\medskip\noindent
Recall that the value of an abelian
sheaf on the empty open set is $0$. Hence we may clearly assume
$U_i \not = \emptyset$ for all $i \in I$. In this case we see
that $U_i \cap U_{i'} \not = \emptyset$ for all $i, i' \in I$.
Hence we see that the {\v C}ech complex is simply the complex
$$
\prod_{i_0 \in I} A \to
\prod_{(i_0, i_1) \in I^2} A \to
\prod_{(i_0, i_1, i_2) \in I^3} A \to
\ldots
$$
We have to see this has trivial higher cohomology groups.
We can see this for example because this is the cech complex for the covering
of a $1$-point space and {\v C}ech cohomology agrees with cohomology
on such a space. (You can also directly verify it
by writing an explicit homotopy.)
\end{proof}

\begin{lemma}
\label{lemma-vanishing-generated-one-section}
Let $X$ be a topological space. Let $n \geq 0$ be an integer.
Assume
\begin{enumerate}
\item there exists a basis of quasi-compact open subsets, and
\item the intersection of any two quasi-compact opens is quasi-compact.
\item $H^p(X, \mathcal{F}) = 0$ for any abelian sheaf $\mathcal{F}$
which is a quotient of $j_{!}\underline{\mathbf{Z}}_U$ for some open
$j : U \to X$.
\end{enumerate}
Then $H^p(X, \mathcal{F}) = 0$ for all $p \geq n$
and any abelian sheaf $\mathcal{F}$ on $X$.
\end{lemma}

\begin{proof}
Let $S = \coprod_{U \subset X} \mathcal{F}(U)$.
For any finite subset $A = \{s_1, \ldots, s_n\} \subset S$,
let $\mathcal{F}_A$ be the subsheaf of $\mathcal{F}$ generated
by all $s_i$ (see
Modules, Definition \ref{modules-definition-generated-by-local-sections}).
Note that if $A \subset A'$, then $\mathcal{F}_A \subset \mathcal{F}_{A'}$.
Hence $\{\mathcal{F}_A\}$ forms a system over the partially ordered
set of finite subsets of $S$.
By Modules, Lemma \ref{modules-lemma-generated-by-local-sections-stalk}
it is clear that
$$
\colim_A \mathcal{F}_A = \mathcal{F}
$$
by looking at stalks. By
Lemma \ref{lemma-quasi-separated-cohomology-colimit} we have
$$
H^p(X, \mathcal{F}) =
\colim_A H^p(X, \mathcal{F}_A)
$$
Hence it suffices to prove the vanishing for the abelian sheaves
$\mathcal{F}_A$. In other words, it suffices to prove the
result when $\mathcal{F}$ is generated by finitely many local sections.

\medskip\noindent
Suppose that $\mathcal{F}$ is gerated by the local sections
$s_1, \ldots, s_n$. Let $\mathcal{F}' \subset \mathcal{F}$
be the subsheaf generated by $s_1, \ldots, s_{n - 1}$.
Then we have a short exact sequence
$$
0 \to \mathcal{F}' \to \mathcal{F} \to \mathcal{F}/\mathcal{F}' \to 0
$$
From the long exact sequence of cohomology we see that it suffices
to prove the vanishing for the abelian sheaves $\mathcal{F}'$
and $\mathcal{F}/\mathcal{F}'$ which are generated by fewer than
$n$ local sections. Hence it suffices to prove the vanishing
for sheaves generated by at most one local section. These sheaves
are exactly the quotients of the sheaves $j_{!}\underline{\mathbf{Z}}_U$
mentioned in the lemma.
\end{proof}

\begin{lemma}
\label{lemma-subsheaf-irreducible}
Let $X$ be an irreducible topological space.
Let $\mathcal{H} \subset \underline{\mathbf{Z}}$ be
an abelian subsheaf of the constant sheaf.
Then there exists a nonempty open $U \subset X$ such
that $\mathcal{H}|_U = \underline{d\mathbf{Z}}_U$
for some $d \in \mathbf{Z}$.
\end{lemma}

\begin{proof}
Recall that $\underline{\mathbf{Z}}(V) = \mathbf{Z}$
for any nonempty open $V$ of $X$ (see proof of
Lemma \ref{lemma-irreducible-constant-cohomology-zero}).
If $\mathcal{H} = 0$, then the lemma holds with $d = 0$.
If $\mathcal{H} \not = 0$, then there exists a nonempty open
$U \subset X$ such that $\mathcal{H}(U) \not = 0$.
Say $\mathcal{H}(U) = n\mathbf{Z}$ for some $n \geq 1$.
Hence we see that
$\underline{n\mathbf{Z}}_U
\subset \mathcal{H}|_U \subset
\underline{\mathbf{Z}}_U$. If the first inclusion is strict we
can find a nonempty $U' \subset U$ and an integer $1 \leq n' < n$
such that
$\underline{n'\mathbf{Z}}_{U'}
\subset \mathcal{H}|_{U'} \subset
\underline{\mathbf{Z}}_{U'}$.
This process has to stop after a finite number of steps, and
hence we get the lemma.
\end{proof}

\begin{lemma}
\label{lemma-vanishing-Noetherian}
Let $X$ be a Noetherian topological space.
If $\dim(X) \leq n$, then $H^p(X, \mathcal{F}) = 0$
for all $p > n$ and any abelian sheaf $\mathcal{F}$
on $X$.
\end{lemma}

\begin{proof}
We prove this lemma by induction on $n$.
So fix $n$ and assume the lemma holds for all
Noetherian topological spaces of dimension $< n$.

\medskip\noindent
Let $\mathcal{F}$ be an abelian sheaf on $X$.
Suppose $U \subset X$ is an open. Let $Z \subset X$
denote the closed complement.
Denote $j : U \to X$ and $i : Z \to X$ the inclusion maps.
Then there is a short exact sequence
$$
0 \to j_{!}j^*\mathcal{F} \to \mathcal{F} \to i_*i^*\mathcal{F} \to 0
$$
see Modules, Lemma \ref{modules-lemma-canonical-exact-sequence}.
Note that $j_!j^*\mathcal{F}$ is supported on
the topological closure $Z'$ of $U$, i.e., it is of
the form $i'_*\mathcal{F}'$ for some abelian sheaf $\mathcal{F}'$
on $Z'$, where $i' : Z' \to X$ is the inclusion.

\medskip\noindent
We can use this to reduce to the case where $X$ is irreducible.
Namely, according to
Topology, Lemma \ref{topology-lemma-Noetherian}
$X$ has finitely
many irreducible components. If $X$ has more than one irreducible
component, then let $Z \subset X$ be an irreducible component of $X$
and set $U = X \setminus Z$. By the above, and the long exact sequence
of cohomology, it suffices to prove the vanishing of
$H^p(X, i_*i^*\mathcal{F})$ and $H^p(X, i'_*\mathcal{F}')$ for $p > n$.
By Lemma \ref{lemma-cohomology-and-closed-immersions} it suffices to prove
$H^p(Z, i^*\mathcal{F})$ and $H^p(Z', \mathcal{F}')$ for $p > n$.
Since $Z'$ and $Z$ have fewer irreducible components we indeed
reduce to the case of an irreducible $X$.

\medskip\noindent
If $n = 0$ and $X = \{*\}$, then every sheaf is constant and
higher cohomology
groups vanish (for example by
Lemma \ref{lemma-irreducible-constant-cohomology-zero}).

\medskip\noindent
Suppose $X$ is irreducible of dimension $n$.
By Lemma \ref{lemma-vanishing-generated-one-section}
we reduce to the case where $\mathcal{F}$
is generated by a single local section, i.e., to the case
where there is an exact sequence
$$
0 \to \mathcal{H} \to j'_!{\mathbf{Z}}_V \to \mathcal{F} \to 0
$$
for some open $j' : V \to X$. By Lemma \ref{lemma-subsheaf-irreducible}
(applied to the restriction of $\mathcal{H}$ to $V$) there exists a
nonempty open $U \subset V$, and $d \in \mathbf{Z}$ such that
$\mathcal{H}|_U = \underline{d\mathbf{Z}}_U$. Hence we see that
$\mathcal{F}|_U \cong \underline{\mathbf{Z}/d\mathbf{Z}}_U$.
Let $Z$ be the complement of $U$ in $X$.
Denote $j : U \to X$ and $i : Z \to X$ the inclusion maps.
As in the first paragraph of the proof we obtain a short exact
sequence
$$
0 \to j_{!}\underline{\mathbf{Z}/d\mathbf{Z}}
\to \mathcal{F}
\to i_*i^*\mathcal{F} \to 0
$$
OK, and now $\dim(Z) < n$ so by induction we have
$H^p(X, i_*i^*\mathcal{F}) = H^p(Z, i^*\mathcal{F}) = 0$
for all $p \geq n$. Hence it suffices to prove the vanishing
for sheaves of the form $j_!(\underline{A}_U)$ where
$j : U \to X$ is an open immersion and $A$ is an abelian group.

\medskip\noindent
In this case we again look at the short exact sequence
$$
0 \to j_!(\underline{A}_U) \to \underline{A} \to i_*\underline{A}_Z \to 0
$$
By Lemma \ref{lemma-irreducible-constant-cohomology-zero}
we have the vanishing of $H^p(X, \underline{A})$
for all $p \geq 1$. By induction we have
$H^p(X, i_*\underline{A}_Z) = H^p(Z, \underline{A}_Z) = 0$
for $p \leq n$. Hence we win by the long exact cohomology sequence.
\end{proof}












\section{The alternating {\v C}ech complex}
\label{section-alternating-cech}

\noindent
This section compares the {\v C}ech complex with the alternating {\v C}ech
complex and some related complexes.

\medskip\noindent
Let $X$ be a topological space. Let $\mathcal{U} : U = \bigcup_{i \in I} U_i$
be an open covering. For $p \geq 0$ set
$$
\check{\mathcal{C}}_{alt}^p(\mathcal{U}, \mathcal{F})
=
\left\{
\begin{matrix}
s \in  \check{\mathcal{C}}^p(\mathcal{U}, \mathcal{F})
\text{ such that }
s_{i_0 \ldots i_p} = 0 \text{ if } i_n = i_m \text{ for some } n \not = m\\
\text{ and }
s_{i_0\ldots i_n \ldots i_m \ldots i_p}
=
-s_{i_0\ldots i_m \ldots i_n \ldots i_p}
\text{ in any case.}
\end{matrix}
\right\}
$$
We omit the verification that the differential $d$ of
Equation (\ref{equation-d-cech}) maps
$\check{\mathcal{C}}^p_{alt}(\mathcal{U}, \mathcal{F})$ into
$\check{\mathcal{C}}^{p + 1}_{alt}(\mathcal{U}, \mathcal{F})$.

\begin{definition}
\label{definition-alternating-cech-complex}
Let $X$ be a topological space. Let $\mathcal{U} : U = \bigcup_{i \in I} U_i$
be an open covering. Let $\mathcal{F}$ be an abelian presheaf on $X$.
The complex $\check{\mathcal{C}}_{alt}^\bullet(\mathcal{U}, \mathcal{F})$
is the {\it alternating {\v C}ech complex} associated to $\mathcal{F}$ and the
open covering $\mathcal{U}$.
\end{definition}

\noindent
Hence there is a canonical morphism of complexes
$$
\check{\mathcal{C}}_{alt}^\bullet(\mathcal{U}, \mathcal{F})
\longrightarrow
\check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{F})
$$
namely the inclusion of the alternating {\v C}ech complex into the
usual {\v C}ech complex.

\medskip\noindent
Suppose our covering $\mathcal{U} : U = \bigcup_{i \in I} U_i$ comes
equipped with a total ordering $<$ on $I$. In this case, set
$$
\check{\mathcal{C}}_{ord}^p(\mathcal{U}, \mathcal{F})
=
\prod\nolimits_{(i_0, \ldots, i_p) \in I^{p + 1}, i_0 < \ldots < i_p}
\mathcal{F}(U_{i_0\ldots i_p}).
$$
This is an abelian group. For
$s \in \check{\mathcal{C}}_{ord}^p(\mathcal{U}, \mathcal{F})$ we denote
$s_{i_0\ldots i_p}$ its value in $\mathcal{F}(U_{i_0\ldots i_p})$.
We define
$$
d : \check{\mathcal{C}}_{ord}^p(\mathcal{U}, \mathcal{F})
\longrightarrow
\check{\mathcal{C}}_{ord}^{p + 1}(\mathcal{U}, \mathcal{F})
$$
by the formula
$$
d(s)_{i_0\ldots i_{p + 1}}
=
\sum\nolimits_{j = 0}^{p + 1}
(-1)^j
s_{i_0\ldots \hat i_j \ldots i_p}|_{U_{i_0\ldots i_{p + 1}}}
$$
for any $i_0 < \ldots < i_{p + 1}$. Note that this formula is identical
to Equation (\ref{equation-d-cech}).
It is straightforward to see that $d \circ d = 0$. In other words
$\check{\mathcal{C}}_{ord}^\bullet(\mathcal{U}, \mathcal{F})$ is a complex.

\begin{definition}
\label{definition-ordered-cech-complex}
Let $X$ be a topological space.
Let $\mathcal{U} : U = \bigcup_{i \in I} U_i$ be an open covering.
Assume given a total ordering on $I$.
Let $\mathcal{F}$ be an abelian presheaf on $X$.
The complex $\check{\mathcal{C}}_{ord}^\bullet(\mathcal{U}, \mathcal{F})$
is the {\it ordered {\v C}ech complex} associated to $\mathcal{F}$, the
open covering $\mathcal{U}$ and the given total ordering on $I$.
\end{definition}

\noindent
This complex is sometimes called the alternating {\v C}ech complex.
The reason is that there is an obvious comparison map between
the ordered {\v C}ech complex and the alternating {\v C}ech complex.
Namely, consider the map
$$
c :
\check{\mathcal{C}}_{ord}^\bullet(\mathcal{U}, \mathcal{F})
\longrightarrow
\check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{F})
$$
given by the rule
$$
c(s)_{i_0\ldots i_p} =
\left\{
\begin{matrix}
0 &
\text{if} &
i_n = i_m \text{ for some } n \not = m\\
\text{sgn}(\sigma) s_{i_{\sigma(0)}\ldots i_{\sigma(p)}} &
\text{if} &
i_{\sigma(0)} < i_{\sigma(1)} < \ldots < i_{\sigma(p)}
\end{matrix}
\right.
$$
Here $\sigma$ denotes a permutation of $\{0, \ldots, p\}$ and
$\text{sgn}(\sigma)$ denotes its sign. The alternating and ordered
{\v C}ech complexes are often identified in the literature via the map
$c$. Namely we have the following easy lemma.

\begin{lemma}
\label{lemma-ordered-alternating}
Let $X$ be a topological space.
Let $\mathcal{U} : U = \bigcup_{i \in I} U_i$ be an open covering.
Assume $I$ comes equipped with a total ordering.
The map $c$ is a morphism of complexes. In fact it induces
an isomorphism
$$
c : \check{\mathcal{C}}_{ord}^\bullet(\mathcal{U}, \mathcal{F})
\to \check{\mathcal{C}}_{alt}^\bullet(\mathcal{U}, \mathcal{F})
$$
of complexes.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\noindent
There is also a map
$$
\pi :
\check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{F})
\longrightarrow
\check{\mathcal{C}}_{ord}^\bullet(\mathcal{U}, \mathcal{F})
$$
which is described by the rule
$$
\pi(s)_{i_0\ldots i_p} = s_{i_0\ldots i_p}
$$
whenever $i_0 < i_1 < \ldots < i_p$.

\begin{lemma}
\label{lemma-project-to-ordered}
Let $X$ be a topological space.
Let $\mathcal{U} : U = \bigcup_{i \in I} U_i$ be an open covering.
Assume $I$ comes equipped with a total ordering.
The map $\pi : \check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{F})
\to \check{\mathcal{C}}_{ord}^\bullet(\mathcal{U}, \mathcal{F})$
is a morphism of complexes. It induces an isomorphism
$$
\pi : \check{\mathcal{C}}_{alt}^\bullet(\mathcal{U}, \mathcal{F})
\to \check{\mathcal{C}}_{ord}^\bullet(\mathcal{U}, \mathcal{F})
$$
of complexes which is a left inverse to the morphism $c$.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{remark}
\label{remark-compared-ordered-complexes}
This means that if we have two total orderings $<_1$ and $<_2$ on
the index set $I$, then we get an isomorphism of complexes
$\tau = \pi_2 \circ c_1 :
\check{\mathcal{C}}_{ord\text{-}1}(\mathcal{U}, \mathcal{F}) \to
\check{\mathcal{C}}_{ord\text{-}2}(\mathcal{U}, \mathcal{F})$.
It is clear that
$$
\tau(s)_{i_0 \ldots i_p} =
\text{sign}(\sigma) s_{i_{\sigma(0)} \ldots i_{\sigma(p)}}
$$
where $i_0 <_1 i_1 <_1 \ldots <_1 i_p$ and
$i_{\sigma(0)} <_2 i_{\sigma(1)} <_2 \ldots <_2 i_{\sigma(p)}$.
This is the sense in which the ordered {\v C}ech complex is independent
of the chosen total ordering.
\end{remark}

\begin{lemma}
\label{lemma-alternating-usual}
Let $X$ be a topological space.
Let $\mathcal{U} : U = \bigcup_{i \in I} U_i$ be an open covering.
Assume $I$ comes equipped with a total ordering.
The map $c \circ \pi$ is homotopic to the identity on
$\check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{F})$.
In particular the inclusion map
$\check{\mathcal{C}}_{alt}^\bullet(\mathcal{U}, \mathcal{F}) \to
\check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{F})$
is a homotopy equivalence.
\end{lemma}

\begin{proof}
For any multi-index $(i_0, \ldots, i_p) \in I^{p + 1}$ there exists
a unique permutation $\sigma : \{0, \ldots, p\} \to \{0, \ldots, p\}$
such that
$$
i_{\sigma(0)} \leq i_{\sigma(1)} \leq \ldots \leq i_{\sigma(p)}
\quad
\text{and}
\quad
\sigma(j) < \sigma(j + 1)
\quad
\text{if}
\quad
i_{\sigma(j)} = i_{\sigma(j + 1)}.
$$
We denote this permutation $\sigma = \sigma^{i_0 \ldots i_p}$.

\medskip\noindent
For any permutation $\sigma : \{0, \ldots, p\} \to \{0, \ldots, p\}$
and any $a$, $0 \leq a \leq p$ we denote $\sigma_a$
the permutation of $\{0, \ldots, p\}$ such that
$$
\sigma_a(j) =
\left\{
\begin{matrix}
\sigma(j) & \text{if} & 0 \leq j < a, \\
\min\{j' \mid j' > \sigma_a(j - 1), j' \not = \sigma(k), \forall k < a\}
& \text{if} & a \leq j
\end{matrix}
\right.
$$
So if $p = 3$ and $\sigma$, $\tau$ are given by
$$
\begin{matrix}
\text{id} & 0 & 1 & 2 & 3 \\
\sigma & 3 & 2 & 1 & 0
\end{matrix}
\quad \text{and} \quad
\begin{matrix}
\text{id} & 0 & 1 & 2 & 3 \\
\tau & 3 & 0 & 2 & 1
\end{matrix}
$$
then we have
$$
\begin{matrix}
\text{id} & 0 & 1 & 2 & 3 \\
\sigma_0 & 0 & 1 & 2 & 3 \\
\sigma_1 & 3 & 0 & 1 & 2 \\
\sigma_2 & 3 & 2 & 0 & 1 \\
\sigma_3 & 3 & 2 & 1 & 0 \\
\end{matrix}
\quad \text{and} \quad
\begin{matrix}
\text{id} & 0 & 1 & 2 & 3 \\
\tau_0 & 0 & 1 & 2 & 3 \\
\tau_1 & 3 & 0 & 1 & 2 \\
\tau_2 & 3 & 0 & 1 & 2 \\
\tau_3 & 3 & 0 & 2 & 1 \\
\end{matrix}
$$
It is clear that always $\sigma_0 = \text{id}$ and $\sigma_p = \sigma$.

\medskip\noindent
Having introduced this notation we define for
$s \in \check{\mathcal{C}}^{p + 1}(\mathcal{U}, \mathcal{F})$
the element $h(s) \in \check{\mathcal{C}}^p(\mathcal{U}, \mathcal{F})$
to be the element with components
\begin{equation}
\label{equation-first-homotopy}
h(s)_{i_0\ldots i_p} =
\sum\nolimits_{0 \leq a \leq p}
(-1)^a \text{sign}(\sigma_a)
s_{i_{\sigma(0)} \ldots i_{\sigma(a)} i_{\sigma_a(a)} \ldots i_{\sigma_a(p)}}
\end{equation}
where $\sigma = \sigma^{i_0 \ldots i_p}$. The index
$i_{\sigma(a)}$ occurs twice in
$i_{\sigma(0)} \ldots i_{\sigma(a)} i_{\sigma_a(a)} \ldots i_{\sigma_a(p)}$
once in the first group of $a + 1$ indices and once in the second group
of $p - a + 1$ indices since $\sigma_a(j) = \sigma(a)$ for some
$j \geq a$ by definition of $\sigma_a$. Hence the sum makes sense since each
of the elements
$s_{i_{\sigma(0)} \ldots i_{\sigma(a)} i_{\sigma_a(a)} \ldots i_{\sigma_a(p)}}$
is defined over the open $U_{i_0 \ldots i_p}$.
Note also that for $a = 0$ we get $s_{i_0 \ldots i_p}$ and
for $a = p$ we get
$(-1)^p \text{sign}(\sigma) s_{i_{\sigma(0)} \ldots i_{\sigma(p)}}$.

\medskip\noindent
We claim that
$$
(dh + hd)(s)_{i_0 \ldots i_p} =
s_{i_0 \ldots i_p} -
\text{sign}(\sigma) s_{i_{\sigma(0)} \ldots i_{\sigma(p)}}
$$
where $\sigma = \sigma^{i_0 \ldots i_p}$. We omit the verification
of this claim. (There is a PARI/gp script called first-homotopy.gp
in the stacks-project subdirectory scripts which can be used to check
finitely many instances of this claim.
We wrote this script to make sure the signs are correct.)
Write
$$
\kappa :
\check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{F})
\longrightarrow
\check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{F})
$$
for the operator given by the rule
$$
\kappa(s)_{i_0 \ldots i_p} =
\text{sign}(\sigma^{i_0 \ldots i_p}) s_{i_{\sigma(0)} \ldots i_{\sigma(p)}}.
$$
The claim above implies that $\kappa$ is a morphism of complexes and that
$\kappa$ is homotopic to the identity map of the {\v C}ech complex.
This does not immediately imply the lemma since
the image of the operator $\kappa$ is not the alternating subcomplex.
Namely, the image of $\kappa$ is the ``semi-alternating'' complex
$\check{\mathcal{C}}_{semi\text{-}alt}^p(\mathcal{U}, \mathcal{F})$
where $s$ is a $p$-cochain of this complex if and only if
$$
s_{i_0 \ldots i_p} = \text{sign}(\sigma) s_{i_{\sigma(0)} \ldots i_{\sigma(p)}}
$$
for any $(i_0, \ldots, i_p) \in I^{p + 1}$ with
$\sigma = \sigma^{i_0 \ldots i_p}$.
We introduce yet another variant {\v C}ech complex, namely the semi-ordered
{\v C}ech complex defined by
$$
\check{\mathcal{C}}_{semi\text{-}ord}^p(\mathcal{U}, \mathcal{F})
=
\prod\nolimits_{i_0 \leq i_1 \leq \ldots \leq i_p}
\mathcal{F}(U_{i_0 \ldots i_p})
$$
It is easy to see that Equation (\ref{equation-d-cech}) also defines
a differential and hence that we get a complex. It is also clear
(analogous to Lemma \ref{lemma-project-to-ordered}) that the projection map
$$
\check{\mathcal{C}}_{semi\text{-}alt}^\bullet(\mathcal{U}, \mathcal{F})
\longrightarrow
\check{\mathcal{C}}_{semi\text{-}ord}^\bullet(\mathcal{U}, \mathcal{F})
$$
is an isomorphism of complexes.

\medskip\noindent
Hence the Lemma follows if we can show that the obvious inclusion map
$$
\check{\mathcal{C}}_{ord}^p(\mathcal{U}, \mathcal{F})
\longrightarrow
\check{\mathcal{C}}_{semi\text{-}ord}^p(\mathcal{U}, \mathcal{F})
$$
is a homotopy equivalence. To see this we use the homotopy
\begin{equation}
\label{equation-second-homotopy}
h(s)_{i_0 \ldots i_p} =
\left\{
\begin{matrix}
0 & \text{if} & i_0 < i_1 < \ldots < i_p \\
(-1)^a s_{i_0 \ldots i_{a - 1} i_a i_a i_{a + 1} \ldots i_p}
& \text{if} & i_0 < i_1 < \ldots < i_{a - 1} < i_a = i_{a + 1}
\end{matrix}
\right.
\end{equation}
We claim that
$$
(dh + hd)(s)_{i_0 \ldots i_p} =
\left\{
\begin{matrix}
0 & \text{if} & i_0 < i_1 < \ldots < i_p \\
s_{i_0 \ldots i_p}
& \text{else} &
\end{matrix}
\right.
$$
We omit the verification. (There is a PARI/gp script called second-homotopy.gp
in the stacks-project subdirectory scripts which can be used to check
finitely many instances of this claim.
We wrote this script to make sure the signs are correct.)
The claim clearly shows that the composition
$$
\check{\mathcal{C}}_{semi\text{-}ord}^\bullet(\mathcal{U}, \mathcal{F})
\longrightarrow
\check{\mathcal{C}}_{ord}^\bullet(\mathcal{U}, \mathcal{F})
\longrightarrow
\check{\mathcal{C}}_{semi\text{-}ord}^\bullet(\mathcal{U}, \mathcal{F})
$$
of the projection with the natural inclusion
is homotopic to the identity map as desired.
\end{proof}





\section{Locally finite coverings and the {\v C}ech complex}
\label{section-locally-finite-cech}

\noindent
In this section we discuss an alternative way to esthablish the relationship
between the {\v C}ech complex and cohomology in case the covering is locally
finite.

\begin{definition}
\label{definition-covering-locally-finite}
Let $X$ be a topological space.
An open covering $X = \bigcup_{i \in I} U_i$ is said to be
{\it locally finite} if for every $x \in X$ there exists an open neighbourhood
$W$ of $x$ such that $\{i \in I \mid W \cap U_i \not = \emptyset\}$ is finite.
\end{definition}

\begin{remark}
\label{remark-locally-finite-sections}
Let $X = \bigcup_{i \in I} U_i$ be a locally finite open covering.
Denote $j_i : U_i \to X$ the inclusion map. Suppose that for each $i$
we are given an abelian sheaf $\mathcal{F}_i$ on $U_i$. Consider the
abelian sheaf $\mathcal{G} = \bigoplus_{i \in I} (j_i)_*\mathcal{F}_i$.
Then actually
$$
\Gamma(X, \mathcal{G}) = \prod\nolimits_{i \in I} \mathcal{F}_i(U_i).
$$
This seems strange until you realize that the direct sum of a collection
of sheaves is the sheafification of what you think it should be.
See discussion in Modules, Section \ref{modules-section-kernels}.
\end{remark}

\begin{lemma}
\label{lemma-locally-finite-covering-resolution}
Let $X$ be a ringed space.
Let $\mathcal{U} : X = \bigcup_{i \in I} U_i$ be a locally finite open
covering of $X$.
Let $\mathcal{F}$ be an $\mathcal{O}_X$-module.
Denote $\mathcal{F}_{i_0 \ldots i_p}$ the restriction of
$\mathcal{F}$ to $U_{i_0 \ldots i_p}$. There exists a complex
${\mathfrak C}^\bullet(\mathcal{U}, \mathcal{F})$
of $\mathcal{O}_X$-modules with
$$
{\mathfrak C}^p(\mathcal{U}, \mathcal{F}) =
\bigoplus\nolimits_{i_0 \ldots i_p}
(j_{i_0 \ldots i_p})_* \mathcal{F}_{i_0 \ldots i_p}
$$
and differential
$d : {\mathfrak C}^p(\mathcal{U}, \mathcal{F})
\to {\mathfrak C}^{p + 1}(\mathcal{U}, \mathcal{F})$
as in Equation (\ref{equation-d-cech}). Moreover, there exists a canonical
map
$$
\mathcal{F} \to {\mathfrak C}^\bullet(\mathcal{U}, \mathcal{F})
$$
which is a quasi-isomorphism, i.e.,
${\mathfrak C}^\bullet(\mathcal{U}, \mathcal{F})$
is a resolution of $\mathcal{F}$.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\noindent
With this lemma it is easy to reprove the {\v C}ech to cohomology spectral
sequence of Lemma \ref{lemma-cech-spectral-sequence} in the special
case of locally finite coverings. Namely,
let $X$, $\mathcal{U}$, $\mathcal{F}$ as in
Lemma \ref{lemma-locally-finite-covering-resolution}
and let $\mathcal{F} \to \mathcal{I}^\bullet$ be an injective resolution.
Then we may consider the double complex
$$
A^{\bullet, \bullet} =
\Gamma(X, {\mathfrak C}^\bullet(\mathcal{U}, \mathcal{I}^\bullet)).
$$
Note that
$$
A^{p, q} = \prod\nolimits_{i_0 \ldots i_p} \mathcal{I}^q(U_{i_0 \ldots i_p})
$$
see Remark \ref{remark-locally-finite-sections}.
Consider the two spectral sequences of
Homology, Section \ref{homology-section-double-complex} associated
to this double complex.
See especially Homology, Lemma \ref{homology-lemma-ss-double-complex}.
For the spectral sequence $({}'E_r, {}'d_r)_{r \geq 0}$
we get ${}'E_2^{p, q} = \check{H}^p(\mathcal{U}, \underline{H}^q(\mathcal{F}))$
and for the spectral sequence $({}''E_r, {}''d_r)_{r \geq 0}$ we get
${}''E_2^{p, q} = 0$ if $p > 0$ and ${}''E_2^{0, q} = H^q(X, \mathcal{F})$.
Whence the result since both spectral sequences converge to the
cohomology of the simple complex $sA^\bullet$.












\section{{\v C}ech cohomology of complexes}
\label{section-cech-cohomology-of-complexes}

\noindent
In general for sheaves of abelian groups
${\mathcal F}$ and ${\mathcal G}$ on $X$ there is a cupproduct map
$$
H^i(X, {\mathcal F}) \times H^j(X, {\mathcal G})
\longrightarrow
H^{i + j}(X, {\mathcal F} \otimes_{\mathbf Z} {\mathcal G}).
$$
In this section we define it using {\v C}ech cocyles by an explicit formula
for the cup product. If you are worried about the fact that cohomology may not
equal {\v C}ech cohomology, then you can use hypercoverings and still
use the cocycle notation. This also has the advantage that
it works to define the cup product for hypercohomology on any topos (insert
future reference here).

\medskip\noindent
Let ${\mathcal F}^\bullet$ be a bounded below complex of presheaves of abelian
groups on $X$. We can often compute $H^n(X, {\mathcal F}^\bullet)$
using {\v C}ech cocycles. Namely, let
${\mathcal U} : X = \bigcup_{i \in I} U_i$
be an open covering of $X$. Since the {\v C}ech complex
$\check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{F})$
(Definition \ref{definition-cech-complex})
is functorial in the presheaf $\mathcal{F}$ we obtain a double complex
$\check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{F}^\bullet)$.
The associated total complex to
$\check{\mathcal{C}}^\bullet({\mathcal U}, {\mathcal F}^\bullet)$
is the complex with degree $n$ term
$$
\text{Tot}^n(\check{\mathcal{C}}^\bullet({\mathcal U}, {\mathcal F}^\bullet))
=
\bigoplus\nolimits_{p + q = n}
\prod\nolimits_{i_0\ldots i_p} {\mathcal F}^q(U_{i_0\ldots i_p})
$$
see
Homology, Definition \ref{homology-definition-associated-simple-complex}.
A typical element in $\text{Tot}^n$ will be denoted
$\alpha = \{\alpha_{i_0\ldots i_p}\}$ where
$\alpha_{i_0 \ldots i_p} \in \mathcal{F}^q(U_{i_0\ldots i_p})$.
In other words the $\mathcal{F}$-degree of $\alpha_{i_0\ldots i_p}$ is
$q = n - p$. This notation requires us to be aware of the degree $\alpha$
lives in at all times. We indicate this situation by the formula
$\deg_{\mathcal F}(\alpha_{i_0\ldots i_p}) = q$.
According to our conventions in
Homology, Definition \ref{homology-definition-associated-simple-complex}
the differential of an element $\alpha$ of degree $n$ is given by
$$
d(\alpha)_{i_0\ldots i_{p + 1}}
=
\sum\nolimits_{j = 0}^{p + 1}
(-1)^j \alpha_{i_0 \ldots \hat i_j \ldots i_{p + 1}} + 
(-1)^{p + 1}d_{{\mathcal F}}(\alpha_{i_0 \ldots i_{p + 1}})
$$
where $d_\mathcal{F}$ denotes the differential on the complex
$\mathcal{F}^\bullet$.
The expression $\alpha_{i_0 \ldots \hat i_j \ldots i_{p + 1}}$ means the
restriction of $\alpha_{i_0 \ldots \hat i_j \ldots i_{p + 1}}
\in {\mathcal F}(U_{i_0\ldots\hat i_j\ldots i_{p + 1}})$ to
$U_{i_0 \ldots i_{p + 1}}$.

\medskip\noindent
The construction of
$\text{Tot}(\check{\mathcal{C}}^\bullet({\mathcal U}, {\mathcal F}^\bullet))$
is functorial in ${\mathcal F}^\bullet$. As well there is a functorial
transformation
\begin{equation}
\label{equation-global-sections-to-cech}
\Gamma(X, {\mathcal F}^\bullet)
\longrightarrow
\text{Tot}(\check{\mathcal{C}}^\bullet({\mathcal U}, {\mathcal F}^\bullet))
\end{equation}
of complexes defined by the following rule: The section
$s\in \Gamma(X, {\mathcal F}^n)$
is mapped to the element $\alpha = \{\alpha_{i_0\ldots i_p}\}$
with $\alpha_{i_0} = s|_{U_{i_0}}$ and $\alpha_{i_0\ldots i_p} = 0$
for $p>0$.

\medskip\noindent
Refinements. Let ${\mathcal V} = \{ V_j \}_{j\in J}$ be a
refinement of ${\mathcal U}$. This means there is a map $t: J \to I$
such that $V_j \subset U_{t(j)}$ for all $j\in J$. This gives
rise to a functorial transformation
\begin{equation}
\label{equation-transformation}
T_t :
\text{Tot}(\check{\mathcal{C}}^\bullet({\mathcal U}, {\mathcal F}^\bullet))
\longrightarrow
\text{Tot}(\check{\mathcal{C}}^\bullet({\mathcal V}, {\mathcal F}^\bullet)).
\end{equation}
defined by the rule
$$
T_t(\alpha)_{j_0\ldots j_p}
=
\alpha_{t(j_0)\ldots t(j_p)}|_{V_{j_0\ldots j_p}}.
$$
Given two maps $t, t' : J \to I$ as above the maps
$T_t$ and $T_{t'}$ constructed above are homotopic.
The homotopy is given by
$$
h(\alpha)_{j_0\ldots j_p}
=
\sum\nolimits_{a = 0}^{p}
(-1)^a
\alpha_{t(j_0)\ldots t(j_a) t'(j_a) \ldots t'(j_p)}
$$
for an element $\alpha$ of degree $n$. This works
because of the following computation, again with
$\alpha$ an elemement of degree $n$ (so $d(\alpha)$
has degree $n + 1$ and $h(\alpha)$ has degree $n - 1$):
\begin{align*}
(
d(h(\alpha)) + h(d(\alpha))
)_{j_0\ldots j_p}
= &
\sum\nolimits_{k = 0}^p
(-1)^k
h(\alpha)_{j_0 \ldots \hat j_k \ldots j_p}
+ \\
&
(-1)^p
d_{\mathcal F}(h(\alpha)_{j_0 \ldots j_p})
+ \\
&
\sum\nolimits_{a = 0}^p
(-1)^a
d(\alpha)_{t(j_0) \ldots t(j_a) t'(j_a) \ldots t'(j_p)}
\\
= &
\sum\nolimits_{k = 0}^p
\sum\nolimits_{a = 0}^{k - 1}
(-1)^{k + a}
\alpha_{t(j_0)\ldots t(j_a)t'(j_a)\ldots \hat{t'(j_k)}\ldots t'(j_p)}
+ \\
&
\sum\nolimits_{k = 0}^p
\sum\nolimits_{a = k + 1}^p
(-1)^{k + a - 1}
\alpha_{t(j_0)\ldots \hat{t(j_k)}\ldots t(j_a)t'(j_a)\ldots t'(j_p)}
+ \\
&
\sum\nolimits_{a = 0}^p
(-1)^{p + a}
d_{\mathcal F}(\alpha_{t(j_0)\ldots t(j_a) t'(j_a) \ldots t'(j_p)})
+ \\
&
\sum\nolimits_{a = 0}^p
\sum\nolimits_{k = 0}^a
(-1)^{a + k}
\alpha_{t(j_0)\ldots\hat{t(j_k)}\ldots t(j_a)t'(j_a)\ldots t'(j_p)}
+ \\
&
\sum\nolimits_{a = 0}^p
\sum\nolimits_{k = a}^p
(-1)^{a + k + 1}
\alpha_{t(j_0) \ldots t(j_a) t'(j_a) \ldots \hat{t'(j_k)} \ldots t'(j_p)}
+ \\
&
\sum\nolimits_{a = 0}^p
(-1)^{a + p + 1}
d_{\mathcal F}(\alpha_{t(j_0)\ldots t(j_a) t'(j_a) \ldots t'(j_p)})
\\
& =
\alpha_{t'(j_0)\ldots t'(j_p)} +
(-1)^{2p + 1}\alpha_{t(j_0)\ldots t(j_p)}
\\
& =
T_{t'}(\alpha)_{j_0\ldots j_p} - T_t(\alpha)_{j_0\ldots j_p}
\end{align*}
We leave it to the reader to verify the cancellations. (Note that the
terms having both $k$ and $a$ in the 1st, 2nd and 4th, 5th summands
cancel, except the ones where $a = k$ which only occur in the 4th and 5th
and these cancel against each other except for the two desired terms.)
It follows that the induced map
$$
H^n(T_t) :
H^n(
\text{Tot}(\check{\mathcal{C}}^\bullet({\mathcal U}, {\mathcal F}^\bullet))
)
\to
H^n(
\text{Tot}(\check{\mathcal{C}}^\bullet({\mathcal V}, {\mathcal F}^\bullet))
)
$$
is independend of the choice of $t$. We define
{\it {\v C}ech hypercohomology} as the limit of the
{\v C}ech cohomology groups
over all refinements via the maps $H^\bullet(T_t)$.

\medskip\noindent
In the limit (over all open coverings of $X$) the following lemma provides
a map of {\v C}ech hypercohomology into cohomology, which is often an
isomorphism and is always an isomorphism if we use hypercoverings.

\begin{lemma}
\label{lemma-cech-complex-complex}
Let $(X, \mathcal{O}_X)$ be a ringed space.
Let $\mathcal{U} : X = \bigcup_{i \in I} U_i$ be
an open covering. For a bounded below complex $\mathcal{F}^\bullet$
of $\mathcal{O}_X$-modules there is a canonical map
$$
\text{Tot}(\check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{F}^\bullet))
\longrightarrow
R\Gamma(X, \mathcal{F}^\bullet)
$$
functorial in $\mathcal{F}^\bullet$ and compatible with
(\ref{equation-global-sections-to-cech}) and (\ref{equation-transformation}).
There is a spectral sequence $(E_r, d_r)_{r \geq 0}$ with
$$
E_2^{p, q} =
H^p(\text{Tot}(\check{\mathcal{C}}^\bullet(\mathcal{U},
\underline{H}^q(\mathcal{F}^\bullet))
$$
converging to $H^{p + q}(X, \mathcal{F}^\bullet)$.
\end{lemma}

\begin{proof}
Let ${\mathcal I}^\bullet$ be a bounded below complex of injectives.
The map (\ref{equation-global-sections-to-cech}) for
$\mathcal{I}^\bullet$ is a map
$\Gamma(X, {\mathcal I}^\bullet) \to
\text{Tot}(\check{\mathcal{C}}^\bullet({\mathcal U}, {\mathcal I}^\bullet))$.
This is a quasi-isomorphism of complexes of abelian groups
as follows from
Homology, Lemma \ref{homology-lemma-double-complex-gives-resolution}
applied to the double complex
$\check{\mathcal{C}}^\bullet({\mathcal U}, {\mathcal I}^\bullet)$ using
Lemma \ref{lemma-injective-trivial-cech}.
Suppose ${\mathcal F}^\bullet \to {\mathcal I}^\bullet$ is a quasi-isomorphism
of ${\mathcal F}^\bullet$ into a bounded below complex of injectives.
Since $R\Gamma(X, {\mathcal F}^\bullet)$ is represented by the complex
$\Gamma(X, {\mathcal I}^\bullet)$ we obtain the map of the lemma
using
$$
\text{Tot}(\check{\mathcal{C}}^\bullet({\mathcal U}, {\mathcal F}^\bullet))
\longrightarrow
\text{Tot}(\check{\mathcal{C}}^\bullet({\mathcal U}, {\mathcal I}^\bullet)).
$$
We omit the verification of functoriality and compatibilities.
To construct the spectral sequence of the lemma, choose a Cartan-Eilenberg
resolution $\mathcal{F}^\bullet \to \mathcal{I}^{\bullet, \bullet}$, see
Derived Categories, Lemma \ref{derived-lemma-cartan-eilenberg}. In this
case $\mathcal{F}^\bullet \to \text{Tot}(\mathcal{I}^{\bullet, \bullet})$
is an injective resolution and hence
$$
\text{Tot}(\check{\mathcal{C}}^\bullet({\mathcal U},
\text{Tot}({\mathcal I}^{\bullet, \bullet})))
$$
computes $R\Gamma(X, \mathcal{F}^\bullet)$ as we've seen above.
By Homology, Remark \ref{homology-remark-triple-complex}
we can view this as the total complex associated to the
triple complex
$\check{\mathcal{C}}^\bullet({\mathcal U}, {\mathcal I}^{\bullet, \bullet})$
hence, using the same remark we can view it as the total complex
associate to the double complex $A^{\bullet, \bullet}$ with terms
$$
A^{n, m} =
\bigoplus\nolimits_{p + q = n}
\check{\mathcal{C}}^p({\mathcal U}, \mathcal{I}^{q, m})
$$
Since $\mathcal{I}^{q, \bullet}$ is an injective resolution of
$\mathcal{F}^q$ we can apply the first spectral sequence associated to
$A^{\bullet, \bullet}$
(Homology, Lemma \ref{homology-lemma-ss-double-complex})
to get a spectral sequence with
$$
E_1^{n, m} =
\bigoplus\nolimits_{p + q = n}
\check{\mathcal{C}}^p(\mathcal{U}, \underline{H}^m(\mathcal{F}^q))
$$
which is the $n$th term of the complex
$\text{Tot}(\check{\mathcal{C}}^\bullet(\mathcal{U},
\underline{H}^m(\mathcal{F}^\bullet))$. Hence we obtain
$E_2$ terms as described in the lemma. Convergence by
Homology, Lemma \ref{homology-lemma-first-quadrant-ss}.
\end{proof}

\noindent
Let $X$ be a topological space, let $\mathcal{U} : X = \bigcup_{i \in I} U_i$
be an open covering, and let $\mathcal{F}^\bullet$ be a bounded below
complex of presheaves of abelian groups. Consider the map
$\tau :
\text{Tot}(\check{\mathcal{C}}^\bullet({\mathcal U}, {\mathcal F}^\bullet))
\to
\text{Tot}(\check{\mathcal{C}}^\bullet({\mathcal U}, {\mathcal F}^\bullet))$
defined by
$$
\tau(\alpha)_{i_0 \ldots i_p} = (-1)^{p(p + 1)/2} \alpha_{i_p \ldots i_0}.
$$
Then we have for an element $\alpha$ of degree $n$ that
\begin{align*}
& d(\tau(\alpha))_{i_0 \ldots i_{p + 1}} \\
& =
\sum\nolimits_{j = 0}^{p + 1}
(-1)^j
\tau(\alpha)_{i_0 \ldots \hat i_j \ldots i_{p + 1}}
+
(-1)^{p + 1}
d_{\mathcal F}(\tau(\alpha)_{i_0 \ldots i_{p + 1}})
\\
& =
\sum\nolimits_{j = 0}^{p + 1}
(-1)^{j + \frac{p(p + 1)}{2}}
\alpha_{i_{p + 1} \ldots \hat i_j \ldots i_0}
+
(-1)^{p + 1 + \frac{(p + 1)(p + 2)}{2}}
d_{\mathcal F}(\alpha_{i_{p + 1} \ldots i_0})
\end{align*}
On the other hand we have
\begin{align*}
&\tau(d(\alpha))_{i_0\ldots i_{p + 1}} \\
& =
(-1)^{\frac{(p + 1)(p + 2)}{2}} d(\alpha)_{i_{p + 1} \ldots i_0}
\\
& =
(-1)^{\frac{(p + 1)(p + 2)}{2}}
\left(
\sum\nolimits_{j = 0}^{p + 1}
(-1)^j
\alpha_{i_{p + 1}\ldots \hat i_{p + 1 - j} \ldots i_0}
+
(-1)^{p + 1}
d_{\mathcal F}(\alpha_{i_{p + 1}\ldots i_0})
\right)
\end{align*}
Thus we conclude that $d(\tau(\alpha)) = \tau(d(\alpha))$
because $p(p + 1)/2 \equiv (p + 1)(p + 2)/2 + p + 1 \bmod 2$. In other words
$\tau$ is an endomorphism of the complex
$\text{Tot}(\check{\mathcal{C}}^\bullet({\mathcal U}, {\mathcal F}^\bullet))$.
Note that the diagram
$$
\begin{matrix}
\Gamma(X, {\mathcal F}^\bullet) &
\longrightarrow &
\text{Tot}(\check{\mathcal{C}}^\bullet({\mathcal U}, {\mathcal F}^\bullet)) \\
\downarrow \text{id} & & \downarrow \tau \\
\Gamma(X, {\mathcal F}^\bullet) &
\longrightarrow &
\text{Tot}(\check{\mathcal{C}}^\bullet({\mathcal U}, {\mathcal F}^\bullet))
\end{matrix}
$$
commutes. In addition $\tau$ is clearly compatible with refinements.
This suggests that $\tau$ acts as the identity on {\v C}ech cohomology
(i.e., in the limit -- provided {\v C}ech hypercohomology agrees with
hypercohomology, which is always the case if we use hypercoverings).
We claim that $\tau$ actually is homotopic to the identity on the
total {\v C}ech complex
$\text{Tot}(\check{\mathcal{C}}^\bullet({\mathcal U}, {\mathcal F}^\bullet))$.
To prove this, we use as homotopy
$$
h(\alpha)_{i_0 \ldots i_p}
=
\sum\nolimits_{a = 0}^p
\epsilon_p(a)
\alpha_{i_0 \ldots i_a i_p \ldots i_a}
\quad\text{with}\quad
\epsilon_p(a) = (-1)^{\frac{(p - a)(p - a - 1)}{2} + p}
$$
for $\alpha$ of degree $n$. As usual we omit writing
$|_{U_{i_0 \ldots i_p}}$. This works
because of the following computation, again with
$\alpha$ an elemement of degree $n$:
\begin{align*}
(d(h(\alpha)) + h(d(\alpha)))_{i_0 \ldots i_p}
= &
\sum\nolimits_{k = 0}^p
(-1)^k
h(\alpha)_{i_0 \ldots \hat i_k \ldots i_p}
+ \\
&
(-1)^p
d_{\mathcal F}(h(\alpha)_{i_0 \ldots i_p})
+ \\
&
\sum\nolimits_{a = 0}^p
\epsilon_p(a)
d(\alpha)_{i_0 \ldots i_a i_p \ldots i_a}
\\
= &
\sum\nolimits_{k = 0}^p
\sum\nolimits_{a = 0}^{k - 1}
(-1)^k \epsilon_{p - 1}(a)
\alpha_{i_0 \ldots i_a i_p \ldots \hat{i_k} \ldots i_a}
+ \\
&
\sum\nolimits_{k = 0}^p
\sum\nolimits_{a = k + 1}^p
(-1)^k \epsilon_{p - 1}(a - 1)
\alpha_{i_0 \ldots \hat{i_k} \ldots i_a i_p \ldots i_a}
+ \\
&
\sum\nolimits_{a = 0}^p
(-1)^p \epsilon_p(a)
d_{\mathcal F}(\alpha_{i_0 \ldots i_a i_p \ldots i_a})
+ \\
&
\sum\nolimits_{a = 0}^p
\sum\nolimits_{k = 0}^a
\epsilon_p(a) (-1)^k
\alpha_{i_0 \ldots \hat{i_k} \ldots i_a i_p \ldots i_a}
+ \\
&
\sum\nolimits_{a = 0}^p
\sum\nolimits_{k = a}^p
\epsilon_p(a) (-1)^{p + a + 1 - k}
\alpha_{i_0 \ldots i_a i_p \ldots \hat{i_k} \ldots i_a}
+ \\
&
\sum\nolimits_{a = 0}^p
\epsilon_p(a) (-1)^{p + 1}
d_{\mathcal F}(\alpha_{i_0 \ldots i_a i_p \ldots i_a})
\\
= &
\epsilon_p(0) \alpha_{i_p \ldots i_0} +
\epsilon_p(p) (-1)^{p + 1} \alpha_{i_0 \ldots i_p} \\
= &
(-1)^{\frac{p(p + 1)}{2}}\alpha_{i_p \ldots i_0}
- \alpha_{i_0 \ldots i_p}
\end{align*}
The cancellations follow because
$$
(-1)^k \epsilon_{p - 1}(a) + \epsilon_p(a)(-1)^{p + a + 1 - k} = 0
\quad\text{and}\quad
(-1)^k\epsilon_{p - 1}(a - 1) + \epsilon_p(a) (-1)^k = 0
$$
We leave it to the reader to verify the cancellations.

\medskip\noindent
Suppose we have two bounded below complexes complexes of abelian sheaves
${\mathcal F}^\bullet$ and ${\mathcal G}^\bullet$. We define the complex
$\text{Tot}({\mathcal F}^\bullet\otimes_{\bf Z} {\mathcal G}^\bullet)$
to be to complex with terms
$\bigoplus_{p + q = n} {\mathcal F}^p \otimes {\mathcal G}^q$
and differential according to the rule
\begin{equation}
\label{equation-differential-tensor-product-complexes}
d(\alpha \otimes \beta) =
d(\alpha)\otimes \beta + (-1)^{\deg(\alpha)} \alpha \otimes d(\beta)
\end{equation}
when $\alpha$ and $\beta$ are homogeneous, see
Homology, Definition \ref{homology-definition-associated-simple-complex}.

\medskip\noindent
Suppose that $M^\bullet$ and $N^\bullet$ are two bounded below
complexes of abelian groups. Then if $m$, resp.\ $n$
is a cocycle for $M^\bullet$, resp.\ $N^\bullet$, it is immediate
that $m \otimes n$ is a cocycle for $\text{Tot}(M^\bullet\otimes N^\bullet)$.
Hence a cupproduct
$$
H^i(M^\bullet) \times H^j(N^\bullet)
\longrightarrow
H^{i + j}(Tot(M^\bullet\otimes N^\bullet)).
$$
This is discussed also in
More on Algebra, Section \ref{more-algebra-section-products-tor}.

\medskip\noindent
So the construction of the cup product in hypercohomology
of complexes rests on a construction of a map of complexes
\begin{equation}
\label{equation-needs-signs}
\text{Tot}\left(
\text{Tot}(\check{\mathcal{C}}^\bullet({\mathcal U}, {\mathcal F}^\bullet))
\otimes_{\mathbf Z}
\text{Tot}(\check{\mathcal{C}}^\bullet({\mathcal U}, {\mathcal G}^\bullet))
\right)
\longrightarrow
\text{Tot}(
\check{\mathcal{C}}^\bullet({\mathcal U},
\text{Tot}({\mathcal F}^\bullet\otimes {\mathcal G}^\bullet)
))
\end{equation}
This map is denoted $\cup$ and is given by the rule
$$
(\alpha \cup \beta)_{i_0 \ldots i_p}
=
\sum\nolimits_{r = 0}^p
\epsilon(n, m, p, r)
\alpha_{i_0 \ldots i_r} \otimes \beta_{i_r \ldots i_p}.
$$
where $\alpha$ has degree $n$ and $\beta$ has degree $m$
and with
$$
\epsilon(n, m, p, r) = (-1)^{(p + r)n + rp + r}.
$$
Note that $\epsilon(n, m, p, n) = 1$. Hence if
$\mathcal{F}^\bullet = \mathcal{F}[0]$ is the complex
consisting in a single abelian sheaf $\mathcal{F}$ placed in degree $0$,
then there no signs in the formula for $\cup$ (as in that case
$\alpha_{i_0 \ldots i_r} = 0$ unless $r = n$).
For an explanation of why there has to be a sign and how to
compute it see \cite[Exposee XVII]{SGA4} by Deligne.
To check (\ref{equation-needs-signs})
is a map of complexes we have to show that
$$
d(\alpha \cup \beta) =
d(\alpha) \cup \beta +
(-1)^{\deg(\alpha)} \alpha \cup d(\beta)
$$
by the definition of the differential on
$\text{Tot}(
\text{Tot}(\check{\mathcal{C}}^\bullet({\mathcal U}, {\mathcal F}^\bullet))
\otimes_{\mathbf Z}
\text{Tot}(\check{\mathcal{C}}^\bullet({\mathcal U}, {\mathcal G}^\bullet))
)$
as given in
Homology, Definition \ref{homology-definition-associated-simple-complex}.
We compute first
\begin{align*}
d(\alpha \cup \beta)_{i_0 \ldots i_{p + 1}}
= &
\sum\nolimits_{j = 0}^{p + 1}
(-1)^j
(\alpha \cup \beta)_{i_0 \ldots \hat i_j \ldots i_{p + 1}}
+
(-1)^{p + 1}
d_{{\mathcal F} \otimes {\mathcal G}}
((\alpha \cup \beta)_{i_0 \ldots i_{p + 1}})
\\
= &
\sum\nolimits_{j = 0}^{p + 1}
\sum\nolimits_{r = 0}^{j - 1}
(-1)^j \epsilon(n, m, p, r)
\alpha_{i_0 \ldots i_r} \otimes \beta_{i_r \ldots \hat i_j \ldots i_{p + 1}}
+ \\
&
\sum\nolimits_{j = 0}^{p + 1}
\sum\nolimits_{r = j + 1}^{p + 1}
(-1)^j \epsilon(n, m, p, r - 1)
\alpha_{i_0 \ldots \hat i_j \ldots i_r} \otimes \beta_{i_r \ldots i_{p + 1}}
+ \\
&
\sum\nolimits_{r = 0}^{p + 1}
(-1)^{p + 1} \epsilon(n, m, p + 1, r)
d_{{\mathcal F} \otimes {\mathcal G}}
(\alpha_{i_0 \ldots i_r} \otimes \beta_{i_r \ldots i_{p + 1}})
\end{align*}
and note that the summands in the last term equal
$$
(-1)^{p + 1} \epsilon(n, m, p + 1, r)
\left(
d_{\mathcal F}(\alpha_{i_0 \ldots i_r}) \otimes 
\beta_{i_r \ldots i_{p + 1}} +
(-1)^{n - r}
\alpha_{i_0 \ldots i_r} \otimes d_{\mathcal G}(\beta_{i_r \ldots i_{p + 1}})
\right).
$$
because $\deg_\mathcal{F}(\alpha_{i_0 \ldots i_r}) = n - r$.
On the other hand
\begin{align*}
(d(\alpha) \cup \beta)_{i_0\ldots i_{p + 1}}
= &
\sum\nolimits_{r = 0}^{p + 1}
\epsilon(n + 1, m, p + 1, r)
d(\alpha)_{i_0\ldots i_r} \otimes \beta_{i_r\ldots i_{p + 1}}
\\
= &
\sum\nolimits_{r = 0}^{p + 1}
\sum\nolimits_{j = 0}^{r}
\epsilon(n + 1, m, p + 1, r) (-1)^j
\alpha_{i_0\ldots\hat{i_j}\ldots i_r} \otimes \beta_{i_r\ldots i_{p + 1}}
+ \\
&
\sum\nolimits_{r = 0}^{p + 1}
\epsilon(n + 1, m, p + 1, r) (-1)^r
d_{\mathcal F}(\alpha_{i_0 \ldots i_r}) \otimes \beta_{i_r\ldots i_{p + 1}}
\end{align*}
and
\begin{align*}
(\alpha \cup d(\beta))_{i_0\ldots i_{p + 1}}
= &
\sum\nolimits_{r = 0}^{p + 1}
\epsilon(n, m + 1, p + 1, r)
\alpha_{i_0 \ldots i_r} \otimes d(\beta)_{i_r \ldots i_{p + 1}}
\\
= &
\sum\nolimits_{r = 0}^{p + 1}
\sum\nolimits_{j = r}^{p + 1}
\epsilon(n, m + 1, p + 1, r) (-1)^{j - r}
\alpha_{i_0 \ldots i_r} \otimes \beta_{i_r \ldots \hat{i_j}\ldots i_{p + 1}}
+ \\
&
\sum\nolimits_{r = 0}^{p + 1}
\epsilon(n, m + 1, p + 1, r) (-1)^{p + 1 - r}
\alpha_{i_0 \ldots i_r} \otimes d_{\mathcal G}(\beta_{i_r \ldots i_{p + 1}})
\end{align*}
The desired equality holds if we have
\begin{align*}
(-1)^{p + 1} \epsilon(n, m, p + 1, r)
& =
\epsilon(n + 1, m, p + 1, r) (-1)^r \\
(-1)^{p + 1} \epsilon(n, m, p + 1, r) (-1)^{n - r}
& =
(-1)^n \epsilon(n, m + 1, p + 1, r) (-1)^{p + 1 - r} \\
\epsilon(n + 1, m, p + 1, r) (-1)^r
& =
(-1)^{1 + n} \epsilon(n, m + 1, p + 1, r - 1) \\
(-1)^j \epsilon(n, m, p, r)
& =
(-1)^n \epsilon(n, m + 1, p + 1, r) (-1)^{j - r} \\
(-1)^j \epsilon(n, m, p, r - 1)
& =
\epsilon(n + 1, m, p + 1, r) (-1)^j
\end{align*}
(The third equality is necessary to get the terms with $r = j$
from $d(\alpha) \cup \beta$ and $(-1)^n \alpha \cup d(\beta)$
to cancel each other.) We leave the verifications to the reader.
(Alternatively, check the script signs.gp in the scripts subdirectory
of the stacks project.)

\medskip\noindent
Associativity of the cupproduct. Suppose that ${\mathcal F}^\bullet$,
${\mathcal G}^\bullet$ and ${\mathcal H}^\bullet$ are bounded below
complexes of abelian groups on $X$. The obvious map
(without the intervention of signs) is an isomorphism
of complexes
$$
\text{Tot}(
\text{Tot}({\mathcal F}^\bullet \otimes_{\bf Z} {\mathcal G}^\bullet)
\otimes_{\bf Z} {\mathcal H}^\bullet
)
\longrightarrow
\text{Tot}(
{\mathcal F}^\bullet \otimes_{\bf Z}
\text{Tot}({\mathcal G}^\bullet \otimes_{\bf Z} {\mathcal H}^\bullet)
).
$$
Another way to say this is that the triple complex
${\mathcal F}^\bullet \otimes_{\bf Z} {\mathcal G}^\bullet
\otimes_{\bf Z} {\mathcal H}^\bullet$ gives rise to a well defined
total complex with differential satisfying
$$
d(\alpha \otimes \beta \otimes \gamma) =
d(\alpha) \otimes \beta \otimes \gamma +
(-1)^{\deg(\alpha)} \alpha \otimes d(\beta) \otimes \gamma +
(-1)^{\deg(\alpha) + \deg(\beta)} \alpha \otimes \beta \otimes d(\gamma)
$$
for homogeneous elements. Using this map it is easy to verify that
$$
(\alpha \cup \beta) \cup \gamma = \alpha \cup ( \beta \cup \gamma)
$$
namely, if $\alpha$ has degree $a$, $\beta$ has degree $b$ and
$\gamma$ has degree $c$, then
\begin{align*}
((\alpha \cup \beta) \cup \gamma)_{i_0 \ldots i_p}
= &
\sum\nolimits_{r = 0}^p
\epsilon(a + b, c, p, r)
(\alpha \cup \beta)_{i_0 \ldots i_r} \otimes \gamma_{i_r \ldots i_p}
\\
= &
\sum\nolimits_{r = 0}^p
\sum\nolimits_{s = 0}^r
\epsilon(a + b, c, p, r) \epsilon(a, b, r, s)
\alpha_{i_0 \ldots i_s} \otimes
\beta_{i_s \ldots i_r} \otimes
\gamma_{i_r \ldots i_p}
\end{align*}
and
\begin{align*}
(\alpha \cup (\beta \cup \gamma)_{i_0\ldots i_p}
= &
\sum\nolimits_{s = 0}^p
\epsilon(a, b + c, p, s)
\alpha_{i_0 \ldots i_s} \otimes (\beta \cup \gamma)_{i_s \ldots i_p}
\\
= &
\sum\nolimits_{s = 0}^p
\sum\nolimits_{r = s}^p
\epsilon(a, b + c, p, s) \epsilon(b, c, p - s, r - s)
\alpha_{i_0 \ldots i_s} \otimes \beta_{i_s \ldots i_r} \otimes
\gamma_{i_r \ldots i_p}
\end{align*}
and a trivial mod $2$ calculation shows the signs match up.
(Alternatively, check the script signs.gp in the scripts subdirectory
of the stacks project.)

\medskip\noindent
Finally, we indicate why the cup product preserves a graded commutative
structure, at least on a cohomological level. For this we use the operator
$\tau$ introduced above. Let ${\mathcal F}^\bullet$ be a bounded below
complexes of abelian groups, and assume we are given a graded commutative
multiplication
$$
\wedge^\bullet :
\text{Tot}({\mathcal F}^\bullet\otimes {\mathcal F}^\bullet)
\longrightarrow
{\mathcal F}^\bullet.
$$
This means the following: For $s$ a local section of
${\mathcal F}^a$, and $t$ a local section of ${\mathcal F}^b$
we have $s \wedge t$ a local section of ${\mathcal F}^{a + b}$.
Graded commutative means we have
$s \wedge t = (-1)^{ab} t \wedge s$. Since $\wedge$ is a map
of complexes we have
$d(s\wedge t) = d(s) \wedge t + (-1)^a s \wedge t$.
The composition
$$
\text{Tot}(
\text{Tot}(\check{\mathcal{C}}^\bullet({\mathcal U}, {\mathcal F}^\bullet))
\otimes
\text{Tot}(\check{\mathcal{C}}^\bullet({\mathcal U}, {\mathcal F}^\bullet))
)
\to
\text{Tot}(
\check{\mathcal{C}}^\bullet({\mathcal U},
\text{Tot}({\mathcal F}^\bullet\otimes_{\bf Z}{\mathcal F}^\bullet))
)
\to
\text{Tot}(\check{\mathcal{C}}^\bullet({\mathcal U}, {\mathcal F}^\bullet))
$$
induces a cup product on cohomology
$$
H^n(
\text{Tot}(\check{\mathcal{C}}^\bullet({\mathcal U}, {\mathcal F}^\bullet))
)
\times
H^m(
\text{Tot}(\check{\mathcal{C}}^\bullet({\mathcal U}, {\mathcal F}^\bullet))
)
\longrightarrow
H^{n + m}(
\text{Tot}(\check{\mathcal{C}}^\bullet({\mathcal U}, {\mathcal F}^\bullet))
)
$$
and so in the limit also a product on {\v C}ech cohomology
and therefore (using hypercoverings if needed) a product
in cohomology of ${\mathcal F}^\bullet$. We claim this product
(on cohomology) is graded commutative as well. To prove this
we first consider an element $\alpha$ of degree $n$ in
$\text{Tot}(\check{\mathcal{C}}^\bullet({\mathcal U}, {\mathcal F}^\bullet))$
and an element $\beta$ of degree $m$ in
$\text{Tot}(\check{\mathcal{C}}^\bullet({\mathcal U}, {\mathcal F}^\bullet))$
and we compute
\begin{align*}
\wedge^\bullet(\alpha \cup \beta)_{i_0 \ldots i_p}
= &
\sum\nolimits_{r = 0}^p
\epsilon(n, m, p, r)
\alpha_{i_0 \ldots i_r} \wedge \beta_{i_r \ldots i_p} \\
= &
\sum\nolimits_{r = 0}^p
\epsilon(n, m, p, r)
(-1)^{\deg(\alpha_{i_0 \ldots i_r})\deg(\beta_{i_r \ldots i_p})}
\beta_{i_r \ldots i_p} \wedge \alpha_{i_0 \ldots i_r}
\end{align*}
because $\wedge$ is graded commutative. On the other hand we have
\begin{align*}
\tau(\wedge^\bullet(\tau(\beta) \cup \tau(\alpha)))_{i_0 \ldots i_p}
= &
\chi(p)
\sum\nolimits_{r = 0}^p
\epsilon(m, n, p, r)
\tau(\beta)_{i_p \ldots i_{p - r}} \wedge \tau(\alpha)_{i_{p - r} \ldots i_0}
\\
= &
\chi(p)
\sum\nolimits_{r = 0}^p
\epsilon(m, n, p, r) \chi(r) \chi(p - r)
\beta_{i_{p - r} \ldots i_p} \wedge \alpha_{i_0 \ldots i_{p - r}}
\\
= &
\chi(p)
\sum\nolimits_{r = 0}^p
\epsilon(m, n, p, p - r) \chi(r) \chi(p - r)
\beta_{i_r \ldots i_p} \wedge \alpha_{i_0 \ldots i_r}
\end{align*}
where $\chi(t) = (-1)^{\frac{t(t + 1)}{2}}$. Since we proved earlier that
$\tau$ acts as the identity on cohomology we have to verify that
$$
\epsilon(n, m, p, r)
(-1)^{(n - r)(m - (p - r))}
=
(-1)^{nm} \chi(p)\epsilon(m, n, p, p - r) \chi(r) \chi(p - r)
$$
A trivial mod $2$ calculation shows these signs match up.
(Alternatively, check the script signs.gp in the scripts subdirectory
of the stacks project.)

\medskip\noindent
Finally, we study the compatibility of cup product with boundary maps.
Suppose that
$$
0
\to
{\mathcal F}_1^\bullet
\to
{\mathcal F}_2^\bullet
\to
{\mathcal F}_3^\bullet
\to
0
\quad\text{and}\quad
0
\leftarrow
{\mathcal G}_1^\bullet
\leftarrow
{\mathcal G}_2^\bullet
\leftarrow
{\mathcal G}_3^\bullet
\leftarrow
0
$$
are short exact sequences of bounded below complexes of abelian
sheaves on $X$. Let ${\mathcal H}^\bullet$ be another bounded below
complex of abelian sheaves, and suppose we have maps of complexes
$$
\gamma_i :
\text{Tot}({\mathcal F}_i^\bullet \otimes_{\bf Z} {\mathcal G}_i^\bullet)
\longrightarrow
{\mathcal H}^\bullet
$$
which are compatible with the maps between the complexes, namely such that
the diagrams
$$
\xymatrix{
\text{Tot}({\mathcal F}_1^\bullet \otimes_{\bf Z} {\mathcal G}_1^\bullet)
\ar[d]_{\gamma_1}
&
\text{Tot}({\mathcal F}_1^\bullet \otimes_{\bf Z} {\mathcal G}_2^\bullet)
\ar[l] \ar[d]
\\
\mathcal{H}^\bullet &
\text{Tot}({\mathcal F}_2^\bullet \otimes_{\bf Z} {\mathcal G}_2^\bullet)
\ar[l]_-{\gamma_2}
}
$$
and
$$
\xymatrix{
\text{Tot}({\mathcal F}_2^\bullet \otimes_{\bf Z} {\mathcal G}_2^\bullet)
\ar[d]_{\gamma_2}
&
\text{Tot}({\mathcal F}_2^\bullet \otimes_{\bf Z} {\mathcal G}_3^\bullet)
\ar[l] \ar[d]
\\
\mathcal{H}^\bullet &
\text{Tot}({\mathcal F}_3^\bullet \otimes_{\bf Z} {\mathcal G}_3^\bullet)
\ar[l]_-{\gamma_3}
}
$$
are commutative.

\begin{lemma}
\label{lemma-compute-sign-cup-product-boundaries}
In the situation above, assume {\v C}ech cohomology agrees with cohomology
for the sheaves $\mathcal{F}_i^p$ and $\mathcal{G}_j^q$.
Let $a_3 \in H^n(X, \mathcal{F}_3^\bullet)$ and
$b_1 \in H^m(X, \mathcal{G}_1^\bullet)$. Then we have
$$
\gamma_1( \partial a_3 \cup b_1) =
(-1)^{n + 1} \gamma_3( a_3 \cup \partial b_1)
$$
in $H^{n + m}(X, \mathcal{H}^\bullet)$ where $\partial$ indicates the
boundary map on cohomology associated to the short exact sequences of
complexes above.
\end{lemma}

\begin{proof}
We will use the following conventions and notation. We think of
${\mathcal F}_1^p$ as a subsheaf of ${\mathcal F}_2^p$ and we think of
${\mathcal G}_3^q$ as a subsheaf of ${\mathcal G}_2^q$. Hence if $s$ is
a local section of ${\mathcal F}_1^p$ we use $s$ to denote
the corresponding section of ${\mathcal F}_2^p$ as well. Similarly
for local sections of ${\mathcal G}_3^q$. Furthermore,
if $s$ is a local section of ${\mathcal F}_2^p$ then we denote
$\bar s$ its image in ${\mathcal F}_3^p$. Similarly for the
map ${\mathcal G}_2^q \to {\mathcal G}^q_1$. In particular if
$s$ is a local section of ${\mathcal F}_2^p$ and $\bar s = 0$
then $s$ is a local section of ${\mathcal F}_1^p$. The commutativity
of the diagrams above implies, for local sections $s$ of
${\mathcal F}_2^p$ and $t$ of ${\mathcal G}_3^q$ that
$\gamma_2(s \otimes t) = \gamma_3(\bar s \otimes t)$ as sections of
${\mathcal H}^{p + q}$.

\medskip\noindent
Let ${\mathcal U} : X =  \bigcup_{i \in I} U_i$
be an open covering of $X$. Suppose that $\alpha_3$,
resp.\ $\beta_1$ is a degree $n$, resp.\ $m$ cocycle of
$\text{Tot}(
\check{\mathcal{C}}^\bullet({\mathcal U}, {\mathcal F}_3^\bullet))$,
resp.\ $\text{Tot}(
\check{\mathcal{C}}^\bullet({\mathcal U}, {\mathcal G}_1^\bullet))$
representing $a_3$, resp.\ $b_1$. After refining $\mathcal{U}$ if necessary,
we can find cochains $\alpha_2$, resp.\ $\beta_2$ of
degree $n$, resp.\ $m$ in
$\text{Tot}(
\check{\mathcal{C}}^\bullet({\mathcal U}, {\mathcal F}_2^\bullet))$,
resp.\ $\text{Tot}(
\check{\mathcal{C}}^\bullet({\mathcal U}, {\mathcal G}_2^\bullet))$
mapping to $\alpha_3$, resp.\ $\beta_1$.
Then we see that
$$
\overline{d(\alpha_2)} = d(\bar \alpha_2) = 0
\quad\text{and}\quad
\overline{d(\beta_2)} = d(\bar \beta_2) = 0.
$$
This means that $\alpha_1 = d(\alpha_2)$ is a degree $n + 1$ cocycle in
$\text{Tot}(\check{\mathcal{C}}^\bullet({\mathcal U}, {\mathcal F}_1^\bullet))$
repesenting $\partial a_3$. Similarly, $\beta_3 = d(\beta_2)$ is
a degree $m + 1$ cocycle in
$\text{Tot}(\check{\mathcal{C}}^\bullet({\mathcal U}, {\mathcal G}_3^\bullet))$
representing $\partial b_1$.
Thus we may compute
\begin{align*}
d(\gamma_2(\alpha_2 \cup \beta_2))
& =
\gamma_2(d(\alpha_2 \cup \beta_2))
\\
& =
\gamma_2(d(\alpha_2) \cup \beta_2 + (-1)^n \alpha_2 \cup d(\beta_2) )
\\
& =
\gamma_2( \alpha_1 \cup \beta_2)  + (-1)^n \gamma_2( \alpha_2 \cup \beta_3)
\\
& =
\gamma_1(\alpha_1 \cup \beta_1) + (-1)^n \gamma_3(\alpha_3 \cup \beta_3)
\end{align*}
So this even tells us that the sign is $(-1)^{n + 1}$ as indicated
in the lemma\footnote{The sign depends on the convention for the
signs in the long exact sequence in cohomology associated to a triangle
in $D(X)$. The conventions in the stacks project are (a) distinguished
triangles correspond to termwise split exact sequences and (b) the boundary
maps in the long exact sequence are given by the maps in the snake lemma
without the intervention of signs. See
Derived Categories, Section \ref{derived-section-homotopy-triangulated}.}.
\end{proof}










\section{Flat resolutions}
\label{section-flat}

\noindent
A reference for the material in this section is \cite{Spaltenstein}.
Let $(X, \mathcal{O}_X)$ be a ringed space. By
Modules, Lemma \ref{modules-lemma-module-quotient-flat}
any $\mathcal{O}_X$-module is a quotient of a flat $\mathcal{O}_X$-module.
By
Derived Categories, Lemma \ref{derived-lemma-subcategory-left-resolution}
any bounded above complex of $\mathcal{O}_X$-modules has a left
resolution by a bounded above complex of flat $\mathcal{O}_X$-modules.
However, for unbounded complexes, it turns out that flat resolutions
aren't good enough.

\begin{lemma}
\label{lemma-derived-tor-exact}
Let $(X, \mathcal{O}_X)$ be a ringed space.
Let $\mathcal{G}^\bullet$ be a complex of $\mathcal{O}_X$-modules.
The functor
$$
K(\textit{Mod}(\mathcal{O}_X))
\longrightarrow
K(\textit{Mod}(\mathcal{O}_X)),
\quad
\mathcal{F}^\bullet \longmapsto
\text{Tot}(\mathcal{F}^\bullet \otimes_{\mathcal{O}_X} \mathcal{G}^\bullet)
$$
is an exact functor of triangulated categories.
\end{lemma}

\begin{proof}
Omitted. Hint: See
More on Algebra, Lemmas \ref{more-algebra-lemma-derived-tor-homotopy} and
\ref{more-algebra-lemma-derived-tor-exact}.
\end{proof}

\begin{definition}
\label{definition-K-flat}
Let $(X, \mathcal{O}_X)$ be a ringed space.
A complex $\mathcal{K}^\bullet$ of $\mathcal{O}_X$-modules is
called {\it K-flat} if for every acyclic complex $\mathcal{F}^\bullet$
of $\mathcal{O}_X$-modules the complex
$$
\text{Tot}(\mathcal{F}^\bullet \otimes_{\mathcal{O}_X} \mathcal{K}^\bullet)
$$
is acyclic.
\end{definition}

\begin{lemma}
\label{lemma-K-flat-quasi-isomorphism}
Let $(X, \mathcal{O}_X)$ be a ringed space.
Let $\mathcal{K}^\bullet$ be a K-flat complex.
Then the functor
$$
K(\textit{Mod}(\mathcal{O}_X))
\longrightarrow
K(\textit{Mod}(\mathcal{O}_X)), \quad
\mathcal{F}^\bullet
\longmapsto
\text{Tot}(\mathcal{F}^\bullet \otimes_{\mathcal{O}_X} \mathcal{K}^\bullet)
$$
transforms quasi-isomorphisms into quasi-isomorphisms.
\end{lemma}

\begin{proof}
Follows from
Lemma \ref{lemma-derived-tor-exact}
and the fact that quasi-isomorphisms are characterized by having
acyclic cones.
\end{proof}

\begin{lemma}
\label{lemma-check-K-flat-stalks}
Let $(X, \mathcal{O}_X)$ be a ringed space. Let $\mathcal{K}^\bullet$
be a complex of $\mathcal{O}_X$-modules. Then $\mathcal{K}^\bullet$
is K-flat if and only if for all $x \in X$ the complex
$\mathcal{K}_x^\bullet$ of $\mathcal{O}_{X, x}$ is K-flat
(More on Algebra, Definition \ref{more-algebra-definition-K-flat}).
\end{lemma}

\begin{proof}
If $\mathcal{K}_x^\bullet$ is K-flat for all $x \in X$ then we see
that $\mathcal{K}^\bullet$ is K-flat because $\otimes$ and
direct sums commute with taking stalks and because we can check exactness
at stalks, see
Modules, Lemma \ref{modules-lemma-abelian}.
Conversely, assume $\mathcal{K}^\bullet$ is K-flat. Pick $x \in X$
$M^\bullet$ be an acyclic complex of $\mathcal{O}_{X, x}$-modules.
Then $i_{x, *}M^\bullet$ is an acyclic complex of $\mathcal{O}_X$-modules.
Thus $\text{Tot}(i_{x, *}M^\bullet \otimes_{\mathcal{O}_X} \mathcal{K}^\bullet)$
is acyclic. Taking stalks at $x$ shows that
$\text{Tot}(M^\bullet \otimes_{\mathcal{O}_{X, x}} \mathcal{K}_x^\bullet)$
is acyclic.
\end{proof}

\begin{lemma}
\label{lemma-tensor-product-K-flat}
Let $(X, \mathcal{O}_X)$ be a ringed space.
If $\mathcal{K}^\bullet$, $\mathcal{L}^\bullet$ are K-flat complexes
of $\mathcal{O}_X$-modules, then
$\text{Tot}(\mathcal{K}^\bullet \otimes_{\mathcal{O}_X} \mathcal{L}^\bullet)$
is a K-flat complex of $\mathcal{O}_X$-modules.
\end{lemma}

\begin{proof}
Follows from the isomorphism
$$
\text{Tot}(\mathcal{M}^\bullet \otimes_{\mathcal{O}_X}
\text{Tot}(\mathcal{K}^\bullet \otimes_{\mathcal{O}_X} \mathcal{L}^\bullet))
=
\text{Tot}(\text{Tot}(\mathcal{M}^\bullet \otimes_{\mathcal{O}_X}
\mathcal{K}^\bullet) \otimes_{\mathcal{O}_X} \mathcal{L}^\bullet)
$$
and the definition.
\end{proof}

\begin{lemma}
\label{lemma-K-flat-two-out-of-three}
Let $(X, \mathcal{O}_X)$ be a ringed space.
Let $(\mathcal{K}_1^\bullet, \mathcal{K}_2^\bullet, \mathcal{K}_3^\bullet)$
be a distinguished triangle in $K(\textit{Mod}(\mathcal{O}_X))$.
If two out of three of $\mathcal{K}_i^\bullet$ are K-flat, so is the third.
\end{lemma}

\begin{proof}
Follows from
Lemma \ref{lemma-derived-tor-exact}
and the fact that in a distinguished triangle in
$K(\textit{Mod}(\mathcal{O}_X))$
if two out of three are acyclic, so is the third.
\end{proof}

\begin{lemma}
\label{lemma-pullback-K-flat}
Let $f : (X, \mathcal{O}_X) \to (Y, \mathcal{O}_Y)$ be a morphism of
ringed spaces. The pullback of a K-flat complex of $\mathcal{O}_Y$-modules
is a K-flat complex of $\mathcal{O}_X$-modules.
\end{lemma}

\begin{proof}
We can check this on stalks, see
Lemma \ref{lemma-check-K-flat-stalks}.
Hence this follows from
Sheaves, Lemma \ref{sheaves-lemma-stalk-pullback-modules}
and
More on Algebra, Lemma \ref{more-algebra-lemma-base-change-K-flat}.
\end{proof}

\begin{lemma}
\label{lemma-bounded-flat-K-flat}
Let $(X, \mathcal{O}_X)$ be a ringed space. A bounded above complex
of flat $\mathcal{O}_X$-modules is K-flat.
\end{lemma}

\begin{proof}
We can check this on stalks, see
Lemma \ref{lemma-check-K-flat-stalks}.
Thus this lemma follows from
Modules, Lemma \ref{modules-lemma-flat-stalks-flat}
and
More on Algebra, Lemma \ref{more-algebra-lemma-derived-tor-quasi-isomorphism}.
\end{proof}

\noindent
In the following lemma by a colimit of a system of complexes we mean
the termwise colimit.

\begin{lemma}
\label{lemma-colimit-K-flat}
Let $(X, \mathcal{O}_X)$ be a ringed space.
Let $\mathcal{K}_1^\bullet \to \mathcal{K}_2^\bullet \to \ldots$
be a system of K-flat complexes.
Then $\colim_i \mathcal{K}_i^\bullet$ is K-flat.
\end{lemma}

\begin{proof}
Because we are taking termwise colimits it is clear that
$$
\colim_i \text{Tot}(
\mathcal{F}^\bullet \otimes_{\mathcal{O}_X} \mathcal{K}_i^\bullet)
=
\text{Tot}(\mathcal{F}^\bullet \otimes_{\mathcal{O}_X}
\colim_i \mathcal{K}_i^\bullet)
$$
Hence the lemma follows from the fact that filtered colimits are
exact.
\end{proof}

\begin{lemma}
\label{lemma-resolution-by-direct-sums-extensions-by-zero}
Let $(X, \mathcal{O}_X)$ be a ringed space.
For any complex $\mathcal{G}^\bullet$ of $\mathcal{O}_X$-modules
there exists a commutative diagram of complexes of $\mathcal{O}_X$-modules
$$
\xymatrix{
\mathcal{K}_1^\bullet \ar[d] \ar[r] &
\mathcal{K}_2^\bullet \ar[d] \ar[r] & \ldots \\
\tau_{\leq 1}\mathcal{G}^\bullet \ar[r] &
\tau_{\leq 2}\mathcal{G}^\bullet \ar[r] & \ldots
}
$$
with the following properties: (1) the vertical arrows are quasi-isomorphisms,
(2) each $\mathcal{K}_n^\bullet$ is a bounded above complex whose terms
are direct sums of $\mathcal{O}_X$-modules of the form
$j_{U!}\mathcal{O}_U$, and
(3) the maps $\mathcal{K}_n^\bullet \to \mathcal{K}_{n + 1}^\bullet$ are
termwise split injections whose cokernels are direct sums of
$\mathcal{O}_X$-modules of the form $j_{U!}\mathcal{O}_U$. Moreover, the map
$\colim \mathcal{K}_n^\bullet \to \mathcal{G}^\bullet$ is a quasi-isomorphism.
\end{lemma}

\begin{proof}
The existence of the diagram and properties (1), (2), (3) follows immediately
from
Modules, Lemma \ref{modules-lemma-module-quotient-flat}
and
Derived Categories, Lemma \ref{derived-lemma-special-direct-system}.
The induced map
$\colim \mathcal{K}_n^\bullet \to \mathcal{G}^\bullet$
is a quasi-isomorphism because filtered colimits are exact.
\end{proof}

\begin{lemma}
\label{lemma-K-flat-resolution}
Let $(X, \mathcal{O}_X)$ be a ringed space.
For any complex $\mathcal{G}^\bullet$ there exists a $K$-flat complex
$\mathcal{K}^\bullet$ and a quasi-isomorphism
$\mathcal{K}^\bullet \to \mathcal{G}^\bullet$.
\end{lemma}

\begin{proof}
Choose a diagram as in
Lemma \ref{lemma-resolution-by-direct-sums-extensions-by-zero}.
Each complex $\mathcal{K}_n^\bullet$ is a bounded
above complex of flat modules, see
Modules on Sites, Lemma \ref{sites-modules-lemma-j-shriek-flat}.
Hence $\mathcal{K}_n^\bullet$ is K-flat by
Lemma \ref{lemma-bounded-flat-K-flat}.
The induced map
$\colim \mathcal{K}_n^\bullet \to \mathcal{G}^\bullet$
is a quasi-isomorphism by construction. Since
$\colim \mathcal{K}_n^\bullet$ is K-flat by
Lemma \ref{lemma-colimit-K-flat}
we win.
\end{proof}

\begin{lemma}
\label{lemma-derived-tor-quasi-isomorphism-other-side}
Let $(X, \mathcal{O}_X)$ be a ringed space. Let
$\alpha : \mathcal{P}^\bullet \to \mathcal{Q}^\bullet$ be a
quasi-isomorphism of K-flat complexes of $\mathcal{O}_X$-modules.
For every complex $\mathcal{F}^\bullet$ of $\mathcal{O}_X$-modules
the induced map
$$
\text{Tot}(\text{id}_{\mathcal{F}^\bullet} \otimes \alpha) :
\text{Tot}(\mathcal{F}^\bullet \otimes_{\mathcal{O}_X} \mathcal{P}^\bullet)
\longrightarrow
\text{Tot}(\mathcal{F}^\bullet \otimes_{\mathcal{O}_X} \mathcal{Q}^\bullet)
$$
is a quasi-isomorphism.
\end{lemma}

\begin{proof}
Choose a quasi-isomorphism $\mathcal{K}^\bullet \to \mathcal{F}^\bullet$
with $\mathcal{K}^\bullet$ a K-flat complex, see
Lemma \ref{lemma-K-flat-resolution}.
Consider the commutative diagram
$$
\xymatrix{
\text{Tot}(\mathcal{K}^\bullet
\otimes_{\mathcal{O}_X} \mathcal{P}^\bullet) \ar[r] \ar[d] &
\text{Tot}(\mathcal{K}^\bullet
\otimes_{\mathcal{O}_X} \mathcal{Q}^\bullet) \ar[d] \\
\text{Tot}(\mathcal{F}^\bullet
\otimes_{\mathcal{O}_X} \mathcal{P}^\bullet) \ar[r] &
\text{Tot}(\mathcal{F}^\bullet
\otimes_{\mathcal{O}_X} \mathcal{Q}^\bullet)
}
$$
The result follows as by
Lemma \ref{lemma-K-flat-quasi-isomorphism}
the vertical arrows and the top horizontal arrow are quasi-isomorphisms.
\end{proof}

\noindent
Let $(X, \mathcal{O}_X)$ be a ringed space.
Let $\mathcal{F}^\bullet$ be an object of $D(\mathcal{O}_X)$.
Choose a K-flat resolution $\mathcal{K}^\bullet \to \mathcal{F}^\bullet$, see
Lemma \ref{lemma-K-flat-resolution}.
By
Lemma \ref{lemma-derived-tor-exact}
we obtain an exact functor of triangulated categories
$$
K(\mathcal{O}_X)
\longrightarrow
K(\mathcal{O}_X),
\quad
\mathcal{G}^\bullet
\longmapsto
\text{Tot}(\mathcal{G}^\bullet \otimes_{\mathcal{O}_X} \mathcal{K}^\bullet)
$$
By
Lemma \ref{lemma-K-flat-quasi-isomorphism}
this functor induces a functor
$D(\mathcal{O}_X) \to D(\mathcal{O}_X)$ simply because
$D(\mathcal{O}_X)$ is the localization of $K(\mathcal{O}_X)$
at quasi-isomorphisms. By
Lemma \ref{lemma-derived-tor-quasi-isomorphism-other-side}
the resulting functor (up to isomorphism)
does not depend on the choice of the K-flat resolution.

\begin{definition}
\label{definition-derived-tor}
Let $(X, \mathcal{O}_X)$ be a ringed space.
Let $\mathcal{F}^\bullet$ be an object of $D(\mathcal{O}_X)$.
The {\it derived tensor product}
$$
- \otimes_{\mathcal{O}_X}^{\mathbf{L}} \mathcal{F}^\bullet :
D(\mathcal{O}_X)
\longrightarrow
D(\mathcal{O}_X)
$$
is the exact functor of triangulated categories described above.
\end{definition}

\noindent
It is clear from our explicit constructions that
there is a canonical isomorphism
$$
\mathcal{F}^\bullet \otimes_{\mathcal{O}_X}^{\mathbf{L}} \mathcal{G}^\bullet
\cong
\mathcal{G}^\bullet \otimes_{\mathcal{O}_X}^{\mathbf{L}} \mathcal{F}^\bullet
$$
for $\mathcal{G}^\bullet$ and $\mathcal{F}^\bullet$ in $D(\mathcal{O}_X)$.
Hence when we write
$\mathcal{F}^\bullet \otimes_{\mathcal{O}_X}^{\mathbf{L}} \mathcal{G}^\bullet$
we will usually be agnostic about which variable we are using to
define the derived tensor product with.

\begin{definition}
\label{definition-tor}
Let $(X, \mathcal{O}_X)$ be a ringed space.
Let $\mathcal{F}$, $\mathcal{G}$ be $\mathcal{O}_X$-modules.
The {\it Tor}'s of $\mathcal{F}$ and $\mathcal{G}$ are define by
the formula
$$
\text{Tor}_p^{\mathcal{O}_X}(\mathcal{F}, \mathcal{G}) =
H^{-p}(\mathcal{F} \otimes_{\mathcal{O}_X}^\mathbf{L} \mathcal{G})
$$
with derived tensor product as defined above.
\end{definition}

\noindent
This definition implies that for every short exact sequence
of $\mathcal{O}_X$-modules
$0 \to \mathcal{F}_1 \to \mathcal{F}_2 \to \mathcal{F}_3 \to 0$
we have a long exact cohomology sequence
$$
\xymatrix{
\mathcal{F}_1 \otimes_{\mathcal{O}_X} \mathcal{G} \ar[r] &
\mathcal{F}_2 \otimes_{\mathcal{O}_X} \mathcal{G} \ar[r] &
\mathcal{F}_3 \otimes_{\mathcal{O}_X} \mathcal{G} \ar[r] & 0 \\
\text{Tor}_1^{\mathcal{O}_X}(\mathcal{F}_1, \mathcal{G}) \ar[r] &
\text{Tor}_1^{\mathcal{O}_X}(\mathcal{F}_2, \mathcal{G}) \ar[r] &
\text{Tor}_1^{\mathcal{O}_X}(\mathcal{F}_3, \mathcal{G}) \ar[ull]
}
$$
for every $\mathcal{O}_X$-module $\mathcal{G}$. This will be called
the long exact sequence of $\text{Tor}$ associated to the situation.

\begin{lemma}
\label{lemma-flat-tor-zero}
Let $(X, \mathcal{O}_X)$ be a ringed space.
Let $\mathcal{F}$ be an $\mathcal{O}_X$-module.
The following are equivalent
\begin{enumerate}
\item $\mathcal{F}$ is a flat $\mathcal{O}_X$-module, and
\item $\text{Tor}_1^{\mathcal{O}_X}(\mathcal{F}, \mathcal{G}) = 0$
for every $\mathcal{O}_X$-module $\mathcal{G}$.
\end{enumerate}
\end{lemma}

\begin{proof}
If $\mathcal{F}$ is flat, then $\mathcal{F} \otimes_{\mathcal{O}_X} -$
is an exact functor and the satellites vanish. Conversely assume (2)
holds. Then if $\mathcal{G} \to \mathcal{H}$ is injective with cokernel
$\mathcal{Q}$, the long exact sequence of $\text{Tor}$ shows that
the kernel of
$\mathcal{F} \otimes_{\mathcal{O}_X} \mathcal{G} \to
\mathcal{F} \otimes_{\mathcal{O}_X} \mathcal{H}$
is a quotient of
$\text{Tor}_1^{\mathcal{O}_X}(\mathcal{F}, \mathcal{Q})$
which is zero by assumption. Hence $\mathcal{F}$ is flat.
\end{proof}







\section{Derived pullback}
\label{section-derived-pullback}

\noindent
Let $f : (X, \mathcal{O}_X) \to (Y, \mathcal{O}_Y)$
be a morphism of ringed spaces. We can use K-flat resolutions to define
a derived pullback functor
$$
Lf^* : D(\mathcal{O}_Y) \to D(\mathcal{O}_X)
$$
Namely, for every complex of $\mathcal{O}_Y$-modules $\mathcal{G}^\bullet$
we can choose a K-flat resolution
$\mathcal{K}^\bullet \to \mathcal{G}^\bullet$ and set
$Lf^*\mathcal{G}^\bullet = f^*\mathcal{K}^\bullet$.
You can use
Lemmas \ref{lemma-pullback-K-flat},
\ref{lemma-K-flat-resolution}, and
\ref{lemma-derived-tor-quasi-isomorphism-other-side}
to see that this is well defined. However, to cross all the t's and dot all
the i's it is perhaps more convenient to use some general theory.

\begin{lemma}
\label{lemma-derived-base-change}
The construction above is independent of choices and defines an exact
functor of triangulated categories
$Lf^* : D(\mathcal{O}_Y) \to D(\mathcal{O}_X)$.
\end{lemma}

\begin{proof}
To see this we use the general theory developed in
Derived Categories, Section \ref{derived-section-derived-functors}.
Set $\mathcal{D} = K(\mathcal{O}_Y)$ and $\mathcal{D}' = D(\mathcal{O}_X)$.
Let us write $F : \mathcal{D} \to \mathcal{D}'$ the exact functor
of triangulated categories defined by the rule
$F(\mathcal{G}^\bullet) = f^*\mathcal{G}^\bullet$.
We let $S$ be the set of quasi-isomorphisms in
$\mathcal{D} = K(\mathcal{O}_Y)$.
This gives a situation as in
Derived Categories, Situation \ref{derived-situation-derived-functor}
so that
Derived Categories, Definition
\ref{derived-definition-right-derived-functor-defined}
applies. We claim that $LF$ is everywhere defined.
This follows from
Derived Categories, Lemma \ref{derived-lemma-find-existence-computes}
with $\mathcal{P} \subset \Ob(\mathcal{D})$ the collection
of $K$-flat complexes: (1) follows from
Lemma \ref{lemma-K-flat-resolution}
and to see (2) we have to show that for a quasi-isomorphism
$\mathcal{K}_1^\bullet  \to \mathcal{K}_2^\bullet$ between
K-flat complexes of $\mathcal{O}_Y$-modules the map
$f^*\mathcal{K}_1^\bullet  \to f^*\mathcal{K}_2^\bullet$ is a
quasi-isomorphism. To see this write this as
$$
f^{-1}\mathcal{K}_1^\bullet \otimes_{f^{-1}\mathcal{O}_Y} \mathcal{O}_X
\longrightarrow
f^{-1}\mathcal{K}_2^\bullet \otimes_{f^{-1}\mathcal{O}_Y} \mathcal{O}_X
$$
The functor $f^{-1}$ is exact, hence the map
$f^{-1}\mathcal{K}_1^\bullet  \to f^{-1}\mathcal{K}_2^\bullet$ is a
quasi-isomorphism. By
Lemma \ref{lemma-pullback-K-flat}
applied to the morphsm $(X, f^{-1}\mathcal{O}_Y) \to (Y, \mathcal{O}_Y)$
the complexes $f^{-1}\mathcal{K}_1^\bullet$ and $f^{-1}\mathcal{K}_2^\bullet$
are K-flat complexes of $f^{-1}\mathcal{O}_Y$-modules. Hence
Lemma \ref{lemma-derived-tor-quasi-isomorphism-other-side}
guarantees that the displayed map is a quasi-isomorphism.
Thus we obtain a derived functor
$$
LF :
D(\mathcal{O}_Y) = S^{-1}\mathcal{D}
\longrightarrow
\mathcal{D}' = D(\mathcal{O}_X)
$$
see
Derived Categories, Equation (\ref{derived-equation-everywhere}).
Finally,
Derived Categories, Lemma \ref{derived-lemma-find-existence-computes}
also guarantees that
$LF(\mathcal{K}^\bullet) = F(\mathcal{K}^\bullet) = f^*\mathcal{K}^\bullet$
when $\mathcal{K}^\bullet$ is K-flat, i.e., $Lf^* = LF$ is
indeed computed in the way described above.
\end{proof}

\begin{lemma}
\label{lemma-pullback-tensor-product}
Let $f : (X, \mathcal{O}_X) \to (Y, \mathcal{O}_Y)$
be a morphism of ringed spaces. There is a canonical bifunctorial
isomorphism
$$
Lf^*(
\mathcal{F}^\bullet \otimes_{\mathcal{O}_Y}^{\mathbf{L}} \mathcal{G}^\bullet
) =
Lf^*\mathcal{F}^\bullet 
\otimes_{\mathcal{O}_X}^{\mathbf{L}}
Lf^*\mathcal{G}^\bullet 
$$
for $\mathcal{F}^\bullet, \mathcal{G}^\bullet \in \Ob(D(X))$.
\end{lemma}

\begin{proof}
We may assume that $\mathcal{F}^\bullet$ and $\mathcal{G}^\bullet$
are K-flat complexes. In this case
$\mathcal{F}^\bullet \otimes_{\mathcal{O}_Y}^{\mathbf{L}} \mathcal{G}^\bullet$
is just the total complex associated to the double complex
$\mathcal{F}^\bullet \otimes_{\mathcal{O}_Y} \mathcal{G}^\bullet$.
By
Lemma \ref{lemma-tensor-product-K-flat}
$\text{Tot}(\mathcal{F}^\bullet \otimes_{\mathcal{O}_Y} \mathcal{G}^\bullet)$
is K-flat also. Hence the isomorphism of the lemma comes from the
isomorphism
$$
\text{Tot}(f^*\mathcal{F}^\bullet \otimes_{\mathcal{O}_X}
f^*\mathcal{G}^\bullet)
\longrightarrow
f^*\text{Tot}(\mathcal{F}^\bullet \otimes_{\mathcal{O}_Y} \mathcal{G}^\bullet)
$$
whose constituents are the isomorphisms
$f^*\mathcal{F}^p \otimes_{\mathcal{O}_X} f^*\mathcal{G}^q \to
f^*(\mathcal{F}^p \otimes_{\mathcal{O}_Y} \mathcal{G}^q)$ of
Modules, Lemma \ref{modules-lemma-tensor-product-pullback}.
\end{proof}





\section{Cohomology of unbounded complexes}
\label{section-unbounded}

\noindent
Let $(X, \mathcal{O}_X)$ be a ringed space.
The category $\textit{Mod}(\mathcal{O}_X)$ is a Grothendieck
abelian category: it has all colimits,
filtered colimits are exact, and it has a generator, namely
$$
\bigoplus\nolimits_{U \subset X\text{ open}} j_{U!}\mathcal{O}_U,
$$
see Modules, Section \ref{modules-section-kernels} and
Lemmas \ref{modules-lemma-j-shriek-flat} and
\ref{modules-lemma-module-quotient-flat}.
By
Injectives, Theorem
\ref{injectives-theorem-K-injective-embedding-grothendieck}
for every complex $\mathcal{F}^\bullet$ of $\mathcal{O}_X$-modules
there exists an injective quasi-isomorphism
$\mathcal{F}^\bullet \to \mathcal{I}^\bullet$ to a K-injective complex
of $\mathcal{O}_X$-modules. Hence we can define
$$
R\Gamma(X, \mathcal{F}^\bullet) = \Gamma(X, \mathcal{I}^\bullet)
$$
and similarly for any left exact functor, see
Derived Categories, Lemma \ref{derived-lemma-enough-K-injectives-implies}.
For any morphism of
ringed spaces $f : (X, \mathcal{O}_X) \to (Y, \mathcal{O}_Y)$ we obtain
$$
Rf_* : D(X) \longrightarrow D(Y)
$$
on the unbounded derived categories.

\begin{lemma}
\label{lemma-adjoint}
Let $f : (X, \mathcal{O}_X) \to (Y, \mathcal{O}_Y)$ be a morphism of
ringed spaces. The functor $Rf_*$ defined above and the functor $Lf^*$
defined in Lemma \ref{lemma-derived-base-change} are adjoint:
$$
\text{Hom}_{D(X)}(Lf^*\mathcal{G}^\bullet, \mathcal{F}^\bullet)
=
\text{Hom}_{D(Y)}(\mathcal{G}^\bullet, Rf_*\mathcal{F}^\bullet)
$$
bifunctorially in $\mathcal{F}^\bullet \in \Ob(D(X))$ and
$\mathcal{G}^\bullet \in \Ob(D(Y))$.
\end{lemma}

\begin{proof}
This is formal from the results obtained above.
Choose a K-flat resolution $\mathcal{K}^\bullet \to \mathcal{G}^\bullet$
and a K-injective resolution $\mathcal{F}^\bullet \to \mathcal{I}^\bullet$.
Then
$$
\text{Hom}_{D(X)}(Lf^*\mathcal{G}^\bullet, \mathcal{F}^\bullet) =
\text{Hom}_{D(X)}(f^*\mathcal{K}^\bullet, \mathcal{I}^\bullet) =
\text{Hom}_{K(\textit{Mod}(\mathcal{O}_X))}(f^*\mathcal{K}^\bullet,
\mathcal{I}^\bullet)
$$
by our definition of $Lf^*$ and because $\mathcal{I}^\bullet$ is K-injective,
see Derived Categories, Lemma \ref{derived-lemma-K-injective}.
On the other hand
$$
\text{Hom}_{D(Y)}(\mathcal{G}^\bullet, Rf_*\mathcal{F}^\bullet) =
\text{Hom}_{D(Y)}(\mathcal{K}^\bullet, f_*\mathcal{I}^\bullet)
$$
by our definition of $Rf_*$. By definition of morphisms in $D(Y)$
this is equal to
$$
\colim_{s : \mathcal{H}^\bullet \to \mathcal{K}^\bullet}
\text{Hom}_{K(\textit{Mod}(\mathcal{O}_Y))}(\mathcal{H}^\bullet,
f_*\mathcal{I}^\bullet)
$$
where the colimit is over all quasi-isomorphisms
$s : \mathcal{H}^\bullet \to \mathcal{K}^\bullet$
of complexes of $\mathcal{O}_Y$-modules.
Since every complex has a left K-flat resolution
it suffices to look at quasi-isomorphisms
$s : (\mathcal{K}')^\bullet \to \mathcal{K}^\bullet$
where $(\mathcal{K}')^\bullet$ is K-flat as well.
In this case we have
\begin{align*}
\text{Hom}_{K(\textit{Mod}(\mathcal{O}_Y))}((\mathcal{K}')^\bullet,
f_*\mathcal{I}^\bullet)
& =
\text{Hom}_{K(\textit{Mod}(\mathcal{O}_Y))}(f^*(\mathcal{K}')^\bullet,
\mathcal{I}^\bullet) \\
& =
\text{Hom}_{K(\textit{Mod}(\mathcal{O}_Y))}(f^*\mathcal{K}^\bullet,
\mathcal{I}^\bullet)
\end{align*}
The first equality because $f^*$ and $f_*$ are adjoint functors and
the second because $\mathcal{I}^\bullet$ is K-injective and
because $f^*(\mathcal{K}')^\bullet \to f^*\mathcal{K}^\bullet$
is a quasi-isomorphism (by virtue of the fact that $Lf^*$ is well
defined).
\end{proof}




\section{Unbounded Mayer-Vietoris}
\label{section-unbounded-mayer-vietoris}

\noindent
Let $(X, \mathcal{O}_X)$ be a ringed space. Let $U \subset X$ be an
open subset. Denote $j : (U, \mathcal{O}_U) \to (X, \mathcal{O}_X)$
the corresponding open immersion. The pullback functor $j^*$ is exact
as it is just the restriction functor. Thus derived pullback $Lj^*$ is
computed on any complex by simply restricting the complex. We often
simply denote the corresponding functor
$$
D(\mathcal{O}_X) \to D(\mathcal{O}_U),
\quad
E \mapsto j^*E = E|_U
$$
Similarly, extension by zero
$j_! : \textit{Mod}(\mathcal{O}_U) \to \textit{Mod}(\mathcal{O}_X)$
(see Sheaves, Section \ref{sheaves-section-open-immersions})
is an exact functor (Modules, Lemma \ref{modules-lemma-j-shriek-exact}).
Thus it induces a functor
$$
j_! : D(\mathcal{O}_U) \to D(\mathcal{O}_X),\
\quad
F \mapsto j_!F
$$
by simply applying $j_!$ to any complex representing the object $F$.

\begin{lemma}
\label{lemma-restrict-K-injective-to-open}
Let $X$ be a ringed space. Let $U \subset X$ be an open subspace.
The restriction of a K-injective complex of $\mathcal{O}_X$-modules
to $U$ is a K-injective complex of $\mathcal{O}_U$-modules.
\end{lemma}

\begin{proof}
Follows immediately from
Derived Categories, Lemma \ref{derived-lemma-adjoint-preserve-K-injectives}
and the fact that the restriction functor has the
exact adjoint $j_!$. See discussion above.
\end{proof}

\begin{lemma}
\label{lemma-adjoint-lower-shriek-restrict}
Let $(X, \mathcal{O}_X)$ be a ringed space. Let $U \subset X$ be an
open subset. Denote $j : (U, \mathcal{O}_U) \to (X, \mathcal{O}_X)$
the corresponding open immersion. The restriction functor
$D(\mathcal{O}_X) \to D(\mathcal{O}_U)$ is a left adjoint to
extension by zero $j_! : D(\mathcal{O}_U) \to D(\mathcal{O}_X)$.
\end{lemma}

\begin{proof}
We have to show that
$$
\Hom_{D(\mathcal{O}_X)}(j_!E, F) = \Hom_{D(\mathcal{O}_U)}(E, F|_U)
$$
Choose a complex $\mathcal{E}^\bullet$ of $\mathcal{O}_U$-modules
representing $E$ and choose
a K-injective complex $\mathcal{I}^\bullet$ representing $F$.
By Lemma \ref{lemma-restrict-K-injective-to-open} the complex
$\mathcal{I}^\bullet|_U$ is K-injective as well. Hence we see that
the formula above becomes
$$
\Hom_{D(\mathcal{O}_X)}(j_!\mathcal{E}^\bullet, \mathcal{I}^\bullet) =
\Hom_{D(\mathcal{O}_U)}(\mathcal{E}^\bullet, \mathcal{I}^\bullet|_U)
$$
which holds as $|_U$ and $j_!$ are adjoint functors
(Sheaves, Lemma \ref{sheaves-lemma-j-shriek-modules}).
\end{proof}

\begin{lemma}
\label{lemma-exact-sequence-lower-shriek}
Let $(X, \mathcal{O}_X)$ be a ringed space.
Let $X = U \cup V$ be the union of two open subspaces.
For any object $E$ of $D(\mathcal{O}_X)$ we have a distinguished
triangle
$$
j_{U \cap V!}E|_{U \cap V} \to
j_{U!}E|_U \oplus j_{V!}E|_V \to E \to 
j_{U \cap V!}E|_{U \cap V}[1]
$$
in $D(\mathcal{O}_X)$.
\end{lemma}

\begin{proof}
We have seen above that the restriction functors and the extension
by zero functors are computed on any complex $\mathcal{E}^\bullet$
of $\mathcal{O}_X$-modules representing $E$.
The distinguised triangle of the lemma is the distinguished
triangle associated (by
Derived Categories, Section
\ref{derived-section-canonical-delta-functor} and especially
Lemma \ref{derived-lemma-derived-canonical-delta-functor})
to the short exact sequence of complexes of $\mathcal{O}_X$-modules
$$
0 \to j_{U \cap V!}\mathcal{E}^\bullet|_{U \cap V} \to
j_{U!}\mathcal{E}^\bullet|_U \oplus j_{V!}\mathcal{E}^\bullet|_V
\to \mathcal{E}^\bullet \to 0
$$
To see this sequence is exact one checks on stalks using
Sheaves, Lemma \ref{sheaves-lemma-j-shriek-modules}
(computation omitted).
\end{proof}

\begin{lemma}
\label{lemma-exact-sequence-j-star}
Let $(X, \mathcal{O}_X)$ be a ringed space.
Let $X = U \cup V$ be the union of two open subspaces.
For any object $E$ of $D(\mathcal{O}_X)$ we have a distinguished
triangle
$$
E \to 
Rj_{U, *}E|_U \oplus Rj_{V, *}E|_V \to
Rj_{U \cap V, *}E|_{U \cap V} \to
E[1]
$$
in $D(\mathcal{O}_X)$.
\end{lemma}

\begin{proof}
Choose a K-injective complex $\mathcal{I}^\bullet$ representing $E$
whose terms $\mathcal{I}^n$ are injective objects of
$\textit{Mod}(\mathcal{O}_X)$, see Injectives, Theorem
\ref{injectives-theorem-K-injective-embedding-grothendieck}.
We have seen that $\mathcal{I}^\bullet|U$ is a K-injective complex
as well (Lemma \ref{lemma-restrict-K-injective-to-open}). Hence
$Rj_{U, *}E|_U$ is represented by $j_{U, *}\mathcal{I}^\bullet|_U$.
Similarly for $V$ and $U \cap V$. Hence the distinguished triangle
of the lemma is the distinguished triangle associated (by
Derived Categories, Section
\ref{derived-section-canonical-delta-functor} and especially
Lemma \ref{derived-lemma-derived-canonical-delta-functor})
to the short exact sequence of complexes
$$
0 \to
\mathcal{I}^\bullet \to
j_{U, *}\mathcal{I}^\bullet|_U \oplus j_{V, *}\mathcal{I}^\bullet|_V \to
j_{U \cap V, *}\mathcal{I}^\bullet|_{U \cap V} \to
0.
$$
This sequence is exact because for any $W \subset X$ open
and any $n$ the sequence
$$
0 \to
\mathcal{I}^n(W) \to
\mathcal{I}^n(W \cap U) \oplus \mathcal{I}^n(W \cap V) \to
\mathcal{I}^n(W \cap U \cap V) \to
0
$$
is exact (see proof of Lemma \ref{lemma-mayer-vietoris}).
\end{proof}

\begin{lemma}
\label{lemma-mayer-vietoris-hom}
Let $(X, \mathcal{O}_X)$ be a ringed space. Let $X = U \cup V$ be
the union of two open subspaces of $X$.
For objects $E$, $F$ of $D(\mathcal{O}_X)$ we have a
Mayer-Vietoris sequence
$$
\xymatrix{
& \ldots \ar[r] & \text{Ext}^{-1}(E_{U \cap V}, F_{U \cap V}) \ar[lld] \\
\Hom(E, F) \ar[r] &
\Hom(E_U, F_U) \oplus
\Hom(E_V, F_V) \ar[r] &
\Hom(E_{U \cap V}, F_{U \cap V})
}
$$
where the subscripts denote restrictions to the relevant opens
and the $\Hom$'s are taken in the relevant derived categories.
\end{lemma}

\begin{proof}
Use the distinguished triangle of
Lemma \ref{lemma-exact-sequence-lower-shriek}
to obtain a long exact sequence of $\Hom$'s
(from Derived Categories, Lemma \ref{derived-lemma-representable-homological})
and use that
$\Hom(j_{U!}E|_U, F) = \Hom(E|_U, F|_U)$
by Lemma \ref{lemma-adjoint-lower-shriek-restrict}.
\end{proof}

\begin{lemma}
\label{lemma-unbounded-mayer-vietoris}
Let $(X, \mathcal{O}_X)$ be a ringed space. Suppose that
$X = U \cup V$ is a union of two open subsets. For an object $E$
of $D(\mathcal{O}_X)$ we have a distinguished triangle
$$
R\Gamma(X, E) \to R\Gamma(U, E) \oplus R\Gamma(V, E) \to
R\Gamma(U \cap V, E) \to R\Gamma(X, E)[1]
$$
and in particular a long exact cohomology sequence
$$
\ldots \to
H^n(X, E) \to
H^n(U, E) \oplus H^0(V, E) \to
H^n(U \cap V, E) \to
H^{n + 1}(X, E) \to \ldots
$$
The construction of the distinguished triangle and the
long exact sequence is functorial in $E$.
\end{lemma}

\begin{proof}
Choose a K-injective complex $\mathcal{I}^\bullet$
representing $E$. We may assume $\mathcal{I}^n$ is an injective
object of $\textit{Mod}(\mathcal{O}_X)$ for all $n$, see
Injectives, Theorem
\ref{injectives-theorem-K-injective-embedding-grothendieck}.
Then $R\Gamma(X, E)$ is computed by $\Gamma(X, \mathcal{I}^\bullet)$.
Similarly for $U$, $V$, and $U \cap V$ by
Lemma \ref{lemma-restrict-K-injective-to-open}.
Hence the distinguished triangle of the lemma is the distinguished
triangle associated (by
Derived Categories, Section
\ref{derived-section-canonical-delta-functor} and especially
Lemma \ref{derived-lemma-derived-canonical-delta-functor})
to the short exact sequence of complexes
$$
0 \to
\mathcal{I}^\bullet(X) \to
\mathcal{I}^\bullet(U) \oplus \mathcal{I}^\bullet(V) \to
\mathcal{I}^\bullet(U \cap V) \to
0.
$$
The final statement follows from the functoriality of the construction
in Injectives, Theorem
\ref{injectives-theorem-K-injective-embedding-grothendieck}.
\end{proof}









\section{Producing K-injective resolutions}
\label{section-K-injective}

\noindent
First a technical lemma.

\begin{lemma}
\label{lemma-inverse-limit-complexes}
Let $(X, \mathcal{O}_X)$ be a ringed space. Let $(\mathcal{F}_n^\bullet)$
be an inverse system of complexes of $\mathcal{O}_X$-modules.
Let $m \in \mathbf{Z}$. Assume there exist a set $\mathcal{B}$
of open subsets of $X$ and an integer $n_0$ such that
\begin{enumerate}
\item every open in $X$ has a covering whose members are
elements of $\mathcal{B}$,
\item for every $U \in \mathcal{B}$
\begin{enumerate}
\item the systems
$\mathcal{F}_n^{m - 2}(U)$ and $\mathcal{F}_n^{m - 1}(U)$ are ML,
\item the system $H^{m - 1}(\mathcal{F}_n^\bullet(U))$ is essentially
constant, and
\item we have
$H^m(\mathcal{F}_n^\bullet(U)) = H^m(\mathcal{F}_{n_0}^\bullet(U))$
for all $n \geq n_0$.
\end{enumerate}
\end{enumerate}
Then
$H^m(\lim \mathcal{F}_n^\bullet) \to \lim H^m(\mathcal{F}_n^\bullet) \to
H^m(\mathcal{F}_{n_0}^\bullet)$
are isomorphisms of sheaves.
\end{lemma}

\begin{proof}
Set $\mathcal{F}^\bullet = \lim \mathcal{F}_n^\bullet$. Let
$U \in \mathcal{B}$. Note that $H^m(\mathcal{F}^\bullet(U))$ is the
cohomology of
$$
\lim_n \mathcal{F}_n^{m - 2}(U) \to
\lim_n \mathcal{F}_n^{m - 1}(U) \to
\lim_n \mathcal{F}_n^m(U) \to
\lim_n \mathcal{F}_n^{m + 1}(U)
$$
in the third spot from the left. By assumptions (2)(a) and (2)(b)
we may apply
Homology, Lemma \ref{homology-lemma-apply-Mittag-Leffler-again}
to conclude that
$$
H^m(\mathcal{F}^\bullet(U)) = \lim H^m(\mathcal{F}_n^\bullet(U))
$$
By assumption (2)(c) we conclude
$$
H^m(\mathcal{F}^\bullet(U)) = H^m(\mathcal{F}_n^\bullet(U))
$$
for all $n \geq n_0$. By assumption (1) we conclude that the sheafification of
$U \mapsto H^m(\mathcal{F}^\bullet(U))$ is equal to the sheafification
of $U \mapsto H^m(\mathcal{F}_n^\bullet(U))$ for all $n \geq n_0$.
Thus the inverse system of sheaves $H^m(\mathcal{F}_n^\bullet)$ is
constant for $n \geq n_0$ with value $H^m(\mathcal{F}^\bullet)$ which
proves the lemma.
\end{proof}

\noindent
Let $(X, \mathcal{O}_X)$ be a ringed space.
Let $\mathcal{F}^\bullet$ be a complex of $\mathcal{O}_X$-modules.
The category $\textit{Mod}(\mathcal{O}_X)$ has enough injectives, hence
we can use
Derived Categories, Lemma \ref{derived-lemma-special-inverse-system}
produce a diagram
$$
\xymatrix{
\ldots \ar[r] &
\tau_{\geq -2}\mathcal{F}^\bullet \ar[r] \ar[d] &
\tau_{\geq -1}\mathcal{F}^\bullet \ar[d] \\
\ldots \ar[r] & \mathcal{I}_2^\bullet \ar[r] & \mathcal{I}_1^\bullet
}
$$
in the category of complexes of $\mathcal{O}_X$-modules such that
\begin{enumerate}
\item the vertical arrows are quasi-isomorphisms,
\item $\mathcal{I}_n^\bullet$ is a bounded above complex of injectives,
\item the arrows $\mathcal{I}_{n + 1}^\bullet \to \mathcal{I}_n^\bullet$
are termwise split surjections.
\end{enumerate}
The category of $\mathcal{O}_X$-modules has limits (they are computed
on the level of presheaves), hence we can form the termwise limit
$\mathcal{I}^\bullet = \lim_n \mathcal{I}_n^\bullet$. By
Derived Categories, Lemmas
\ref{derived-lemma-bounded-below-injectives-K-injective} and
\ref{derived-lemma-limit-K-injectives}
this is a K-injective complex. In general the canonical map
\begin{equation}
\label{equation-into-candidate-K-injective}
\mathcal{F}^\bullet \to \mathcal{I}^\bullet
\end{equation}
may not be a quasi-isomorphism. In the following lemma we describe some
conditions under which it is.

\begin{lemma}
\label{lemma-K-injective}
In the situation described above.
Denote $\mathcal{H}^m = H^m(\mathcal{F}^\bullet)$ the $m$th cohomology sheaf.
Let $\mathcal{B}$ be a set of open subsets of $X$.
Let $d \in \mathbf{N}$.
Assume
\begin{enumerate}
\item every open in $X$ has a covering whose members are
elements of $\mathcal{B}$,
\item for every $U \in \mathcal{B}$
we have $H^p(U, \mathcal{H}^q) = 0$ for $p > d$\footnote{In fact, analyzing
the proof we see that it suffices if there exists a function
$d : \mathbf{Z} \to \mathbf{Z} \cup \{+\infty\}$
such that $H^p(U, \mathcal{H}^q) = 0$ for $p > d(q)$ where
$q + d(q) \to -\infty$ as $q \to -\infty$}.
\end{enumerate}
Then (\ref{equation-into-candidate-K-injective}) is a quasi-isomorphism.
\end{lemma}

\begin{proof}
Let $m \in \mathbf{Z}$.
We have to show that the map $\mathcal{F}^\bullet \to \mathcal{I}^\bullet$
induces an isomorphism $\mathcal{H}^m \to H^m(\mathcal{I}^\bullet)$.
Since $\mathcal{I}_n^\bullet$ is quasi-isomorphic to
$\tau_{\geq -n}\mathcal{F}^\bullet$ it suffices to show that
$H^m(\mathcal{I}^\bullet) \to H^m(\mathcal{I}_n^\bullet)$
is an isomorphism for $n$ large enough. To do this we will verify the
hypotheses (1), (2)(a), (2)(b), (2)(c) of
Lemma \ref{lemma-inverse-limit-complexes}.

\medskip\noindent
Hypothesis (1) is assumption (1) above. Hypothesis (2)(a) follows
from the fact that the maps $\mathcal{I}_{n + 1}^k \to \mathcal{I}_n^k$
are split surjections. We will prove hypothesis (2)(b) and (2)(c)
simultaneously by proving that for $U \in \mathcal{B}$ the system
$H^m(\mathcal{I}_n^\bullet(U))$ becomes constant for $n \geq -m + d$.
Namely, recalling that $\mathcal{I}_n^\bullet$ is quasi-isomorphic
to $\tau_{\geq -n}\mathcal{F}^\bullet$ we obtain for all $n$
a distingushed triangle
$$
\mathcal{H}^{-n}[n] \to \mathcal{I}_n^\bullet \to
\mathcal{I}_{n - 1}^\bullet \to \mathcal{H}^{-n}[n + 1]
$$
in $D(\mathcal{O}_X)$. By assumption (2) we see that if $m > d - n$ then
$$
H^m(U, \mathcal{H}^{-n}[n]) = 0
\quad\text{and}\quad
H^m(U, \mathcal{H}^{-n}[n + 1]) = 0.
$$
Observe that $H^m(\mathcal{I}_n^\bullet(U)) = H^m(U, \mathcal{I}_n^\bullet)$
as $\mathcal{I}_n^\bullet$ is a bounded below complex of injectives.
Unwinding the long exact seqence of cohomology associated to the distinguished
triangle above this implies that
$$
H^m(\mathcal{I}_n^\bullet(U)) \to H^m(\mathcal{I}_{n - 1}^\bullet(U))
$$
is an isomorphism for $m > d - n$, i.e., $n > d - m$ and we win.
\end{proof}















\section{{\v C}ech cohomology of unbounded complexes}
\label{section-cech-cohomology-of-unbounded-complexes}

\noindent
The construction of Section \ref{section-cech-cohomology-of-complexes}
isn't the ``correct'' one for unbounded complexes. The problem is that
in the Stacks project we use direct sums in the totalization of a
double complex and we would have to replace this by a product. Instead
of doing so in this section we assume the covering is finite and
we use the alternating {\v C}ech complex.

\medskip\noindent
Let $(X, \mathcal{O}_X)$ be a ringed space.
Let ${\mathcal F}^\bullet$ be a complex of presheaves of
$\mathcal{O}_X$-modules. Let ${\mathcal U} : X = \bigcup_{i \in I} U_i$
be a {\bf finite} open covering of $X$. Since the alternating
{\v C}ech complex
$\check{\mathcal{C}}_{alt}^\bullet(\mathcal{U}, \mathcal{F})$
(Section \ref{section-alternating-cech})
is functorial in the presheaf $\mathcal{F}$ we obtain a double complex
$\check{\mathcal{C}}^\bullet_{alt}(\mathcal{U}, \mathcal{F}^\bullet)$.
In this section we work with the associated total complex.
The construction of
$\text{Tot}(\check{\mathcal{C}}^\bullet_{alt}({\mathcal U},
{\mathcal F}^\bullet))$
is functorial in ${\mathcal F}^\bullet$. As well there is a functorial
transformation
\begin{equation}
\label{equation-global-sections-to-alternating-cech}
\Gamma(X, {\mathcal F}^\bullet)
\longrightarrow
\text{Tot}(\check{\mathcal{C}}^\bullet_{alt}({\mathcal U},
{\mathcal F}^\bullet))
\end{equation}
of complexes defined by the following rule: The section
$s\in \Gamma(X, {\mathcal F}^n)$
is mapped to the element $\alpha = \{\alpha_{i_0\ldots i_p}\}$
with $\alpha_{i_0} = s|_{U_{i_0}}$ and $\alpha_{i_0\ldots i_p} = 0$
for $p > 0$.

\begin{lemma}
\label{lemma-alternating-cech-complex-complex}
Let $(X, \mathcal{O}_X)$ be a ringed space.
Let $\mathcal{U} : X = \bigcup_{i \in I} U_i$ be
a finite open covering. For a complex $\mathcal{F}^\bullet$
of $\mathcal{O}_X$-modules there is a canonical map
$$
\text{Tot}(\check{\mathcal{C}}^\bullet_{alt}(\mathcal{U}, \mathcal{F}^\bullet))
\longrightarrow
R\Gamma(X, \mathcal{F}^\bullet)
$$
functorial in $\mathcal{F}^\bullet$ and compatible with
(\ref{equation-global-sections-to-alternating-cech}).
\end{lemma}

\begin{proof}
Let ${\mathcal I}^\bullet$ be a K-injective complex whose terms
are injective $\mathcal{O}_X$-modules.
The map (\ref{equation-global-sections-to-alternating-cech}) for
$\mathcal{I}^\bullet$ is a map
$\Gamma(X, {\mathcal I}^\bullet) \to
\text{Tot}(\check{\mathcal{C}}^\bullet_{alt}({\mathcal U},
{\mathcal I}^\bullet))$.
This is a quasi-isomorphism of complexes of abelian groups
as follows from
Homology, Lemma \ref{homology-lemma-double-complex-gives-resolution}
applied to the double complex
$\check{\mathcal{C}}^\bullet_{alt}({\mathcal U},
{\mathcal I}^\bullet)$ using
Lemmas \ref{lemma-injective-trivial-cech} and \ref{lemma-alternating-usual}.
Suppose ${\mathcal F}^\bullet \to {\mathcal I}^\bullet$ is a quasi-isomorphism
of ${\mathcal F}^\bullet$ into a K-injective complex whose terms
are injectives (Injectives, Theorem
\ref{injectives-theorem-K-injective-embedding-grothendieck}).
Since $R\Gamma(X, {\mathcal F}^\bullet)$ is represented by the complex
$\Gamma(X, {\mathcal I}^\bullet)$ we obtain the map of the lemma
using
$$
\text{Tot}(\check{\mathcal{C}}^\bullet_{alt}({\mathcal U},
{\mathcal F}^\bullet))
\longrightarrow
\text{Tot}(\check{\mathcal{C}}^\bullet_{alt}({\mathcal U},
{\mathcal I}^\bullet)).
$$
We omit the verification of functoriality and compatibilities.
\end{proof}

\begin{lemma}
\label{lemma-alternating-cech-complex-complex-ss}
Let $(X, \mathcal{O}_X)$ be a ringed space. Let
$\mathcal{U} : X = \bigcup_{i \in I} U_i$ be a finite open covering. Let
$\mathcal{F}^\bullet$ be a complex of $\mathcal{O}_X$-modules.
Denote $\mathcal{H}^m = H^m(\mathcal{F}^\bullet)$ the $m$th cohomology sheaf.
Let $\mathcal{B}$ be a set of open subsets of $X$. Assume
\begin{enumerate}
\item every open in $X$ has a covering whose members are
elements of $\mathcal{B}$,
\item we have $U_{i_0\ldots i_p} \in \mathcal{B}$ for all
$i_0, \ldots, i_p \in I$,
\item for every $U \in \mathcal{B}$ we have
$H^p(U, \mathcal{H}^q) = 0$ and $H^p(U, \mathcal{F}^q) = 0$
for $p > 0$.
\end{enumerate}
Then the map
$$
\text{Tot}(\check{\mathcal{C}}^\bullet_{alt}(\mathcal{U}, \mathcal{F}^\bullet))
\longrightarrow
R\Gamma(X, \mathcal{F}^\bullet)
$$
of Lemma \ref{lemma-alternating-cech-complex-complex}
is an isomorphism in $D(\textit{Ab})$.
\end{lemma}

\begin{proof}
Coming soon.
\end{proof}















\section{Strictly perfect complexes}
\label{section-strictly-perfect}

\noindent
Strictly perfect complexes of modules are used to define the notions
of pseudo-coherent and perfect complexes later on. They are defined
as follows.

\begin{definition}
\label{definition-strictly-perfect}
Let $(X, \mathcal{O}_X)$ be a ringed space.
Let $\mathcal{E}^\bullet$ be a complex of $\mathcal{O}_X$-modules.
We say $\mathcal{E}^\bullet$ is {\it strictly perfect}
if $\mathcal{E}^i$ is zero for all but finitely many $i$ and
$\mathcal{E}^i$ is a direct summand of a finite free
$\mathcal{O}_X$-module for all $i$.
\end{definition}

\noindent
Warning: Since we do not assume that $X$ is a locally ringed space,
it may not be true that a direct summand of a finite free
$\mathcal{O}_X$-module is finite locally free.

\begin{lemma}
\label{lemma-cone}
The cone on a morphism of strictly perfect complexes is
strictly perfect.
\end{lemma}

\begin{proof}
This is immediate from the definitions.
\end{proof}

\begin{lemma}
\label{lemma-local-lift-map}
Let $(X, \mathcal{O}_X)$ be a ringed space.
Given a solid diagram of $\mathcal{O}_X$-modules
$$
\xymatrix{
\mathcal{E} \ar@{..>}[dr] \ar[r] & \mathcal{F} \\
& \mathcal{G} \ar[u]_p
}
$$
with $\mathcal{E}$ be a direct summand of a finite free
$\mathcal{O}_X$-module and $p$ surjecive, then a dotted arrow
making the diagram commute exists locally on $X$.
\end{lemma}

\begin{proof}
We may assume $\mathcal{E} = \mathcal{O}_X^{\oplus n}$ for some $n$.
In this case finding the dotted arrow is equivalent to lifting the
images of the basis elements in $\Gamma(X, \mathcal{F})$. This is
locally possible by the characterization of surjective maps of
sheaves (Sheaves, Section \ref{sheaves-section-exactness-points}).
\end{proof}

\begin{lemma}
\label{lemma-local-homotopy}
Let $(X, \mathcal{O}_X)$ be a ringed space.
\begin{enumerate}
\item Let $\alpha : \mathcal{E}^\bullet \to \mathcal{F}^\bullet$
be a morphism of complexes of $\mathcal{O}_X$-modules
with $\mathcal{E}^\bullet$ strictly perfect and $\mathcal{F}^\bullet$
acyclic. Then $\alpha$ is locally on $X$ homotopic to zero.
\item Let $\alpha : \mathcal{E}^\bullet \to \mathcal{F}^\bullet$
be a morphism of complexes of $\mathcal{O}_X$-modules
with $\mathcal{E}^\bullet$ strictly perfect, $\mathcal{E}^i = 0$
for $i < a$, and $H^i(\mathcal{F}^\bullet) = 0$ for $i \geq a$.
Then $\alpha$ is locally on $X$ homotopic to zero.
\end{enumerate}
\end{lemma}

\begin{proof}
The first statement follows from the second, hence we only prove (2).
We will prove this by induction on the length of the complex
$\mathcal{E}^\bullet$. If $\mathcal{E}^\bullet \cong \mathcal{E}[-n]$
for some direct summand $\mathcal{E}$ of a finite free
$\mathcal{O}_X$-module and integer $n \geq a$, then the result follows from
Lemma \ref{lemma-local-lift-map} and the fact that
$\mathcal{F}^{n - 1} \to \text{Ker}(\mathcal{F}^n \to \mathcal{F}^{n + 1})$
is surjective by the assumed vanishing of $H^n(\mathcal{F}^\bullet)$.
If $\mathcal{E}^i$ is zero except for $i \in [a, b]$, then we have a
split exact sequence of complexes
$$
0 \to \mathcal{E}^b[-b] \to \mathcal{E}^\bullet \to
\sigma_{\leq b - 1}\mathcal{E}^\bullet \to 0
$$
which determines a distinguished triangle in
$K(\mathcal{O}_X)$. Hence an exact sequence
$$
\Hom_{K(\mathcal{O}_X)}(
\sigma_{\leq b - 1}\mathcal{E}^\bullet, \mathcal{F}^\bullet)
\to
\Hom_{K(\mathcal{O}_X)}(\mathcal{E}^\bullet, \mathcal{F}^\bullet)
\to
\Hom_{K(\mathcal{O}_X)}(\mathcal{E}^b[-b], \mathcal{F}^\bullet)
$$
by the axioms of triangulated categories. The composition
$\mathcal{E}^b[-b] \to \mathcal{F}^\bullet$ is locally homotopic to
zero, whence we may assume our map comes from an element in the
left hand side of the displayed exact sequence above. This element
is locally zero by induction hypothesis.
\end{proof}

\begin{lemma}
\label{lemma-lift-through-quasi-isomorphism}
Let $(X, \mathcal{O}_X)$ be a ringed space.
Given a solid diagram of complexes of $\mathcal{O}_X$-modules
$$
\xymatrix{
\mathcal{E}^\bullet \ar@{..>}[dr] \ar[r]_\alpha & \mathcal{F}^\bullet \\
& \mathcal{G}^\bullet \ar[u]_f
}
$$
with $\mathcal{E}^\bullet$ strictly perfect, $\mathcal{E}^j = 0$ for
$j < a$ and $H^j(f)$ an isomorphism for $j > a$ and surjective for $j = a$,
then a dotted arrow making the diagram commute up to homotopy
exists locally on $X$.
\end{lemma}

\begin{proof}
Our assumptions on $f$ imply the cone $C(f)^\bullet$ has vanishing
cohomology sheaves in degrees $\geq a$.
Hence Lemma \ref{lemma-local-homotopy} guarantees there is an open
covering $X = \bigcup U_i$ such that the composition
$\mathcal{E}^\bullet \to \mathcal{F}^\bullet \to C(f)^\bullet$
is homotopic to zero over $U_i$. Since
$$
\mathcal{G}^\bullet \to \mathcal{F}^\bullet \to C(f)^\bullet \to
\mathcal{G}^\bullet[1]
$$
restricts to a distinguished triangle in $K(\mathcal{O}_{U_i})$
we see that we can lift $\alpha|_{U_i}$ up to homotopy to a map
$\alpha_i : \mathcal{E}^\bullet|_{U_i} \to \mathcal{G}^\bullet|_{U_i}$
as desired.
\end{proof}

\begin{lemma}
\label{lemma-local-actual}
Let $(X, \mathcal{O}_X)$ be a ringed space.
Let $\mathcal{E}^\bullet$, $\mathcal{F}^\bullet$ be complexes
of $\mathcal{O}_X$-modules with $\mathcal{E}^\bullet$ strictly perfect.
For any element
$\alpha \in \Hom_{D(\mathcal{O}_X)}(\mathcal{E}^\bullet, \mathcal{F}^\bullet)$
there exists an open covering $X = \bigcup U_i$ such that
$\alpha|_{U_i}$ is given by a morphism of complexes
$\alpha_i : \mathcal{E}^\bullet|_{U_i} \to \mathcal{F}^\bullet|_{U_i}$.
\end{lemma}

\begin{proof}
By the construction of the derived category we can find a quasi-isomorphism
$f : \mathcal{F}^\bullet \to \mathcal{G}^\bullet$ and a map of complexes
$\beta : \mathcal{E}^\bullet \to \mathcal{G}^\bullet$ such that
$\alpha = f^{-1}\beta$. Thus the result follows from
Lemma \ref{lemma-lift-through-quasi-isomorphism}.
\end{proof}





\section{Pseudo-coherent modules}
\label{section-pseudo-coherent}

\noindent
In this section we discuss pseudo-coherent complexes.

\begin{definition}
\label{definition-pseudo-coherent}
Let $(X, \mathcal{O}_X)$ be a ringed space. Let $\mathcal{E}^\bullet$
be a complex of $\mathcal{O}_X$-modules. Let $m \in \mathbf{Z}$.
\begin{enumerate}
\item We say $\mathcal{E}^\bullet$ is {\it $m$-pseudo-coherent}
if there exists an open covering $X = \bigcup U_i$ and for each $i$
a morphism of complexes
$\alpha_i : \mathcal{E}_i^\bullet \to \mathcal{E}^\bullet|_{U_i}$
where $\mathcal{E}_i$ is strictly perfect on $U_i$ and
$H^j(\alpha_i)$ is an isomorphism for $j > m$ and $H^m(\alpha_i)$
is surjective.
\item We say $\mathcal{E}^\bullet$ is {\it pseudo-coherent}
if it is $m$-pseudo-coherent for all $m$.
\item We say an object $E$ of $D(\mathcal{O}_X)$ is
{\it $m$-pseudo-coherent} (resp.\ {\it pseudo-coherent})
if and only if it can be represented by a $m$-pseudo-coherent
(resp.\ pseudo-coherent) complex of $\mathcal{O}_X$-modules.
\end{enumerate}
\end{definition}

\noindent
If $X$ is quasi-compact, then an $m$-pseudo-coherent object
of $D(\mathcal{O}_X)$ is in $D^-(\mathcal{O}_X)$. But this need
not be the case if $X$ is not quasi-compact.

\begin{lemma}
\label{lemma-pseudo-coherent-independent-representative}
Let $(X, \mathcal{O}_X)$ be a ringed space. Let $E$ be an object
of $D(\mathcal{O}_X)$.
\begin{enumerate}
\item If there exists an open covering $X = \bigcup U_i$,
strictly perfect complexes $\mathcal{E}_i^\bullet$ on $U_i$, and
maps $\alpha_i : \mathcal{E}_i^\bullet \to E|_{U_i}$ in
$D(\mathcal{O}_{U_i})$ with $H^j(\alpha_i)$ an isomorphism for $j > m$
and $H^m(\alpha_i)$ surjective, then $E$ is $m$-pseudo-coherent.
\item If $E$ is $m$-pseudo-coherent, then any complex representing
$E$ is $m$-pseudo-coherent.
\end{enumerate}
\end{lemma}

\begin{proof}
Let $\mathcal{F}^\bullet$ be any complex representing $E$
and let $X = \bigcup U_i$ and
$\alpha_i : \mathcal{E}_i \to E|_{U_i}$ be as in (1).
We will show that $\mathcal{F}^\bullet$ is $m$-pseudo-coherent
as a complex, which will prove (1) and (2) simultaneously.
By Lemma \ref{lemma-local-actual}
we can after refining the open covering $X = \bigcup U_i$
represent the maps $\alpha_i$ by maps of complexes
$\alpha_i : \mathcal{E}_i^\bullet \to \mathcal{F}^\bullet|_{U_i}$.
By assumption
$H^j(\alpha_i)$ are isomorphisms for $j > m$, and $H^m(\alpha_i)$
is surjective whence $\mathcal{F}^\bullet$ is
$m$-pseudo-coherent.
\end{proof}

\begin{lemma}
\label{lemma-cone-pseudo-coherent}
Let $(X, \mathcal{O}_X)$ be a ringed space and $m \in \mathbf{Z}$.
Let $(K, L, M, f, g, h)$ be a distinguished triangle in $D(\mathcal{O}_X)$.
\begin{enumerate}
\item If $K$ is $(m + 1)$-pseudo-coherent and $L$ is $m$-pseudo-coherent
then $M$ is $m$-pseudo-coherent.
\item If $K$ anf $M$ are $m$-pseudo-coherent, then $L$ is $m$-pseudo-coherent.
\item If $L$ is $(m + 1)$-pseudo-coherent and $M$
is $m$-pseudo-coherent, then $K$ is $(m + 1)$-pseudo-coherent.
\end{enumerate}
\end{lemma}

\begin{proof}
Proof of (1). Choose an open covering $X = \bigcup U_i$ and
maps $\alpha_i : \mathcal{K}_i^\bullet \to K|_{U_i}$ in $D(\mathcal{O}_{U_i})$
with $\mathcal{K}_i^\bullet$ strictly perfect and $H^j(\alpha_i)$
isomorphisms for $j > m + 1$ and surjective for $j = m + 1$.
We may replace $\mathcal{K}_i^\bullet$ by
$\sigma_{\geq m + 1}\mathcal{K}_i^\bullet$
and hence we may assume that $\mathcal{K}_i^j = 0$
for $j < m + 1$. After refining the open covering we may choose
maps $\beta_i : \mathcal{L}_i^\bullet \to L|_{U_i}$ in $D(\mathcal{O}_{U_i})$
with $\mathcal{L}_i^\bullet$ strictly perfect such that
$H^j(\beta)$ is an isomorphism for $j > m$ and
surjective for $j = m$. By
Lemma \ref{lemma-lift-through-quasi-isomorphism}
we can, after refining the covering, find maps of complexes
$\gamma_i : \mathcal{K}^\bullet \to \mathcal{L}^\bullet$
such that the diagrams
$$
\xymatrix{
K|_{U_i} \ar[r] & L|_{U_i} \\
\mathcal{K}_i^\bullet \ar[u]^{\alpha_i} \ar[r]^{\gamma_i} &
\mathcal{L}_i^\bullet \ar[u]_{\beta_i}
}
$$
are commutative in $D(\mathcal{O}_{U_i})$ (this requires representing the
maps $\alpha_i$, $\beta_i$ and $K|_{U_i} \to L|_{U_i}$
by actual maps of complexes; some details omitted).
The cone $C(\gamma_i)^\bullet$ is strictly perfect (Lemma \ref{lemma-cone}).
The commutativity of the diagram implies that there exists a morphism
of distinguished triangles
$$
(\mathcal{K}_i^\bullet, \mathcal{L}_i^\bullet, C(\gamma_i)^\bullet)
\longrightarrow
(K|_{U_i}, L|_{U_i}, M|_{U_i}).
$$
It follows from the induced map on long exact cohomology sequences and
Homology, Lemmas \ref{homology-lemma-four-lemma} and
\ref{homology-lemma-five-lemma}
that $C(\gamma_i)^\bullet \to M|_{U_i}$ induces an isomorphism
on cohomology in degrees $> m$ and a surjection in degree $m$.
Hence $M$ is $m$-pseudo-coherent by
Lemma \ref{lemma-pseudo-coherent-independent-representative}.

\medskip\noindent
Assertions (2) and (3) follow from (1) by rotating the distinguished
triangle.
\end{proof}

\begin{lemma}
\label{lemma-summands-pseudo-coherent}
Let $(X, \mathcal{O}_X)$ be a ringed space. Let $m \in \mathbf{Z}$.
If $K \oplus L$ is $m$-pseudo-coherent (resp.\ pseudo-coherent)
in $D(\mathcal{O}_X)$ so are $K$ and $L$.
\end{lemma}

\begin{proof}
Assume that $K \oplus L$ is $m$-pseudo-coherent.
After replacing $X$ by the members of an open covering we may
assume $K \oplus L \in D^-(\mathcal{O}_X)$, hence
$L \in D^-(\mathcal{O}_X)$.
Note that there is a distinguished triangle
$$
(K \oplus L, K \oplus L, L \oplus L[1]) =
(K, K, 0) \oplus (L, L, L \oplus L[1])
$$
see
Derived Categories, Lemma \ref{derived-lemma-direct-sum-triangles}.
By
Lemma \ref{lemma-cone-pseudo-coherent}
we see that $L \oplus L[1]$ is $m$-pseudo-coherent.
Hence also $L[1] \oplus L[2]$ is $m$-pseudo-coherent.
By induction $L[n] \oplus L[n + 1]$ is $m$-pseudo-coherent.
Since $L$ is bounded above we see that $L[n]$ is $m$-pseudo-coherent
for large $n$. Hence working backwards, using the distinguished triangles
$$
(L[n], L[n] \oplus L[n - 1], L[n - 1])
$$
we conclude that $L[n - 1], L[n - 2], \ldots, L$ are $m$-pseudo-coherent
as desired.
\end{proof}






\section{Tor dimension}
\label{section-tor}

\noindent
In this section we take a closer look at resolutions by flat modules.

\begin{definition}
\label{definition-tor-amplitude}
Let $(X, \mathcal{O}_X)$ be a ringed space.
Let $E$ be an object of $D(\mathcal{O}_X)$.
Let $a, b \in \mathbf{Z}$ with $a \leq b$.
\begin{enumerate}
\item We say $E$ has {\it tor-amplitude in $[a, b]$}
if $H^i(E \otimes_{\mathcal{O}_X}^\mathbf{L} \mathcal{F}) = 0$
for all $\mathcal{O}_X$-modules $\mathcal{F}$ and all $i \not \in [a, b]$.
\item We say $E$ has {\it finite tor dimension}
if it has tor-amplitude in $[a, b]$ for some $a, b$.
\item We say $E$ {\it locally has finite tor dimension}
if there exists an open covering $X = \bigcup U_i$ such that
$E|_{U_i}$ has finite tor dimension for all $i$.
\end{enumerate}
\end{definition}

\noindent
Note that if $E$ has finite tor dimension, then $E$ is an object of
$D^b(\mathcal{O}_X)$ as can be seen by taking $\mathcal{F} = \mathcal{O}_X$
in the definition above.

\begin{lemma}
\label{lemma-last-one-flat}
Let $(X, \mathcal{O}_X)$ be a ringed space.
Let $\mathcal{E}^\bullet$ be a bounded above complex of flat
$\mathcal{O}_X$-modules with tor-amplitude in $[a, b]$.
Then $\text{Coker}(d_{\mathcal{E}^\bullet}^{a - 1})$ is a flat
$\mathcal{O}_X$-module.
\end{lemma}

\begin{proof}
As $\mathcal{E}^\bullet$ is a bounded above complex of flat modules we see that
$\mathcal{E}^\bullet \otimes_{\mathcal{O}_X} \mathcal{F} =
\mathcal{E}^\bullet \otimes_{\mathcal{O}_X}^{\mathbf{L}} \mathcal{F}$
for any $\mathcal{O}_X$-module $\mathcal{F}$.
Hence for every $\mathcal{O}_X$-module $\mathcal{F}$ the sequence
$$
\mathcal{E}^{a - 2} \otimes_{\mathcal{O}_X} \mathcal{F} \to
\mathcal{E}^{a - 1} \otimes_{\mathcal{O}_X} \mathcal{F} \to
\mathcal{E}^a \otimes_{\mathcal{O}_X} \mathcal{F}
$$
is exact in the middle. Since
$\mathcal{E}^{a - 2} \to \mathcal{E}^{a - 1} \to \mathcal{E}^a \to
\text{Coker}(d^{a - 1}) \to 0$
is a flat resolution this implies that
$\text{Tor}_1^{\mathcal{O}_X}(\text{Coker}(d^{a - 1}), \mathcal{F}) = 0$
for all $\mathcal{O}_X$-modules $\mathcal{F}$. This means that
$\text{Coker}(d^{a - 1})$ is flat, see Lemma \ref{lemma-flat-tor-zero}.
\end{proof}

\begin{lemma}
\label{lemma-tor-amplitude}
Let $(X, \mathcal{O}_X)$ be a ringed space.
Let $E$ be an object of $D(\mathcal{O}_X)$.
Let $a, b \in \mathbf{Z}$ with $a \leq b$. The following are equivalent
\begin{enumerate}
\item $E$ has tor-amplitude in $[a, b]$.
\item $E$ is represented by a complex
$\mathcal{E}^\bullet$ of flat $\mathcal{O}_X$-modules with
$\mathcal{E}^i = 0$ for $i \not \in [a, b]$.
\end{enumerate}
\end{lemma}

\begin{proof}
If (2) holds, then we may compute
$E \otimes_{\mathcal{O}_X}^\mathbf{L} \mathcal{F} =
\mathcal{E}^\bullet \otimes_{\mathcal{O}_X} \mathcal{F}$
and it is clear that (1) holds.

\medskip\noindent
Assume that (1) holds. We may represent $E$ by a bounded above complex
of flat $\mathcal{O}_X$-modules $\mathcal{K}^\bullet$, see
Section \ref{section-flat}.
Let $n$ be the largest integer such that $\mathcal{K}^n \not = 0$.
If $n > b$, then $\mathcal{K}^{n - 1} \to \mathcal{K}^n$ is surjective as
$H^n(\mathcal{K}^\bullet) = 0$. As $\mathcal{K}^n$ is flat we see that
$\text{ker}(\mathcal{K}^{n - 1} \to \mathcal{K}^n)$ is flat
(Modules, Lemma \ref{modules-lemma-flat-ses}).
Hence we may replace $\mathcal{K}^\bullet$ by
$\tau_{\leq n - 1}\mathcal{K}^\bullet$. Thus, by induction on $n$, we
reduce to the case that $K^\bullet$ is a complex of flat
$\mathcal{O}_X$-modules with $\mathcal{K}^i = 0$ for $i > b$.

\medskip\noindent
Set $\mathcal{E}^\bullet = \tau_{\geq a}\mathcal{K}^\bullet$.
Everything is clear except that $\mathcal{E}^a$ is flat
which follows immediately from Lemma \ref{lemma-last-one-flat}
and the definitions.
\end{proof}

\begin{lemma}
\label{lemma-cone-tor-amplitude}
Let $(X, \mathcal{O}_X)$ be a ringed space.
Let $(K, L, M, f, g, h)$ be a distinguished
triangle in $D(\mathcal{O}_X)$. Let $a, b \in \mathbf{Z}$.
\begin{enumerate}
\item If $K$ has tor-amplitude in $[a + 1, b + 1]$ and
$L$ has tor-amplitude in $[a, b]$ then $M$ has
tor-amplitude in $[a, b]$.
\item If $K$ and $M$ have tor-amplitude in $[a, b]$, then
$L$ has tor-amplitude in $[a, b]$.
\item If $L$ has tor-amplitude in $[a + 1, b + 1]$
and $M$ has tor-amplitude in $[a, b]$, then
$K$ has tor-amplitude in $[a + 1, b + 1]$.
\end{enumerate}
\end{lemma}

\begin{proof}
Omitted. Hint: This just follows from the long exact cohomology sequence
associated to a distinguished triangle and the fact that
$- \otimes_{\mathcal{O}_X}^{\mathbf{L}} \mathcal{F}$
preserves distinguished triangles.
The easiest one to prove is (2) and the others follow from it by
translation.
\end{proof}

\begin{lemma}
\label{lemma-summands-tor-amplitude}
Let $(X, \mathcal{O}_X)$ be a ringed space. Let $a, b \in \mathbf{Z}$.
For $K$, $L$ objects of $D(\mathcal{O}_X)$ if $K \oplus L$ has tor
amplitude in $[a, b]$ so do $K$ and $L$.
\end{lemma}

\begin{proof}
Clear from the fact that the Tor functors are additive.
\end{proof}






\section{Perfect complexes}
\label{section-perfect}

\noindent
In this section we discuss properties of perfect complexes on
ringed spaces.

\begin{definition}
\label{definition-perfect}
Let $(X, \mathcal{O}_X)$ be a ringed space.
Let $\mathcal{E}^\bullet$ be a complex of $\mathcal{O}_X$-modules.
We say $\mathcal{E}^\bullet$ is {\it perfect} if there exists
an open covering $X = \bigcup U_i$ such that for each $i$
there exists a morphism of complexes
$\mathcal{E}_i^\bullet \to \mathcal{E}^\bullet|_{U_i}$
which is a quasi-isomorphism with $\mathcal{E}_i^\bullet$
strictly perfect.
An object $E$ of of $D(\mathcal{O}_X)$ is {\it perfect}
if it can be represented by a perfect complex of $\mathcal{O}_X$-modules.
\end{definition}

\begin{lemma}
\label{lemma-perfect-independent-representative}
Let $(X, \mathcal{O}_X)$ be a ringed space.
Let $E$ be an object of $D(\mathcal{O}_X)$.
\begin{enumerate}
\item If there exists an open covering $X = \bigcup U_i$,
strictly perfect complexes $\mathcal{E}_i^\bullet$ on $U_i$,
and isomorphisms $\alpha_i : \mathcal{E}_i^\bullet \to E|_{U_i}$ in
$D(\mathcal{O}_{U_i})$, then $E$ is perfect.
\item If $E$ is perfect, then any complex representing $E$ is perfect.
\end{enumerate}
\end{lemma}

\begin{proof}
Identical to the proof of
Lemma \ref{lemma-pseudo-coherent-independent-representative}.
\end{proof}

\begin{lemma}
\label{lemma-perfect-precise}
Let $(X, \mathcal{O}_X)$ be a ringed space.
Let $E$ be an object of $D(\mathcal{O}_X)$.
Let $a \leq b$ be integers. If $E$ has tor amplitude in $[a, b]$
and is $(a - 1)$-pseudo-coherent, then $E$ is perfect.
\end{lemma}

\begin{proof}
After replacing $X$ by the members of an open covering we may assume there
exists a strictly perfect complex $\mathcal{E}^\bullet$ and a map
$\alpha : \mathcal{E}^\bullet \to E$ such that $H^i(\alpha)$ is an isomorphism
for $i \geq a$. We may and do replace $\mathcal{E}^\bullet$ by
$\sigma_{\geq a - 1}\mathcal{E}^\bullet$. Choose a distinguished triangle
$$
\mathcal{E}^\bullet \to E \to C \to \mathcal{E}^\bullet[1]
$$
From the vanhising of cohomology sheaves of $E$ and $\mathcal{E}^\bullet$
and the assumption on $\alpha$ we obtain $C \cong \mathcal{K}[a - 2]$ with
$\mathcal{K} = \text{Ker}(\mathcal{E}^{a - 1} \to \mathcal{E}^a)$.
Let $\mathcal{F}$ be an $\mathcal{O}_X$-module.
Applying $- \otimes_{\mathcal{O}_X}^\mathbf{L} \mathcal{F}$
the assumption that $E$ has tor amplitude in $[a, b]$
implies $\mathcal{K} \otimes_{\mathcal{O}_X} \mathcal{F} \to
\mathcal{E}^{a - 1} \otimes_{\mathcal{O}_X} \mathcal{F}$ has image
$\text{Ker}(\mathcal{E}^{a - 1} \otimes_{\mathcal{O}_X} \mathcal{F}
\to \mathcal{E}^a \otimes_{\mathcal{O}_X} \mathcal{F})$.
It follows that $\text{Tor}_1^{\mathcal{O}_X}(\mathcal{E}', \mathcal{F}) = 0$
where $\mathcal{E}' = \text{Coker}(\mathcal{E}^{a - 1} \to \mathcal{E}^a)$.
Hence $\mathcal{E}'$ is flat (Lemma \ref{lemma-flat-tor-zero}).
Thus $\mathcal{E}'$ is locally a direct summand of a finite free module by
Modules, Lemma \ref{modules-lemma-flat-locally-finite-presentation}.
Thus locally the complex
$$
\mathcal{E}' \to \mathcal{E}^{a - 1} \to \ldots \to \mathcal{E}^b
$$
is quasi-isomorphic to $E$ and $E$ is perfect.
\end{proof}

\begin{lemma}
\label{lemma-perfect}
Let $(X, \mathcal{O}_X)$ be a ringed space.
Let $E$ be an object of $D(\mathcal{O}_X)$.
The following are equivalent
\begin{enumerate}
\item $E$ is perfect, and
\item $E$ is pseudo-coherent and locally has finite tor dimension.
\end{enumerate}
\end{lemma}

\begin{proof}
Assume (1). By definition this means there exists an open covering
$X = \bigcup U_i$ such that $E|_{U_i}$ is represented by a
strictly perfect complex. Thus $E$ is pseudo-coherent (i.e.,
$m$-pseudo-coherent for all $m$) by
Lemma \ref{lemma-pseudo-coherent-independent-representative}.
Moreover, a direct summand of a finite free module is flat, hence
$E|_{U_i}$ has finite Tor dimension by
Lemma \ref{lemma-tor-amplitude}. Thus (2) holds.

\medskip\noindent
Assume (2). After replacing $X$ by the members of an open covering
we may assume there exist integers $a \leq b$ such that $E$
has tor amplitude in $[a, b]$. Since $E$ is $m$-pseudo-coherent
for all $m$ we conclude using Lemma \ref{lemma-perfect-precise}.
\end{proof}

\begin{lemma}
\label{lemma-two-out-of-three-perfect}
Let $(X, \mathcal{O}_X)$ be a ringed space. Let $(K, L, M, f, g, h)$
be a distinguished triangle in $D(\mathcal{O}_X)$. If two out of three of
$K, L, M$ are perfect then the third is also perfect.
\end{lemma}

\begin{proof}
First proof: Combine
Lemmas \ref{lemma-perfect}, \ref{lemma-cone-pseudo-coherent}, and
\ref{lemma-cone-tor-amplitude}.
Second proof (sketch): Say $K$ and $L$ are perfect. After replacing
$X$ by the members of an open covering we may assume that $K$ and $L$
are represented by strictly perfect complexes $\mathcal{K}^\bullet$
and $\mathcal{L}^\bullet$. After replacing $X$ by the members
of an open covering we may assume the map $K \to L$ is given by
a map of complexes $\alpha : \mathcal{K}^\bullet \to \mathcal{L}^\bullet$,
see Lemma \ref{lemma-local-actual}.
Then $M$ is isomorphic to the cone of $\alpha$ which is strictly
perfect by Lemma \ref{lemma-cone}.
\end{proof}

\begin{lemma}
\label{lemma-summands-perfect}
Let $(X, \mathcal{O}_X)$ be a ringed space.
If $K \oplus L$ is a perfect object of $D(\mathcal{O}_X)$, then
so are $K$ and $L$.
\end{lemma}

\begin{proof}
Follows from
Lemmas \ref{lemma-perfect}, \ref{lemma-summands-pseudo-coherent}, and
\ref{lemma-summands-tor-amplitude}.
\end{proof}







\input{chapters}

\bibliography{my}
\bibliographystyle{amsalpha}

\end{document}
