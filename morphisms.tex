\input{preamble}

% OK, start here.
%
\begin{document}

\title{Morphisms of schemes}


\maketitle

\tableofcontents

\section{Introduction}
\label{section-introduction}

\noindent
In this chapter we introduce some types of morphisms of schemes.
A basic reference is \cite{EGA}.




















\section{Closed immersions}
\label{section-closed-immersions}


\noindent
In this section we summarize some of the results obtained
previously on closed immersions of schemes.

\begin{lemma}
\label{lemma-closed-immersion}
Let $i : Z \to X$ be a morphism of schemes.
The following are equivalent:
\begin{enumerate}
\item The morphism $i$ is a closed immersions.
\item For every affine open $\text{Spec}(R) = U \subset X$,
there exists an ideal $I \subset R$ such that
$i^{-1}(U) = \text{Spec}(R/I)$ as schemes over $U = \text{Spec}(R)$.
\item There exists an affine open covering $X = \bigcup_{j \in J} U_j$,
$U_j = \text{Spec}(R_j)$ and for every $j \in J$ there exists
an ideal $I_j \subset R_j$ such that
$i^{-1}(U_j) = \text{Spec}(R_j/I_j)$ as schemes over $U_j = \text{Spec}(R_j)$.
\item The morphism $i$ induces a homeomorphism of $Z$ with a closed subset
of $X$ and $i^\sharp : \mathcal{O}_X \to i_*\mathcal{O}_Z$ is surjective.
\item The morphism $i$ induces a homeomorphism of $Z$ with a closed subset
of $X$, the map $i^\sharp : \mathcal{O}_X \to i_*\mathcal{O}_Z$ is surjective,
and the kernel $\text{Ker}(i^\sharp)\subset \mathcal{O}_X$ is a quasi-coherent
sheaf of ideals.
\item The morphism $i$ induces a homeomorphism of $Z$ with a closed subset
of $X$, the map $i^\sharp : \mathcal{O}_X \to i_*\mathcal{O}_Z$ is surjective,
and the kernel $\text{Ker}(i^\sharp)\subset \mathcal{O}_X$ is a
sheaf of ideals which is locally generated by sections.
\end{enumerate}
\end{lemma}

\begin{proof}
Condition (6) is our definition of a closed immersion, see Schemes,
Definitions \ref{schemes-definition-closed-immersion-locally-ringed-spaces}
and \ref{schemes-definition-immersion}.
So (6) $\Leftrightarrow$ (1). We have (1) $\Rightarrow$ (2) by
Schemes, Lemma \ref{schemes-lemma-closed-subspace-scheme}.
Trivially (2) $\Rightarrow$ (3).

\medskip\noindent
Assume (3). Each of the morphisms
$\text{Spec}(R_j/I_j) \to \text{Spec}(R_j)$ is
a closed immersion, see
Schemes, Example \ref{schemes-example-closed-immersion-affines}.
Hence $i^{-1}(U_j) \to U_j$ is a homeomorphism onto its image
and $i^\sharp|_{U_j}$ is surjective. Hence $i$ is a homeomorphism
onto its image and $i^\sharp$ is surjective since this may be
checked locally. We conclude that (3) $\Rightarrow$ (4).

\medskip\noindent
The implication (4) $\Rightarrow$ (1) is 
Schemes, Lemma \ref{schemes-lemma-characterize-closed-immersions}.
The implication (5) $\Rightarrow$ (6) is trivial.
And the implication (6) $\Rightarrow$ (5) follows
from Schemes, Lemma \ref{schemes-lemma-closed-subspace-scheme}.
\end{proof}

\begin{lemma}
\label{lemma-closed-immersion-ideals}
Let $X$ be a scheme.
Suppose $i : Z \to X$ and $i' : Z' \to X$ are closed immersions
corresponding to the quasi-coherent
ideal sheaves $\mathcal{I} = \text{Ker}(i^\sharp)$
and $\mathcal{I}' = \text{Ker}((i')^\sharp)$ of $\mathcal{O}_X$.
\begin{enumerate}
\item The morphism $i : Z \to X$ factors as $Z \to Z' \to X$
for some $a : Z \to Z'$
if and only if $\mathcal{I}' \subset \mathcal{I}$.
If this happens, then $a$ is a closed immersion.
\item We have $Z \cong Z'$ as schemes over $X$ if and only if
$\mathcal{I} = \mathcal{I}'$.
\end{enumerate}
\end{lemma}

\begin{proof}
This follows from our discussion of closed subspaces in
Schemes, Section \ref{schemes-section-closed-immersion} especially
Schemes, Lemma \ref{schemes-lemma-characterize-closed-subspace}.
It also follows in a straightforward way from characterization
(3) in Lemma \ref{lemma-closed-immersion} above.
\end{proof}

\begin{lemma}
\label{lemma-closed-immersion-bijection-ideals}
Let $X$ be a scheme.
Let $\mathcal{I} \subset \mathcal{O}_X$ be a sheaf of ideals.
The following are equivalent:
\begin{enumerate}
\item The sheaf of ideals $\mathcal{I}$ is locally generated by
sections as a sheaf of $\mathcal{O}_X$ modules.
\item The sheaf of ideals $\mathcal{I}$ is quasi-coherent as
a sheaf of $\mathcal{O}_X$-modules.
\item There exists a closed immersion $i : Z \to X$ whose
corresponding sheaf of ideals $\text{Ker}(i^\sharp)$ is
equal to $\mathcal{I}$.
\end{enumerate}
\end{lemma}

\begin{proof}
In Schemes, Section \ref{schemes-section-closed-immersion} we constructed
the closed subspace associated to a sheaf of ideals locally generated
by sections. This closed subspace is a scheme by
Schemes, Lemma \ref{schemes-lemma-closed-subspace-scheme}.
Hence we see that (1) $\Rightarrow$ (3) by our definition
of a closed immersion of schemes. By Lemma \ref{lemma-closed-immersion}
above we see that (3) $\Rightarrow$ (2). And of course (2) $\Rightarrow$ (1).
\end{proof}

\begin{lemma}
\label{lemma-base-change-closed-immersion}
The base change of a closed immersion is a closed immersion.
\end{lemma}

\begin{proof}
See Schemes, Lemma \ref{schemes-lemma-base-change-immersion}.
\end{proof}

\begin{lemma}
\label{lemma-composition-closed-immersion}
A composition of closed immersions is a closed immersion.
\end{lemma}

\begin{proof}
This is clear from the characterization (3) of closed immersions
in Lemma \ref{lemma-closed-immersion}. Since if $I \subset R$
is an ideal, and $\overline{J} \subset R/I$ is an ideal, then
$\overline{J} = J/I$ for some ideal $J \subset R$ which contains
$I$ and $(R/I)/\overline{J} = R/J$.
\end{proof}

\begin{lemma}
\label{lemma-factor-quasi-compact-immersion}
Let $h : Z \to X$ be an immersion.
If $h$ is quasi-compact, then we can factor
$h = i \circ j$ with $j : Z \to \overline{Z}$ an
open immersion and $i : \overline{Z} \to X$ a closed immersion.
\end{lemma}

\begin{proof}
Note that $h$ is quasi-compact and quasi-separated (see
Schemes, Lemma \ref{schemes-lemma-immersions-monomorphisms}).
Hence $h_*\mathcal{O}_Z$ is a quasi-coherent sheaf of $\mathcal{O}_X$-modules
by Schemes, Lemma \ref{schemes-lemma-push-forward-quasi-coherent}.
This implies that
$\mathcal{I} = \text{Ker}(\mathcal{O}_X \to h_*\mathcal{O}_Z)$
is a quasi-coherent sheaf of ideals, see
Schemes, Section \ref{schemes-section-quasi-coherent}.
Let $\overline{Z} \subset X$ be the closed subscheme corresponding
to $\mathcal{I}$, see Lemma \ref{lemma-closed-immersion-bijection-ideals}.
By Schemes, Lemma \ref{schemes-lemma-characterize-closed-subspace}
the morphism $h$ factors as 
$h = i \circ j$ where $i : \overline{Z} \to X$ is the inclusion morphism.
To see that $j$ is an open immersion, choose an open subscheme
$U \subset X$ such that $h$ induces a closed immersion of $Z$
into $U$. Then it is clear that $\mathcal{I}|_U$ is the
sheaf of ideals corresponding to the closed immersion $Z \to U$.
Hence we see that $Z = \overline{Z} \cap U$.
\end{proof}

\begin{example}
\label{example-thibaut}
Here is an example of an immersion which is not a composition of an
open immersion followed by a closed immersion.
Let $k$ be a field.
Let $X = \text{Spec}(k[x_1, x_2, x_3, \ldots])$.
Let $U = \bigcup_{n = 1}^{\infty} D(x_n)$.
Then $U \to X$ is an open immersion.
Consider the ideals
$$
I_n =
(x_1^n, x_2^n, \ldots, x_{n - 1}^n, x_n - 1, x_{n + 1}, x_{n + 2}, \ldots)
\subset
k[x_1, x_2, x_3, \ldots][1/x_n].
$$
Note that $I_n k[x_1, x_2, x_3, \ldots][1/x_nx_m] = (1)$
for any $m \not = n$. Hence the quasi-coherent ideals
$\widetilde I_n$ on $D(x_n)$ agree on $D(x_nx_m)$, namely
$\widetilde I_n|_{D(x_nx_m)} = \mathcal{O}_{D(x_n x_m)}$ if
$n \not = m$. Hence these ideals glue to a quasi-coherent sheaf of ideals
$\mathcal{I} \subset \mathcal{O}_U$.
Let $Z \subset U$ be the closed subscheme corresponding to
$\mathcal{I}$. Thus $Z \to X$ is an immersion.

\medskip\noindent
We claim that we cannot factor $Z \to X$ as
$Z \to \overline{Z} \to X$, where $\overline{Z} \to X$ is closed
and $Z \to \overline{Z}$ is open. Namely, $\overline{Z}$ would
have to be defined by an ideal $I \subset k[x_1, x_2, x_3, \ldots]$
such that $I_n = I k[x_1, x_2, x_3, \ldots][1/x_n]$.
But the only element $f \in k[x_1, x_2, x_3, \ldots]$
which ends up in all $I_n$ is $0$! Hence $I$ does not exist.
\end{example}


\section{Scheme theoretic image}
\label{section-scheme-theoretic-image}

\begin{lemma}
\label{lemma-scheme-theoretic-image}
Let $f : X \to Y$ be a morphism of schemes. There exists a closed
subscheme $Z \subset Y$ such that $f$ factors through $Z$ and such
that for any other closed subscheme $Z' \subset Y$ such that $f$
factors through $Z'$ we have $Z \subset Z'$.
\end{lemma}

\begin{proof}
Let $\mathcal{I} = \text{Ker}(\mathcal{O}_Y \to f_*\mathcal{O}_X)$.
If $\mathcal{I}$ is quasi-coherent then we just take $Z$ to be the
closed subscheme determined by $\mathcal{I}$. This works by
by Schemes, Lemma \ref{schemes-lemma-characterize-closed-subspace}.
In general the same lemma requires us to show that there exists
a largest quasi-coherent sheaf of ideals contained in $\mathcal{I}$.
Let $\mathcal{I}_a$, $a \in A$ be the set of quasi-coherent
ideals contained in $\mathcal{I}$. Then the image of
$$
\bigoplus\nolimits_{a \in A} \mathcal{I}_a \longrightarrow \mathcal{O}_Y
$$
is quasi-coherent (as the image of a map of quasi-coherent sheaves
on $Y$, see Schemes, Section \ref{schemes-section-quasi-coherent}), and it is
contained in $\mathcal{I}$. Hence this is the largest quasi-coherent
sheaf of ideals contained in $\mathcal{I}$.
\end{proof}

\begin{definition}
\label{definition-scheme-theoretic-image}
Let $f : X \to Y$ be a morphism of schemes. The {\it scheme theoretic image}
of $f$ is the smallest closed subscheme $Z \subset Y$ through which $f$
factors, see Lemma \ref{lemma-scheme-theoretic-image} above.
\end{definition}

\noindent
We often just denote $f : X \to Z$ the factorization of $f$.
If the morphism $f$ is not quasi-compact, then (in general) the
construction of the scheme theoretic image does not commute with
restriction to open subschemes to $Y$. Namely, if $f$ is the
immersion $Z \to X$ of Example \ref{example-thibaut} above then
the scheme theoretic image of $Z \to X$ is $X$. But clearly the
scheme theoretic image of $Z = Z \cap U \to U$ is just $Z$.

\begin{lemma}
\label{lemma-quasi-compact-scheme-theoretic-image}
Let $f : X \to Y$ be a morphism of schemes.
Let $Z \subset Y$ be the scheme theoretic image of $f$.
If $f$ is quasi-compact then
\begin{enumerate}
\item the sheaf of ideals
$\mathcal{I} = \text{Ker}(\mathcal{O}_Y \to f_*\mathcal{O}_X)$
is quasi-coherent,
\item the scheme theoretic image $Z$ is the closed subscheme
determined by $\mathcal{I}$,
\item for any open $U \subset Y$ the scheme theoretic image of
$f|_{f^{-1}(U)} : f^{-1}(U) \to U$ is equal to $Z \cap U$, and
\item the image $f(X) \subset Z$ is a dense subset of $Z$, in other
words the morphism $Z \to Z$ is dominant
(see Definition \ref{definition-dominant}).
\end{enumerate}
\end{lemma}

\begin{proof}
Part (4) follows from part (3). To show (3) it suffices
to prove (1) since the formation of $\mathcal{I}$ commutes with restriction to
open subschemes of $Y$. And if (1) holds then in
the proof of Lemma \ref{lemma-scheme-theoretic-image} we showed (2).
Thus it suffice to prove that $\mathcal{I}$ is quasi-coherent
Since the property of being quasi-coherent is
local we may assume $Y$ is affine. As $f$ is quasi-compact,
we can find a finite affine open covering
$X = \bigcup_{i = 1, \ldots, n} U_i$. Denote $f'$ the composition
$$
X' = \coprod U_i \longrightarrow X \longrightarrow Y.
$$
Then $f_*\mathcal{O}_X$ is a subsheaf of $f'_*\mathcal{O}_{X'}$,
and hence $\mathcal{I} = \text{Ker}(\mathcal{O}_Y \to \mathcal{O}_{X'})$.
By Schemes, Lemma \ref{schemes-lemma-push-forward-quasi-coherent}
the sheaf $f'_*\mathcal{O}_{X'}$ is quasi-coherent on $Y$. Hence we win.
\end{proof}

\begin{lemma}
\label{lemma-factor-factor}
Let $f_1 : X \to Y_1$ and $Y_1 \to Y_2$ be morphisms of schemes.
Let $f_2 : X \to Y_2$ be the composition. Let $Z_i \subset Y_i$, $i = 1, 2$ be
the scheme theoretic image of $f_i$. Then the morphism
$Y_1 \to Y_2$ induces a morphism $Z_1 \to Z_2$ and a
commutative diagram
$$
\xymatrix{
X \ar[r] \ar[rd] & Z_1 \ar[d] \ar[r] & Y_1 \ar[d] \\
& Z_2 \ar[r] & Y_2
}
$$
\end{lemma}

\begin{proof}
See Schemes, Lemma \ref{schemes-lemma-characterize-closed-subspace}.
\end{proof}

\begin{definition}
\label{definition-scheme-theoretically-dense}
Let $X$ be a scheme. Let $U \subset X$ be an open subscheme.
\begin{enumerate}
\item The scheme theoretic image of the morphism $U \to X$
is called the {\it scheme theoretic closure of $U$ in $X$}.
\item We say {\it $U$ is scheme theoretically dense in $X$}
if the scheme theoretic closure of $U$ is equal to $X$.
\end{enumerate}
\end{definition}

\begin{example}
\label{example-scheme-theretically-dense-not-dense}
Here is an example where scheme theoretically dense does not
imply dense for the underlying topological spaces.
Let $k$ be a field.
Set $A = k[x, z_1, z_2, \ldots]/(x^n z_n)$
Set $I = (z_1, z_2, \ldots) \subset A$.
Consider the affine scheme $X = \text{Spec}(A)$ and the
open subscheme $U = X \setminus V(I)$.
Since $A \to \prod_n A_{z_n}$ is injective we see that $U$
is schematically dense in $X$. Consider the morphism
$X \to \text{Spec}(k[x])$. This morphism is surjective
(set all $z_n = 0$ to see this). But the restriction
of this morphism to $U$ is not surjective because it maps
to the point $x = 0$. Hence $U$ cannot be topologically dense
in $X$.
\end{example}

\begin{lemma}
\label{lemma-quasi-compact-immersion}
Let $Z \to X$ be a quasi-compact immersion.
Let $\overline{Z} \subset X$ be the scheme theoretic image of $h$.
Then the morphism $Z \to \overline{Z}$ is an open immersion
which identifies $Z$ with a scheme theoretically dense open
subscheme of $\overline{Z}$. Moreover, $Z$ is topologically
dense in $\overline{Z}$.
\end{lemma}

\begin{proof}
By Lemma \ref{lemma-factor-quasi-compact-immersion} we can factor
$Z \to X$ as $Z \to \overline{Z}_1 \to X$ with $Z \to \overline{Z}_1$
open and $\overline{Z}_1 \to X$ closed. On the other hand, let
$Z \to \overline{Z} \subset X$ be the scheme theoretic closure of
$Z \to X$. We conclude that $\overline{Z} \subset \overline{Z}_1$.
Since $Z$ is an open subscheme of $\overline{Z}_1$ it follows
that $Z$ is an open subscheme of $\overline{Z}$ as well. The last
assertion follows from Lemma \ref{lemma-factor-quasi-compact-immersion}
part (4).
\end{proof}

\begin{lemma}
\label{lemma-equality-of-morphisms}
Let $S$ be a scheme. Let $X$, $Y$ be schemes over $S$.
Let $f, g : X \to Y$ be morphisms of schemes over $S$.
Let $U \subset X$ be an open subscheme such that
$f|_U = g|_U$. If $U$ is scheme theoretically dense in
$X$ and $Y \to S$ is separated, then $f = g$.
\end{lemma}

\begin{proof}
Follows from the definitions and
Schemes, Lemma \ref{schemes-lemma-where-are-they-equal}.
\end{proof}




\section{Dominant morphisms}
\label{section-dominant}

\noindent
The definition of a morphism of schemes being dominant is a little
different from what you might expect if you are used to the notion
of a dominant morphism of varieties.

\begin{definition}
\label{definition-dominant}
A morphism $f : X \to S$ of schemes is called {\it dominant} if the
image of $f$ is a dense subset of $S$.
\end{definition}

\noindent
So for example, if $k$ is an infinite field and $\lambda_1, \lambda_2, \ldots$
is a countable collection of elements of $k$, then the morphism
$$
\coprod\nolimits_{i = 1,2,\ldots } \text{Spec}(k) 
\longrightarrow
\text{Spec}(k[x])
$$
with $i$th factor mapping to the point $x = \lambda_i$ is dominant.

\begin{lemma}
\label{lemma-generic-points-in-image-dominant}
Let $f : X \to S$ be a morphism of schemes.
If every generic point of every irreducible component of $S$
is in the image of $f$, then $f$ is dominant.
\end{lemma}

\begin{proof}
This is a topological fact which follows directly from the fact that
the topological space underlying a scheme is sober, see
Schemes, Lemma \ref{schemes-lemma-scheme-sober}, and that
every point of $S$ is contained in an irreducible component of
$S$, see Topology, Lemma \ref{topology-lemma-irreducible}.
\end{proof}

\noindent
The expectation that morphisms are dominant only if generic points of the
target are in the image does hold if the morphism is quasi-compact.

\begin{lemma}
\label{lemma-quasi-compact-dominant}
Let $f : X \to S$ be a quasi-compact morphism of schemes.
Then $f$ is dominant (if and) only if for every irreducible
component $Z \subset S$ the generic point of $Z$ is in the
image of $f$.
\end{lemma}

\begin{proof}
Let $V \subset S$ be an affine open.
Because $f$ is quasi-compact we may choose finitely many affine
opens $U_i \subset f^{-1}(V)$, $i = 1, \ldots, n$ covering
$f^{-1}(V)$. Consider the morphism of affines
$$
f' :
\coprod\nolimits_{i = 1, \ldots, n} U_i 
\longrightarrow
V.
$$
A disjoint union of affines is affine, see
Schemes, \ref{schemes-lemma-disjoint-union-affines}.
Generic points of irreducible components of $V$
are exactly the generic points of the irreducible components of
$S$ that meet $V$. Also, $f$ is dominant if and only $f'$ is dominant
no matter what choices of $V, n, U_i$ we make above. Thus we
have reduced the lemma to the case of a morphism of affine schemes.
The affine case is
Algebra, Lemma \ref{algebra-lemma-image-dense-generic-points}.
\end{proof}

\noindent
There is another case where this holds. 

\begin{lemma}
\label{lemma-dominant-finite-number-irreducible-components}
Let $f : X \to S$ be a morphism of schemes.
Suppose that $X$ has finitely many irreducible components.
Then $f$ is dominant (if and) only if for every irreducible
component $Z \subset S$ the generic point of $Z$ is in the
image of $f$. If so, then $S$ has finitely many irreducible
components as well.
\end{lemma}

\begin{proof}
Assume $f$ is dominant.
Say $X = Z_1 \cup Z_2 \cup \ldots \cup Z_n$ is the decomposition
of $X$ into irreducible components. Let $\xi_i \in Z_i$ be
its generic point, so $Z_i = \overline{\{\xi_i\}}$.
Note that $f(Z_i)$ is an irreducible subset of $S$.
Hence
$$
S = \overline{f(X)} = \bigcup \overline{f(Z_i)} =
\bigcup \overline{\{f(\xi_i)\}}
$$
is a finite union if irreducible subsets whose generic
points are in the image of $f$. The lemma follows.
\end{proof}






\section{Birational morphisms}
\label{section-birational}

\noindent
You may be used to the notion of a birational map of varieties
having the property that it is an isomorphism over an open subset
of the target. However, in general a birational morphism may
not be an isomorphism over any nonempty open, see
Example \ref{example-birational-not-iso-over-open}.
Here is the formal definition.

\begin{definition}
\label{definition-birational}
Let $X$, $Y$ be schemes. Assume $X$ and $Y$ have finitely many
irreducible components. We say a morphism $f : X \to Y$ is
{\it birational} if
\begin{enumerate}
\item $f$ induces a bijection between the set of generic points
of irreducible components of $X$ and the set of generic points
of the irreducible components of $Y$, and
\item for every generic point $\eta \in X$ of an irreducible component
of $X$ the local ring map
$\mathcal{O}_{Y, f(\eta)} \to \mathcal{O}_{X, \eta}$
is an isomorphism.
\end{enumerate}
\end{definition}

\begin{lemma}
\label{lemma-birational-dominant}
Let $f : X \to Y$ be a morphism of schemes having finitely
many irreducible components. If $f$ is birational then
$f$ is dominant.
\end{lemma}

\begin{proof}
Follows immediately from the definitions.
\end{proof}

\begin{example}
\label{example-birational-not-iso-over-open}
Here is an example of a birational morphism which is not an isomorphism
over any open of the target.
Let $k$ be an infinite field.
Let $A = k[x]$. Let
$B = k[x, \{y_{\alpha}\}_{\alpha \in k}]/
((x-\alpha)y_\alpha, y_\alpha y_\beta)$.
There is an inclusion $A \subset B$ and a retraction $B \to A$
setting all $y_\alpha$ equal to zero.
Both the morphism $\text{Spec}(A) \to \text{Spec}(B)$
and the morphism $\text{Spec}(B) \to \text{Spec}(A)$ are birational
but not an isomorphism over any open.
\end{example}



\section{Surjective morphisms}
\label{section-surjective}

\begin{definition}
\label{definition-surjective}
A morphism of schemes is said to be {\it surjective}
if it is surjective on underlying topological
spaces.
\end{definition}

\begin{lemma}
\label{lemma-composition-surjective}
The composition of surjective morphisms is surjective.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-base-change-surjective}
The base change of a surjective morphism is surjective.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}




\section{Radicial morphisms}
\label{section-radicial}

\begin{definition}
\label{definition-radicial}
Let $f : X \to S$ be a morphism.
We say $f$ is {\it radicial}, or {\it universally injective}
if for every field $K$ the induced map
$\text{Mor}(\text{Spec}(K), X) \to \text{Mor}(\text{Spec}(K), S)$
is injective.
\end{definition}

\begin{lemma}
\label{lemma-radicial-universally-injective}
Let $f : X \to S$ be a morphism of schemes.
The following are equivalent:
\begin{enumerate}
\item The morphism $f$ is radicial.
\item The morphism $f$ is universally injective, i.e.,
for every morphism $S' \to S$ the base change $f' : X_{S'} \to S$
is injective on underlying topological spaces.
\item For every $s \in S$ there is at most one $x \in X$
with $f(s) = x$ and the field extension $\kappa(s) \subset \kappa(x)$
is either an equality or purely inseparable.
\end{enumerate}
\end{lemma}

\begin{proof}
Let $K$ be a field, and let $s : \text{Spec}(K) \to S$ be a morphism.
Giving a morphism $x : \text{Spec}(K) \to X$ such that $f \circ x = s$
is the same as giving a section of the projection
$X_K = \text{Spec}(K) \times_S X \to \text{Spec}(K)$, which in turn
is the same as giving a point $x \in X_K$ whose residue field is $K$.
Hence we see that (2) implies (1).

\medskip\noindent
Conversely, suppose that (1) holds. Assume that $x, x' \in X_{S'}$
map to the same point $s' \in S'$. Choose a commutative diagram
$$
\xymatrix{
K & \kappa(x) \ar[l] \\
\kappa(x') \ar[u] & \kappa(s') \ar[l] \ar[u]
}
$$
of fields. By Schemes, Lemma \ref{schemes-lemma-characterize-points}
we get two morphisms $a, a' : \text{Spec}(K) \to X_{S'}$. One corresponding
to the point $x$ and the embedding $\kappa(x) \subset K$ and
the other corresponding to the  point $x$ and the embedding
$\kappa(x') \subset K$. Also we have $f' \circ a = f' \circ a'$.
Condition (1) now implies that the compositions of $a$ and $a'$ with
$X_{S'} \to X$ are equal. Since $X_{S'}$ is the fibre product
of $S'$ and $X$ over $S$ we see that $a = a'$. Hence $x = x'$ as
desired.

\medskip\noindent
If there are two points $x, x'$ mapping to the same point of $s$
then $f$ is not radicial by the equivalence of (1) and (2) above.
If for some $s = f(x)$, $x \in X$ the field extension
$\kappa(s) \subset \kappa(x)$ is not purely inseparable, then 
we may find a field extension $\kappa(s) \subset K$ such that
$\kappa(x)$ has two $\kappa(s)$-homomorphisms into $K$. By
Schemes, Lemma \ref{schemes-lemma-characterize-points} this
implies that the map
$\text{Mor}(\text{Spec}(K), X) \to \text{Mor}(\text{Spec}(K), S)$
is not injective, and hence $f$ is not radicial.
Thus we see that (1) implies (3).

\medskip\noindent
Finally, assume (3). By
Schemes, Lemma \ref{schemes-lemma-characterize-points} a morphism
$\text{Spec}(K) \to X$ is given by a pair $(x, \kappa(x) \to K)$.
Property (3) says exactly that associating to the pair
$(x, \kappa(x) \to K)$ the pair $(s, \kappa(s) \to \kappa(x) \to K)$
is injective.
\end{proof}











\section{Affine morphisms}
\label{section-affine}

\begin{definition}
\label{definition-affine}
A morphism of schemes $f : X \to S$ is called {\it affine} if 
the inverse image of every affine open of $S$ is an affine
open of $X$.
\end{definition}

\begin{lemma}
\label{lemma-affine-separated}
An affine morphism is separated and quasi-compact.
\end{lemma}

\begin{proof}
Let $f : X \to S$ be affine. Quasi-compactness is immediate from
Schemes, Lemma \ref{schemes-lemma-quasi-compact-affine}.
We will show $f$ is separated using
Schemes, Lemma \ref{schemes-lemma-characterize-separated}. Let
$x_1, x_2 \in X$ be points of $X$ which map to the same point $s \in S$.
Choose any affine open $W \subset S$ containing $s$. By assumption
$f^{-1}(W)$ is affine. Apply the lemma cited with $U = V = f^{-1}(W)$.
\end{proof}

\begin{lemma}
\label{lemma-characterize-affine}
Let $f : X \to S$ be a morphism of schemes.
The following are equivalent
\begin{enumerate}
\item The morphism $f$ is affine.
\item There exists an affine open covering $S = \bigcup W_j$
such that each $f^{-1}(W_j)$ is affine.
\item There exists a quasi-coherent sheaf of $\mathcal{O}_S$-algebras
$\mathcal{A}$ such that $X \cong \underline{\text{Spec}}_S(\mathcal{A})$
as schemes over $S$. See
Constructions, Section \ref{constructions-section-spec} for notation.
\end{enumerate}
Moreover, in this case $X = \underline{\text{Spec}}_S(f_*\mathcal{O}_X)$.
\end{lemma}

\begin{proof}
It is obvious that (1) implies (2).

\medskip\noindent
Assume $S = \bigcup_{j \in J} W_j$ is an affine open covering such that
each $f^{-1}(W_j)$ is affine. By
Schemes, Lemma \ref{schemes-lemma-quasi-compact-affine} we see
that $f$ is quasi-compact. By
Schemes, Lemma \ref{schemes-lemma-characterize-quasi-separated}
we see the morphism $f$ is quasi-separated. Hence by
Schemes, Lemma \ref{schemes-lemma-push-forward-quasi-coherent} the
sheaf $\mathcal{A} = f_*\mathcal{O}_X$ is a quasi-coherent sheaf
of $\mathcal{O}_X$-algebras. Thus we have the scheme
$g : Y = \underline{\text{Spec}}_S(\mathcal{A}) \to S$ over $S$.
The identity map
$\text{id} : \mathcal{A} = f_*\mathcal{O}_X \to f_*\mathcal{O}_X$
provides, via the definition of the relative spectrum,
a morphism $can : X \to Y$ over $S$, see
Constructions, Lemma \ref{constructions-lemma-canonical-morphism}.
By assumption and the lemma just cited
the restriction $can|_{f^{-1}(W_j)} : f^{-1}(W_j) \to g^{-1}(W_j)$
is an isomorphism. Thus $can$ is an isomorphism.
We have shown that (2) implies (3).

\medskip\noindent
Assume (3). By Constructions, Lemma \ref{constructions-lemma-spec-properties}
we see that the inverse image of every affine open is affine, and hence
the morphism is affine by definition.
\end{proof}

\begin{remark}
\label{remark-direct-argument}
We can also argue directly that (2) implies (1) in
Lemma \ref{lemma-characterize-affine} above as follows.
Assume $S = \bigcup W_j$ is an affine open covering
such that each $f^{-1}(W_j)$ is affine.
First argue that $\mathcal{A} = f_*\mathcal{O}_X$ is quasi-coherent
as in the proof above.
Let $\text{Spec}(R) = V \subset S$ be affine open.
We have to show that $f^{-1}(V)$ is affine. Set
$A = \mathcal{A}(V) = f_*\mathcal{O}_X(V) = \mathcal{O}_X(f^{-1}(V))$.
By Schemes, Lemma \ref{schemes-lemma-morphism-into-affine} there is
a canonical morphism $\psi : f^{-1}(V) \to \text{Spec}(A)$ over
$\text{Spec}(R) = V$.
By Schemes, Lemma \ref{schemes-lemma-good-subcover} there exists
an integer $n \geq 0$, a standard open covering
$V = \bigcup_{i = 1, \ldots, n} D(h_i)$, $h_i \in R$, and a map
$a : \{1, \ldots, n\} \to J$ such that each $D(h_i)$ is also
a standard open of the affine scheme $W_{a(i)}$. The inverse image
of a standard open under a morphism of affine schemes is standard open, see
Algebra, Lemma \ref{algebra-lemma-spec-functorial}. Hence we see
that $f^{-1}(D(h_i))$ is a standard open of $f^{-1}(W_{a(i)})$,
in particular that $f^{-1}(D(h_i))$ is affine. Because $\mathcal{A}$
is quasi-coherent we have
$A_{h_i} = \mathcal{A}(D(h_i)) = \mathcal{O}_X(f^{-1}(D(h_i)))$,
so $f^{-1}(D(h_i))$ is the spectrum of $A_{h_i}$.
It follows that the morphism $\psi$ induces an isomorphism of the open
$f^{-1}(D(h_i))$ with the open $\text{Spec}(A_{h_i})$ of
$\text{Spec}(A)$. Since $f^{-1}(V) = \bigcup f^{-1}(D(h_i))$
and $\text{Spec}(A) = \bigcup \text{Spec}(A_{h_i})$ we win.
\end{remark}

\begin{lemma}
\label{lemma-affine-equivalence-algebras}
Let $S$ be a scheme. There is an anti-equivalence of categories
$$
\begin{matrix}
\text{Schemes affine} \\
\text{over }S
\end{matrix}
\longleftrightarrow
\begin{matrix}
\text{quasi-coherent sheaves} \\
\text{of }\mathcal{O}_S\text{-algebras}
\end{matrix}
$$
which associates to $f : X \to S$ the sheaf $f_*\mathcal{O}_X$.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-affine-equivalence-modules}
Let $f : X \to S$ be an affine morphism of schemes.
Let $\mathcal{A} = f_*\mathcal{O}_X$.
There are canonical equivalences between the following categories:
\begin{enumerate}
\item The category of quasi-coherent $\mathcal{O}_X$-modules.
\item The category of sheaves of $\mathcal{A}$-modules which
are quasi-coherent as sheaves of $\mathcal{O}_S$-modules.
\item The category of quasi-coherent sheaves of $\mathcal{A}$-modules.
\end{enumerate}
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-composition-affine}
The composition of affine morphisms is affine.
\end{lemma}

\begin{proof}
Let $f : X \to Y$ and $g : Y \to Z$ be affine morphisms.
Let $U \subset Z$ be affine open. Then $g^{-1}(U)$ is affine
by assumption on $g$. Whereupon $f^{-1}(g^{-1}(U))$ is affine
by assumption on $f$. Hence $(g \circ f)^{-1}(U)$ is affine.
\end{proof}

\begin{lemma}
\label{lemma-base-change-affine}
The base change of an affine morphism is affine.
\end{lemma}

\begin{proof}
Let $f : X \to S$ be an affine morphism. Let $S' \to S$ be any morphism.
Denote $f' : X_{S'} = S' \times_S X \to S'$ the base change of $f$.
For every $s' \in S'$ there exists an open affine neighbourhood
$s' \in V \subset S'$ which maps into some open affine $U \subset S$.
By assumption $f^{-1}(U)$ is affine. By the material in
Schemes, Section \ref{schemes-section-fibre-products} we see
that $f^{-1}(U)_{V} = V \times_U f^{-1}(U)$ is affine and equal
to $(f')^{-1}(V)$. This proves that $S'$ has an open covering by
affines whose inverse image under $f'$ is affine. We conclude
by Lemma \ref{lemma-characterize-affine} above.
\end{proof}

\begin{lemma}
\label{lemma-closed-immersion-affine}
A closed immersion is affine.
\end{lemma}

\begin{proof}
The first indication of this is
Schemes, Lemma \ref{schemes-lemma-closed-immersion-affine-case}.
See Schemes, Lemma \ref{schemes-lemma-closed-subspace-scheme}
for a complete statement.
\end{proof}

\begin{lemma}
\label{lemma-affine-permanence}
Suppose $g : X \to Y$ is a morphism of schemes over $S$.
If $X$ is affine over $S$ and $Y$ is separated over $S$,
then $g$ is affine.
\end{lemma}

\begin{proof}
The base change $X \times_S Y \to Y$ is affine by
Lemma \ref{lemma-base-change-affine}.
The morphism $X \to X \times_S Y$ is
a closed immersion as $Y \to S$ is separated, see
Schemes, \ref{schemes-lemma-section-immersion}.
A closed immersion is affine (see Lemma \ref{lemma-closed-immersion-affine})
and the composition of affine morphisms is affine
(see Lemma \ref{lemma-composition-affine}). Thus we win.
\end{proof}

\begin{lemma}
\label{lemma-Artinian-affine}
Let $S$ be a scheme.
Let $A$ be an Artinian ring.
Any morphism $\text{Spec}(A) \to S$ is affine.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}









\section{Quasi-affine morphisms}
\label{section-quasi-affine}

\noindent
Recall that a scheme $X$ is called {\it quasi-affine} if it is quasi-compact
and isomorphic to an open subscheme of an affine scheme, see
Properties, Definition \ref{properties-definition-quasi-affine}.

\begin{definition}
\label{definition-quasi-affine}
A morphism of schemes $f : X \to S$ is called {\it quasi-affine} if
it is quasi-compact and the inverse image of every affine open
of $S$ is a quasi-affine scheme.
\end{definition}

\begin{lemma}
\label{lemma-quasi-affine-separated}
A quasi-affine morphism is separated and quasi-compact.
\end{lemma}

\begin{proof}
Let $f : X \to S$ be quasi-affine.
Quasi-compactness is immediate from
Schemes, Lemma \ref{schemes-lemma-quasi-compact-affine}.
We will show $f$ is separated using
Schemes, Lemma \ref{schemes-lemma-characterize-separated}. Let
$x_1, x_2 \in X$ be points of $X$ which map to the same point $s \in S$.
Choose any affine open $W \subset S$ containing $s$. By assumption
$f^{-1}(W)$ is isomorphic to an open subscheme of an affine scheme,
say $f^{-1}(W) \to Y$ is such an open immersion.
Choose affine open neighbourhoods $x_1 \in U \subset f^{-1}(W)$
and $x_2 \in V \subset f^{-1}(W)$. We may think of $U$ and $V$
as open subschemes of $Y$ and hence we see that 
$U \cap V$ is affine and that
$\mathcal{O}(U) \otimes_{\mathbf{Z}} \mathcal{O}(V) \to \mathcal{O}(U \cap V)$
is surjective (by the lemma cited above applied to $U, V$ in $Y$).
Hence by the lemma cited we conclude that $f$ is separated.
\end{proof}

\begin{lemma}
\label{lemma-characterize-quasi-affine}
Let $f : X \to S$ be a morphism of schemes.
The following are equivalent
\begin{enumerate}
\item The morphism $f$ is quasi-affine.
\item There exists an affine open covering $S = \bigcup W_j$
such that each $f^{-1}(W_j)$ is quasi-affine.
\item There exists a quasi-coherent sheaf of $\mathcal{O}_S$-algebras
$\mathcal{A}$ and a quasi-compact open immersion
$$
\xymatrix{
X \ar[rr] \ar[rd] & & \underline{\text{Spec}}_S(\mathcal{A}) \ar[dl] \\
& S &
}
$$
over $S$.
\item Same as in (3) but with $\mathcal{A} = f_*\mathcal{O}_X$.
\end{enumerate}
\end{lemma}

\begin{proof}
It is obvious that (1) implies (2) and that (4) implies (3).

\medskip\noindent
Assume $S = \bigcup_{j \in J} W_j$ is an affine open covering such that
each $f^{-1}(W_j)$ is quasi-affine. By
Schemes, Lemma \ref{schemes-lemma-quasi-compact-affine} we see
that $f$ is quasi-compact. By
Schemes, Lemma \ref{schemes-lemma-characterize-quasi-separated}
we see the morphism $f$ is quasi-separated. Hence by
Schemes, Lemma \ref{schemes-lemma-push-forward-quasi-coherent} the
sheaf $\mathcal{A} = f_*\mathcal{O}_X$ is a quasi-coherent sheaf
of $\mathcal{O}_X$-algebras. Thus we have the scheme
$g : Y = \underline{\text{Spec}}_S(\mathcal{A}) \to S$ over $S$.
The identity map
$\text{id} : \mathcal{A} = f_*\mathcal{O}_X \to f_*\mathcal{O}_X$
provides, via the definition of the relative spectrum,
a morphism $can : X \to Y$ over $S$, see
Constructions, Lemma \ref{constructions-lemma-canonical-morphism}.
By assumption, the lemma just cited, and
Properties, Lemma \ref{properties-lemma-quasi-affine}
the restriction $can|_{f^{-1}(W_j)} : f^{-1}(W_j) \to g^{-1}(W_j)$
is a quasi-compact open immersion. Thus $can$ is a quasi-compact
open immersion. We have shown that (2) implies (4).

\medskip\noindent
Assume (3). Choose any affine open $U \subset S$.
By Constructions, Lemma \ref{constructions-lemma-spec-properties}
we see that the inverse image of $U$ in the relative spectrum
is affine. Hence we conclude that $f^{-1}(U)$ is quasi-affine
(note that quasi-compactness is encoded in (3) as well).
Thus (3) implies (1).
\end{proof}

\begin{lemma}
\label{lemma-composition-quasi-affine}
The composition of quasi-affine morphisms is quasi-affine.
\end{lemma}

\begin{proof}
Let $f : X \to Y$ and $g : Y \to Z$ be quasi-affine morphisms.
Let $U \subset Z$ be affine open. Then $g^{-1}(U)$ is quasi-affine
by assumption on $g$. Let $j : g^{-1}(U) \to V$ be a quasi-compact
open immersion into an affine scheme $V$.
By Lemma \ref{lemma-characterize-quasi-affine} above
we see that $f^{-1}(g^{-1}(U))$
is a quasi-compact open subscheme of the relative spectrum
$\underline{\text{Spec}}_{g^{-1}(U)}(\mathcal{A})$ for
some quasi-coherent sheaf of $\mathcal{O}_{g^{-1}(U)}$-algebras
$\mathcal{A}$. By
Schemes, Lemma \ref{schemes-lemma-push-forward-quasi-coherent}
the sheaf $\mathcal{A}' = j_*\mathcal{A}$
is a quasi-coherent sheaf of $\mathcal{O}_V$-algebras
with the property that $j^*\mathcal{A}' = \mathcal{A}$.
Hence we get a commutative diagram
$$
\xymatrix{
f^{-1}(g^{-1}(U)) \ar[r] &
\underline{\text{Spec}}_{g^{-1}(U)}(\mathcal{A})
\ar[r] \ar[d] &
\underline{\text{Spec}}_{V}(\mathcal{A}') \ar[d] \\
& g^{-1}(U) \ar[r]^j & V
}
$$
with the square being a fibre square,
see Constructions, Lemma \ref{constructions-lemma-spec-properties}.
Note that the upper right corner is an affine scheme.
Hence $(g \circ f)^{-1}(U)$ is quasi-affine.
\end{proof}

\begin{lemma}
\label{lemma-base-change-quasi-affine}
The base change of a quasi-affine morphism is quasi-affine.
\end{lemma}

\begin{proof}
Let $f : X \to S$ be a quasi-affine morphism.
By Lemma \ref{lemma-characterize-quasi-affine} above
we can find a quasi-coherent sheaf
of $\mathcal{O}_S$-algebras $\mathcal{A}$ and a quasi-compact
open immersion $X \to \underline{\text{Spec}}_S(\mathcal{A})$
over $S$.
Let $g : S' \to S$ be any morphism.
Denote $f' : X_{S'} = S' \times_S X \to S'$ the base change of $f$.
Since the base change of a quasi-compact open immersion is
a quasi-compact open immersion we see that
$X_{S'} \to \underline{\text{Spec}}_{S'}(g^*\mathcal{A})$
is a quasi-compact open immersion
(we have used Schemes, Lemmas
\ref{schemes-lemma-quasi-compact-preserved-base-change} and
\ref{schemes-lemma-base-change-immersion} and
Constructions, Lemma \ref{constructions-lemma-spec-properties}).
By Lemma \ref{lemma-characterize-quasi-affine} again
we conclude that $X_{S'} \to S'$ is quasi-affine.
\end{proof}

\begin{lemma}
\label{lemma-affine-quasi-affine}
Let $S$ be a scheme. Let $X$ be an affine scheme.
A morphism $X \to S$ is quasi-affine
if and only if it is quasi-compact.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}












\section{Types of morphisms defined by properties of ring maps}
\label{section-properties-ring-maps}

\noindent
In this section we study what properties of ring maps
allow one to define local properties of morphisms of schemes.

\begin{definition}
\label{definition-property-local}
Let $P$ be a property of ring maps.
\begin{enumerate}
\item We say that $P$ is {\it local} if the following hold:
\begin{enumerate}
\item For any ring map $R \to A$, and any $f \in R$ we have
$P(R \to A) \Rightarrow P(R_f \to A_f)$.
\item For any rings $R$, $A$, any $f \in R$, $a\in A$, and any ring map
$R_f \to A$ we have $P(R_f \to A) \Rightarrow P(R \to A_a)$.
\item For any ring map $R \to A$, and $a_i \in A$ such that
$(a_1, \ldots, a_n) = A$ then
$\forall i, P(R \to A_{a_i}) \Rightarrow P(R \to A)$.
\end{enumerate}
\item We say that $P$ is {\it stable under base change} if for any
ring maps $R \to A$, $R \to R'$ we have
$P(R \to A) \Rightarrow P(R' \to R' \otimes_R A)$.
\item We say that $P$ is {\it stable under composition} if for any
ring maps $A \to B$, $B \to C$ we have
$P(A \to B) \wedge P(B \to C) \Rightarrow P(A \to C)$.
\end{enumerate}
\end{definition}

\begin{definition}
\label{definition-locally-P}
Let $P$ be a property of ring maps.
Let $f : X \to S$ be a morphisms of schemes.
We say $f$ {\it is locally of type $P$} if for any $x \in X$
there exists an affine open neighbourhood $U$ of $x$
in $X$ which maps into an affine open $V \subset S$ such that
the induced ring map $\mathcal{O}_S(V) \to \mathcal{O}_X(U)$
has property $P$.
\end{definition}

\noindent
This is not a ``good'' definition unless the property $P$ is
a local property. Even if $P$ is a local property we will not
automatically use this definition to say that a morphism is
``locally of type $P$'' unless we also explicitly state the
definition elsewhere.

\begin{lemma}
\label{lemma-locally-P}
Let $f : X \to S$ be a morphism of schemes.
Let $P$ be a property of ring maps.
Let $\text{Spec}(A) = U$ be an affine open of $X$,
and $\text{Spec}(R) = V$ an affine open of $S$ such that
$f(U) \subset V$. Let $R \to A$ be the induced ring map.
If $f$ is locally of type $P$ and $P$ is local,
then $P(R \to A)$ holds.
\end{lemma}

\begin{proof}
By definition there exists an affine open covering
$U = \bigcup_{i \in I} U_i$, $U_i = \text{Spec}(A_i)$ such that each $f(U_i)$
is contained in an affine open $V_i = \text{Spec}(R_i)$ of $S$
and such $P(R_i \to A_i)$ holds for all $i$.
(Warning: $V_i$ may not be contained in $V$.)
For any $u \in U_i$ we may choose an open neighbourhood
$V_{iu} \subset V \cap V_i$ of $f(u)$ which is a standard affine
open in both $V$ and $V_i$, see
Schemes, Lemma \ref{schemes-lemma-standard-open-two-affines}. 
Note that $u \in f^{-1}(V_{i, u})$.
Because $U_i$ is quasi-compact we may choose a finite
collection $V_{ij} \subset V \cap V_i$, $j \in I_i$ of such affine opens
such that $f(U_i) \subset \bigcup_{j \in I_j} V_{ij}$.
Write $V_{ij} = \text{Spec}(R_{ij})$, so that
$R_{ij} \cong R_{r_{ij}} \cong (R_i)_{r_{ij}'}$ for certain
$r_{ij} \in R$, $r_{ij}' \in R_i$.
We may cover each $U_i \cap f^{-1}(V_{ij})$
by finitely many standard opens of $U = \text{Spec}(A)$.
Say $U_i \cap f^{-1}(V_{ij}) = \bigcup_{k \in K_{ij}} D(a_{ijk})$,
with $a_{ijk} \in A$. We have $A_{a_{ijk}} \cong (A_i)_{a_{ijk}}$.
The open subschemes and their inclusion relations give rise
to the following commutative diagram or rings:
$$
\xymatrix{
& R_i \ar[r] \ar[d]^{r_{ij}'} & A_i \ar[d]^{r_{ij}'}
& A \ar[l] \ar[d]^{a_{ijk}}\\
R \ar[r]^{r_{ij}} & R_{ij} \ar[r] & A_i \otimes_{R_i} R_{ij} \ar[r]^-{a_{ijk}}
& A_{a_{ijk}}
}
$$
Here we have labeled each arrow which is a principal localization with
the element at which the source of the arrow is being localized.
Since we have $P(R_i \to A_i)$ we have
$P(R_{ij} \to A_i \otimes_{R_i} R_{ij})$ by
Definition \ref{definition-property-local} (1)(a).
Then we conclude $P(R \to A_{a_{ijk}})$ by
Definition \ref{definition-property-local} (1)(b).
Because the opens $D(a_{ijk})$ cover all the opens
$U_i \cap f^{-1}(D(r_{ij})$ which cover the opens $U_i$
which cover all of $U$ we see that $U = \bigcup_{ijk} D(a_{ijk})$.
Hence $P(R \to A)$ by Definition \ref{definition-property-local} (1)(c).
\end{proof}

\begin{lemma}
\label{lemma-locally-P-characterize}
Let $P$ be a local property of ring maps.
Let $f : X \to S$ be a morphism of schemes.
The following are equivalent
\begin{enumerate}
\item The morphism $f$ is locally of type $P$.
\item For every affine opens $U \subset X$, $V \subset S$
with $f(U) \subset V$ we have $P(\mathcal{O}_S(V) \to \mathcal{O}_X(U))$.
\item There exists an open covering $S = \bigcup_{j \in J} V_j$
and open coverings $f^{-1}(V_j) = \bigcup_{i \in I_j} U_i$ such
that each of the morphisms $U_i \to V_j$, $j\in J, i\in I_j$
is locally of type $P$.
\item There exists an affine open covering $S = \bigcup_{j \in J} V_j$
and affine open coverings $f^{-1}(V_j) = \bigcup_{i \in I_j} U_i$ such
that $P(\mathcal{O}_S(V_j) \to \mathcal{O}_X(U_i))$ holds, for all
$j\in J, i\in I_j$.
\end{enumerate}
Moreover, if $f$ is locally of type $P$ then for
any open subschemes $U \subset X$, $V \subset S$ with $f(U) \subset V$
the restriction $f|_U : U \to V$ is locally of type $P$.
\end{lemma}

\begin{proof}
This follows from Lemma \ref{lemma-locally-P} above.
\end{proof}

\begin{lemma}
\label{lemma-composition-type-P}
Let $P$ be a property of ring maps. 
Assume $P$ is local and stable under composition.
The composition of morphisms locally of type $P$ is
locally of type $P$.
\end{lemma}

\begin{proof}
Let $f : X \to Y$ and $g : Y \to Z$ be morphisms locally of type $P$.
Let $x \in X$. Choose an affine open neighbourhood $W \subset Z$ of
$g(f(x))$. Choose an affine open neighbourhood $V \subset g^{-1}(W)$
of $f(x)$. Choose an affine open neighbourhood $U \subset f^{-1}(V)$
of $x$. By Lemma \ref{lemma-locally-P-characterize} the ring maps
$\mathcal{O}_Z(W) \to \mathcal{O}_Y(V)$ and
$\mathcal{O}_Y(V) \to \mathcal{O}_X(U)$ satisfy $P$.
Hence $\mathcal{O}_Z(W) \to \mathcal{O}_X(U)$ satisfies $P$
as $P$ is assumed stable under composition.
\end{proof}

\begin{lemma}
\label{lemma-base-change-type-P}
Let $P$ be a property of ring maps. 
Assume $P$ is local and stable under base change.
The base change of a morphism locally of type $P$
is locally of type $P$.
\end{lemma}

\begin{proof}
Let $f : X \to S$ be a morphism locally of type $P$.
Let $S' \to S$ be any morphism. Denote
$f' : X_{S'} = S' \times_S X \to S'$ the base change of $f$.
For every $s' \in S'$ there exists an open affine neighbourhood
$s' \in V' \subset S'$ which maps into some open affine $V \subset S$.
By Lemma \ref{lemma-locally-P-characterize} the open $f^{-1}(V)$ is a
union of affines $U_i$ such that the ring maps
$\mathcal{O}_S(V) \to \mathcal{O}_X(U_i)$ all satisfy $P$.
By the material in Schemes, Section \ref{schemes-section-fibre-products}
we see that $f^{-1}(U)_{V'} = V' \times_V f^{-1}(V)$ is
the union of the affine opens $V' \times_V U_i$.
Since $\mathcal{O}_{X_{S'}}(V' \times_V U_i) =
\mathcal{O}_{S'}(V') \otimes_{\mathcal{O}_S(V)} \mathcal{O}_X(U_i)$
we see that the ring maps
$\mathcal{O}_{S'}(V') \to \mathcal{O}_{X_{S'}}(V' \times_V U_i)$
satisfy $P$ as $P$ is assumed stable under base change.
\end{proof}

\begin{lemma}
\label{lemma-properties-local}
The following properties of a ring map $R \to A$ are local.
\begin{enumerate}
\item (Isomorphism on local rings.)
For every prime $\mathfrak q$ of $A$ lying over $\mathfrak p \subset R$
the ring map $R \to A$ induces an isomorphism
$R_{\mathfrak p} \to A_{\mathfrak q}$.
\item (Open immersion.)
For every prime $\mathfrak q$ of $A$ there exists an $f \in R$,
$\varphi(f) \not \in \mathfrak q$ such that the ring map $\varphi : R \to A$ 
induces an isomorphism $R_f \to A_f$.
\item (Reduced fibres.) 
For every prime $\mathfrak p$ of $R$ the fibre ring
$A \otimes_R \kappa(\mathfrak p)$ is reduced.
\item (Fibres of dimension at most $n$.)
For every prime $\mathfrak p$ of $R$ the fibre ring
$A \otimes_R \kappa(\mathfrak p)$ has Krull dimension at most $n$.
\item (Flat.)
The ring map $R \to A$ is flat.
\item (Syntomic.)
The ring map $R \to A$ is syntomic, see
Algebra, Definition \ref{algebra-definition-lci}.
\item (Smooth.)
The ring map $R \to A$ is smooth, see
Algebra, Definition \ref{algebra-definition-smooth}.
\item (Locally Noetherian on the target.)
The ring map $R \to A$ has the property that $A$ is Noetherian.
\item Add more here as needed\footnote{But only those properties
that are not already dealt with separately elsewhere.}.
\end{enumerate}
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-properties-base-change}
The following properties of ring maps are stable under base change.
\begin{enumerate}
\item (Isomorphism on local rings.)
For every prime $\mathfrak q$ of $A$ lying over $\mathfrak p \subset R$
the ring map $R \to A$ induces an isomorphism
$R_{\mathfrak p} \to A_{\mathfrak q}$.
\item (Open immersion.)
For every prime $\mathfrak q$ of $A$ there exists an $f \in R$,
$\varphi(f) \not \in \mathfrak q$ such that the ring map $\varphi : R \to A$ 
induces an isomorphism $R_f \to A_f$.
\item (Reduced fibres.) 
For every prime $\mathfrak p$ of $R$ the fibre ring
$A \otimes_R \kappa(\mathfrak p)$ is reduced.
\item (Fibres of dimension at most $n$.)
For every prime $\mathfrak p$ of $R$ the fibre ring
$A \otimes_R \kappa(\mathfrak p)$ has Krull dimension at most $n$.
\item (Flat.)
The ring map $R \to A$ is flat.
\item (Syntomic.)
The ring map $R \to A$ is syntomic, see
Algebra, Definition \ref{algebra-definition-lci}.
\item (Smooth.)
The ring map $R \to A$ is smooth, see
Algebra, Definition \ref{algebra-definition-smooth}.
\item Add more here as needed\footnote{But only those properties
that are not already dealt with separately elsewhere.}.
\end{enumerate}
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-properties-composition}
The following properties of ring maps are stable under composition.
\begin{enumerate}
\item (Isomorphism on local rings.)
For every prime $\mathfrak q$ of $A$ lying over $\mathfrak p \subset R$
the ring map $R \to A$ induces an isomorphism
$R_{\mathfrak p} \to A_{\mathfrak q}$.
\item (Open immersion.)
For every prime $\mathfrak q$ of $A$ there exists an $f \in R$,
$\varphi(f) \not \in \mathfrak q$ such that the ring map $\varphi : R \to A$ 
induces an isomorphism $R_f \to A_f$.
\item (Flat.)
The ring map $R \to A$ is flat.
\item (Syntomic.)
The ring map $R \to A$ is syntomic, see
Algebra, Definition \ref{algebra-definition-lci}.
\item (Smooth.)
The ring map $R \to A$ is smooth, see
Algebra, Definition \ref{algebra-definition-smooth}.
\item (Locally Noetherian on the target.)
The ring map $R \to A$ has the property that $A$ is Noetherian.
\item Add more here as needed\footnote{But only those properties
that are not already dealt with separately elsewhere.}.
\end{enumerate}
\end{lemma}

\begin{proof}
Omitted.
\end{proof}








\section{Morphisms of finite type}
\label{section-finite-type}

\noindent
Recall that a ring map $R \to A$ is said to be of finite type
if $A$ is isomorphic to a quotient of $R[x_1, \ldots, x_n]$ as an $R$-algebra.

\begin{definition}
\label{definition-finite-type}
Let $f : X \to S$ be a morphism of schemes.
\begin{enumerate}
\item We say that $f$ is {\it of finite type at $x \in X$} if 
there exists an affine open neighbourhood $\text{Spec}(A) = U \subset X$
of $x$ and and an affine open $\text{Spec}(R) = V \subset S$
with $f(U) \subset V$ such that the induced ring map
$R \to A$ is of finite type.
\item We say that $f$ is {\it locally of finite type} if it is 
of finite type at every point of $X$.
\item We say that $f$ is {\it of finite type} if it is locally of
finite type and quasi-compact.
\end{enumerate}
\end{definition}

\begin{lemma}
\label{lemma-locally-finite-type-characterize}
Let $f : X \to S$ be a morphism of schemes.
The following are equivalent
\begin{enumerate}
\item The morphism $f$ is locally of finite type.
\item For every affine opens $U \subset X$, $V \subset S$
with $f(U) \subset V$ the ring map
$\mathcal{O}_S(V) \to \mathcal{O}_X(U)$ is of finite type.
\item There exists an open covering $S = \bigcup_{j \in J} V_j$
and open coverings $f^{-1}(V_j) = \bigcup_{i \in I_j} U_i$ such
that each of the morphisms $U_i \to V_j$, $j\in J, i\in I_j$
is locally of finite type.
\item There exists an affine open covering $S = \bigcup_{j \in J} V_j$
and affine open coverings $f^{-1}(V_j) = \bigcup_{i \in I_j} U_i$ such
that the ring map $\mathcal{O}_S(V_j) \to \mathcal{O}_X(U_i)$ is
of finite type, for all $j\in J, i\in I_j$.
\end{enumerate}
Moreover, if $f$ is locally of finite type then for
any open subschemes $U \subset X$, $V \subset S$ with $f(U) \subset V$
the restriction $f|_U : U \to V$ is locally of finite type.
\end{lemma}

\begin{proof}
This follows from Lemma \ref{lemma-locally-P} if we show that
the property ``$R \to A$ is of finite type'' is local.
We check conditions (a), (b) and (c) of Definition
\ref{definition-property-local}.
By Algebra, Lemma \ref{algebra-lemma-compose-finite-type}
being of finite type is stable under base change and hence
we conclude (a) holds. By the same lemma being of finite type
is stable under composition and trivially for any ring
$R$ the ring map $R \to R_f$ is of finite type.
We conclude (b) holds. Finally, property (c) is true
according to Algebra, Lemma \ref{algebra-lemma-cover-upstairs}.
\end{proof}

\begin{lemma}
\label{lemma-composition-finite-type}
The composition of two morphisms which locally of finite type is
locally of finite type. The same is true for morphisms of finite type.
\end{lemma}

\begin{proof}
In the proof of Lemma \ref{lemma-locally-finite-type-characterize}
we saw that being of finite type is a local property of ring maps.
Hence the first statement of the lemma follows from
Lemma \ref{lemma-composition-type-P} combined
with the fact that being of finite type is a property of ring maps that is
stable under composition, see
Algebra, Lemma \ref{algebra-lemma-compose-finite-type}.
By the above and the fact that compositions of
quasi-compact morphisms are quasi-compact, see
Schemes, Lemma \ref{schemes-lemma-composition-quasi-compact}
we see that the composition of morphisms of finite type is
of finite type.
\end{proof}

\begin{lemma}
\label{lemma-base-change-finite-type}
The base change of a morphism which is locally of finite type
is locally of finite type. The same is true for morphisms of
finite type.
\end{lemma}

\begin{proof}
In the proof of Lemma \ref{lemma-locally-finite-type-characterize}
we saw that being of finite type is a local property of ring maps.
Hence the first statement of the lemma follows from
Lemma \ref{lemma-composition-type-P} combined
with the fact that being of finite type is a property of ring maps that is
stable under base change, see
Algebra, Lemma \ref{algebra-lemma-compose-finite-type}.
By the above and the fact that a base change of a
quasi-compact morphism is quasi-compact, see
Schemes, Lemma \ref{schemes-lemma-quasi-compact-preserved-base-change}
we see that the base change of a morphism of finite type is
a morphism of finite type.
\end{proof}

\begin{lemma}
\label{lemma-immersion-locally-finite-type}
Any immersion is locally of finite type.
\end{lemma}

\begin{proof}
This is true because an open immersion is a local isomorphism,
and a closed immersion is obviously of finite type.
\end{proof}

\begin{lemma}
\label{lemma-finite-type-noetherian}
Let $f : X \to S$ be a morphism.
If $S$ is (locally) Noetherian and $f$ (locally) of finite type
then $X$ is (locally) Noetherian.
\end{lemma}

\begin{proof}
This follows immediately from the fact that a ring
of finite type over a Noetherian ring is Noetherian,
see Algebra, Lemma \ref{algebra-lemma-Noetherian-permanence}.
(Also: use the fact that the source of a quasi-compact morphism
with quasi-compact target is quasi-compact.)
\end{proof}

\begin{lemma}
\label{lemma-finite-type-Noetherian-quasi-separated}
Let $f : X \to S$ be locally of finite type with $S$ locally Noetherian.
Then $f$ is quasi-separated.
\end{lemma}

\begin{proof}
In fact, it is true that $X$ is quasi-separated, see
Properties, Lemma \ref{properties-lemma-locally-Noetherian-quasi-separated}
and Lemma \ref{lemma-finite-type-noetherian} above.
Then apply Schemes, Lemma \ref{schemes-lemma-compose-after-separated}
to conclude that $f$ is quasi-separated.
\end{proof}

\begin{lemma}
\label{lemma-permanence-finite-type}
Let $X \to Y$ be a morphism of schemes over a base scheme $S$.
If $X$ is locally of finite type over $S$, then $X \to Y$
is locally of finite type.
\end{lemma}

\begin{proof}
Via Lemma \ref{lemma-locally-finite-type-characterize} this translates
into the following algebra
fact: Given ring maps $A \to B \to C$ such that $A \to C$ is
of finite type, then $B \to C$ is of finite type.
(See Algebra Lemma \ref{algebra-lemma-compose-finite-type}).
\end{proof}








\section{Points of finite type}
\label{section-points-finite-type}

\noindent
The moral of this section is that ``finite type points'' can replace
``closed points'' in a certain sense and in certain situations.
There are always enough of them for example, see below.

\begin{lemma}
\label{lemma-point-finite-type}
Let $S$ be a scheme. Let $k$ be a field.
Let $f : \text{Spec}(k) \to S$ be a morphism.
The following are equivalent:
\begin{enumerate}
\item The morphism $f$ is of finite type.
\item The morphism $f$ is locally of finite type.
\item There exists an affine open $U = \text{Spec}(R)$ of $S$
such that $f$ corresponds to a finite ring map $R \to k$.
\item There exists an affine open $U = \text{Spec}(R)$ of $S$
such that the image of $f$ consists of a closed point $u$ in $U$
and the field extension $\kappa(u) \subset k$ is finite.
\end{enumerate}
\end{lemma}

\begin{proof}
The equivalence of (1) and (2) is obvious as $\text{Spec}(k)$
is a singleton and hence any morphism from it is quasi-compact.

\medskip\noindent
Suppose $f$ is locally of finite type. Choose any affine open
$\text{Spec}(R) = U \subset S$ such that the image of $f$
is contained in $U$, and the ring map $R \to k$
is of finite type. Let $\mathfrak p \subset R$ be the kernel.
Then $R/\mathfrak p \subset k$ is of finite type. By
Algebra, Lemma \ref{algebra-lemma-field-finite-type-over-domain}
there exist a $\overline{f} \in R/\mathfrak p$ such that
$(R\mathfrak p)_{\overline{f}}$ is a field and
$(R\mathfrak p)_{\overline{f}} \to k$ is a finite field
extension. If $f \in R$ is a lift of $\overline{f}$, then
we see that $k$ is a finite $R_f$-module. Thus (2) $\Rightarrow$ (3).

\medskip\noindent
Suppose that $\text{Spec}(R) = U \subset S$ is an affine open
such that $f$ corresponds to a finite ring map $R \to k$.
Then $f$ is locally of finite type
by Lemma \ref{lemma-locally-finite-type-characterize}.
Thus (3) $\Rightarrow$ (2).

\medskip\noindent
Suppose $R \to k$ is finite. The image of $R \to k$ is a field
over which $k$ is finite by
Algebra, Lemma \ref{algebra-lemma-integral-under-field}.
Hence the kernel of $R \to k$ is a maximal ideal.
Thus (3) $\Rightarrow$ (4).

\medskip\noindent
The implication (4) $\Rightarrow$ (3) is immediate.
\end{proof}

\noindent
Let us say that a point $s$ of a scheme $S$ is {\it of finite type}
if the canonical morphism $\text{Spec}(\kappa(s)) \to S$, see
Schemes, Section \ref{schemes-section-points}, is of finite type.
From the lemma we see that the set of finite type points is
$$
S_{\text{ft-pts}} = \bigcup\nolimits_{U \subset S\text{ open}} U_0
$$
where $U_0$ is the set of closed points of $U$. (We may let $U$ range
over all opens or over all affine opens; it does not matter.)
In addition, for any finite type morphism $f : \text{Spec}(k) \to S$,
where $k$ is a field we see that the image of $f$ is a finite type
point. More generally, since the composition of morphisms locally of finite
type is locally of finite type we see that given any
locally finite type morphism
$f : T \to S$ we get an induced map
$f_{\text{ft-pts}} : T_{\text{ft-pts}} \to S_{\text{ft-pts}}$.
Any locally closed immersion is locally of finite type,
see Lemma \ref{lemma-immersion-locally-finite-type}. We conclude
that for any locally closed subset $T \subset S$ we have
$$
T \not = \emptyset
\Rightarrow 
T \cap S_{\text{ft-pts}} \not = \emptyset.
$$
This is true because $T$ carries a schemes structure (see
Schemes, Lemma \ref{schemes-lemma-reduced-closed-subscheme})
and any nonempty affine open of $T$ has at least one closed point.
It follows that most of the material from
Topology, Section \ref{topology-section-space-jacobson} goes through
with the set of closed points replaced by the set of points of
finite type.

\medskip\noindent
In fact, if $S$ is Jacobson then we recover the closed points as
the finite type points.

\begin{lemma}
\label{lemma-jacobson-finite-type-points}
Let $S$ be a scheme.
The following are equivalent:
\begin{enumerate}
\item For every finite type morphism $f : \text{Spec}(k) \to S$
with $k$ a field the image consists of a closed point of $S$.
In the terminology introduced above: finite type points of $S$ are
closed points of $S$.
\item For every locally finite type morphism $T \to S$ closed points map
to closed points.
\item For every locally finite type morphism $f : T \to S$ any closed point
$t \in T$ maps to a closed point $s \in S$ and $\kappa(s) \subset \kappa(t)$
is finite.
\item The scheme $S$ is Jacobson.
\end{enumerate}
\end{lemma}

\begin{proof}
We have trivially (3) $\Rightarrow$ (2) $\Rightarrow$ (1).
The discussion above shows that (1) implies (4).
Hence it suffices to show that (4) implies (3).
Suppose that $T \to S$ is locally of finite type.
Choose $t \in T$ with $s = f(t)$ as in (3).
Choose affine open neighbourhoods $\text{Spec}(R) = U \subset S$ of $s$ and
$\text{Spec}(A) = V \subset T$ of $t$ with $f(V) \subset U$.
The induced ring map $R \to A$ is of finite type
(see Lemma \ref{lemma-locally-finite-type-characterize}) and $A$ is Jacobson
by Properties, Lemma \ref{properties-lemma-locally-jacobson}.
Thus the result follows from
Algebra, Proposition \ref{algebra-proposition-Jacobson-permanence}.
\end{proof}



















\section{Quasi-finite morphisms}
\label{section-quasi-finite}

\noindent
Recall that a finite type ring map $R \to A$ is quasi-finite at
a prime $\mathfrak q$ if $\mathfrak q$ defines an isolated point
of its fibre, see Algebra, Definition \ref{algebra-definition-quasi-finite}.

\begin{definition}
\label{definition-quasi-finite}
Let $f : X \to S$ be a morphism of schemes.
\begin{enumerate}
\item We say that {\it $f$ is quasi-finite at a point $x \in X$}
if there exist an affine neighbourhood $\text{Spec}(A) = U \subset X$
of $x$ and an affine open $\text{Spec}(R) = V \subset S$ such that
$f(U) \subset V$, the ring map $R \to A$ is of finite type,
and $R \to A$ is quasi-finite at the prime of $A$ corresponding to $x$
(see above).
\item We say {\it $f$ is locally quasi-finite} if $f$ is
quasi-finite at every point $x$ of $X$.
\item We say that {\it $f$ is quasi-finite} if $f$ is of finite type
and every point $x$ is an isolated point of its fibre.
\end{enumerate}
\end{definition}

\noindent
Trivially, a locally quasi-finite morphism is locally of finite type.
We will see below that a morphism $f$ which is locally of finite type
is quasi-finite at $x$ if and only if $x$ is isolated in its fibre.
Moreover, we will see that the set of points at which a morphism
is quasi-finite is open.

\begin{lemma}
\label{lemma-algebraic-residue-field-extension-closed-point-fibre}
Let $f : X \to S$ be a morphism of schemes.
Let $x \in X$ be a point. Set $s = f(x)$.
If $\kappa(s) \supset \kappa(x)$
is an algebraic field extension, then
\begin{enumerate}
\item $x$ is a closed point of its fibre, and
\item if in addition $s$ is a closed point of $S$, then
$x$ is a closed point of $X$.
\end{enumerate}
\end{lemma}

\begin{proof}
The second statement follows from the first by elementary topology.
According to Schemes, Lemma \ref{schemes-lemma-fibre-topological}
to prove the first statement
we may replace $X$ by $X_s$ and $S$ by $\text{Spec}(\kappa(s))$.
Thus we may assume that $S = \text{Spec}(k)$ is the spectrum of a field.
In this case, let $\text{Spec}(A) = U \subset X$ be any affine open
containing $x$. The point $x$ corresponds to a prime ideal
$\mathfrak q \subset A$ such that $k \subset \kappa(\mathfrak q)$
is an algebraic field extension. By
Algebra, Lemma \ref{algebra-lemma-finite-residue-extension-closed}
we see that $\mathfrak q$ is a maximal ideal, i.e., $x \in U$ is a
closed point. Since the affine opens form
a basis of the topology of $X$ we conclude that $\{x\}$ is closed.
\end{proof}

\begin{lemma}
\label{lemma-closed-point-fibre-locally-finite-type}
Let $f : X \to S$ be a morphism of schemes.
Let $x \in X$ be a point. Set $s = f(x)$.
Assume $f$ is locally of finite type.
Then $x$ is a closed point of its fibre
if and only if $\kappa(s) \subset \kappa(x)$ is
a finite field extension.
\end{lemma}

\begin{proof}
If the extension is finite, then $x$ is a closed point of
the fibre by
Lemma \ref{lemma-algebraic-residue-field-extension-closed-point-fibre}
above. For the converse, assume that $x$ is a closed point
of its fibre. Choose affine opens $\text{Spec}(A) = U \subset X$
and $\text{Spec}(R) = V \subset S$ such that $f(U) \subset V$.
By Lemma \ref{lemma-locally-finite-type-characterize} the ring map
$R \to A$ is of finite type. Let $\mathfrak q \subset A$,
resp.\ $\mathfrak p \subset R$ be the prime ideal corresponding
to $x$, resp.\ $s$. Consider the fibre ring
$\overline{A} = A \otimes_R \kappa(\mathfrak p)$.
Let $\overline{\mathfrak q}$ be the prime of $\overline{A}$
corresponding to $\mathfrak q$. The assumption that $x$
is a closed point of its fibre implies that $\overline{\mathfrak q}$
is a maximal ideal of $\overline{A}$. Since $\overline{A}$
is an algebra of finite type over the field $\kappa(\mathfrak p)$
we see by the Hilbert Nullstellensatz, see
Algebra, Theorem \ref{algebra-theorem-nullstellensatz},
that $\kappa(\overline{\mathfrak q})$ is a finite extension
of $\kappa(\mathfrak p)$.
Since $\kappa(s) = \kappa(\mathfrak p)$ and
$\kappa(x) = \kappa(\mathfrak q) = \kappa(\overline{\mathfrak q})$
we win.
\end{proof}

\begin{lemma}
\label{lemma-residue-field-quasi-finite}
Let $f : X \to S$ be a morphism of schemes.
Let $x \in X$ be a point. Set $s = f(x)$.
If $f$ is quasi-finite at $x$, then the residue field
extension $\kappa(s) \subset \kappa(x)$ is finite.
\end{lemma}

\begin{proof}
This is clear from Algebra, Definition \ref{algebra-definition-quasi-finite}.
\end{proof}

\begin{lemma}
\label{lemma-quasi-finite-at-point-characterize}
Let $f : X \to S$ be a morphism of schemes.
Let $x \in X$ be a point. Set $s = f(x)$.
Let $X_s$ be the fibre of $f$ at $s$.
Assume $f$ is locally of finite type.
The following are equivalent:
\begin{enumerate}
\item The morphism $f$ is quasi-finite at $x$.
\item The point $x$ is isolated in $X_s$.
\item The point $x$ is closed in $X_s$
and there is no point $x' \in X_s$, $x' \not = x$
which specializes to $x$.
\item For any pair of affine opens
$\text{Spec}(A) = U \subset X$, $\text{Spec}(R) = V \subset S$ with
$f(U) \subset V$ and $x \in U$ corresponding to $\mathfrak q \subset A$
the ring map $R \to A$ is quasi-finite at $\mathfrak q$.
\end{enumerate}
\end{lemma}

\begin{proof}
Assume $f$ is quasi-finite at $x$.
Note that $x$ defines a closed point of $X_s$ as follows by combining
Lemmas \ref{lemma-algebraic-residue-field-extension-closed-point-fibre} and
\ref{lemma-residue-field-quasi-finite}. 
By assumption there exist opens $U \subset X$, $V \subset S$ such
that $f(U) \subset V$, $x \in U$ and $x$ an isolated point
of $U_s$. Hence $\{x\} \subset U_s$ is an open subset.
Since $U_s = U \cap X_s \subset X_s$ is also open we conclude
that $\{x\} \subset X_s$ is an open subset also. Thus we conclude
that $x$ is an isolated point of $X_s$.

\medskip\noindent
If $x$ is isolated in $X_s$, then we see immediately that
$x$ is closed in $X_s$ and that there is no point $x' \in X_s$,
distinct from $x$, specializing to $x$.

\medskip\noindent
Assume that $x$ is closed in $X_s$ and that there is no point $x' \in X_s$,
distinct from $x$, specializing to $x$. Consider a pair of affine opens
$\text{Spec}(A) = U \subset X$, $\text{Spec}(R) = V \subset S$ with
$f(U) \subset V$ and $x \in U$. Let $\mathfrak q \subset A$ correspond to
$x$ and $\mathfrak p \subset R$ correspond to $s$.
By Lemma \ref{lemma-locally-finite-type-characterize} the ring map
$R \to A$ is of finite type. Consider the fibre ring
$\overline{A} = A \otimes_R \kappa(\mathfrak p)$.
Let $\overline{\mathfrak q}$ be the prime of $\overline{A}$ corresponding
to $\mathfrak q$. Since $\text{Spec}(\overline{A})$ is an open subscheme of
the fibre $X_s$ we see that $\overline{q}$ is a maximal ideal
of $\overline{A}$ and that there is no point of $\text{Spec}(\overline{A})$
specializing to $\overline{\mathfrak q}$.
This implies that $\dim(\overline{A}_{\overline{q}}) = 0$.
Hence by
Algebra, Lemma \ref{algebra-lemma-dimension-closed-point-finite-type-field}
we have $\dim_{\overline{\mathfrak q}}(\overline{A}) = 0$.
Hence by Algebra, Lemma \ref{algebra-lemma-isolated-point}
we see that $\mathfrak q$ defines an isolated point of
$\text{Spec}(\overline{A})$. Thus $X \to S$ is quasi-finite at
$x$ by definition.

\medskip\noindent
At this point we have shown conditions (1) -- (3) are all equivalent.
It is clear that (4) implies (1). And it is also clear that
(2) implies (4) since if $x$ is an isolated point of $X_s$
then it is also an isolated point of $U_s$ for any open $U$
which contains it.
\end{proof}

\noindent
The following lemma uses Zariski's Main Theorem (the algebraic version).

\begin{lemma}
\label{lemma-quasi-finite-points-open}
Let $f : X \to S$ be a morphism of schemes.
The set of points of $X$ where $f$ is quasi-finite is an open
$U \subset X$. The induced morphism $U \to S$ is locally quasi-finite.
\end{lemma}

\begin{proof}
Suppose $f$ is quasi-finite at $x$.
Let $x \in U = \text{Spec}(R) \subset X$, $V = \text{Spec}(A) \subset S$
be affine opens as in Definition \ref{definition-quasi-finite}.
By Algebra, Lemma \ref{algebra-lemma-quasi-finite-open} the set
of primes $\mathfrak q$ at which $R \to A$ is quasi-finite
is open in $\text{Spec}(A)$. Since these all correspond to points
of $X$ where $f$ is quasi-finite we get the first statement.
The second statement is obvious.
\end{proof}

\begin{lemma}
\label{lemma-quasi-finite-locally-quasi-compact}
Let $f : X \to S$ be a morphism of schemes.
Then $f$ is quasi-finite if and only if $f$ is
locally quasi-finite and quasi-compact.
\end{lemma}

\begin{proof}
Assume $f$ is quasi-finite. It is quasi-compact by Definition
\ref{definition-finite-type}. Let $x \in X$.
We see that $f$ is quasi-finite at $x$ by
Lemma \ref{lemma-quasi-finite-at-point-characterize}.
Hence $f$ is quasi-compact and locally quasi-finite.

\medskip\noindent
Assume $f$ is quasi-compact and locally quasi-finite.
Then $f$ is of finite type. Let $x \in X$ be a point.
By Lemma \ref{lemma-quasi-finite-at-point-characterize}
we see that $x$ is an isolated point of its fibre.
The lemma is proved.
\end{proof}

\noindent
Recall that a ring map $R \to A$ is quasi-finite if it is
of finite type and quasi-finite at {\it all} primes of $A$, see
Algebra, Definition \ref{algebra-definition-quasi-finite}.

\begin{lemma}
\label{lemma-locally-quasi-finite-characterize}
Let $f : X \to S$ be a morphism of schemes.
The following are equivalent
\begin{enumerate}
\item The morphism $f$ is locally quasi-finite.
\item For every pair of affine opens $U \subset X$, $V \subset S$
with $f(U) \subset V$ the ring map
$\mathcal{O}_S(V) \to \mathcal{O}_X(U)$ is quasi-finite.
\item There exists an open covering $S = \bigcup_{j \in J} V_j$
and open coverings $f^{-1}(V_j) = \bigcup_{i \in I_j} U_i$ such
that each of the morphisms $U_i \to V_j$, $j\in J, i\in I_j$
is locally quasi-finite.
\item There exists an affine open covering $S = \bigcup_{j \in J} V_j$
and affine open coverings $f^{-1}(V_j) = \bigcup_{i \in I_j} U_i$ such
that the ring map $\mathcal{O}_S(V_j) \to \mathcal{O}_X(U_i)$ is
quasi-finite, for all $j\in J, i\in I_j$.
\end{enumerate}
Moreover, if $f$ is locally quasi-finite then for
any open subschemes $U \subset X$, $V \subset S$ with $f(U) \subset V$
the restriction $f|_U : U \to V$ is locally quasi-finite.
\end{lemma}

\begin{proof}
For a ring map $R \to A$ let us define
$P(R \to A)$ to mean ``$R \to A$ is quasi-finite''
(see remark above lemma).
We claim that $P$ is a local property of ring maps.
We check conditions (a), (b) and (c) of Definition
\ref{definition-property-local}. In the proof of
Lemma \ref{lemma-locally-finite-type-characterize}
we have seen that (a), (b) and (c) hold for the property
of being ``of finite type''. Note that, for a finite type ring map
$R \to A$, the property $R \to A$ is quasi-finite at $\mathfrak q$
depends only on the local ring $A_{\mathfrak q}$ as an
algebra over $R_{\mathfrak p}$ where $\mathfrak p = R \cap \mathfrak q$
(usual abuse of notation). Using these remarks (a), (b) and (c) of
Definition \ref{definition-property-local} follow immediately.
For example, suppose $R \to A$ is a ring map
such that all of the ring maps $R \to A_{a_i}$ are quasi-finite
for $a_1, \ldots, a_n \in A$ generating the unit ideal.
We conclude that $R \to A$ is of finite type. Also, for any
prime $\mathfrak q \subset A$ the local ring $A_{\mathfrak q}$
is isomorphic as an $R$-algebra to the local ring
$(A_{a_i})_{\mathfrak q_i}$ for some $i$ and some
$\mathfrak q_i \subset A_{a_i}$. Hence we conclude that
$R \to A$ is quasi-finite at $\mathfrak q$.

\medskip\noindent
We conclude that Lemma \ref{lemma-locally-P} applies with $P$
as in the previous paragraph.
Hence it suffices to prove that $f$ is locally quasi-finite is
equivalent to $f$ is locally of type $P$. Since $P(R \to A)$
is ``$R \to A$ is quasi-finite'' which means $R \to A$ is
quasi-finite at every prime of $A$, this follows from
Lemma \ref{lemma-quasi-finite-at-point-characterize}.
\end{proof}

\begin{lemma}
\label{lemma-composition-quasi-finite}
The composition of two morphisms which are locally quasi-finite type is
locally quasi-finite. The same is true for quasi-finite morphisms.
\end{lemma}

\begin{proof}
In the proof of Lemma \ref{lemma-locally-quasi-finite-characterize}
we saw that $P = $``quasi-finite'' is a local property of ring maps,
and that a morphism of schemes is locally quasi-finite if and only if
it is locally of type $P$ as in Definition \ref{definition-locally-P}.
Hence the first statement of the lemma follows from
Lemma \ref{lemma-composition-type-P} combined
with the fact that being quasi-finite is a property of ring maps that is
stable under composition, see
Algebra, Lemma \ref{algebra-lemma-quasi-finite-composition}.
By the above, Lemma \ref{lemma-quasi-finite-locally-quasi-compact}
and the fact that compositions of
quasi-compact morphisms are quasi-compact, see
Schemes, Lemma \ref{schemes-lemma-composition-quasi-compact}
we see that the composition of quasi-finite morphisms is
quasi-finite.
\end{proof}

\begin{lemma}
\label{lemma-base-change-quasi-finite}
Let $f : X \to S$ be a morphism of schemes.
Let $g : S' \to S$ be a morphism of schemes.
Denote $f' : X_{S'} \to S'$ the base change of $f$ by $g$
and denote $g' : X_{S'} \to X$ the projection.
Assume $X$ is locally of finite type over $S$.
\begin{enumerate}
\item Let $U \subset X$ (resp.\ $U' \subset X'$)
be the set of points where $f$ (resp.\ $f'$) is quasi-finite. 
Then $U' = U_{S'} = (g')^{-1}(U)$.
\item The base change of a morphism which is locally quasi-finite
is locally quasi-finite.
\item The base change of a quasi-finite morphism is
quasi-finite.
\end{enumerate}
\end{lemma}

\begin{proof}
The first and second assertion follow from the corresponding
algebra result, see
Algebra, Lemma \ref{algebra-lemma-quasi-finite-base-change}
(combined with the fact that $f'$ is also locally of finite type by
Lemma \ref{lemma-base-change-finite-type}).
By the above, Lemma \ref{lemma-quasi-finite-locally-quasi-compact}
and the fact that a base change of a
quasi-compact morphism is quasi-compact, see
Schemes, Lemma \ref{schemes-lemma-quasi-compact-preserved-base-change}
we see that the base change of a quasi-finite morphism
is quasi-finite.
\end{proof}

\begin{lemma}
\label{lemma-immersion-locally-quasi-finite}
Any immersion is locally quasi-finite.
\end{lemma}

\begin{proof}
This is true because an open immersion is a local isomorphism
and a closed immersion is clearly quasi-finite.
\end{proof}













\section{Morphisms of finite presentation}
\label{section-finite-presentation}

\noindent
Recall that a ring map $R \to A$ is of finite presentation if
$A \cong R[x_1, \ldots, x_n]/(f_1, \ldots, f_m)$ as $R$-algebras
for some $n, m$ and some polynomials $f_j$.

\begin{definition}
\label{definition-finite-presentation}
Let $f : X \to S$ be a morphism of schemes.
\begin{enumerate}
\item We say that $f$ is {\it of finite presentation at $x \in X$} if 
there exists a affine open neighbourhood $\text{Spec}(A) = U \subset X$
of $x$ and and affine open $\text{Spec}(R) = V \subset S$
with $f(U) \subset V$ such that the induced ring map
$R \to A$ is of finite presentation.
\item We say that $f$ is {\it locally of finite presentation} if it is 
of finite presentation at every point of $X$.
\item We say that $f$ is {\it of finite presentation} if it is locally of
finite presentation, quasi-compact and quasi-separated.
\end{enumerate}
\end{definition}

\noindent
One motivation for adding quasi-separated to the conditions definining a
morphism of finite presentation is that we want to characterize
morphisms of finite presentation as those morphisms such that
$$
\text{colim}\ \text{Mor}_S(T_i, X) = \text{Mor}_S(\text{lim}\ T_i, X)
$$
for any directed system of affine schemes $T_i$ over $S$. And in other
to show this we will need the condition of being quasi-separated (see
Limits,
Proposition \ref{limits-proposition-characterize-locally-finite-presentation}).
Compare also with
Modules, Lemma \ref{modules-lemma-finite-presentation-quasi-compact-colimit}.

\begin{lemma}
\label{lemma-locally-finite-presentation-characterize}
Let $f : X \to S$ be a morphism of schemes.
The following are equivalent
\begin{enumerate}
\item The morphism $f$ is locally of finite presentation.
\item For every affine opens $U \subset X$, $V \subset S$
with $f(U) \subset V$ the ring map
$\mathcal{O}_S(V) \to \mathcal{O}_X(U)$ is of finite presentation.
\item There exists an open covering $S = \bigcup_{j \in J} V_j$
and open coverings $f^{-1}(V_j) = \bigcup_{i \in I_j} U_i$ such
that each of the morphisms $U_i \to V_j$, $j\in J, i\in I_j$
is locally of finite presentation.
\item There exists an affine open covering $S = \bigcup_{j \in J} V_j$
and affine open coverings $f^{-1}(V_j) = \bigcup_{i \in I_j} U_i$ such
that the ring map $\mathcal{O}_S(V_j) \to \mathcal{O}_X(U_i)$ is
of finite presentation, for all $j\in J, i\in I_j$.
\end{enumerate}
Moreover, if $f$ is locally of finite presentation then for
any open subschemes $U \subset X$, $V \subset S$ with $f(U) \subset V$
the restriction $f|_U : U \to V$ is locally of finite presentation.
\end{lemma}

\begin{proof}
This follows from Lemma \ref{lemma-locally-P} if we show that
the property ``$R \to A$ is of finite presentation'' is local.
We check conditions (a), (b) and (c) of Definition
\ref{definition-property-local}.
By Algebra, Lemma \ref{algebra-lemma-compose-finite-type}
being of finite presentation is stable under base change and hence
we conclude (a) holds. By the same lemma being of finite presentation
is stable under composition and trivially for any ring
$R$ the ring map $R \to R_f$ is of finite presentation.
We conclude (b) holds. Finally, property (c) is true
according to Algebra, Lemma \ref{algebra-lemma-cover-upstairs}.
\end{proof}

\begin{lemma}
\label{lemma-composition-finite-presentation}
The composition of two morphisms which locally of finite presentation is
locally of finite presentation.
The same is true for morphisms of finite presentation.
\end{lemma}

\begin{proof}
In the proof of Lemma \ref{lemma-locally-finite-presentation-characterize}
we saw that being of finite presentation is a local property of ring maps.
Hence the first statement of the lemma follows from
Lemma \ref{lemma-composition-type-P} combined
with the fact that being of finite presentation
is a property of ring maps that is
stable under composition, see
Algebra, Lemma \ref{algebra-lemma-compose-finite-type}.
By the above and the fact that compositions of
quasi-compact, quasi-separated morphisms are
quasi-compact and quasi-separated, see
Schemes, Lemmas \ref{schemes-lemma-composition-quasi-compact}
and \ref{schemes-lemma-separated-permanence}
we see that the composition of morphisms of finite presentation is
of finite presentation.
\end{proof}

\begin{lemma}
\label{lemma-base-change-finite-presentation}
The base change of a morphism which is locally of finite presentation
is locally of finite presentation. The same is true for morphisms of
finite presentation.
\end{lemma}

\begin{proof}
In the proof of Lemma \ref{lemma-locally-finite-presentation-characterize}
we saw that being of finite presentation is a local property of ring maps.
Hence the first statement of the lemma follows from
Lemma \ref{lemma-composition-type-P} combined
with the fact that being of finite presentation
is a property of ring maps that is
stable under base change, see
Algebra, Lemma \ref{algebra-lemma-compose-finite-type}.
By the above and the fact that a base change of a
quasi-compact, quasi-separated morphism is quasi-compact
and quasi-separated, see
Schemes, Lemmas \ref{schemes-lemma-quasi-compact-preserved-base-change}
and \ref{schemes-lemma-separated-permanence}
we see that the base change of a morphism of finite presentation is
a morphism of finite presentation.
\end{proof}

\begin{lemma}
\label{lemma-open-immersion-locally-finite-presentation}
Any open immersion is locally of finite presentation.
\end{lemma}

\begin{proof}
This is true because an open immersion is a local isomorphism.
\end{proof}

\begin{lemma}
\label{lemma-quasi-compact-open-immersion-finite-presentation}
Any open immersion is of finite presentation if and only if
it is quasi-compact.
\end{lemma}

\begin{proof}
We have seen (Lemma \ref{lemma-open-immersion-locally-finite-presentation})
that an open immersion is locally of finite presentation.
We have see (Schemes, Lemma \ref{schemes-lemma-immersions-monomorphisms})
that an immersion is separated and hence quasi-separated. From this
and Definition \ref{definition-finite-presentation} the lemma follows.
\end{proof}

\begin{lemma}
\label{lemma-closed-immersion-finite-presentation}
Any closed immersion $i : Z \to X$ is of finite presentation if and only if
the associated quasi-coherent sheaf of ideals
$\mathcal{I} = \text{Ker}(\mathcal{O}_X \to i_*\mathcal{O}_Z)$
is of finite type (as an $\mathcal{O}_X$-module).
\end{lemma}

\begin{proof}
On any affine open $\text{Spec}(R) \subset X$ we have
$i^{-1}(\text{Spec}(R)) = \text{Spec}(R/I)$ and
$\mathcal{I} = \widetilde{I}$. Moreover, $\mathcal{I}$
is of finite type if and only if $I$ is a finite $R$-module
for every such affine open (see
Properties, Lemma \ref{properties-lemma-finite-type-module}).
And $R/I$ is of finite presentation
over $R$ if and only if $I$ is a finite $R$-module. Hence we win.
\end{proof}

\begin{lemma}
\label{lemma-finite-presentation-finite-type}
A morphism which is locally of finite presentation is locally of finite type.
A morphism of finite presentation is of finite type.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-noetherian-finite-type-finite-presentation}
Let $f : X \to S$ be a morphism.
\begin{enumerate}
\item If $S$ is locally Noetherian and $f$ locally of finite type
then $f$ is locally of finite presentation.
\item If $S$ is locally Noetherian and $f$ of finite type
then $f$ is of finite presentation.
\end{enumerate}
\end{lemma}

\begin{proof}
The first statement follows from the fact that a ring
of finite type over a Noetherian ring is of finite presentation, see Algebra,
Lemma \ref{algebra-lemma-Noetherian-finite-type-is-finite-presentation}.
Suppose that $f$ is of finite type and $S$ is locally Noetherian.
Then $f$ is quasi-compact and locally of finite presentation by (1).
Hence it suffices to prove that $f$ is quasi-separated.
This follows from Lemma \ref{lemma-finite-type-Noetherian-quasi-separated}
(and Lemma \ref{lemma-finite-presentation-finite-type}).
\end{proof}

\begin{lemma}
\label{lemma-finite-presentation-quasi-compact-quasi-separated}
Let $S$ be a scheme which is quasi-compact and quasi-separated.
If $X$ is of finite presentation over $S$, then $X$ is quasi-compact
and quasi-separated.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}


















\section{Open morphisms}
\label{section-open}

\begin{definition}
\label{definition-open}
Let $f : X \to S$ be a morphism.
\begin{enumerate}
\item We say $f$ is {\it open} if the map on underlying
topological spaces is open.
\item We say $f$ is {\it universally open} if for any morphism of
schemes $S' \to S$ the base change $f' : X_{S'} \to S'$ is open.
\end{enumerate}
\end{definition}

\noindent
According to
Topology, Lemma \ref{topology-lemma-closed-open-map-specialization}
generalizations lift along an open morphism.
Here is a (partial) converse.

\begin{lemma}
\label{lemma-locally-finite-presentation-universally-open}
Let $f : X \to S$ be a morphism.
\begin{enumerate}
\item If $f$ is locally of finite presentation and generalizations lift
along $f$, then $f$ is open.
\item If $f$ is locally of finite presentation and generalizations lift
along every base change of $f$, then $f$ is universally open.
\end{enumerate}
\end{lemma}

\begin{proof}
It suffices to prove the first assertion.
This reduces to the case where both $X$ and $S$ are affine.
In this case the result follows from
Algebra, Lemma \ref{algebra-lemma-going-up-down-specialization}
and Proposition \ref{algebra-proposition-fppf-open}.
\end{proof}

\noindent
See also Lemma \ref{lemma-fppf-open} for the case of a morphism
flat of finite presentation.









\section{Flat morphisms}
\label{section-flat}

\begin{definition}
\label{definition-flat}
Let $f : X \to S$ be a morphism of schemes.
Let $\mathcal{F}$ be a quasi-coherent sheaf of $\mathcal{O}_X$-modules.
\begin{enumerate}
\item We say $f$ is {\it flat at a point $x \in X$} if the
local ring $\mathcal{O}_{X, x}$ is flat over the local ring
$\mathcal{O}_{S, f(x)}$.
\item We say that $\mathcal{F}$ is {\it flat over $S$ at a point $x \in X$}
if the stalk $\mathcal{F}_x$ is a flat $\mathcal{O}_{S, f(x)}$-module.
\item We say $f$ is {\it flat} if $f$ is flat at every point of $X$.
\item We say that $\mathcal{F}$ is {\it flat over $S$} if 
$\mathcal{F}$ is flat over $S$ at every point $x$ of $X$.
\end{enumerate}
\end{definition}

\noindent
Thus we see that $f$ is flat if and only if
the structure sheaf $\mathcal{O}_X$ is flat over $S$.

\begin{lemma}
\label{lemma-flat-module-characterize}
Let $f : X \to S$ be a morphism of schemes.
Let $\mathcal{F}$ be a quasi-coherent sheaf of $\mathcal{O}_X$-modules.
The following are equivalent
\begin{enumerate}
\item The sheaf $\mathcal{F}$ is flat over $S$.
\item For every affine opens $U \subset X$, $V \subset S$
with $f(U) \subset V$ the $\mathcal{O}_S(V)$-module $\mathcal{F}(U)$ is flat.
\item There exists an open covering $S = \bigcup_{j \in J} V_j$
and open coverings $f^{-1}(V_j) = \bigcup_{i \in I_j} U_i$ such
that each of the modules $\mathcal{F}|_{U_i}$ is
flat over $V_j$, for all $j\in J, i\in I_j$.
\item There exists an affine open covering $S = \bigcup_{j \in J} V_j$
and affine open coverings $f^{-1}(V_j) = \bigcup_{i \in I_j} U_i$ such
that $\mathcal{F}(U_i)$ is a flat $\mathcal{O}_S(V_j)$-module, for all
$j\in J, i\in I_j$.
\end{enumerate}
Moreover, if $\mathcal{F}$ is flat over $S$ then for
any open subschemes $U \subset X$, $V \subset S$ with $f(U) \subset V$
the restriction $\mathcal{F}|_U$ is flat over $V$.
\end{lemma}

\begin{proof}
Let $R \to A$ be a ring map. Let $M$ be an $A$-module.
If $M$ is $R$-flat, then for all primes
$\mathfrak q$ the local ring map $R_{\mathfrak p} \to A_{\mathfrak q}$ is flat
with $\mathfrak p$ the prime of $R$ lying under $\mathfrak q$. Conversely, if
$M_{\mathfrak q}$ is flat over $R_{\mathfrak p}$ for all primes $\mathfrak q$
of $A$, then $R \to A$ is flat. See
Algebra, Lemma \ref{algebra-lemma-flat-localization}.
This equivalence easily implies the statements of the lemma.
\end{proof}

\begin{lemma}
\label{lemma-flat-characterize}
Let $f : X \to S$ be a morphism of schemes.
The following are equivalent
\begin{enumerate}
\item The morphism $f$ is flat.
\item For every affine opens $U \subset X$, $V \subset S$
with $f(U) \subset V$ the ring map
$\mathcal{O}_S(V) \to \mathcal{O}_X(U)$ is flat.
\item There exists an open covering $S = \bigcup_{j \in J} V_j$
and open coverings $f^{-1}(V_j) = \bigcup_{i \in I_j} U_i$ such
that each of the morphisms $U_i \to V_j$, $j\in J, i\in I_j$
is flat.
\item There exists an affine open covering $S = \bigcup_{j \in J} V_j$
and affine open coverings $f^{-1}(V_j) = \bigcup_{i \in I_j} U_i$ such
that $\mathcal{O}_S(V_j) \to \mathcal{O}_X(U_i)$ is flat, for all
$j\in J, i\in I_j$.
\end{enumerate}
Moreover, if $f$ is flat then for
any open subschemes $U \subset X$, $V \subset S$ with $f(U) \subset V$
the restriction $f|_U : U \to V$ is flat.
\end{lemma}

\begin{proof}
This is a special case of Lemma \ref{lemma-flat-module-characterize}
above.
\end{proof}

\begin{lemma}
\label{lemma-composition-module-flat}
Let $X \to Y \to Z$ be morphisms of schemes.
Let $\mathcal{F}$ be a quasi-coherent $\mathcal{O}_X$-module.
If $\mathcal{F}$ is flat over $Y$, and $Y$ is flat over $Z$, then
$\mathcal{F}$ is flat over $Z$.
\end{lemma}

\begin{proof}
See Algebra, Lemma \ref{algebra-lemma-composition-flat}.
\end{proof}

\begin{lemma}
\label{lemma-composition-flat}
The composition of flat morphisms is flat.
\end{lemma}

\begin{proof}
This is a special case of Lemma \ref{lemma-composition-module-flat}.
\end{proof}

\begin{lemma}
\label{lemma-base-change-module-flat}
Let $f : X \to S$ be a morphism of schemes. Let $\mathcal{F}$ be a
quasi-coherent sheaf of $\mathcal{O}_X$-modules.
Let $g : S' \to S$ be a morphism of schemes. Denote
$g' : X_{S'} \to X$ the projection. If $\mathcal{F}$ is flat
over $S$, then $(g')^*\mathcal{F}$ is flat over $S'$.
\end{lemma}

\begin{proof}
See Algebra, Lemma \ref{algebra-lemma-flat-base-change}.
\end{proof}

\begin{lemma}
\label{lemma-base-change-flat}
The base change of a flat morphism is flat.
\end{lemma}

\begin{proof}
This is a special case of Lemma \ref{lemma-base-change-module-flat}.
\end{proof}

\begin{lemma}
\label{lemma-fppf-open}
A flat morphism locally of finite presentation is universally open.
\end{lemma}

\begin{proof}
This follows because generalizations lift along a flat morphism
(see Algebra, Section \ref{algebra-section-going-up}), and
Lemma \ref{lemma-locally-finite-presentation-universally-open} above.
We can also argue directly as follows.

\medskip\noindent
Let $f : X \to S$ be flat locally of finite presentation.
To show $f$ is open it suffices to show that we may cover
$X$ by open affines $X = \bigcup U_i$ such that $U_i \to S$
is open. By definition we may cover $X$ by
affine opens $U_i \subset X$ such that each $U_i$ maps
into an affine open $V_i \subset S$ and such that
the induced ring map $\mathcal{O}_S(V_i) \to \mathcal{O}_X(U_i)$ is
of finite presentation. Thus $U_i \to V_i$ is open by
Algebra, Proposition \ref{algebra-proposition-fppf-open}.
The lemma follows.
\end{proof}

















\section{Syntomic morphisms}
\label{section-syntomic}

\begin{definition}
\label{definition-syntomic}
Let $f : X \to S$ be a morphism of schemes.
\begin{enumerate}
\item We say that $f$ is {\it syntomic at $x \in X$} if 
there exists a affine open neighbourhood $\text{Spec}(A) = U \subset X$
of $x$ and and affine open $\text{Spec}(R) = V \subset S$
with $f(U) \subset V$ such that the induced ring map
$R \to A$ is syntomic, see
Algebra, Definition \ref{algebra-definition-lci}.
\item We say that $f$ is {\it syntomic} if it is syntomic
at every point of $X$.
\item We say that a morphism of affine schemes $f : X \to S$
is {\it standard syntomic} if there exists a global relative complete
intersection $R \to R[x_1, \ldots, x_n]/(f_1, \ldots, f_c)$ (see
Algebra,
Definition \ref{algebra-definition-relative-global-complete-intersection})
such that $X \to S$ is isomorphic to
$$
\text{Spec}(R[x_1, \ldots, x_n]/(f_1, \ldots, f_c)) \to \text{Spec}(R).
$$
\end{enumerate}
\end{definition}

\noindent
Note that syntomic $=$ locally syntomic.
According to Lemmas \ref{lemma-properties-local},
\ref{lemma-properties-base-change}, and
\ref{lemma-properties-composition} the property of a ring map
being syntomic is local, stable under base change,
and stable under composition.  Hence
Lemma \ref{lemma-locally-P} gives some properties
of syntomic morphisms which we will use in the following
without further mention.

\begin{lemma}
\label{lemma-composition-syntomic}
The composition of syntomic morphisms is syntomic.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-base-change-syntomic}
The base change of a syntomic morphism is syntomic.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-syntomic-locally-finite-presentation}
A syntomic morphism is locally of finite presentation.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}




















\section{Smooth morphisms}
\label{section-smooth}

\begin{definition}
\label{definition-smooth}
Let $f : X \to S$ be a morphism of schemes.
\begin{enumerate}
\item We say that $f$ is {\it smooth at $x \in X$} if 
there exists a affine open neighbourhood $\text{Spec}(A) = U \subset X$
of $x$ and and affine open $\text{Spec}(R) = V \subset S$
with $f(U) \subset V$ such that the induced ring map
$R \to A$ is smooth, see Algebra, Definition \ref{algebra-definition-smooth}.
\item We say that $f$ is {\it smooth} if it is smooth at every point of $X$.
\item We say that a morphism of affine schemes $f : X \to S$
is {\it standard smooth} there exists a standard smooth ring
map $R \to R[x_1, \ldots, x_n]/(f_1, \ldots, f_c)$ (see
Algebra, Definition \ref{algebra-definition-standard-smooth})
such that $X \to S$ is isomorphic to
$$
\text{Spec}(R[x_1, \ldots, x_n]/(f_1, \ldots, f_c)) \to \text{Spec}(R).
$$
\end{enumerate}
\end{definition}

\noindent
Note that smooth $=$ locally smooth.
According to Lemmas \ref{lemma-properties-local},
\ref{lemma-properties-base-change}, and
\ref{lemma-properties-composition} the property of a ring map
being smooth is local, stable under base change,
and stable under composition.  Hence
Lemma \ref{lemma-locally-P} gives some properties
of smooth morphisms which we will use in the following
without further mention.

\begin{lemma}
\label{lemma-composition-smooth}
The composition of smooth morphisms is smooth.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-base-change-smooth}
The base change of a smooth morphism is smooth.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-smooth-syntomic}
A smooth morphism is syntomic, and hence locally of finite presentation.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}
















\section{Relatively ample sheaves}
\label{section-relatively-ample}

\noindent
Let $X \to S$ be a morphism of schemes.
Contrary to what one may think the existence of a relatively
ample sheaf on $X$ does not force the morphism $X \to S$ to be
of finite type. Here is the definition.

\begin{definition}
\label{definition-relatively-ample}
Let $f : X \to S$ be a morphism of schemes.
Let $\mathcal{L}$ be an invertible $\mathcal{O}_X$-module.
We say {\it $\mathcal{L}$ is $f$-relatively ample}, or
{\it $\mathcal{L}$ is ample on $X/S$} if $f : X \to S$
is quasi-compact, and if for every affine open $V \subset S$
the restriction of $\mathcal{L}$ to the open subscheme
$f^{-1}(V)$ of $X$ is ample.
\end{definition}

\begin{lemma}
\label{lemma-relatively-ample-separated}
Let $f : X \to S$ be a morphism of schemes.
If there exists an $f$-ample invertible sheaf, then
$f$ is separated.
\end{lemma}

\begin{proof}
Being separated is local on the base (see
Schemes, Lemma \ref{schemes-lemma-characterize-separated} for example;
it also follows easily from the definition).
Hence we may assume $S$ is affine and $X$
has an ample invertible sheaf. In this case the
result follows from
Properties, Lemma \ref{properties-lemma-ample-immersion-into-proj}
and Constructions, Lemma \ref{constructions-lemma-proj-separated}.
\end{proof}

\noindent
There are many ways to charactarize relatively ample invertible
sheaves, by relativizing any of the list of equivalent conditions in
Properties, Proposition \ref{properties-proposition-characterize-ample}.
We will add these here as needed.

\begin{lemma}
\label{lemma-characterize-relatively-ample}
Let $f : X \to S$ be a quasi-compact morphism of schemes.
Let $\mathcal{L}$ be an invertible sheaf on $X$.
The following are equivalent:
\begin{enumerate}
\item The invertible sheaf $\mathcal{L}$ is $f$-ample.
\item There exists an affine open covering $S = \bigcup U_i$
such that each $\mathcal{L}|_{f^{-1}(U_i)}$ is ample.
\item There exists a graded $\mathcal{O}_S$-algebra
$\mathcal{A}$ and a map of graded $\mathcal{O}_X$-algebras
$\varphi : f^*\mathcal{A} \to \bigoplus_{d \geq 0} \mathcal{L}^{\otimes d}$
such that $U(\varphi) = X$ and $r_{\mathcal{L}, \varphi}$
is an open immersion (see Constructions, Lemma
\ref{constructions-lemma-invertible-map-into-relative-proj} for notation).
\item The morphism $f$ is quasi-separated and
part (3) above holds with
$\mathcal{A} = f_*(\bigoplus_{d \geq 0} \mathcal{L}^{\otimes d})$
and $\varphi$ the adjunction mapping.
\end{enumerate}
\end{lemma}

\begin{proof}
Omitted.
\end{proof}



\section{Very ample sheaves}
\label{section-very-ample}


\begin{definition}
\label{definition-very-ample}
Let $f : X \to S$ be a morphism of schemes.
Let $\mathcal{L}$ be an invertible $\mathcal{O}_X$-module.
We say {\it $\mathcal{L}$ is $f$-relatively very ample}, or
{\it $\mathcal{L}$ is very ample on $X/S$} if
there exist a quasi-coherent $\mathcal{O}_S$-module
$\mathcal{E}$ and an immersion $i : X \to \mathbf{P}(\mathcal{E})$
over $S$ such that
$\mathcal{L} \cong i^*\mathcal{O}_{\mathbf{P}(\mathcal{E})}(1)$.
\end{definition}








\section{Quasi-projective morphisms}
\label{section-quasi-projective}



\begin{definition}
\label{definition-quasi-projective}
Let $f : X \to S$ be a morphism of schemes.
We say $f$ is {\it quasi-projective} if $f$ is of finite type
and there exists an $f$-relatively ample invertible $\mathcal{O}_X$-module.
\end{definition}








\section{Proper morphisms}
\label{section-proper}


\begin{definition}
\label{definition-proper}
Let $f : X \to S$ be a morphism of schemes.
We say {\it $f$ is proper} if $f$ is separated, finite type, and
universally closed.
\end{definition}

\begin{lemma}
\label{lemma-proper-local-on-the-base}
Let $f : X \to S$ be a morphism of schemes.
The following are equivalent:
\begin{enumerate}
\item The morphism $f$ is proper.
\item There exists an open covering $S = \bigcup V_j$ such
that $f^{-1}(V_j) \to V_j$ is proper for all indices $j$.
\end{enumerate}
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-composition-proper}
The composition of proper morphisms is proper.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-base-change-proper}
The base change of a proper morphism is proper.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-closed-immersion-proper}
A closed immersion is proper.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-image-proper-scheme-closed}
Suppose given a commutative diagram of schemes
$$
\xymatrix{
X \ar[r] \ar[rd] &
Y \ar[d] \\
& S
}
$$
with $X$ proper over $S$ and $Y$ separated over $S$.
Then the morphism $X \to Y$ is proper.
\end{lemma}

\begin{proof}
We factor the morphism as $X \to X \times_S Y \to Y$.
The first morphism is a closed immersion, see
Schemes, Lemma \ref{schemes-lemma-semi-diagonal}.
Hence the first morphism is proper (Lemma \ref{lemma-closed-immersion-proper}).
The projection $X \times_S Y \to Y$ is the base change
of a proper morphism and hence proper (Lemma \ref{lemma-base-change-proper}).
Thus $X \to Y$ is proper as the composition of proper morphisms
(Lemma \ref{lemma-composition-proper}).
\end{proof}







\section{Projective morphisms}
\label{section-projective}

\noindent
The definition of a projective morphism is not local over the base.
Also, the definition of projective in EGA and in Hartshorne are
different and both are usefull.

\begin{definition}
\label{definition-projective}
Let $f : X \to S$ be a morphism of schemes.
\begin{enumerate}
\item We say {\it $f$ is projective} if $X$ is isomorphic as
an $S$-scheme to a closed subscheme of a projective
bundle $\mathbf{P}(\mathcal{E})$ (see
Constructions, Definition \ref{constructions-definition-projective-bundle})
for some quasi-coherent, finite type $\mathcal{O}_S$-module $\mathcal{E}$.
\item We say {\it $f$ is H-projective} if there exists and integer $n$ and
a closed immersion $X \to \mathbf{P}^n_S$ over $S$.
\item We say {\it $f$ is locally projective} if there exists an open
covering $S = \bigcup U_i$ such that each $f^{-1}(U_i) \to U_i$ is
projective.
\end{enumerate}
\end{definition}

\begin{lemma}
\label{lemma-H-projective}
An H-projective morphism is projective.
\end{lemma}

\begin{proof}
This is true because $\mathbf{P}^n_S$ is a projective bundle, see
Constructions, Section \ref{constructions-section-projective-bundle}.
\end{proof}

\begin{lemma}
\label{lemma-characterize-locally-projective}
Let $f : X \to S$ be a morphism of schemes.
The following are equivalent:
\begin{enumerate}
\item The morphism $f$ is locally projective.
\item There exists an open covering $S = \bigcup U_i$ such
that each $f^{-1}(U_i) \to U_i$ is H-projective.
\end{enumerate}
\end{lemma}

\begin{proof}
By Lemma \ref{lemma-H-projective} we see that (2) implies (1). Assume (1).
For every point $s \in S$ we can find $\text{Spec}(R) = U \subset S$
an affine open neighbourhood of $s$ such that $X_U$ is isomorphic to a
closed subscheme of $\mathbf{P}(\mathcal{E})$ for some finite type,
quasi-coherent sheaf of $\mathcal{O}_U$-modules $\mathcal{E}$. 
Write $\mathcal{E} = \widetilde{M}$ for some finite type
$R$-module $M$ (see
Properties, Lemma \ref{properties-lemma-finite-type-module}).
Choose generators $x_0, \ldots, x_n \in M$ of $M$ as an $R$-module.
Consider the surjective graded $R$-algebra map
$$
R[X_0, \ldots, X_n] \longrightarrow \text{Sym}_R(M).
$$
According to
Constructions, Lemma \ref{constructions-lemma-surjective-graded-rings-map-proj}
the corresponding morphism
$$
\mathbf{P}(\mathcal{E}) \to \mathbf{P}^n_R
$$
is a closed immersion. Hence we conclude that $f^{-1}(U)$ is isomorphic
to a closed subscheme of $\mathbf{P}^n_U$ (as a scheme over $U$).
In other words: (2) holds.
\end{proof}

\begin{lemma}
\label{lemma-locally-projective-proper}
A locally projective morphism is proper.
\end{lemma}

\begin{proof}
Let $f : X \to S$ be locally projective.
In order to show that $f$ is proper we may work locally on the
base, see Lemma \ref{lemma-proper-local-on-the-base}.
Hence, by Lemma \ref{lemma-characterize-locally-projective}
above we may assume there exists a closed immersion $X \to \mathbf{P}^n_S$.
By Lemmas \ref{lemma-composition-proper}
and \ref{lemma-closed-immersion-proper} it suffices to prove that
$\mathbf{P}^n_S \to S$ is proper. Since
$\mathbf{P}^n_S \to S$ is the base change of
$\mathbf{P}^n_{\mathbf{Z}} \to \text{Spec}(\mathbf{Z})$ it suffices
to show that $\mathbf{P}^n_{\mathbf{Z}} \to \text{Spec}(\mathbf{Z})$
is proper, see Lemma \ref{lemma-base-change-proper}.
By Constructions, Lemma \ref{constructions-lemma-proj-separated} the scheme
$\mathbf{P}^n_{\mathbf{Z}}$ is separated.
By Constructions, Lemma \ref{constructions-lemma-proj-quasi-compact} the scheme
$\mathbf{P}^n_{\mathbf{Z}}$ is quasi-compact.
It is clear that $\mathbf{P}^n_{\mathbf{Z}} \to \text{Spec}(\mathbf{Z})$
is locally of finite type since $\mathbf{P}^n_{\mathbf{Z}}$ is
covered by the affine opens $D_{+}(X_i)$ each of which is the
spectrum of the finite type $\mathbf{Z}$-algebra
$$
\mathbf{Z}[X_0/X_i, \ldots, X_n/X_i].
$$
Finally, we have to show that
$\mathbf{P}^n_{\mathbf{Z}} \to \text{Spec}(\mathbf{Z})$
is universally closed. This follows from
Constructions, Lemma \ref{constructions-lemma-proj-valuative-criterion}
and the valuative criterion (see Schemes,
Proposition \ref{schemes-proposition-characterize-universally-closed}).
\end{proof}

\begin{lemma}
\label{lemma-segre-embedding}
Let $S$ be a scheme. There exists a closed immersion
$$
\mathbf{P}^n_S \times_S \mathbf{P}^m_S
\longrightarrow
\mathbf{P}^{nm + n + m}_S
$$
called the {\it Segre embedding}.
\end{lemma}

\begin{proof}
It suffices to prove this when $S = \text{Spec}(\mathbf{Z})$.
Hence we will drop the index $S$ and work in the absolute setting.
Write $\mathbf{P}^n = \text{Proj}(\mathbf{Z}[X_0, \ldots, X_n])$,
$\mathbf{P}^m = \text{Proj}(\mathbf{Z}[Y_0, \ldots, Y_m])$,
and
$\mathbf{P}^{nm + n + m} =
\text{Proj}(\mathbf{Z}[Z_0, \ldots, Z_{nm + n + m}])$.
In order to map into $\mathbf{P}^{nm + n + m}$ we have to
write down an invertible sheaf $\mathcal{L}$ on the left hand
side and $(n + 1)(m + 1)$ sections $s_i$ which generate it.
See Constructions, Lemma \ref{constructions-lemma-projective-space}.
The invertible sheaf we take is
$$
\mathcal{L} =
\text{pr}_1^*\mathcal{O}_{\mathbf{P}^n}(1)
\otimes
\text{pr}_2^*\mathcal{O}_{\mathbf{P}^m}(1)
$$
The sections we take are
$$
s_0 = X_0Y_0,\ s_1 = X_1Y_0, \ldots,\ s_n = X_nY_0,\ 
s_{n + 1} = X_0Y_1,\ldots,\ s_{nm + n + m} = X_nY_m.
$$
These generate $\mathcal{L}$ since the sections $X_i$ generate
$\mathcal{O}_{\mathbf{P}^n}(1)$ and the sections $Y_j$ generate
$\mathcal{O}_{\mathbf{P}^m}(1)$. The induced morphism 
$\varphi$ has the property that
$$
\varphi^{-1}(D_{+}(Z_{i + (n + 1)j})) = D_{+}(X_i) \times D_{+}(Y_j).
$$
Hence it is an affine morphism. The corresponding ring map in case
$(i, j) = (0, 0)$ is the map
$$
\mathbf{Z}[Z_1/Z_0, \ldots, Z_{nm + n + m}/Z_0]
\longrightarrow
\mathbf{Z}[X_1/X_0, \ldots, X_n/X_0, Y_1/Y_0, \ldots, Y_n/Y_0]
$$
which maps $Z_i/Z_0$ to the element $X_i/X_0$ for $i \leq n$ and
the element $Z_{(n + 1)j}/Z_0$ to the element $Y_j/Y_0$. Hence it
is surjective. A similar argument works for the other affine
open subsets. Hence the morphism $\varphi$ is a closed immersion.
\end{proof}

\begin{lemma}
\label{lemma-H-projective-composition}
A composition of H-projective morphisms is projective.
\end{lemma}

\begin{proof}
Suppose $X \to Y$ and $Y \to Z$ are H-projective.
Then there exist closed immersions $X \to \mathbf{P}^n_Y$
over $Y$, and $Y \to \mathbf{P}^m_Z$ over $Z$.
Consider the following diagram
$$
\xymatrix{
X \ar[r] \ar[d] &
\mathbf{P}^n_Y \ar[r] \ar[dl] &
\mathbf{P}^n_{\mathbf{P}^m_Z} \ar[dl] \ar@{=}[r] &
\mathbf{P}^n_Z \times_Z \mathbf{P}^m_Z \ar[r] &
\mathbf{P}^{nm + n + m}_Z \ar[ddllll] \\
Y \ar[r] \ar[d] & \mathbf{P}^m_Z \ar[dl] & \\
Z & &
}
$$
Here the leftmost top horizontal arrow is the Segre embedding,
see Lemma \ref{lemma-segre-embedding}. The diagram identifies
$X$ as a closed subscheme of $\mathbf{P}^{nm + n + m}_Z$ as desired.
\end{proof}

\begin{lemma}
\label{lemma-H-projective-base-change}
A base change of a H-projective morphism is H-projective.
\end{lemma}

\begin{proof}
This is true because the base change of projective space
over a scheme is projective space, and the fact that the base
change of a closed immersion is a closed immersion, see
Schemes, Lemma \ref{schemes-lemma-base-change-immersion}.
\end{proof}











\section{Integral and finite morphisms}
\label{section-integral}


\begin{definition}
\label{definition-integral}
Let $f : X \to S$ be a morphism of schemes.
\begin{enumerate}
\item We say that $f$ is {\it integral} if $f$ is affine
and if for every affine open $\text{Spec}(R) = V \subset S$
with inverse image $\text{Spec}(A) = f^{-1}(V) \subset X$
the associated ring map $R \to A$ is integral.
\item We say that $f$ is {\it finite} if $f$ is affine
and if for every affine open $\text{Spec}(R) = V \subset S$
with inverse image $\text{Spec}(A) = f^{-1}(V) \subset X$
the associated ring map $R \to A$ is finite.
\end{enumerate}
\end{definition}








































\input{chapters}

\bibliography{my}
\bibliographystyle{alpha}

\end{document}
