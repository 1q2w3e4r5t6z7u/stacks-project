\input{preamble}

% OK, start here.
%
\begin{document}

\title{Descent in fpqc topology}

\maketitle

\phantomsection
\label{section-phantom}

\tableofcontents

\section{Introduction}
\label{section-introduction}

\noindent
In this chapter we discuss what kind of structures over schemes
have the property that descent data with respect to fpqc coverings
are effective. See for example \cite{Gr-I}, \cite{Gr-II}, \cite{Gr-III},
\cite{Gr-IV}, \cite{Gr-V}, and \cite{Gr-VI}.
This is also meant to introduce the notions of
descent, descent data, effective descent data, in the less formal
setting of descent questions for quasi-coherent sheaves, schemes, etc.

\section{Descent data for quasi-coherent sheaves}
\label{section-equivalence}

\noindent
In this chapter we will use the convention where
the projection maps $\text{pr}_i : X \times \ldots \times X \to X$
are labeled starting with $i = 0$. Hence we have
$\text{pr}_0, \text{pr}_1 : X \times X  \to X$,
$\text{pr}_0, \text{pr}_1, \text{pr}_2 : X \times X \times X  \to X$,
etc.


\begin{definition}
\label{definition-descent-datum-quasi-coherent}
Let $S$ be a scheme. Let $\{f_i : S_i \to S\}_{i \in I}$ be a family
of morphisms with target $S$.
\begin{enumerate}
\item A {\it descent datum $(\mathcal{F}_i, \varphi_{ij})$
for quasi-coherent sheaves} with respect to the given family
is given by a quasi-coherent sheaf $\mathcal{F}_i$ on $S_i$ for
each $i \in I$, an isomorphism of quasi-coherent
$\mathcal{O}_{S_i \times_S S_j}$-modules
$\varphi_{ij} : \text{pr}_0^*\mathcal{F}_i \to \text{pr}_1^*\mathcal{F}_j$
for each pair $(i, j) \in I^2$
such that for every triple of indices $(i, j, k) \in I^3$ the
diagram
$$
\xymatrix{
\text{pr}_0^*\mathcal{F}_i \ar[rd]_{\text{pr}_{01}^*\varphi_{ij}}
\ar[rr]_{\text{pr}_{02}^*\varphi_{ik}} & &
\text{pr}_2^*\mathcal{F}_k \\
& \text{pr}_1^*\mathcal{F}_j \ar[ru]_{\text{pr}_{12}^*\varphi_{jk}} &
}
$$
of $\mathcal{O}_{S_i \times_S S_j \times_S S_k}$-modules
commutes. This is called the {\it cocycle condition}.
\item A {\it morphism $\psi : (\mathcal{F}_i, \varphi_{ij}) \to
(\mathcal{F}'_i, \varphi'_{ij})$ of descent data} is given
by a family $\psi = (\psi_i)_{i\in I}$ of morphisms of
$\mathcal{O}_{S_i}$-modules $\psi_i : \mathcal{F}_i \to \mathcal{F}'_i$
such that all the diagrams
$$
\xymatrix{
\text{pr}_0^*\mathcal{F}_i \ar[r]_{\varphi_{ij}} \ar[d]_{\text{pr}_0^*\psi_i}
& \text{pr}_1^*\mathcal{F}_j \ar[d]^{\text{pr}_1^*\psi_j} \\
\text{pr}_0^*\mathcal{F}'_i \ar[r]^{\varphi'_{ij}} &
\text{pr}_1^*\mathcal{F}'_j \\
}
$$
commute.
\end{enumerate}
\end{definition}

\noindent
A good example to keep in mind is the following.
Suppose that $S = \bigcup S_i$ is an open covering.
In that case we have seen descent data for sheaves of sets in
Sheaves, Section \ref{sheaves-section-glueing-sheaves}
where we called them ``glueing data for sheaves of sets
with respect to the given covering''. Moreover, we proved
that the category of glueing data is equivalent to the category
of sheaves on $S$. We will show the analogue in the setting above when
$\{S_i \to S\}_{i\in I}$ is an fpqc covering.

\medskip\noindent
In the extreme case where the covering $\{S \to S\}$
is given by $\text{id}_S$ a descent datum is necessarily
of the form $(\mathcal{F}, \text{id}_{\mathcal{F}})$. The cocycle
condition garantees that the identity on $\mathcal{F}$ is the
only permitted map in this case. The following lemma shows
in particular that to every quasi-coherent sheaf of
$\mathcal{O}_S$-modules there is associated a unique
descent datum with respect to any given family.

\begin{lemma}
\label{lemma-refine-descent-datum}
Let $S$ be a scheme.
Let $\mathcal{U} = \{U_i \to S\}_{i \in I}$ and
$\mathcal{V} = \{V_j \to S\}_{j \in J}$
be families of morphisms with target $S$.
Assume $\mathcal{U}$ is a refinement of $\mathcal{V}$, so
there exist $\alpha : I \to J$, and morphisms $g_i : U_i \to V_{\alpha(i)}$
over $S$, see Sites, Definition \ref{sites-definition-morphism-coverings}.
Let $(\mathcal{F}_j, \varphi_{jj'})$ be a descent
datum for quasi-coherent sheaves with respect to the
family $\{V_j \to S\}_{j \in J}$. Then
\begin{enumerate}
\item The system
$$
\left(g_i^*\mathcal{F}_{\alpha(i)}, \ 
(g_i \times g_{i'})^*\varphi_{\alpha(i)\alpha(i')}\right)
$$
is a descent datum with respect to the family $\{U_i \to S\}_{i \in I}$.
\item This construction is functorial in the descent datum
$(\mathcal{F}_j, \varphi_{jj'})$.
\item Given a second $\alpha' : I \to J$ and
$g'_i : U_i \to V_{\alpha'(i)}$ there exists a functorial
isomorphism of descent data
$(g_i^*\mathcal{F}_{\alpha(i)},
(g_i \times g_{i'})^*\varphi_{\alpha(i)\alpha(i')})
\cong
((g'_i)^*\mathcal{F}_{\alpha'(i)},
(g'_i \times g'_{i'})^*\varphi_{\alpha'(i)\alpha'(i')})$.
\end{enumerate}
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\noindent
Any family $\mathcal{U} = \{S_i \to S\}_{i \in I}$ is a refinement of
the trivial covering $\{S \to S\}$ in a unique way. For
a quasi-coherent sheaf $\mathcal{F}$ on $S$ we denote simply
$(\mathcal{F}|_{S_i}, can)$ the descent datum with respect to
$\mathcal{U}$ obtained by the procedure above.

\begin{definition}
\label{definition-descent-datum-effective-quasi-coherent}
Let $S$ be a scheme.
Let $\{S_i \to S\}_{i \in I}$ be a family of morphisms
with target $S$. A descent datum $(\mathcal{F}_i, \varphi_{ij})$
for quasi-coherent sheaves with respect to the given covering
is said to be {\it effective} if there exists a quasi-coherent
sheaf $\mathcal{F}$ on $S$ such that $(\mathcal{F}_i, \varphi_{ij})$
is isomorphic to $(\mathcal{F}|_{S_i}, can)$.
\end{definition}

\begin{lemma}
\label{lemma-zariski-descent-effective}
Let $S$ be a scheme.
Let $S = \bigcup U_i$ be an open covering.
Any descent datum on quasi-coherent sheaves
for the family $\mathcal{U} = \{U_i \to S\}$ is
effective. Moreover, the functor from the category of
quasi-coherent $\mathcal{O}_S$-modules to the category
of descent data with respect to $\mathcal{U}$ is fully faithful.
\end{lemma}

\begin{proof}
This follows immediately from
Sheaves, Section \ref{sheaves-section-glueing-sheaves}
and the fact that being quasi-coherent is a local property, see
Modules, Definition \ref{modules-definition-quasi-coherent}.
\end{proof}

\noindent
To prove more we first need to study the case of modules over rings.










\section{Descent for modules}
\label{section-descent-modules}

\noindent
Let $R \to A$ be a ring map.
By Simplicial, Example \ref{simplicial-example-push-outs-simplicial-object}
this gives rise to a cosimplicial $R$-algebra
$$
\xymatrix{
A
\ar@<1ex>[r]
\ar@<-1ex>[r]
&
A\otimes_R A
\ar@<0ex>[l]
\ar@<2ex>[r]
\ar@<0ex>[r]
\ar@<-2ex>[r]
&
A \otimes_R A \otimes_R A
\ar@<1ex>[l]
\ar@<-1ex>[l]
}
$$
Let us denote this $(A/R)_\bullet$ so that $(A/R)_n$ is the $(n + 1)$-fold
tensor product of $A$ over $R$. Given a map
$\varphi : [n] \to [m]$ the $R$-algebra map $(A/R)_\bullet(\varphi)$
is the map
$$
a_0 \otimes \ldots \otimes a_n
\longmapsto
\prod\nolimits_{\varphi(i) = 0} a_i
\otimes
\prod\nolimits_{\varphi(i) = 1} a_i
\otimes \ldots \otimes
\prod\nolimits_{\varphi(i) = m} a_i
$$
where we use the convention that the empty product is $1$.

\medskip\noindent
An $R$-module $M$ gives rise to a cosimplicial $(A/R)_\bullet$-module
$(A/R)_\bullet \otimes_R M$. In other words
$M_n = (A/R)_n \otimes_R M$ and using the $R$-algebra maps
$(A/R)_n \to (A/R)_m$ to define the corresponding maps on
$M \otimes_R (A/R)_\bullet$.

\medskip\noindent
The analogue to a descent datum
for quasi-coherent sheaves in the setting of modules is the following.

\begin{definition}
\label{definition-descent-datum-modules}
Let $R \to A$ be a ring map.
\begin{enumerate}
\item A {\it descent datum $(N, \varphi)$ for modules
with respect to $R \to A$}
is given by an $A$-module $N$ and a isomorphism of
$A \otimes_R A$-modules
$$
\varphi : N \otimes_R A \to A \otimes_R N
$$
such that the {\it cocycle condition} holds: the diagram
of $A \otimes_R A \otimes_R A$-module maps
$$
\xymatrix{
N \otimes_R A \otimes_R A \ar[rr]_{\varphi_{02}}
\ar[rd]_{\varphi_{01}}
& &
A \otimes_R A \otimes_R N \\
& A \otimes_R N \otimes_R A \ar[ru]_{\varphi_{12}} &
}
$$
commutes (see below for notation).
\item A {\it morphism $(N, \varphi) \to (N', \varphi')$ of descent data}
is a morphism of $A$-modules $\psi : N \to N'$ such that
the diagram
$$
\xymatrix{
N \otimes_R A \ar[r]_\varphi \ar[d]_{\psi \otimes \text{id}_A} &
A \otimes_R N \ar[d]^{\text{id}_A \otimes \psi} \\
N' \otimes_R A \ar[r]^{\varphi'} &
A \otimes_R N'
}
$$
is commutative.
\end{enumerate}
\end{definition}

\noindent
In the definition we use the notation that
$\varphi_{01} = \varphi \otimes \text{id}_A$,
$\varphi_{12} = \text{id}_A \otimes \varphi$, and
$\varphi_{02}(n \otimes 1 \otimes 1) = \sum a_i \otimes 1 \otimes n_i$
if $\varphi(n) = \sum a_i \otimes n_i$. All three are
$A \otimes_R A \otimes_R A$-module homomorphisms. Equivalently we have
$$
\varphi_{ij}
=
\varphi \otimes_{(A/R)_1, \ (A/R)_\bullet(\tau^2_{ij})} (A/R)_2
$$
where $\tau^2_{ij} : [1] \to [2]$ is the map
$0 \mapsto i$, $1 \mapsto j$. Namely,
$(A/R)_{\bullet}(\tau^2_{02})(a_0 \otimes a_1) =
a_0 \otimes 1 \otimes a_1$,
and similarly for the others.

\medskip\noindent
We need some more notation to be able to state the next lemma.
For $n \geq 0$ and $i \in [n]$ we set
$$
N_{n, i} =
A \otimes_R
\ldots
\otimes_R A \otimes_R N \otimes_R A \otimes_R
\ldots
\otimes_R A
$$
with the factor $N$ in the $i$th spot. It is an $(A/R)_n$-module.
If we introduce the maps $\tau^n_i : [0] \to [n]$, $0 \mapsto i$
then we see that
$$
N_{n, i} = N \otimes_{(A/R)_0, \ (A/R)_\bullet(\tau^n_i)} (A/R)_n
$$
For $0 \leq i \leq j \leq n$ we let $\tau^n_{ij} : [1] \to [n]$
be the map such that $0$ maps to $i$ and $1$ to $j$. Similarly
to the above the homomorphism $\varphi$ induces isomorphisms
$$
\varphi^n_{ij}
=
\varphi \otimes_{(A/R)_1, \ (A/R)_\bullet(\tau^n_{ij})} (A/R)_n :
N_{n, i} \longrightarrow N_{n, j}
$$
of $(A/R)_n$-modules when $i < j$. If $i = j$ we set
$\varphi^n_{ij} = \text{id}$. Since these are all isomorphisms they allow us
to move the factor $N$ to any spot we like. And the cocycle condition
exactly means that it does not matter how we do this (e.g., as a composition
of two of these or at once). Finally, for any $\beta : [n] \to [m]$
we define the morphism
$$
N_{\beta, i} : N_{n, i} \to N_{m, \beta(i)}
$$
as the unique $(A/R)_\bullet(\beta)$-semi linear map such that
$$
N_{\beta, i}(1 \otimes \ldots \otimes n \otimes \ldots \otimes 1)
=
1 \otimes \ldots \otimes n \otimes \ldots \otimes 1
$$
for all $n \in N$.
This hints at the following lemma.

\begin{lemma}
\label{lemma-descent-datum-cosimplicial}
Let $R \to A$ be a ring map.
Given a descent datum $(N, \varphi)$ we can associate to it a
cosimplicial $(A/R)_\bullet$-module $N_\bullet$\footnote{We should really
write $(N, \varphi)_\bullet$.} by the
rules $N_n = N_{n, n}$ and given $\beta : [n] \to [m]$
setting we define
$$
N_\bullet(\beta) = (\varphi^m_{\beta(n)m}) \circ N_{\beta, n} :
N_{n, n} \longrightarrow N_{m, m}.
$$
This procedure is functorial in the descent datum.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\noindent
Note that to an $R$-module $M$ we can associate a canonical
descent datum, namely $(M \otimes_R A, can)$ where
$can : (M \otimes_R A) \otimes_R A \to A \otimes_R (M \otimes_R A)$
is the obvious map:
$(m \otimes a) \otimes a' \mapsto a \otimes (m \otimes a')$.

\begin{lemma}
\label{lemma-canonical-descent-datum-cosimplicial}
Let $R \to A$ be a ring map.
Let $M$ be an $R$-module. The cosimplicial
$(A/R)_\bullet$-module associated to the canonical descent
datum is isomorphic to the cosimplicial module $(A/R)_\bullet \otimes_R M$.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{definition}
\label{definition-descent-datum-effective-module}
Let $R \to A$ be a ring map.
We say a descent datum $(N, \varphi)$ is {\it effective}
if there exists an $R$-module $M$ and an isomorphism
of descent data from $(M \otimes_R A, can)$ to
$(N, \varphi)$.
\end{definition}

\noindent
Let $R \to A$ be a ring map.
Let $(N, \varphi)$ be a descent datum.
We may take the cochain complex $s(N_\bullet)$ associated
with $N_\bullet$ (see
Simplicial, Section \ref{simplicial-section-dold-kan-cosimplicial}).
It has the following shape:
$$
N \to A\otimes_R N \to A \otimes_R A \otimes_R N \to \ldots
$$
We can describe the maps.
The first map is the map
$$
n \longmapsto 1 \otimes n - \varphi(n \otimes 1).
$$
The second map on pure tensors has the values
$$
a \otimes n \longmapsto 1 \otimes a \otimes n
- a \otimes 1 \otimes n + a \otimes \varphi(n \otimes 1).
$$
It is clear how the pattern continues.

\medskip\noindent
In the special case
where $N = A \otimes_R M$ we see that for any $m \in M$
the element $1 \otimes m$ is in the kernel of the first map
of the cochain complex associated to the cosimplicial
module $(A/R)_\bullet \otimes_R M$. Hence we get an extended cochain complex
\begin{equation}
\label{equation-extended-complex}
0 \to M \to A \otimes_R M \to A \otimes_R A \otimes_R M \to \ldots
\end{equation}
Here we think of the $0$ as being in degree $-2$,
the module $M$ in degree $-1$, the module $A \otimes_R M$ in
degree $0$, etc. Note that this complex has the shape
$$
0 \to R \to A \to A \otimes_R A \to A \otimes_R A \otimes_R A \to \ldots
$$
when $M = R$.

\begin{lemma}
\label{lemma-with-section-exact}
Suppose that $R \to A$ has a section.
Then for any $R$-module $M$ the extended cochain complex
(\ref{equation-extended-complex}) is exact.
\end{lemma}

\begin{proof}
By
Simplicial, Lemma \ref{simplicial-lemma-push-outs-simplicial-object-w-section}
the map $R \to (A/R)_\bullet$ is a homotopy equivalence
(here $R$ denotes the constant cosimplicial ring).
We may think of this as a homotopy equivalence in the
category of $R$-algebras.
Hence also $M \to (A/R)_\bullet \otimes_R M$ is
a homotopy equivalence in the category of cosimplicial
$R$-modules, because $\otimes_R M$ is a
functor from the category of $R$-algebras to the category
of $R$-modules, see
Simplicial, Lemma \ref{simplicial-lemma-functorial-homotopy}.
But this means that the associated map of associated
complexes is a homotopy equivalence, see
Simplicial, Lemma \ref{simplicial-lemma-homotopy-s-Q}.
Since the complex associated to the constant cosimplicial
$R$-module $M$ is the complex
$$
\xymatrix{
M \ar[r]^0 & M \ar[r]^1 & M \ar[r]^0 & M \ar[r]^1 & M \ldots
}
$$
we win (since the extended version simply puts an extra $M$ at
the beginning).
\end{proof}

\begin{lemma}
\label{lemma-ff-exact}
Suppose that $R \to A$ is faithfully flat, see
Algebra, Definition \ref{algebra-definition-flat}.
Then for any $R$-module $M$ the extended cochain complex
(\ref{equation-extended-complex}) is exact.
\end{lemma}

\begin{proof}
Suppose we can show there exists a faithfully flat ring map
$R \to R'$ such that the result holds for the ring map
$R' \to A' = R' \otimes_R A$. Then the result follows for
$R \to A$. Namely, for any $R$-module $M$ the cosimplicial
module $(M \otimes_R R') \otimes_{R'} (A'/R')_\bullet$ is
just the cosimplicial module $R' \otimes_R (M \otimes_R (A/R)_\bullet)$.
Hence the vanishing of cohomology of the complex associated to
$(M \otimes_R R') \otimes_{R'} (A'/R')_\bullet$ implies the
vanishing of the cohomology of the complex associated to
$M \otimes_R (A/R)_\bullet$ by faithful flatness of $R \to R'$.
Similarly for the vanishing of cohomology groups in degrees
$-1$ and $0$ of the extended complex (proof omitted).

\medskip\noindent
But we have such a faithfull flat extension. Namely $R' = A$ works
because the ring map $R' = A \to A' = A \otimes_A A$ has a section
$a \otimes a' \mapsto aa'$ and the previous lemma applies.
\end{proof}

\begin{proposition}
\label{proposition-descent-module}
Let $R \to A$ be a faithfully flat ring map.
Any descent datum on modules with respect to $R \to A$
is effective. Moreover, the functor
$M \mapsto (A \otimes_R M, can)$ from $R$-modules
to the category of descent data is fully faithful.
\end{proposition}

\begin{proof}
We construct the inverse functor. Namely, given a
descent datum $(N, \varphi)$ we set
$M(N, \varphi) = \text{Ker}(N \to A \otimes_R N)
= H^0(s(N_\bullet))$. This is clearly functorial.
The computation of the the cohomology of the
extended complex shows that there is a canonical
isomorphism $M \cong M(A \otimes_R M, can)$, see
Lemma \ref{lemma-ff-exact}. It remains to prove that
also $(N, \varphi) \cong (A \otimes_R M(N, \varphi), can)$
functorially in $(N, \varphi)$.

\medskip\noindent
Note that since $M(N, \varphi) \subset N$ there is a canonical map
$A \otimes_R M(N, \varphi) \to N$ which by construction
induces a morphism of descent data
$(A \otimes_R M(N, \varphi), can) \to (N, \varphi)$.
Thus we have to show that this canonical map is an isomorphism.

\medskip\noindent
It suffices to prove that this is an isomorphism after replacing
$R$ by a faithfully flat ring extension $R \to R'$, compare with
the proof of Lemma \ref{lemma-ff-exact}. (Remark: This reduces one
to the case that there is a section and there should be a slick
proof, like in the proof of Lemma \ref{lemma-with-section-exact},
of the result in that case.)
We choose $R' = A$ and $A' = R' \otimes_R A = A \otimes_R A$.
Furthermore, set $N' = R' \otimes_R N = A \otimes_R N = A' \otimes_A N$ and
$\varphi' : N' \otimes_{R'} A' \to A' \otimes_{R'} N$ the base
change of $\varphi$. Now we elucidate the start of the complex
$s(N'_\bullet)$. It is
$$
N' = A \otimes_R N \xrightarrow{\partial}
A' \otimes_{R'} N'
=
(A \otimes_R A) \otimes_A (A \otimes_R N)
=
A \otimes_R A \otimes_R N
$$
with map
$$
\partial(a \otimes n) = a \otimes 1 \otimes n -
a \otimes \varphi( n \otimes 1)
$$
By the cocycle condition it follows that the elements
$\varphi(n \otimes 1) \in N' = A \otimes_R N$ are in the
kernel. This gives a map $N \to \text{ker}(\partial)$,
$n \mapsto \varphi(n \otimes 1)$.
Conversely, if $\xi = \sum a_i \otimes n_i$ is in the kernel,
then $\sum a_i \otimes 1 \otimes n_i = \sum a_i \otimes \varphi(n_i \otimes 1)$
and hence by collapsing the first two factors
$$
\xi =
\sum a_i \otimes n_i =
\sum (a_i \otimes 1)\varphi(n_i \otimes 1) =
\varphi( \sum a_in_i \otimes 1)
$$
is in the image of
the map defined above. We conclude that $N = H^0(s(N'_\bullet))$
via the map above (proof injectivity omittted). Finally, we have to see that
the associated map $N \otimes_R A \to N' = A \otimes_R N$ is an isomorphism.
This is exactly the condition that $\varphi$ is an isomorphism and we win.
\end{proof}

\begin{remark}
\label{remark-standard-covering}
Let $R$ be a ring. Let $f_1, \ldots, f_n\in R$ generate the
unit ideal. The ring $A = \prod_i R_{f_i}$ is a faithfully flat
$R$-algebra. We remark that the cosimplicial ring $(A/R)_\bullet$
has the following ring in degree $n$:
$$
\prod\nolimits_{i_0, \ldots, i_n} R_{f_{i_0}\ldots f_{i_n}}
$$
Hence the results above recover
Algebra, Lemmas \ref{algebra-lemma-standard-covering},
\ref{algebra-lemma-cover-module} and \ref{algebra-lemma-glue-modules}.
But the results above actually say more because of exactness
in higher degrees. Namely, it implies that Cech cohomology of quasi-coherent
sheaves on affines is trivial, see (insert future reference here).
\end{remark}











\section{fpqc coverings are families of universally effective epimorphisms}
\label{section-fpqc-universal-effective-epimorphisms}

\noindent
We apply the material above to prove an interesting lemma.

\begin{lemma}
\label{lemma-fpqc-universal-effective-epimorphisms}
Let $T$ be a scheme.
Let $\{T_i \to T\}$ be an fpqc covering, see
Topologies, Definition \ref{topologies-definition-fpqc-covering}.
Then $\{T_i \to T\}$ is a family of universal
effective epimorphisms, see
Sites, Definition \ref{sites-definition-universal-effective-epimorphisms}.
\end{lemma}

\begin{proof}
Let $S$ be a scheme. We have to show the following:
Given morphisms $\varphi_i : T_i \to S$
such that $\varphi_i|_{T_i\times_T T_j} = \varphi_j|_{T_i \times_T T_j}$
there exists a unique morphism $T \to S$ which restricts
to $\varphi_i$ on each $T_i$.
In other words, we have to show that the functor
$h_S = \text{Mor}_{\textit{Sch}}( - , S)$ satisfies
the sheaf property for the fpqc topology.

\medskip\noindent
Thus Topologies, Lemma \ref{topologies-lemma-sheaf-property-fpqc}
reduces us to the case of a Zariski covering and a standard fpqc
covering consisting of a single arrow.
The case of a Zariski covering follows from
Schemes, Lemma \ref{schemes-lemma-glue}.

\medskip\noindent
Suppose that $R \to A$ is a faithfully flat ring map.
Let $f : \text{Spec}(A) \to S$ be a morphism
such that $f \circ \text{pr}_1 = f \circ \text{pr}_2$
as maps $\text{Spec}(A \otimes_R A) \to S$.
We have to show it
comes from a unique morphism $\text{Spec}(R) \to S$.
Let $\mathfrak p \subset R$ be a prime.
For any primes $\mathfrak q, \mathfrak q' \subset A$ lying over
$\mathfrak p$ there exists a prime $\mathfrak q'' \subset A \otimes_R A$
lying over $\mathfrak q$ (via $A \to A\otimes_R A$, $a \mapsto a\otimes 1$)
and lying over $\mathfrak q'$ (via $A \to A\otimes_R A$,
$a \mapsto 1\otimes a$). The reason is that the ring
$\kappa(\mathfrak q) \otimes_{\kappa(\mathfrak p)} \kappa(\mathfrak q')$
is not zero and any prime in this ring gives rise to a prime $\mathfrak q''$
as above. In other words, $\mathfrak q'' \in \text{Spec}(A \otimes_R A)$
is a point such that $\text{pr}_1(\mathfrak q'') = \mathfrak q$ and
$\text{pr}_2(\mathfrak q'') = \mathfrak q'$.
Hence we conclude that $f(\mathfrak q) = f(\mathfrak q')$ for
all pairs $(\mathfrak q, \mathfrak q')$ as above.

\medskip\noindent
Let $s \in S$ be the common value (this is defined as $\mathfrak p$
is indeed in the image of $\text{Spec}(A) \to \text{Spec}(R)$,
see Algebra, Lemma \ref{algebra-lemma-ff-rings}).
Let $U \subset S$ be an affine open neighbourhood of $s$.
Then $f^{-1}(U) \subset \text{Spec}(A)$ is an
open subset containing all primes lying over $\mathfrak p$.
Of course, by the same token, if $f^{-1}(U)$ contains a prime
$\mathfrak q_1$ lying over any prime $\mathfrak p_1$
then it contains all primes of $A$ lying over $\mathfrak p_1$.

\medskip\noindent
Consider the map $\pi : \text{Spec}(A) \to \text{Spec}(R)$,
the open subset $V = f^{-1}(U) \subset \text{Spec}(A)$
and the closed subset $T = \text{Spec}(A) \setminus V$.
(Note that $T = \text{Spec}(A/I)$ for some ideal $I \subset A$.)
We have $\pi^{-1}(\pi(V)) = V$, and $\pi^{-1}(\pi(T)) = T$ by the above,
and hence $\text{Spec}(R) = \pi(V) \amalg \pi(T)$.
Since $R \to A$ is flat we know that generalizations lift along
$\pi$, see Algebra, Section \ref{algebra-section-going-up}.
Hence $\pi(V)$ is closed under generalizations.
Hence $\pi(T)$ is closed under specializations.
Hence $\pi(T)$ is closed in $\text{Spec}(R)$ by
Algebra, Lemma \ref{algebra-lemma-image-stable-specialization-closed}.
This shows that there exists a standard affine open
$D(r) \subset \text{Spec}(R)$ with $D(r) \subset \pi(V)$,
in other words, $\pi^{-1}(D(r)) \subset V = f^{-1}(U)$.

\medskip\noindent
Recall that $U \subset S$ is affine, say $U = \text{Spec}(B)$.
The restriction of $f$ to $\pi^{-1}(D(r))$ into $U$
corresponds to a ring map $B \to A_r$. The two induced
ring maps $B \to A_r \otimes_{R_r} A_r = (A \otimes_R A)_r$ are equal
by assumption on $f$.
Note that $R_r \to A_r$ is faithfully flat.
By Lemma \ref{lemma-ff-exact} the equalizer of
the two arrows $A_r \to A_r \otimes_{R_r} A_r$ is $R_r$.
We conclude that $B \to A_r$ factors uniquely through a map $B \to R_r$.
This map in turn gives a morphism of schemes $D(r) \to U \to S$,
see Schemes, Lemma \ref{schemes-lemma-morphism-into-affine}.

\medskip\noindent
What have we proved sofar? We have shown that for any prime
$\mathfrak p \subset R$, there exists a standard affine open
$D(r) \subset \text{Spec}(R)$ such that the morphism
$f|_{\pi^{-1}(D(r))} : \pi^{-1}(D(r)) \to S$ factors uniquely
though some morphism of schemes $D(r) \to S$. We omit the
verification that these morphisms glue to the desired
morphism $\text{Spec}(R) \to S$.
\end{proof}









\section{fpqc descent of quasi-coherent sheaves}
\label{section-fpqc-descent-quasi-coherent}


\begin{lemma}
\label{lemma-standard-fpqc-covering}
Let $S$ be an affine scheme.
Let $\mathcal{U} = \{f_i : U_i \to S\}$ be a standard fpqc covering
of $S$, see
Topologies, Definition \ref{topologies-definition-fpqc-covering}.
Any descent datum on quasi-coherent sheaves
for $\mathcal{U} = \{U_i \to S\}$ is effective.
Moreover, the functor from the category of
quasi-coherent $\mathcal{O}_S$-modules to the category
of descent data with respect to $\mathcal{U}$ is fully faithful.
\end{lemma}

\begin{proof}
Omitted. We have to relate descent data with respect to
$\mathcal{U}$ to descent data with respect to the ring
map $\Gamma(S, \mathcal{O}) \to \prod \Gamma(U_i, \mathcal{O})$.
\end{proof}

\begin{proposition}
\label{proposition-fpqc-descent-quasi-coherent}
Let $S$ be a scheme.
Let $\mathcal{U} = \{U_i \to S\}$ be an fpqc covering, see
Topologies, Definition \ref{topologies-definition-standard-fpqc}.
Any descent datum on quasi-coherent sheaves
for $\mathcal{U} = \{U_i \to S\}$ is effective.
Moreover, the functor from the category of
quasi-coherent $\mathcal{O}_S$-modules to the category
of descent data with respect to $\mathcal{U}$ is fully faithful.
\end{proposition}

\begin{proof}
Let $S = \bigcup_{j \in J} V_j$ be an affine open covering.
By definition of an fpqc covering, we can find for each $j \in J$ a
finite set $K_j$, a map $\underline{i} : K_j \to I$,
affine opens $U_{i(k), k} \subset U_{i(k)}$, $k \in K_j$
such that $\{U_{\underline{i}(k), k} \to V_j\}_{k \in K_j}$ is
a standard fpqc covering of $V_j$.

\medskip\noindent
To prove the proposition you show successively the
faithfulness, fullyness, and essential surjectivity of the
functor from quasi-coherent sheaves to descent data.
E.g., given quasi-coherent sheaves $\mathcal{F}$, $\mathcal{G}$
and morphisms $a, b : \mathcal{F} \to \mathcal{G}$ we see
that if $a|_{U_i} = b|_{U_i}$ for all $i$, then
$a|_{U_{\underline{i}(k), k}} = b|_{U_{\underline{i}(k), k}}$
for all $j \in J$, $k \in K_j$, hence $a|_{V_j} = b|_{V_j}$
for all $j \in J$ by Lemma \ref{lemma-standard-fpqc-covering},
hence $a = b$. Similarly with ``fullyness'' but now you have to
use the ``faithfulness'' to show that the maps you construct over
the $V_j$ glue. Similarly for effectiveness. Details omitted.
\end{proof}




\section{Descent data for schemes over schemes}
\label{section-descent-datum}

\noindent
Most of the arguments in this section are formal relying only
on the definition of a descent datum. In Section \ref{section-simplicial}
we will examine the relationship with simplicial schemes which will
somewhat clarify the situation. Hopefully the reader will be convinced
by the end of Section \ref{section-simplicial} that the language of descent
is awkward and the setting of simplicial schemes is natural for the
questions being considered here.

\begin{definition}
\label{definition-descent-datum}
Let $f : X \to S$ be a morphism of schemes.
\begin{enumerate}
\item Let $V \to X$ be a scheme over $X$.
A {\it descent datum for $V/X/S$} is an isomorphism
$\varphi : V \times_S X \to X \times_S V$ of schemes over
$X \times_S X$ such that the diagram
$$
\xymatrix{
V \times_S X \times_S X \ar[rd]^{\varphi_{01}} \ar[rr]_{\varphi_{02}} &
&
X \times_S X \times_S V\\
&
X \times_S V \times_S X \ar[ru]^{\varphi_{12}}
}
$$
commutes (with obvious notation).
\item We also say that the pair $(V/X, \varphi)$ is
a {\it descent datum relative to $X \to S$}.
\item A {\it morphism $f : (V/X, \varphi) \to (V'/X, \varphi')$ of
descent data relative to $X \to S$} is a morphism
$f : V \to V'$ of schemes over $X$ such that
the diagram
$$
\xymatrix{
V \times_S X \ar[r]_{\varphi} \ar[d]_{f \times \text{id}_X} &
X \times_S V \ar[d]^{\text{id}_X \times f} \\
V' \times_S X \ar[r]^{\varphi'} & X \times_S V'
}
$$
commutes.
\end{enumerate}
\end{definition}

\noindent
There are all kinds of ``miraculous'' identities which arise out of the
definition above. For example the pullback of $\varphi$ via the diagonal
morphism $\Delta : X \to X \times_S X$ can be seen as a morphism
$\Delta^*\varphi : V \to V$.
This because $X \times_{\Delta, X \times_S X} (V \times_S X) = V$
and also $X \times_{\Delta, X \times_S X} (X \times_S V) = V$.
In fact, $\Delta^*\varphi$ is equal to the identity.
This is a good exercise if you are unfamiliar with this material.

\medskip\noindent
Here is the definition in case you have a family of morphisms
with fixed target.

\begin{definition}
\label{definition-descent-datum-for-family-of-morphisms}
Let $S$ be a scheme.
Let $\{X_i \to S\}_{i \in I}$ be a family of morphisms with target $S$.
\begin{enumerate}
\item A {\it descent datum $(V_i, \varphi_{ij})$ relative to the
family $\{X_i \to S\}$} is given by a scheme $V_i$ over $X_i$
for each $i \in I$, an isomorphism
$\varphi_{ij} : V_i\times_S X_j \to X_i \times_S X_j$
of schemes over $X_i \times_S X_j$ for each pair $(i, j) \in I^2$
such that for every triple of indices $(i, j, k) \in I^3$
the diagram
$$
\xymatrix{
V_i \times_S X_j \times_S X_k
\ar[rd]^{\text{pr}_{01}^*\varphi_{ij}}
\ar[rr]_{\text{pr}_{02}^*\varphi_{ik}} &
&
X_i \times_S X_j \times_S V_k\\
&
X_i \times_S V_j \times_S X_k
\ar[ru]^{\text{pr}_{12}^*\varphi_{jk}}
}
$$
of schemes over $X_i \times_S X_j \times_S X_k$ commutes
(with obvious notation).
\item A {\it morphism
$\psi : (V_i, \varphi_{ij}) \to (V'_i, \varphi'_{ij})$
of descent data} is given by a family
$\psi = (\psi_i)_{i \in I}$ of morphisms of
$X_i$-schemes $\psi_i : V_i \to V'_i$ such that all the diagrams
$$
\xymatrix{
V_i \times_S X_j \ar[r]_{\varphi_{ij}} \ar[d]_{\psi_i \times \text{id}} &
X_i \times_S V_j \ar[d]^{\text{id} \times \psi_j} \\
V'_i \times_S X_j \ar[r]^{\varphi'_{ij}} & X_i \times_S V'_j
}
$$
commute.
\end{enumerate}
\end{definition}

\noindent
This is the notion that comes up naturally for example when answering
whether the fibred category of relative curves is a stack in the
fpqc topology (it isn't -- at least not if you stick to schemes).
The reason we will usually stick with the version of a family consisting
of a single morphism is the following lemma.

\begin{lemma}
\label{lemma-family-is-one}
Let $S$ be a scheme.
Let $\{X_i \to S\}_{i \in I}$ be a family of morphisms with target $S$.
Set $X = \coprod_{i \in I} X_i$, and consider it as an $S$-scheme.
There is a canonical equivalence of categories
$$
\begin{matrix}
\text{category of descent data } \\
\text{relative to the family } \{X_i \to S\}_{i \in I}
\end{matrix}
\longrightarrow
\begin{matrix}
\text{ category of descent data} \\
\text{ relative to } X/S
\end{matrix}
$$
which maps $(V_i, \varphi_{ij})$ to $(V, \varphi)$ with
$V = \coprod_{i\in I} V_i$ and $\varphi = \coprod \varphi_{ij}$.
\end{lemma}

\begin{proof}
Observe that $X \times_S X = \coprod_{ij} X_i \times_S X_j$
and similarly for higher fibre products.
Giving a morphism $V \to X$ is exactly the same as
giving a family $V_i \to X_i$. And giving a descent datum
$\varphi$ is exactly the same as giving a family $\varphi_{ij}$.
\end{proof}

\begin{lemma}
\label{lemma-pullback}
Let
$$
\xymatrix{
X' \ar[r]_f \ar[d] & X \ar[d] \\
S' \ar[r] & S
}
$$
be a commutative diagram of morphisms of schemes.
The construction
$$
(V \to X, \varphi) \longmapsto f^*(V \to X, \varphi) = (V' \to X', \varphi')
$$
where $V' = X' \times_X V$ and where
$\varphi'$ is defined as the composition
$$
\xymatrix{
V' \times_{S'} X' \ar@{=}[r] &
(X' \times_X V) \times_{S'} X' \ar@{=}[r] &
(X' \times_{S'} X') \times_{X \times_S X} (V \times_S X)
\ar[d]^{\text{id} \times \varphi} \\
X' \times_{S'} V' \ar@{=}[r] &
X' \times_{S'} (X' \times_X V) &
(X' \times_S X') \times_{X \times_S X} (X \times_S V) \ar@{=}[l]
}
$$
defines a functor from the category of descent data
relative to $X \to S$ to the category of descent data
relative to $X' \to S$.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\noindent
Given a scheme $U$ over $S$ we have the {\it trivial descent datum} of $U$
relative to $\text{id} : S \to S$, namely the identity morphism.
For any morphism $X \to S$ we get by Lemma \ref{lemma-pullback} above
a {\it canonical descent datum} on $X \times_S U$
relative to $X \to S$. We denote $(X \times_S U, can)$ this descent datum.

\medskip\noindent
Similarly, suppose we are given a family of morphisms
$\{X_i \to S\}$ with target $S$. Given a scheme $U$ over $S$
we have a {\it canonical descent datum} on the family of
schemes $X_i \times_S U$. Compare with the discussion in
Descent, Section \ref{fpqc-descent-section-equivalence}.
We denote this descent datum $(X_i \times_S U, can)$.

\begin{definition}
\label{definition-effective}
Let $S$ be a scheme.
\begin{enumerate}
\item Let $f : X \to S$ be a morphism of schemes.
A descent datum $(V, \varphi)$ relative to $X/S$ is
is called {\it effective} if there exists a
scheme $U \to S$ and an isomorphism $\psi : V \to X \times_S U$
of $X$-schemes such that $\varphi$ is equal to the composition
$$
\xymatrix{
V \times_S X \ar[r]^-{\psi \times \text{id}_X} &
X \times_S U \times_S X \ar@{=}[r] &
X \times_S X \times_S U
\ar[r]^-{\text{id}_X \times \psi^{-1}} &
X \times_S V
}
$$
In other words, $(V, \varphi)$ is effective if it is
isomorphic to the canonical descent datum
$(X \times_S U, can)$ for some scheme $U$ over $S$.
\item Let $\{X_i \to S\}$ be a family of morphisms
with target $S$. A descent datum $(V_i, \varphi_{ij})$
relative to $\{X_i \to S\}$ is called {\it effective}
if there exists a scheme $U$ over $S$ such that
$(V_i, \varphi_{ij})$ is isomorphic to $(X_i \times_S U, can)$.
\end{enumerate}
\end{definition}

\begin{lemma}
\label{lemma-faithful}
In the situation of Lemma \ref{lemma-pullback}
assume that $X' \to X$ is surjective
and flat. Then the pullback functor is faithful.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-fully-faithful}
In the situation of Lemma \ref{lemma-pullback}
assume that $S' = S$ that $X' \to X$ is a faithfully flat quasi-compact
morphism of schemes over $S$. Then the pullback
functor is fully faithful.
\end{lemma}

\begin{proof}
Let $(V, \varphi)$ and $(W, \psi)$ be two descent data relative
to $X \to S$. Set $V' = X' \times_X V$ and $W' = X' \times_X W$.
Let $f' : V' \to W'$ be a morphism of descent data for $X' \to S$.
By assumption the diagram
$$
\xymatrix{
V' \times_S X' \ar[r]_{\varphi'} \ar[d]_{f' \times \text{id}} &
X' \times_S V' \ar[d]^{\text{id} \times f'} \\
W' \times_S X' \ar[r]^{\psi'} & X' \times_S W'
}
$$
commutes. We claim the two compositions
$$
\xymatrix{
V' \times_V V' \ar[r]^-{\text{pr}_i} &
V' \ar[r]^{f'} &
W' \ar[r] &
W
}
$$
$i = 0, 1$ are the same. The reader is advised to prove this themselves rather
than read the rest of this paragraph. (Please email if you find a
nice clean argument.) Let $v_0, v_1$ be points of $V'$ which map to the same
point $v \in V$. Let $x_i \in X'$ be the image of $v_i$, and let
$x$ be the point of $X$ which is the image of $v$ in $X$. In other words,
$v_i = (x_i, v)$ in $V' = X' \times_X V$. Write
$\varphi(v, x) = (x, v')$, which is possible because $\varphi$ is
a morphism over $X \times_S X$. Denote
$v_i' = (x_i, v')$. Then a calculation shows that
$\varphi'(v_i, x_j) = (x_i, v'_j)$. Denote
$w_i = f'(v_i)$ and $w'_i = f'(v_i')$.
Now we may write $w_i = (x_i, u_i)$ for some point $u_i$ of $W$,
and $w_i' = (x_i, u'_i)$ for some point $u_i'$ of $W$.
The claim is equivalent to the assertion: $u_0 = u_1$.
A formal calculation using the definition of $\psi'$
(see Lemma \ref{lemma-pullback}) shows
that the commutativity of the diagram displayed above says that
$$
((x_i, x_j), \psi(u_i, x)) = ((x_i, x_j), (x, u'_j))
$$
as points of $(X' \times_S X') \times_{X \times_S X} (X \times_S V)$
for all $i, j \in \{0, 1\}$. This clearly shows that
$u_0 = u_1$ by taking $\psi^{-1}$ of the second entry
in the above. This proves the claim because we can take
scheme points in the arguments above (in other words, we may
take $(v_0, v_1) = \text{id}_{V' \times_V V'}$).

\medskip\noindent
At this point we can use Descent,
Lemma \ref{fpqc-descent-lemma-fpqc-universal-effective-epimorphisms}.
Namely, since $V' \to V$ is faithfully flat and quasi-compact (as
the base change of such a morphism) we see that the morphism
$V' \to W' \to W$ factors through a unique morphism $f : V \to W$
whose base change is necessarily $f'$.
Finally, we see the diagram
$$
\xymatrix{
V \times_S X \ar[r]_{\varphi} \ar[d]_{f \times \text{id}} &
X \times_S V \ar[d]^{\text{id} \times f} \\
W \times_S X \ar[r]^{\psi} & X \times_S W
}
$$
commutes because its base change to $X' \times_S X'$ commutes.
Hence $f$ is a morphism of descent data $(V, \varphi) \to (W, \psi)$
as desired.
\end{proof}

\begin{lemma}
\label{lemma-pullback-selfmap}
Let $X \to S$ be a morphism of schemes.
Let $f : X \to X$ be a selfmap of $X$ over $S$.
In this case pullback by $f$ is isomorphic to the
identity functor on the category of descent data
relative to $X \to S$.
\end{lemma}

\begin{proof}
Let $(\pi : V \to X, \varphi)$ be a descent datum relative to $X \to S$.
Consider the morphism
$$
\xymatrix{
V &
V \times_S X \ar[l] &
X \times_S V \ar[l]_-{\varphi^{-1}} &
X \times_{f, X} V = f^*V \ar[l]
}
$$
of schemes over $X$. The morphism $\varphi : V \times_S X \to X \times_S V$
is a morphism over the scheme $X \times_S X$ and we can
pull it back by $\text{id}_X \times f : X \times_S X \to X\times_S X$.
This gives a morphism $\tilde\varphi : V \times_S X \to X \times_S f^*V$.
Consider the morphism
$$
\xymatrix{
V \ar[r] &
V \times_S X \ar[r]^{\tilde\varphi} &
X \times_S f^*V \ar[r] &
f^*V
}
$$
where the first morphism is $v \mapsto (v, \pi(v))$.
We omit the verification that the morphisms
$V \to f^*V$ and $f^*V \to V$ so constructed are
mutually inverse isomorphisms of descent data relative to
$X \to S$.
\end{proof}

\begin{lemma}
\label{lemma-morphism-with-section-equivalence}
Let $f : X' \to X$ be a morphism of schemes over a base scheme $S$.
If there exists a morphism $g : X \to X'$ over $S$, for example
if $f$ has a section, then the pullback functor
of Lemma \ref{lemma-pullback} defines an equivalence of
categories between the category of descent data relative to
$X/S$ and $X'/S$.
\end{lemma}

\begin{proof}
Let $g : X \to X'$ be a morphism over $S$.
Lemma \ref{lemma-pullback-selfmap} above shows that the functors
$f^* \circ g^* = (g \circ f)^*$ and $g^* \circ f^* = (f \circ g)^*$
are isomorphic
to the respective identity functors as desired.
\end{proof}




\section{Descending affine morphisms}
\label{section-affine}

\begin{lemma}
\label{lemma-affine}
Let $S$ be a scheme.
Let $\{X_i \to S\}_{i\in I}$ be an fpqc covering, see
Topologies, Definition \ref{topologies-definition-fpqc-covering}.
Let $(V_i/X_i, \varphi_{ij})$ be a descent datum
relative to $\{X_i \to S\}$. If each morphism
$V_i \to X_i$ is affine, then the descent datum is
effective.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}



\section{Descending quasi-affine morphisms}
\label{section-quasi-affine}

\begin{lemma}
\label{lemma-quasi-affine}
Let $S$ be a scheme.
Let $\{X_i \to S\}_{i\in I}$ be an fpqc covering, see
Topologies, Definition \ref{topologies-definition-fpqc-covering}.
Let $(V_i/X_i, \varphi_{ij})$ be a descent datum
relative to $\{X_i \to S\}$. If each morphism
$V_i \to X_i$ is quasi-affine, then the descent datum is
effective.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}



\section{Descent in terms of simplicial schemes}
\label{section-simplicial}

\noindent
A {\it simplicial scheme} is a simplicial object in the category of schemes,
see Simplicial, Definition \ref{simplicial-definition-simplicial-object}.
In this chapter we will use the a subscript $\bullet$ to denote simplicial
objects. Recall that a simplicial scheme looks like
$$
\xymatrix{
X_2
\ar@<2ex>[r]
\ar@<0ex>[r]
\ar@<-2ex>[r]
&
X_1
\ar@<1ex>[r]
\ar@<-1ex>[r]
\ar@<1ex>[l]
\ar@<-1ex>[l]
&
X_0
\ar@<0ex>[l]
}
$$
Here there are two morphisms $d^1_0, d^1_1 : X_1 \to X_0$
and a single morphism $s^0_0 : X_0 \to X_1$, etc.
It is important to remember that $d^n_i : X_n \to X_{n - 1}$
should be thought of as a ``projection forgetting the
$i$th coordinate''.

\begin{definition}
\label{definition-cartesian-morphism}
Let $a : V_\bullet \to X_\bullet$ be a morphism of simplicial schemes.
We say $a$ is {\it cartesian}, or that {\it $V_\bullet$ is cartesian over
$X_\bullet$}, if for every morphism
$\varphi : [n] \to [m]$ of $\Delta$ the corresponding diagram
$$
\xymatrix{
V_m \ar[r]_{a} \ar[d]_{V_\bullet(\varphi)} & X_m \ar[d]^{X_\bullet(\varphi)}\\
V_n \ar[r]^{a} & X_n
}
$$
is a fibre square in the category of schemes.
\end{definition}

\begin{definition}
\label{definition-fibre-products-simplicial-scheme}
Let $f : X \to S$ be a morphism of schemes.
The {\it simplicial scheme associated to $f$}, denoted $(X/S)_\bullet$,
is the functor $\Delta^{opp} \to \textit{Sch}$,
$[n] \mapsto X\times_S \ldots \times_S X$
described in
Simplicial, Example \ref{simplicial-example-fibre-products-simplicial-object}.
\end{definition}

\noindent
Thus $(X/S)_n$ is the $(n + 1)$-fold fibre product of $X$ over $S$.
The morphism $d^1_0 : X \times_S X \to X$ is the map
$(x_0, x_1) \mapsto x_1$ and the morphism $d^1_1$ is the other
projection. The morphism $s^0_0$ is the diagonal morphism
$X \to X \times_S X$.

\begin{lemma}
\label{lemma-cartesian-over}
Let $f : X \to S$ be a morphism of schemes.
Let $\pi : V_\bullet \to (X/S)_\bullet$ be a cartesian morphism.
Set $V = V_0$ considered as a scheme over $X$.
The morphisms $d^1_0, d^1_1 : V_1 \to V_0$ and the morphism
$\pi_1 : V_1 \to X \times_S X$ induce isomorphisms
$$
\xymatrix{
V \times_S X & &
V_1 \ar[ll]_-{(d^1_1, \text{pr}_1 \circ \pi_1)}
\ar[rr]^-{(\text{pr}_0 \circ \pi_1, d^1_0)} & &
X \times_S V.
}
$$
Denote $\varphi : V \times_S X \to X \times_S V$ the
resulting isomorphism.
Then the pair $(V, \varphi)$ is a descent datum relative
to $X \to S$.
\end{lemma}

\begin{proof}
The statement that the displayed morphisms are isomorphisms
is exactly the cartesian property for the maps
$\delta^1_0, \delta^1_1 : [0] \to [1]$. The fact that the diagram
of Definition \ref{definition-descent-datum} (1) commutes
follows from the fact that each of the induced morphisms
$V_2 \to V \times_{X, \text{pr}_i} (X \times_S X \times_S X)$
associated to $[0] \to [2]$, $0 \mapsto i$
is an isomorphism. Details omitted.
\end{proof}

\begin{lemma}
\label{lemma-cartesian-equivalent-descent-datum}
Let $f : X \to S$ be a morphism of schemes. The construction
$$
\begin{matrix}
\text{category of cartesian } \\
\text{schemes over } (X/S)_\bullet
\end{matrix}
\longrightarrow
\begin{matrix}
\text{ category of descent data} \\
\text{ relative to } X/S
\end{matrix}
$$
of Lemma \ref{lemma-cartesian-over}
is an equivalence of categories.
\end{lemma}

\begin{proof}
Here you have to show that given a descent datum
$(V, \varphi)$ you can canonically construct a
cartesian morphism of simplicial schemes
$V_\bullet \to (X/S)_\bullet$ so that if you apply
the construction of Lemma \ref{lemma-cartesian-over}
then you get back $(V, \varphi)$. This we did carefully
in Descent, Section \ref{fpqc-descent-section-descent-modules}
for the case of descent data for modules over rings
and their associated cosimplicial rings, see especially
Descent, Lemma \ref{fpqc-descent-lemma-descent-datum-cosimplicial}.
We can easily translate this to the current context.
Namely, set
$$
V_n = X \times_S \ldots \times_S X \times_S V.
$$
Given a point $(x_0, \ldots, x_{n - 1}, v)$ of $V_n$
we use the convention that $x_n = \pi(v)$. Using this
convention, given a morphism $\beta : [m] \to [n]$
the associated morphism
$$
V_\bullet(\beta) : V_n \longrightarrow V_m
$$
maps $(x_0, \ldots, x_{n - 1}, v)$ to
$(x_{\beta(0)}, \ldots, x_{\beta(m - 1)}, v')$
where $\varphi^{-1}(x_{\beta(m)}, v) = (v', x_n)$.
(It is a fact that $v' = v$ if $n = \beta(m)$; see discussion
following Definition \ref{definition-descent-datum}.)
We omit the verification that this defines a
simplicial scheme which is cartesian over
$(X/S)_\bullet$.
\end{proof}

\noindent
We may reinterpret the pullback of Lemma \ref{lemma-pullback} as follows.
Suppose given a commutative diagram of morphisms of schemes
$$
\xymatrix{
X' \ar[r]_f \ar[d] & X \ar[d] \\
S' \ar[r] & S.
}
$$
This gives rise to a morphism of simplicial schemes
$$
f_\bullet : (X'/S')_\bullet \longrightarrow (X/S)_\bullet.
$$
It is a pleasant exercise to check that given any morphism
of simplical schemes $f_\bullet : Y_\bullet \to X_\bullet$ and a
cartesian simplicial scheme $V_\bullet \to X_\bullet$
the fibre product
$$
f_\bullet^*V_\bullet = Y_\bullet \times_{X_\bullet} V_\bullet
$$
is a cartesian simplicial scheme over $Y_\bullet$. We omit
the verification that this applied to the morphism
$(X'/S')_\bullet \to (X/S)_\bullet$ corresponds via
Lemma \ref{lemma-cartesian-equivalent-descent-datum}
with the pullback defined in terms of descent data.



\section{Descent data give equivalence relations}
\label{section-equivalence-relation}

\begin{lemma}
\label{lemma-equivalence-relation}
Let $f : X \to S$ be a morphism of schemes.
Let $\pi : V_\bullet \to (X/S)_\bullet$ be a cartesian morphism.
Then the morphism
$$
j = (d^1_1, d^1_0) : V_1 \to V_0 \times_S V_0
$$
defines an equivalence relation on $V_0$ over $S$,
see Groupoids, Definition \ref{groupoids-definition-equivalence-relation}.
\end{lemma}

\begin{proof}
Note that $j$ is a monomorphism. Namely the
composition $V_1 \to V_0 \times_S V_0 \to V_0 \times_S X$
is an isomorphism as $\pi$ is cartesian.

\medskip\noindent
Consider the morphism
$$
(d^2_2, d^2_0) : V_2 \to V_1 \times_{d^1_0, V_0, d^1_1} V_1.
$$
This works because $d_0 \circ d_2 = d_1 \circ d_0$,
see Simplicial, Remark \ref{simplicial-remark-relations}.
Also, it is a morphism over $(X/S)_2$. It is an isomorphism
because $V_\bullet \to (X/S)_\bullet$ is cartesian.
Note for example that the
right hand side is isomorphic to
$V_0 \times_{\pi_0, X, \text{pr}_1} (X \times_S X \times_S X) =
X \times_S V_0 \times_S X$
because $\pi$ is cartesian. Details omitted.

\medskip\noindent
As usual, see
Groupoids, Definition \ref{groupoids-definition-equivalence-relation}
we denote $t = \text{pr}_0 \circ j = d^1_1$ and
$s = \text{pr}_1 \circ j = d^1_0$.
The isomorphism above, combined with the morphism
$d^2_1 : V_2 \to V_1$ give us a composition morphism
$$
c : V_1 \times_{s, V_0, t} V_1 \longrightarrow V_1
$$
over $V_0 \times_S V_0$. This immediately implies
that for any scheme $T/S$ the relation
$V_1(T) \subset V_0(T) \times V_0(T)$ is transitive.

\medskip\noindent
Reflexivity follows from the fact that the
restriction of the morphism $j$ to the diagonal
$\Delta : X \to X\times_S X$ is an isomorphism
(again use the cartesian property of $\pi$).

\medskip\noindent
To see symmetry we consider the morphism
$$
(d^2_2, d^2_1) : V_2 \to V_1 \times_{d^1_1, V_0, d^1_1} V_1.
$$
This works because $d_1 \circ d_2 = d_1 \circ d_1$,
see Simplicial, Remark \ref{simplicial-remark-relations}.
It is an isomorphism
because $V_\bullet \to (X/S)_\bullet$ is cartesian.
Note for example that the
right hand side is isomorphic to
$V_0 \times_{\pi_0, X, \text{pr}_0} (X \times_S X \times_S X) =
V_0 \times_S X \times_S X$
because $\pi$ is cartesian. Details omitted.

\medskip\noindent
Let $T/S$ be a scheme. Let $a \sim b$ for $a, b \in V_0(T)$
be synonymous with $(a, b) \in V_1(T)$.
The isomorphism $(d^2_2, d^2_1)$ above
implies that if $a \sim b$ and $a \sim c$, then $b \sim c$.
Combined with reflexivity this shows that $\sim$ is
an equivalence relation.
\end{proof}







\section{An example case}
\label{section-example}

\noindent
In this section we show that disjoint unions of spectra
of Artinian rings can be descended along a quasi-compact
surjective flat morphism of schemes.

\begin{lemma}
\label{lemma-equivalence-classes-points}
Let $X \to S$ be a morphism of schemes.
Suppose $V_\bullet \to (X/S)_\bullet$ is cartesian.
For $v \in V_0$ a point define
$$
T_v = \{v' \in V \mid \exists\ v_1 \in V_1:
d^1_1(v_1) = v, d^1_0(v_1) = v'\}
$$
as a subset of $V_0$. Then $v \in T_v$ and
$T_v \cap T_{v'} \not = \emptyset \Rightarrow T_v = T_{v'}$.
\end{lemma}

\begin{proof}
Combine Lemma \ref{lemma-equivalence-relation} and
Groupoids,
Lemma \ref{groupoids-lemma-pre-equivalence-equivalence-relation-points}.
\end{proof}

\begin{lemma}
\label{lemma-quasi-compact}
Let $X \to S$ be a morphism of schemes.
Suppose $V_\bullet \to (X/S)_\bullet$ is cartesian.
Let $v \in V_0$ be a point. If $X \to S$ is quasi-compact, then
$$
T_v = \{v' \in V \mid \exists\ v_1 \in V_1:
d^1_1(v_1) = v, d^1_0(v_1) = v'\}
$$
is a quasi-compact subset of $V_0$.
\end{lemma}

\begin{proof}
Let $F_v$ be the scheme theoretic fibre of $d^1_1 : V_1 \to V_0$
at $v$. Then we see that $T_v$ is the image of the morphism
$$
\xymatrix{
F_v \ar[r] \ar[d] &
V_1 \ar[r]^{d^1_0} \ar[d]^{d^1_1} &
V_0 \\
v \ar[r] &
V_0 &
}
$$
Note that $F_v$ is quasi-compact. This proves the lemma.
\end{proof}

\begin{lemma}
\label{lemma-descent-disjoint-union-Artinian-along-fields}
Let $X \to S$ be a quasi-compact flat surjective morphism.
Let $(V, \varphi)$ be a descent datum relative
to $X \to S$. If $V$ is a disjoint union of
spectra of Artinian rings, then $(V, \varphi)$
is effective.
\end{lemma}

\begin{proof}
We may write $V = \coprod_{i \in I} \text{Spec}(A_i)$
with each $A_i$ local Artinian. Moreover, let
$v_i \in V$ be the unique closed point of $\text{Spec}(A_i)$
for all $i \in I$. Write $i \sim j$ if and only if
$v_i \in T_{v_j}$ with notation as in
Lemma \ref{lemma-equivalence-classes-points} above.
By this lemma and  Lemma \ref{lemma-quasi-compact}
this is an equivalence relation with finite equivalence
classes. Let $\overline{I} = I/\sim$. Then we can write
$V = \coprod_{\overline{i} \in \overline{I}} V_{\overline{i}}$
with
$V_{\overline{i}} = \coprod_{i \in \overline{i}} \text{Spec}(A_i)$.
By construction we see that
$\varphi : V \times_S X \to X \times_S V$ maps
the open and closed subspaces $V_{\overline{i}} \times_S X$
into the open and closed subspaces $X \times_S V_{\overline{i}}$.
In other words, we get descent data
$(V_{\overline{i}}, \varphi_{\overline{i}})$, and
$(V, \varphi)$ is the coproduct of them in the category of
descent data.
Since each of the $V_{\overline{i}}$ is a finite union of
spectra of Artinian local rings the morphism $V_{\overline{i}} \to X$
is affine, see Morphisms, Lemma \ref{morphisms-lemma-Artinian-affine}.
Since $\{X \to S\}$ is an fpqc covering we see that all
the descent data $(V_{\overline{i}}, \varphi_{\overline{i}})$ are effective
by Lemma \ref{lemma-affine}.
Hence we win.
\end{proof}

\noindent
To be sure, the lemma above has very limited applicability!





\input{chapters}

\bibliography{my}
\bibliographystyle{alpha}


\end{document}
