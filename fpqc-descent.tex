\input{preamble}

% OK, start here.
%
\begin{document}

\title{Descent in fpqc topology}

\maketitle

\tableofcontents

\section{Introduction}
\label{section-introduction}

\noindent
In this chapter we discuss what kind of structures over schemes
have the property that descent data with respect to fpqc coverings
are effective. See for example \cite{Gr-I}, \cite{Gr-II}, \cite{Gr-III},
\cite{Gr-IV}, \cite{Gr-V}, and \cite{Gr-VI}.
This is also meant to introduce the notions of
descent, descent data, effective descent data, in the less formal
setting of descent questions for quasi-coherent sheaves, schemes, etc.

\section{Descent for quasi-coherent sheaves}
\label{section-equivalence}

\noindent
In this chapter we will use the convention where
the projection maps $\text{pr}_i : X \times \ldots \times X \to X$
are labeled starting with $i = 0$. Hence we have
$\text{pr}_0, \text{pr}_1 : X \times X  \to X$,
$\text{pr}_0, \text{pr}_1, \text{pr}_2 : X \times X \times X  \to X$,
etc.


\begin{definition}
\label{definition-descent-datum-quasi-coherent}
Let $S$ be a scheme. Let $\{f_i : S_i \to S\}_{i \in I}$ be a family
of morphisms with target $S$.
\begin{enumerate}
\item A {\it descent datum $(\mathcal{F}_i, \varphi_{ij})$
for quasi-coherent sheaves} with respect to the given family
is given by a quasi-coherent sheaf $\mathcal{F}_i$ on $S_i$ for
each $i \in I$, an isomorphism of quasi-coherent
$\mathcal{O}_{S_i \times_S S_j}$-modules
$\varphi_{ij} : \text{pr}_0^*\mathcal{F}_i \to \text{pr}_1^*\mathcal{F}_j$
for each pair $(i, j) \in I^2$
such that for every triple of indices $(i,j,k) \in I^3$ the
diagram
$$
\xymatrix{
\text{pr}_0^*\mathcal{F}_i \ar[rd]_{\text{pr}_{01}^*\varphi_{ij}}
\ar[rr]_{\text{pr}_{02}^*\varphi_{ik}} & & 
\text{pr}_2^*\mathcal{F}_k \\
& \text{pr}_1^*\mathcal{F}_j \ar[ru]_{\text{pr}_{12}^*\varphi_{jk}} &
}
$$
of $\mathcal{O}_{S_i \times_S S_j \times_S S_k}$-modules
commutes. This is called the {\it cocycle condition}.
\item A {\it morphism $\psi : (\mathcal{F}_i, \varphi_{ij}) \to
(\mathcal{F}'_i, \varphi'_{ij})$ of descent data} is given
by a family $\psi = (\psi_i)_{i\in I}$ of morphisms of
$\mathcal{O}_{S_i}$-modules $\psi_i : \mathcal{F}_i \to \mathcal{F}'_i$
such that all the diagrams
$$
\xymatrix{
\text{pr}_0^*\mathcal{F}_i \ar[r]_{\varphi_{ij}} \ar[d]_{\text{pr}_0^*\psi_i}
& \text{pr}_1^*\mathcal{F}_j \ar[d]^{\text{pr}_1^*\psi_j} \\
\text{pr}_0^*\mathcal{F}'_i \ar[r]^{\varphi'_{ij}} & 
\text{pr}_1^*\mathcal{F}'_j \\
}
$$
commute.
\end{enumerate}
\end{definition}

\noindent
A good example to keep in mind is the following.
Suppose that $S = \bigcup S_i$ is an open covering.
In that case we have seen descent data for sheaves of sets in
Sheaves, Section \ref{sheaves-section-glueing-sheaves}
where we called them ``glueing data for sheaves of sets
with respect to the given covering''. Moreover, we proved
that the category of glueing data is equivalent to the category
of sheaves on $S$. We will show the analogue in the setting above when
$\{S_i \to S\}_{i\in I}$ is an fpqc covering.

\medskip\noindent
In the extreme case where the covering $\{S \to S\}$
is given by $\text{id}_S$ a descent datum is necessarily
of the form $(\mathcal{F}, \text{id}_{\mathcal{F}})$. The cocycle
condition garantees that the identity on $\mathcal{F}$ is the
only permitted map in this case. The following lemma shows
in particular that to every quasi-coherent sheaf of
$\mathcal{O}_S$-modules there is associated a unique
descent datum with respect to any given family.

\begin{lemma}
\label{lemma-refine-descent-datum}
Let $S$ be a scheme.
Let $\mathcal{U} = \{U_i \to S\}_{i \in I}$ and
$\mathcal{V} = \{V_j \to S\}_{j \in J}$
be families of morphisms with target $S$.
Assume $\mathcal{U}$ is a refinement of $\mathcal{V}$, so
there exist $\alpha : I \to J$, and morphisms $g_i : U_i \to V_{\alpha(i)}$
over $S$, see Sites, Definition \ref{sites-definition-morphism-coverings}.
Let $(\mathcal{F}_j, \varphi_{jj'})$ be a descent
datum for quasi-coherent sheaves with respect to the
family $\{V_j \to S\}_{j \in J}$. Then 
\begin{enumerate}
\item The system
$$
\left(g_i^*\mathcal{F}_{\alpha(i)},\ 
(g_i \times g_{i'})^*\varphi_{\alpha(i)\alpha(i')}\right)
$$
is a descent datum with respect to the family $\{U_i \to S\}_{i \in I}$.
\item This construction is functorial in the descent datum
$(\mathcal{F}_j, \varphi_{jj'})$.
\item Given a second $\alpha' : I \to J$ and
$g'_i : U_i \to V_{\alpha'(i)}$ there exists a functorial
isomorphism of descent data
$(g_i^*\mathcal{F}_{\alpha(i)},
(g_i \times g_{i'})^*\varphi_{\alpha(i)\alpha(i')})
\cong
((g'_i)^*\mathcal{F}_{\alpha'(i)},
(g'_i \times g'_{i'})^*\varphi_{\alpha'(i)\alpha'(i')})$.
\end{enumerate}
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\noindent
Any family $\mathcal{U} = \{U_i \to S\}_{i \in I}$ is a refinement of
the trivial covering $\{S \to S\}$ in a unique way. For
a quasi-coherent sheaf $\mathcal{F}$ on $S$ we denote simply
$(\mathcal{F}|_{U_i}, can)$ the descent datum with respect to
$\mathcal{U}$ obtained by the procedure above.

\begin{definition}
\label{definition-descent-datum-effective-quasi-coherent}
Let $S$ be a scheme.
Let $\{S_i \to S\}_{i \in I}$ be a family of morphisms
with target $S$. A descent datum $(\mathcal{F}_i, \varphi_{ij})$
for quasi-coherent sheaves with respect to the given covering
is said to be {\it effective} if there exists a quasi-coherent
sheaf $\mathcal{F}$ on $S$ such that $(\mathcal{F}_i, \varphi_{ij})$
is isomorphic to $(\mathcal{F}|_{U_i}, can)$.
\end{definition}

\begin{lemma}
\label{lemma-zariski-descent-effective}
Let $S$ be a scheme.
Let $S = \bigcup U_i$ be an open covering.
Any descent datum on quasi-coherent sheaves
for the family $\mathcal{U} = \{U_i \to S\}$ is
effective. Moreover, the functor from the category of
quasi-coherent $\mathcal{O}_S$-modules to the category
of descent data with respect to $\mathcal{U}$ is fully faithful.
\end{lemma}

\begin{proof}
This follows immediately from
Sheaves, Section \ref{sheaves-section-glueing-sheaves}
and the fact that being quasi-coherent is a local property, see
Modules, Definition \ref{modules-definition-quasi-coherent}.
\end{proof}

\noindent
To prove more we first need to study the case of modules over rings.










\section{Descent for modules}
\label{section-descent-modules}

\noindent
Let $R \to A$ be a ring map.
By Simplicial, Example \ref{simplicial-example-push-outs-simplicial-object}
this gives rise to a cosimplicial $R$-algebra
$$
\xymatrix{
A
\ar@<1ex>[r]
\ar@<-1ex>[r]
&
A\otimes_R A
\ar@<0ex>[l]
\ar@<2ex>[r]
\ar@<0ex>[r]
\ar@<-2ex>[r]
&
A \otimes_R A \otimes_R A
\ar@<1ex>[l]
\ar@<-1ex>[l]
}
$$
Let us denote this $(A/R)_\bullet$ so that $(A/R)_n$ is the $(n + 1)$-fold
tensor product of $A$ over $R$. Given a map
$\varphi : [n] \to [m]$ the $R$-algebra map $(A/R)_\bullet(\varphi)$
is the map
$$
a_0 \otimes \ldots \otimes a_n
\longmapsto
\prod\nolimits_{\varphi(i) = 0} a_i
\otimes
\prod\nolimits_{\varphi(i) = 1} a_i
\otimes \ldots \otimes
\prod\nolimits_{\varphi(i) = m} a_i
$$
where we use the convention that the empty product is $1$.

\medskip\noindent
An $R$-module $M$ gives rise to a cosimplicial $(A/R)_\bullet$-module
$M \otimes_R (A/R)_\bullet$. In other words
$M_n = (A/R)_n \otimes_R M$ and using the $R$-algebra maps
$(A/R)_n \to (A/R)_m$ to define the corresponding maps on
$M \otimes_R (A/R)_\bullet$.

\medskip\noindent
The analogue to a descent datum
for quasi-coherent sheaves in the setting of modules is the following.

\begin{definition}
\label{definition-descent-datum-modules}
Let $R \to A$ be a ring map.
\begin{enumerate}
\item A {\it descent datum $(N, \varphi)$ for modules
with respect to $R \to A$}
is given by an $A$-module $N$ and a isomorphism of
$A \otimes_R A$-modules
$$
\varphi : N \otimes_R A \to A \otimes_R N
$$
such that the {\it cocycle condition} holds: the diagram
of $A \otimes_R A \otimes_R A$-module maps
$$
\xymatrix{
N \otimes_R A \otimes_R A \ar[rr]_{\varphi_{02}}
\ar[rd]_{\varphi_{01}}
& &
A \otimes_R A \otimes_R N \\
& A \otimes_R N \otimes_R A \ar[ru]_{\varphi_{12}} &
}
$$
commutes (see below for notation).
\item A {\it morphism $(N, \varphi) \to (N',\varphi')$ of descent data}
is a morphism of $A$-modules $\psi : N \to N'$ such that
the diagram
$$
\xymatrix{
N \otimes_R A \ar[r]_\varphi \ar[d]_{\psi \otimes \text{id}_A} & 
A \otimes_R N \ar[d]^{\text{id}_A \otimes \psi} \\
N' \otimes_R A \ar[r]^{\varphi'} & 
A \otimes_R N'
}
$$
is commutative.
\end{enumerate}
\end{definition}

\noindent
In the definition we use the notation that
$\varphi_{01} = \varphi \otimes \text{id}_A$,
$\varphi_{12} = \text{id}_A \otimes \varphi$, and
$\varphi_{02}(n \otimes 1 \otimes 1) = \sum a_i \otimes 1 \otimes n_i$
if $\varphi(n) = \sum a_i \otimes n_i$. All three are
$A \otimes_R A \otimes_R A$-module homomorphisms. Equivalently we have
$$
\varphi_{ij}
=
\varphi \otimes_{(A/R)_1,\ (A/R)_\bullet(\tau^2_{ij})} (A/R)_2
$$
where $\tau^2_{ij} : [1] \to [2]$ is the map
$0 \mapsto i$, $1 \mapsto j$. Namely,
$(A/R)_{\bullet}(\tau^2_{02})(a_0 \otimes a_1) =
a_0 \otimes 1 \otimes a_1$,
and similarly for the others.

\medskip\noindent
We need some more notation to be able to state the next lemma.
For $n \geq 0$ and $i \in [n]$ we set
$$
N_{n, i} =
A \otimes_R
\ldots
\otimes_R A \otimes_R N \otimes_R A \otimes_R
\ldots
\otimes_R A
$$
with the factor $N$ in the $i$th spot. It is an $(A/R)_n$-module.
If we introduce the maps $\tau^n_i : [0] \to [n]$, $0 \mapsto i$
then we see that
$$
N_{n, i} = N \otimes_{(A/R)_0,\ (A/R)_\bullet(\tau^n_i)} (A/R)_n
$$
For $0 \leq i \leq j \leq n$ we let $\tau^n_{ij} : [1] \to [n]$
be the map such that $0$ maps to $i$ and $1$ to $j$. Similarly
to the above the homomorphism $\varphi$ induces isomorphisms
$$
\varphi^n_{ij}
=
\varphi \otimes_{(A/R)_1,\ (A/R)_\bullet(\tau^n_{ij})} (A/R)_n :
N_{n, i} \longrightarrow N_{n, j}
$$
of $(A/R)_n$-modules. Since these are all isomorphisms they allow us
to move the factor $N$ to any spot we like. And the cocycle condition
exactly means that it does not matter how we do this (e.g., as a composition
of two of these or at once). Finally, for any $\beta : [n] \to [m]$
we define the morphism
$$
N_{\beta, i} : N_{n, i} \to N_{m, \beta(i)}
$$
as the unique $(A/R)_\bullet(\beta)$-semi linear map such that
$$
N_{\beta, i}(1 \otimes \ldots \otimes n \otimes \ldots \otimes 1)
=
1 \otimes \ldots \otimes n \otimes \ldots \otimes 1
$$
for all $n \in N$.
This hints at the following lemma.

\begin{lemma}
\label{lemma-descent-datum-cosimplicial}
Let $R \to A$ be a ring map.
Given a descent datum $(N, \varphi)$ we can associate to it a
cosimplicial $(A/R)_\bullet$-module $N_\bullet$\footnote{We should really
write $(N, \varphi)_\bullet$.} by the
rules $N_n = N_{n, n}$ and given $\beta : [n] \to [m]$
setting we define
$$
N_\bullet(\beta) = (\varphi^m_{\beta(n)m}) \circ N_{\beta, n} :
N_{n, n} \longrightarrow N_{m, m}.
$$
This procedure is functorial in the descent datum.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\noindent
Note that to an $R$-module $M$ we can associate a canonical
descent datum, namely $(M \otimes_R A, can)$ where
$can : (M \otimes_R A) \otimes_R A \to A \otimes_R (M \otimes_R A)$
is the obvious map:
$(m \otimes a) \otimes a' \mapsto a \otimes (m \otimes a')$.

\begin{lemma}
\label{lemma-canonical-descent-datum-cosimplicial}
Let $R \to A$ be a ring map.
Let $M$ be an $R$-module. The cosimplicial
$(A/R)_\bullet$-module associated to the canonical descent
datum is isomorphic to the cosimplicial module $(A/R)_\bullet \otimes_R M$.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{definition}
\label{definition-descent-datum-effective-module}
Let $R \to A$ be a ring map.
We say a descent datum $(N, \varphi)$ is {\it effective}
if there exists an $R$-module $M$ and an isomorphism
of descent data from $(M \otimes_R A, can)$ to
$(N, \varphi)$.
\end{definition}

\noindent
Let $R \to A$ be a ring map.
Let $(N, \varphi)$ be a descent datum.
We may take the cochain complex $s(N_\bullet)$ associated
with $N_\bullet$ (see
Simplicial, Section \ref{simplicial-section-dold-kan-cosimplicial}).
It has the following shape:
$$
N \to A\otimes_R N \to A \otimes_R A \otimes_R N \to \ldots
$$
We can describe the maps.
The first map is the map
$$
n \longmapsto 1 \otimes n - \varphi(n \otimes 1).
$$
The second map on pure tensors has the values
$$
a \otimes n \longmapsto 1 \otimes a \otimes n
- a \otimes 1 \otimes n + a \otimes \varphi(n \otimes 1).
$$
It is clear how the pattern continues.

\medskip\noindent
In the special case
where $N = A \otimes_R M$ we see that for any $m \in M$
the element $1 \otimes m$ is in the kernel of the first map
of the cochain complex associated to the cosimplicial 
module $(A/R)_\bullet \otimes_R M$. Hence we get an extended cochain complex
\begin{equation}
\label{equation-extended-complex}
0 \to M \to A \otimes_R M \to A \otimes_R A \otimes_R M \ldots
\end{equation}
Here we think of the $0$ as being in degree $-2$,
the module $M$ in degree $-1$, the module $A \otimes_R M$ in
degree $0$, etc.

\begin{lemma}
\label{lemma-with-section-exact}
Suppose that $R \to A$ has a section.
Then for any $R$-module $M$ the extended cochain complex
(\ref{equation-extended-complex}) is exact.
\end{lemma}

\begin{proof}
By
Simplicial, Lemma \ref{simplicial-lemma-push-outs-simplicial-object-w-section}
the map $R \to (A/R)_\bullet$ is a homotopy equivalence
(here $R$ denotes the constant cosimplicial ring).
We may think of this as a homotopy equivalence in the
category of $R$-algebras.
Hence also $M \to (A/R)_\bullet \otimes_R M$ is
a homotopy equivalence in the category of cosimplicial
$R$-modules, because $\otimes_R M$ is a
functor from the category of $R$-algebras to the category
of $R$-modules, see
Simplicial, Lemma \ref{simplicial-lemma-functorial-homotopy}.
But this means that the associated map of associated
complexes is a homotopy equivalence, see 
Simplicial, Lemma \ref{simplicial-lemma-homotopy-s-Q}.
Since the complex associated to the constant cosimplicial
$R$-module $M$ is the complex
$$
\xymatrix{
M \ar[r]^0 & M \ar[r]^1 & M \ar[r]^0 & M \ar[r]^1 & M \ldots
}
$$
we win.
\end{proof}

\begin{lemma}
\label{lemma-ff-exact}
Suppose that $R \to A$ is faithfully flat, see
Algebra, Definition \ref{algebra-definition-flat}.
Then for any $R$-module $M$ the extended cochain complex
(\ref{equation-extended-complex}) is exact.
\end{lemma}

\begin{proof}
Suppose we can show there exists a faithfully flat ring map
$R \to R'$ such that the result holds for the ring map
$R' \to A' = R' \otimes_R A$. Then the result follows for
$R \to A$. Namely, for any $R$-module $M$ the cosimplicial
module $(M \otimes_R R') \otimes_{R'} (A'/R')_\bullet$ is
just the cosimplicial module $R' \otimes_R (M \otimes_R (A/R)_\bullet)$.
Hence the vanishing of cohomology of the complex associated to
$(M \otimes_R R') \otimes_{R'} (A'/R')_\bullet$ implies the
vanishing of the cohomology of the complex associated to
$M \otimes_R (A/R)_\bullet$ by faithful flatness of $R \to R'$.
Similarly for the vanishing of cohomology groups in degrees
$-1$ and $0$ of the extended complex (proof omitted).

\medskip\noindent
But we have such a faithfull flat extension. Namely $R' = A$ works
because the ring map $R' = A \to A' = A \otimes_A$ has a section
$a \otimes a' \mapsto aa'$ and the previous lemma applies.
\end{proof}

\begin{proposition}
\label{proposition-descent-module}
Let $R \to A$ be a faithfully flat ring map.
Any descent datum on modules with respect to $R \to A$
is effective. Moreover, the functor
$M \mapsto (A \otimes_R M, can)$ from $R$-modules
to the category of descent data is fully faithful.
\end{proposition}

\begin{proof}
We construct the inverse functor. Namely, given a
descent datum $(N, \varphi)$ we set
$M(N, \varphi) = \text{Ker}(N \to A \otimes_R N)
= H^0(s(N_\bullet))$. This is clearly functorial.
The computation of the the cohomology of the
extended complex shows that there is a canonical
isomorphism $M \cong M(A \otimes_R M, can)$, see
Lemma \ref{lemma-ff-exact}. It remains to prove that
also $(N, \varphi) \cong (A \otimes_R M(N, \varphi), can)$
functorially in $(N, \varphi)$.

\medskip\noindent
Note that since $M(N, \varphi) \subset N$ there is a canonical map
$A \otimes_R M(N, \varphi) \to N$ which by construction
induces a morphism of descent data
$(A \otimes_R M(N, \varphi), can) \to (N, \varphi)$.
Thus we have to show that this canonical map is an isomorphism.

\medskip\noindent
It suffices to prove that this is an isomorphism after replacing
$R$ by a faithfully flat ring extension $R \to R'$, compare with
the proof of Lemma \ref{lemma-ff-exact}. (Remark: This resduces one
to the case that there is a section and there should be a slick
proof, like Lemma \ref{lemma-with-section-exact}, of the result
in that case.) We choose $R' = A$ and $A' = R' \otimes_R A = A \otimes_R A$.
Furthermore, set $N' = R' \otimes_R N = A \otimes_R N = A' \otimes_A N$ and
$\varphi' : N' \otimes_{R'} A' \to A' \otimes_{R'} N$ the base
change of $\varphi$. Now we elucidate the start of the complex
$s(N'_\bullet)$. It is
$$
N' = A \otimes_R N \xrightarrow{\partial}
A' \otimes_{R'} N'
=
(A \otimes_R A) \otimes_A (A \otimes_R N)
=
A \otimes_R A \otimes_R N
$$
with map
$$
\partial(a \otimes n) = a \otimes 1 \otimes n -
a \otimes \varphi( n \otimes 1)
$$
By the cocycle condition it follows that the elements
$\varphi(n \otimes 1) \in N' = A \otimes_R N$ are in the
kernel. This gives a map $N \to \text{ker}(\partial)$,
$n \mapsto \varphi(n \otimes 1)$.
Conversely, if $\xi = \sum a_i \otimes n_i$ is in the kernel,
then $\sum a_i \otimes 1 \otimes n_i = \sum a_i \otimes \varphi(n_i \otimes 1)$
and hence by collapsing the first two factors
$\xi = \sum a_i \otimes n_i = \sum (a_i \otimes 1)\varphi(n_i \otimes 1)
= \varphi( (\sum a_in_i) \otimes 1$ is in the image of
the map defined above. We conclude that $N = H^0(s(N'_\bullet))$
via the map above (proof injectivity omittted). Finally, we have to see that
the associated map $N \otimes_R A \to N' = A \otimes_R N$ is an isomorphism.
This is exactly the condition that $\varphi$ is an isomorphism and we win.
\end{proof}

\begin{remark}
\label{remark-standard-covering}
Let $R$ be a ring. Let $f_1, \ldots, f_n\in R$ generate the
unit ideal. The ring $A = \prod_i R_{f_i}$ is a faithfully flat
$R$-algebra. We remark that the cosimplicial ring $(A/R)_\bullet$
has the following ring in degree $n$:
$$
\prod\nolimits_{i_0, \ldots, i_n} R_{f_{i_0}\ldots f_{i_n}}
$$
Hence the results above recover
Algebra, Lemmas \ref{algebra-lemma-standard-covering},
\ref{algebra-lemma-cover-module} and \ref{algebra-lemma-glue-modules}.
But the results above actually say more because of exactness
in higher degrees. Namely, it implies that Cech cohomology of quasi-coherent
sheaves on affines is trivial, see (insert future reference here).
\end{remark}











\section{fpqc coverings are families of universally effective epimorphisms}
\label{section-fpqc-universal-effective-epimorphisms}

\noindent
We apply the material above to prove an interesting lemma.

\begin{lemma}
\label{lemma-fpqc-universal-effective-epimorphisms}
Let $T$ be a scheme.
Let $\{T_i \to T\}$ be an fpqc covering.
Then $\{T_i \to T\}$ is a family of universal
effective epimorphisms, see
Sites, Definition \ref{sites-definition-universal-effective-epimorphisms}.
\end{lemma}

\begin{proof}
Let $S$ be a scheme. We have to show the following:
Given morphisms $\varphi_i : T_i \to S$
such that $\varphi_i|_{T_i\times_T T_j} = \varphi_j|_{T_i \times_T T_j}$
there exists a unique morphism $T \to S$ which restricts
to $\varphi_i$ on each $T_i$.
In other words, we have to show that the functor
$h_S = \text{Mor}_{\textit{Sch}}( - , S)$ satsifies
the sheaf property for the fpqc topology.

\medskip\noindent
Thus Topologies, Lemma \ref{topologies-lemma-sheaf-property-fpqc}
reduces us to the case of a Zariski covering and a standard fpqc
covering consisting of a single arrow.
The case of a Zariski covering follows from
Schemes, Lemma \ref{schemes-lemma-glue}.

\medskip\noindent
Suppose that $R \to A$ is a faithfully flat ring map.
Let $f : \text{Spec}(A) \to S$ be a morphism
such that $f \circ \text{pr}_1 = f \circ \text{pr}_2$
as maps $\text{Spec}(A \otimes_R A) \to S$.
We have to show it
comes from a unique morphism $\text{Spec}(R) \to S$.
Let $\mathfrak p \subset R$ be a prime.
For any primes $\mathfrak q, \mathfrak q' \subset A$ lying over
$\mathfrak p$ there exists a prime $\mathfrak q'' \subset A \otimes_R A$
lying over $\mathfrak q$ (via $A \to A\otimes_R A$, $a \mapsto a\otimes 1$)
and lying over $\mathfrak q'$ (via $A \to A\otimes_R A$,
$a \mapsto 1\otimes a$). The reason is that the ring
$\kappa(\mathfrak q) \otimes_{\kappa(\mathfrak p)} \kappa(\mathfrak q')$
is not zero and any prime in this ring gives rise to a prime $\mathfrak q''$
as above. Hence we conclude that $f(\mathfrak q) = f(\mathfrak q')$ for
all pairs $(\mathfrak q, \mathfrak q')$ as above.

\medskip\noindent
Let $s \in S$ be the common value (this is defined as $\mathfrak p$
is indeed in the image of $\text{Spec}(A) \to \text{Spec}(E)$,
see Algebra, Lemma \ref{algebra-lemma-ff-rings}).
Let $U \subset S$ be an affine open neighbourhood of $s$.
Then $f^{-1}(U) \subset \text{Spec}(A)$ is an
open subset containing all primes lying over $\mathfrak p$.
Of course, by the same token, if $f^{-1}(U)$ contains a prime
$\mathfrak q_1$ lying over any prime $\mathfrak p_1$
then it contains all primes of $A$ lying over $\mathfrak p_1$.

\medskip\noindent
Consider the map $\pi : \text{Spec}(A) \to \text{Spec}(R)$,
the open subset $V = f^{-1}(U) \subset \text{Spec}(A)$ 
and the closed subset $T = \text{Spec}(A) \setminus V$.
(Note that $T = \text{Spec}(A/I)$ for some ideal $I \subset A$.)
We have $\pi^{-1}(\pi(V)) = V$, and $\pi^{-1}(\pi(T)) = T$ by the above,
and hence $\text{Spec}(R) = \pi(V) \amalg \pi(T)$.
Since $R \to A$ is flat we know that generalizations lift along
$\pi$, see Algebra, Section \ref{algebra-section-going-up}.
Hence $\pi(V)$ is closed under generalizations.
Hence $\pi(T)$ is closed under specializations.
Hence $\pi(T)$ is closed in $\text{Spec}(R)$ by
Algebra, Lemma \ref{algebra-lemma-image-stable-specialization-closed}.
This shows that there exists a standard affine open
$D(r) \subset \text{Spec}(R)$ with $D(r) \subset \pi(V)$,
in other words, $\pi^{-1}(D(r)) \subset V = f^{-1}(U)$.

\medskip\noindent
At this point we observe that
we have a ring map $B = \mathcal{O}_S(U) \to A_r$
such that the two maps $B \to A_r \otimes_{R_r} A_r$ are equal.
Note that $R_r \to A_r$ is faithfully flat.
By Lemma \ref{lemma-ff-exact} we conclude that
$B \to A_r$ factors uniquely through a map $B \to R_r$.
This map in turn gives a morphism of schemes $D(r) \to U \to S$,
see Schemes, Lemma \ref{schemes-lemma-morphism-into-affine}.

\medskip\noindent
What have we proved sofar? We have shown that for any prime
$\mathfrak p \subset R$, there exists a standard affine open
$D(r) \subset \text{Spec}(R)$ such that the morphism
$f|_{\pi^{-1}(D(r))} : \pi^{-1}(D(r)) \to S$ factors uniquely
though some morphism of schemes $D(r) \to S$. We omit the
verification that these morphisms glue to the desired
morphism $\text{Spec}(R) \to S$.
\end{proof}









\section{fpqc descent of quasi-coherent sheaves}
\label{section-fpqc-descent-quasi-coherent}


\begin{lemma}
\label{lemma-standard-fpqc-covering}
Let $S$ be an affine scheme.
Let $\mathcal{U} = \{f_i : U_i \to S\}$ be a standard fpqc covering
of $S$, see 
Topologies, Definition \ref{topologies-definition-fpqc-covering}.
Any descent datum on quasi-coherent sheaves
for $\mathcal{U} = \{U_i \to S\}$ is effective.
Moreover, the functor from the category of
quasi-coherent $\mathcal{O}_S$-modules to the category
of descent data with respect to $\mathcal{U}$ is fully faithful.
\end{lemma}

\begin{proof}
Omitted. We have to relate descent data with respect to
$\mathcal{U}$ to descent data with respect to the ring
map $\Gamma(S, \mathcal{O}) \to \prod \Gamma(U_i, \mathcal{O})$.
\end{proof}

\begin{proposition}
\label{propostion-fpqc-descent-quasi-coherent}
Let $S$ be a scheme.
Let $\mathcal{U} = \{U_i \to S\}$ be an fpqc covering, see
Topologies, Definition \ref{topologies-definition-standard-fpqc}.
Any descent datum on quasi-coherent sheaves
for $\mathcal{U} = \{U_i \to S\}$ is effective.
Moreover, the functor from the category of
quasi-coherent $\mathcal{O}_S$-modules to the category
of descent data with respect to $\mathcal{U}$ is fully faithful.
\end{proposition}

\begin{proof}
Let $S = \bigcup_{j \in J} V_j$ be an affine open covering.
By definition of an fpqc covering, we can find for each $j \in J$ a
finite set $K_j$, a map $\underline{i} : K_j \to I$, 
affine opens $U_{i(k), k} \subset U_{i(k)}$, $k \in K_j$
such that $\{U_{\underline{i}(k), k} \to V_j\}_{k \in K_j}$ is
a standard fpqc covering of $V_j$.

\medskip\noindent
To prove the proposition you show successively the
faithfulness, fullyness, and essential surjectivity of the
functor from quasi-coherent sheaves to descent data.
E.g., given quasi-coherent sheaves $\mathcal{F}$, $\mathcal{G}$
and morphisms $a, b : \mathcal{F} \to \mathcal{G}$ we see
that if $a|_{U_i} = b|_{U_i}$ for all $i$, then
$a|_{U_{\underline{i}(k), k}} = b|_{U_{\underline{i}(k), k}}$
for all $j \in J$, $k \in K_j$, hence $a|_{V_j} = b|_{V_j}$
for all $j \in J$ by Lemma \ref{lemma-standard-fpqc-covering},
hence $a = b$. Similarly with ``fullyness'' but now you have to
use the ``faithfulness'' to show that the maps you construct over
the $V_j$ glue. Similarly for effectiveness. Details omitted.
\end{proof}









\input{chapters}

\bibliography{my}
\bibliographystyle{alpha}


\end{document}
