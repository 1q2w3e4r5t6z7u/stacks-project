\input{preamble}

% OK, start here.
%
\begin{document}

\title{Picard Schemes of Curves}


\maketitle

\phantomsection
\label{section-phantom}

\tableofcontents


\section{Introduction}
\label{section-introduction}

\noindent
In this chapter we do just enough work to construct the Picard scheme
of a projective nonsingular curve over an algebraically closed field.
See \cite{Kleiman-Picard} for a more thorough discussion as well as
historical background.

\medskip\noindent
Later in the Stacks project we will discuss Hilbert and Quot functors
in much greater generality.


\section{Hilbert scheme of points}
\label{section-hilbert-scheme-points}

\noindent
Let $X \to S$ be a morphism of schemes. Let $d \geq 0$ be an integer.
For a scheme $T$ over $S$ we let
$$
\text{Hilb}^d_{X/S}(T) =
\left\{
\begin{matrix}
Z \subset X_T\text{ closed subscheme such that }\\
Z \to T\text{ is finite locally free of degree }d
\end{matrix}
\right\}
$$
If $T' \to T$ is a morphism of schemes over $S$ and if
$Z \in \text{Hilb}^d_{X/S}(T)$, then the base change
$Z_{T'} \subset X_{T'}$ is an element of $\text{Hilb}^d_{X/S}(T')$.
In this way we obtain a functor
$$
\text{Hilb}^d_{X/S} :
(\Sch/S)^{opp} \longrightarrow \textit{Sets},\quad
T \longrightarrow \text{Hilb}^d_{X/S}(T)
$$
In general $\text{Hilb}^d_{X/S}$ is an algebraic space
(insert future reference here). In this section we will
show that $\text{Hilb}^d_{X/S}$ is representable
by a scheme if any finite number of points in a fibre of
$X \to S$ are contained in an affine open.
If $\text{Hilb}^d_{X/S}$ is representable by a scheme, we often
denote this scheme by $\underline{\text{Hilb}}^d_{X/S}$.

\begin{lemma}
\label{lemma-hilb-d-sheaf}
Let $X \to S$ be a morphism of schemes. The functor $\text{Hilb}^d_{X/S}$
satisfies the sheaf property for the fpqc topology
(Topologies, Definition \ref{topologies-definition-sheaf-property-fpqc}).
\end{lemma}

\begin{proof}
Let $\{T_i \to T\}_{i \in I}$ be an fpqc covering of schemes over $S$.
Set $X_i = X_{T_i} = X \times_S T_i$.
Note that $\{X_i \to X_T\}_{i \in I}$ is an fpqc covering of
$X_T$ (Topologies, Lemma \ref{topologies-lemma-fpqc})
and that $X_{T_i \times_T T_{i'}} = X_i \times_{X_T} X_{i'}$.
Suppose that $Z_i \in \text{Hilb}^d_{X/S}(T_i)$ is a collection of
elements such that $Z_i$ and $Z_{i'}$ map to the same element of
$\text{Hilb}^d_{X/S}(T_i \times_T T_{i'})$. By effective descent
for closed immersions (Descent, Lemma \ref{descent-lemma-closed-immersion})
there is a closed immersion $Z \to X_T$ whose base change by
$X_i \to X_T$ is equal to $Z_i \to X_i$. The morphism $Z \to T$
then has the property that its base change to $T_i$ is the morphism
$Z_i \to T_i$. Hence $Z \to T$ is finite locally free of degree $d$
by Descent, Lemma \ref{descent-lemma-descending-property-finite-locally-free}.
\end{proof}

\begin{lemma}
\label{lemma-hilb-d-limit-preserving}
Let $X \to S$ be a morphism of schemes. If $X \to S$ is
of finite presentation, then the functor $\text{Hilb}^d_{X/S}$
is limit preserving (Limits, Remark \ref{limits-remark-limit-preserving}).
\end{lemma}

\begin{proof}
Let $T = \lim T_i$ be a limit of affine schemes over $S$. We have to show
that $\text{Hilb}^d_{X/S}(T) = \colim \text{Hilb}^d_{X/S}(T_i)$.
Observe that if $Z \to X_T$ is an element of $\text{Hilb}^d_{X/S}(T)$,
then $Z \to T$ is of finite presentation. Hence by
Limits, Lemma \ref{limits-lemma-descend-finite-presentation}
there exists an $i$, a scheme $Z_i$ of finite presentation over $T_i$,
and a morphism $Z_i \to X_{T_i}$ over $T_i$ whose base change to $T$
gives $Z \to X_T$. We apply Limits, Lemma
\ref{limits-lemma-descend-closed-immersion-finite-presentation}
to see that we may assume $Z_i \to X_{T_i}$ is a closed immersion
after increasing $i$.
We apply Limits, Lemma \ref{limits-lemma-descend-finite-locally-free}
to see that $Z_i \to T_i$ is finite locally free of degree $d$
after possibly increasing $i$.
Then $Z_i \in \text{Hilb}^d_{X/S}(T_i)$ as desired.
\end{proof}

\noindent
Let $S$ be a scheme. Let $i : X \to Y$ be a closed immersion of schemes
over $S$. Then there is a transformation of functors
$$
\text{Hilb}^d_{X/S} \longrightarrow \text{Hilb}^d_{Y/S}
$$
which maps an element $Z \in \text{Hilb}^d_{X/S}(T)$ to
$i_T(Z) \subset Y_T$ in $\text{Hilb}^d_{Y/S}$. Here $i_T : X_T \to Y_T$
is the base change of $i$.

\begin{lemma}
\label{lemma-hilb-d-of-closed}
Let $S$ be a scheme. Let $i : X \to Y$ be a closed immersion of schemes.
If $\text{Hilb}^d_{Y/S}$ is representable by a scheme, so is
$\text{Hilb}^d_{X/S}$ and the corresponding morphism of schemes
$\underline{\text{Hilb}}^d_{X/S} \to \underline{\text{Hilb}}^d_{Y/S}$
is a closed immersion.
\end{lemma}

\begin{proof}
Let $T$ be a scheme over $S$ and let $Z \in \text{Hilb}^d_{Y/S}(T)$.
Claim: there is a closed subscheme $T_X \subset T$ such
that a morphism of schemes $T' \to T$ factors through $T_X$ if
and only if $Z_{T'} \to Y_{T'}$ factors through $X_{T'}$.
Applying this to a scheme $T_{univ}$ representing $\text{Hilb}^d_{Y/S}$ and the
universal object\footnote{See
Categories, Section \ref{categories-section-opposite}}
$Z_{univ} \in \text{Hilb}^d_{Y/S}(T_{univ})$
we get a closed subscheme $T_{univ, X} \subset T_{univ}$ such that
$Z_{univ, X} = Z_{univ} \times_{T_{univ}} T_{univ, X}$
is a closed subscheme of $X \times_S T_{univ, X}$ and hence
defines an element of $\text{Hilb}^d_{X/S}(T_{univ, X})$.
A formal argument then shows that $T_{univ, X}$ is a scheme
representing $\text{Hilb}^d_{X/S}$ with universal object $Z_{univ, X}$.

\medskip\noindent
Proof of the claim. Consider $Z' = X_T \times_{Y_T} Z$. Given $T' \to T$
we see that $Z_{T'} \to Y_{T'}$ factors through $X_{T'}$ if and
only if $Z'_{T'} \to Z_{T'}$ is an isomorphism. Thus the claim follows
from the very general
More on Flatness, Lemma \ref{flat-lemma-Weil-restriction-closed-subschemes}.
However, in this special case one can prove the statement directly as
follows: first reduce to the case $T = \Spec(A)$ and $Z = \Spec(B)$.
After shrinking $T$ further we may assume there is an isomorphism
$\varphi : B \to A^{\oplus d}$ as $A$-modules. Then $Z' = \Spec(B/J)$
for some ideal $J \subset B$. Let $g_\beta \in J$ be a collection of
generators and write $\varphi(g_\beta) = (g_\beta^1, \ldots, g_\beta^d)$.
Then it is clear that $T_X$ is given by $\Spec(A/(g_\beta^j))$.
\end{proof}

\begin{lemma}
\label{lemma-hilb-d-separated}
Let $X \to S$ be a morphism of schemes. If $X \to S$ is separated and
$\text{Hilb}^d_{X/S}$ is representable,
then $\underline{\text{Hilb}}^d_{X/S} \to S$ is separated.
\end{lemma}

\begin{proof}
In this proof all unadorned products are over $S$.
Let $H = \underline{\text{Hilb}}^d_{X/S}$ and let
$Z \in \text{Hilb}^d_{X/S}(H)$ be the universal object.
Consider the two objects $Z_1, Z_2 \in \text{Hilb}^d_{X/S}(H \times H)$
we get by pulling back $Z$ by the two projections $H \times H \to H$.
Then $Z_1 = Z \times H \subset X_{H \times H}$ and $Z_2 = H \times Z
\subset X_{H \times H}$. Since $H$ represents the functor
$\text{Hilb}^d_{X/S}$, the diagonal morphism $\Delta : H \to H \times H$
has the following universal property: A morphism of schemes
$T \to H \times H$ factors through $\Delta$ if and only if
$Z_{1, T} = Z_{2, T}$ as elements of $\text{Hilb}^d_{X/S}(T)$.
Set $Z = Z_1 \times_{X_{H \times H}} Z_2$. Then we see that
$T \to H \times H$ factors through $\Delta$ if and only if
the morphisms $Z_T \to Z_{1, T}$ and $Z_T \to Z_{2, T}$ are
isomorphisms. It follows from the very general
More on Flatness, Lemma \ref{flat-lemma-Weil-restriction-closed-subschemes}
that $\Delta$ is a closed immersion. In the proof of
Lemma \ref{lemma-hilb-d-of-closed}
the reader finds an alternative easier proof of the needed result
in our special case.
\end{proof}

\begin{lemma}
\label{lemma-hilb-d-An}
Let $X \to S$ be a morphism of affine schemes. Let $d \geq 0$. Then
$\text{Hilb}^d_{X/S}$ is representable.
\end{lemma}

\begin{proof}
Say $S = \Spec(R)$. Then we can choose a closed immersion of $X$
into the spectrum of $R[x_i; i \in I]$ for some set $I$ (of sufficiently
large cardinality. Hence by Lemma \ref{lemma-hilb-d-of-closed}
we may assume that $X = \Spec(A)$ where $A = R[x_i; i \in I]$.
We will use Schemes, Lemma \ref{schemes-lemma-glue-functors} to prove the
lemma in this case.

\medskip\noindent
Condition (1) of the lemma follows from Lemma \ref{lemma-hilb-d-sheaf}.

\medskip\noindent
For every subset $W \subset A$ of cardinality $d$ we will
construct a subfunctor $F_W$ of $\text{Hilb}^d_{X/S}$.
(It would be enough to consider the case where $W$ consists of a
collection of monomials in the $x_i$ but we do not need this.)
Namely, we will say that $Z \in \text{Hilb}^d_{X/S}(T)$ is in $F_W(T)$
if and only if the $\mathcal{O}_T$-linear map
$$
\bigoplus\nolimits_{f \in W} \mathcal{O}_T
\longrightarrow
(Z \to T)_*\mathcal{O}_Z,\quad
(g_f) \longmapsto \sum g_f f|_Z
$$
is surjective (equivalently an isomorphism). Here for $f \in A$
and $Z \in \text{Hilb}^d_{X/S}(T)$ we denote $f|_Z$ the pullback of $f$
by the morphism $Z \to X_T \to X$.

\medskip\noindent
Openness, i.e., condition (2)(b) of the lemma. This follows from
Algebra, Lemma \ref{algebra-lemma-cokernel-flat}.

\medskip\noindent
Covering, i.e., condition (2)(c) of the lemma. Since
$$
A \otimes_R \mathcal{O}_T =
(X_T \to T)_*\mathcal{O}_{X_T} \to (Z \to T)_*\mathcal{O}_Z
$$
is surjective and since $(Z \to T)_*\mathcal{O}_Z$ is finite locally
free of rank $d$, for every point $t \in T$ we can find a finite
subset $W \subset A$ of cardinality $d$ whose images form a basis
of the $d$-dimensional $\kappa(t)$-vector space
$((Z \to T)_*\mathcal{O}_Z)_t \otimes_{\mathcal{O}_{T, t}} \kappa(t)$.
By Nakayama's lemma there is an open neighbourhood $V \subset T$
of $t$ such that $Z_V \in F_W(V)$.

\medskip\noindent
Representable, i.e., condition (2)(a) of the lemma. Let $W \subset A$
have cardinality $d$. We claim that $F_W$ is representable by an affine
scheme over $R$. We will construct this affine scheme here, but we encourage
the reader to think it trough for themselves. Choose a numbering
$f_1, \ldots, f_d$ of the elements of $W$. We will construct a universal
element $Z_{univ} = \Spec(B_{univ})$ of $F_W$ over $T_{univ} = \Spec(R_{univ})$
which will be the spectrum of
$$
B_{univ} = R_{univ}[e_1, \ldots, e_d]/
(e_ke_l - \sum c_{kl}^m e_m)
$$
where the $e_l$ will be the images of the $f_l$
and where the closed immersion $Z_{univ} \to X_{T_{univ}}$ is given
by the ring map
$$
A \otimes_R R_{univ} \longrightarrow B_{univ}
$$
mapping $1 \otimes 1$ to $\sum b^le_l$ and $x_i$ to $\sum b_i^le_l$.
In fact, we claim that $F_W$ is represented by the spectrum of the ring
$$
R_{univ} = R[c_{kl}^m, b^l, b_i^l]/\mathfrak a_{univ}
$$
where the ideal $\mathfrak a_{univ}$ is generated by the
following elements:
\begin{enumerate}
\item multiplication on $B_{univ}$ is commutative, i.e.,
$c_{lk}^m - c_{kl}^m \in \mathfrak a_{univ}$,
\item multiplication on $B_{univ}$ is associative, i.e.,
$c_{lk}^m c_{m n}^p - c_{lq}^p c_{kn}^q \in \mathfrak a_{univ}$,
\item $\sum b^le_l$ is a multiplicative $1$ in $B_{univ}$,
in other words, we should have $(\sum b^le_l)e_k = e_k$ for all $k$,
which means $\sum b^lc_{lk}^m - \delta_{km} \in \mathfrak a_{univ}$
(Kronecker delta).
\end{enumerate}
After dividing out by the ideal $\mathfrak a'_{univ}$ of the elements
listed sofar we obtain a well defined ring map
$$
\Psi :
A \otimes_R R[c_{kl}^m, b^l, b_i^l]/\mathfrak a'_{univ}
\longrightarrow
\left(R[c_{kl}^m, b^l, b_i^l]/\mathfrak a'_{univ}\right)
[e_1, \ldots, e_d]/(e_ke_l - \sum c_{kl}^m e_m)
$$
sending $1 \otimes 1$ to $\sum b^le_l$ and $x_i \otimes 1$ to $\sum b_i^le_l$.
We need to add some more elements to our ideal because we need
\begin{enumerate}
\item[(5)] $f_l$ to map to $e_l$ in $B_{univ}$. Write
$\Psi(f_l) - e_l = \sum h_l^me_m$ with
$h_l^m \in R[c_{kl}^m, b^l, b_i^l]/\mathfrak a'_{univ}$
then we need to set $h_l^m$ equal to zero.
\end{enumerate}
Thus setting $\mathfrak a_{univ} \subset R[c_{kl}^m, b^l, b_i^l]$
equal to $\mathfrak a'_{univ} + $ ideal generated by
lifts of $h_l^m$ to $R[c_{kl}^m, b^l, b_i^l]$, then
it is clear that $F_W$ is represented by $\Spec(R_{univ})$.
\end{proof}

\begin{proposition}
\label{proposition-hilb-d-representable}
Let $X \to S$ be a morphism of schemes. Let $d \geq 0$. Assume
for all $(s, x_1, \ldots, x_d)$ where $s \in S$ and
$x_1, \ldots, x_d \in X_s$ there exists an affine open $U \subset X$
with $x_1, \ldots, x_d \in U$. Then $\text{Hilb}^d_{X/S}$ is
representable by a scheme.
\end{proposition}

\begin{proof}
Either using relative glueing (Constructions, Section
\ref{constructions-section-relative-glueing}) or using
the functorial point of view
(Schemes, Lemma \ref{schemes-lemma-glue-functors})
we reduce to the case where $S$ is affine. Details omitted.

\medskip\noindent
Assume $S$ is affine. For $U \subset X$ affine open, denote
$F_U \subset \text{Hilb}^d_{X/S}$ the subfunctor parametrizing
closed subschemes of $U$. We will use
Schemes, Lemma \ref{schemes-lemma-glue-functors}
and the subfunctors $F_U$ to conclude.

\medskip\noindent
Condition (1) is Lemma \ref{lemma-hilb-d-sheaf}.

\medskip\noindent
Condition (2)(a) follows from the fact that
$F_U = \text{Hilb}^d_{U/S}$ and that this is representable
by Lemma \ref{lemma-hilb-d-An}.

\medskip\noindent
Let $Z \in \text{Hilb}^d_{X/S}(T)$ for some scheme $T$ over $S$. Let
$$
B = (Z \to T)\left((Z \to X_T \to X)^{-1}(X \setminus U)\right)
$$
This is a closed subset of $T$ and it is clear that over the open
$T_{Z, U} = T \setminus B$ the restriction $Z_{t'}$ maps into $U_{T'}$.
On the other hand, for any $b \in B$ the fibre $Z_b$ does not map
into $U$. Thus we see that given a morphism $T' \to T$ we
have $Z_{T'} \in F_U(T')$ $\Leftrightarrow$ $T' \to T$ factors through
the open $T_{Z, U}$. This proves condition (2)(b).

\medskip\noindent
Condition (2)(c) follows from our assuption on $X/S$. All we have
to do is show the following: If $T$ is the spectrum of a field
and $Z \subset X_T$ is a closed subscheme, finite flat of degree
$d$ over $T$, then $Z \to X_T \to X$ factors through an affine open
$U$ of $X$. This is clear because $Z$ will have at most $d$ points
and these will all map into the fibre of $X$ over the image point
of $T \to S$.
\end{proof}

\begin{remark}
\label{remark-when-proposition-applies}
Let $f : X \to S$ be a morphism of schemes. The assumption of
Proposition \ref{proposition-hilb-d-representable} and
hence the conclusion holds in each of the following cases:
\begin{enumerate}
\item $X$ is quasi-affine,
\item $f$ is quasi-affine,
\item $f$ is quasi-projective,
\item $f$ is locally projective,
\item there exists an ample invertible sheaf on $X$,
\item there exists an $f$-ample invertible sheaf on $X$, and
\item there exists an $f$-very ample invertible sheaf on $X$.
\end{enumerate}
Namely, in each of these cases, every finite set of points of
a fibre $X_s$ is contained in a quasi-compact open $U$ of $X$
which comes with an ample invertible sheaf, is isomorphic
to an open of an affine scheme, or is isomorphic to an open
of $\text{Proj}$ of a graded ring (in each case this follows
by unwinding the definitions). Thus the existence of suitable
affine opens by
Properties, Lemma \ref{properties-lemma-ample-finite-set-in-affine}.
\end{remark}




\section{Moduli of divisors on smooth curves}
\label{section-divisors}

\noindent
For a smooth morphism $X \to S$ of relative dimension $1$ the functor
$\text{Hilb}^d_{X/S}$ parametrizes relative effective Cartier divisors
as defined in
Divisors, Section \ref{divisors-section-effective-Cartier-morphisms}.

\begin{lemma}
\label{lemma-divisors-on-curves}
Let $X \to S$ be a smooth morphism of schemes of relative dimension $1$.
Let $D \subset X$ be a closed subscheme. Consider the following conditions
\begin{enumerate}
\item $D \to S$ is finite locally free,
\item $D$ is a relative effective Cartier divisor on $X/S$,
\item $D \to S$ is locally quasi-finite, flat, and
locally of finite presentation, and
\item $D \to S$ is locally quasi-finite and flat.
\end{enumerate}
We always have the implications
$$
(1) \Rightarrow (2) \Leftrightarrow (3) \Rightarrow (4)
$$
If $S$ is locally Noetherian, then the last arrow is an if and only if.
If $X \to S$ is proper (and $S$ arbitrary), then the first arrow is
an if and only if.
\end{lemma}

\begin{proof}
Equivalence of (2) and (3). This follows from
Divisors, Lemma \ref{divisors-lemma-fibre-Cartier}
if we can show the equivalence of (2) and (3) when
$S$ is the spectrum of a field $k$. Let $x \in X$ be a closed point.
As $X$ is smooth of relative dimension $1$ over $k$ and we see that
$\mathcal{O}_{X, x}$ is a regular local ring of dimension $1$
(see Varieties, Lemma \ref{varieties-lemma-smooth-regular}).
Thus $\mathcal{O}_{X, x}$ is a discrete valuation ring
(Algebra, Lemma \ref{algebra-lemma-characterize-dvr})
and hence a PID. It follows that every sheaf of ideals
$\mathcal{I} \subset \mathcal{O}_X$ which is nonvanishing at all
the generic points of $X$ is invertible
(Divisors, Lemma \ref{divisors-lemma-effective-Cartier-in-points}).
In other words, every closed subscheme of $X$ which does not contain
a generic point is an effective Cartier divisor.
It follows that (2) and (3) are equivalent.

\medskip\noindent
If $S$ is Noetherian, then any locally quasi-finite morphism
$D \to S$ is locally of finite presentation (Morphisms, Lemma
\ref{morphisms-lemma-noetherian-finite-type-finite-presentation}),
whence (3) is equivalent to (4).

\medskip\noindent
If $X \to S$ is proper (and $S$ is arbitrary), then $D \to S$ is
proper as well. Since a proper locally quasi-finite morphism is finite
(More on Morphisms, Lemma \ref{more-morphisms-lemma-characterize-finite})
and a finite, flat, and finitely presented morphism is finite locally free
(Morphisms, Lemma \ref{morphisms-lemma-finite-flat}), we see that
(1) is equivalent to (2).
\end{proof}

\begin{lemma}
\label{lemma-sum-divisors-on-curves}
Let $X \to S$ be a smooth morphism of schemes of relative dimension $1$.
Let $D_1, D_2 \subset X$ be closed subschemes finite locally free of
degrees $d_1$, $d_2$ over $S$. Then $D_1 + D_2$ is finite locally free
of degree $d_1 + d_2$ over $S$.
\end{lemma}

\begin{proof}
By Lemma \ref{lemma-divisors-on-curves} we see that $D_1$
and $D_2$ are relative effective Cartier divisors on $X/S$.
Thus $D = D_1 + D_2$ is a relative effective Cartier divisor
on $X/S$ by
Divisors, Lemma \ref{divisors-lemma-sum-relative-effective-Cartier-divisor}.
Hence $D \to S$ is locally quasi-finite, flat, and
locally of finite presentation by
Lemma \ref{lemma-divisors-on-curves}.
Applying
Morphisms, Lemma \ref{morphisms-lemma-image-universally-closed-separated}
the the surjective integral morphism $D_1 \amalg D_2 \to D$
we find that $D \to S$ is separated. Then
Morphisms, Lemma \ref{morphisms-lemma-image-proper-is-proper}
implies that $D \to S$ is proper.
This implies that $D \to S$ is finite
(More on Morphisms, Lemma \ref{more-morphisms-lemma-characterize-finite})
and in turn we see that $D \to S$ is finite locally free
(Morphisms, Lemma \ref{morphisms-lemma-finite-flat}).
Thus it suffice to show that the degree of $D \to S$ is $d_1 + d_2$.
To do this we may base change to a fibre of $X \to S$, hence we may
assume that $S = \Spec(k)$ for some field $k$.
In this case, there exists a finite set of closed points
$x_1, \ldots, x_n \in X$ such that $D_1$ and $D_2$
are supported on $\{x_1, \ldots, x_n\}$.
In fact, there are nonzerodivisors $f_{i, j} \in \mathcal{O}_{X, x_i}$
such that
$$
D_1 = \coprod \Spec(\mathcal{O}_{X, x_i}/(f_{i, 1}))
\quad\text{and}\quad
D_2 = \coprod \Spec(\mathcal{O}_{X, x_i}/(f_{i, 2}))
$$
Then we see that
$$
D = \coprod \Spec(\mathcal{O}_{X, x_i}/(f_{i, 1}f_{i, 2}))
$$
From this one sees easily that $D$ has degree $d_1 + d_2$
over $k$ (if need be, use Algebra, Lemma \ref{algebra-lemma-ord-additive}).
\end{proof}

\begin{lemma}
\label{lemma-difference-divisors-on-curves}
Let $X \to S$ be a smooth morphism of schemes of relative dimension $1$.
Let $D_1, D_2 \subset X$ be closed subschemes finite locally free of
degrees $d_1$, $d_2$ over $S$. If $D_1 \subset D_2$ (as closed subschemes)
then there is a closed subscheme $D \subset X$ finite locally free of
degree $d_2 - d_1$ over $S$ such that $D_2 = D_1 + D$.
\end{lemma}

\begin{proof}
This proof is almost exactly the same as the proof of
Lemma \ref{lemma-sum-divisors-on-curves}.
By Lemma \ref{lemma-divisors-on-curves} we see that $D_1$
and $D_2$ are relative effective Cartier divisors on $X/S$.
By Divisors, Lemma
\ref{divisors-lemma-difference-relative-effective-Cartier-divisor}
there is a relative effective Cartier divisor $D \subset X$
such that $D_2 = D_1 + D$. Hence $D \to S$ is locally quasi-finite, flat, and
locally of finite presentation by
Lemma \ref{lemma-divisors-on-curves}.
Since $D$ is a closed subscheme of $D_2$, we see that
$D \to S$ is finite. It follows that $D \to S$ is finite locally free
(Morphisms, Lemma \ref{morphisms-lemma-finite-flat}).
Thus it suffice to show that the degree of $D \to S$ is $d_2 - d_1$.
This follows from Lemma \ref{lemma-sum-divisors-on-curves}.
\end{proof}

\noindent
Let $X \to S$ be a smooth morphism of schemes of relative dimension $1$.
By Lemma \ref{lemma-divisors-on-curves} for a scheme $T$ over $S$ and
$D \in \text{Hilb}^d_{X/S}(T)$, we can view $D$ as a relative
effective Cartier divisor on $X_T/T$ such that $D \to T$ is finite
locally free of degree $d$. Hence, by
Lemma \ref{lemma-sum-divisors-on-curves} we obtain a transformation
of functors
$$
\text{Hilb}^{d_1}_{X/S} \times \text{Hilb}^{d_2}_{X/S}
\longrightarrow
\text{Hilb}^{d_1 + d_2}_{X/S},\quad
(D_1, D_2) \longmapsto D_1 + D_2
$$
If $\text{Hilb}^d_{X/S}$ is representable for all degrees $d$, then
this transformation of functors corresponds to a morphism of schemes
$$
\underline{\text{Hilb}}^{d_1}_{X/S}
\times_S
\underline{\text{Hilb}}^{d_2}_{X/S}
\longrightarrow
\underline{\text{Hilb}}^{d_1 + d_2}_{X/S}
$$
over $S$. Observe that $\underline{\text{Hilb}}^0_{X/S} = S$ and
$\underline{\text{Hilb}}^1_{X/S} = X$.
A special case of the morphism above is the morphism
$$
\underline{\text{Hilb}}^d_{X/S} \times_S X
\longrightarrow
\underline{\text{Hilb}}^{d + 1}_{X/S},\quad
(D, x) \longmapsto D + x
$$

\begin{lemma}
\label{lemma-universal-object}
Let $X \to S$ be a smooth morphism of schemes of relative dimension $1$
such that the functors $\text{Hilb}^d_{X/S}$ are representable. The morphism
$\underline{\text{Hilb}}^d_{X/S} \times_S X \to
\underline{\text{Hilb}}^{d + 1}_{X/S}$
is finite locally free of degree $d + 1$.
\end{lemma}

\begin{proof}
Let $D_{univ} \subset X \times_S \underline{\text{Hilb}}^{d + 1}_{X/S}$
be the universal object. There is a commutative diagram
$$
\xymatrix{
\underline{\text{Hilb}}^d_{X/S} \times_S X \ar[rr] \ar[rd] & &
D_{univ} \ar[ld] \ar@{^{(}->}[r] &
\underline{\text{Hilb}}^{d + 1}_{X/S} \times_S X \\
& \underline{\text{Hilb}}^{d + 1}_{X/S}
}
$$
where the top horizontal arrow maps $(D', x)$ to $(D' + x, x)$.
We claim this morphism is an isomorphism
which certainly proves the lemma. Namely, given a scheme $T$ over $S$,
a $T$-valued point $\xi$ of $D_{univ}$ is given by a pair $\xi = (D, x)$
where $D \subset X_T$ is a closed subscheme finite locally free
of degree $d + 1$ over $T$ and $x : T \to X$ is a morphism whose
graph $x : T \to X_T$ factors through $D$. Then by
Lemma \ref{lemma-difference-divisors-on-curves}
we can write $D = D' + x$ for some $D' \subset X_T$ finite locally
free of degree $d$ over $T$. Sending $\xi = (D, x)$ to the pair
$(D', x)$ is the desired inverse.
\end{proof}

\begin{lemma}
\label{lemma-hilb-d-smooth}
Let $X \to S$ be a smooth morphism of schemes of relative dimension $1$
such that the functors $\text{Hilb}^d_{X/S}$ are representable. The
schemes $\underline{\text{Hilb}}^d_{X/S}$ are smooth over $S$ of
relative dimension $d$.
\end{lemma}

\begin{proof}
We have $\underline{\text{Hilb}}^d_{X/S} = S$ and
$\underline{\text{Hilb}}^1_{X/S} = X$ thus the result is true for $d = 0, 1$.
Assuming the result for $d$, we see that
$\underline{\text{Hilb}}^d_{X/S} \times_S X$ is smooth over $S$
(Morphisms, Lemma \ref{morphisms-lemma-base-change-smooth} and
\ref{morphisms-lemma-composition-smooth}). Since
$\underline{\text{Hilb}}^d_{X/S} \times_S X \to
\underline{\text{Hilb}}^{d + 1}_{X/S}$
is finite locally free of degree $d + 1$ by
Lemma \ref{lemma-universal-object}
the result follows from
Descent, Lemma \ref{descent-lemma-smooth-permanence}.
We omit the verification that the relative dimension is
as claimed (you can do this by looking at fibres, or by
keeping track of the dimensions in the argument above).
\end{proof}

\noindent
We collect all the information obtained sofar in the case of
a proper smooth curve over a field.

\begin{proposition}
\label{proposition-hilb-d}
Let $X$ be a geometrically irreducible smooth proper curve over a field $k$.
\begin{enumerate}
\item The functors $\text{Hilb}^d_{X/k}$ are representable by smooth
proper varieties $\underline{\text{Hilb}}^d_{X/k}$ of dimension
$d$ over $k$.
\item For a field extension $k'/k$ the $k'$-rational points
of $\underline{\text{Hilb}}^d_{X/k}$ are in $1$-to-$1$ bijection
with effective Cartier divisors of degree $d$ on $X_{k'}$.
\item For $d_1, d_2 \geq 0$ there is a morphism
$$
\underline{\text{Hilb}}^{d_1}_{X/k}
\times_k
\underline{\text{Hilb}}^{d_2}_{X/k}
\longrightarrow
\underline{\text{Hilb}}^{d_1 + d_2}_{X/k}
$$
which is finite locally free of degree ${d_1 + d_2 \choose d_1}$.
\end{enumerate}
\end{proposition}

\begin{proof}
The functors $\text{Hilb}^d_{X/k}$ are representable by
Proposition \ref{proposition-hilb-d-representable}
(see also Remark \ref{remark-when-proposition-applies})
and the fact that $X$ is projective
(Varieties, Lemma \ref{varieties-lemma-dim-1-proper-projective}).
The schemes $\underline{\text{Hilb}}^d_{X/k}$ are separated
over $k$ by Lemma \ref{lemma-hilb-d-separated}.
The schemes $\underline{\text{Hilb}}^d_{X/k}$ are smooth over
over $k$ by Lemma \ref{lemma-hilb-d-smooth}.
Starting with $X = \underline{\text{Hilb}}^1_{X/k}$,
the morphisms of Lemma \ref{lemma-universal-object},
and induction we find a morphism
$$
X^d = X \times_k X \times_k \ldots \times_k X \longrightarrow
\underline{\text{Hilb}}^d_{X/k},\quad
(x_1, \ldots, x_d) \longrightarrow x_1 + \ldots + x_d
$$
which is finite locally free of degree $d!$. Since $X$ is
proper over $k$, so is $X^d$, hence
$\underline{\text{Pic}}^d_{X/k}$ is proper over $k$ by
Morphisms, Lemma \ref{morphisms-lemma-image-proper-is-proper}.
Since $X$ is geometrically irreducible over $k$, the product
$X^d$ is irreducible
(Varieties, Lemma \ref{varieties-lemma-bijection-irreducible-components})
hence the image is irreducible (in fact geometrically irreducible).
This proves (1). Part (2) follows from the definitions. Part (3) follows
from the commutative diagram
$$
\xymatrix{
X^{d_1} \times_k X^{d_2} \ar[d] \ar@{=}[r] & X^{d_1 + d_2} \ar[d] \\
\underline{\text{Hilb}}^{d_1}_{X/k}
\times_k
\underline{\text{Hilb}}^{d_2}_{X/k}
\ar[r] &
\underline{\text{Hilb}}^{d_1 + d_2}_{X/k}
}
$$
and multiplicativity of degrees of finite locally free morphisms.
\end{proof}





\input{chapters}

\bibliography{my}
\bibliographystyle{amsalpha}

\end{document}
