\input{preamble}

% OK, start here.
%
\begin{document}

\title{Divisors on Algebraic Spaces}


\maketitle

\phantomsection
\label{section-phantom}

\tableofcontents

\section{Introduction}
\label{section-introduction}

\noindent
In this chapter we study divisors on algebraic spaces and related topics.
A basic reference for algebraic spaces is \cite{Kn}.




\section{Effective Cartier divisors}
\label{section-effective-Cartier-divisors}

\noindent
For some reason it seem convenient to define the notion of an effective
Cartier divisor before anything else. Note that in
Morphisms of Spaces, Section \ref{spaces-morphisms-section-closed-immersions}
we discussed the correspondence between closed subspaces and quasi-coherent
sheaves of ideals. Moreover, in
Properties of Spaces, Section
\ref{spaces-properties-section-properties-modules}, we discussed properties
of quasi-coherent modules, in particular ``locally generated by $1$ element''.
These references show that the following definition is
compatible with the definition for schemes.

\begin{definition}
\label{definition-effective-Cartier-divisor}
Let $S$ be a scheme. Let $X$ be an algebraic space over $S$.
\begin{enumerate}
\item A {\it locally principal closed subspace} of $X$ is a closed subspace
whose sheaf of ideals is locally generated by $1$ element.
\item An {\it effective Cartier divisor} on $X$ is a closed subspace
$D \subset X$ such that the ideal sheaf $\mathcal{I}_D \subset \mathcal{O}_X$
is an invertible $\mathcal{O}_X$-module.
\end{enumerate}
\end{definition}

\noindent
Thus an effective Cartier divisor is a locally principal closed subspace,
but the converse is not always true. Effective Cartier divisors are closed
subspaces of pure codimension $1$ in the strongest possible sense. Namely
they are locally cut out by a single element which is not a zerodivisor.
In particular they are nowhere dense.

\begin{lemma}
\label{lemma-characterize-effective-Cartier-divisor}
Let $S$ be a scheme. Let $X$ be an algebraic space over $S$.
Let $D \subset X$ be a closed subspace.
The following are equivalent:
\begin{enumerate}
\item The subspace $D$ is an effective Cartier divisor on $X$.
\item For some scheme $U$ and surjective \'etale morphism $U \to X$
the inverse image $D \times_X U$ is an effective Cartier divisor on $U$.
\item For every scheme $U$ and every \'etale morphism $U \to X$
the inverse image $D \times_X U$ is an effective Cartier divisor on $U$.
\item For every $x \in |D|$ there exists an \'etale morphism
$(U, u) \to (X, x)$ of pointed algebraic spaces such that $U = \Spec(A)$
and $D \times_X U = \Spec(A/(f))$ with $f \in A$ not a zerodivisor.
\end{enumerate}
\end{lemma}

\begin{proof}
The equivalence of (1) -- (3) follows from
Definition \ref{definition-effective-Cartier-divisor}
and the references preceding it.
Assume (1) and let $x \in |D|$. Choose a scheme $W$ and a
surjective \'etale morphism
$W \to X$. Choose $w \in D \times_X W$ mapping to $x$.
By (3) $D \times_X W$ is an effective Cartier
divisor on $W$. Hence we can find affine \'etale neighbourhood $U$
by choosing an affine open neighbourhood of $w$ in $W$ as in
Divisors, Lemma \ref{divisors-lemma-characterize-effective-Cartier-divisor}.

\medskip\noindent
Assume (2). Then we see that $\mathcal{I}_D|_U$ is invertible by
Divisors, Lemma \ref{divisors-lemma-characterize-effective-Cartier-divisor}.
Since we can find an \'etale covering of $X$ by the collection of
all such $U$ and $X \setminus D$, we conclude that
$\mathcal{I}_D$ is an invertible $\mathcal{O}_X$-module.
\end{proof}

\begin{lemma}
\label{lemma-complement-locally-principal-closed-subscheme}
Let $S$ be a scheme. Let $X$ be an algebraic space over $S$.
Let $Z \subset X$ be a locally principal closed
subspace. Let $U = X \setminus Z$. Then $U \to X$ is an affine morphism.
\end{lemma}

\begin{proof}
The question is \'etale local on $X$, see
Morphisms of Spaces, Lemmas \ref{spaces-morphisms-lemma-affine-local}
and
Lemma \ref{lemma-characterize-effective-Cartier-divisor}.
Thus this follows from the case of schemes which is
Divisors, Lemma
\ref{divisors-lemma-complement-locally-principal-closed-subscheme}.
\end{proof}

\begin{lemma}
\label{lemma-complement-effective-Cartier-divisor}
Let $S$ be a scheme. Let $X$ be an algebraic space over $S$.
Let $D \subset X$ be an effective Cartier divisor.
Let $U = X \setminus D$. Then $U \to X$ is an affine morphism and $U$
is scheme theoretically dense in $X$.
\end{lemma}

\begin{proof}
Affineness is Lemma \ref{lemma-complement-locally-principal-closed-subscheme}.
The density question is \'etale local on $X$ by
Morphisms of Spaces, Definition
\ref{spaces-morphisms-definition-scheme-theoretically-dense}.
Thus this follows from the case of schemes which is
Divisors, Lemma
\ref{divisors-lemma-complement-effective-Cartier-divisor}.
\end{proof}

\begin{lemma}
\label{lemma-effective-Cartier-makes-dimension-drop}
Let $S$ be a scheme. Let $X$ be an algebraic space over $S$.
Let $D \subset X$ be an effective Cartier divisor.
Let $x \in |D|$.
If $\dim_x(X) < \infty$, then $\dim_x(D) < \dim_x(X)$.
\end{lemma}

\begin{proof}
Both the definition of an effective Cartier divisor and of the
dimension of an an algebraic space at a point
(Properties of Spaces, Definition
\ref{spaces-properties-definition-dimension-at-point})
are \'etale local. Hence this lemma follows from the case of schemes
which is
Divisors, Lemma \ref{divisors-lemma-effective-Cartier-makes-dimension-drop}.
\end{proof}

\begin{definition}
\label{definition-sum-effective-Cartier-divisors}
Let $S$ be a scheme. Let $X$ be an algebraic space over $S$.
Given effective Cartier divisors
$D_1$, $D_2$ on $X$ we set $D = D_1 + D_2$ equal to the
closed subspace of $X$ corresponding to the quasi-coherent
sheaf of ideals
$\mathcal{I}_{D_1}\mathcal{I}_{D_2} \subset \mathcal{O}_S$.
We call this the {\it sum of the effective Cartier divisors
$D_1$ and $D_2$}.
\end{definition}

\noindent
It is clear that we may define the sum $\sum n_iD_i$ given
finitely many effective Cartier divisors $D_i$ on $X$
and nonnegative integers $n_i$.

\begin{lemma}
\label{lemma-sum-effective-Cartier-divisors}
The sum of two effective Cartier divisors is an effective
Cartier divisor.
\end{lemma}

\begin{proof}
Omitted. \'Etale locally this reduces to the following simple
algebra fact: if $f_1, f_2 \in A$ are nonzerodivisors of a ring $A$, then
$f_1f_2 \in A$ is a nonzerodivisor.
\end{proof}

\begin{lemma}
\label{lemma-sum-closed-subschemes-effective-Cartier}
Let $S$ be a scheme. Let $X$ be an algebraic space over $S$.
Let $Z, Y$ be two closed subspaces of $X$
with ideal sheaves $\mathcal{I}$ and $\mathcal{J}$. If $\mathcal{I}\mathcal{J}$
defines an effective Cartier divisor $D \subset X$, then $Z$ and $Y$
are effective Cartier divisors and $D = Z + Y$.
\end{lemma}

\begin{proof}
By Lemma \ref{lemma-characterize-effective-Cartier-divisor}
this reduces to the case of schemes which is
Divisors, Lemma \ref{divisors-lemma-sum-closed-subschemes-effective-Cartier}.
\end{proof}

\noindent
Recall that we have defined the inverse image of a closed subspace
under any morphism of algebraic spaces in
Morphisms of Spaces, Definition
\ref{spaces-morphisms-definition-inverse-image-closed-subspace}.

\begin{lemma}
\label{lemma-pullback-locally-principal}
Let $S$ be a scheme.
Let $f : X' \to X$ be a morphism of algebraic spaces over $S$.
Let $Z \subset X$ be a locally principal closed subspace.
Then the inverse image $f^{-1}(Z)$ is a locally principal closed
subspace of $X'$.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{definition}
\label{definition-pullback-effective-Cartier-divisor}
Let $S$ be a scheme.
Let $f : X' \to X$ be a morphism of algebraic spaces over $S$.
Let $D \subset X$
be an effective Cartier divisor. We say the {\it pullback of
$D$ by $f$ is defined} if the closed subspace $f^{-1}(D) \subset X'$
is an effective Cartier divisor. In this case we denote it either
$f^*D$ or $f^{-1}(D)$ and we call it the
{\it pullback of the effective Cartier divisor}.
\end{definition}

\noindent
The condition that $f^{-1}(D)$ is an effective Cartier divisor
is often satisfied in practice.

\begin{lemma}
\label{lemma-pullback-effective-Cartier-defined}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of algebraic spaces over $S$.
Let $D \subset Y$ be an effective Cartier divisor.
The pullback of $D$ by $f$ is defined in each of the following cases:
\begin{enumerate}
\item $f$ is flat, and
\item add more here as needed.
\end{enumerate}
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-pullback-effective-Cartier-divisors-additive}
Let $S$ be a scheme.
Let $f : X' \to X$ be a morphism of algebraic spaces over $S$.
Let $D_1$, $D_2$ be effective Cartier divisors on $X$.
If the pullbacks of $D_1$ and $D_2$ are defined then the
pullback of $D = D_1 + D_2$ is defined and
$f^*D = f^*D_1 + f^*D_2$.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{definition}
\label{definition-invertible-sheaf-effective-Cartier-divisor}
Let $S$ be a scheme. Let $X$ be an algebraic space over $S$
and let $D \subset X$ be an effective Cartier divisor.
The {\it invertible sheaf $\mathcal{O}_X(D)$ associated to $D$}
is given by
$$
\mathcal{O}_X(D) :=
\SheafHom_{\mathcal{O}_X}(\mathcal{I}_D, \mathcal{O}_X) =
\mathcal{I}_D^{\otimes -1}.
$$
The canonical section, usually denoted $1$ or $1_D$, is the
global section of $\mathcal{O}_X(D)$ corresponding to
the inclusion mapping $\mathcal{I}_D \to \mathcal{O}_X$.
\end{definition}

\begin{lemma}
\label{lemma-invertible-sheaf-sum-effective-Cartier-divisors}
Let $S$ be a scheme. Let $X$ be an algebraic space over $S$.
Let $D_1$, $D_2$ be effective Cartier divisors on $X$.
Let $D = D_1 + D_2$.
Then there is a unique isomorphism
$$
\mathcal{O}_X(D_1) \otimes_{\mathcal{O}_X} \mathcal{O}_X(D_2)
\longrightarrow
\mathcal{O}_X(D)
$$
which maps $1_{D_1} \otimes 1_{D_2}$ to $1_D$.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{definition}
\label{definition-regular-section}
Let $S$ be a scheme. Let $X$ be an algebraic space over $S$.
Let $\mathcal{L}$ be an invertible sheaf on $X$.
A global section $s \in \Gamma(X, \mathcal{L})$ is called a
{\it regular section} if the map $\mathcal{O}_X \to \mathcal{L}$,
$f \mapsto fs$ is injective.
\end{definition}

\begin{lemma}
\label{lemma-regular-section-structure-sheaf}
Let $S$ be a scheme.
Let $X$ be an algebraic space over $S$.
Let $f \in \Gamma(X, \mathcal{O}_X)$.
The following are equivalent:
\begin{enumerate}
\item $f$ is a regular section, and
\item for any $x \in X$ the image $f \in \mathcal{O}_{X, \overline{x}}$
is not a zerodivisor.
\item for any affine $U = \Spec(A)$ \'etale over $X$
the restriction $f|_U$ is a nonzerodivisor of $A$, and
\item there exists a scheme $U$ and a surjective \'etale morphism
$U \to X$ such that $f|_U$ is a regular section of $\mathcal{O}_U$.
\end{enumerate}
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\noindent
Note that a global section $s$ of an invertible $\mathcal{O}_X$-module
$\mathcal{L}$ may be seen as an $\mathcal{O}_X$-module map
$s : \mathcal{O}_X \to \mathcal{L}$. Its dual is therefore a
map $s : \mathcal{L}^{\otimes -1} \to \mathcal{O}_X$.
(See Modules on Sites, Lemma \ref{sites-modules-lemma-constructions-invertible}
for the dual invertible sheaf.)

\begin{definition}
\label{definition-zero-scheme-s}
Let $S$ be a scheme. Let $X$ be an algebraic space over $S$.
Let $\mathcal{L}$ be an invertible sheaf.
Let $s \in \Gamma(X, \mathcal{L})$.
The {\it zero scheme} of $s$ is the closed subspace $Z(s) \subset X$
defined by the quasi-coherent sheaf of ideals
$\mathcal{I} \subset \mathcal{O}_X$ which is the image of the
map $s : \mathcal{L}^{\otimes -1} \to \mathcal{O}_X$.
\end{definition}

\begin{lemma}
\label{lemma-zero-scheme}
Let $S$ be a scheme. Let $X$ be an algebraic space over $S$.
Let $\mathcal{L}$ be an invertible $\mathcal{O}_X$-module.
Let $s \in \Gamma(X, \mathcal{L})$.
\begin{enumerate}
\item Consider closed immersions $i : Z \to X$ such that
$i^*s \in \Gamma(Z, i^*\mathcal{L}))$ is zero
ordered by inclusion. The zero scheme $Z(s)$ is the
maximal element of this ordered set.
\item For any morphism of algebraic spaces $f : Y \to X$ over $S$
we have $f^*s = 0$ in $\Gamma(Y, f^*\mathcal{L})$ if and only if
$f$ factors through $Z(s)$.
\item The zero scheme $Z(s)$ is a locally principal closed subspace of $X$.
\item The zero scheme $Z(s)$ is an effective Cartier divisor on $X$
if and only if $s$ is a regular section of $\mathcal{L}$.
\end{enumerate}
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-characterize-OD}
Let $S$ be a scheme. Let $X$ be an algebraic space over $S$.
\begin{enumerate}
\item If $D \subset X$ is an effective Cartier divisor, then
the canonical section $1_D$ of $\mathcal{O}_X(D)$ is regular.
\item Conversely, if $s$ is a regular section of the invertible
sheaf $\mathcal{L}$, then there exists a unique effective
Cartier divisor $D = Z(s) \subset X$ and a unique isomorphism
$\mathcal{O}_X(D) \to \mathcal{L}$ which maps $1_D$ to $s$.
\end{enumerate}
The constructions
$D \mapsto (\mathcal{O}_X(D), 1_D)$ and $(\mathcal{L}, s) \mapsto Z(s)$
give mutually inverse maps
$$
\left\{
\begin{matrix}
\text{effective Cartier divisors on }X
\end{matrix}
\right\}
\leftrightarrow
\left\{
\begin{matrix}
\text{pairs }(\mathcal{L}, s)\text{ consisting of an invertible}\\
\mathcal{O}_X\text{-module and a regular global section}
\end{matrix}
\right\}
$$
\end{lemma}

\begin{proof}
Omitted.
\end{proof}










\section{Relative Proj}
\label{section-relative-proj}

\noindent
This section revisits the construction of the relative proj
in the setting of algebraic spaces. The material in this section
corresponds to the material in Constructions, Section
\ref{constructions-section-relative-proj}
and Divisors, Section \ref{divisors-section-relative-proj}
in the case of schemes.

\begin{situation}
\label{situation-relative-proj}
Here $S$ is a scheme, $X$ is an algebraic space over $S$, and
$\mathcal{A}$ is a quasi-coherent graded $\mathcal{O}_X$-algebra.
\end{situation}

\noindent
In Situation \ref{situation-relative-proj} we are going to define
a functor $F : (\Sch/S)_{fppf}^{opp} \to \textit{Sets}$ which will
turn out to be an algebraic space. We will follow (mutatis mutandis)
the procedure of
Constructions, Section \ref{constructions-section-relative-proj}.
First, given a scheme $T$ over $S$ we define a
{\it quadruple over $T$} to be a system
$(d, f : T \to S, \mathcal{L}, \psi)$
\begin{enumerate}
\item $d \geq 1$ is an integer,
\item $f : T \to X$ is a morphism over $S$,
\item $\mathcal{L}$ is an invertible $\mathcal{O}_T$-module, and
\item
$\psi : f^*\mathcal{A}^{(d)} \to \bigoplus_{n \geq 0}\mathcal{L}^{\otimes n}$
is a homomorphism of graded $\mathcal{O}_T$-algebras
such that $f^*\mathcal{A}_d \to \mathcal{L}$ is surjective.
\end{enumerate}
We say two quadruples $(d, f, \mathcal{L}, \psi)$ and
$(d', f', \mathcal{L}', \psi')$ are {\it equivalent}\footnote{This
definition is motivated by
Constructions, Lemma \ref{constructions-lemma-equivalent-relative}.
The advantage of choosing this one is that it clearly defines
an equivalence relation.}
if and only if
we have $f = f'$ and for some positive integer $m = ad = a'd'$
there exists an isomorphism
$\beta : \mathcal{L}^{\otimes a} \to (\mathcal{L}')^{\otimes a'}$
with the property that $\beta \circ \psi|_{f^*\mathcal{A}^{(m)}}$
and $\psi'|_{f^*\mathcal{A}^{(m)}}$ agree
as graded ring maps
$f^*\mathcal{A}^{(m)} \to \bigoplus_{n \geq 0} (\mathcal{L}')^{\otimes mn}$.
Given a quadruple $(d, f, \mathcal{L}, \psi)$
and a morphism $h : T' \to T$ we have the pullback
$(d, f \circ h, h^*\mathcal{L}, h^*\psi)$. Pullback preserves 
the equivalence relation. Finally, for a {\it quasi-compact} scheme $T$
over $S$ we set
$$
F(T) = \text{the set of equivalence classes of quadruples over }T
$$
and for an arbitrary scheme $T$ over $S$ we set
$$
F(T)
=
\lim_{V \subset T\text{ quasi-compact open}} F(V).
$$
In other words, an element $\xi$ of $F(T)$ corresponds to a compatible
system of choices of elements $\xi_V \in F(V)$ where $V$ ranges over the
quasi-compact opens of $T$. Thus we have defined our functor
\begin{equation}
\label{equation-proj}
F : \Sch^{opp} \longrightarrow \textit{Sets}
\end{equation}
There is a morphism $F \to X$ of functors sending the quadruple
$(d, f, \mathcal{L}, \psi)$ to $f$.

\begin{lemma}
\label{lemma-relative-proj}
In Situation \ref{situation-relative-proj}. The functor $F$ above is an
algebraic space. For any morphism $g : Z \to X$ where $Z$ is a scheme
there is a canonical isomorphism
$\underline{\text{Proj}}_Z(g^*\mathcal{A}) = Z \times_X F$
compatible with further base change.
\end{lemma}

\begin{proof}
It suffices to prove the second assertion, see
Spaces, Lemma \ref{spaces-lemma-representable-over-space}.
Let $g : Z \to X$ be a morphism where $Z$ is a scheme.
Let $F'$ be the functor of quadruples associated
to the graded quasi-coherent $\mathcal{O}_Z$-algebra $g^*\mathcal{A}$.
Then there is a canonical isomorphism $F' = Z \times_X F$, sending
a quadruple $(d, f : T \to Z, \mathcal{L}, \psi)$ for $F'$
to $(d, g \circ f, \mathcal{L}, \psi)$ (details omitted, see proof of
Constructions, Lemma \ref{constructions-lemma-proj-base-change}).
By Constructions, Lemmas
\ref{constructions-lemma-equivalent-relative},
\ref{constructions-lemma-relative-proj}, and
\ref{constructions-lemma-glueing-gives-functor-proj} and
Definition \ref{constructions-definition-relative-proj}
we see that $F'$ is representable by
$\underline{\text{Proj}}_Z(g^*\mathcal{A})$.
\end{proof}

\noindent
The lemma above tells us the following definition makes sense.

\begin{definition}
\label{definition-relative-proj}
Let $S$ be a scheme. Let $X$ be an algebraic space over $S$.
Let $\mathcal{A}$ be a quasi-coherent sheaf of
graded $\mathcal{O}_X$-algebras. The
{\it relative homogeneous spectrum of $\mathcal{A}$ over $X$},
or the {\it homogeneous spectrum of $\mathcal{A}$ over $X$}, or the
{\it relative Proj of $\mathcal{A}$ over $X$} is the algebraic space
$F$ over $X$ of Lemma \ref{lemma-relative-proj}.
We denote it $\pi : \underline{\text{Proj}}_X(\mathcal{A}) \to X$.
\end{definition}

\noindent
In particular the structure morphism of the relative Proj is representable
by construction. We can also think about the relative Proj via glueing. Let
$\varphi : U \to X$ be a surjective \'etale morphism, where $U$ is a scheme.
Set $R = U \times_X U$ with projection morphisms $s, t : R  \to U$.
By Lemma \ref{lemma-relative-proj} there exists a canonical isomorphism
$$
\gamma : 
\underline{\text{Proj}}_U(\varphi^*\mathcal{A})
\longrightarrow
\underline{\text{Proj}}_X(\mathcal{A}) \times_X U
$$
over $U$. Let $\alpha : t^*\varphi^*\mathcal{A} \to s^*\varphi^*\mathcal{A}$
be the canonical isomorphism of
Properties of Spaces, Proposition
\ref{spaces-properties-proposition-quasi-coherent}.
Then the diagram
$$
\xymatrix{
&
\underline{\text{Proj}}_U(\varphi^*\mathcal{A}) \times_{U, s} R
\ar@{=}[r] &
\underline{\text{Proj}}_R(s^*\varphi^*\mathcal{A})
\ar[dd]_{\text{induced by }\alpha} \\
\underline{\text{Proj}}_X(\mathcal{A}) \times_X R
\ar[ru]_{s^*\gamma} \ar[rd]^{t^*\gamma} \\
&
\underline{\text{Proj}}_U(\varphi^*\mathcal{A}) \times_{U, t} R
\ar@{=}[r] &
\underline{\text{Proj}}_R(t^*\varphi^*\mathcal{A})
}
$$
is commutative (the equal signs come from
Constructions, Lemma \ref{constructions-lemma-relative-proj-base-change}).
Thus, if we denote $\mathcal{A}_U$, $\mathcal{A}_R$
the pullback of $\mathcal{A}$ to $U$, $R$, then
$P = \underline{\text{Proj}}_X(\mathcal{A})$ has an \'etale covering
by the scheme $P_U = \underline{\text{Proj}}_U(\mathcal{A}_U)$ and
$P_U \times_P P_U$ is equal to
$P_R = \underline{\text{Proj}}_R(\mathcal{A}_R)$.
Using these remarks we can argue in the usual fashion using \'etale
localization to transfer results on the relative proj from the case
of schemes to the case of algebraic spaces.

\begin{lemma}
\label{lemma-twists-of-structure-sheaf}
In Situation \ref{situation-relative-proj}. The relative Proj comes
equipped with a quasi-coherent sheaf of $\mathbf{Z}$-graded algebras
$\bigoplus_{n \in \mathbf{Z}}
\mathcal{O}_{\underline{\text{Proj}}_X(\mathcal{A})}(n)$
and a canonical homomorphism of graded algebras
$$
\psi :
\pi^*\mathcal{A}
\longrightarrow
\bigoplus\nolimits_{n \geq 0}
\mathcal{O}_{\underline{\text{Proj}}_X(\mathcal{A})}(n)
$$
whose base change to any scheme over $X$ agrees with
Constructions, Lemma \ref{constructions-lemma-glue-relative-proj-twists}.
\end{lemma}

\begin{proof}
As in the discussion following Definition \ref{definition-relative-proj}
choose a scheme $U$ and a surjective \'etale morphism
$U \to X$, set $R = U \times_X U$ with projections $s, t : R \to U$,
$\mathcal{A}_U = \mathcal{A}|_U$, $\mathcal{A}_R = \mathcal{A}|_R$,
and $\pi : P = \underline{\text{Proj}}_X(\mathcal{A}) \to X$,
$\pi_U : P_U = \underline{\text{Proj}}_U(\mathcal{A}_U)$ and
$\pi_R : P_R = \underline{\text{Proj}}_U(\mathcal{A}_R)$.
By the
Constructions, Lemma \ref{constructions-lemma-glue-relative-proj-twists}
we have a quasi-coherent sheaf of $\mathbf{Z}$-graded
$\mathcal{O}_{P_U}$-algebras
$\bigoplus_{n \in \mathbf{Z}} \mathcal{O}_{P_U}(n)$
and a canonical map
$\psi_U : \pi_U^*\mathcal{A}_U \to \bigoplus_{n \geq 0} \mathcal{O}_{P_U}(n)$
and similarly for $P_R$. By
Constructions, Lemma \ref{constructions-lemma-relative-proj-base-change}
the pullback of $\mathcal{O}_{P_U}(n)$ and $\psi_U$ by either projection
$P_R \to P_U$ is equal to $\mathcal{O}_{P_R}(n)$ and $\psi_R$.
By Properties of Spaces, Proposition
\ref{spaces-properties-proposition-quasi-coherent}
we obtain $\mathcal{O}_{P}(n)$ and $\psi$.
We omit the verification of compatibility with pullback to
arbitrary schemes over $X$.
\end{proof}

\noindent
Having constructed the relative Proj we turn to some basic
properties.

\begin{lemma}
\label{lemma-relative-proj-base-change}
Let $S$ be a scheme. Let $g : X' \to X$ be a morphism of algebraic spaces
over $S$ and let $\mathcal{A}$ be a quasi-coherent sheaf
of graded $\mathcal{O}_X$-algebras. Then there is a canonical isomorphism
$$
r :
\underline{\text{Proj}}_{X'}(g^*\mathcal{A})
\longrightarrow
X' \times_X \underline{\text{Proj}}_X(\mathcal{A})
$$
as well as a corresponding isomorphism
$$
\theta :
r^*\text{pr}_2^*\left(\bigoplus\nolimits_{d \in \mathbf{Z}}
\mathcal{O}_{\underline{\text{Proj}}_X(\mathcal{A})}(d)\right)
\longrightarrow
\bigoplus\nolimits_{d \in \mathbf{Z}}
\mathcal{O}_{\underline{\text{Proj}}_{X'}(g^*\mathcal{A})}(d)
$$
of $\mathbf{Z}$-graded
$\mathcal{O}_{\underline{\text{Proj}}_{X'}(g^*\mathcal{A})}$-algebras.
\end{lemma}

\begin{proof}
Let $F$ be the functor (\ref{equation-proj}) and let $F'$ be the
corresponding functor defined using $g^*\mathcal{A}$ on $X'$.
We claim there is a canonical isomorphism $r : F' \to X' \times_X F$
of functors (and of course $r$ is the isomorphism of the lemma).
It suffices to construct the bijection
$r : F'(T) \to X'(T) \times_{X(T)} F(T)$ for quasi-compact schemes $T$
over $S$. First, if $\xi = (d', f', \mathcal{L}', \psi')$ is a
quadruple over $T$ for $F'$, then we can set
$r(\xi) = (f', (d', g \circ f', \mathcal{L}', \psi'))$. This makes sense
as $(g \circ f')^*\mathcal{A}^{(d)} = (f')^*(g^*\mathcal{A})^{(d)}$.
The inverse map sends the pair $(f', (d, f, \mathcal{L}, \psi))$
to the quadruple $(d, f', \mathcal{L}, \psi)$. We omit the proof
of the final assertion (hint: reduce to the case of schemes by \'etale
localization and apply Constructions, Lemma
\ref{constructions-lemma-relative-proj-base-change}).
\end{proof}

\begin{lemma}
\label{lemma-relative-proj-separated}
In Situation \ref{situation-relative-proj} the morphism
$\pi : \underline{\text{Proj}}_X(\mathcal{A}) \to X$
is separated.
\end{lemma}

\begin{proof}
By Morphisms of Spaces, Lemma \ref{spaces-morphisms-lemma-separated-local}
and the construction of the relative Proj this follows from the
case of schemes which is
Constructions, Lemma \ref{constructions-lemma-relative-proj-separated}.
\end{proof}

\begin{lemma}
\label{lemma-relative-proj-quasi-compact}
In Situation \ref{situation-relative-proj}. If one of the following holds
\begin{enumerate}
\item $\mathcal{A}$ is of finite type as a sheaf of
$\mathcal{A}_0$-algebras,
\item $\mathcal{A}$ is generated by $\mathcal{A}_1$ as an
$\mathcal{A}_0$-algebra and $\mathcal{A}_1$ is a finite type
$\mathcal{A}_0$-module,
\item there exists a finite type quasi-coherent $\mathcal{A}_0$-submodule
$\mathcal{F} \subset \mathcal{A}_{+}$ such that
$\mathcal{A}_{+}/\mathcal{F}\mathcal{A}$ is a locally nilpotent
sheaf of ideals of $\mathcal{A}/\mathcal{F}\mathcal{A}$,
\end{enumerate}
then $\pi : \underline{\text{Proj}}_X(\mathcal{A}) \to X$ is quasi-compact.
\end{lemma}

\begin{proof}
By Morphisms of Spaces, Lemma \ref{spaces-morphisms-lemma-quasi-compact-local}
and the construction of the relative Proj this follows from the
case of schemes which is
Divisors, Lemma \ref{divisors-lemma-relative-proj-quasi-compact}.
\end{proof}

\begin{lemma}
\label{lemma-relative-proj-finite-type}
In Situation \ref{situation-relative-proj}.
If $\mathcal{A}$ is of finite type as a sheaf of
$\mathcal{O}_X$-algebras, then
$\pi : \underline{\text{Proj}}_X(\mathcal{A}) \to X$ is of finite type.
\end{lemma}

\begin{proof}
By Morphisms of Spaces, Lemma \ref{spaces-morphisms-lemma-finite-type-local}
and the construction of the relative Proj this follows from the
case of schemes which is
Divisors, Lemma \ref{divisors-lemma-relative-proj-finite-type}.
\end{proof}

\begin{lemma}
\label{lemma-relative-proj-universally-closed}
In Situation \ref{situation-relative-proj}. If
$\mathcal{O}_X \to \mathcal{A}_0$
is an integral algebra map\footnote{In other words, the integral
closure of $\mathcal{O}_X$ in $\mathcal{A}_0$, see
Morphisms of Spaces, Definition
\ref{spaces-morphisms-definition-integral-closure}, equals
$\mathcal{A}_0$.} and $\mathcal{A}$ is of finite type as an
$\mathcal{A}_0$-algebra, then
$\pi : \underline{\text{Proj}}_X(\mathcal{A}) \to X$ is universally closed.
\end{lemma}

\begin{proof}
By Morphisms of Spaces, Lemma
\ref{spaces-morphisms-lemma-universally-closed-local}
and the construction of the relative Proj this follows from the
case of schemes which is
Divisors, Lemma \ref{divisors-lemma-relative-proj-universally-closed}.
\end{proof}

\begin{lemma}
\label{lemma-relative-proj-proper}
In Situation \ref{situation-relative-proj}.
The following conditions are equivalent
\begin{enumerate}
\item $\mathcal{A}_0$ is a finite type $\mathcal{O}_X$-module
and $\mathcal{A}$ is of finite type as an $\mathcal{A}_0$-algebra,
\item $\mathcal{A}_0$ is a finite type $\mathcal{O}_X$-module 
and $\mathcal{A}$ is of finite type as an $\mathcal{O}_X$-algebra.
\end{enumerate}
If these conditions hold, then
$\pi : \underline{\text{Proj}}_X(\mathcal{A}) \to X$
is proper.
\end{lemma}

\begin{proof}
By Morphisms of Spaces, Lemma
\ref{spaces-morphisms-lemma-proper-local}
and the construction of the relative Proj this follows from the
case of schemes which is
Divisors, Lemma \ref{divisors-lemma-relative-proj-universally-closed}.
\end{proof}

\begin{lemma}
\label{lemma-relative-proj-generated-in-degree-1}
Let $S$ be a scheme. Let $X$ be an algebraic space over $S$.
Let $\mathcal{A}$ be a quasi-coherent sheaf of graded $\mathcal{O}_X$-modules
generated as an $\mathcal{A}_0$-algebra by $\mathcal{A}_1$.
With $P = \underline{\text{Proj}}_X(\mathcal{A})$ we have
\begin{enumerate}
\item $P$ represents the functor $F_1$ which associates to
$T$ over $S$ the set of isomorphism classes of
triples $(f, \mathcal{L}, \psi)$, where $f : T \to X$ is a morphism
over $S$, $\mathcal{L}$ is an invertible $\mathcal{O}_T$-module, and
$\psi : f^*\mathcal{A} \to \bigoplus_{n \geq 0} \mathcal{L}^{\otimes n}$
is a map of graded $\mathcal{O}_T$-algebras inducing a surjection
$f^*\mathcal{A}_1 \to \mathcal{L}$,
\item the canonical map $\pi^*\mathcal{A}_1 \to \mathcal{O}_P(1)$ is
surjective, and
\item each $\mathcal{O}_P(n)$ is invertible
and the multiplication maps induce isomorphisms
$\mathcal{O}_P(n) \otimes_{\mathcal{O}_P} \mathcal{O}_P(m) =
\mathcal{O}_P(n + m)$.
\end{enumerate}
\end{lemma}

\begin{proof}
Omitted.
See Constructions, Lemma \ref{constructions-lemma-apply-relative}
for the case of schemes.
\end{proof}







\section{Functoriality of relative proj}
\label{section-functoriality-relative-proj}

\noindent
This section is the analogue of
Constructions, Section \ref{constructions-section-functoriality-relative-proj}.

\begin{lemma}
\label{lemma-morphism-relative-proj}
Let $S$ be a scheme. Let $X$ be an algebraic space over $S$.
Let $\psi : \mathcal{A} \to \mathcal{B}$ be a map of
quasi-coherent graded $\mathcal{O}_X$-algebras. Set
$P = \underline{\text{Proj}}_X(\mathcal{A}) \to X$ and
$Q = \underline{\text{Proj}}_X(\mathcal{B}) \to X$.
There is a canonical open subspace
$U(\psi) \subset Q$ and a canonical morphism of
algebraic spaces
$$
r_\psi :
U(\psi)
\longrightarrow
P
$$
over $X$ and a map of $\mathbf{Z}$-graded $\mathcal{O}_{U(\psi)}$-algebras
$$
\theta = \theta_\psi :
r_\psi^*\left(
\bigoplus\nolimits_{d \in \mathbf{Z}} \mathcal{O}_P(d)
\right)
\longrightarrow
\bigoplus\nolimits_{d \in \mathbf{Z}} \mathcal{O}_{U(\psi)}(d).
$$
The triple $(U(\psi), r_\psi, \theta)$ is characterized by the property
that for any scheme $W$ \'etale over $X$ the triple
$$
(U(\psi) \times_X W,\quad
r_\psi|_{U(\psi) \times_X W} : U(\psi) \times_X W \to  P \times_X W,\quad
\theta|_{U(\psi) \times_X W})
$$
is equal to the triple associated to $\psi : \mathcal{A}|_W \to \mathcal{B}|_W$
of Constructions, Lemma \ref{constructions-lemma-morphism-relative-proj}.
\end{lemma}

\begin{proof}
This lemma follows from \'etale localization and the case of schemes, see
discussion following
Definition \ref{definition-relative-proj}. Details omitted.
\end{proof}

\begin{lemma}
\label{lemma-morphism-relative-proj-transitive}
Let $S$ be a scheme. Let $X$ be an algebraic space over $S$.
Let $\mathcal{A}$, $\mathcal{B}$, and $\mathcal{C}$ be
quasi-coherent graded $\mathcal{O}_X$-algebras.
Set $P = \underline{\text{Proj}}_X(\mathcal{A})$,
$Q = \underline{\text{Proj}}_X(\mathcal{B})$ and
$R = \underline{\text{Proj}}_X(\mathcal{C})$.
Let $\varphi : \mathcal{A} \to \mathcal{B}$,
$\psi : \mathcal{B} \to \mathcal{C}$ be graded $\mathcal{O}_X$-algebra maps.
Then we have
$$
U(\psi \circ \varphi) = r_\varphi^{-1}(U(\psi))
\quad
\text{and}
\quad
r_{\psi \circ \varphi}
=
r_\varphi \circ r_\psi|_{U(\psi \circ \varphi)}.
$$
In addition we have
$$
\theta_\psi \circ r_\psi^*\theta_\varphi
=
\theta_{\psi \circ \varphi}
$$
with obvious notation.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-surjective-graded-rings-map-relative-proj}
With hypotheses and notation as in Lemma \ref{lemma-morphism-relative-proj}
above. Assume $\mathcal{A}_d \to \mathcal{B}_d$ is surjective for
$d \gg 0$. Then
\begin{enumerate}
\item $U(\psi) = Q$,
\item $r_\psi : Q \to R$ is a closed immersion, and
\item the maps $\theta : r_\psi^*\mathcal{O}_P(n) \to \mathcal{O}_Q(n)$
are surjective but not isomorphisms in general (even if
$\mathcal{A} \to \mathcal{B}$ is surjective).
\end{enumerate}
\end{lemma}

\begin{proof}
Follows from the case of schemes
(Constructions, Lemma
\ref{constructions-lemma-surjective-graded-rings-map-relative-proj})
by \'etale localization.
\end{proof}

\begin{lemma}
\label{lemma-eventual-iso-graded-rings-map-relative-proj}
With hypotheses and notation as in Lemma \ref{lemma-morphism-relative-proj}
above. Assume $\mathcal{A}_d \to \mathcal{B}_d$ is an isomorphism for all
$d \gg 0$. Then
\begin{enumerate}
\item $U(\psi) = Q$,
\item $r_\psi : Q \to P$ is an isomorphism, and
\item the maps $\theta : r_\psi^*\mathcal{O}_P(n) \to \mathcal{O}_Q(n)$
are isomorphisms.
\end{enumerate}
\end{lemma}

\begin{proof}
Follows from the case of schemes
(Constructions, Lemma
\ref{constructions-lemma-eventual-iso-graded-rings-map-relative-proj})
by \'etale localization.
\end{proof}

\begin{lemma}
\label{lemma-surjective-generated-degree-1-map-relative-proj}
With hypotheses and notation as in Lemma \ref{lemma-morphism-relative-proj}
above. Assume $\mathcal{A}_d \to \mathcal{B}_d$ is surjective for $d \gg 0$
and that $\mathcal{A}$ is generated by $\mathcal{A}_1$ over $\mathcal{A}_0$.
Then
\begin{enumerate}
\item $U(\psi) = Q$,
\item $r_\psi : Q \to P$ is a closed immersion, and
\item the maps $\theta : r_\psi^*\mathcal{O}_P(n) \to \mathcal{O}_Q(n)$
are isomorphisms.
\end{enumerate}
\end{lemma}

\begin{proof}
Follows from the case of schemes
(Constructions, Lemma
\ref{constructions-lemma-surjective-generated-degree-1-map-relative-proj})
by \'etale localization.
\end{proof}



















\section{Closed subspaces of relative proj}
\label{section-closed-in-relative-proj}

\noindent
Some auxiliary lemmas about closed subspaces of relative proj.
This section is the analogue of
Divisors, Section \ref{divisors-section-closed-in-relative-proj}.

\begin{lemma}
\label{lemma-closed-subscheme-proj}
Let $S$ be a scheme. Let $X$ be an algebraic space over $S$.
Let $\mathcal{A}$ be a quasi-coherent graded $\mathcal{O}_X$-algebra. Let
$\pi : P = \underline{\text{Proj}}_X(\mathcal{A}) \to X$ be the relative
Proj of $\mathcal{A}$. Let $i : Z \to P$ be a closed subspace. Denote
$\mathcal{I} \subset \mathcal{A}$ the kernel of the canonical map
$$
\mathcal{A}
\longrightarrow
\bigoplus\nolimits_{d \geq 0} \pi_*\left((i_*\mathcal{O}_Z)(d)\right)
$$
If $\pi$ is quasi-compact, then there is an isomorphism
$Z = \underline{\text{Proj}}_X(\mathcal{A}/\mathcal{I})$.
\end{lemma}

\begin{proof}
The morphism $\pi$ is separated by
Lemma \ref{lemma-relative-proj-separated}.
As $\pi$ is quasi-compact, $\pi_*$ transforms quasi-coherent modules
into quasi-coherent modules, see
Morphisms of Spaces, Lemma \ref{spaces-morphisms-lemma-pushforward}.
Hence $\mathcal{I}$ is a quasi-coherent $\mathcal{O}_X$-module.
In particular, $\mathcal{B} = \mathcal{A}/\mathcal{I}$ is a
quasi-coherent graded $\mathcal{O}_X$-algebra. The functoriality
morphism $Z' = \underline{\text{Proj}}_X(\mathcal{B}) \to
\underline{\text{Proj}}_X(\mathcal{A})$ is everywhere defined and
a closed immersion, see Lemma
\ref{lemma-surjective-graded-rings-map-relative-proj}.
Hence it suffices to prove $Z = Z'$ as closed subspaces of $P$.

\medskip\noindent
Having said this, the question is \'etale local on the base and we
reduce to the case of schemes
(Divisors, Lemma \ref{divisors-lemma-closed-subscheme-proj})
by \'etale localization.
\end{proof}

\noindent
In case the closed subspace is locally cut out by finitely many
equations we can define it by a finite type ideal sheaf of
$\mathcal{A}$.

\begin{lemma}
\label{lemma-closed-subscheme-proj-finite}
Let $S$ be a scheme. Let $X$ be a quasi-compact and quasi-separated
algebraic space over $S$.
Let $\mathcal{A}$ be a quasi-coherent graded $\mathcal{O}_X$-algebra. Let
$\pi : P = \underline{\text{Proj}}_X(\mathcal{A}) \to X$ be the relative
Proj of $\mathcal{A}$. Let $i : Z \to P$ be a closed subscheme.
If $\pi$ is quasi-compact and $i$ of finite presentation, then there exists
a $d > 0$ and a quasi-coherent finite type $\mathcal{O}_X$-submodule
$\mathcal{F} \subset \mathcal{A}_d$ such that
$Z = \underline{\text{Proj}}_X(\mathcal{A}/\mathcal{F}\mathcal{A})$.
\end{lemma}

\begin{proof}
The reader can redo the arguments used in the case of schemes. However, we
will show the lemma follows from the case of schemes by a trick.
Let $\mathcal{I} \subset \mathcal{A}$ be the quasi-coherent graded
ideal cutting out $Z$ of Lemma \ref{lemma-closed-subscheme-proj}.
Choose an affine scheme $U$ and a surjective \'etale morphism
$U \to X$, see Properties of Spaces, Lemma
\ref{spaces-properties-lemma-quasi-compact-affine-cover}.
By the case of schemes
(Divisors, Lemma \ref{divisors-lemma-closed-subscheme-proj-finite})
there exists a $d > 0$ and a quasi-coherent finite type
$\mathcal{O}_U$-submodule
$\mathcal{F}' \subset \mathcal{I}_d|_U \subset \mathcal{A}_d|_U$
such that $Z \times_X U$ is equal to
$\underline{\text{Proj}}_U(\mathcal{A}|_U/\mathcal{F}'\mathcal{A}|_U)$.
By Limits of Spaces, Lemma
\ref{spaces-limits-lemma-directed-colimit-finite-type}
we can find a finite type quasi-coherent submodule
$\mathcal{F} \subset \mathcal{I}_d$ such that
$\mathcal{F}' \subset \mathcal{F}|_U$. Let
$Z' = \underline{\text{Proj}}_X(\mathcal{A}/\mathcal{F}\mathcal{A})$.
Then $Z' \to P$ is a closed immersion
(Lemma \ref{lemma-surjective-generated-degree-1-map-relative-proj})
and $Z \subset Z'$ as $\mathcal{F}\mathcal{A} \subset \mathcal{I}$.
On the other hand, $Z' \times_X U \subset Z \times_X U$ by our
choice of $\mathcal{F}$. Thus $Z = Z'$ as desired.
\end{proof}

\begin{lemma}
\label{lemma-closed-subscheme-proj-finite-type}
Let $S$ be a scheme. Let $X$ be a quasi-compact and quasi-separated
algebraic space over $S$.
Let $\mathcal{A}$ be a quasi-coherent graded $\mathcal{O}_X$-algebra.
Let $\pi : P = \underline{\text{Proj}}_X(\mathcal{A}) \to X$ be the relative
Proj of $\mathcal{A}$. Let $i : Z \to X$ be a closed subspace.
Let $U \subset X$ be an open. Assume that
\begin{enumerate}
\item $\pi$ is quasi-compact,
\item $i$ of finite presentation,
\item $|U| \cap |\pi|(|i|(|Z|)) = \emptyset$,
\item $U$ is quasi-compact,
\item $\mathcal{A}_n$ is a finite type $\mathcal{O}_X$-module for all $n$.
\end{enumerate}
Then there exists a $d > 0$ and a quasi-coherent finite type
$\mathcal{O}_X$-submodule $\mathcal{F} \subset \mathcal{A}_d$ with (a)
$Z = \underline{\text{Proj}}_X(\mathcal{A}/\mathcal{F}\mathcal{A})$
and (b) the support of $\mathcal{A}_d/\mathcal{F}$ is disjoint from $U$.
\end{lemma}

\begin{proof}
We use the same trick as in the proof of
Lemma \ref{lemma-closed-subscheme-proj-finite}
to reduce to the case of schemes.
Let $\mathcal{I} \subset \mathcal{A}$ be the quasi-coherent graded
ideal cutting out $Z$ of Lemma \ref{lemma-closed-subscheme-proj}.
Choose an affine scheme $W$ and a surjective \'etale morphism
$W \to X$, see Properties of Spaces, Lemma
\ref{spaces-properties-lemma-quasi-compact-affine-cover}.
By the case of schemes
(Divisors, Lemma \ref{divisors-lemma-closed-subscheme-proj-finite-type})
there exists a $d > 0$ and a quasi-coherent finite type
$\mathcal{O}_W$-submodule
$\mathcal{F}' \subset \mathcal{I}_d|_W \subset \mathcal{A}_d|_W$
such that (a) $Z \times_X W$ is equal to
$\underline{\text{Proj}}_W(\mathcal{A}|_W/\mathcal{F}'\mathcal{A}|_W)$
and (b) the support of $\mathcal{A}_d|_W/\mathcal{F}'$ is disjoint from
$U \times_X W$. By Limits of Spaces, Lemma
\ref{spaces-limits-lemma-directed-colimit-finite-type}
we can find a finite type quasi-coherent submodule
$\mathcal{F} \subset \mathcal{I}_d$ such that
$\mathcal{F}' \subset \mathcal{F}|_W$. Let
$Z' = \underline{\text{Proj}}_X(\mathcal{A}/\mathcal{F}\mathcal{A})$.
Then $Z' \to P$ is a closed immersion
(Lemma \ref{lemma-surjective-generated-degree-1-map-relative-proj})
and $Z \subset Z'$ as $\mathcal{F}\mathcal{A} \subset \mathcal{I}$.
On the other hand, $Z' \times_X W \subset Z \times_X W$ by our
choice of $\mathcal{F}$. Thus $Z = Z'$.
Finally, we see that $\mathcal{A}_d/\mathcal{F}$ is supported on
$X \setminus U$ as $\mathcal{A}_d|_W/\mathcal{F}|_W$ is a quotient
of $\mathcal{A}_d|_W/\mathcal{F}'$ which is supported on
$W \setminus U \times_X W$. Thus the lemma follows.
\end{proof}







\section{Blowing up}
\label{section-blowing-up}

\noindent
Blowing up is an important tool in algebraic geometry.

\begin{definition}
\label{definition-blow-up}
Let $S$ be a scheme. Let $X$ be an algebraic space over $S$.
Let $\mathcal{I} \subset \mathcal{O}_X$ be a quasi-coherent sheaf
of ideals, and let $Z \subset X$ be the closed subscheme corresponding
to $\mathcal{I}$
(Morphisms of Spaces, Lemma
\ref{spaces-morphisms-lemma-closed-immersion-ideals}).
The {\it blowing up of $X$ along $Z$}, or the
{\it blowing up of $X$ in the ideal sheaf $\mathcal{I}$} is
the morphism
$$
b :
\underline{\text{Proj}}_X
\left(\bigoplus\nolimits_{n \geq 0} \mathcal{I}^n\right)
\longrightarrow
X
$$
The {\it exceptional divisor} of the blow up is the inverse image
$b^{-1}(Z)$. Sometimes $Z$ is called the {\it center} of the blowup.
\end{definition}

\noindent
We will see later that the exceptional divisor is an effective Cartier
divisor. Moreover, the blowing up is characterized as the ``smallest''
algebraic space over $X$ such that the inverse image of $Z$ is an
effective Cartier divisor.

\medskip\noindent
If $b : X' \to X$ is the blow up of $X$ in $Z$, then we often denote
$\mathcal{O}_{X'}(n)$ the twists of the structure sheaf. Note that these
are invertible $\mathcal{O}_{X'}$-modules and that
$\mathcal{O}_{X'}(n) = \mathcal{O}_{X'}(1)^{\otimes n}$
because $X'$ is the relative Proj of a quasi-coherent graded
$\mathcal{O}_X$-algebra which is generated in degree $1$, see
Lemma \ref{lemma-relative-proj-generated-in-degree-1}.

\begin{lemma}
\label{lemma-blowing-up-affine}
Let $S$ be a scheme. Let $X$ be an algebraic space over $S$.
Let $\mathcal{I} \subset \mathcal{O}_X$ be a
quasi-coherent sheaf of ideals. Let $U = \Spec(A)$ be an affine scheme
\'etale over $X$ and let $I \subset A$ be the ideal corresponding to
$\mathcal{I}|_U$. If $X' \to X$ is the blow up of $X$ in $\mathcal{I}$,
then there is a canonical isomorphism
$$
U \times_X X' = \text{Proj}(\bigoplus\nolimits_{d \geq 0} I^d)
$$
of schemes over $U$, where the right hand side is
the homogeneous spectrum of the Rees algebra of $I$ in $A$.
Moreover, $U \times_X X'$ has an affine open covering by
spectra of the affine blowup algebras $A[\frac{I}{a}]$.
\end{lemma}

\begin{proof}
Note that the restriction $\mathcal{I}|_U$ is equal to the pullback
of $\mathcal{I}$ via the morphism $U \to X$, see
Properties of Spaces, Section \ref{spaces-properties-section-modules}.
Thus the lemma follows on combining Lemma \ref{lemma-relative-proj} with
Divisors, Lemma \ref{divisors-lemma-blowing-up-affine}.
\end{proof}

\begin{lemma}
\label{lemma-flat-base-change-blowing-up}
Let $S$ be a scheme.
Let $X_1 \to X_2$ be a flat morphism of algebraic spaces over $S$.
Let $Z_2 \subset X_2$ be a closed subspace.
Let $Z_1$ be the inverse image of $Z_2$ in $X_1$.
Let $X'_i$ be the blow up of $Z_i$ in $X_i$. Then there exists a cartesian
diagram
$$
\xymatrix{
X_1' \ar[r] \ar[d] & X_2' \ar[d] \\
X_1 \ar[r] & X_2
}
$$
of algebraic spaces over $S$.
\end{lemma}

\begin{proof}
Let $\mathcal{I}_2$ be the ideal sheaf of $Z_2$ in $X_2$.
Denote $g : X_1 \to X_2$ the given morphism. Then the ideal sheaf
$\mathcal{I}_1$ of $Z_1$ is the image of
$g^*\mathcal{I}_2 \to \mathcal{O}_{X_1}$
(see Morphisms of Spaces, Definition
\ref{spaces-morphisms-definition-inverse-image-closed-subspace}
and discussion following the definition).
By Lemma \ref{lemma-relative-proj-base-change}
we see that $X_1 \times_{X_2} X_2'$ is the relative Proj of
$\bigoplus_{n \geq 0} g^*\mathcal{I}_2^n$. Because $g$ is flat the map
$g^*\mathcal{I}_2^n \to \mathcal{O}_{X_1}$ is injective with image
$\mathcal{I}_1^n$. Thus we see that $X_1 \times_{X_2} X_2' = X_1'$.
\end{proof}

\begin{lemma}
\label{lemma-blowing-up-gives-effective-Cartier-divisor}
Let $S$ be a scheme. Let $X$ be an algebraic space over $S$.
Let $Z \subset X$ be a closed subspace.
The blowing up $b : X' \to X$ of $Z$ in $X$
has the following properties:
\begin{enumerate}
\item $b|_{b^{-1}(X \setminus Z)} : b^{-1}(X \setminus Z) \to X \setminus Z$
is an isomorphism,
\item the exceptional divisor $E = b^{-1}(Z)$ is an effective Cartier divisor
on $X'$,
\item there is a canonical isomorphism
$\mathcal{O}_{X'}(-1) = \mathcal{O}_{X'}(E)$
\end{enumerate}
\end{lemma}

\begin{proof}
Let $U$ be a scheme and let $U \to X$ be a surjective \'etale morphism.
As blowing up commutes with flat base change
(Lemma \ref{lemma-flat-base-change-blowing-up})
we can prove each of these statements after base change to $U$.
This reduces us to the case of schemes.
In this case the result is
Divisors, Lemma
\ref{divisors-lemma-blowing-up-gives-effective-Cartier-divisor}.
\end{proof}

\begin{lemma}[Universal property blowing up]
\label{lemma-universal-property-blowing-up}
\begin{slogan}
Blow up a closed subset to make it Cartier.
\end{slogan}
Let $S$ be a scheme.
Let $X$ be an algebraic space over $S$.
Let $Z \subset X$ be a closed subspace.
Let $\mathcal{C}$ be the full subcategory of $(\textit{Spaces}/X)$ consisting
of $Y \to X$ such that the inverse image of $Z$ is an effective
Cartier divisor on $Y$. Then the blowing up $b : X' \to X$ of $Z$ in $X$
is a final object of $\mathcal{C}$.
\end{lemma}

\begin{proof}
We see that $b : X' \to X$ is an object of $\mathcal{C}$ according to
Lemma \ref{lemma-blowing-up-gives-effective-Cartier-divisor}.
Let $f : Y \to X$ be an object of $\mathcal{C}$. We have to show there exists
a unique morphism $Y \to X'$ over $X$. Let $D = f^{-1}(Z)$.
Let $\mathcal{I} \subset \mathcal{O}_X$ be the ideal sheaf of $Z$
and let $\mathcal{I}_D$ be the ideal sheaf of $D$. Then
$f^*\mathcal{I} \to \mathcal{I}_D$ is a surjection
to an invertible $\mathcal{O}_Y$-module. This extends to a map
$\psi : \bigoplus f^*\mathcal{I}^d \to \bigoplus \mathcal{I}_D^d$
of graded $\mathcal{O}_Y$-algebras. (We observe that
$\mathcal{I}_D^d = \mathcal{I}_D^{\otimes d}$ as $D$ is an
effective Cartier divisor.) By
Lemma \ref{lemma-relative-proj-generated-in-degree-1}.
the triple $(f : Y \to X, \mathcal{I}_D, \psi)$ defines a
morphism $Y \to X'$ over $X$. The restriction
$$
Y \setminus D \longrightarrow X' \setminus b^{-1}(Z) = X \setminus Z
$$
is unique. The open $Y \setminus D$ is scheme theoretically dense in $Y$
according to Lemma \ref{lemma-complement-effective-Cartier-divisor}. 
Thus the morphism $Y \to X'$ is unique by
Morphisms of Spaces, Lemma \ref{spaces-morphisms-lemma-equality-of-morphisms}
(also $b$ is separated by Lemma
\ref{lemma-relative-proj-separated}).
\end{proof}

\begin{lemma}
\label{lemma-blow-up-effective-Cartier-divisor}
Let $S$ be a scheme. Let $X$ be an algebraic space over $S$.
Let $Z \subset X$ be an effective Cartier divisor.
The blowup of $X$ in $Z$ is the identity morphism of $X$.
\end{lemma}

\begin{proof}
Immediate from the universal property of blowups
(Lemma \ref{lemma-universal-property-blowing-up}).
\end{proof}

\begin{lemma}
\label{lemma-blow-up-reduced-space}
Let $S$ be a scheme. Let $X$ be an algebraic space over $S$.
Let $\mathcal{I} \subset \mathcal{O}_X$ be a
quasi-coherent sheaf of ideals. If $X$ is reduced, then the
blow up $X'$ of $X$ in $\mathcal{I}$ is reduced.
\end{lemma}

\begin{proof}
Let $U$ be a scheme and let $U \to X$ be a surjective \'etale morphism.
As blowing up commutes with flat base change
(Lemma \ref{lemma-flat-base-change-blowing-up})
we can prove each of these statements after base change to $U$.
This reduces us to the case of schemes.
In this case the result is
Divisors, Lemma \ref{divisors-lemma-blow-up-reduced-scheme}.
\end{proof}

\begin{lemma}
\label{lemma-blow-up-pullback-effective-Cartier}
Let $S$ be a scheme. Let $X$ be an algebraic space over $S$.
Let $b : X' \to X$ be a blow up of $X$ in a closed subspace.
For any effective Cartier divisor $D$ on $X$ the pullback
$b^{-1}D$ is defined (see Definition
\ref{definition-pullback-effective-Cartier-divisor}).
\end{lemma}

\begin{proof}
By Lemmas \ref{lemma-blowing-up-affine} and
\ref{lemma-characterize-effective-Cartier-divisor}
this reduces to the following algebra fact:
Let $A$ be a ring, $I \subset A$ an ideal, $a \in I$, and $x \in A$
a nonzerodivisor. Then the image of $x$ in $A[\frac{I}{a}]$ is a
nonzerodivisor. Namely, suppose that $x (y/a^n) = 0$ in $A[\frac{I}{a}]$.
Then $a^mxy = 0$ in $A$ for some $m$. Hence $a^my = 0$ as $x$ is a
nonzerodivisor. Whence $y/a^n$ is zero in $A[\frac{I}{a}]$ as desired.
\end{proof}

\begin{lemma}
\label{lemma-blowing-up-two-ideals}
Let $S$ be a scheme. Let $X$ be an algebraic space over $S$.
Let $\mathcal{I} \subset \mathcal{O}_X$ and $\mathcal{J}$ be
quasi-coherent sheaves of ideals. Let $b : X' \to X$ be the blowing up
of $X$ in $\mathcal{I}$. Let $b' : X'' \to X'$ be the blowing up of
$X'$ in $b^{-1}\mathcal{J} \mathcal{O}_{X'}$. Then $X'' \to X$
is canonically isomorphic to the blowing up of $X$ in $\mathcal{I}\mathcal{J}$.
\end{lemma}

\begin{proof}
Let $E \subset X'$ be the exceptional divisor of $b$ which is an effective
Cartier divisor by
Lemma \ref{lemma-blowing-up-gives-effective-Cartier-divisor}.
Then $(b')^{-1}E$ is an effective Cartier divisor on $X''$ by
Lemma \ref{lemma-blow-up-pullback-effective-Cartier}.
Let $E' \subset X''$ be the exceptional divisor of $b'$ (also an effective
Cartier divisor). Consider the effective Cartier divisor
$E'' = E' + (b')^{-1}E$. By construction the ideal of $E''$ is
$(b \circ b')^{-1}\mathcal{I} (b \circ b')^{-1}\mathcal{J} \mathcal{O}_{X''}$.
Hence according to Lemma \ref{lemma-universal-property-blowing-up}
there is a canonical morphism from $X''$ to the blowup $c : Y \to X$
of $X$ in $\mathcal{I}\mathcal{J}$. Conversely, as $\mathcal{I}\mathcal{J}$
pulls back to an invertible ideal we see that
$c^{-1}\mathcal{I}\mathcal{O}_Y$ defines
an effective Cartier divisor, see
Lemma \ref{lemma-sum-closed-subschemes-effective-Cartier}.
Thus a morphism $c' : Y \to X'$ over $X$ by
Lemma \ref{lemma-universal-property-blowing-up}.
Then $(c')^{-1}b^{-1}\mathcal{J}\mathcal{O}_Y = c^{-1}\mathcal{J}\mathcal{O}_Y$
which also defines an effective Cartier divisor. Thus a morphism
$c'' : Y \to X''$ over $X'$. We omit the verification that this
morphism is inverse to the morphism $X'' \to Y$ constructed earlier.
\end{proof}

\begin{lemma}
\label{lemma-blowing-up-projective}
Let $S$ be a scheme. Let $X$ be an algebraic space over $S$.
Let $\mathcal{I} \subset \mathcal{O}_X$ be a quasi-coherent
sheaf of ideals. Let $b : X' \to X$ be the blowing up of $X$
in the ideal sheaf $\mathcal{I}$. If $\mathcal{I}$ is of finite type, then
$b : X' \to X$ is a proper morphism.
\end{lemma}

\begin{proof}
Let $U$ be a scheme and let $U \to X$ be a surjective \'etale morphism.
As blowing up commutes with flat base change
(Lemma \ref{lemma-flat-base-change-blowing-up})
we can prove each of these statements after base change to $U$
(see Morphisms of Spaces, Lemma
\ref{spaces-morphisms-lemma-proper-local}).
This reduces us to the case of schemes.
In this case the morphism $b$ is projective by
Divisors, Lemma \ref{divisors-lemma-blowing-up-projective}
hence proper by
Morphisms, Lemma \ref{morphisms-lemma-locally-projective-proper}.
\end{proof}

\begin{lemma}
\label{lemma-composition-finite-type-blowups}
Let $S$ be a scheme and let $X$ be an algebraic space over $S$.
Assume $X$ is quasi-compact and quasi-separated.
Let $Z \subset X$ be a closed subspace of finite presentation.
Let $b : X' \to X$ be the blowing up with center $Z$.
Let $Z' \subset X'$ be a closed subspace of finite presentation.
Let $X'' \to X'$ be the blowing up with center $Z'$.
There exists a closed subspace $Y \subset X$ of finite presentation,
such that
\begin{enumerate}
\item $|Y| = |Z| \cup |b|(|Z'|)$, and
\item the composition $X'' \to X$ is isomorphic to the blowing up
of $X$ in $Y$.
\end{enumerate}
\end{lemma}

\begin{proof}
The condition that $Z \to X$ is of finite presentation means that
$Z$ is cut out by a finite type quasi-coherent sheaf of ideals
$\mathcal{I} \subset \mathcal{O}_X$, see
Morphisms of Spaces, Lemma
\ref{spaces-morphisms-lemma-closed-immersion-finite-presentation}.
Write $\mathcal{A} = \bigoplus_{n \geq 0} \mathcal{I}^n$ so that
$X' = \underline{\text{Proj}}(\mathcal{A})$.
Note that $X \setminus Z$ is a quasi-compact open subspace of $X$ by
Limits of Spaces, Lemma
\ref{spaces-limits-lemma-quasi-coherent-finite-type-ideals}.
Since $b^{-1}(X \setminus Z) \to X \setminus Z$ is an isomorphism
(Lemma \ref{lemma-blowing-up-gives-effective-Cartier-divisor}) the same
result shows that
$b^{-1}(X \setminus Z) \setminus Z'$ is quasi-compact open subspace in $X'$.
Hence $U = X \setminus (Z \cup b(Z'))$ is quasi-compact open subspace in $X$.
By Lemma \ref{lemma-closed-subscheme-proj-finite-type}
there exist a $d > 0$ and a finite type
$\mathcal{O}_X$-submodule $\mathcal{F} \subset \mathcal{I}^d$ such
that $Z' = \underline{\text{Proj}}(\mathcal{A}/\mathcal{F}\mathcal{A})$
and such that the support of $\mathcal{I}^d/\mathcal{F}$ is contained
in $X \setminus U$.

\medskip\noindent
Since $\mathcal{F} \subset \mathcal{I}^d$ is an $\mathcal{O}_X$-submodule
we may think of $\mathcal{F} \subset \mathcal{I}^d \subset \mathcal{O}_X$
as a finite type quasi-coherent sheaf of ideals on $X$. Let's denote this
$\mathcal{J} \subset \mathcal{O}_X$ to prevent confusion. Since
$\mathcal{I}^d / \mathcal{J}$ and $\mathcal{O}/\mathcal{I}^d$ are
supported on $|X| \setminus |U|$ we see that $|V(\mathcal{J})|$ is contained
in $|X| \setminus |U|$. Conversely, as $\mathcal{J} \subset \mathcal{I}^d$
we see that $|Z| \subset |V(\mathcal{J})|$. Over
$X \setminus Z \cong X' \setminus b^{-1}(Z)$ the sheaf of ideals
$\mathcal{J}$ cuts out $Z'$ (see displayed formula below). Hence
$|V(\mathcal{J})|$ equals $|Z| \cup |b|(|Z'|)$. It follows that also
$|V(\mathcal{I}\mathcal{J})| = |Z| \cup |b|(|Z'|)$. Moreover,
$\mathcal{I}\mathcal{J}$ is an ideal of finite type as a product of two such.
We claim that $X'' \to X$ is isomorphic to the blowing up of $X$ in
$\mathcal{I}\mathcal{J}$ which finishes the proof of the lemma by setting
$Y = V(\mathcal{I}\mathcal{J})$.

\medskip\noindent
First, recall that the blow up of $X$ in $\mathcal{I}\mathcal{J}$
is the same as the blow up of $X'$ in $b^{-1}\mathcal{J} \mathcal{O}_{X'}$,
see Lemma \ref{lemma-blowing-up-two-ideals}.
Hence it suffices to show that the blow up of $X'$ in
$b^{-1}\mathcal{J} \mathcal{O}_{X'}$ agrees with the blow up of $X'$
in $Z'$. We will show that
$$
b^{-1}\mathcal{J} \mathcal{O}_{X'} = \mathcal{I}_E^d \mathcal{I}_{Z'}
$$
as ideal sheaves on $X''$. This will prove what we want as
$\mathcal{I}_E^d$ cuts out the effective Cartier divisor $dE$
and we can use Lemmas \ref{lemma-blow-up-effective-Cartier-divisor} and
\ref{lemma-blowing-up-two-ideals}.

\medskip\noindent
To see the displayed equality of the ideals we may work locally.
With notation $A$, $I$, $a \in I$ as in Lemma \ref{lemma-blowing-up-affine}
we see that $\mathcal{F}$ corresponds to an $R$-submodule $M \subset I^d$
mapping isomorphically to an ideal $J \subset R$. The condition
$Z' = \underline{\text{Proj}}(\mathcal{A}/\mathcal{F}\mathcal{A})$
means that $Z' \cap \Spec(A[\frac{I}{a}])$ is cut out by the ideal
generated by the elements $m/a^d$, $m \in M$. Say the element $m \in M$
corresponds to the function $f \in J$. Then in the affine blowup algebra
$A' = A[\frac{I}{a}]$ we see that $f = (a^dm)/a^d = a^d (m/a^d)$.
Thus the equality holds.
\end{proof}









\section{Strict transform}
\label{section-strict-transform}

\noindent
This section is the analogue of
Divisors, Section \ref{divisors-section-strict-transform}.
Let $S$ be a scheme, let $B$ be an algebraic space over $S$, and
let $Z \subset B$ be a closed subspace.
Let $b : B' \to B$ be the blowing up of $B$ in $Z$ and denote $E \subset B'$
the exceptional divisor $E = b^{-1}Z$. In the following we will often
consider an algebraic space $X$ over $B$ and form the cartesian diagram
$$
\xymatrix{
\text{pr}_{B'}^{-1}E \ar[r] \ar[d] &
X \times_B B' \ar[r]_-{\text{pr}_X} \ar[d]_{\text{pr}_{B'}} &
X \ar[d]^f \\
E \ar[r] & B' \ar[r] & B
}
$$
Since $E$ is an effective Cartier divisor
(Lemma \ref{lemma-blowing-up-gives-effective-Cartier-divisor})
we see that $\text{pr}_{B'}^{-1}E \subset X \times_B B'$
is locally principal
(Lemma \ref{lemma-pullback-locally-principal}).
Thus the inclusion morphism of the complement of
$\text{pr}_{B'}^{-1}E$ in $X \times_B B'$
is affine and in particular quasi-compact
(Lemma \ref{lemma-complement-locally-principal-closed-subscheme}).
Consequently, for a quasi-coherent $\mathcal{O}_{X \times_B B'}$-module
$\mathcal{G}$ the subsheaf of sections supported on $|\text{pr}_{B'}^{-1}E|$
is a quasi-coherent submodule, see
Limits of Spaces, Lemma
\ref{spaces-limits-lemma-sections-supported-on-closed-subset}.
If $\mathcal{G}$ is a quasi-coherent sheaf of algebras, e.g.,
$\mathcal{G} = \mathcal{O}_{X \times_B B'}$, then this subsheaf is an ideal
of $\mathcal{G}$.

\begin{definition}
\label{definition-strict-transform}
With $Z \subset B$ and $f : X \to B$ as above.
\begin{enumerate}
\item Given a quasi-coherent $\mathcal{O}_X$-module $\mathcal{F}$
the {\it strict transform} of $\mathcal{F}$ with respect to the blowup
of $B$ in $Z$ is the quotient $\mathcal{F}'$ of $\text{pr}_X^*\mathcal{F}$
by the submodule of sections supported on $|\text{pr}_{B'}^{-1}E|$.
\item The {\it strict transform} of $X$ is the closed subscheme
$X' \subset X \times_B B'$ cut out by the quasi-coherent ideal of
sections of $\mathcal{O}_{X \times_B B'}$ supported on
$|\text{pr}_{B'}^{-1}E|$.
\end{enumerate}
\end{definition}

\noindent
Note that taking the strict transform along a blowup depends on the
closed subspace used for the blowup
(and not just on the morphism $B' \to B$).

\begin{lemma}[\'Etale localization and strict transform]
\label{lemma-strict-transform-local}
In the situation of Definition \ref{definition-strict-transform}.
Let
$$
\xymatrix{
U \ar[r] \ar[d] & X \ar[d] \\
V \ar[r] & B
}
$$
be a commutative diagram of morphisms with $U$ and $V$ schemes and
\'etale horizontal arrows. Let $V' \to V$ be the blowup of $V$
in $Z \times_B V$. Then
\begin{enumerate}
\item $V' = V \times_B B'$ and the maps
$V' \to B'$ and $U \times_V V' \to X \times_B B'$ are \'etale,
\item the strict transform $U'$ of $U$ relative to $V' \to V$
is equal to $X' \times_X U$ where $X'$ is the strict transform of $X$
relative to $B' \to B$, and
\item for a quasi-coherent $\mathcal{O}_X$-module $\mathcal{F}$ the
restriction of the strict transform $\mathcal{F}'$ to
$U \times_V V'$ is the strict transform of $\mathcal{F}|_U$ relative
to $V' \to V$.
\end{enumerate}
\end{lemma}

\begin{proof}
Part (1) follows from the fact that blowup commutes with flat base
change (Lemma \ref{lemma-flat-base-change-blowing-up}), the fact that
\'etale morphisms are flat, and that the base change of an \'etale
morphism is \'etale. Part (3) then follows from the fact that taking
the sheaf of sections supported on a closed commutes with pullback
by \'etale morphisms, see Limits of Spaces, Lemma
\ref{spaces-limits-lemma-sections-supported-on-closed-subset}.
Part (2) follows from (3) applied to $\mathcal{F} = \mathcal{O}_X$.
\end{proof}

\begin{lemma}
\label{lemma-strict-transform}
In the situation of Definition \ref{definition-strict-transform}.
\begin{enumerate}
\item The strict transform $X'$ of $X$ is the blowup of $X$ in the closed
subspace $f^{-1}Z$ of $X$.
\item For a quasi-coherent $\mathcal{O}_X$-module $\mathcal{F}$ the
strict transform $\mathcal{F}'$ is canonically isomorphic to
the pushforward along $X' \to X \times_B B'$ of the strict transform of
$\mathcal{F}$ relative to the blowing up $X' \to X$.
\end{enumerate}
\end{lemma}

\begin{proof}
Let $X'' \to X$ be the blowup of $X$ in $f^{-1}Z$. By the universal
property of blowing up (Lemma \ref{lemma-universal-property-blowing-up})
there exists a commutative diagram
$$
\xymatrix{
X'' \ar[r] \ar[d] & X \ar[d] \\
B' \ar[r] & B
}
$$
whence a morphism $i : X'' \to X \times_B B'$. The first assertion
of the lemma is that $i$ is a closed immersion with image $X'$.
The second assertion of the lemma is that $\mathcal{F}' = i_*\mathcal{F}''$
where $\mathcal{F}''$ is the strict transform of $\mathcal{F}$ with
respect to the blowing up $X'' \to X$. We can check these assertions
\'etale locally on $X$, hence we reduce to the case of schemes
(Divisors, Lemma \ref{divisors-lemma-strict-transform}).
Some details omitted.
\end{proof}

\begin{lemma}
\label{lemma-strict-transform-flat}
In the situation of Definition \ref{definition-strict-transform}.
\begin{enumerate}
\item If $X$ is flat over $B$ at all points lying over $Z$, then
the strict transform of $X$ is equal to the base change $X \times_B B'$.
\item Let $\mathcal{F}$ be a quasi-coherent $\mathcal{O}_X$-module.
If $\mathcal{F}$ is flat over $B$ at all points lying over $Z$, then
the strict transform $\mathcal{F}'$ of $\mathcal{F}$ is equal to the
pullback $\text{pr}_X^*\mathcal{F}$.
\end{enumerate}
\end{lemma}

\begin{proof}
Omitted. Hint: Follows from the case of schemes
(Divisors, Lemma \ref{divisors-lemma-strict-transform-flat})
by \'etale localization
(Lemma \ref{lemma-strict-transform-local}).
\end{proof}

\begin{lemma}
\label{lemma-strict-transform-affine}
Let $S$ be a scheme. Let $B$ be an algebraic space over $S$.
Let $Z \subset B$ be a closed subspace.
Let $b : B' \to B$ be the blowing up of $Z$ in $B$. Let
$g : X \to Y$ be an affine morphism of spaces over $B$.
Let $\mathcal{F}$ be a quasi-coherent sheaf on $X$.
Let $g' : X \times_B B' \to Y \times_B B'$ be the base change
of $g$. Let $\mathcal{F}'$ be the strict transform of $\mathcal{F}$
relative to $b$. Then $g'_*\mathcal{F}'$ is the strict transform
of $g_*\mathcal{F}$.
\end{lemma}

\begin{proof}
Omitted. Hint: Follows from the case of schemes
(Divisors, Lemma \ref{divisors-lemma-strict-transform-affine})
by \'etale localization (Lemma \ref{lemma-strict-transform-local}).
\end{proof}

\begin{lemma}
\label{lemma-strict-transform-different-centers}
Let $S$ be a scheme. Let $B$ be an algebraic space over $S$.
Let $Z \subset B$ be a closed subspace.
Let $D \subset B$ be an effective Cartier divisor.
Let $Z' \subset B$ be the closed subspace cut out by the product
of the ideal sheaves of $Z$ and $D$.
Let $B' \to B$ be the blowup of $B$ in $Z$.
\begin{enumerate}
\item The blowup of $B$ in $Z'$ is isomorphic to $B' \to B$.
\item Let $f : X \to B$ be a morphism of algebraic spaces and let $\mathcal{F}$
be a quasi-coherent $\mathcal{O}_X$-module. If the subsheaf of $\mathcal{F}$ of
sections supported on $|f^{-1}D|$ is zero, then the
strict transform of $\mathcal{F}$ relative to the blowing up
in $Z$ agrees with the strict transform of $\mathcal{F}$ relative
to the blowing up of $B$ in $Z'$.
\end{enumerate}
\end{lemma}

\begin{proof}
Omitted. Hint: Follows from the case of schemes
(Divisors, Lemma \ref{divisors-lemma-strict-transform-different-centers})
by \'etale localization (Lemma \ref{lemma-strict-transform-local}).
\end{proof}

\begin{lemma}
\label{lemma-strict-transform-composition-blowups}
Let $S$ be a scheme. Let $B$ be an algebraic space over $S$.
Let $Z \subset B$ be a closed subspace.
Let $b : B' \to B$ be the blowing up with center $Z$.
Let $Z' \subset B'$ be a closed subspace.
Let $B'' \to B'$ be the blowing up with center $Z'$.
Let $Y \subset B$ be a closed subscheme such that
$|Y| = |Z| \cup |b|(|Z'|)$ and the composition $B'' \to B$
is isomorphic to the blowing up of $B$ in $Y$.
In this situation, given any scheme $X$ over $B$ and
$\mathcal{F} \in \QCoh(\mathcal{O}_X)$ we have
\begin{enumerate}
\item the strict transform of $\mathcal{F}$ with respect to the blowing
up of $B$ in $Y$ is equal to the strict transform with respect to the
blowup $B'' \to B'$ in $Z'$ of the strict transform of $\mathcal{F}$
with respect to the blowup $B' \to B$ of $B$ in $Z$, and
\item the strict transform of $X$ with respect to the blowing
up of $B$ in $Y$ is equal to the strict transform with respect to the
blowup $B'' \to B'$ in $Z'$ of the strict transform of $X$
with respect to the blowup $B' \to B$ of $B$ in $Z$.
\end{enumerate}
\end{lemma}

\begin{proof}
Omitted. Hint: Follows from the case of schemes
(Divisors, Lemma \ref{divisors-lemma-strict-transform-composition-blowups})
by \'etale localization (Lemma \ref{lemma-strict-transform-local}).
\end{proof}

\begin{lemma}
\label{lemma-strict-transform-universally-injective}
In the situation of Definition \ref{definition-strict-transform}.
Suppose that
$$
0 \to \mathcal{F}_1 \to \mathcal{F}_2 \to \mathcal{F}_3 \to 0
$$
is an exact sequence of quasi-coherent sheaves on $X$ which remains
exact after any base change $T \to B$. Then the strict transforms of
$\mathcal{F}_i'$ relative to any blowup $B' \to B$
form a short exact sequence
$0 \to \mathcal{F}'_1 \to \mathcal{F}'_2 \to \mathcal{F}'_3 \to 0$ too.
\end{lemma}

\begin{proof}
Omitted. Hint: Follows from the case of schemes
(Divisors, Lemma \ref{divisors-lemma-strict-transform-universally-injective})
by \'etale localization (Lemma \ref{lemma-strict-transform-local}).
\end{proof}












\section{Admissible blowups}
\label{section-admissible-blowups}

\noindent
To have a bit more control over our blowups we introduce the following
standard terminology.

\begin{definition}
\label{definition-admissible-blowup}
Let $S$ be a scheme. Let $X$ be an algebraic space over $S$.
Let $U \subset X$ be an open subspace. A morphism
$X' \to X$ is called a {\it $U$-admissible blowup} if there exists a
closed immersion $Z \to X$ of finite presentation with $Z$ disjoint from
$U$ such that $X'$ is isomorphic to the blow up of $X$ in $Z$.
\end{definition}

\noindent
We recall that $Z \to X$ is of finite presentation if and only if the
ideal sheaf $\mathcal{I}_Z \subset \mathcal{O}_X$ is of finite type, see
Morphisms of Spaces, Lemma
\ref{spaces-morphisms-lemma-closed-immersion-finite-presentation}.
In particular, a $U$-admissible blowup is a proper morphism, see
Lemma \ref{lemma-blowing-up-projective}.
Note that there can be multiple centers which give rise to the same morphism.
Hence the requirement is just the existence of some center disjoint from
$U$ which produces $X'$.
Finally, as the morphism $b : X' \to X$ is an isomorphism over $U$ (see
Lemma \ref{lemma-blowing-up-gives-effective-Cartier-divisor}) we will often
abuse notation and think of $U$ as an open subspace of $X'$ as well.

\begin{lemma}
\label{lemma-composition-admissible-blowups}
Let $S$ be a scheme.
Let $X$ be a quasi-compact and quasi-separated algebraic space over $S$.
Let $U \subset X$ be a quasi-compact open subspace.
Let $b : X' \to X$ be a $U$-admissible blowup.
Let $X'' \to X'$ be a $U$-admissible blowup.
Then the composition $X'' \to X$ is a $U$-admissible blowup.
\end{lemma}

\begin{proof}
Immediate from the more precise
Lemma \ref{lemma-composition-finite-type-blowups}.
\end{proof}

\begin{lemma}
\label{lemma-extend-admissible-blowups}
Let $S$ be a scheme.
Let $X$ be a quasi-compact and quasi-separated algebraic space.
Let $U, V \subset X$ be quasi-compact open subspaces.
Let $b : V' \to V$ be a $U \cap V$-admissible blowup.
Then there exists a $U$-admissible blowup $X' \to X$
whose restriction to $V$ is $V'$.
\end{lemma}

\begin{proof}
Let $\mathcal{I} \subset \mathcal{O}_V$ be the finite type
quasi-coherent sheaf of ideals such that $V(\mathcal{I})$ is
disjoint from $U \cap V$ and such that $V'$ is isomorphic to the
blow up of $V$ in $\mathcal{I}$. Let
$\mathcal{I}' \subset \mathcal{O}_{U \cup V}$ be the quasi-coherent
sheaf of ideals whose restriction to $U$ is $\mathcal{O}_U$ and
whose restriction to $V$ is $\mathcal{I}$.
By Limits of Spaces, Lemma \ref{spaces-limits-lemma-extend}
there exists a finite type quasi-coherent sheaf of ideals
$\mathcal{J} \subset \mathcal{O}_X$ whose restriction to $U \cup V$ is
$\mathcal{I}'$. The lemma follows.
\end{proof}

\begin{lemma}
\label{lemma-dominate-admissible-blowups}
Let $S$ be a scheme.
Let $X$ be a quasi-compact and quasi-separated algebraic space over $S$.
Let $U \subset X$ be a quasi-compact open subspace.
Let $b_i : X_i \to X$, $i = 1, \ldots, n$ be $U$-admissible blowups.
There exists a $U$-admissible blowup $b : X' \to X$ such that
(a) $b$ factors as $X' \to X_i \to X$ for $i = 1, \ldots, n$ and
(b) each of the morphisms $X' \to X_i$ is a $U$-admissible blowup.
\end{lemma}

\begin{proof}
Let $\mathcal{I}_i \subset \mathcal{O}_X$ be the finite type
quasi-coherent sheaf of ideals such that $V(\mathcal{I}_i)$ is
disjoint from $U$ and such that $X_i$ is isomorphic to the
blow up of $X$ in $\mathcal{I}_i$. Set
$\mathcal{I} = \mathcal{I}_1 \cdot \ldots \cdot \mathcal{I}_n$
and let $X'$ be the blowup of $X$ in $\mathcal{I}$. Then
$X' \to X$ factors through $b_i$ by Lemma \ref{lemma-blowing-up-two-ideals}.
\end{proof}

\begin{lemma}
\label{lemma-separate-disjoint-opens-by-blowing-up}
Let $S$ be a scheme.
Let $X$ be a quasi-compact and quasi-separated algebraic space over $S$.
Let $U, V$ be quasi-compact disjoint open subspaces of $X$.
Then there exist a $U \cup V$-admissible blowup $b : X' \to X$
such that $X'$ is a disjoint union of open subspaces
$X' = X'_1 \amalg X'_2$ with $b^{-1}(U) \subset X'_1$ and
$b^{-1}(V) \subset X'_2$.
\end{lemma}

\begin{proof}
Choose a finite type quasi-coherent sheaf of ideals $\mathcal{I}$,
resp.\ $\mathcal{J}$ such that $X \setminus U = V(\mathcal{I})$,
resp.\ $X \setminus V = V(\mathcal{J})$, see
Limits of Spaces, Lemma
\ref{spaces-limits-lemma-quasi-coherent-finite-type-ideals}.
Then $|V(\mathcal{I}\mathcal{J})| = |X|$. Hence
$\mathcal{I}\mathcal{J}$ is a locally nilpotent sheaf of ideals.
Since $\mathcal{I}$ and $\mathcal{J}$ are of finite type and $X$
is quasi-compact there exists an $n > 0$ such that
$\mathcal{I}^n \mathcal{J}^n = 0$. We may and do replace $\mathcal{I}$
by $\mathcal{I}^n$ and $\mathcal{J}$ by $\mathcal{J}^n$. Whence
$\mathcal{I} \mathcal{J} = 0$. Let $b : X' \to X$ be the blowing
up in $\mathcal{I} + \mathcal{J}$. This is $U \cup V$-admissible
as $|V(\mathcal{I} + \mathcal{J})| = |X| \setminus |U| \cup |V|$.
We will show that $X'$ is a disjoint union of open subspaces
$X' = X'_1 \amalg X'_2$ as in the statement of the lemma.

\medskip\noindent
Since $|V(\mathcal{I} + \mathcal{J})|$ is the complement of
$|U \cup V|$ we conclude that $V \cup U$ is scheme theoretically
dense in $X'$, see
Lemmas \ref{lemma-blowing-up-gives-effective-Cartier-divisor} and
\ref{lemma-complement-effective-Cartier-divisor}.
Thus if such a decomposition $X' = X'_1 \amalg X'_2$
into open and closed subspaces exists, then $X'_1$ is the
scheme theoretic closure of $U$ in $X'$ and similarly $X'_2$ is
the scheme theoretic closure of $V$ in $X'$. Since $U \to X'$
and $V \to X'$ are quasi-compact taking scheme theoretic
closures commutes with \'etale localization (Morphisms of Spaces,
Lemma \ref{spaces-morphisms-lemma-quasi-compact-scheme-theoretic-image}).
Hence to verify the existence of $X'_1$ and $X'_2$ we may work \'etale
locally on $X$. This reduces us to the case of schemes which is
treated in the proof of Divisors, Lemma
\ref{divisors-lemma-separate-disjoint-opens-by-blowing-up}.
\end{proof}




















\input{chapters}

\bibliography{my}
\bibliographystyle{amsalpha}

\end{document}
