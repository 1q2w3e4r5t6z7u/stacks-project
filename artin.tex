\input{preamble}

% OK, start here.
%
\begin{document}

\title{Artin's axioms}

\maketitle

\phantomsection
\label{section-phantom}

\tableofcontents




\section{Introduction}
\label{section-introduction}

\noindent
In this chapter we discuss Artin's axioms for the representability of
functors by algebraic spaces. As references we suggest the papers
\cite{ArtinI}, \cite{ArtinII}, \cite{ArtinVersal}.

\medskip\noindent
We have intentionally placed this chapter, as well as the chapters
``Criteria for Representability'' and ``Sheaves on Stacks'', before the
general development of the theory of algebraic stacks. The reason
for this is that starting with the next chapter (see
Properties of Stacks, Section \ref{stacks-properties-section-conventions})
we will no longer distinguish between a scheme and the algebraic stack
it gives rise to. Thus our language will become more flexible and
easier for a human to parse, but also less precise. These first few
chapters, including the initial chapter ``Algebraic Stacks'', lay the
groundwork that later allow us to ignore some of the very technical
distinctions between different ways of thinking about algebraic stacks.
In this chapter and ``Criteria of Representability'' especially we need
to be very precise about what objects exactly we are working with, as
we are trying to show that certain constructions produce algebraic stacks or
algebraic spaces.

\medskip\noindent
Unfortunately, this means that some of the notation, conventions and
terminology is awkward and may seem backwards to the more experienced
reader. We hope the reader will forgive us!







\section{Conventions}
\label{section-conventions}

\noindent
The conventions we use in this chapter are the same as those in the
chapter on algebraic stacks, see
Algebraic Stacks, Section \ref{algebraic-section-conventions}.
In this chapter the base scheme $S$ will often be locally Noetherian
(although we will always reiterate this condition when stating
results).





\section{Predeformation categories}
\label{section-predeformation-categories}

\noindent
Let $S$ be a locally Noetherian base scheme. Let
$$
p : \mathcal{X} \longrightarrow (\textit{Sch}/S)_{fppf}
$$
be a category fibred in groupoids. Let $k$ be a field
and let $\Spec(k) \to S$ be a morphism of finite type (see
Morphisms, Lemma \ref{morphisms-lemma-point-finite-type}). We will sometimes
simply say that {\it $k$ is a field of finite type over $S$}. Let
$x_0$ be an object of $\mathcal{X}$ lying over $\Spec(k)$.
Given $S$, $\mathcal{X}$, $k$, and $x_0$ we will construct a
predeformation category, as defined in 
Formal Deformation Theory,
Definition \ref{formal-defos-definition-predeformation-category}.
The construction will resemble to construction of
Formal Deformation Theory,
Remark \ref{formal-defos-remark-localize-cofibered-groupoid}.

\medskip\noindent
First, by Morphisms, Lemma \ref{morphisms-lemma-point-finite-type}
we may pick an affine open $\Spec(\Lambda) \subset S$ such that
$\Spec(k) \to S$ factors through $\Spec(\Lambda)$ and the associated
ring map $\Lambda \to k$ is finite. This provides us with the category
$\mathcal{C}_\Lambda$, see
Formal Deformation Theory, Definition \ref{formal-defos-definition-CLambda}.
The category $\mathcal{C}_\Lambda$, up to canonical equivalence,
does not depend on the choice of the affine open $\Spec(\Lambda)$ of $S$.
Namely, $\mathcal{C}_\Lambda$ is equivalent to the opposite
of the category of factorizations
\begin{equation}
\label{equation-factor}
\Spec(k) \to \Spec(A) \to S
\end{equation}
of the structure morphism such that $A$ is an Artinian local ring and
such that $\Spec(k) \to \Spec(A)$ corresponds to a ring map $A \to k$ which
identifies $k$ with the resisue field of $A$.

\medskip\noindent
We let $\mathcal{F} = \mathcal{F}_{\mathcal{X}, k, x_0}$ be the
category whose
\begin{enumerate}
\item objects are morphisms $x_0 \to x$ of $\mathcal{X}$ where
$p(x) = \Spec(A)$ with $A$ an Artinian local ring and
$p(x_0) \to p(x) \to S$ a factorization as in (\ref{equation-factor}), and
\item morphisms $(x_0 \to x) \to (x_0 \to x')$ are commutative
diagrams
$$
\xymatrix{
x & & x' \ar[ll] \\
& x_0 \ar[lu] \ar[ru]
}
$$
in $\mathcal{X}$. (Note the reversal of arrows.)
\end{enumerate}
If $x_0 \to x$ is an object of $\mathcal{F}$ then writing $p(x) = \Spec(A)$
we obtain an object $A$ of $\mathcal{C}_\Lambda$. We often say that
$x_0 \to x$ or $x$ lies over $A$. A morphism of $\mathcal{F}$ between objects
$x_0 \to x$ lying over $A$ and $x_0 \to x'$ lying over $A'$
corresponds to a morphism $x' \to x$ of $\mathcal{X}$, hence a morphism
$p(x' \to x) : \Spec(A') \to \Spec(A)$ which in turn corresponds to a
ring map $A \to A'$. As $\mathcal{X}$ is a category
over the category of schemes over $S$ we see that $A \to A'$ is
$\Lambda$-algebra homomorphism. Thus we obtain a functor
\begin{equation}
\label{equation-predeformation-category}
p : \mathcal{F} = \mathcal{F}_{\mathcal{X}, k, x_0}
\longrightarrow
\mathcal{C}_\Lambda.
\end{equation}
We will use the notation $\mathcal{F}(A)$ to denote the fibre category
over an object $A$ of $\mathcal{C}_\Lambda$. An object of $\mathcal{F}(A)$
is simply a morphism $x_0 \to x$ of $\mathcal{X}$ such that
$x$ lies over $\Spec(A)$ and $x_0 \to x$ lies over $\Spec(k) \to \Spec(A)$.

\begin{lemma}
\label{lemma-predeformation-category}
The functor $p : \mathcal{F} \to \mathcal{C}_\Lambda$ defined above
is a predeformation category.
\end{lemma}

\begin{proof}
We have to show that $\mathcal{F}$ is (a) cofibred in groupoids over
$\mathcal{C}_\Lambda$ and (b) that $\mathcal{F}(k)$ is a category equivalent
to a category with a single object and a single morphism.

\medskip\noindent
Proof of (a). The fibre categories of $\mathcal{F}$
over $\mathcal{C}_\Lambda$ are groupoids as the fibre categories
of $\mathcal{X}$ are groupoids. Let $A \to A'$ be a morphism of
$\mathcal{C}_\Lambda$ and let $x_0 \to x$ be an object of $\mathcal{F}(A)$.
Because $\mathcal{X}$ is fibred in groupoids, we can find a morphism
$x' \to x$ lying over $\Spec(A') \to \Spec(A)$. Since the composition
$A \to A' \to k$ is equal the given map $A \to k$ we see (by uniqueness
of pullbacks up to isomorphism) that the pullback via $\Spec(k) \to \Spec(A')$
of $x'$ is $x_0$, i.e., that there exists a morphism $x_0 \to x'$
lying over $\Spec(k) \to \Spec(A')$ compatible with
$x_0 \to x$ and $x' \to x$. This proves that $\mathcal{F}$ has
pushforwards. We conclude by (the dual of)
Categories, Lemma \ref{categories-lemma-fibred-groupoids}.

\medskip\noindent
Proof of (b). If $A = k$, then $\Spec(k) = \Spec(A)$ and since $\mathcal{X}$
is fibred in groupoids over $(\Sch/S)_{fppf}$ we see that given any object
$x_0 \to x$ in $\mathcal{F}(k)$ the morphism $x_0 \to x$ is an isomorphism.
Hence every object of $\mathcal{F}(k)$ is isomorphic to $x_0 \to x_0$.
Clearly the only self morphism of $x_0 \to x_0$ in $\mathcal{F}$ is
the identity.
\end{proof}

\noindent
Let $S$ be a locally Noetherian base scheme. Let
$F : \mathcal{X} \to \mathcal{Y}$ be a $1$-morphism between categories
fibred in groupoids over $(\textit{Sch}/S)_{fppf}$. Let $k$ is a field
of finite type over $S$. Let $x_0$ be an object of $\mathcal{X}$ lying
over $\Spec(k)$. Set $y_0 = F(x_0)$ which is an object of $\mathcal{Y}$
lying over $\Spec(k)$. Then $F$ induces a functor
\begin{equation}
\label{equation-functoriality}
F :
\mathcal{F}_{\mathcal{X}, k, x_0}
\longrightarrow
\mathcal{F}_{\mathcal{Y}, k, y_0}
\end{equation}
of categories cofibred over $\mathcal{C}_\Lambda$. Namely, to the object
$x_0 \to x$ of $\mathcal{F}_{\mathcal{X}, k, x_0}(A)$ we associate
the object $F(x_0) \to F(x)$ of $\mathcal{F}_{\mathcal{Y}, k, y_0}(A)$.

\begin{lemma}
\label{lemma-formally-smooth-on-deformation-categories}
Let $S$ be a locally Noetherian scheme. Let $F : \mathcal{X} \to \mathcal{Y}$
be a $1$-morphism of categories fibred in groupoids over $(\Sch/S)_{fppf}$
which is formally smooth on objects (see
Criteria for Representability, Section \ref{criteria-section-formally-smooth}).
Then for every finite type field $k$ over $S$ and for every object
$x_0$ of $\mathcal{X}$ over $k$ the functor (\ref{equation-functoriality})
is smooth in the sense of
Formal Deformation Theory, Definition
\ref{formal-defos-definition-smooth-morphism}.
\end{lemma}

\begin{proof}
This is a matter of unwinding the definitions. Details omitted.
\end{proof}




\section{Pushouts and stacks}
\label{section-pushouts}

\noindent
In this section we show that algebraic stacks behave well with
respect to certain pushouts. The results in this section hold over
any base scheme.

\medskip\noindent
The following lemma is also correct when $Y$, $X'$, $X$, $Y'$ are
algebraic spaces, see (insert future reference here).

\begin{lemma}
\label{lemma-pushout}
Let $S$ be a scheme. Let
$$
\xymatrix{
X \ar[r] \ar[d] & X' \ar[d] \\
Y \ar[r] & Y'
}
$$
be a pushout in the category of schemes over $S$ where $X \to X'$
is a thickening and $X \to Y$ is affine, see
More on Morphisms, Lemma \ref{more-morphisms-lemma-pushout-along-thickening}.
Let $\mathcal{Z}$ be an algebraic stack over $S$.
Then the functor of fibre categories
$$
\mathcal{Z}_{Y'}
\longrightarrow
\mathcal{Z}_Y \times_{\mathcal{Z}_X} \mathcal{Z}_{X'}
$$
is an equivalence of categories.
\end{lemma}

\begin{proof}
Let $y'$ be an object of left hand side. The sheaf
$\mathit{Isom}(y', y')$ on the category of schemes over $Y'$
is representable by an algebraic space $I$ over $Y'$, see
Algebraic Stacks, Lemma \ref{algebraic-lemma-representable-diagonal}.
We conclude that the functor of the lemma is fully faithful as
$Y'$ is the pushout in the category of algebraic spaces as
well as the category of schemes, see
More on Morphisms of Spaces, Lemma
\ref{spaces-more-morphisms-lemma-pushout-along-thickening-schemes}.

\medskip\noindent
Let $(y, x', f)$ be an object of the right hand side. Here $f : y|_X \to x'|_X$
is an isomorphism. To finish the proof we have to construct an object $y'$ of
$\mathcal{Z}_{Y'}$ whose restrictions to $Y$ and $X'$ agree with $y$ and $x'$
in a manner compatible with $\varphi$. In fact, it suffices to construct $y'$
fppf locally on $Y'$, see
Stacks, Lemma \ref{stacks-lemma-characterize-essentially-surjective-when-ff}.
Choose a representable algebraic stack
$\mathcal{W}$ and a surjective smooth morphism $\mathcal{W} \to \mathcal{Z}$.
Then
$$
(\Sch/Y)_{fppf} \times_{y, \mathcal{Z}} \mathcal{W}
\quad\text{and}\quad
(\Sch/X')_{fppf} \times_{x', \mathcal{Z}} \mathcal{W}
$$
are algebraic stacks representable by algebraic spaces $V$ and $U'$
smooth over $Y$ and $X'$. The isomorphism $f$ induces an isomorphism
$\varphi : V \times_Y X \to U' \times_{X'} X$ over $X$. By
More on Morphisms of Spaces, Lemmas
\ref{spaces-more-morphisms-lemma-pushout-along-thickening} and
\ref{spaces-more-morphisms-lemma-equivalence-categories-spaces-pushout-flat}
we see that the pushout $V' = V \amalg_{V \times_Y X} U'$ is
an algebraic space smooth over $Y'$ whose base change to
$Y$ and $X'$ recovers $V$ and $U'$ in a manner compatible with $\varphi$.

\medskip\noindent
Let $W$ be the algebraic space representing $\mathcal{W}$.
The projections $V \to W$ and $U' \to W$ agree as morphisms
over $V \times_Y X \cong U' \times_{X'} X$ hence the universal
property of the pushout determines a morphism of algebraic spaces
$V' \to W$. Choose a scheme $Y_1'$ and a surjective \'etale morphism
$Y_1' \to V'$. Set $Y_1 = Y \times_{Y'} Y_1'$,
$X_1' = X' \times_{Y'} Y_1'$, $X_1 = X \times_{Y'} Y_1'$.
The composition
$$
(\Sch/Y_1') \to (\Sch/V') \to (\Sch/W) = \mathcal{W} \to \mathcal{Z}
$$
corresponds by the $2$-Yoneda lemma to an object $y_1'$ of $\mathcal{Z}$
over $Y_1'$ whose restriction to $Y_1$ and $X_1'$ agrees with $y|_{Y_1}$
and $x'|_{X_1'}$ in a manner compatible with $f|_{X_1}$. Thus we have
constructed our desired object smooth locally over $Y'$ and we win.
\end{proof}








\section{The Rim-Schlessinger condition}
\label{section-RS}

\noindent
The motivation for the following definition comes from
Lemma \ref{lemma-pushout}
and
Formal Deformation Theory, Definition \ref{formal-defos-definition-RS} and
Lemma \ref{formal-defos-lemma-RS-2-categorical}.

\begin{definition}
\label{definition-RS}
Let $S$ be a locally Noetherian scheme. Let $\mathcal{Z}$ be a category
fibred in groupoids over $(\Sch/S)_{fppf}$. We say $\mathcal{Z}$
satisfies {\it condition (RS)} if for every pushout
$$
\xymatrix{
X \ar[r] \ar[d] & X' \ar[d] \\
Y \ar[r] & Y' = Y \amalg_X X'
}
$$
in the category of schemes over $S$ where
\begin{enumerate}
\item $X$, $X'$, $Y$, $Y'$ are spectra of local Artinian rings,
\item $X$, $X'$, $Y$, $Y'$ are of finite type over $S$, and
\item $X \to X'$ (and hence $Y \to Y'$) is a closed immersion
\end{enumerate}
the functor of fibre categories
$$
\mathcal{Z}_{Y'}
\longrightarrow
\mathcal{Z}_Y \times_{\mathcal{Z}_X} \mathcal{Z}_{X'}
$$
is an equivalence of categories.
\end{definition}

\noindent
If $A$ is an Artinian local ring with residue field $k$, then
any morphism $\Spec(A) \to S$ is affine and of finite type if and
only if the induced morphism $\Spec(k) \to S$ is of finite type, see
Morphisms, Lemmas \ref{morphisms-lemma-Artinian-affine} and
\ref{morphisms-lemma-artinian-finite-type}.

\begin{lemma}
\label{lemma-algebraic-stack-RS}
Let $\mathcal{X}$ be an algebraic stack over a locally Noetherian base
$S$. Then $\mathcal{X}$ satisfies (RS).
\end{lemma}

\begin{proof}
Immediate from the definitions and Lemma \ref{lemma-pushout}.
\end{proof}







\section{Deformation categories}
\label{section-deformation-categories}

\noindent
We match the notation introduced above with the notation from the
chapter ``Formal Deformation Theory''.

\begin{lemma}
\label{lemma-deformation-category}
Let $S$ be a locally Noetherian scheme. Let $\mathcal{X}$ be a category
fibred in groupoids over $(\Sch/S)_{fppf}$ satisfying (RS). For any field
$k$ of finite type over $S$ and any object $x_0$ of $\mathcal{X}$ lying
over $k$ the predeformation category
$p : \mathcal{F}_{\mathcal{X}, k, x_0} \to \mathcal{C}_\Lambda$
(\ref{equation-predeformation-category}) is a deformation category, see
Formal Deformation Theory, Definition
\ref{formal-defos-definition-deformation-category}.
\end{lemma}

\begin{proof}
Set $\mathcal{F} = \mathcal{F}_{\mathcal{X}, k, x_0}$.
Let $f_1 : A_1 \to A$ and $f_2 : A_2 \to A$ be ring maps in
$\mathcal{C}_\Lambda$ with $f_2$ surjective. We have to show that
the functor
$$
\mathcal{F}(A_1 \times_A A_2)
\longrightarrow
\mathcal{F}(A_1) \times_{\mathcal{F}(A)} \mathcal{F}(A_2)
$$
is an equivalence, see
Formal Deformation Theory, Lemma \ref{formal-defos-lemma-RS-2-categorical}.
Set $X = \Spec(A)$, $X' = \Spec(A_2)$, $Y = \Spec(A_1)$ and
$Y' = \Spec(A_1 \times_A A_2)$. Note that $Y' = Y \amalg_X X'$ in the
category of schemes, see
More on Morphisms, Lemma \ref{more-morphisms-lemma-pushout-along-thickening}.
We know that in the diagram of functors of fibre categories
$$
\xymatrix{
\mathcal{X}_{Y'} \ar[r] \ar[d] &
\mathcal{X}_Y \times_{\mathcal{X}_X} \mathcal{X}_{X'} \ar[d] \\
\mathcal{X}_{\Spec(k)} \ar@{=}[r] & \mathcal{X}_{\Spec(k)}
}
$$
the top horizontal arrow is an equivalence by
Definition \ref{definition-RS}.
Since $\mathcal{F}(B)$ is the category of objects of $\mathcal{X}_{\Spec(B)}$
with an identification with $x_0$ over $k$ we win.
\end{proof}

\begin{remark}
\label{remark-deformation-category-implies}
Let $S$ be a locally Noetherian scheme. Let $\mathcal{X}$ be fibred
in groupoids over $(\Sch/S){fppf}$. Let $k$ be a field of finite type over
$S$ and $x_0$ an object
of $\mathcal{X}$ over $k$. Let $p : \mathcal{F} \to \mathcal{C}_\Lambda$
be as in (\ref{equation-predeformation-category}). If $\mathcal{F}$
is a deformation category, i.e., if $\mathcal{F}$ satisfies the
Rim-Schlessinger condition (RS), then we see that $\mathcal{F}$ satisfies
Schlessingers conditions (S1) and (S2) by
Formal Deformation Theory, Lemma \ref{formal-defos-lemma-RS-implies-S1-S2}.
Let $\overline{\mathcal{F}}$ be the functor of isomorphism classes, see
Formal Deformation Theory, Remarks
\ref{formal-defos-remarks-cofibered-groupoids}
(\ref{formal-defos-item-associated-functor-isomorphism-classes}).
Then $\overline{\mathcal{F}}$ satisfies (S1) and (S2) as well, see
Formal Deformation Theory, Lemma
\ref{formal-defos-lemma-S1-S2-associated-functor}.
This holds in particular in the situation of
Lemma \ref{lemma-deformation-category}.
\end{remark}




\section{Change of field}
\label{section-change-of-field}

\noindent
This section is the analogue of
Formal Deformation Theory, Section \ref{formal-defos-section-change-of-field}.
As pointed out there, to discuss what happens under change of field
we need to write $\mathcal{C}_{\Lambda, k}$ instead of $\mathcal{C}_\Lambda$.
In the following lemma we use the notation $\mathcal{F}_{l/k}$
introduced in Formal Deformation Theory, Situation
\ref{formal-defos-situation-change-of-fields}.

\begin{lemma}
\label{lemma-change-of-field}
Let $S$ be a locally Noetherian scheme. Let $\mathcal{X}$ be a category
fibred in groupoids over $(\Sch/S)_{fppf}$. Let $k$ be a
field of finite type over $S$ and let $k \subset l$ be a finite extension.
Let $x_0$ be an object of $\mathcal{F}$ lying over $\Spec(k)$.
Denote $x_{l, 0}$ the restriction of $x_0$ to $\Spec(l)$.
Then there is a canonical functor
$$
(\mathcal{F}_{\mathcal{X}, k , x_0})_{l/k}
\longrightarrow
\mathcal{F}_{\mathcal{X}, l, x_{l, 0}}
$$
of categories cofibred in groupoids over $\mathcal{C}_{\Lambda, l}$.
If $\mathcal{X}$ satisfies (RS), then this functor is an equivalence.
\end{lemma}

\begin{proof}
Consider a factorization
$$
\Spec(l) \to \Spec(B) \to S
$$
as in (\ref{equation-factor}). By definition we have
$$
(\mathcal{F}_{\mathcal{X}, k , x_0})_{l/k}(B) =
\mathcal{F}_{\mathcal{X}, k, x_0}(B \times_l k)
$$
see Formal Deformation Theory, Situation
\ref{formal-defos-situation-change-of-fields}. Thus an object of this
is a morphism $x_0 \to x$ of $\mathcal{X}$ lying over the morphism
$\Spec(k) \to \Spec(B \times_l k)$. Choosing pullback functor for $\mathcal{X}$
we can associate to $x_0 \to x$ the morphism $x_{l, 0} \to x_B$
where $x_B$ is the restriction of $x$ to $\Spec(B)$ (via the morphism
$\Spec(B) \to \Spec(B \times_l k)$ coming from $B \times_l k \subset B$).
This construction is functorial in $B$ and compatible with morphisms.

\medskip\noindent
Next, assume $\mathcal{X}$ satisfies (RS). Consider the diagrams
$$
\vcenter{
\xymatrix{
l & B \ar[l] \\
k \ar[u] & B \times_l k \ar[l] \ar[u]
}
}
\quad\text{and}\quad
\vcenter{
\xymatrix{
\Spec(l) \ar[d] \ar[r] & \Spec(B) \ar[d] \\
\Spec(k) \ar[r] & \Spec(B \times_l k)
}
}
$$
The diagram on the left is a fibre product of rings. The diagram on the
right is a pushout in the category of schemes, see
More on Morphisms, Lemma \ref{more-morphisms-lemma-pushout-along-thickening}.
These schemes are all of finite type over $S$ (see remarks following
Definition \ref{definition-RS}). Hence (RS) kicks in to give an equivalence
of fibre categories
$$
\mathcal{X}_{\Spec(B \times_l k)}
\longrightarrow
\mathcal{X}_{\Spec(k)}
\times_{\mathcal{X}_{\Spec(l)}}
\mathcal{X}_{\Spec(B)}
$$
This implies that the functor defined above gives an equivalence of
fibre categories. Hence the functor is an equivalence on categories
cofibred in groupoids by (the dual of)
Categories, Lemma \ref{categories-lemma-equivalence-fibred-categories}.
\end{proof}








\section{Tangent spaces}
\label{section-tangent-spaces}

\noindent
Let $S$ be a locally Noetherian scheme. Let $\mathcal{X}$ be a category
fibred in groupoids over $(\Sch/S)_{fppf}$. Let $k$ be a field of finite
type over $S$ and let $x_0$ be an object of $\mathcal{X}$ over $k$.
In Formal Deformation Theory, Section \ref{formal-defos-section-tangent-spaces}
we have defined the tangent space
\begin{equation}
\label{equation-tangent-space}
T\mathcal{F} =
\{\text{isomorphism classes of objects in }\mathcal{F}(k[\epsilon])\}
\end{equation}
of the predeformation category $\mathcal{F}$. If $\mathcal{X}$ satisfies
the Rim-Schlessinger condition (RS), then $T\mathcal{F}$ comes equipped
with a natural $k$-vector space structure by
Formal Deformation Theory, Lemma
\ref{formal-defos-lemma-tangent-space-vector-space}
(assumptions hold by Lemma \ref{lemma-deformation-category} and
Remark \ref{remark-deformation-category-implies}). A natural condition
is to ask this vector space to have finite dimension.

\medskip\noindent
The following lemma tells us this is true if
$\mathcal{X}$ is locally of finite type over $S$ (see
Morphisms of Stacks, Section \ref{stacks-morphisms-section-finite-type}).

\begin{lemma}
\label{lemma-finite-dimension}
Let $S$ be a locally Noetherian scheme. Assume
\begin{enumerate}
\item $\mathcal{X}$ is an algebraic stack,
\item $U$ is a scheme locally of finite type over $S$, and
\item $(\textit{Sch}/U)_{fppf} \to \mathcal{X}$ is a smooth surjective
morphism.
\end{enumerate}
Then, for any $\mathcal{F} = \mathcal{F}_{\mathcal{X}, k, x_0}$ as in
Section \ref{section-predeformation-categories}
the tangent space $T\mathcal{F}$ has finite dimension over $k$
\end{lemma}

\begin{proof}
Let us write $\mathcal{U} = (\textit{Sch}/U)_{fppf}$. By our definition
of algebraic stacks the $1$-morphism $\mathcal{U} \to \mathcal{X}$
is representable by algebraic spaces. Hence in particular the
2-fibre product
$$
\mathcal{U}_{x_0} = (\Sch/\Spec(k))_{fppf} \times_\mathcal{X} \mathcal{U}
$$
is representable by an algebraic space $U_{x_0}$ over $\Spec(k)$. Then
$U_{x_0} \to \Spec(k)$ is smooth and surjective (in particular $U_{x_0}$
is nonempty). By Spaces over Fields, Lemma
\ref{spaces-over-fields-lemma-smooth-separable-closed-points-dense}
we can find a finite extension $l \supset k$ and a point
$\Spec(l) \to U_{x_0}$ over $k$. We have
$$
(\mathcal{F}_{\mathcal{X}, k , x_0})_{l/k} =
\mathcal{F}_{\mathcal{X}, l, x_{l, 0}}
$$
by Lemma \ref{lemma-change-of-field} and the fact that $\mathcal{X}$
satisfies (RS). Thus we see that
$$
T\mathcal{F} \otimes_k l \cong T\mathcal{F}_{\mathcal{X}, l, x_{l, 0}}
$$
by
Formal Deformation Theory, Lemma
\ref{formal-defos-lemma-tangent-space-change-of-field}
(applicable by
Lemmas \ref{lemma-algebraic-stack-RS} and
\ref{lemma-deformation-category} and
Remark \ref{remark-deformation-category-implies}).
Hence it suffices to prove that $T\mathcal{F}_{\mathcal{X}, l, x_{l, 0}}$
has finite dimension over $l$. Note that $x_{l, 0}$ comes from a point
$u_0$ of $\mathcal{U}$ over $l$. The functor (\ref{equation-functoriality})
$$
\mathcal{F}_{\mathcal{U}, l, u_0}
\longrightarrow
\mathcal{F}_{\mathcal{X}, l, x_{l, 0}}
$$
is smooth by Lemma \ref{lemma-formally-smooth-on-deformation-categories}
and Criteria for Representability, Lemma
\ref{criteria-lemma-representable-by-spaces-formally-smooth}.
The induced map on tangent spaces
$$
T\mathcal{F}_{\mathcal{U}, l, u_0}
\longrightarrow
T\mathcal{F}_{\mathcal{X}, l, x_{l, 0}}
$$
is $l$-linear (by
Formal Deformation Theory, Lemma
\ref{formal-defos-lemma-k-linear-differential})
and surjective (as smooth maps of predeformation categories induce
surjective maps on tangent spaces by
Formal Deformation Theory, Lemma
\ref{formal-defos-lemma-smooth-morphism-essentially-surjective}).

\medskip\noindent
Hence it suffices to prove that the tangent space of the deformation
space associated to the representable algebraic stack $\mathcal{U}$
at the point $u_0$ is finite dimensional. Let $\Spec(R) \subset U$ be
an affine open such that $u_0 : \Spec(l) \to U$ factors through $\Spec(R)$
and such that $\Spec(R) \to S$ factors through $\Spec(\Lambda) \subset S$.
Let $\mathfrak m_R \subset R$ be the kernel of the $\Lambda$-algebra map
$\varphi_0 : R \to l$ corresponding to $u_0$. Note that $R$, being of finite
type over the Noetherian ring $\Lambda$, is a Noetherian ring. Hence
$\mathfrak m_R = (f_1, \ldots, f_n)$ is a finitely generated ideal.
We have
$$
T\mathcal{F}_{\mathcal{U}, l, u_0}
=
\{\varphi : R \to l[\epsilon] \mid
\varphi \text{ is a } \Lambda\text{-algebra map and }
\varphi \bmod \epsilon = \varphi_0\}
$$
An element of the right hand side is determined by its values on
$f_1, \ldots, f_n$ hence the dimension is at most $n$ and we win.
Some details omitted.
\end{proof}







\section{Formal objects}
\label{section-formal-objects}

\noindent
In this section we transfer some of the notions already defined
in the chapter ``Formal Deformation Theory'' to the current setting.
In the following we will say ``$R$ is an $S$-algebra'' to indicate
that $R$ is a ring endowed with a morphism of schemes $\Spec(R) \to S$.

\begin{definition}
\label{definition-formal-objects}
Let $S$ be a locally Noetherian scheme. Let
$p : \mathcal{X} \to (\Sch/S)_{fppf}$ be a category fibred in groupoids.
\begin{enumerate}
\item A {\it formal object} $\xi = (R, \xi_n, f_n)$ of $\mathcal{X}$ consists
of a Noetherian complete local $S$-algebra $R$, objects $\xi_n$ of
$\mathcal{X}$ lying over $\Spec(R/\mathfrak m_R^n)$, and morphisms
$\xi_n \to \xi_{n + 1}$ of $\mathcal{X}$ lying over
$\Spec(R/\mathfrak m^n) \to \Spec(R/\mathfrak m^{n + 1})$
such that $R/\mathfrak m$ is a field of finite type over $S$.
\item A {\it morphism of formal objects}
$a : \xi = (R, \xi_n, f_n) \to \eta = (T, \eta_n, g_n)$
is given by morphisms $a_n : \xi_n \to \eta_n$ such that for every $n$
the diagram
$$
\xymatrix{
\xi_{n + 1} \ar[r]_{f_n} \ar[d]_{a_{n + 1}} & \xi_n \ar[d]^{a_n} \\
\eta_{n + 1} \ar[r]^{g_n} & \eta_n
}
$$
is commutative. Applying the functor $p$ we obtain a compatible collection
of morphisms $\Spec(R/\mathfrak m_R^n) \to \Spec(T/\mathfrak m_T^n)$ and
hence a morphism $a_0 : \Spec(R) \to \Spec(T)$ over $S$. We say that
$a$ {\it lies over} $a_0$.
\end{enumerate}
\end{definition}

\noindent
Thus we obtain a category of formal object of $\mathcal{X}$. If
$F : \mathcal{X} \to \mathcal{Y}$ is a $1$-morphism of categories fibred
in groupoids over $(\Sch/S)_{fppf}$, then $F$ induces a functor between
categories of formal objects as well.

\medskip\noindent
Given a formal object $\xi = (R, \xi_n, f_n)$, set $k = R/\mathfrak m$ and
$x_0 = \xi_1$. Then the formal object $\xi$ defines a formal object
$\xi$ of $\mathcal{F}_{\mathcal{X}, k, x_0}$ as defined in
Formal Deformation Theory, Definition
\ref{formal-defos-definition-formal-objects}.
We will use the terminology introduced in that chapter.
In particular, we will say that $\xi$ is {\it versal} if $\xi$
(as a formal object of $\mathcal{F}$) is versal in the sense
of Formal Deformation Theory, Definition \ref{formal-defos-definition-versal}.
We briefly spell out here what this means. Suppose given a
morphism $x_0 \to y$ lying over a closed immersion $\Spec(k) \to \Spec(A)$
where $A$ is an Artinian local ring with residue field $k$.
Then versality implies there exists an $n \geq 1$ and a commutative diagram
$$
\vcenter{
\xymatrix{
& y \ar[ld] \\
\xi_n & \xi_1 = x_0 \ar[u] \ar[l]
}
}
\quad\text{lying over}\quad
\vcenter{
\xymatrix{
& \Spec(A) \ar[ld] \\
\Spec(R/\mathfrak m^n) & \Spec(k) \ar[u] \ar[l]
}
}
$$
Please compare with Formal Deformation Theory, Remark
\ref{formal-defos-remark-versal-object}.

\begin{lemma}
\label{lemma-smooth-lift-formal}
Let $S$ be a locally Noetherian scheme. Let $F : \mathcal{X} \to \mathcal{Y}$
be a $1$-morphism of categories fibred in groupoids over $(\Sch/S)_{fppf}$.
Let $\eta = (R, \eta_n, g_n)$ be a formal object of $\mathcal{Y}$
and let $\xi_1$ be an object of $\mathcal{X}$ with $F(\xi_1) \cong \eta_1$.
If $F$ is formally smooth on objects (see
Criteria for Representability, Section \ref{criteria-section-formally-smooth}),
then there exists a formal object $\xi = (R, \xi_n, f_n)$ of $\mathcal{X}$
such that $F(\xi) \cong \eta$.
\end{lemma}

\begin{proof}
Note that each of the morphisms
$\Spec(R/\mathfrak m^n) \to \Spec(R/\mathfrak m^{n + 1})$ is a first order
thickening of affine schemes over $S$. Hence the assumption on $F$ means
that we can successively lift $\xi_1$ to objects $\xi_2, \xi_3, \ldots$
of $\mathcal{X}$ endowed with compatible isomorphisms
$\eta_n|_{\Spec(R/\mathfrak m^{n - 1})} \cong \eta_{n - 1}$
and $F(\eta_n) \cong \xi_n$.
\end{proof}

\noindent
Let $S$ be a locally Noetherian scheme. Let
$p : \mathcal{X} \to (\Sch/S)_{fppf}$ be a category fibred in groupoids.
Suppose that $x$ is an object of $\mathcal{X}$ over $R$, where $R$ is a
Noetherian complete local $S$-algebra with residue field of finite type
over $S$. Then we can consider the system of restrictions
$\xi_n = x|_{\Spec(R/\mathfrak m^n)}$ endowed with the natural morphisms
$\xi_1 \to \xi_2 \to \ldots$ coming from transitivity of restriction.
Thus $\xi = (R, \xi_n, \xi_n \to \xi_{n + 1})$ is a formal object of
$\mathcal{X}$. This construction is functorial in the object $x$.
Thus we obtain a functor
\begin{equation}
\label{equation-approximation}
\left\{
\begin{matrix}
\text{objects }x\text{ of }\mathcal{X} \text{ such that }p(x) = \Spec(R) \\
\text{where }R\text{ is Noetherian complete local}\\
\text{with }R/\mathfrak m\text{ of finite type over }S
\end{matrix}
\right\}
\longrightarrow
\left\{
\begin{matrix}
\text{formal objects of }\mathcal{X}
\end{matrix}
\right\}
\end{equation}
To be precise the left hand side is the full subcategory of $\mathcal{X}$
consisting of objects as indicated and the right hand side is the category
of formal objects of $\mathcal{X}$ as in
Definition \ref{definition-formal-objects}.

\begin{definition}
\label{definition-effective}
Let $S$ be a locally Noetherian scheme. Let $\mathcal{X}$ be a category
fibred in groupoids over $(\Sch/S)_{fppf}$. A formal object
$\xi = (R, \xi_n, f_n)$ of $\mathcal{X}$ is called {\it effective}
if it is in the essential image of the functor
(\ref{equation-approximation}).
\end{definition}

\noindent
If the category fibred in groupoids is an algebraic stack, then every
formal object is effective as follows from the next lemma.

\begin{lemma}
\label{lemma-effective}
Let $S$ be a locally Noetherian scheme. Let $\mathcal{X}$ be an algebraic
stack over $S$. The functor (\ref{equation-approximation}) is an equivalence.
\end{lemma}

\begin{proof}
Case I: $\mathcal{X}$ is representable (by a scheme). Say
$\mathcal{X} = (\Sch/X)_{fppf}$ for some scheme $X$ over $S$.
Unwinding the definitions we have to prove the following: Given
a Noetherian complete local $S$-algebra $R$ with $R/\mathfrak m$ of
finite type over $S$ we have
$$
\Mor_S(\Spec(R), X) \longrightarrow \lim \Mor_S(\Spec(R/\mathfrak m^n, X)
$$
is bijective. We can split both sides of the arrow into a disjoint union
over $x \in X$ by looking at those morphisms (resp.\ systems of morphisms)
mapping the closed point of $\Spec(R)$ (resp.\ the unique point of
$\Spec(R/\mathfrak m^n)$) to $x$. Let $s \in S$ be the image of $x$.
Applying the discussion in Schemes, Section \ref{schemes-section-points}
we see that the arrow above is the disjoint union of the arrows
$$
\Hom_{\mathcal{O}_{S, s}}(\mathcal{O}_{X, x}, R)
\longrightarrow
\lim \Hom_{\mathcal{O}_{S, s}}(\mathcal{O}_{X, x}, R/\mathfrak m^n)
$$
By the universal property of limits each of these maps is bijective.

\medskip\noindent
Case II. $\mathcal{X}$ is representable by an algebraic space. Say
$\mathcal{X}$ is representable by $X$. Again we have to show that
$$
\Mor_S(\Spec(R), X) \longrightarrow \lim \Mor_S(\Spec(R/\mathfrak m^n, X)
$$
is bijective for $R$ as above.

\medskip\noindent
Injectivity: Let $x, x' : \Spec(R) \to X$
be two morphisms mapping to the same element in the right hand side.
Consider the fibre product
$$
T = \Spec(R) \times_{(x, x'), X \times_S X, \Delta} X
$$
Then $T$ is a scheme and $T \to \Spec(R)$ is locally of finite type,
monomorphism, separated, and locally quasi-finite, see
Morphisms of Spaces, Lemma \ref{spaces-morphisms-lemma-properties-diagonal}.
In particular $T$ is locally Noetherian, see
Morphisms, Lemma \ref{morphisms-lemma-finite-type-noetherian}.
Let $t \in T$ be the unique point mapping to the closed point of $\Spec(R)$
which exists as $x$ and $x'$ agree over $R/\mathfrak m$. Then
$R \to \mathcal{O}_{T, t}$ is a local ring map of Noetherian rings such that
$R/\mathfrak m^n \to \mathcal{O}_{T, t}/\mathfrak m^n\mathcal{O}_{T, t}$
is an isomorphism for all $n$ (because $x$ and $x'$ agree over
$\Spec(R/\mathfrak m^n)$ for all $n$). Since $\mathcal{O}_{T, t}$
maps injectively into its completion (see
Algebra, Lemma \ref{algebra-lemma-intersect-powers-ideal-module-zero})
we conclude that $R = \mathcal{O}_{T, t}$. Hence $x$ and $x'$ agree
over $R$.

\medskip\noindent
Surjectivity: Let $(x_n)$ be an element of the right hand side.
Choose a scheme $U$ and a surjective \'etale morphism $U \to X$. 
Denote $x_0 : \Spec(k) \to X$ the morphism induced on the residue field
$k = R/\mathfrak m$. The morphism of schemes
$U \times_{X, x_0} \Spec(k) \to \Spec(k)$ is surjective \'etale.
Thus $U \times_{X, x_0} \Spec(k)$ is a nonempty disjoint union of spectra
of finite separable field extensions of $k$, see
Morphisms, Lemma \ref{morphisms-lemma-etale-over-field}.
Hence we can find a finite separable field extension $k \subset k'$
and a $k'$-point $u_0 : \Spec(k') \to U$ such that
$$
\xymatrix{
\Spec(k') \ar[d] \ar[r]_-{u_0} & U \ar[d] \\
\Spec(k) \ar[r]^-{x_0} & X
}
$$
commutes. Let $R \subset R'$ be the finite \'etale extension of Noetherian
complete local rings which induces $k \subset k'$ on residue fields
(see Algebra, Lemmas \ref{algebra-lemma-henselian-cat-finite-etale} and
\ref{algebra-lemma-complete-henselian}). Denote $x'_n$ the restriction
of $x_n$ to $\Spec(R'/(\mathfrak m')^n)$. By
Lemma \ref{lemma-smooth-lift-formal}
and
Criteria for Representability, Lemma
\ref{criteria-lemma-representable-by-spaces-formally-smooth}
we can find an element
$(u'_n) \in \lim \Hom_S(\Spec(R'/(\mathfrak m')^n), U)$
mapping to $(x'_n)$. By Case I the family $(u'_n)$ comes from a unique
morphism $u' : \Spec(R') \to U$. Denote $x' : \Spec(R') \to X$ the
composition. Note that $R' \otimes_R R'$ is a finite product of spectra of
Noetherian complete local rings to which our current discussion applies.
Hence the diagram
$$
\xymatrix{
\Spec(R' \otimes_R R') \ar[r] \ar[d] & \Spec(R') \ar[d]^{x'} \\
\Spec(R') \ar[r]^{x'} & X
}
$$
is commutative by the injectivity shown above and the fact that
$x'_n$ is the restriction of $x_n$ which is defined over $R/\mathfrak m^n$.
Since $\{\Spec(R') \to \Spec(R)\}$ is an fppf covering we conclude
that $x'$ descends to a morphism $x : \Spec(R) \to X$.
We omit the proof that $x_n$ is the restriction of $x$ to
$\Spec(R/\mathfrak m^n)$.

\medskip\noindent
Case III: General case of an algebraic stack. A general remark is that
the left and right hand side of (\ref{equation-approximation}) are
categories fibred in groupoids over the category of affine schemes
over $S$ which are spectra of Noetherian complete local rings
with residue field of finite type over $S$. We will also see in the
proof below that they form stacks for a certain topology on this
category.

\medskip\noindent
We first prove fully faithfulness. Let $R$ be a Noetherian complete
local $S$-algebra with $k = R/\mathfrak m$ of finite type over $S$.
Let $x, x'$ be objects of $\mathcal{X}$ over $R$. As $\mathcal{X}$ is
an algebraic stack $\mathit{Isom}(x, x')$ is representable by an
algebraic space $I$ over $\Spec(R)$, see
Algebraic Stacks, Lemma \ref{algebraic-lemma-representable-diagonal}.
Applying Case II to $I$ over $\Spec(R)$ implies immediately that
(\ref{equation-approximation}) is fully faithful on fibre categories over
$\Spec(R)$. Hence the functor is fully faithful by
Categories, Lemma \ref{categories-lemma-equivalence-fibred-categories}.

\medskip\noindent
Essential surjectivity. Let $\xi = (R, \xi_n, f_n)$ be a formal object of
$\mathcal{X}$. Choose a scheme $U$ over $S$ and a surjective smooth morphism
$f : (\Sch/U)_{fppf} \to \mathcal{X}$. For every $n$ consider the fibre product
$$
(\Sch/\Spec(R/\mathfrak m^n))_{fppf}
\times_{\xi_n, \mathcal{X}, f}
(\Sch/U)_{fppf}
$$
By assumption this is representable by an algebraic space $V_n$ surjective and
smooth over $\Spec(R/\mathfrak m^n)$. The morphisms
$f_n : \xi_n \to \xi_{n + 1}$ induce cartesian squares
$$
\xymatrix{
V_{n + 1} \ar[d] & V_n \ar[d] \ar[l] \\
\Spec(R/\mathfrak m^{n + 1}) & \Spec(R/\mathfrak m^n) \ar[l]
}
$$
of algebraic spaces. By Spaces over Fields, Lemma
\ref{spaces-over-fields-lemma-smooth-separable-closed-points-dense}
we can find a finite separable extension $k \subset k'$ and a point
$v'_1 : \Spec(k') \to V_1$ over $k$. Let $R \subset R'$ be the finite \'etale
extension whose residue field extension is $k \subset k'$ (exists and
is unique by
Algebra, Lemmas \ref{algebra-lemma-henselian-cat-finite-etale} and
\ref{algebra-lemma-complete-henselian}).
By the infinitesimal lifting criterion of smoothness (see
More on Morphisms of Spaces, Lemma
\ref{spaces-more-morphisms-lemma-smooth-formally-smooth})
applied to $V_n \to \Spec(R/\mathfrak m^n)$ for $n = 2, 3, 4, \ldots$
we can succesively find morphisms
$v'_n : \Spec(R'/(\mathfrak m')^n) \to V_n$ over $\Spec(R/\mathfrak m^n)$
fitting into commutive diagrams
$$
\xymatrix{
\Spec(R'/(\mathfrak m')^{n + 1}) \ar[d]_{v'_{n + 1}} &
\Spec(R'/(\mathfrak m')^n) \ar[d]^{v'_n} \ar[l] \\
V_{n + 1} & V_n \ar[l]
}
$$
Composing with the projection morphisms $V_n \to U$ we obtain a compatible
system of morphisms $u'_n : \Spec(R'/(\mathfrak m')^n) \to U$.
By Case I the family $(u'_n)$ comes from a unique
morphism $u' : \Spec(R') \to U$. Denote $x'$ the object of $\mathcal{X}$
over $\Spec(R')$ we get by applying the $1$-morphism $f$ to $u'$.
By construction, there exists a morphism of formal objects
$$
(\ref{equation-approximation})(x') =
(R', x'|_{\Spec(R'/(\mathfrak m')^n)}, \ldots)
\longrightarrow
(R, \xi_n, f_n)
$$
lying over $\Spec(R') \to \Spec(R)$. Note that $R' \otimes_R R'$ is a finite
product of spectra of Noetherian complete local rings to which our current
discussion applies. Denote $p_0, p_1 : \Spec(R' \otimes_R R') \to \Spec(R')$
the two projections. By the fully faithfulness shown above there exists
a canonical isomorphism $\varphi : p_0^*x' \to p_1^*x'$ because we have
such isomorphisms over
$\Spec((R' \otimes_R R')/\mathfrak m^n(R' \otimes_R R'))$.
We omit the proof that the isomorphism $\varphi$ satisfies the cocycle
condition (see Stacks, Definition \ref{stacks-definition-descent-data}).
Since $\{\Spec(R') \to \Spec(R)\}$ is an fppf covering we conclude
that $x'$ descends to an object $x$ of $\mathcal{X}$ over $\Spec(R)$.
We omit the proof that $x_n$ is the restriction of $x$ to
$\Spec(R/\mathfrak m^n)$.
\end{proof}







\section{Approximation}
\label{section-approximation}

\noindent
A fundamental insight of Michael Artin is that you can approximate
objects of a limit preserving stack. Namely, given an object $x$
of the stack over a Noetherian complete local ring, you can find
an object $x_A$ over an algebraic ring which is ``close to'' $x$.
Here an algebraic ring means a finite type $S$-algebra and close
means adically close. In this section we present this in a simple,
yet general form.

\medskip\noindent
To formulate the result we need to pull together some definitions from
different places in the stacks project. First, in
Criteria for Representability, Section \ref{criteria-section-limit-preserving}
we introduced the property limit preserving on objects
for categories fibred in groupoids over the category of schemes.
In More on Algebra, Definition \ref{more-algebra-definition-G-ring}
we defined the notion of a $G$-ring. Let $S$ be a locally Noetherian scheme.
Let $A$ be an $S$-algebra. We say that $A$ is {\it of finite type over $S$}
or is a {\it finite type $S$-algebra} if $\Spec(A) \to S$ is of finite type.
In this case $A$ is a Noetherian ring. Finally, given a ring $A$ and ideal
$I$ we denote $\text{Gr}_I(A) = \bigoplus I^n/I^{n + 1}$.

\begin{lemma}
\label{lemma-approximate}
Let $S$ be a locally Noetherian scheme. Let
$p : \mathcal{X} \to (\Sch/S)_{fppf}$ be a category
fibred in groupoids. Let $x$ be an object of
$\mathcal{X}$ lying over $\Spec(R)$ where $R$ is a Noetherian complete
local ring with residue field $k$ of finite type over $S$. Let $s \in S$
be the image of $\Spec(k) \to S$. Assume that (a) $\mathcal{O}_{S, s}$ is
a G-ring and (b) $p$ is limit preserving on objects. Then for every
integer $N \geq 1$ there exist
\begin{enumerate}
\item a finite type $S$-algebra $A$,
\item a maximal ideal $\mathfrak m_A \subset A$,
\item an object $x_A$ of $\mathcal{X}$ over $\Spec(A)$,
\item an $S$-isomorphism $R/\mathfrak m_R^N \cong A/\mathfrak m_A^N$,
\item an isomorphism
$x|_{\Spec(R/\mathfrak m_R^N)} \cong x_A|_{\Spec(A/\mathfrak m_A^N)}$
compatible with (4), and
\item an isomorphism
$\text{Gr}_{\mathfrak m_R}(R) \cong \text{Gr}_{\mathfrak m_A}(A)$
of graded $k$-algebras.
\end{enumerate}
\end{lemma}

\begin{proof}
Choose an affine open $\Spec(\Lambda) \subset S$ such that $k$ is a finite
$\Lambda$-algebra, see
Morphisms, Lemma \ref{morphisms-lemma-point-finite-type}.
We may and do replace $S$ by $\Spec(\Lambda)$.

\medskip\noindent
We may write $R$ as a directed colimit $R = \colim C_j$ where each
$C_j$ is a finite type $\Lambda$-algebra (see
Algebra, Lemma \ref{algebra-lemma-ring-colimit-fp}).
By assumption (b) the object $x$ is isomorphic to the restriction of
an object over one of the $C_j$. Hence we may choose a finite type
$\Lambda$-algebra $C$, a $\Lambda$-algebra map $C \to R$, and an object
$x_C$ of $\mathcal{X}$ over $\Spec(C)$ such that $x = x_C|_{\Spec(R)}$.
The choice of $C$ is a bookkeeping device and could be avoided.
For later use, let us write $C = \Lambda[y_1, \ldots, y_u]/(f_1, \ldots, f_v)$
and we denote $\overline{a}_i \in R$ the image of $y_i$ under the
map $C \to R$. Set $\mathfrak m_C = C \cap \mathfrak m_R$.

\medskip\noindent
Choose a $\Lambda$-algebra surjection $\Lambda[x_1, \ldots, x_s] \to k$
and denote $\mathfrak m'$ the kernel.
By the universal property of polynomial rings we may lift this
to a $\Lambda$-algebra map $\Lambda[x_1, \ldots, x_s] \to R$.
We add some variables (i.e., we increase $s$ a bit) mapping to generators
of $\mathfrak m_R$. Having done this we see that
$\Lambda[x_1, \ldots, x_s] \to R/\mathfrak m_R^2$ is surjective.
Then we see that
\begin{equation}
\label{equation-surjection}
P = \Lambda[x_1, \ldots, x_s]_{\mathfrak m'}^\wedge \longrightarrow R
\end{equation}
is a surjective map of Noetherian complete local rings, see for example
Formal Deformation Theory, Lemma
\ref{formal-defos-lemma-surjective-cotangent-space}.

\medskip\noindent
Choose lifts $a_i \in P$ of $\overline{a}_i$ we found above.
Choose generators $b_1, \ldots, b_r \in P$ for the kernel of
(\ref{equation-surjection}).
Choose $c_{ji} \in P$ such that
$$
f_j(a_1, \ldots, a_u) = \sum c_{ji} b_i
$$
in $P$ which is possible by the choices made sofar. Choose generators
$$
k_1, \ldots, k_t \in
\text{Ker}(P^{\oplus r} \xrightarrow{(b_1, \ldots, b_r)} P)
$$
and write $k_i = (k_{i1}, \ldots, k_{ir})$ and $K = (k_{ij})$
so that
$$
P^{\oplus t} \xrightarrow{K}
P^{\oplus r} \xrightarrow{(b_1, \ldots, b_r)}
P \to R \to 0
$$
is an exact sequence of $P$-modules. In particular we have
$\sum k_{ij} b_j = 0$. After possibly increasing $N$ we may
assume $N - 1$ works in the Artin-Rees lemma for the first two maps of this
exact sequence (see More on Algebra, Section
\ref{more-algebra-section-artin-rees} for terminology).

\medskip\noindent
By assumption $\mathcal{O}_{S, s} = \Lambda_{\Lambda \cap \mathfrak m'}$ is
a G-ring. Hence by More on Algebra, Proposition
\ref{more-algebra-proposition-finite-type-over-G-ring}
the ring $\Lambda[x_1, \ldots, x_s]_{\mathfrak m'}$ is a $G$-ring.
Hence by Smoothing Ring Maps, Theorem
\ref{smoothing-theorem-approximation-property-variant}
there exist an \'etale ring map
$$
\Lambda[x_1, \ldots, x_s]_{\mathfrak m'} \to B,
$$
a maximal ideal $\mathfrak m_B$ of $B$ lying over $\mathfrak m'$, and
elements $a'_i, b'_i, c'_{ij}, k'_{ij} \in B'$ such that
\begin{enumerate}
\item $\kappa(\mathfrak m') = \kappa(\mathfrak m_B)$ which implies
that $\Lambda[x_1, \ldots, x_s]_{\mathfrak m'} \subset B_{\mathfrak m_B}
\subset P$ and $P$ is identified with the completion of $B$ at
$\mathfrak m_B$, see remark preceding Smoothing Ring Maps, Theorem
\ref{smoothing-theorem-approximation-property-variant},
\item $a_i - a'_i, b_i - b'_i, c_{ij} - c'_{ij}, k_{ij} - k'_{ij} \in
(\mathfrak m')^N P$, and
\item $f_j(a'_1, \ldots, a'_u) = \sum c'_{ji} b'_i$ and $\sum k'_{ij}b'_j = 0$.
\end{enumerate}
Set $A = B/(b'_1, \ldots, b'_r)$ and denote $\mathfrak m_A$ the
image of $\mathfrak m_B$ in $A$. (Note that $A$ is essentially of finite
type over $\Lambda$; at the end of the proof we will show how to obtain
an $A$ which is of finite type over $\Lambda$.) There is a ring map
$C \to A$ sending $y_i \mapsto a'_i$ because the $a'_i$ satisfy
the desired equations modulo $(b'_1, \ldots, b'_r)$.
Note that $A/\mathfrak m_A^N = R/\mathfrak m_R^N$ as quotients of
$P = B^\wedge$ by property (2) above. Set $x_A = x_C|_{\Spec(A)}$.
Since the maps
$$
C \to A \to A/\mathfrak m_A^N \cong R/\mathfrak m_R^N
\quad\text{and}\quad
C \to R \to R/\mathfrak m_R^N
$$
are equal we see that $x_A$ and $x$ agree modulo $\mathfrak m_R^N$
via the isomorphism $A/\mathfrak m_A^N = R/\mathfrak m_R^N$. At this
point we have shown properties (1) -- (5) of the statement of the lemma.
To see (6) note that
$$
P^{\oplus t} \xrightarrow{K}
P^{\oplus r} \xrightarrow{(b_1, \ldots, b_r)}
P
\quad\text{and}\quad
P^{\oplus t} \xrightarrow{K'}
P^{\oplus r} \xrightarrow{(b'_1, \ldots, b'_r)}
P
$$
are two complexes of $P$-modules which are congruent modulo
$(\mathfrak m')^N$ with the first one being exact. By our choice of $N$
above we see from
More on Algebra, Lemma \ref{more-algebra-lemma-approximate-complex-graded}
that $R = P/(b_1, \ldots, b_r)$ and
$P/(b'_1, \ldots, b'_r) = B^\wedge/(b'_1, \ldots, b'_r) = A^\wedge$
have isomorphic associated graded algebras, which is what we wanted to show.

\medskip\noindent
This last paragraph of the proof serves to clean up the issue that $A$ is
essentially of finite type over $S$ and not yet of finite type.
The construction above gives $A = B/(b'_1, \ldots, b'_r)$ and
$\mathfrak m_A \subset A$ with $B$ \'etale over
$\Lambda[x_1, \ldots, x_s]_{\mathfrak m'}$. Hence $A$ is of finite
type over the Noetherian ring $\Lambda[x_1, \ldots, x_s]_{\mathfrak m'}$.
Thus we can write $A = (A_0)_{\mathfrak m'}$ for some finite type
$\Lambda[x_1, \ldots, x_n]$ algebra $A_0$. Then
$A = \colim (A_0)_f$ where
$f \in \Lambda[x_1, \ldots, x_n] \setminus \mathfrak m'$, see
Algebra, Lemma \ref{algebra-lemma-localization-colimit}.
Because $\mathcal{X}$ is limit preserving on objects, we see that
$x_A$ comes from some object $x_{(A_0)_f}$ over $\Spec((A_0)_f)$ for
an $f$ as above. After replacing $A$ by $(A_0)_f$ and $x_A$ by
$x_{(A_0)_f}$ and $\mathfrak m_A$ by $(A_0)_f \cap \mathfrak m_A$
the proof is finished.
\end{proof}










\section{Examples of deformation problems}
\label{section-examples}

\noindent
List of things that should go here:
\begin{enumerate}
\item Describe the general outline of an example.
\item Deformations of schemes:
\begin{enumerate}
\item The Rim-Schlessinger condition.
\item Computing the tangent space.
\item Computing the infinitesimal deformations.
\item The deformation category of an affine hypersurface.
\end{enumerate}
\item Deformations of representations of abstract groups.
\item Deformations of representations of topological groups
(e.g., profinite ones).
\item Deformations of sheaves (for example fix $X/S$, a finite type point
$s$ of $S$, and a quasi-coherent sheaf $\mathcal{F}_s$ over $X_s$).
\item Deformations of algebraic spaces (very similar to deformations
of schemes; maybe even easier?).
\item Deformations of maps (eg morphisms between schemes; you can fix
both or one of the target and/or source).
\item Add more here.
\end{enumerate}










\input{chapters}

\bibliography{my}
\bibliographystyle{amsalpha}

\end{document}
