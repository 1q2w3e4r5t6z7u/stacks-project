\input{preamble}

% OK, start here.
%
\begin{document}

\title{Functors and Morphisms}


\maketitle

\phantomsection
\label{section-phantom}

\tableofcontents

\section{Introduction}
\label{section-introduction}

\noindent
Let $X$ and $Y$ be schemes. This chapter circles around the relationship
between functors $\QCoh(\mathcal{O}_Y) \to \QCoh(\mathcal{O}_X)$ and
morphisms of schemes $X \to Y$. More broadly speaking we study the
relationship between $\QCoh(\mathcal{O}_X)$ and $X$ or, if $X$ is Noetherian,
the relationship between $\textit{Coh}(\mathcal{O}_X)$ and $X$.
This relationship was studied in \cite{Gabriel}.






\section{Functors on module categories}
\label{section-preliminary}

\noindent
For a ring $A$ let us denote $\text{Mod}^{fp}_A$ the category of
finitely presented $A$-modules.

\begin{lemma}
\label{lemma-functor-on-fp-modules}
Let $A$ be a ring. Let $\mathcal{B}$ be a category having filtered
colimits. Let $F : \text{Mod}^{fp}_A \to \mathcal{B}$ be a functor. Then $F$
extends uniquely to a functor $F' : \text{Mod}_A \to \mathcal{B}$
which commutes with filtered colimits.
\end{lemma}

\begin{proof}
This follows from
Categories, Lemma \ref{categories-lemma-extend-functor-by-colim}.
To see that the lemma applies observe that
finitely presented $A$-modules are
categorically compact objects of $\text{Mod}_A$ by
Algebra, Lemma \ref{algebra-lemma-characterize-finitely-presented-module-hom}.
Also, every $A$-module is a filtered colimit
of finitely presented $A$-modules by
Algebra, Lemma \ref{algebra-lemma-module-colimit-fp}.
\end{proof}

\noindent
If a category $\mathcal{B}$ is additive and has filtered colimits,
then $\mathcal{B}$ has arbitrary direct sums: any direct sum can be written
as a filtered colimit of finite direct sums.

\begin{lemma}
\label{lemma-functor-on-fp-modules-additive}
Let $A$, $\mathcal{B}$, $F$ be as in Lemma \ref{lemma-functor-on-fp-modules}.
Assume $\mathcal{B}$ is additive and $F$ is additive. Then
$F'$ is additive and commutes with arbitrary direct sums.
\end{lemma}

\begin{proof}
To show that $F'$ is additive it suffices to show
that $F'(M) \oplus F'(M') \to F'(M \oplus M')$ is an isomorphism for
any $A$-modules $M$, $M'$, see
Homology, Lemma \ref{homology-lemma-additive-functor}.
Write $M = \colim_i M_i$ and $M' = \colim_j M'_j$ as filtered colimits
of finitely presented $A$-modules $M_i$. Then
$F'(M) = \colim_i F(M_i)$, $F'(M') = \colim_j F(M'_j)$, and
\begin{align*}
F'(M \oplus M')
& =
F'(\colim_{i, j} M_i \oplus M'_j) \\
& =
\colim_{i, j} F(M_i \oplus M'_j) \\
& =
\colim_{i, j} F(M_i) \oplus F(M'_j) \\
& =
F'(M) \oplus F'(M')
\end{align*}
as desired. To show that $F'$ commutes with direct sums, assume
we have $M = \bigoplus_{i \in I} M_i$. Then
$M = \colim_{I' \subset I\text{ finite}} \bigoplus_{i \in I'} M_i$
is a filtered colimit. We obtain
\begin{align*}
F'(M)
& =
\colim_{I' \subset I\text{ finite}}
F'(\bigoplus\nolimits_{i \in I'} M_i) \\
& =
\colim_{I' \subset I\text{ finite}}
\bigoplus\nolimits_{i \in I'} F'(M_i) \\
& =
\bigoplus\nolimits_{i \in I} F'(M_i)
\end{align*}
The second equality holds by the additivity of $F'$ already shown.
\end{proof}

\noindent
If a category $\mathcal{B}$ is additive, has filtered colimits, and
has cokernels, then $\mathcal{B}$ has arbitrary colimits, see
discussion above and Categories, Lemma
\ref{categories-lemma-colimits-coproducts-coequalizers}.

\begin{lemma}
\label{lemma-functor-on-fp-modules-right-exact}
Let $A$, $\mathcal{B}$, $F$ be as in Lemma \ref{lemma-functor-on-fp-modules}.
Assume $\mathcal{B}$ is additive, has cokernels, and $F$ is right exact. Then
$F'$ is additive, right exact, and commutes with arbitrary direct sums.
\end{lemma}

\begin{proof}
Since $F$ is right exact, $F$ commutes with coproducts of pairs, which are
represented by direct sums. Hence $F$ is additive by
Homology, Lemma \ref{homology-lemma-additive-functor}.
Hence $F'$ is additive and commutes with direct sums by
Lemma \ref{lemma-functor-on-fp-modules-additive}.
We urge the reader to prove that $F'$ is right exact themselves
instead of reading the proof below.

\medskip\noindent
To show that $F'$ is right exact, it suffices to show that $F'$ commutes
with coequalizers, see
Categories, Lemma \ref{categories-lemma-characterize-right-exact}.
Now, if $a, b : K \to L$ are maps of $A$-modules, then the
coequalizer of $a$ and $b$ is the cokernel of $a - b : K \to L$.
Thus let $K \to L \to M \to 0$ be an exact sequence
of $A$-modules. We have to show that in
$$
F'(K) \to F'(L) \to F'(M) \to 0
$$
the second arrow is a cokernel for the first arrow in $\mathcal{B}$
(if $\mathcal{B}$ were abelian we would say that the displayed sequence
is exact).
Write $M = \colim_{i \in I} M_i$ as a filtered colimit of finitely
presented $A$-modules, see
Algebra, Lemma \ref{algebra-lemma-module-colimit-fp}.
Let $L_i = L \times_M M_i$. 
We obtain a system of exact sequences $K \to L_i \to M_i \to 0$ over $I$.
Since colimits commute with colimits by
Categories, Lemma \ref{categories-lemma-colimits-commute}
and since cokernels are a type of coequalizer,
it suffices to show that $F'(L_i) \to F(M_i)$ is a cokernel of
$F'(K) \to F'(L_i)$ in $\mathcal{B}$ for all $i \in I$. In other words, we may
assume $M$ is finitely presented. Write $L = \colim_{i \in I} L_i$
as a filtered colimit of finitely presented $A$-modules
with the property that each $L_i$ surjects onto $M$.
Let $K_i = K \times_L L_i$. We obtain a system of short exact sequences
$K_i \to L_i \to M \to 0$ over $I$.
Repeating the argument already given, we reduce to showing
$F(L_i) \to F(M_i)$ is a cokernel of
$F'(K) \to F(L_i)$ in $\mathcal{B}$ for all $i \in I$.
In other words, we may assume both
$L$ and $M$ are finitely presented $A$-modules.
In this case the module $\Ker(L \to M)$ is finite
(Algebra, Lemma \ref{algebra-lemma-extension}).
Thus we can write $K = \colim_{i \in I} K_i$ as a filtered colimit
of finitely presented $A$-modules each surjecting onto $\Ker(L \to M)$.
We obtain a system of short exact sequences
$K_i \to L \to M \to 0$ over $I$.
Repeating the argument already given, we reduce to showing
$F(L) \to F(M)$ is a cokernel of
$F(K_i) \to F(L)$ in $\mathcal{B}$ for all $i \in I$.
In other words, we may assume $K$, $L$, and $M$
are finitely presented $A$-modules. This final case follows
from the assumption that $F$ is right exact.
\end{proof}

\noindent
If a category $\mathcal{B}$ is additive and has kernels,
then $\mathcal{B}$ has finite limits. Namely, finite products
are direct sums which exist and the equalizer of $a, b : L \to M$
is the kernel of $a - b : K \to L$ which exists. Thus all finite
limits exist by Categories, Lemma \ref{categories-lemma-finite-limits-exist}.

\begin{lemma}
\label{lemma-functor-on-fp-modules-left-exact}
Let $A$, $\mathcal{B}$, $F$ be as in Lemma \ref{lemma-functor-on-fp-modules}.
Assume $A$ is a coherent ring (Algebra, Definition
\ref{algebra-definition-coherent}), $\mathcal{B}$ is additive, has kernels,
filtered colimits commute with taking kernels, and $F$ is left exact. Then
$F'$ is additive, left exact, and commutes with arbitrary direct sums.
\end{lemma}

\begin{proof}
Since $A$ is coherent, the category $\text{Mod}^{fp}_A$ is abelian
with same kernels and cokernels as in $\text{Mod}_A$, see
Algebra, Lemmas \ref{algebra-lemma-coherent-ring} and
\ref{algebra-lemma-coherent}. Hence all finite limits exist in
$\text{Mod}^{fp}_A$ and
Categories, Definition \ref{categories-definition-exact} applies.
Since $F$ is left exact, $F$ commutes with products of pairs, which are
represented by direct sums. Hence $F$ is additive by
Homology, Lemma \ref{homology-lemma-additive-functor}.
Hence $F'$ is additive and commutes with direct sums by
Lemma \ref{lemma-functor-on-fp-modules-additive}.
We urge the reader to prove that $F'$ is left exact themselves
instead of reading the proof below.

\medskip\noindent
To show that $F'$ is left exact, it suffices to show that $F'$ commutes
with equalizers, see
Categories, Lemma \ref{categories-lemma-characterize-left-exact}.
Now, if $a, b : L \to M$ are maps of $A$-modules, then the
equalizer of $a$ and $b$ is the kernel of $a - b : L \to M$.
Thus let $0 \to K \to L \to M$ be an exact sequence
of $A$-modules. We have to show that in
$$
0 \to F'(K) \to F'(L) \to F'(M)
$$
the arrow $F'(K) \to F'(L)$ is a kernel for $F'(L) \to F'(M)$ in $\mathcal{B}$
(if $\mathcal{B}$ were abelian we would say that the displayed sequence
is exact).
Write $M = \colim_{i \in I} M_i$ as a filtered colimit of finitely
presented $A$-modules, see
Algebra, Lemma \ref{algebra-lemma-module-colimit-fp}.
Let $L_i = L \times_M M_i$. 
We obtain a system of exact sequences $0 \to K \to L_i \to M_i$
over $I$. Since filtered colimits commute with taking kernels
in $\mathcal{B}$ by assumption, 
it suffices to show that $F'(K) \to F'(L_i)$ is a kernel of
$F'(L_i) \to F(M_i)$ in $\mathcal{B}$ for all $i \in I$. In other words, we may
assume $M$ is finitely presented. Write $L = \colim_{i \in I} L_i$
as a filtered colimit of finitely presented $A$-modules.
Let $K_i = K \times_L L_i$. We obtain a system of short exact sequences
$0 \to K_i \to L_i \to M$ over $I$.
Repeating the argument already given, we reduce to showing
$F'(K_i) \to F(L_i)$ is a kernel of
$F(L_i) \to F(M)$ in $\mathcal{B}$ for all $i \in I$.
In other words, we may assume both
$L$ and $M$ are finitely presented $A$-modules.
Since $A$ is coherent, the $A$-module $K = \Ker(L \to M)$ is
of finite presentation as the category of finitely presented
$A$-modules is abelian (see references given above).
In other words, all three modules $K$, $L$, and $M$
are finitely presented $A$-modules. This final case follows
from the assumption that $F$ is left exact.
\end{proof}

\noindent
If a category $\mathcal{B}$ is additive and has cokernels,
then $\mathcal{B}$ has finite colimits. Namely, finite coproducts
are direct sums which exist and the coequalizer of $a, b : K \to L$
is the cokernel of $a - b : K \to L$ which exists. Thus all finite
colimits exist by Categories, Lemma \ref{categories-lemma-colimits-exist}.

\begin{lemma}
\label{lemma-functor-on-modules-fp}
Let $A$ be a ring. Let $\mathcal{B}$ be an additive category
with cokernels. There is an equivalence of categories between
\begin{enumerate}
\item the category of functors $F : \text{Mod}^{fp}_A \to \mathcal{B}$
which are right exact, and
\item the category of pairs $(K, \kappa)$ where $K \in \Ob(\mathcal{B})$
and $\kappa : A \to \text{End}_\mathcal{B}(K)$ is a ring homomorphism
\end{enumerate}
given by the rule sending $F$ to $F(A)$ with its natural $A$-action.
\end{lemma}

\begin{proof}
Let $(K, \kappa)$ be as in (2). We will construct a functor
$F : \text{Mod}^{fp}_A \to \mathcal{B}$ such that $F(A) = K$
endowed with the given $A$-action $\kappa$. Namely, given an
integer $n \geq 0$ let us set
$$
F(A^{\oplus n}) = K^{\oplus n}
$$
Given an $A$-linear map $\varphi : A^{\oplus m} \to A^{\oplus n}$
with matrix $(a_{ij}) \in \text{Mat}(n \times m, A)$ we define
$$
F(\varphi) :
F(A^{\oplus m}) = K^{\oplus m}
\longrightarrow
K^{\oplus n} = F(A^{\oplus n})
$$
to be the map with matrix $(\kappa(a_{ij}))$. This defines an additive
functor $F$ from the full subcategory of
$\text{Mod}^{fp}_A$ with objects $0$, $A$, $A^{\oplus 2}$, $\ldots$
to $\mathcal{B}$; we omit the verification.

\medskip\noindent
For each object $M$ of $\text{Mod}^{fp}_A$ choose a presentation
$$
A^{\oplus m_M} \xrightarrow{\varphi_M} A^{\oplus n_M} \to M \to 0
$$
of $M$ as an $A$-module. Let us use the trivial presentation
$0 \to A^{\oplus n} \xrightarrow{1} A^{\oplus n} \to 0$ if $M = A^{\oplus n}$
(this isn't necessary but simplifies the exposition).
For each morphism $f : M \to N$ of
$\text{Mod}^{fp}_A$ we can choose a commutative diagram
\begin{equation}
\label{equation-map}
\vcenter{
\xymatrix{
A^{\oplus m_M} \ar[r]_{\varphi_M} \ar[d]_{\psi_f} &
A^{\oplus n_M} \ar[r] \ar[d]_{\chi_f} &
M \ar[r] \ar[d]_f & 0 \\
A^{\oplus m_N} \ar[r]^{\varphi_N} &
A^{\oplus n_N} \ar[r] &
N \ar[r] & 0
}
}
\end{equation}
Having made these choices we can define: for an object
$M$ of $\text{Mod}^{fp}_A$ we set
$$
F(M) = \Coker(F(\varphi_M) : F(A^{\oplus m_M}) \to F(A^{\oplus n_M}))
$$
and for a morphism $f : M \to N$ of $\text{Mod}^{fp}_A$ we set
$$
F(f) = \text{the map }F(M) \to F(N)\text{ induced by }
F(\psi_f)\text{ and }F(\chi_f)\text{ on cokernels}
$$
Note that this rule extends the given functor $F$ on
the full subcategory consisting of the free modules $A^{\oplus n}$.
We still have to show that $F$ is a functor, that $F$ is additive,
and that $F$ is right exact.

\medskip\noindent
Let $f : M \to N$ be a morphism $\text{Mod}^{fp}_A$. We claim that the map
$F(f)$ defined above is independent of the choices of $\psi_f$ and $\chi_f$
in (\ref{equation-map}). Namely, say
$$
\xymatrix{
A^{\oplus m_M} \ar[r]_{\varphi_M} \ar[d]_\psi &
A^{\oplus n_M} \ar[r] \ar[d]_\chi &
M \ar[r] \ar[d]_f & 0 \\
A^{\oplus m_N} \ar[r]^{\varphi_N} &
A^{\oplus n_N} \ar[r] &
N \ar[r] & 0
}
$$
is also commutative. Denote $F(f)' : F(M) \to F(N)$ the map
induced by $F(\psi)$ and $F(\chi)$. Looking at the commutative
diagrams, by elementary commutative algebra there exists a map
$\omega : A^{\oplus n_M} \to A^{\oplus m_N}$ such that
$\chi = \chi_f + \varphi_N \circ \omega$. Applying $F$ we
find that $F(\chi) = F(\chi_f) + F(\varphi_N) \circ F(\omega)$.
As $F(N)$ is the cokernel of $F(\varphi_N)$ we find
that the map $F(A^{\oplus n_M}) \to F(M)$ equalizes $F(f)$ and $F(f)'$.
Since a cokernel is an epimorphism, we conclude that $F(f) = F(f)'$.

\medskip\noindent
Let us prove $F$ is a functor. First, observe that
$F(\text{id}_M) = \text{id}_{F(M)}$ because we may pick
the identities for $\psi_f$ and $\chi_f$ in the diagram above
in case $f = \text{id}_M$. Second, suppose we have
$f : M \to N$ and $g : L \to M$. Then we see that
$\psi = \psi_f \circ \psi_g$ and $\chi = \chi_f \circ \chi_g$
fit into (\ref{equation-map}) for $f \circ g$.
Hence these induce the correct map which exactly
says that $F(f) \circ F(g) = F(f \circ g)$.

\medskip\noindent
Let us prove that $F$ is additive. Namely, suppose we have
$f, g : M \to N$. Then we see that $\psi = \psi_f + \psi_g$ and
$\chi = \chi_f + \chi_g$ fit into (\ref{equation-map}) for $f + g$.
Hence these induce the correct map which exactly
says that $F(f) + F(g) = F(f + g)$.

\medskip\noindent
Finally, let us prove that $F$ is right exact. It suffices to show that $F$
commutes with coequalizers, see
Categories, Lemma \ref{categories-lemma-characterize-right-exact}.
For this, it suffices to prove that $F$ commutes with cokernels.
Let $K \to L \to M \to 0$ be an exact sequence of $A$-modules
with $K$, $L$, $M$ finitely presented. Since $F$ is an additive
functor, this certainly gives a complex
$$
F(K) \to F(L) \to F(M) \to 0
$$
and we have to show that the second arrow is the cokernel of the first
in $\mathcal{B}$. In any case, we obtain a map
$\Coker(F(K) \to F(L)) \to F(M)$.
By elementary commutative algebra there exists a commutative diagram
$$
\xymatrix{
A^{\oplus m_M} \ar[r]_{\varphi_M} \ar[d]_\psi &
A^{\oplus n_M} \ar[r] \ar[d]_\chi &
M \ar[r] \ar[d]_1 & 0 \\
K \ar[r] &
L \ar[r] &
M \ar[r] & 0
}
$$
Applying $F$ to this diagram and using the construction of $F(M)$ as
the cokernel of $F(\varphi_M)$ we find there exists a map
$F(M) \to \Coker(F(K) \to F(L))$ which is a right inverse
to the map $\Coker(F(K) \to F(L)) \to F(M)$. This first implies
that $F(L) \to F(M)$ is an epimorphism always. Next, the above shows
we have
$$
\Coker(F(K) \to F(L)) = F(M) \oplus E
$$
where the direct sum decomposition is compatible with both
$F(M) \to \Coker(F(K) \to F(L))$ and $\Coker(F(K) \to F(L)) \to F(M)$.
However, then the epimorphism $p : F(L) \to E$ becomes zero both
after composition with $F(K) \to F(L)$ and after composition
with $F(A^{n_M}) \to F(L)$. However, since $K \oplus A^{n_M} \to L$
is surjective (algebra argument omitted), we conclude that
$F(K \oplus A^{n_M}) \to F(L)$ is an epimorphism (by the above)
whence $E = 0$. This finishes the proof.
\end{proof}

\begin{lemma}
\label{lemma-functor-on-modules}
Let $A$ be a ring. Let $\mathcal{B}$ be an additive category
with arbitrary direct sums and cokernels. There is an equivalence
of categories between
\begin{enumerate}
\item the category of functors $F : \text{Mod}_A \to \mathcal{B}$
which are right exact and commute with arbitrary direct sums, and
\item the category of pairs $(K, \kappa)$ where $K \in \Ob(\mathcal{B})$
and $\kappa : A \to \text{End}_\mathcal{B}(K)$ is a ring homomorphism
\end{enumerate}
given by the rule sending $F$ to $F(A)$ with its natural $A$-action.
\end{lemma}

\begin{proof}
Combine Lemmas \ref{lemma-functor-on-modules-fp} and
\ref{lemma-functor-on-fp-modules-right-exact}.
\end{proof}






\section{Functors between categories of modules}
\label{section-functors}

\noindent
The following lemma is archetypical of the results in this chapter.

\begin{lemma}
\label{lemma-functor}
Let $A$ and $B$ be rings. Let $F : \text{Mod}_A \to \text{Mod}_B$
be a functor. The following are equivalent
\begin{enumerate}
\item $F$ is isomorphic to the functor $M \mapsto M \otimes_A K$
for some $A \otimes_\mathbf{Z} B$-module $K$,
\item $F$ is right exact and commutes with all direct sums,
\item $F$ commutes with all colimits,
\item $F$ has a right adjoint $G$.
\end{enumerate}
\end{lemma}

\begin{proof}
If (1), then (4) as a right adjoint for $M \mapsto M \otimes_A K$
is $N \mapsto \Hom_B(K, N)$, see
Differential Graded Algebra, Lemma \ref{dga-lemma-tensor-hom-adjunction}.
If (4), then (3) by Categories, Lemma \ref{categories-lemma-adjoint-exact}.
The implication (3) $\Rightarrow$ (2) is immediate from the definitions.

\medskip\noindent
Assume (2). We will prove (1). By the discussion in
Homology, Section \ref{homology-section-functors}
the functor $F$ is additive. Hence $F$ induces
a ring map $A \to \text{End}_B(F(M))$, $a \mapsto F(a \cdot \text{id}_M)$
for every $A$-module $M$. We conclude that $F(M)$ is an
$A \otimes_\mathbf{Z} B$-module functorially in $M$.
Set $K = F(A)$. Define
$$
M \otimes_A K = M \otimes_A F(A) \longrightarrow F(M),
\quad m \otimes k \longmapsto F(\varphi_m)(k)
$$
Here $\varphi_m : A \to M$ sends $a \to am$. The rule
$(m, k) \mapsto F(\varphi_m)(k)$ is $A$-bilinear (and $B$-linear
on the right) as required to obtain the displayed
$A \otimes_\mathbf{Z} B$-linear map.
This construction is functorial in $M$, hence defines a transformation
of functors $- \otimes_A K \to F(-)$ which is an isomorphism when
evaluated on $A$. For every $A$-module $M$ we can choose an exact sequence
$$
\bigoplus\nolimits_{j \in J} A \to
\bigoplus\nolimits_{i \in I} A \to
M \to 0
$$
Using the maps constructed above we find a commutative diagram
$$
\xymatrix{
(\bigoplus\nolimits_{j \in J} A) \otimes_A K \ar[r] \ar[d] &
(\bigoplus\nolimits_{i \in I} A) \otimes_A K \ar[r] \ar[d] &
M \otimes_A K \ar[r] \ar[d] &
0 \\
F(\bigoplus\nolimits_{j \in J} A) \ar[r] &
F(\bigoplus\nolimits_{i \in I} A) \ar[r] &
F(M) \ar[r] &  0
}
$$
The lower row is exact as $F$ is right exact.
The upper row is exact as tensor product with $K$ is right exact.
Since $F$ commutes with direct sums the left two vertical arrows
are bijections. Hence we conclude.
\end{proof}

\begin{example}
\label{example-functor-modules}
Let $R$ be a ring. Let $A$ and $B$ be $R$-algebras. Let $K$ be a
$A \otimes_R B$-module. Then we can consider the functor
\begin{equation}
\label{equation-FM-modules}
F : \text{Mod}_A \longrightarrow \text{Mod}_B,\quad
M \longmapsto M \otimes_A K
\end{equation}
This functor is $R$-linear, right exact,
commutes with arbitrary direct sums, commutes
with all colimits, has a right adjoint (Lemma \ref{lemma-functor}).
\end{example}

\begin{lemma}
\label{lemma-functor-modules}
Let $R$ be a ring. Let $A$ and $B$ be $R$-algebras. There is an
equivalence of categories between
\begin{enumerate}
\item the category of $R$-linear functors
$F : \text{Mod}_A \to \text{Mod}_B$ which
are right exact and commute with arbitrary direct sums, and
\item the category $\text{Mod}_{A \otimes_R B}$.
\end{enumerate}
given by sending $K$ to the functor $F$ in (\ref{equation-FM-modules}).
\end{lemma}

\begin{proof}
Let $F$ be an object of the first category. By
Lemma \ref{lemma-functor} we may assume $F(M) = M \otimes_A K$
functorially in $M$ for some $A \otimes_\mathbf{Z} B$-module $K$.
The $R$-linearity of $F$ immediately implies that the
$A \otimes_\mathbf{Z} B$-module structure on $K$ comes
from a (unique) $A \otimes_R B$-module structure on $K$.
Thus we see that sending $K$ to $F$ as in (\ref{equation-FM-modules})
is essentially surjective.

\medskip\noindent
To prove that our functor is fully faithful, we have to show that
given $A \otimes_R B$-modules $K$ and $K'$ any transformation
$t : F \to F'$ between the corresponding functors, comes from
a unique $\varphi : K \to K'$. Since $K = F(A)$ and $K' = F'(A)$
we can take $\varphi$ to be the value $t_A : F(A) \to F'(A)$
of $t$ at $A$. This maps is $A \otimes_R B$-linear by the
definition of the $A \otimes B$-module structure on $F(A)$
and $F'(A)$ given in the proof of Lemma \ref{lemma-functor}.
\end{proof}

\begin{remark}
\label{remark-composition}
Let $R$ be a ring. Let $A$, $B$, $C$ be $R$-algebras.
Let $F : \text{Mod}_A \to \text{Mod}_B$ and
$F' : \text{Mod}_B \to \text{Mod}_C$ be
$R$-linear, right exact functors which commute with arbitrary direct sums.
If by the equivalence of Lemma \ref{lemma-functor-modules} the object
$K$ in $\text{Mod}_{A \otimes_R B}$ corresponds to $F$ and the object
$K'$ in $\text{Mod}_{B \otimes_R C}$ corresponds to $F'$, then
$K \otimes_B K'$ viewed as an object of
$\text{Mod}_{A \otimes_R C}$ corresponds to $F' \circ F$.
\end{remark}

\begin{remark}
\label{remark-exact-flat}
In the situation of Lemma \ref{lemma-functor-modules}
suppose that $F$ corresponds to $K$. Then
$F$ is exact $\Leftrightarrow$ $K$ is flat over $A$.
\end{remark}

\begin{remark}
\label{remark-finite}
In the situation of Lemma \ref{lemma-functor-modules}
suppose that $F$ corresponds to $K$. Then
$F$ sends finite $A$-modules to finite $B$-modules
$\Leftrightarrow$ $K$ is finite as a $B$-module.
\end{remark}

\begin{remark}
\label{remark-finite-presentation}
In the situation of Lemma \ref{lemma-functor-modules}
suppose that $F$ corresponds to $K$. Then
$F$ sends finitely presented $A$-modules to finitely presented $B$-modules
$\Leftrightarrow$ $K$ is finitely presented as a $B$-module.
\end{remark}

\begin{lemma}
\label{lemma-functor-equivalence}
Let $A$ and $B$ be rings. If
$$
F : \text{Mod}_A \longrightarrow \text{Mod}_B
$$
is an equivalence of categories, then there exists an isomorphism
$A \to B$ of rings and an invertible $B$-module $L$ such that
$F$ is isomorphic to the functor $M \mapsto (M \otimes_A B) \otimes_B L$.
\end{lemma}

\begin{proof}
Since an equivalence commutes with all colimits, we see that
Lemmas \ref{lemma-functor} applies. Let $K$ be the
$A \otimes_\mathbf{Z} B$-module such that $F$ is
isomorphic to the functor $M \mapsto M \otimes_A K$.
Let $K'$ be the $B \otimes_\mathbf{Z} A$-module such that
a quasi-inverse of $F$ is
isomorphic to the functor $N \mapsto N \otimes_B K'$.
By Remark \ref{remark-composition} and
Lemma \ref{lemma-functor-modules} we have an isomorphism
$$
\psi : K \otimes_B K' \longrightarrow A
$$
of $A \otimes_\mathbf{Z} A$-modules.
Similarly, we have an isomorphism
$$
\psi' : K' \otimes_A K \longrightarrow B
$$
of $B \otimes_\mathbf{Z} B$-modules. Choose an element
$\xi = \sum_{i = 1, \ldots, n} x_i \otimes y_i \in K \otimes_B K'$
such that $\psi(\xi) = 1$. Consider the isomorphisms
$$
K \xrightarrow{\psi^{-1} \otimes \text{id}_K}
K \otimes_B K' \otimes_A K \xrightarrow{\text{id}_K \otimes \psi'} K
$$
The composition is an isomorphism and given by
$$
k \longmapsto \sum x_i \psi'(y_i \otimes k)
$$
We conclude this automorphism factors as
$$
K \to B^{\oplus n} \to K
$$
as a map of $B$-modules. It follows that $K$ is finite
projective as a $B$-module.

\medskip\noindent
We claim that $K$ is invertible as a $B$-module. This is equivalent
to asking the rank of $K$ as a $B$-module to have the constant value $1$,
see More on Algebra, Lemma \ref{more-algebra-lemma-invertible} and
Algebra, Lemma \ref{algebra-lemma-finite-projective}.
If not, then there exists a maximal ideal $\mathfrak m \subset B$
such that either (a) $K \otimes_B B/\mathfrak m = 0$ or
(b) there is a surjection $K \to (B/\mathfrak m)^{\oplus 2}$ of
$B$-modules. Case (a) is absurd as $K' \otimes_A K \otimes_B N = N$
for all $B$-modules $N$. Case (b) would imply we get a surjection
$$
A = K \otimes_B K' \longrightarrow (B/\mathfrak m \otimes_B K')^{\oplus 2}
$$
of (right) $A$-modules. This is impossible as the target is an $A$-module
which needs at least two generators: $B/\mathfrak m \otimes_B K'$
is nonzero as the image of the nonzero module $B/\mathfrak m$ under
the quasi-inverse of $F$.

\medskip\noindent
Since $K$ is invertible as a $B$-module we see that $\Hom_B(K, K) = B$.
Since $K = F(A)$ the action of $A$ on $K$ defines a ring isomorphism
$A \to B$. The lemma follows.
\end{proof}

\begin{lemma}
\label{lemma-functor-equivalence-linear}
Let $R$ be a ring. Let $A$ and $B$ be $R$-algebras. If
$$
F : \text{Mod}_A \longrightarrow \text{Mod}_B
$$
is an $R$-linear equivalence of categories, then there exists an isomorphism
$A \to B$ of $R$-algebras and an invertible $B$-module $L$ such that
$F$ is isomorphic to the functor $M \mapsto (M \otimes_A B) \otimes_B L$.
\end{lemma}

\begin{proof}
We get $A \to B$ and $L$ from Lemma \ref{lemma-functor-equivalence}.
To finish the proof, we need to show that the $R$-linearity
of $F$ forces $A \to B$ to be an $R$-algebra map. We omit the details.
\end{proof}

\begin{remark}
\label{remark-monoidal}
Let $A$ and $B$ be rings. Let us endow $\text{Mod}_A$ and $\text{Mod}_B$
with the usual monoidal structure given by tensor products of modules.
Let $F : \text{Mod}_A \to \text{Mod}_B$ be a functor of
monoidal categories, see
Categories, Definition \ref{categories-definition-functor-monoidal-categories}.
Here are some comments:
\begin{enumerate}
\item Since $F(A)$ is a unit (by our definitions) we have $F(A) = B$.
\item We obtain a multiplicative map $\varphi : A \to B$
by sending $a \in A$ to its action on $F(A) = B$.
\item Take $A = B$ and $F(M) = M \otimes_A M$. In this case $\varphi(a) = a^2$.
\item If $F$ is additive, then $\varphi$ is a ring map.
\item Take $A = B = \mathbf{Z}$ and $F(M) = M/\text{torsion}$. Then
$\varphi = \text{id}_\mathbf{Z}$ but $F$ is not the identity functor.
\item If $F$ is right exact and commutes with direct sums,
then $F(M) = M \otimes_{A, \varphi} B$ by Lemma \ref{lemma-functor}.
\end{enumerate}
In other words, ring maps $A \to B$ are in bijection with isomorphism classes
of functors of monoidal categories $\text{Mod}_A \to \text{Mod}_B$
which commute with all colimits.
\end{remark}




\section{Extending functors on categories of modules}
\label{section-functors-extend}

\noindent
For a ring $A$ let us denote $\text{Mod}^{fp}_A$ the category of
finitely presented $A$-modules.

\begin{lemma}
\label{lemma-functor-fp-modules}
Let $A$ and $B$ be rings. Let
$F : \text{Mod}^{fp}_A \to \text{Mod}^{fp}_B$ be a functor.
Then $F$ extends uniquely to a functor
$F' : \text{Mod}_A \to \text{Mod}_B$
which commutes with filtered colimits.
\end{lemma}

\begin{proof}
Special case of Lemma \ref{lemma-functor-on-fp-modules}.
\end{proof}

\begin{remark}
\label{remark-monoidal-extension}
With $A$, $B$, $F$, and $F'$ as in Lemma \ref{lemma-functor-fp-modules}.
Observe that the tensor product of two finitely presented modules is
finitely presented, see Algebra, Lemma \ref{algebra-lemma-tensor-finiteness}.
Thus we may endow $\text{Mod}^{fp}_A$, $\text{Mod}^{fp}_B$,
$\text{Mod}_A$, and $\text{Mod}_B$ with the usual monoidal structure
given by tensor products of modules. In this case, if $F$ is
a functor of monoidal categories, so is $F'$. This follows immediately
from the fact that tensor products of modules commutes with filtered
colimits.
\end{remark}

\begin{lemma}
\label{lemma-functor-fp-modules-exact}
With $A$, $B$, $F$, and $F'$ as in Lemma \ref{lemma-functor-fp-modules}.
\begin{enumerate}
\item If $F$ is additive, then $F'$ is additive and
commutes with arbitrary direct sums, and
\item if $F$ is right exact, then $F'$ is right exact.
\end{enumerate}
\end{lemma}

\begin{proof}
Follows from Lemmas \ref{lemma-functor-on-fp-modules-additive} and
\ref{lemma-functor-on-fp-modules-right-exact}.
\end{proof}

\begin{remark}
\label{remark-monoidal-extension-exact}
Combining Remarks \ref{remark-monoidal} and \ref{remark-monoidal-extension}
and Lemma \ref{lemma-functor-fp-modules-exact}
we find the following. Given rings $A$ and $B$ the set of ring maps $A \to B$
is in bijection with the set of isomorphism classes
of functors of monoidal categories $\text{Mod}^{fp}_A \to \text{Mod}^{fp}_B$
which are right exact.
\end{remark}

\begin{lemma}
\label{lemma-functor-fp-modules-left-exact}
With $A$, $B$, $F$, and $F'$ as in Lemma \ref{lemma-functor-fp-modules}.
Assume $A$ is a coherent ring
(Algebra, Definition \ref{algebra-definition-coherent}).
If $F$ is left exact, then $F'$ is left exact.
\end{lemma}

\begin{proof}
Special case of Lemma \ref{lemma-functor-on-fp-modules-left-exact}.
\end{proof}

\noindent
For a ring $A$ let us denote $\text{Mod}^{fg}_A$ the category of
finitely generated $A$-modules (AKA finite $A$-modules).

\begin{lemma}
\label{lemma-functor-finite-modules}
Let $A$ and $B$ be Noetherian rings. Let
$F : \text{Mod}^{fg}_A \to \text{Mod}^{fg}_B$ be a functor.
Then $F$ extends uniquely to a functor $F' : \text{Mod}_A \to \text{Mod}_B$
which commutes with filtered colimits. If $F$ is additive, then
$F'$ is additive and commutes with arbitrary direct sums.
If $F$ is exact, left exact, or right exact, so is $F'$.
\end{lemma}

\begin{proof}
See Lemmas \ref{lemma-functor-fp-modules-exact} and
\ref{lemma-functor-fp-modules-left-exact}.
Also, use the finite $A$-modules are finitely presented $A$-modules,
see Algebra, Lemma
\ref{algebra-lemma-Noetherian-finite-type-is-finite-presentation},
and use that Noetherian rings are coherent, see
Algebra, Lemma \ref{algebra-lemma-Noetherian-coherent}.
\end{proof}









\section{Functors between categories of quasi-coherent modules}
\label{section-functor-quasi-coherent}

\noindent
In this section we briefly study functors between categories of
quasi-coherent modules.

\begin{example}
\label{example-functor-quasi-coherent}
Let $R$ be a ring. Let $X$ and $Y$ be
schemes over $R$ with $X$ quasi-compact and quasi-separated.
Let $\mathcal{K}$ be a quasi-coherent $\mathcal{O}_{X \times_R Y}$-module.
Then we can consider the functor
\begin{equation}
\label{equation-FM-QCoh}
F : \QCoh(\mathcal{O}_X) \longrightarrow \QCoh(\mathcal{O}_Y),\quad
\mathcal{F} \longmapsto
\text{pr}_{2, *}(\text{pr}_1^*\mathcal{F}
\otimes_{\mathcal{O}_{X \times_R Y}} \mathcal{K})
\end{equation}
The morphism $\text{pr}_2$ is quasi-compact and quasi-separated
(Schemes, Lemmas \ref{schemes-lemma-quasi-compact-preserved-base-change}
and \ref{schemes-lemma-separated-permanence}). Hence pushforward along
this morphism preserves quasi-coherent modules, see
Schemes, Lemma \ref{schemes-lemma-push-forward-quasi-coherent}.
Moreover, our functor is $R$-linear and commutes with arbitrary direct sums,
see Cohomology of Schemes, Lemma \ref{coherent-lemma-colimit-cohomology}.
\end{example}

\noindent
The following lemma is a natural generalization of
Lemma \ref{lemma-functor-modules}.

\begin{lemma}
\label{lemma-functor-quasi-coherent-from-affine}
Let $R$ be a ring. Let $X$ and $Y$ be schemes over $R$ with $X$ affine.
There is an equivalence of categories between
\begin{enumerate}
\item the category of $R$-linear functors
$F : \QCoh(\mathcal{O}_X) \to \QCoh(\mathcal{O}_Y)$
which are right exact and commute with arbitrary direct sums, and
\item the category $\QCoh(\mathcal{O}_{X \times_R Y})$
\end{enumerate}
given by sending $\mathcal{K}$ to the functor $F$ in (\ref{equation-FM-QCoh}).
\end{lemma}

\begin{proof}
Let $\mathcal{K}$ be an object of $\QCoh(\mathcal{O}_{X \times_R Y})$
and $F_\mathcal{K}$ the functor (\ref{equation-FM-QCoh}). By the discussion in
Example \ref{example-functor-quasi-coherent} we already know that
$F$ is $R$-linear and commutes with arbitrary direct sums.
Since $\text{pr}_2 : X \times_R Y \to Y$ is affine
(Morphisms, Lemma \ref{morphisms-lemma-base-change-affine}) the functor
$\text{pr}_{2, *}$ is exact, see Cohomology of Schemes, Lemma
\ref{coherent-lemma-relative-affine-vanishing}.
Hence $F$ is right exact as well, in other words $F$ is as in (1).

\medskip\noindent
Let $F$ be as in (1). Say $X = \Spec(A)$. Consider the quasi-coherent
$\mathcal{O}_Y$-module $\mathcal{G} = F(\mathcal{O}_X)$.
The functor $F$ induces an $R$-linear map
$A \to \text{End}_{\mathcal{O}_Y}(\mathcal{G})$,
$a \mapsto F(a \cdot \text{id})$. Thus $\mathcal{G}$ is a sheaf of modules over
$$
A \otimes_R \mathcal{O}_Y = \text{pr}_{2, *}\mathcal{O}_{X \times_R Y}
$$
By Morphisms, Lemma \ref{morphisms-lemma-affine-equivalence-modules}
we find that there is a unique quasi-coherent module $\mathcal{K}$
on $X \times_R Y$ such that $F(\mathcal{O}_X) = \mathcal{G} =
\text{pr}_{2, *}\mathcal{K}$ compatible with action
of $A$ and $\mathcal{O}_Y$. Denote $F_\mathcal{K}$ the functor
given by (\ref{equation-FM-QCoh}). There is an equivalence
$\text{Mod}_A \to \QCoh(\mathcal{O}_X)$ sending $A$ to $\mathcal{O}_X$, see
Schemes, Lemma \ref{schemes-lemma-equivalence-quasi-coherent}.
Hence we find an isomorphism $F \cong F_\mathcal{K}$ by
Lemma \ref{lemma-functor-on-modules} because we have an isomorphism
$F(\mathcal{O}_X) \cong F_\mathcal{K}(\mathcal{O}_X)$ compatible with
$A$-action by construction.

\medskip\noindent
This shows that the functor sending $\mathcal{K}$ to $F_\mathcal{K}$
is essentially surjective. We omit the verification of fully faithfulness.
\end{proof}

\begin{remark}
\label{remark-affine-morphism}
Below we will use that for an affine morphism
$h : T \to S$ we have $h_*\mathcal{G} \otimes_{\mathcal{O}_S} \mathcal{H} =
h_*(\mathcal{G} \otimes_{\mathcal{O}_T} h^*\mathcal{H})$ for
$\mathcal{G} \in \QCoh(\mathcal{O}_T)$ and
$\mathcal{H} \in \QCoh(\mathcal{O}_S)$. This follows
immediately on translating into algebra.
\end{remark}

\begin{lemma}
\label{lemma-functor-quasi-coherent-from-affine-compose}
In Lemma \ref{lemma-functor-quasi-coherent-from-affine} let $F$
correspond to $\mathcal{K}$ in $\QCoh(\mathcal{O}_{X \times_R Y})$.
We have
\begin{enumerate}
\item If $f : X' \to X$ is an affine morphism, then $F \circ f_*$
corresponds to $(f \times \text{id}_Y)^*\mathcal{K}$.
\item If $g : Y' \to Y$ is a flat morphism, then $g^* \circ F$ corresponds to
$(\text{id}_X \times g)^*\mathcal{K}$.
\item If $j : V \to Y$ is an open immersion, then $j^* \circ F$
corresponds to $\mathcal{K}|_{X \times_R V}$.
\end{enumerate}
\end{lemma}

\begin{proof}
Proof of (1). Consider the commutative diagram
$$
\xymatrix{
X' \times_R Y \ar[rrd]^{\text{pr}'_2} \ar[rd]_{f \times \text{id}_Y}
\ar[dd]_{\text{pr}'_1} \\
& X \times_R Y \ar[r]_{\text{pr}_2} \ar[d]_{\text{pr}_1} & Y \\
X' \ar[r]^f & X
}
$$
Let $\mathcal{F}'$ be a quasi-coherent module on $X'$. We have
\begin{align*}
\text{pr}_{2, *}(\text{pr}_1^*f_*\mathcal{F}'
\otimes_{\mathcal{O}_{X \times_R Y}} \mathcal{K})
& =
\text{pr}_{2, *}((f \times \text{id}_Y)_*
(\text{pr}'_1)^*\mathcal{F}'
\otimes_{\mathcal{O}_{X \times_R Y}} \mathcal{K}) \\
& =
\text{pr}_{2, *}(f \times \text{id}_Y)_*
\left((\text{pr}'_1)^*\mathcal{F}'
\otimes_{\mathcal{O}_{X' \times_R Y}}
(f \times \text{id}_Y)^*\mathcal{K})\right)  \\
& =
\text{pr}'_{2, *}((\text{pr}'_1)^*\mathcal{F}'
\otimes_{\mathcal{O}_{X' \times_R Y}} (f \times \text{id}_Y)^*\mathcal{K})
\end{align*}
Here the first equality is affine base change for the left hand
square in the diagram, see
Cohomology of Schemes, Lemma \ref{coherent-lemma-affine-base-change}.
The second equality hold by Remark \ref{remark-affine-morphism}.
The third equality is functoriality of pushforwards for modules.
This proves (1).

\medskip\noindent
Proof of (2). Consider the commutative diagram
$$
\xymatrix{
X \times_R Y' \ar[rr]_-{\text{pr}'_2} \ar[rd]^{\text{id}_X \times g}
\ar[rdd]_{\text{pr}'_1} & & Y' \ar[d]^g \\
& X \times_R Y \ar[r]_-{\text{pr}_2} \ar[d]^{\text{pr}_1} & Y \\
& X
}
$$
We have
\begin{align*}
g^*\text{pr}_{2, *}(\text{pr}_1^*\mathcal{F}
\otimes_{\mathcal{O}_{X \times_R Y}} \mathcal{K})
& =
\text{pr}'_{2, *}(
(\text{id}_X \times g)^*(
\text{pr}_1^*\mathcal{F} \otimes_{\mathcal{O}_{X \times_R Y}} \mathcal{K})) \\
& =
\text{pr}'_{2, *}((\text{pr}'_1)^*\mathcal{F}
\otimes_{\mathcal{O}_{X \times_R Y'}}
(\text{id}_X \times g)^*\mathcal{K})
\end{align*}
The first equality by flat base change for the square in the diagram, see
Cohomology of Schemes, Lemma \ref{coherent-lemma-flat-base-change-cohomology}.
The second equality by functoriality of pullback and the fact that
a pullback of tensor products it the tensor product of the pullbacks.

\medskip\noindent
Part (3) is a special case of (2).
\end{proof}

\begin{lemma}
\label{lemma-coh-noetherian-from-affine-flat}
In Lemma \ref{lemma-functor-quasi-coherent-from-affine}
if $F$ is an exact functor, then the corresponding object
$\mathcal{K}$ of $\QCoh(\mathcal{O}_{X \times_R Y})$ is flat over $X$.
\end{lemma}

\begin{proof}
By Lemma \ref{lemma-functor-quasi-coherent-from-affine-compose}
we may assume $Y$ is affine. In the affine case the statement
translates into Remark \ref{remark-exact-flat}.
\end{proof}

\begin{lemma}
\label{lemma-functor-quasi-coherent-from-affine-diagonal}
Let $R$ be a ring. Let $X$ and $Y$ be schemes over $R$. Assume $X$ is
quasi-compact and that the diagonal morphism of $X$ is affine.
There is an equivalence of categories between
\begin{enumerate}
\item the category of $R$-linear exact functors
$F : \QCoh(\mathcal{O}_X) \to \QCoh(\mathcal{O}_Y)$
which commute with arbitrary direct sums, and
\item the full subcategory of $\QCoh(\mathcal{O}_{X \times_R Y})$ consisting
of $\mathcal{K}$ such that
\begin{enumerate}
\item $\mathcal{K}$ is flat over $X$,
\item for $\mathcal{F} \in \QCoh(\mathcal{O}_X)$ we have
$R^q\text{pr}_{2, *}(\text{pr}_1^*\mathcal{F}
\otimes_{\mathcal{O}_{X \times_R Y}} \mathcal{K}) = 0$ for $q > 0$.
\end{enumerate}
\end{enumerate}
given by sending $\mathcal{K}$ to the functor $F$ in (\ref{equation-FM-QCoh}).
\end{lemma}

\begin{proof}
Let $\mathcal{K}$ be as in (2). The functor $F$ in
(\ref{equation-FM-QCoh}) commutes with direct sums.
Since by (1) (a) the modules $\mathcal{K}$ is $X$-flat,
we see that given a short exact
sequence $0 \to \mathcal{F}_1 \to \mathcal{F}_2 \to \mathcal{F}_3 \to 0$
we obtain a short exact sequence
$$
0 \to
\text{pr}_1^*\mathcal{F}_1 \otimes_{\mathcal{O}_{X \times_R Y}} \mathcal{K} \to
\text{pr}_1^*\mathcal{F}_2 \otimes_{\mathcal{O}_{X \times_R Y}} \mathcal{K} \to
\text{pr}_1^*\mathcal{F}_3 \otimes_{\mathcal{O}_{X \times_R Y}} \mathcal{K} \to
0
$$
Since by (2)(b) the higher direct image $R^1\text{pr}_{2, *}$
on the first term is zero, we conclude that
$0 \to F(\mathcal{F}_1) \to F(\mathcal{F}_2) \to F(\mathcal{F}_3) \to 0$
and we see that $F$ is as in (1).

\medskip\noindent
Let us construct the quasi-inverse to the construction. Let $F$ be
as in (1). Choose an affine open covering $X = \bigcup_{i = 1, \ldots, n} U_i$.
Since the diagonal of $X$ is affine, we see that the intersections
$U_{i_0 \ldots i_p} = U_{i_0} \cap \ldots \cap U_{i_p}$ are affine
and that the inclusion morphisms
$j_{i_0 \ldots i_p} : U_{i_0 \ldots i_p} \to X$
are affine. See Morphisms, Lemma \ref{morphisms-lemma-affine-permanence}.
In particular, the composition
$$
\QCoh(\mathcal{O}_{U_{i_0 \ldots i_p}})
\xrightarrow{j_{i_0 \ldots i_p *}}
\QCoh(\mathcal{O}_X) \xrightarrow{F}
\QCoh(\mathcal{O}_Y)
$$
is an exact functor commuting with direct sums as a composition of such
functors. By Lemmas \ref{lemma-functor-quasi-coherent-from-affine} and
\ref{lemma-coh-noetherian-from-affine-flat}
this functor is given by a quasi-coherent module
$\mathcal{K}_{i_0 \ldots i_p}$ on $U_{i_0 \ldots i_p} \times_R Y$
flat over $U_{i_0 \ldots i_p}$. Since
$$
\QCoh(\mathcal{O}_{U_{i_0 \ldots i_p i_{p + 1}}})
\xrightarrow{(U_{i_0 \ldots i_p i_{p + 1}} \to U_{i_0 \ldots i_p})_*}
\QCoh(\mathcal{O}_{U_{i_0 \ldots i_p}})
\xrightarrow{j_{i_0 \ldots i_p *}}
\QCoh(\mathcal{O}_X)
$$
is equal to $j_{i_0 \ldots i_p i_{p + 1} *}$ we conclude from
Lemma \ref{lemma-functor-quasi-coherent-from-affine-compose}
and the equivalence of categories of the already used
Lemma \ref{lemma-functor-quasi-coherent-from-affine}
that we obtain identifications
$$
\mathcal{K}_{i_0 \ldots i_p i_{p + 1}} =
\mathcal{K}_{i_0 \ldots i_p}|_{U_{i_0 \ldots i_p i_{p + 1}} \times_R Y}
$$
which satisfy the usual compatibilites for glueing.
In other words, there exists a unique
$\mathcal{K} \in \QCoh(\mathcal{O}_{X \times_R Y})$
flat over $X$ which restricts to each $\mathcal{K}_{i_0 \ldots i_p}$
on $U_{i_0 \ldots i_p} \times_R Y$ compatible with these identifications.
For every quasi-coherent $\mathcal{O}_X$-module
we have the sheafified {\v C}ech complex
$$
0 \to \mathcal{F} \to
\bigoplus\nolimits_{i_0} j_{i_0 *}\mathcal{F}|_{U_{i_0}} \to
\bigoplus\nolimits_{i_0i_1} j_{i_0 i_1 *}\mathcal{F}|_{U_{i_0 i_1}} \to
\ldots
$$
which is exact.
See Cohomology, Lemma \ref{cohomology-lemma-covering-resolution}.
Applying the exact functor $F$ we find that $F(\mathcal{F})$
maps quasi-isomorphically to the relative {\v C}ech complex with terms
$$
\bigoplus\nolimits_{i_0 \ldots i_p}
(U_{i_0 \ldots i_p} \times_R Y \to Y)_*(
\text{pr}_1^*\mathcal{F} \otimes_{\mathcal{O}_{X \times_R Y}} \mathcal{K}
)|_{U_{i_0 \ldots i_p} \times_R Y}
$$
Since this {\v C}ech complex computes the pushfoward and
higher direct images of
$\text{pr}_1^*\mathcal{F} \otimes_{\mathcal{O}_{X \times_R Y}} \mathcal{K}$
by $\text{pr}_2$ (by Cohomology of Schemes, Lemma
\ref{coherent-lemma-separated-case-relative-cech})
we conclude $F$ and $\mathcal{K}$ correspond and
that we have property (2)(b).
\end{proof}

\begin{lemma}
\label{lemma-persistence-exactness}
Let $R$, $X$, $Y$, and $\mathcal{K}$ be as in
Lemma \ref{lemma-functor-quasi-coherent-from-affine-diagonal} part (2).
Then for any scheme $T$ over $R$ we have
$$
R^q\text{pr}_{13, *}(\text{pr}_{12}^*\mathcal{F}
\otimes_{\mathcal{O}_{T \times_R X \times_R Y}}
\text{pr}_{23}^*\mathcal{K}) = 0
$$
for $\mathcal{F}$ quasi-coherent on $T \times_R X$ and $q > 0$.
\end{lemma}

\begin{proof}
The question is local on $T$ hence we may assume $T$ is affine.
In this case we can consider the diagram
$$
\xymatrix{
T \times_R X \ar[d] &
T \times_R X \times_R Y \ar[d] \ar[l] \ar[r] &
T \times_R Y \ar[d] \\
X &
X \times_R Y \ar[l] \ar[r] &
Y
}
$$
whose vertical arrows are affine. In particular the pushforward along
$T \times_R Y \to Y$ is faithful and exact. Chasing around in the diagram
using that higher direct images along affine morphisms vanish we see that
it suffices to prove
$$
R^q\text{pr}_{2, *}(
\text{pr}_{23, *}(\text{pr}_{12}^*\mathcal{F}
\otimes_{\mathcal{O}_{T \times_R X \times_R Y}}
\text{pr}_{23}^*\mathcal{K})) =
R^q\text{pr}_{2, *}(
\text{pr}_{23, *}(\text{pr}_{12}^*\mathcal{F})
\otimes_{\mathcal{O}_{X \times_R Y}}
\mathcal{K}))
$$
is zero which is true by assumption on $\mathcal{K}$.
The equality holds by Remark \ref{remark-affine-morphism}.
\end{proof}

\begin{lemma}
\label{lemma-functor-quasi-coherent-from-separated}
In Lemma \ref{lemma-functor-quasi-coherent-from-affine-diagonal}
let $F$ and $\mathcal{K}$ correspond. If $X$ is separated and
flat over $R$, then there is a surjection
$\mathcal{O}_X \boxtimes F(\mathcal{O}_X) \to \mathcal{K}$.
\end{lemma}

\begin{proof}
Let $\Delta : X \to X \times_R X$ be the diagonal morphism and
set $\mathcal{O}_\Delta = \Delta_*\mathcal{O}_X$.
Since $\Delta$ is a closed immersion have a short exact sequence
$$
0 \to \mathcal{I} \to 
\mathcal{O}_{X \times_R X} \to \mathcal{O}_\Delta \to 0
$$
Since $\mathcal{K}$ is flat over $X$, the pullback
$\text{pr}_{23}^*\mathcal{K}$ to $X \times_R X \times_R Y$
is flat over $X \times_R X$ and we obtain a short exact sequence
$$
0 \to 
\text{pr}_{12}^*\mathcal{I}
\otimes
\text{pr}_{23}^*\mathcal{K} \to
\text{pr}_{12}^*\mathcal{O}_{X \times_R X}
\otimes
\text{pr}_{23}^*\mathcal{K} \to
\text{pr}_{12}^*\mathcal{O}_\Delta
\otimes
\text{pr}_{23}^*\mathcal{K} \to 0
$$
on $X \times_R X \times_R Y$. Thus, by Lemma \ref{lemma-persistence-exactness}
we obtain a surjection
$$
\text{pr}_{13, *}(
\text{pr}_{12}^*\mathcal{O}_{X \times_R X}
\otimes
\text{pr}_{23}^*\mathcal{K})
\to
\text{pr}_{13, *}(
\text{pr}_{12}^*\mathcal{O}_\Delta
\otimes
\text{pr}_{23}^*\mathcal{K})
$$
By flat base change (
Cohomology of Schemes, Lemma \ref{coherent-lemma-flat-base-change-cohomology})
the source of this arrow is equal to $\mathcal{O}_X \boxtimes F(\mathcal{O}_X)$.
On the other hand the target is equal to
$$
\text{pr}_{13, *}(
\text{pr}_{12}^*\mathcal{O}_\Delta
\otimes
\text{pr}_{23}^*\mathcal{K}) =
\text{pr}_{13, *} (\Delta \times \text{id}_Y)_* \mathcal{K} =
\mathcal{K}
$$
which finishes the proof. The first equality holds for example by
Cohomology, Lemma \ref{cohomology-lemma-projection-formula-closed-immersion}
and the fact that $\text{pr}_{12}^*\mathcal{O}_\Delta =
(\Delta \times \text{id}_Y)_*\mathcal{O}_{X \times_R Y}$.
\end{proof}










\section{Functors between categories of coherent modules}
\label{section-functor-coherent}


\noindent
We need a supply of lemmas telling us certain exact functors have
a certain shape.

\begin{lemma}
\label{lemma-functor-coherent}
Let $X$ and $Y$ be Noetherian schemes. Let
$F : \textit{Coh}(\mathcal{O}_X) \to \textit{Coh}(\mathcal{O}_Y)$
be a functor. Then $F$ extends uniquely to a functor
$\QCoh(\mathcal{O}_X) \to \QCoh(\mathcal{O}_Y)$
which commutes with filtered colimits.
If $F$ is additive, then its extension commutes with arbitrary direct sums.
If $F$ is exact, left exact, or right exact, so is its extension.
\end{lemma}

\begin{proof}
The existence and uniqueness of the extension is a general fact, see
Categories, Lemma \ref{categories-lemma-extend-functor-by-colim}.
To see that the lemma applies observe that coherent modules
are of finite presentation
(Modules, Lemma \ref{modules-lemma-coherent-finite-presentation}) and hence
categorically compact objects of $\textit{Mod}(\mathcal{O}_X)$ by
Modules, Lemma \ref{modules-lemma-finite-presentation-quasi-compact-colimit}.
Finally, every quasi-coherent module is a filtered colimit
of coherent ones for example by
Properties, Lemma \ref{properties-lemma-quasi-coherent-colimit-finite-type}.

\medskip\noindent
Assume $F$ is additive. If $\mathcal{F} = \bigoplus_{j \in J} \mathcal{H}_j$
with $\mathcal{H}_j$ quasi-coherent, then
$\mathcal{F} = \colim_{J' \subset J\text{ finite}}
\bigoplus_{j \in J'} \mathcal{H}_j$.
Denoting the extension of $F$ also by $F$ we obtain
\begin{align*}
F(\mathcal{F})
& =
\colim_{J' \subset J\text{ finite}}
F(\bigoplus\nolimits_{j \in J'} \mathcal{H}_j) \\
& =
\colim_{J' \subset J\text{ finite}}
\bigoplus\nolimits_{j \in J'} F(\mathcal{H}_j) \\
& =
\bigoplus\nolimits_{j \in J} F(\mathcal{H}_j)
\end{align*}
Thus $F$ commutes with arbitrary direct sums.

\medskip\noindent
Suppose $0 \to \mathcal{F} \to \mathcal{F}' \to \mathcal{F}'' \to 0$
is a short exact sequence of quasi-coherent $\mathcal{O}_X$-modules.
Then we write $\mathcal{F}' = \bigcup \mathcal{F}'_i$ as the
union of its coherent submodules, see
Properties, Lemma \ref{properties-lemma-quasi-coherent-colimit-finite-type}.
Denote $\mathcal{F}''_i \subset \mathcal{F}''$ the image of $\mathcal{F}'_i$
and denote $\mathcal{F}_i = \mathcal{F} \cap \mathcal{F}'_i =
\Ker(\mathcal{F}'_i \to \mathcal{F}''_i)$. Then it is clear that
$\mathcal{F} = \bigcup \mathcal{F}_i$ and
$\mathcal{F}'' = \bigcup \mathcal{F}''_i$
and that we have short exact sequences
$$
0 \to \mathcal{F}_i \to \mathcal{F}_i' \to \mathcal{F}_i'' \to 0
$$
Since the extension commutes with filtered colimits we have
$F(\mathcal{F}) = \colim_{i \in I} F(\mathcal{F}_i)$,
$F(\mathcal{F}') = \colim_{i \in I} F(\mathcal{F}'_i)$, and
$F(\mathcal{F}'') = \colim_{i \in I} F(\mathcal{F}''_i)$.
Since filtered colimits are exact
(Modules, Lemma \ref{modules-lemma-limits-colimits}) we
conclude that exactness properties of $F$ are inherited by
its extension.
\end{proof}

\begin{lemma}
\label{lemma-characterize-finite}
Let $f : V \to X$ be a quasi-finite separated morphism of Noetherian
schemes. If there exists a coherent $\mathcal{O}_V$-module $\mathcal{K}$
whose support is $V$ such that $f_*\mathcal{K}$ is coherent and
$R^qf_*\mathcal{K} = 0$, then $f$ is finite.
\end{lemma}

\begin{proof}
By Zariski's main theorem we can find an open immersion
$j : V \to Y$ over $X$ with $\pi : Y \to X$ finite, see
More on Morphisms, Lemma
\ref{more-morphisms-lemma-quasi-finite-separated-pass-through-finite}.
Since $\pi$ is affine the functor $\pi_*$ is exact and faithful
on the category of coherent $\mathcal{O}_X$-modules.
Hence we see that $j_*\mathcal{K}$ is coherent and
that $R^qj_*\mathcal{K}$ is zero for $q > 0$.
In other words, we reduce to the case discussed in the next paragraph.

\medskip\noindent
Assume $f$ is an open immersion. We may replace $X$ by the
scheme theoretic closure of $V$. Assume $X \setminus V$ is nonempty
to get a contradiction. Choose a generic point $\xi \in X \setminus V$
of an irreducible component of $X \setminus V$. Looking at the situation
after base change by $\Spec(\mathcal{O}_{X, \xi}) \to X$ using flat base
change and using
Local Cohomology, Lemma
\ref{local-cohomology-lemma-finiteness-pushforwards-and-H1-local}
we reduce to the algebra problem discussed in the next paragraph.

\medskip\noindent
Let $(A, \mathfrak m)$ be a Noetherian local ring. Let $M$ be a finite
$A$-module whose support is $\Spec(A)$. Then $H^i_\mathfrak m(A) \not = 0$
for some $i$. This is true by
Dualizing Complexes, Lemma \ref{dualizing-lemma-depth}
and the fact that $M$ is not zero hence has finite depth.
\end{proof}

\begin{lemma}
\label{lemma-functor-coherent-over-field}
Let $k$ be a field. Let $X$, $Y$ be finite type schemes over $k$ with
$X$ separated. There is an equivalence of categories between
\begin{enumerate}
\item the category of $k$-linear exact functors
$F : \textit{Coh}(\mathcal{O}_X) \to \textit{Coh}(\mathcal{O}_Y)$, and
\item the category of coherent $\mathcal{O}_{X \times Y}$-modules
$\mathcal{K}$ which are flat over $X$ and have support finite over $Y$
\end{enumerate}
given by sending $\mathcal{K}$ to the restriction of the functor
(\ref{equation-FM-QCoh}) to $\textit{Coh}(\mathcal{O}_X)$.
\end{lemma}

\begin{proof}
Let $\mathcal{K}$ be as in (2). By
Lemma \ref{lemma-functor-quasi-coherent-from-affine-diagonal}
the functor $F$ given by (\ref{equation-FM-QCoh}) is exact and $k$-linear.
Moreover, $F$ sends $\textit{Coh}(\mathcal{O}_X)$ into
$\textit{Coh}(\mathcal{O}_Y)$ for example by
Cohomology of Schemes, Lemma
\ref{coherent-lemma-support-proper-over-base-pushforward}.

\medskip\noindent
Let us construct the quasi-inverse to the construction. Let $F$ be
as in (1). By Lemma \ref{lemma-functor-coherent} we can extend $F$
to a $k$-linear exact functor on the
categories of quasi-coherent modules which commutes with arbitrary direct sums.
By Lemma \ref{lemma-functor-quasi-coherent-from-affine-diagonal}
the extension corresponds to a unique quasi-coherent module
$\mathcal{K}$, flat over $X$, such that
$R^q\text{pr}_{2, *}(\text{pr}_1^*\mathcal{F}
\otimes_{\mathcal{O}_{X \times Y}} \mathcal{K}) = 0$ for $q > 0$
for all quasi-coherent $\mathcal{O}_X$-modules $\mathcal{F}$.
Since $F(\mathcal{O}_X)$ is a coherent $\mathcal{O}_Y$-module, we
conclude from Lemma \ref{lemma-functor-quasi-coherent-from-separated}
that $\mathcal{K}$ is coherent.

\medskip\noindent
For a closed point $x \in X$ denote $\mathcal{O}_x$ the skyscraper sheaf
at $x$ with value the residue field of $x$. We have
$$
F(\mathcal{O}_x) =
\text{pr}_{2, *}(\text{pr}_1^*\mathcal{O}_x \otimes \mathcal{K}) =
(x \times Y \to Y)_*(\mathcal{K}|_{x \times Y})
$$
Since $x \times Y \to Y$ is finite, we see that the pushforward along
this morphism is faithful. Hence if $y \in Y$ is in the image of the
support of $\mathcal{K}|_{x \times Y}$, then $y$ is in the support of
$F(\mathcal{O}_x)$.

\medskip\noindent
Let $Z \subset X \times Y$ be the scheme theoretic support $Z$ of
$\mathcal{K}$, see
Morphisms, Definition \ref{morphisms-definition-scheme-theoretic-support}.
We first prove that $Z \to Y$ is quasi-finite, by proving that its fibres
over closed points are finite. Namely, if the fibre of $Z \to Y$ over a
closed point $y \in Y$ has dimension $> 0$, then we can find infinitely
many pairwise distinct closed points $x_1, x_2, \ldots$ in the image of
$Z_y \to X$. Since we have a surjection
$\mathcal{O}_X \to \bigoplus_{i = 1, \ldots, n} \mathcal{O}_{x_i}$
we obtain a surjection
$$
F(\mathcal{O}_X) \to \bigoplus\nolimits_{i = 1, \ldots, n} F(\mathcal{O}_{x_i})
$$
By what we said above, the point $y$ is in the support of each
of the coherent modules $F(\mathcal{O}_{x_i})$. Since $F(\mathcal{O}_X)$
is a coherent module, this will lead to a contradiction because
the stalk of $F(\mathcal{O}_X)$ at $y$ will be generated by $< n$ elements
if $n$ is large enough. Hence $Z \to Y$ is quasi-finite.
Since $\text{pr}_{2, *}\mathcal{K}$ is coherent and
$R^q\text{pr}_{2, *}\mathcal{K} = 0$ for $q > 0$ we conclude
that $Z \to Y$ is finite by Lemma \ref{lemma-characterize-finite}.
\end{proof}

\begin{lemma}
\label{lemma-pushforward-invertible-pre}
Let $f : X \to Y$ be a finite type separated morphism of schemes. Let
$\mathcal{F}$ be a finite type quasi-coherent module on $X$
with support finite over $Y$
and with $\mathcal{L} = f_*\mathcal{F}$ an invertible $\mathcal{O}_X$-module.
Then there exists a section $s : Y \to X$ such that
$\mathcal{F} \cong s_*\mathcal{L}$.
\end{lemma}

\begin{proof}
Looking affine locally this translates into the following algebra problem.
Let $A \to B$ be a ring map and let $N$ be a $B$-module which is
invertible as an $A$-module. Then the annihilator $J$ of $N$ in $B$
has the property that $A \to B/J$ is an isomorphism. We omit the details.
\end{proof}

\begin{lemma}
\label{lemma-pushforward-invertible}
Let $f : X \to Y$ be a finite type separated morphism of schemes with a section
$s : Y \to X$. Let $\mathcal{F}$ be a finite type quasi-coherent module
on $X$, set theoretically supported on $s(Y)$ with
$\mathcal{L} = f_*\mathcal{F}$
an invertible $\mathcal{O}_X$-module. If $Y$ is reduced, then
$\mathcal{F} \cong s_*\mathcal{L}$.
\end{lemma}

\begin{proof}
By Lemma \ref{lemma-pushforward-invertible-pre}
there exists a section $s' : Y  \to X$ such that
$\mathcal{F} = s'_*\mathcal{L}$. Since $s'(Y)$ and $s(Y)$
have the same underlying closed subset
and since both are reduced closed subschemes of $X$, they have to be equal.
Hence $s = s'$ and the lemma holds.
\end{proof}

\begin{lemma}
\label{lemma-equivalence-coherent-over-field}
\begin{reference}
Weak version of the result in \cite{Gabriel}
stating that the category of quasi-coherent modules
determines the isomorphism class of a scheme.
\end{reference}
Let $k$ be a field. Let $X$, $Y$ be finite type schemes over $k$ with
$X$ separated and $Y$ reduced. If there is a $k$-linear equivalence
$F : \textit{Coh}(\mathcal{O}_X) \to \textit{Coh}(\mathcal{O}_Y)$
of categories, then there is an isomorphism $f : Y \to X$
over $k$ and an invertible $\mathcal{O}_Y$-module $\mathcal{L}$
such that $F(\mathcal{F}) = f^*\mathcal{F} \otimes \mathcal{L}$.
\end{lemma}

\begin{proof}
By Lemma \ref{lemma-functor-coherent-over-field} we obtain a coherent
$\mathcal{O}_{X \times Y}$-module $\mathcal{K}$ which is flat
over $X$ with support finite over $Y$ such that $F$ is given by
the restriction of the functor
(\ref{equation-FM-QCoh}) to $\textit{Coh}(\mathcal{O}_X)$.
If we can show that $F(\mathcal{O}_X)$ is an invertible $\mathcal{O}_Y$-module,
then by Lemma \ref{lemma-pushforward-invertible-pre}
we see that $\mathcal{K} = s_*\mathcal{L}$
for some section $s : Y \to X \times Y$ of $\text{pr}_2$ and some
invertible $\mathcal{O}_Y$-module $\mathcal{L}$.
This will show that $F$ has the form indicated with
$f = \text{pr}_1 \circ s$. Some details omitted.

\medskip\noindent
It remains to show that $F(\mathcal{O}_X)$ is invertible. We only
sketch the proof and we omit some of the details.
For a closed point $x \in X$ we denote
$\mathcal{O}_x$ in $\textit{Coh}(\mathcal{O}_X)$
the skyscraper sheaf at $x$ with value $\kappa(x)$.
First we observe that the only simple objects
of the category $\textit{Coh}(\mathcal{O}_X)$
are these skyscraper sheaves $\mathcal{O}_x$.
The same is true for $Y$. Hence for every closed point $y \in Y$
there exists a closed point $x \in X$ such that
$\mathcal{O}_y \cong F(\mathcal{O}_x)$. Moreover, looking at endomorphisms
we find that $\kappa(x) \cong \kappa(y)$ as finite extensions of $k$.
Then
$$
\Hom_Y(F(\mathcal{O}_X), \mathcal{O}_y) \cong
\Hom_Y(F(\mathcal{O}_X), F(\mathcal{O}_x)) \cong
\Hom_X(\mathcal{O}_X, \mathcal{O}_x) \cong \kappa(x) \cong \kappa(y)
$$
This implies that the stalk of the coherent $\mathcal{O}_Y$-module
$F(\mathcal{O}_X)$ at $y \in Y$ can be generated by $1$ generator
(and no less) for each closed point $y \in Y$. It follows immediately
that $F(\mathcal{O}_X)$ is locally generated by $1$ element (and no less)
and since $Y$ is reduced this indeed tells us it is an invertible module.
\end{proof}









\input{chapters}

\bibliography{my}
\bibliographystyle{amsalpha}

\end{document}

