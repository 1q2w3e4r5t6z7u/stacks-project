\input{preamble}

% OK, start here.
%
\begin{document}

\title{Duality for Spaces}


\maketitle

\phantomsection
\label{section-phantom}

\tableofcontents

\section{Introduction}
\label{section-introduction}

\noindent
This chapter is the analogue of the corresponding chapter for
schemes, see Duality for Schemes, Section \ref{duality-section-introduction}.
The development is similar to the development in the papers
\cite{Neeman-Grothendieck}, \cite{LN},
\cite{Lipman-notes}, and \cite{Neeman-improvement}.




\section{Dualizing complexes on algebraic spaces}
\label{section-dualizing-spaces}

\noindent
Let $U$ be a locally Noetherian scheme. Let $\mathcal{O}_\etale$
be the structure sheaf of $U$ on the small \'etale site of $U$.
We will say an object $K \in D_\QCoh(\mathcal{O}_\etale)$ is
a dualizing complex on $U$ if $K = \epsilon^*(\omega_U^\bullet)$
for some dualizing complex $\omega_U^\bullet$ in the sense of
Duality for Schemes, Section \ref{duality-section-dualizing-schemes}.
Here $\epsilon^* : D_\QCoh(\mathcal{O}_U) \to D_\QCoh(\mathcal{O}_\etale)$
is the equivalence of Derived Categories of Spaces, Lemma
\ref{spaces-perfect-lemma-derived-quasi-coherent-small-etale-site}.
Most of the properties of $\omega_U^\bullet$ studied in
Duality for Schemes, Section \ref{duality-section-dualizing-schemes}
are inherited by $K$ via the discussion in
Derived Categories of Spaces, Sections
\ref{spaces-perfect-section-derived-quasi-coherent-etale} and
\ref{spaces-perfect-section-spell-out}.

\medskip\noindent
We define a dualizing complex on a locally Noetherian algebraic space
to be a complex which \'etale locally comes from a dualizing
complex on the corresponding scheme.

\begin{lemma}
\label{lemma-equivalent-definitions}
Let $S$ be a scheme. Let $X$ be a locally Noetherian algebraic space over $S$.
Let $K$ be an object of $D_\QCoh(\mathcal{O}_X)$. The following are equivalent
\begin{enumerate}
\item For every \'etale morphism $U \to X$ where $U$ is a scheme
the restriction $K|_U$ is a dualizing complex for $U$ (as discussed above).
\item There exists a surjective \'etale morphism $U \to X$ where $U$ is a
scheme such that $K|_U$ is a dualizing complex for $U$.
\end{enumerate}
\end{lemma}

\begin{proof}
Assume $U \to X$ is surjective \'etale where $U$ is a scheme.
Let $V \to X$ be an \'etale morphism where $V$ is a scheme.
Then
$$
U \leftarrow U \times_X V \rightarrow V
$$
are \'etale morphisms of schemes with the arrow to $V$ surjective.
Hence we can use Duality for Schemes, Lemma \ref{duality-lemma-descent-ascent}
to see that if $K|_U$ is a dualizing complex for $U$, then
$K|_V$ is a dualizing complex for $V$.
\end{proof}

\begin{definition}
\label{definition-dualizing-scheme}
Let $S$ be a scheme.
Let $X$ be a locally Noetherian algebraic space over $S$.
An object $K$ of $D_\QCoh(\mathcal{O}_X)$ is called a
{\it dualizing complex} if $K$ satisfies the equivalent conditions of
Lemma \ref{lemma-equivalent-definitions}.
\end{definition}

\begin{lemma}
\label{lemma-affine-duality}
Let $A$ be a Noetherian ring and let $X = \Spec(A)$. Let
$\mathcal{O}_\etale$ be the structure sheaf of $X$ on the
small \'etale site of $X$. Let $K, L$ be objects of $D(A)$.
If $K \in D_{\textit{Coh}}(A)$ and $L$ has finite injective
dimension, then
$$
\epsilon^*\widetilde{R\Hom_A(K, L)} =
R\SheafHom_{\mathcal{O}_\etale}(\epsilon^*\widetilde{K},
\epsilon^*\widetilde{L})
$$
in $D(\mathcal{O}_\etale)$ where
$\epsilon : (X_\etale, \mathcal{O}_\etale) \to (X, \mathcal{O}_X)$
is as in Derived Categories of Spaces, Section
\ref{spaces-perfect-section-derived-quasi-coherent-etale}.
\end{lemma}

\begin{proof}
By Duality for Schemes, Lemma \ref{duality-lemma-affine-duality}
we have a canonical isomorphism
$$
\widetilde{R\Hom_A(K, L)} =
R\SheafHom_{\mathcal{O}_X}(\widetilde{K}, \widetilde{L})
$$
in $D(\mathcal{O}_X)$. There is a canonical map
$$
\epsilon^*R\Hom_{\mathcal{O}_X}(\widetilde{K}, \widetilde{L})
\longrightarrow
R\SheafHom_{\mathcal{O}_\etale}(\epsilon^*\widetilde{K},
\epsilon^*\widetilde{L})
$$
in $D(\mathcal{O}_\etale)$, see Cohomology on Sites, Remark
\ref{sites-cohomology-remark-prepare-fancy-base-change}.
We will show the left and right hand side of this arrow
have isomorphic cohomology sheaves, but we will omit the
verification that the isomorphism is given by this arrow.

\medskip\noindent
We may assume that $L$ is given by a finite complex $I^\bullet$
of injective $A$-modules. By induction on the length of $I^\bullet$
and compatibility of the constructions with distinguished triangles,
we reduce to the case that $L = I[0]$ where $I$ is an injective $A$-module.
Recall that the cohomology sheaves of
$R\SheafHom_{\mathcal{O}_\etale}(\epsilon^*\widetilde{K},
\epsilon^*\widetilde{L}))$
are the sheafifications of the presheaf sending $U$ \'etale
over $X$ to the $i$th ext group between the restrictions of
$\epsilon^*\widetilde{K}$ and $\epsilon^*\widetilde{L}$
to $U_\etale$. See
Cohomology on Sites, Lemma
\ref{sites-cohomology-lemma-section-RHom-over-U}.
If $U = \Spec(B)$ is affine, then this ext group
is equal to $\text{Ext}^i_B(K \otimes_A B, L \otimes_A B)$
by the equivalence of
Derived Categories of Spaces, Lemma
\ref{spaces-perfect-lemma-derived-quasi-coherent-small-etale-site} and
Derived Categories of Schemes, Lemma
\ref{perfect-lemma-affine-compare-bounded}
(this also uses the compatibilities detailed in
Derived Categories of Spaces, Remark
\ref{spaces-perfect-remark-match-total-direct-images}).
Since $A \to B$ is \'etale, we see that
$I \otimes_A B$ is an injective $B$-module
by Dualizing Complexes, Lemma \ref{dualizing-lemma-injective-goes-up}.
Hence we see that
\begin{align*}
\Ext^n_B(K \otimes_A B, I \otimes_A B)
& =
\Hom_B(H^{-n}(K \otimes_A B), I \otimes_A B) \\
& =
\Hom_{A_f}(H^{-n}(K) \otimes_A B, I \otimes_A B) \\
& =
\Hom_A(H^{-n}(K), I) \otimes_A B \\
& =
\text{Ext}^n_A(K, I) \otimes_A B
\end{align*}
The penultimate equality because $H^{-n}(K)$ is a finite $A$-module, see
More on Algebra, Remark
\ref{more-algebra-remark-pseudo-coherence-and-base-change-ext}.
Therefore the cohomology sheaves of the left and right hand
side of the equality in the lemma are the same.
\end{proof}

\begin{lemma}
\label{lemma-dualizing-spaces}
Let $S$ be a scheme. Let $X$ be a locally Noetherian algebraic space over $S$.
Let $K$ be a dualizing complex on $X$.
Then $K$ is an object of $D_{\textit{Coh}}(\mathcal{O}_X)$
and $D = R\SheafHom_{\mathcal{O}_X}(-, K)$ induces an anti-equivalence
$$
D :
D_{\textit{Coh}}(\mathcal{O}_X)
\longrightarrow
D_{\textit{Coh}}(\mathcal{O}_X)
$$
which comes equipped with a canonical isomorphism
$\text{id} \to D \circ D$. If $X$ is quasi-compact, then
$D$ exchanges $D^+_{\textit{Coh}}(\mathcal{O}_X)$ and
$D^-_{\textit{Coh}}(\mathcal{O}_X)$ and induces an equivalence
$D^b_{\textit{Coh}}(\mathcal{O}_X) \to D^b_{\textit{Coh}}(\mathcal{O}_X)$.
\end{lemma}

\begin{proof}
Let $U \to X$ be an \'etale morphism with $U$ affine. Say $U = \Spec(A)$ and
let $\omega_A^\bullet$ be a dualizing complex for $A$ corresponding to $K|_U$
as in Lemma \ref{lemma-equivalent-definitions} and
Duality for Schemes, Lemma \ref{duality-lemma-equivalent-definitions}.
By Lemma \ref{lemma-affine-duality} the diagram
$$
\xymatrix{
D_{\textit{Coh}}(A) \ar[r] \ar[d]_{R\Hom_A(-, \omega_A^\bullet)} &
D_{\textit{Coh}}(\mathcal{O}_\etale)
\ar[d]^{R\SheafHom_{\mathcal{O}_\etale}(-, K|_U)} \\
D_{\textit{Coh}}(A) \ar[r] &
D(\mathcal{O}_\etale)
}
$$
commutes where $\mathcal{O}_\etale$ is the structure sheaf of the
small \'etale site of $U$. Since formation of $R\SheafHom$ commutes
with restriction, we conclude that $D$ sends
$D_{\textit{Coh}}(\mathcal{O}_X)$ into
$D_{\textit{Coh}}(\mathcal{O}_X)$. Moreover, the canonical map
$$
L \longrightarrow
R\SheafHom_{\mathcal{O}_X}(R\SheafHom_{\mathcal{O}_X}(L, K), K)
$$
(Cohomology on Sites, Lemma \ref{sites-cohomology-lemma-internal-hom-evaluate})
is an isomorphism for all $L$ in $D_{\textit{Coh}}(\mathcal{O}_X)$
because this is true over all $U$ as above by
Dualizing Complexes, Lemma \ref{dualizing-lemma-dualizing}.
The statement on boundedness properties of the functor $D$
in the quasi-compact case also follows from the corresponding
statements of Dualizing Complexes, Lemma \ref{dualizing-lemma-dualizing}.
\end{proof}

\noindent
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site.
We will say that an object $L$ of $D(\mathcal{O})$ is {\it invertible}
if for every object $U$ of $\mathcal{C}$
there is a covering $\{U_i \to U\}$ of $U$ in $\mathcal{C}$
such that $L|_{U_i} \cong \mathcal{O}_{U_i}[-n_i]$
for some integers $n_i$.

\medskip\noindent
Let $S$ be a scheme and let $X$ be an algebraic space over $S$.
If $L$ in $D(\mathcal{O}_X)$ is invertible, then there is a
disjoint union decomposition $X = \coprod_{n \in \mathbf{Z}} X_n$
such that $L|_{X_n}$ is an invertible module sitting in degree $n$.
In particular, it follows that $L = \bigoplus H^n(L)[-n]$
which gives a well defined complex of $\mathcal{O}_X$-modules
(with zero differentials) representing $L$.
Moreover, we see that $L$ is a perfect object of $D(\mathcal{O}_X)$.

\begin{lemma}
\label{lemma-dualizing-unique-spaces}
Let $S$ be a scheme.
Let $X$ be a locally Noetherian algebraic space over $S$.
If $K$ and $K'$ are dualizing complexes on $X$, then $K'$
is isomorphic to $K \otimes_{\mathcal{O}_X}^\mathbf{L} L$
for some invertible object $L$ of $D(\mathcal{O}_X)$.
\end{lemma}

\begin{proof}
Set
$$
L = R\SheafHom_{\mathcal{O}_X}(K, K')
$$
This is an invertible object of $D(\mathcal{O}_X)$, because affine locally
this is true. Use Lemma \ref{lemma-affine-duality} and
Dualizing Complexes, Lemma
\ref{dualizing-lemma-dualizing-unique} and its proof.
The evaluation map $L \otimes_{\mathcal{O}_X}^\mathbf{L} K \to K'$
is an isomorphism for the same reason.
\end{proof}

\begin{lemma}
\label{lemma-dimension-function-scheme}
Let $S$ be a scheme. Let $X$ be a locally Noetherian
quasi-separated algebraic space over $S$.
Let $\omega_X^\bullet$ be a dualizing complex on $X$. Then $X$ the function
$|X| \to \mathbf{Z}$ defined by
$$
x \longmapsto \delta(x)\text{ such that }
\omega_{X, \overline{x}}^\bullet[-\delta(x)]
\text{ is a normalized dualizing complex over }
\mathcal{O}_{X, \overline{x}}
$$
is a dimension function on $|X|$.
\end{lemma}

\begin{proof}
Let $U$ be a scheme and let $U \to X$ be a surjective \'etale morphism.
Let $\omega_U^\bullet$ be the dualizing complex on $U$ associated
to $\omega_X^\bullet|_U$.
If $u \in U$ maps to $x \in |X|$, then $\mathcal{O}_{X, \overline{x}}$
is the strict henselization of $\mathcal{O}_{U, u}$. By
Dualizing Complexes, Lemma \ref{dualizing-lemma-flat-unramified}
we see that if $\omega^\bullet$ is a normalized dualizing complex
for $\mathcal{O}_{U, u}$, then
$\omega^\bullet \otimes_{\mathcal{O}_{U, u}} \mathcal{O}_{X, \overline{x}}$
is a normalized dualizing complex for $\mathcal{O}_{X, \overline{x}}$.
Hence we see that the dimension function $U \to \mathbf{Z}$ of
Duality for Schemes, Lemma \ref{duality-lemma-dimension-function-scheme}
for the scheme $U$ and the complex
$\omega_U^\bullet$ is equal to the composition of $U \to |X|$ with $\delta$.
Using the specializations in $|X|$ lift to specializations in $U$
and that nontrivial specializations in $U$ map to
nontrivial specializations in $X$
(Decent Spaces, Lemmas \ref{decent-spaces-lemma-decent-specialization} and
\ref{decent-spaces-lemma-decent-no-specializations-map-to-same-point})
an easy topological argument shows that $\delta$ is a dimension function
on $|X|$.
\end{proof}






\section{Right adjoint of pushforward}
\label{section-twisted-inverse-image}

\noindent
This is the analogue of Duality for Schemes, Section
\ref{duality-section-twisted-inverse-image}.

\begin{lemma}
\label{lemma-twisted-inverse-image}
\begin{reference}
This is almost the same as \cite[Example 4.2]{Neeman-Grothendieck}.
\end{reference}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism between quasi-separated and quasi-compact
algebraic spaces over $S$. The functor $Rf_* : D_\QCoh(X) \to D_\QCoh(Y)$
has a right adjoint.
\end{lemma}

\begin{proof}
We will prove a right adjoint exists by verifying the hypotheses of
Derived Categories, Proposition \ref{derived-proposition-brown}.
First off, the category $D_\QCoh(\mathcal{O}_X)$ has direct sums, see
Derived Categories of Spaces, Lemma
\ref{spaces-perfect-lemma-quasi-coherence-direct-sums}.
The category $D_\QCoh(\mathcal{O}_X)$ is compactly generated by
Derived Categories of Spaces, Theorem
\ref{spaces-perfect-theorem-bondal-van-den-Bergh}.
Since $X$ and $Y$ are quasi-compact and quasi-separated, so is $f$, see
Morphisms of Spaces, Lemmas
\ref{spaces-morphisms-lemma-compose-after-separated} and
\ref{spaces-morphisms-lemma-quasi-compact-permanence}.
Hence the functor $Rf_*$ commutes with direct sums, see
Derived Categories of Spaces, Lemma
\ref{spaces-perfect-lemma-quasi-coherence-pushforward-direct-sums}.
This finishes the proof.
\end{proof}

\begin{lemma}
\label{lemma-twisted-inverse-image-bounded-below}
Notation and assumptions as in Lemma \ref{lemma-twisted-inverse-image}.
Let $a : D_\QCoh(\mathcal{O}_Y) \to D_\QCoh(\mathcal{O}_X)$ be the right
adjoint to $Rf_*$. Then $a$ maps
$D^+_\QCoh(\mathcal{O}_Y)$ into $D^+_\QCoh(\mathcal{O}_X)$.
\end{lemma}

\begin{proof}
By Derived Categories of Spaces, Lemma
\ref{spaces-perfect-lemma-quasi-coherence-direct-image}
the functor $Rf_*$ has finite cohomological dimension. In other words,
there exist an integer $N$ such that
$H^i(Rf_*L) = 0$ for $i \geq N + c$ if $H^j(L) = 0$ for $j \geq c$.
Say $K \in D^+_\QCoh(\mathcal{O}_Y)$ has $H^k(K) = 0$ for $k \geq c$.
Then
$$
\Hom_{D(\mathcal{O}_X)}(\tau_{\leq c - N}a(K), a(K)) =
\Hom_{D(\mathcal{O}_Y)}(Rf_*\tau_{\leq c - N}a(K), K) = 0
$$
by what we said above. Clearly, this implies that $a(K)$ is bounded below.
\end{proof}

\noindent
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of quasi-separated and quasi-compact
algebraic spaces over $S$.
Let $a$ denote the right adjoint to
$Rf_* : D_\QCoh(\mathcal{O}_X) \to D_\QCoh(\mathcal{O}_Y)$. For every
$K \in D_\QCoh(\mathcal{O}_Y)$ and $L \in D_\QCoh(\mathcal{O}_X)$
we obtain a canonical map
\begin{equation}
\label{equation-sheafy-trace}
Rf_*R\SheafHom_{\mathcal{O}_X}(L, a(K))
\longrightarrow
R\SheafHom_{\mathcal{O}_Y}(Rf_*L, K)
\end{equation}
Namely, this map is constructed as the composition
$$
Rf_*R\SheafHom_{\mathcal{O}_X}(L, a(K)) \to
R\SheafHom_{\mathcal{O}_Y}(Rf_*L, Rf_*a(K)) \to
R\SheafHom_{\mathcal{O}_Y}(Rf_*L, K)
$$
where the first arrow is 
Cohomology on Sites, Remark
\ref{sites-cohomology-remark-projection-formula-for-internal-hom}
and the second arrow is the counit $Rf_*a(K) \to K$ of the adjunction.

\begin{lemma}
\label{lemma-iso-global-hom}
Let $S$ be a scheme.
Let $f : X \to Y$ be a morphism of quasi-separated and quasi-compact
algebraic spaces over $S$.
For all $L \in D_\QCoh(\mathcal{O}_X)$ and $K \in D_\QCoh(\mathcal{O}_Y)$
(\ref{equation-sheafy-trace}) induces an isomorphism
$R\Hom_X(L, a(K)) \to R\Hom_Y(Rf_*L, K)$ of global derived homs.
\end{lemma}

\begin{proof}
By construction (Cohomology on Sites, Section
\ref{sites-cohomology-section-global-RHom}) the complexes
$$
R\Hom_X(L, a(K)) =
R\Gamma(X, R\SheafHom_{\mathcal{O}_X}(L, a(K))) =
R\Gamma(Y, Rf_*R\SheafHom_{\mathcal{O}_X}(L, a(K)))
$$
and
$$
R\Hom_Y(Rf_*L, K) = R\Gamma(Y, R\SheafHom_{\mathcal{O}_X}(Rf_*L, a(K)))
$$
have $H^0$ equal to $\Hom_{D(\mathcal{O}_X)}(L, a(K))$ and
$\Hom_{D(\mathcal{O}_Y)}(Rf_*L, K)$ and
(\ref{equation-sheafy-trace}) induces the adjunction map
between these. Similarly in other degrees.
\end{proof}







\input{chapters}

\bibliography{my}
\bibliographystyle{amsalpha}

\end{document}
