\input{preamble}

% OK, start here.
%
\begin{document}

\title{Smoothing ring homomorphisms}


\maketitle

\phantomsection
\label{section-phantom}

\tableofcontents

\section{Introduction}
\label{section-introduction}

\noindent
A very good reference for this chapter is the paper by Richard Swan which
also contains some historical remarks, see \cite{swan}.







\section{Singular ideals}
\label{section-singular-ideal}

\noindent
Let $R \to A$ be a ring map. The singular ideal of $A$ over $R$
is the radical ideal in $A$ cutting out the singular locus of the
morphism $\Spec(A) \to \Spec(R)$. Here is a formal definition.

\begin{definition}
\label{definition-singular-ideal}
Let $R \to A$ be a ring map. The {\it singular ideal of $A$ over $R$},
denoted $H_{A/R}$ is the unique radical ideal $H_{A/R} \subset A$ with
$$
V(H_{A/R}) = \{\mathfrak q \in \Spec(A) \mid R \to A
\text{ not smooth at }\mathfrak q\}
$$
\end{definition}

\noindent
This makes sense because the set of primes where $R \to A$ is smooth
is open, see
Algebra, Definition \ref{algebra-definition-smooth-at-prime}.

\begin{definition}
\label{definition-strictly-standard}
Let $R \to A$ be a ring map of finite presentation.
We say $a \in A$ is {\it strictly standard in $A$ over $R$}
if there exists a presentation
$$
A = R[x_1, \ldots, x_n]/(f_1, \ldots, f_m)
$$
and $0 \leq c \leq \min(n, m)$ such that
\begin{equation}
\label{equation-standard-one}
a = a' \det (\partial f_j/\partial x_i)_{j = 1, \ldots, c, \ i = 1, \ldots, c}
\end{equation}
for some $a' \in A$ and
\begin{equation}
\label{equation-standard-two}
a f_{c + j} \in (f_1, \ldots, f_c) + (f_1, \ldots, f_m)^2
\end{equation}
for $j = 1, \ldots, m - c$.
\end{definition}

\begin{lemma}
\label{lemma-elkik}
(Elkik) Let $R \to A$ be a ring map of finite presentation.
The singular ideal $H_{A/R}$ is the radical of the ideal
generated by strictly standard elements in $A$ over $R$.
\end{lemma}

\begin{proof}
Assume $a$ is strictly standard in $A$ over $R$. We claim that
$A_a$ is smooth over $R$, which proves that $a \in H_{A/R}$. Namely,
let $A = R[x_1, \ldots, x_n]/(f_1, \ldots, f_m)$, $c$, and $a' \in A$
be as in Definition \ref{definition-strictly-standard}.
Write $I = (f_1, \ldots, f_m)$ so that the naive cotangent
complex of $A$ over $R$ is given by $I/I^2 \to \bigoplus A\text{d}x_i$.
Assumptions (\ref{equation-standard-one}) and (\ref{equation-standard-two})
imply that $(I/I^2)_a$ is free on the classes of $f_1, \ldots, f_c$  
and that the differential $(I/I^2)_a \to \bigoplus A_a\text{d}x_i$
has a left inverse. Hence $R \to A_a$ is smooth by definition and
Algebra, Lemma \ref{algebra-lemma-localize-NL}.

\medskip\noindent
Conversely, let $\mathfrak q \subset A$ be a prime where $R \to A$
is smooth. This means that there exists an $a \in A$, $a \not \in \mathfrak p$
such that $R \to A_a$ is standard smooth, see
Algebra, Lemma \ref{algebra-lemma-smooth-syntomic}.
Choose a presentation
$$
A = R[x_1, \ldots, x_n]/(f_1, \ldots, f_m).
$$
Set $I = (f_1, \ldots, f_m)$ so that the the naive cotangent
complex of $A$ over $R$ is given by $I/I^2 \to \bigoplus A\text{d}x_i$.
After renumbering $x_1, \ldots, x_n$ and $f_1, \ldots, f_m$ we may assume
that $f_1, \ldots, f_c$ form a basis for the vector space
$I/I^2 \otimes_A \kappa(\mathfrak q)$ and that
$\text{d}x_{c + 1}, \ldots, \text{d}x_n$ map to a basis of
$\Omega^1_{A/R} \otimes_A \kappa(\mathfrak q)$.
By
Algebra, Lemmas \ref{algebra-lemma-localize-NL} and
\ref{algebra-lemma-standard-smooth}
we see that $(I/I^2)_a \to \bigoplus A_a\text{d}x_i$ is a split injection
whose cokernel is a free $A_a$-module. Hence after replacing $a$ by $aa'$ for
some $a' \in A$, $a' \not \in \mathfrak q$ we may assume
$f_1, \ldots, f_c$ form a basis for $(I/I^2)_a$ and that
$\text{d}x_{c + 1}, \ldots, \text{d}x_n$ map to a basis of
$(\Omega^1_{A/R})_a$. In this situation it is clear that
$a^N$ is strictly standard on $A$ over $R$ for some $N \gg 0$.
\end{proof}






\section{The lifting lemma}
\label{section-lifting}


\begin{lemma}
\label{lemma-lifting}
Let $R \to \Lambda$ be a ring map.
Let $\pi \in R$ and assume that
$\text{Ann}_\Lambda(\pi) = \text{Ann}_\Lambda(\pi^2)$.
Suppose we have $R/\pi^2R \to \bar C \to \Lambda/\pi^2\Lambda$
with $\bar C$ of finite presentation over $R$. Then there exist ring maps
$R \to D \to \Lambda$ and a commutative diagram
$$
\xymatrix{
R/\pi^2R \ar[r] \ar[d] &
\bar C \ar[r] \ar[d] &
\Lambda/\pi^2\Lambda \ar[d] \\
R/\pi R \ar[r] &
D/\pi D \ar[r] &
\Lambda/\pi \Lambda
}
$$
such that $D$ is of finite presentation over $R$ and such that
\end{lemma}

\begin{proof}
We choose a presentation
$$
\bar C = R[x_1, \ldots, x_n]/(f_1, \ldots, f_m)
$$
We also denote $I = (f_1, \ldots, f_m)$ and $\bar I$ the image of
$I$ in $R/\pi^2R[x_1, \ldots, x_n]$. We may choose a finite list of elements
$a_1, \ldots, a_r \in R[x_1, \ldots, x_n]$ such that
\begin{enumerate}
\item the union of the open subspaces
$\Spec(\bar C_{a_k}) \subset \Spec(\bar C)$
cover the smooth locus of $\Spec(\bar C) \to \Spec(R)$, and
\item for each $k = 1, \ldots, r$ there exists a finite subset
$E_k \subset \{1, \ldots, m\}$ such that
$(\bar I/\bar I^2)_{a_k}$ is freely generated by the classes of
$f_j$, $j \in E_k$.
\end{enumerate}
Set $I_k = (f_j, j \in E_k) \subset I$ and denote $\bar I_k$ the
image of $I_k$ in $R/\pi^2R[x_1, \ldots, x_n]$.
By (2) and Nakayama's lemma we see that $(\bar I/\bar I_k)_{a_k}$
is annihilated by $1 + b'_k$ for some $b'_k \in \bar I_{a_k}$.
Suppose $b'_k$ is the image of $b_k/(a_k)^N$ for some $b_k \in I$
and some integer $N$. After replacing $a_k$ by $a_kb_k$ we get
\begin{enumerate}
\item[(3)] $\bar I_k = \bar I$.
\end{enumerate}
Thus, after possibly replacing $a_k$ by a high power, we may write
\begin{enumerate}
\item[(4)]
$a_k f_\ell = \sum\nolimits_{j \in E_k} h_{k, \ell}^jf_j + \pi^2 g_{k, \ell}$
\end{enumerate}
for any $\ell \in \{1, \ldots, m\}$ and some
$h_{i, \ell, j}, g_{i, \ell} \in R[x_1, \ldots, x_n]$.
For $\ell \in E_k$ we choose $h_{k, \ell}^j = \delta_{\ell, j}$ (Kronecker
delta) and $g_{k, \ell} = 0$. Set
$$
D = R[x_1, \ldots, x_n, z_1, \ldots, z_m]/
(f_j - \pi z_j, p_{k, \ell}).
$$
Here $j \in \{1, \ldots, m\}$, $k \in \{1, \ldots, r\}$,
$\ell \in \{1, \ldots, m\}$, and
$$
p_{k, \ell} = a_k z_\ell - \sum\nolimits_{j \in E_k} h_{k, \ell}^j z_j
- \pi g_{k, \ell}.
$$
Note that for $\ell \in E_k$ we have $p_{k, \ell} = 0$ by our choices above.

\medskip\noindent
The map $R \to D$ is the given one.
Say $\bar C \to \Lambda/\pi^2\Lambda$ maps $x_i$
to the class of $\lambda_i$ modulo $\pi^2$. For an element
$f \in R[x_1, \ldots, nx_n]$ we denote $f(\lambda) \in \Lambda$
the result of subsituting $\lambda_i$ for $x_i$. Then we know that
$f_j(\lambda) = \pi^2 \mu_j$ for some $\mu_j \in \Lambda$.
Define $D \to \Lambda$ by the rules $x_i \mapsto \lambda_i$ and
$z_j \mapsto \pi\mu_j$. This is well defined because
\begin{align*}
p_{k, \ell}(\lambda_i, \pi \mu_j) & =
a_k(\lambda) \pi \mu_\ell -
\sum\nolimits_{j \in E_k} h_{k, \ell}^j(\lambda) \pi \mu_j
- \pi g_{k, \ell}(\mu) \\
& =
\pi\left(a_k(\lambda) \mu_\ell -
\sum\nolimits_{j \in E_k} h_{k, \ell}^j(\lambda) \mu_j
- g_{k, \ell}(\mu)\right)
\end{align*}
Substituting $x_i = \lambda_i$ in (4) above we see that the expression
inside the brackets is annihilated by $\pi^2$, hence it is annihilated
by $\pi$ as we have assumed
$\text{Ann}_\Lambda(\pi) = \text{Ann}_\Lambda(\pi^2)$.
The map $\bar C \to D/\pi D$ is determined by $x_i \mapsto x_i$
(clearly well defined). Thus we are done if we can prove the statement
about singular ideals.

\medskip\noindent
Before we continue, note that
\begin{align*}
\pi p_{k, \ell} & =
\pi a_k z_\ell - \sum\nolimits_{j \in E_k} \pi h_{k, \ell}^jz_j
- \pi^2 g_{k, \ell} \\
& =
- a_k (f_\ell - \pi z_\ell) + a_k f_\ell +
\sum\nolimits_{j \in E_k} h_{k, \ell}^j (f_j - \pi z_j) -
\sum\nolimits_{j \in E_k} h_{k, \ell}^j f_j - \pi^2 g_{k, \ell} \\
& =
-a_k(f_\ell - \pi z_\ell) +
\sum\nolimits_{j \in E_k} h_{k, \ell}^j(f_j - \pi z_j)
\end{align*}
by (4) which is an element of the ideal generated by $f_j - \pi z_j$.
In particular, we see that $D[1/\pi]$ is isomorphic to
$R[1/\pi][x_1, \ldots, x_n, z_1, \ldots, z_m]/(f_j - \pi z_j)$
which is isomorphic to $R[1/\pi][x_1, \ldots, x_n]$ hence smooth
over $R$.

\medskip\noindent
The relations (4) in particular imply that $a_k f_\ell =
\sum_{j \in E_k} h_{k, \ell}^j f_j$ in $I/I^2$.
Since $\bar I_k$ is equal to $\bar I$
after inverting $a_k$ and free on $f_j$, $j \in E_k$ we see that
$$
a_{k'} h_{k, \ell}^j -
\sum\nolimits_{j' \in E_{k'}} h_{k, j'}^jh_{k', \ell}^{j'}
$$
is zero in $\bar C_{a_k}$ for every $k, k', \ell$ and $j \in E_k$.
Hence we can find a large integer $N$ such that
$$
a_k^N\left(
a_{k'} h_{k, \ell}^j -
\sum\nolimits_{j' \in E_{k'}} h_{k, j'}^jh_{k', \ell}^{j'}
\right)
$$
is in $I_k + \pi^2R[x_1, \ldots, x_n]$.


Therefore we see that
\begin{align*}
a_i p_{i', \ell} - a_{i'}p_{i, \ell}
& =
a_i a_{i'} z_\ell - \sum\nolimits_{j \in W_{i'}} a_i h_{i', \ell, j}z_j
- \pi a_i g_{i', \ell}
\end{align*}




\end{proof}











\input{chapters}

\bibliography{my}
\bibliographystyle{amsalpha}

\end{document}
