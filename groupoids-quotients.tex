\input{preamble}

% OK, start here.
%
\begin{document}

\title{Quotients of groupoids}


\maketitle

\phantomsection
\label{section-phantom}

\tableofcontents

\section{Introduction}
\label{section-introduction}

\noindent
This chapter is devoted to generalities concering groupoids and their
quotients (as far as they exist).
There is a lot of literature on this subject, see for example
\cite{GIT}, \cite{seshadri_quotients}, \cite{KollarQuotients},
\cite{K-M}, \cite{KollarFinite} and many more.





\section{Conventions and notation}
\label{section-conventions-notation}

\noindent
In this chapter the conventions and notation are those introduced in
Groupoid Spaces, Sections \ref{spaces-groupoids-section-conventions}
and \ref{spaces-groupoids-section-notation}.


\section{Invariant morphisms}
\label{section-invariant}

\begin{definition}
\label{definition-invariant}
Let $S$ be a scheme, and let $B$ be an algebraic space over $S$.
Let $j = (t, s) : R \to U \times_B U$ be a pre-relation of algebraic
spaces over $B$. We say a morphism $\phi : U \to X$ of algebraic spaces
over $B$ is {\it $R$-invariant} if the diagram
$$
\xymatrix{
R \ar[r]_s \ar[d]_t & U \ar[d]^\phi \\
U \ar[r]^\phi & X
}
$$
is commutative. If $j : R \to U \times_B U$ comes from the action
of a group algebraic space $G$ on $U$ over $B$ as in
Groupoid Spaces, Lemma \ref{spaces-groupoids-lemma-groupoid-from-action},
then we say that $\phi$ is {\it $G$-invariant}.
\end{definition}

\noindent
In other words, a morphism $U \to X$ is $R$-invariant if it equalizes
$s$ and $t$.  We can reformulate this in terms of associated quotient
sheaves as follows.

\begin{lemma}
\label{lemma-invariant}
Let $S$ be a scheme, and let $B$ be an algebraic space over $S$.
Let $j = (t, s) : R \to U \times_B U$ be a pre-relation of algebraic
spaces over $B$. A morphism of algebraic spaces $\phi : U \to X$ is
$R$-invariant if and only if it factors as
$U \to U/R \to X$.
\end{lemma}

\begin{proof}
This is clear from the definition of the quotient sheaf in
Groupoid Spaces, Section \ref{spaces-groupoids-section-quotient-sheaves}.
\end{proof}

\begin{lemma}
\label{lemma-pullback-invariant}
Let $S$ be a scheme, and let $B$ be an algebraic space over $S$.
Let $j = (t, s) : R \to U \times_B U$ be a pre-relation of algebraic
spaces over $B$. Let $U \to X$ be an $R$-invariant morphism of algebraic
spaces over $B$. Let $X' \to X$ be any morphism of algebraic spaces.
\begin{enumerate}
\item Setting $U' = X' \times_X U$, $R' = X' \times_X R$ we obtain
a pre-relation $j' : R' \to U' \times_B U'$.
\item The pre-relation $j' : R' \to U' \times_B U'$ is the restriction of
$j : R \to U \times_B U$ via $U' \to U$, see
Groupoid Spaces, Definition \ref{spaces-groupoids-definition-restrict-relation}.
\item If $j$ is a relation, then $j'$ is a relation.
\item If $j$ is a pre-equivalence relation, then
$j'$ is a pre-equivalence relation.
\item If $j$ is an equivalence relation, then $j'$ is an equivalence
relation.
\item If $j$ comes from a groupoid in algebraic spaces
$(U, R, s, t, c)$ over $B$, then $j'$ comes from the restriction
of this groupoid to $U'$, see
Groupoid Spaces, Definition \ref{spaces-groupoids-definition-restrict-groupoid}.
\item If $j$ comes from the action of a group algebraic space $G/B$ on $U$
as in
Groupoid Spaces, Lemma \ref{spaces-groupoids-lemma-groupoid-from-action}
then $j'$ comes from the induced action of $G$ on $U'$.
\end{enumerate}
\end{lemma}

\begin{proof}
Omitted. Hint: Functorial point of view combined with the picture:
$$
\xymatrix{
R' = X' \times_X R \ar[dd] \ar[rr] \ar[rd] &&
X' \times_X U = U' \ar'[d][dd] \ar[rd] \\
& R \ar[dd] \ar[rr] && U \ar[dd] \\
U' = X' \times_X U \ar'[r][rr] \ar[rd] && X' \ar[rd] \\
& U \ar[rr] && X
}
$$
\end{proof}

\begin{definition}
\label{definition-pullback}
In the situation of
Lemma \ref{lemma-pullback-invariant}
we call $j' : R' \to U' \times_B U'$ the {\it pullback} of the pre-relation
$j$ to $X'$.
\end{definition}





\section{Categorical quotients}
\label{section-categorical}

\noindent
This is the most basic kind of quotient one can consider.

\begin{definition}
\label{definition-categorical}
Let $S$ be a scheme, and let $B$ be an algebraic space over $S$.
Let $j = (t, s) : R \to U \times_B U$ be pre-relation in algebraic spaces
over $B$.
\begin{enumerate}
\item We say a morphism $\phi : U \to X$ of algebraic spaces over $B$
is a {\it categorical quotient} if it is $R$-invariant, and
for every $R$-invariant morphism $\psi : U \to Y$ of algebraic spaces over $B$
there exists a unique morphism $\chi : X \to Y$ such that
$\psi = \phi \circ \chi$.
\item Let $\mathcal{C}$ be a full subcategory of the category of algebraic
spaces over $B$. Assume $U$, $R$ are objects of $\mathcal{C}$.
In this situation we say
a morphism $\phi : U \to X$ of algebraic spaces over $B$
is a {\it categorical quotient in $\mathcal{C}$}
if $X \in \text{Ob}(\mathcal{C})$, and $\phi$ is $R$-invariant,
and for every $R$-invariant morphism
$\psi : U \to Y$ with $Y \in \text{Ob}(\mathcal{C})$
there exists a unique morphism $\chi : X \to Y$ such
that $\psi = \phi \circ \chi$.
\item If $B = S$ and $\mathcal{C}$ is the category of schemes over $S$,
then we say $U \to X$ is a
{\it categorical quotient in the category of schemes}, or simply a
{\it categorical quotient in schemes}.
\item If $\mathcal{C}$ is the category of all algebraic spaces over $B$
which are quasi-separated, resp.\ decent then we say $U \to X$ is a
{\it categorical quotient in quasi-separated algebraic spaces},
resp.\ {\it categorical quotient in decent algebraic spaces}.
\end{enumerate}
\end{definition}

\noindent
Of course this simply means that $U \to X$ is a coequalizer for the
morphisms $t, s : R \to U$ in the category. Hence we immediately
deduce the following lemma.

\begin{lemma}
\label{lemma-categorical-unique}
Let $S$ be a scheme, and let $B$ be an algebraic space over $S$.
Let $(U, R, s, t, c)$ be a groupoid in algebraic spaces over $B$.
If a categorical quotient in the category of algebaic spaces
over $B$ exists, then it is unique up to unique isomorphism.
Similarly for categorical quotients in full subcategories of
$\textit{Spaces}/B$.
\end{lemma}

\begin{proof}
See Categories, Section \ref{categories-section-coequalizers}.
\end{proof}

\begin{definition}
\label{definition-universal-categorical}
Let $S$ be a scheme, and let $B$ be an algebraic space over $S$.
Let $\mathcal{C}$ be a full subcategory of the category of algebraic
spaces over $B$. Let $j = (t, s) : R \to U \times_B U$ be pre-relation in
$\mathcal{C}$, and let $U \to X$ be an $R$-invariant morphism with
$X \in \text{Ob}(\mathcal{C})$.
\begin{enumerate}
\item We say $U \to X$ is a {\it universal categorical quotient}
in $\mathcal{C}$ if for every morphism $X' \to X$ the morphism
$U' = X' \times_X U \to X'$ is the categorical quotient in $\mathcal{C}$
of the pullback $j' : R' \to U'$ of $j$.
\item We say $U \to X$ is a {\it uniform categorical quotient}
in $\mathcal{C}$ if for every flat morphism $X' \to X$ the morphism
$U' = X' \times_X U \to X'$ is the categorical quotient in $\mathcal{C}$
of the pullback $j' : R' \to U'$ of $j$.
\end{enumerate}
\end{definition}




\section{Quotients as orbit spaces}
\label{section-orbits}

\noindent
Let $j = (t, s) : R \to U \times_B U$ be a pre-relation.
If $j$ is a pre-equivalence relation, then loosely speaking
the ``orbits'' of $R$ on $U$
are the subsets $t(s^{-1}(\{u\}))$ of $U$. However, if $j$ is just a
pre-relation, then we need to take the equivalence relation generated
by $R$.

\begin{definition}
\label{definition-orbit}
Let $S$ be a scheme, and let $B$ be an algebraic space over $S$.
Let $j : R \to U \times_B U$ be a pre-relation over $B$.
If $u \in |U|$, then the {\it orbit}, or more precisely the
{\it $R$-orbit} of $u$ is
$$
O_u =
\left\{
u' \in |U|\ :
\begin{matrix}
\exists n \geq 1,\ \exists u_0, \ldots, u_n \in |U|\text{ such that} \\
\text{for all }i \in \{0, \ldots, n - 1\}\text{ either } \\
u_i = u_{i + 1}\text{ or } \\
\exists r \in |R|,\ s(r) = u_i, t(r) = u_{i + 1}
\text{ or } \\
\exists r \in |R|,\ t(r) = u_i, s(r) = u_{i + 1}
\end{matrix}
\right\}
$$
\end{definition}

\begin{lemma}
\label{lemma-invariant-map-constant-on-orbit}
In the situation of Definition \ref{definition-orbit}.
Let $\phi : U \to X$ be an $R$-invariant morphism of algebraic spaces over
$B$. Then $|\phi| : |U| \to |X|$ is constant on the orbits.
\end{lemma}

\begin{proof}
To see this we just have to show that $\phi(u) = \phi(u')$
for all $u, u' \in |U|$ such that
there exists an $r \in |R|$ such that $s(r) = u$ and $t(r) = u'$.
And this is clear since $\phi$ equalizes $s$ and $t$.
\end{proof}

\noindent
There are several problems with considering the orbits $O_u \subset |U|$
as a tool for singling out properties of quotient maps. One issue is the
following. Suppose that $\overline{b} : \text{Spec}(k) \to B$
is a geometric point of $B$. Consider the canonical map
$$
U(k) \longrightarrow |U|.
$$
Then it is usually not the case that the equivalence classes
of the equivalence relation generated by $j(R(k)) \subset U(k) \times U(k)$
are the inverse images of the orbits $O_u \subset |U|$.
A silly example is to take $S = B = \text{Spec}(\mathbf{Z})$,
$U = R = \text{Spec}(k)$ with $s = t = \text{id}_k$. Then $|U| = |R|$ is
a single point but $U(k)/R(k)$ is enormous.
A more interesting example is to take $S = B = \text{Spec}(\mathbf{Q})$,
choose some of number fields $K \subset L$, and set $U = \text{Spec}(L)$
and $R = \text{Spec}(L \otimes_K L)$ with obvious maps $s, t : R \to U$.
In this case $|U|$ still has just one point, but the quotient
$$
U(k)/R(k) = \text{Hom}(K, k)
$$
consists of more than one element. We conclude from both examples
that if $U \to X$ is an $R$-invariant map and if we want it to
``separate orbits'' we get a much stronger and interesting notion by
considering the induced maps $U(k) \to X(k)$ and ask that
those maps separate orbits.

\medskip\noindent
There is an issue with this too. Namely, suppose that
$S = B = \text{Spec}(\mathbf{R})$,
$U = \text{Spec}(\mathbf{C})$, and
$R = \text{Spec}(\mathbf{C}) \amalg \text{Spec}(K)$
for some field extension $\sigma : \mathbf{C} \to K$.
Let the maps $s, t$ be given by the identity on the component
$\text{Spec}(\mathbf{C})$, but by $\sigma, \sigma \circ \tau$ on the
second component where $\tau$ is complex conjugation. Then, if
$K$ is a nontrivial extension of $\mathbf{C}$, then the two points
$\text{id}, \tau \in U(\mathbf{C})$ are not equivalent under
$j(R(\mathbf{C}))$. But after choosing an extension $\mathbf{C} \subset \Omega$
of sufficiently large cardinality (for example larger than the cardinality
of $K$) then the images of $\text{id}, \tau \in U(\mathbf{C})$ in
$U(\Omega)$ do become equivalent. It seems intuitively clear that
this happens either because $s, t : R \to U$ are not locally of finite type
or because the cardinality of the field $k$ is not large enough.

\medskip\noindent
Keeping this in mind we make the following definition.

\begin{definition}
\label{definition-geometric-orbits}
Let $S$ be a scheme, and let $B$ be an algebraic space over $S$.
Let $j : R \to U \times_B U$ be a pre-relation over $B$.
Let $\overline{b} : \text{Spec}(k) \to B$ be a geometric point of $B$.
\begin{enumerate}
\item We say $\overline{u}, \overline{u}' \in U(k)$ are
{\it weakly $R$-equivalent} if they are in the same equivalence class
for the equivalence relation generated by the relation
$j(R(k)) \subset U(k) \times U(k)$.
\item We say $\overline{u}, \overline{u}' \in U(k)$ are
{\it $R$-equivalent} if for some overfield $k \subset \Omega$
the images in $U(\Omega)$ are weakly $R$-equivalent.
\item The {\it weak orbit}, or more precisely the {\it weak $R$-orbit}
of $\overline{u} \in U(k)$ is set of all
elements of $U(k)$ which are weakly $R$-equivalent to $\overline{u}$.
\item The {\it orbit}, or more precisely the {\it $R$-orbit}
of $\overline{u} \in U(k)$ is set of all
elements of $U(k)$ which are $R$-equivalent to $\overline{u}$.
\end{enumerate}
\end{definition}

\noindent
In the proof of the following lemma we will use the morphisms
\begin{equation}
\label{equation-list}
\begin{matrix}
j_{diag} &
: &
U &
\longrightarrow &
U \times_B U &
u &
\longmapsto &
(u, u) \\
j_{flip} &
: &
R &
\longrightarrow &
U \times_B U &
r &
\longmapsto &
(s(r), t(r)) \\
j_{comp} &
: &
R \times_{s, U, t} R &
\longrightarrow &
U \times_B U, &
(r, r') &
\longmapsto &
(t(r), s(r'))
\end{matrix}
\end{equation}

\begin{lemma}
\label{lemma-geometric-orbits}
Let $S$ be a scheme, and let $B$ be an algebraic space over $S$.
Let $j : R \to U \times_B U$ be a pre-relation over $B$.
Let $\overline{b} : \text{Spec}(k) \to B$ be a geometric point of $B$.
\begin{enumerate}
\item If $k$ has sufficiently large cardinality then weak $R$-equivalence
on $U(k)$ agrees with $R$-equivalence, and weak $R$-orbits agree
with $R$-orbits on $U(k)$.
\item If $s, t : R \to U$ are locally of finite type
then weak $R$-equivalence on $U(k)$ agrees with $R$-equivalence, and
weak $R$-orbits agree with $R$-orbits on $U(k)$.
\item If $s, t : R \to U$ are integral
then weak $R$-equivalence on $U(k)$ agrees with $R$-equivalence, and
weak $R$-orbits agree with $R$-orbits on $U(k)$.
\end{enumerate}
\end{lemma}

\begin{proof}
We omit the proof of part (1). Hint: Use the argument below and
Properties of Spaces, Lemma \ref{spaces-properties-lemma-large-enough}.
Assume $s$, $t$ (and hence $j$) are locally of finite type as in part (2).
We define
$j_1 = (t_1, s_1) : R_1 \to U \times_B U$ to be the morphism
$$
j \amalg j_{diag} \amalg j_{flip} \amalg j_{comp}
\ : \ R \amalg U \amalg R \amalg R \times_{s, U, t} R
\longrightarrow
U \times_B U
$$
and for $n > 1$ we set
$$
j_n = (t_n, s_n) :
R_n = R_1 \times_{s_1, U, t_{n - 1}} R_{n - 1} \longrightarrow U \times_B U
$$
where $t_n$ comes from $t_1$ precomposed with projection onto $R_1$ and
$s_n$ comes from $s_{n - 1}$ precomposed with projection onto $R_{n - 1}$.
By induction one shows that $j_n$, $s_n$, $t_n$ are locally of finite type.
Let $k$ be an algebraically closed field over $B$.
Two elements $\overline{u}, \overline{u}' \in U(k)$ are weakly $R$-equivalent
if and only if $(\overline{u}, \overline{u}') \in (U \times_B U)(k)$ is in the
image of $R_n(k) \to (U \times_B U)(k)$ for some $n \geq 1$ (details omitted;
hint: use induction on the number of steps connecting $\overline{u}$ to
$\overline{u}$). Hence we see that if $\overline{u}, \overline{u}' \in U(k)$
are $R$-equivalent then
$$
R_n \times_{j_n, U \times_B U, (\overline{u}, \overline{u}')} \text{Spec}(k)
$$
is nonempty. Since this is a nonempty algebraic space of finite type
over the algebraically closed field $k$ it has a $k$-valued point
(insert future reference here).
Hence we conclude there exists a $\overline{r}_n \in R_n(k)$ with
$j_n(\overline{r}_n) = (\overline{u}, \overline{u}')$, and we conclude that
$\overline{u}, \overline{u}'$ are $R$-equivalent as desired.
The proof of part (3) is similar and is omitted.
\end{proof}

\begin{definition}
\label{definition-set-theoretically-invariant}
Let $S$ be a scheme, and let $B$ be an algebraic space over $S$.
Let $j : R \to U \times_B U$ be a pre-relation over $B$.
\begin{enumerate}
\item We say $\phi : U \to X$ is {\it set-theoretically $R$-invariant}
if and only if the map $U(k) \to X(k)$ equalizes the two maps
$s, t : R(k) \to U(k)$ for every geometric point
$\overline{b}$ of $B$.
\item We say $\phi : U \to X$ {\it separates orbits}, or
{\it separates $R$-orbits} if it is set-theoretically $R$-invariant and
$\phi(\overline{u}) = \phi(\overline{u}')$ in $X(k)$ implies that
$\overline{u}, \overline{u}' \in U(k)$ are in the same orbit
for every geometric point $\overline{b}$ of $B$.
\item We say $\phi : U \to X$ is an {\it orbit space for $R$} if it
separates orbits and is surjective.
\end{enumerate}
\end{definition}

\begin{lemma}
\label{lemma-set-theoretic-invariant}
In the situation of Definition \ref{definition-set-theoretically-invariant}.
A morphism $\phi : U \to X$ is set-theoretically $R$-invariant if and
only if for any algebraically closed field $k$ over $B$ the map
$U(k) \to X(k)$ is constant on orbits.
\end{lemma}

\begin{proof}
This is true because the condition is supposed to hold for all algebraically
closed fields over $B$.
\end{proof}

\begin{lemma}
\label{lemma-invariant-set-theoretically-invariant}
An invariant morphism is set-theoretically invariant.
\end{lemma}

\begin{proof}
This is immediate from the definitions.
\end{proof}


\begin{definition}
\label{definition-orbits}
Let $S$ be a scheme, and let $B$ be an algebraic space over $S$.
Let $j : R \to U \times_B U$ be a pre-relation over $B$.
\begin{enumerate}
\item We say $j$ is a {\it set-theoretic pre-equivalence relation}
if $j(|R|) \subset |U \times_B U|$ contains the image of $|j'|$ for any
morphism $j'$ as in Equation (\ref{equation-list}).
\item We say $j$ is a {\it set-theoretic equivalence relation}
if $j$ is universally injective and a set-theoretic pre-equivalence
relation.
\end{enumerate}
\end{definition}


\begin{lemma}
\label{lemma-orbits}
In the situation of Definition \ref{definition-orbits}.
\begin{enumerate}
\item If $j$ is a set-theoretic pre-equivalence relation
and $u \in |U|$, then the {\it orbit} of $u$ is
$$
O_u =
\{u' \in |U| \text{ such that } \exists r \in |R|,\ s(r) = u,\ t(r) = u'\}.
$$
\item If an orbit space exists, then $j : R \to U \times_B U$
is a set-theoretic pre-equivalence relation.
\item If $j$ is a pre-equivalence relation, then $j$ is a
set-theoretic pre-equivalence relation. This holds in particular
when $j$ comes from a groupoid in algebraic spaces, or from an
action of a group algebraic space on $U$.
\item If $j$ is an equivalence relation, then $j$ is a
set-theoretic equivalence relation.
\end{enumerate}
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\noindent
As Mumford explains in \cite[Definition 0.6]{GIT} we have to be a little
careful when discussing geometric points of quotients. 

\begin{lemma}
\label{lemma-orbit-geometric}
In the situation of Definition \ref{definition-orbits}.
Let $j : R \to U \times_B U$ be a set-theoretic pre-equivalence relation.
Let $\text{Spec}(k) \to B$ be a morphism with $k$ an algebraically closed field
of sufficiently large cardinality.
Then the image of
$$
R(k) \longrightarrow U(k) \times U(k)
$$
is an equivalence relation, and its equivalence classes are inverse
images of orbits of $R$, via the canonical map
$$
U(k) \longrightarrow |U|
$$
\end{lemma}

\begin{proof}
Suppose that $\overline{u}_i : \text{Spec}(k) \to U$, $i = 1, 2$
are $k$-valued points of $U$. Suppose that $(\overline{u}_1, \overline{u}_2)$
is the image of a $k$-valued point $\overline{r} \in R(k)$. Consider the
diagram
$$
\xymatrix{
& &
\text{Spec}(k) \ar[d]^{\overline{r}}
\ar[ld]_{(\overline{u}_2, \overline{u}_1)} \\
R \ar[r]^-j &
U \times_B U &
R \ar[l]_-{j_{flip}}
}
$$
Denote $r \in |R|$ the image of $\overline{r}$.
By assumption the image of $|j_{flip}|$ is contained in the image of
$|j|$, in other words there exists a $r' \in |R|$ such that
$|j|(r') = |j_{flip}|(r)$. Hence by
Properties of Spaces, Lemma \ref{spaces-properties-lemma-large-enough}
we conclude that there exists a morphism
$\overline{r}' : \text{Spec}(k) \to R$ such that
$j \circ \overline{r}' = (\overline{u}_2, \overline{u}_1)$.
This proves that the image of $R(k) \to U(k) \times U(k)$ is symmetric.
In a similar way, using that the image of $|j_{diag}|$ is contained
in the image of $|j|$ we see that the image of $R(k) \to U(k) \times U(k)$ is
reflexive.

\medskip\noindent
To show that the image is transitive assume given
$\overline{u}_i : \text{Spec}(k) \to U$, $i = 1, 2, 3$
and $\overline{r}_i : \text{Spec}(k) \to R$, $i = 1, 2$ such that
$j(\overline{r}_1) = (\overline{u}_1, \overline{u}_2)$ and
$j(\overline{r}_1) = (\overline{u}_2, \overline{u}_3)$.
We consider the diagram
$$
\xymatrix{
& &
\text{Spec}(k)
\ar[d]^{\overline{r}_1, \overline{r}_2}
\ar[ld]_{(\overline{u}_1, \overline{u}_3)} \\
R \ar[r]^-j &
U \times_B U &
R \times_{s, U, t} R \ar[l]_-{j_{comp}}
}
$$
Again using that the image of $|j_{comp}|$ is contained in the image
of $|j|$, and using
Properties of Spaces, Lemma \ref{spaces-properties-lemma-large-enough}
we conclude that we can find $\overline{r} : \text{Spec}(k) \to R$
such that $j(\overline{r}) = (\overline{u}_1, \overline{u}_3)$.
\end{proof}





\input{chapters}

\bibliography{my}
\bibliographystyle{amsalpha}

\end{document}
