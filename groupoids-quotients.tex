\input{preamble}

% OK, start here.
%
\begin{document}

\title{Quotients of groupoids}


\maketitle

\phantomsection
\label{section-phantom}

\tableofcontents

\section{Introduction}
\label{section-introduction}

\noindent
This chapter is devoted to generalities concering groupoids and their
quotients (as far as they exist).
There is a lot of literature on this subject, see for example
\cite{GIT}, \cite{seshadri_quotients}, \cite{KollarQuotients},
\cite{K-M}, \cite{KollarFinite} and many more.





\section{Conventions and notation}
\label{section-conventions-notation}

\noindent
In this chapter the conventions and notation are those introduced in
Groupoid Spaces, Sections \ref{spaces-groupoids-section-conventions}
and \ref{spaces-groupoids-section-notation}.


\section{Invariant morphisms}
\label{section-invariant}

\begin{definition}
\label{definition-invariant}
Let $S$ be a scheme, and let $B$ be an algebraic space over $S$.
Let $j = (t, s) : R \to U \times_B U$ be a pre-relation of algebraic
spaces over $B$. We say a morphism $\phi : U \to X$ of algebraic spaces
over $B$ is {\it $R$-invariant} if the diagram
$$
\xymatrix{
R \ar[r]_s \ar[d]_t & U \ar[d]^\phi \\
U \ar[r]^\phi & X
}
$$
is commutative. If $j : R \to U \times_B U$ comes from the action
of a group algebraic space $G$ on $U$ over $B$ as in
Groupoid Spaces, Lemma \ref{spaces-groupoids-lemma-groupoid-from-action},
then we say that $\phi$ is {\it $G$-invariant}.
\end{definition}

\noindent
In other words, a morphism $U \to X$ is $R$-invariant if it equalizes
$s$ and $t$.  We can reformulate this in terms of associated quotient
sheaves as follows.

\begin{lemma}
\label{lemma-invariant}
Let $S$ be a scheme, and let $B$ be an algebraic space over $S$.
Let $j = (t, s) : R \to U \times_B U$ be a pre-relation of algebraic
spaces over $B$. A morphism of algebraic spaces $\phi : U \to X$ is
$R$-invariant if and only if it factors as
$U \to U/R \to X$.
\end{lemma}

\begin{proof}
This is clear from the definition of the quotient sheaf in
Groupoid Spaces, Section \ref{spaces-groupoids-section-quotient-sheaves}.
\end{proof}

\begin{lemma}
\label{lemma-pullback-invariant}
Let $S$ be a scheme, and let $B$ be an algebraic space over $S$.
Let $j = (t, s) : R \to U \times_B U$ be a pre-relation of algebraic
spaces over $B$. Let $U \to X$ be an $R$-invariant morphism of algebraic
spaces over $B$. Let $X' \to X$ be any morphism of algebraic spaces.
\begin{enumerate}
\item Setting $U' = X' \times_X U$, $R' = X' \times_X R$ we obtain
a pre-relation $j' : R' \to U' \times_B U'$.
\item The pre-relation $j' : R' \to U' \times_B U'$ is the restriction of
$j : R \to U \times_B U$ via $U' \to U$, see
Groupoid Spaces, Definition \ref{spaces-groupoids-definition-restrict-relation}.
\item If $j$ is a relation, then $j'$ is a relation.
\item If $j$ is a pre-equivalence relation, then
$j'$ is a pre-equivalence relation.
\item If $j$ is an equivalence relation, then $j'$ is an equivalence
relation.
\item If $j$ comes from a groupoid in algebraic spaces
$(U, R, s, t, c)$ over $B$, then $j'$ comes from the restriction
of this groupoid to $U'$, see
Groupoid Spaces, Definition \ref{spaces-groupoids-definition-restrict-groupoid}.
\item If $j$ comes from the action of a group algebraic space $G/B$ on $U$
as in
Groupoid Spaces, Lemma \ref{spaces-groupoids-lemma-groupoid-from-action}
then $j'$ comes from the induced action of $G$ on $U'$.
\end{enumerate}
\end{lemma}

\begin{proof}
Omitted. Hint: Functorial point of view combined with the picture:
$$
\xymatrix{
R' = X' \times_X R \ar[dd] \ar[rr] \ar[rd] &&
X' \times_X U = U' \ar'[d][dd] \ar[rd] \\
& R \ar[dd] \ar[rr] && U \ar[dd] \\
U' = X' \times_X U \ar'[r][rr] \ar[rd] && X' \ar[rd] \\
& U \ar[rr] && X
}
$$
\end{proof}

\begin{definition}
\label{definition-pullback}
In the situation of
Lemma \ref{lemma-pullback-invariant}
we call $j' : R' \to U' \times_B U'$ the {\it pullback} of the pre-relation
$j$ to $X'$.
\end{definition}





\section{Categorical quotients}
\label{section-categorical}

\noindent
This is the most basic kind of quotient one can consider.

\begin{definition}
\label{definition-categorical}
Let $S$ be a scheme, and let $B$ be an algebraic space over $S$.
Let $j = (t, s) : R \to U \times_B U$ be pre-relation in algebraic spaces
over $B$.
\begin{enumerate}
\item We say a morphism $\phi : U \to X$ of algebraic spaces over $B$
is a {\it categorical quotient} if it is $R$-invariant, and
for every $R$-invariant morphism $\psi : U \to Y$ of algebraic spaces over $B$
there exists a unique morphism $\chi : X \to Y$ such that
$\psi = \phi \circ \chi$.
\item Let $\mathcal{C}$ be a full subcategory of the category of algebraic
spaces over $B$. Assume $U$, $R$ are objects of $\mathcal{C}$.
In this situation we say
a morphism $\phi : U \to X$ of algebraic spaces over $B$
is a {\it categorical quotient in $\mathcal{C}$}
if $X \in \text{Ob}(\mathcal{C})$, and $\phi$ is $R$-invariant,
and for every $R$-invariant morphism
$\psi : U \to Y$ with $Y \in \text{Ob}(\mathcal{C})$
there exists a unique morphism $\chi : X \to Y$ such
that $\psi = \phi \circ \chi$.
\item If $B = S$ and $\mathcal{C}$ is the category of schemes over $S$,
then we say $U \to X$ is a
{\it categorical quotient in the category of schemes}, or simply a
{\it categorical quotient in schemes}.
\item If $\mathcal{C}$ is the category of all algebraic spaces over $B$
which are quasi-separated, resp.\ decent then we say $U \to X$ is a
{\it categorical quotient in quasi-separated algebraic spaces},
resp.\ {\it categorical quotient in decent algebraic spaces}.
\end{enumerate}
\end{definition}

\noindent
Of course this simply means that $U \to X$ is a coequalizer for the
morphisms $t, s : R \to U$ in the category. Hence we immediately
deduce the following lemma.

\begin{lemma}
\label{lemma-categorical-unique}
Let $S$ be a scheme, and let $B$ be an algebraic space over $S$.
Let $(U, R, s, t, c)$ be a groupoid in algebraic spaces over $B$.
If a categorical quotient in the category of algebaic spaces
over $B$ exists, then it is unique up to unique isomorphism.
Similarly for categorical quotients in full subcategories of
$\textit{Spaces}/B$.
\end{lemma}

\begin{proof}
See Categories, Section \ref{categories-section-coequalizers}.
\end{proof}

\begin{definition}
\label{definition-universal-categorical}
Let $S$ be a scheme, and let $B$ be an algebraic space over $S$.
Let $\mathcal{C}$ be a full subcategory of the category of algebraic
spaces over $B$. Let $j = (t, s) : R \to U \times_B U$ be pre-relation in
$\mathcal{C}$, and let $U \to X$ be an $R$-invariant morphism with
$X \in \text{Ob}(\mathcal{C})$.
\begin{enumerate}
\item We say $U \to X$ is a {\it universal categorical quotient}
in $\mathcal{C}$ if for every morphism $X' \to X$ the morphism
$U' = X' \times_X U \to X'$ is the categorical quotient in $\mathcal{C}$
of the pullback $j' : R' \to U'$ of $j$.
\item We say $U \to X$ is a {\it uniform categorical quotient}
in $\mathcal{C}$ if for every flat morphism $X' \to X$ the morphism
$U' = X' \times_X U \to X'$ is the categorical quotient in $\mathcal{C}$
of the pullback $j' : R' \to U'$ of $j$.
\end{enumerate}
\end{definition}




\section{Quotients as orbit spaces}
\label{section-orbits}

\noindent
Let $j = (t, s) : R \to U \times_B U$ be a pre-relation.
If $j$ is a pre-equivalence relation, then loosely speaking
the ``orbits'' of $R$ on $U$
are the subsets $t(s^{-1}(\{u\}))$ of $U$. However, if $j$ is just a
pre-relation, then we need to take the equivalence relation generated
by $R$.

\begin{definition}
\label{definition-orbit}
Let $S$ be a scheme, and let $B$ be an algebraic space over $S$.
Let $j : R \to U \times_B U$ be a pre-relation over $B$.
If $u \in |U|$, then the {\it orbit}, or more precisely the
{\it $R$-orbit} of $u$ is
$$
O_u =
\left\{
u' \in |U|\ :
\begin{matrix}
\exists n \geq 1,\ \exists u_0, \ldots, u_n \in |U|\text{ such that} \\
\text{for all }i \in \{0, \ldots, n - 1\}\text{ either } \\
u_i = u_{i + 1}\text{ or } \\
\exists r \in |R|,\ s(r) = u_i, t(r) = u_{i + 1}
\text{ or } \\
\exists r \in |R|,\ t(r) = u_i, s(r) = u_{i + 1}
\end{matrix}
\right\}
$$
\end{definition}

\noindent
It is clear that these are the equivalence classes of an equivalence relation,
i.e., we have $u' \in O_u$ if and only if $u \in O_{u'}$. The following lemma
is a reformulation of
Groupoids in Spaces,
Lemma \ref{lemma-pre-equivalence-equivalence-relation-points}.

\begin{lemma}
\label{lemma-pre-equivalence-equivalence-relation-points}
Let $B \to S$ as in Section \ref{section-conventions-notation}.
Let $j : R \to U \times_B U$ be a pre-equivalence relation
of algebraic spaces over $B$. Then
$$
O_u =
\{u' \in |U| \text{ such that } \exists r \in |R|,\ s(r) = u,\ t(r) = u'\}.
$$
\end{lemma}

\begin{proof}
By the aforemetioned
Groupoids in Spaces,
Lemma \ref{lemma-pre-equivalence-equivalence-relation-points}
we see that the orbits $O_u$ as defined in the lemma give a disjoint
union decomposition of $|U|$. Thus we see they are equal to the
orbits as defined in Definition \ref{definition-orbit}.
\end{proof}

\begin{lemma}
\label{lemma-invariant-map-constant-on-orbit}
In the situation of Definition \ref{definition-orbit}.
Let $\phi : U \to X$ be an $R$-invariant morphism of algebraic spaces over
$B$. Then $|\phi| : |U| \to |X|$ is constant on the orbits.
\end{lemma}

\begin{proof}
To see this we just have to show that $\phi(u) = \phi(u')$
for all $u, u' \in |U|$ such that
there exists an $r \in |R|$ such that $s(r) = u$ and $t(r) = u'$.
And this is clear since $\phi$ equalizes $s$ and $t$.
\end{proof}

\noindent
There are several problems with considering the orbits $O_u \subset |U|$
as a tool for singling out properties of quotient maps. One issue is the
following. Suppose that $\text{Spec}(k) \to B$
is a geometric point of $B$. Consider the canonical map
$$
U(k) \longrightarrow |U|.
$$
Then it is usually not the case that the equivalence classes
of the equivalence relation generated by $j(R(k)) \subset U(k) \times U(k)$
are the inverse images of the orbits $O_u \subset |U|$.
A silly example is to take $S = B = \text{Spec}(\mathbf{Z})$,
$U = R = \text{Spec}(k)$ with $s = t = \text{id}_k$. Then $|U| = |R|$ is
a single point but $U(k)/R(k)$ is enormous.
A more interesting example is to take $S = B = \text{Spec}(\mathbf{Q})$,
choose some of number fields $K \subset L$, and set $U = \text{Spec}(L)$
and $R = \text{Spec}(L \otimes_K L)$ with obvious maps $s, t : R \to U$.
In this case $|U|$ still has just one point, but the quotient
$$
U(k)/R(k) = \text{Hom}(K, k)
$$
consists of more than one element. We conclude from both examples
that if $U \to X$ is an $R$-invariant map and if we want it to
``separate orbits'' we get a much stronger and interesting notion by
considering the induced maps $U(k) \to X(k)$ and ask that
those maps separate orbits.

\medskip\noindent
There is an issue with this too. Namely, suppose that
$S = B = \text{Spec}(\mathbf{R})$,
$U = \text{Spec}(\mathbf{C})$, and
$R = \text{Spec}(\mathbf{C}) \amalg \text{Spec}(K)$
for some field extension $\sigma : \mathbf{C} \to K$.
Let the maps $s, t$ be given by the identity on the component
$\text{Spec}(\mathbf{C})$, but by $\sigma, \sigma \circ \tau$ on the
second component where $\tau$ is complex conjugation. If
$K$ is a nontrivial extension of $\mathbf{C}$, then the two points
$1, \tau \in U(\mathbf{C})$ are not equivalent under
$j(R(\mathbf{C}))$. But after choosing an extension $\mathbf{C} \subset \Omega$
of sufficiently large cardinality (for example larger than the cardinality
of $K$) then the images of $1, \tau \in U(\mathbf{C})$ in
$U(\Omega)$ do become equivalent! It seems intuitively clear that
this happens either because $s, t : R \to U$ are not locally of finite type
or because the cardinality of the field $k$ is not large enough.

\medskip\noindent
Keeping this in mind we make the following definition.

\begin{definition}
\label{definition-geometric-orbits}
Let $S$ be a scheme, and let $B$ be an algebraic space over $S$.
Let $j : R \to U \times_B U$ be a pre-relation over $B$.
Let $\text{Spec}(k) \to B$ be a geometric point of $B$.
\begin{enumerate}
\item We say $\overline{u}, \overline{u}' \in U(k)$ are
{\it weakly $R$-equivalent} if they are in the same equivalence class
for the equivalence relation generated by the relation
$j(R(k)) \subset U(k) \times U(k)$.
\item We say $\overline{u}, \overline{u}' \in U(k)$ are
{\it $R$-equivalent} if for some overfield $k \subset \Omega$
the images in $U(\Omega)$ are weakly $R$-equivalent.
\item The {\it weak orbit}, or more precisely the {\it weak $R$-orbit}
of $\overline{u} \in U(k)$ is set of all
elements of $U(k)$ which are weakly $R$-equivalent to $\overline{u}$.
\item The {\it orbit}, or more precisely the {\it $R$-orbit}
of $\overline{u} \in U(k)$ is set of all
elements of $U(k)$ which are $R$-equivalent to $\overline{u}$.
\end{enumerate}
\end{definition}

\noindent
It turns out that in good cases orbits and weak orbits agree, see
Lemma \ref{lemma-geometric-orbits}.

\begin{lemma}
\label{lemma-weak-orbit-pre-equivalence}
Let $S$ be a scheme, and let $B$ be an algebraic space over $S$.
Let $\text{Spec}(k) \to B$ be a geometric point of $B$.
Let $j : R \to U \times_B U$ be a pre-equivalence relation over $B$.
In this case the weak orbit of $\overline{u} \in U(k)$ is simply
$$
\{
\overline{u}' \in U(k)
\text{ such that }
\exists \overline{r} \in R(k),
\ s(\overline{r}) = \overline{u},
\ t(\overline{r}) = \overline{u}'
\}
$$
\end{lemma}

\begin{proof}
This is true because by definition of a pre-equivalence relation the image
$j(R(k)) \subset U(k) \times U(k)$ is an equivalence relation.
\end{proof}

\noindent
Let us describe the recipe for turning any pre-relation into a
pre-equivalence relation. We will use the morphisms
\begin{equation}
\label{equation-list}
\begin{matrix}
j_{diag} &
: &
U &
\longrightarrow &
U \times_B U, &
u &
\longmapsto &
(u, u) \\
j_{flip} &
: &
R &
\longrightarrow &
U \times_B U, &
r &
\longmapsto &
(s(r), t(r)) \\
j_{comp} &
: &
R \times_{s, U, t} R &
\longrightarrow &
U \times_B U, &
(r, r') &
\longmapsto &
(t(r), s(r'))
\end{matrix}
\end{equation}
We define $j_1 = (t_1, s_1) : R_1 \to U \times_B U$ to be the morphism
$$
j \amalg j_{diag} \amalg j_{flip} :
R \amalg U \amalg R
\longrightarrow
U \times_B U
$$
with notation as in
Equation (\ref{equation-list}).
For $n > 1$ we set
$$
j_n = (t_n, s_n) :
R_n = R_1 \times_{s_1, U, t_{n - 1}} R_{n - 1} \longrightarrow U \times_B U
$$
where $t_n$ comes from $t_1$ precomposed with projection onto $R_1$ and
$s_n$ comes from $s_{n - 1}$ precomposed with projection onto $R_{n - 1}$.
Finally, we denote
$$
j_\infty = (t_\infty, s_\infty) :
R_\infty = \coprod\nolimits_{n \geq 1} R_n 
\longrightarrow
U \times_B U.
$$

\begin{lemma}
\label{lemma-make-pre-equivalence}
Let $S$ be a scheme, and let $B$ be an algebraic space over $S$.
Let $j : R \to U \times_B U$ be a pre-relation over $B$.
Then $j_\infty : R_\infty \to U \times_B U$ is a
pre-equivalence relation over $B$. Moreover
\begin{enumerate}
\item $\phi : U \to X$ is $R$-invariant if and only if it is
$R_\infty$-invariant,
\item weak $R$-orbits agree with weak $R_\infty$-orbits,
\item $R$-orbits agree with $R_\infty$-orbits,
\item if $s, t$ are locally of finite type, then $s_\infty$, $t_\infty$
are locally of finite type,
\item add more here as needed.
\end{enumerate}
\end{lemma}

\begin{proof}
Omitted. Hint: Any property of $s, t$ which is stable under composition
and stable under base change, and Zariski local on the source
will be inherited by $s_\infty, t_\infty$.
\end{proof}

\begin{lemma}
\label{lemma-geometric-orbits}
Let $S$ be a scheme, and let $B$ be an algebraic space over $S$.
Let $j : R \to U \times_B U$ be a pre-relation over $B$.
Let $\overline{b} : \text{Spec}(k) \to B$ be a geometric point of $B$.
\begin{enumerate}
\item If $s, t : R \to U$ are locally of finite type
then weak $R$-equivalence on $U(k)$ agrees with $R$-equivalence, and
weak $R$-orbits agree with $R$-orbits on $U(k)$.
\item If $k$ has sufficiently large cardinality then weak $R$-equivalence
on $U(k)$ agrees with $R$-equivalence, and weak $R$-orbits agree
with $R$-orbits on $U(k)$.
\end{enumerate}
\end{lemma}

\begin{proof}
We first prove (1). Assume $s, t$ locally of finite type. By
Lemma \ref{lemma-make-pre-equivalence}
we may assume that $R$ is a pre-equivalence relation.
Let $k$ be an algebraically closed field over $B$.
Suppose $\overline{u}, \overline{u}' \in U(k)$ are $R$-equivalent.
Then for some extension field $k \subset \Omega$ there exists
a point $\overline{r} \in R(\Omega)$ mapping to
$(\overline{u}, \overline{u}') \in (U \times_B U)(\Omega)$, see
Lemma \ref{lemma-weak-orbit-pre-equivalence}.
Hence
$$
Z = R \times_{j, U \times_B U, (\overline{u}, \overline{u}')} \text{Spec}(k)
$$
is nonempty. As $s$ is locally of finite type we see that
also $j$ is locally of finite type, see
Morphisms of Spaces, Lemma \ref{spaces-morphisms-lemma-permanence-finite-type}.
This implies $Z$ is a nonempty algebraic space locally of finite type
over the algebraically closed field $k$ (use
Morphisms of Spaces,
Lemma \ref{spaces-morphisms-lemma-base-change-finite-type}).
Thus $Z$ has a $k$-valued point, see
Morphisms of Spaces, Lemma
\ref{spaces-morphisms-lemma-locally-finite-type-surjective-geometric-points}.
Hence we conclude there exists a $\overline{r} \in R(k)$ with
$j(\overline{r}) = (\overline{u}, \overline{u}')$, and we conclude that
$\overline{u}, \overline{u}'$ are $R$-equivalent as desired.

\medskip\noindent
The proof of part (2) is the same, except that it uses
Properties of Spaces, Lemma \ref{spaces-morphisms-lemma-large-enough}
instead of
Morphisms of Spaces, Lemma
\ref{spaces-morphisms-lemma-locally-finite-type-surjective-geometric-points}.
This shows that the assertion holds as soon as $|k| > \lambda(R)$ with
$\lambda(R)$ as introduced just above
Morphisms of Spaces, Lemma
\ref{spaces-morphisms-lemma-locally-finite-type-surjective-geometric-points}.
\end{proof}

\noindent
In the following definition we use the terminology ``$k$ is a field
over $B$'' to mean that $\text{Spec}(k)$ comes equipped with a morphism
$\text{Spec}(k) \to B$.

\begin{definition}
\label{definition-set-theoretically-invariant}
Let $S$ be a scheme, and let $B$ be an algebraic space over $S$.
Let $j : R \to U \times_B U$ be a pre-relation over $B$.
\begin{enumerate}
\item We say $\phi : U \to X$ is {\it set-theoretically $R$-invariant}
if and only if the map $U(k) \to X(k)$ equalizes the two maps
$s, t : R(k) \to U(k)$ for every algebraically closed field $k$
over $B$.
\item We say $\phi : U \to X$ {\it separates orbits}, or
{\it separates $R$-orbits} if it is set-theoretically $R$-invariant and
$\phi(\overline{u}) = \phi(\overline{u}')$ in $X(k)$ implies that
$\overline{u}, \overline{u}' \in U(k)$ are in the same orbit
for every algebraically closed field $k$ over $B$.
\end{enumerate}
\end{definition}

\noindent
We will reformulate these conditions in more geometric terms below
(insert future reference here).

\begin{lemma}
\label{lemma-set-theoretic-invariant}
In the situation of Definition \ref{definition-set-theoretically-invariant}.
A morphism $\phi : U \to X$ is set-theoretically $R$-invariant if and
only if for any algebraically closed field $k$ over $B$ the map
$U(k) \to X(k)$ is constant on orbits.
\end{lemma}

\begin{proof}
This is true because the condition is supposed to hold for all algebraically
closed fields over $B$.
\end{proof}

\begin{lemma}
\label{lemma-invariant-set-theoretically-invariant}
In the situation of Definition \ref{definition-set-theoretically-invariant}.
An invariant morphism is set-theoretically invariant.
\end{lemma}

\begin{proof}
This is immediate from the definitions.
\end{proof}

\begin{lemma}
\label{lemma-set-theoretically-invariant-invariant-when-reduced}
In the situation of Definition \ref{definition-set-theoretically-invariant}.
Let $\phi : U \to X$ be a morphism of algebraic spaces over $B$.
Assume
\begin{enumerate}
\item $\phi$ is set-theoretically $R$-invariant,
\item $R$ is reduced, and
\item $X$ is locally separated over $B$.
\end{enumerate}
Then $\phi$ is $R$-invariant.
\end{lemma}

\begin{proof}
Consider the equalizer
$$
Z = R \times_{(\phi, \phi) \circ j, X \times_B X, \Delta_{X/B}} X
$$
algebraic space. Then $Z \to R$ is an immersion by assumption (3).
By assumption (1) $|Z| \to |R|$ is surjective. This implies that
$Z \to R$ is a bijective closed immersion (use
Schemes, Lemma \ref{schemes-lemma-immersion-when-closed})
and by assumption (2) we conclude that $Z = R$.
\end{proof}

\begin{example}
\label{example-not-invariant}
There exist reduced quasi-separated algebraic spaces $X$, $Y$ and a pair of
morphisms $a, b : Y \to X$ which agree on all $k$-valued points but are not
equal. To get an example take $Y = \text{Spec}(k[[x]])$ and
$$
X = \mathbf{A}^1_k \Big/ \big(\Delta \amalg \{(x, -x) \mid x \not = 0\}\big)
$$
the algebraic space of
Spaces, Example \ref{spaces-example-affine-line-involution}.
The two morphisms $a, b : Y \to X$
come from the two maps $x \mapsto x$ and $x \mapsto -x$
from $Y$ to $\mathbf{A}^1_k = \text{Spec}(k[x])$. On the generic point
the two maps are the same because on the open part $x \not = 0$ of the
space $X$ the functions $x$ and $-x$ are equal. On the closed point
the maps are obviously the same. It is also true that $a \not = b$.
This implies that
Lemma \ref{lemma-set-theoretically-invariant-invariant-when-reduced}
does not hold with assumption (3) replaced by the assumption that $X$
be quasi-separated. Namely, consider the diagram
$$
\xymatrix{
Y \ar[d]_{-1} \ar[r]_1 & Y \ar[d]^a \\
Y \ar[r]^a & X
}
$$
then the composition $a \circ (-1) = b$. Hence we can set $R = Y$,
$U = Y$, $s = 1$, $t = -1$, $\phi = a$ to get an example of a set-theoretically
invariant morphism which is not invariant.
\end{example}

\noindent
The example above is instructive because the map $Y \to X$ even separates
orbits. It shows that in the category of algebraic spaces there are simply
too many set-theoretically invariant morphisms lying around. Next, let us
define what it means for $R$ to be a set-theoretic equivalence relation, while
remembering that we need to allow for field extensions to make this work
correctly.

\begin{definition}
\label{definition-set-theoretic-equivalence}
Let $S$ be a scheme, and let $B$ be an algebraic space over $S$.
Let $j : R \to U \times_B U$ be a pre-relation over $B$.
\begin{enumerate}
\item We say $j$ is a {\it set-theoretic pre-equivalence relation} if
$$
\overline{u} \sim_R \overline{u}'
\Leftrightarrow
\begin{matrix}
\exists\text{ field extension }k \subset K, \ \exists\ r \in R(K),\\
s(r) = \overline{u}, \ t(r) = \overline{u}'
\end{matrix}
$$
defines an equivalence relation on $U(k)$ for all algebraically closed fields
$k$ over $B$.
\item We say $j$ is a {\it set-theoretic equivalence relation}
if $j$ is universally injective and a set-theoretic pre-equivalence
relation.
\end{enumerate}
\end{definition}

\noindent
Let us reformulate this in more geometric terms.

\begin{lemma}
\label{lemma-set-theoretic-equivalence-geometric}
In the situation of Definition \ref{definition-set-theoretic-equivalence}.
The following are equivalent:
\begin{enumerate}
\item The morphism $j$ is a set-theoretic pre-equivalence relation.
\item The subset $j(|R|) \subset |U \times_B U|$ contains the image of
$|j'|$ for any of the morphisms $j'$ as in Equation (\ref{equation-list}).
\item For every algebraically closed field $k$ over $B$ of sufficiently large
cardinality the subset $j(R(k)) \subset U(k) \times U(k)$ is an equivalence
relation.
\end{enumerate}
If $s, t$ are locally of finite type these are also equivalent to
\begin{enumerate}
\item[(4)] For every algebraically closed field $k$ over $B$
the subset $j(R(k)) \subset U(k) \times U(k)$ is an equivalence relation.
\end{enumerate}
\end{lemma}

\begin{proof}
Assume (2). Let $k$ be an algebraically closed field over $B$.
We are going to show that $\sim_R$ is an equivalence relation.
Suppose that $\overline{u}_i : \text{Spec}(k) \to U$, $i = 1, 2$
are $k$-valued points of $U$. Suppose that $(\overline{u}_1, \overline{u}_2)$
is the image of a $K$-valued point $r \in R(K)$. Consider the
solid commutative diagram
$$
\xymatrix{
\text{Spec}(K') \ar@{..>}[r] \ar@{..>}[d]
&
\text{Spec}(k) \ar[d]_{(\overline{u}_2, \overline{u}_1)} &
\text{Spec}(K) \ar[d] \ar[l] \\
R \ar[r]^-j &
U \times_B U &
R \ar[l]_-{j_{flip}}
}
$$
We also denote $r \in |R|$ the image of $r$.
By assumption the image of $|j_{flip}|$ is contained in the image of
$|j|$, in other words there exists a $r' \in |R|$ such that
$|j|(r') = |j_{flip}|(r)$. But note that $(\overline{u}_2, \overline{u}_1)$
is in the equivalence class that defines $|j|(r')$ (by the commutativity
of the solid part of the diagram). This means there exists a field
extension $k \subset K'$ and a morphism $r' : \text{Spec}(K) \to R$
(abusively denoted $r'$ as well) with
$j \circ r' = (\overline{u}_2, \overline{u}_1) \circ i$
where $i : \text{Spec}(K') \to \text{Spec}(K)$ is the obvious map.
In other words the dotted part of the diagram commutes.
This proves that $\sim_R$ is a symmetric relation on $U(k)$.
In the similar way, using that the image of $|j_{diag}|$ is contained
in the image of $|j|$ we see that $\sim_R$ is reflexive (details omitted).

\medskip\noindent
To show that $\sim_R$ is transitive assume given
$\overline{u}_i : \text{Spec}(k) \to U$, $i = 1, 2, 3$
and field extensions $k \subset K_i$ and points
$r_i : \text{Spec}(K_i) \to R$, $i = 1, 2$ such that
$j(r_1) = (\overline{u}_1, \overline{u}_2)$ and
$j(r_1) = (\overline{u}_2, \overline{u}_3)$. Then we may choose a
commutative diagram of fields
$$
\xymatrix{
K & \ar[l] K_2 \\
K_1 \ar[u] & k \ar[l] \ar[u]
}
$$
and we may think of $r_1, r_2 \in R(K)$. We consider the
commutative solid diagram
$$
\xymatrix{
\text{Spec}(K') \ar@{..>}[r] \ar@{..>}[d]
&
\text{Spec}(k) \ar[d]_{(\overline{u}_1, \overline{u}_3)} &
\text{Spec}(K) \ar[d]^{(r_1, r_2)} \ar[l]
\\
R \ar[r]^-j &
U \times_B U &
R \times_{s, U, t} R \ar[l]_-{j_{comp}}
}
$$
By exactly the same reasoning as in the first part of the proof, but
this time using that $|j_{comp}|((r_1, r_2))$ is in the image of $|j|$,
we conclude that a field $K'$ and dotted arrows exist making the
diagram commute. This proves that $\sim_R$ is transitive and concludes
the proof that (2) implies (1).

\medskip\noindent
Proofs of the other implications: FIXME.
\end{proof}

\begin{lemma}
\label{lemma-set-theoretic-equivalence}
Let $S$ be a scheme, and let $B$ be an algebraic space over $S$.
Let $j : R \to U \times_B U$ be a pre-relation over $B$.
\begin{enumerate}
\item If $j$ is a pre-equivalence relation, then $j$ is a
set-theoretic pre-equivalence relation. This holds in particular
when $j$ comes from a groupoid in algebraic spaces, or from an
action of a group algebraic space on $U$.
\item If $j$ is an equivalence relation, then $j$ is a
set-theoretic equivalence relation.
\end{enumerate}
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\noindent
Because we have seen above that the notion of a set-theoretically
invariant morphism is a rather weak one in the category of algebraic
spaces, we define an orbit space for a pre-relation as follows.

\begin{definition}
\label{definition-orbit-space}
Let $B \to S$ as in Section \ref{section-conventions-notation}.
Let $j : R \to U \times_B U$ be a pre-relation.
We say $\phi : U \to X$ is an {\it orbit space for $R$} if
\begin{enumerate}
\item $\phi$ is $R$-invariant,
\item $\phi$ separates $R$-orbits, and
\item $\phi$ is surjective.
\end{enumerate}
\end{definition}



\input{chapters}

\bibliography{my}
\bibliographystyle{amsalpha}

\end{document}
