\input{preamble}


% OK, start here.
%
\begin{document}

\title{Formal Deformation Theory}


\maketitle

\phantomsection
\label{section-phantom}

\tableofcontents



\section{Introduction}
\label{section-introduction}

\noindent
Following Rim \cite[Exposee VI]{SGA7-I} and Schlessinger \cite{Sch}, we 
study formal deformation theory.  Let $\Lambda$ be a complete Noetherian local 
ring with residue field $k$, and let $\mathcal C_{\Lambda}$ denote the category 
of Artinian local $\Lambda$-algebras with residue field $k$.  Given a functor 
$F: \mathcal C_{\Lambda} \rightarrow \textnormal{(Sets)}$ such that $F(k)$ is a 
one element set, Schlessinger \cite{Sch} introduced conditions 
(H1)-(H4) such that: 
\begin{enumerate}
\item $F$ has a ``hull'' if and only if (H1)-(H3) hold.
\item $F$ is prorepresentable if and only (H1)-(H4) hold.
\end{enumerate} 
The purpose of this document is to generalize these results to the case where 
the functor $F$ is replaced by a category $\mathcal F$ cofibered in groupoids 
over $\mathcal C_{\Lambda}$.  The analogue of the condition that $F(k)$ is a 
one element set is that $\mathcal F(k)$ is the trivial groupoid.  If $\mathcal 
F$ satisfies this condition then we say it is a predeformation category, but in 
general we do not make this assumption.  Rim's paper
\cite[Exposee VI]{SGA7-I} is the original 
source for the results in this document.  We also mention the useful paper 
\cite{Vistoli}, which discusses deformation theory with groupoids but in less 
generality than we do here.
  
\medskip \noindent
In Section \ref{section-miniversal-objects}, we define conditions (S1) and (S2) 
on $\mathcal F$ generalizing Schlessinger's (H1) and (H2).  The analogue of 
Schlessinger's (H3)---the condition that $\mathcal F$ has finite dimensional 
tangent space---is not given a name.  In this document a ``hull'' for $\mathcal 
F$ is called a miniversal formal object of $\mathcal F$ (Definition 
\ref{definition-miniversal-object}); it is equivalent to the data of a minimal 
smooth morphism from a prorepresentable functor to $\mathcal F$.  In this 
language, Theorem \ref{theorem-miniversal-object-existence} is the direct 
generalization of (1) above. It recovers Schlessinger's result in the case that 
$\mathcal F$ is a functor.

\medskip \noindent
In Section \ref{section-deformation-groupoids-presentations}, we define 
condition (RS) on $\mathcal F$ generalizing Schlessinger's (H4).  A deformation 
category is defined as a predeformation category satisfying (RS); it is the 
fundamental type of object on which we do deformation theory. The analogue of a 
prorepresentation of a functor is a presentation of $\mathcal F$ by a 
prorepresentable groupoid in functors on $\mathcal C_{\Lambda}$ (see 
Subsections \ref{subsection-groupoids-in-functors} and 
\ref{subsection-presentations}). This notion of a presentation takes into 
account the groupoid structure of the fibers of $\mathcal F$. Given a functor 
$U: \mathcal C_{\Lambda} \rightarrow \textnormal{(Sets)}$ and a morphism $U 
\rightarrow \mathcal F$, a general procedure produces a groupoid in functors on 
$\mathcal C_{\Lambda}$ (Lemma \ref{lemma-presentation-construction}).  If 
$\mathcal F$ is a deformation category with finite dimensional tangent space, 
the generalization of (1) above (Theorem 
\ref{theorem-miniversal-object-existence}) produces such a morphism $U 
\rightarrow \mathcal F$.  The resulting groupoid in functors on $\mathcal 
C_{\Lambda}$ is minimal, smooth, and, assuming $\mathcal F$ has a finite 
dimensional infinitesimal automorphism space, prorepresentable. In Theorem 
\ref{theorem-presentation-deformation-groupoid} we prove that $\mathcal F$ has 
a presentation by the resulting groupoid in functors, and, conversely, that if 
$\mathcal F$ has presentation by a minimal smooth prorepresentable groupoid in 
functors, then it is a deformation category with finite dimensional tangent and 
infinitesimal automorphism spaces. This is the generalization of (2) above. It 
reduces to Schlessinger's result in the case that $\mathcal F$ is a functor.

\medskip \noindent
The generalization of Schlessinger's results to categories cofibered in 
groupoids provides a natural setting for the deformation theory of algebraic 
stacks.  In Section \ref{section-algebraic-stacks}, we discuss how to pass from 
a point of an algebraic stack to a category cofibered in groupoids over 
$\mathcal C_{\Lambda}$ satisfying (RS).

\medskip \noindent
We also find the following conceptual explanation for Schlessinger's 
conditions.  If $\mathcal F$ satisfies (RS), then the associated functor of 
isomorphism classes $\overline{\mathcal F}: \mathcal C_{\Lambda} \rightarrow 
\textnormal{(Sets)}$ satisfies (H1) and (H2) (Lemmas 
\ref{lemma-RS-implies-S1-S2} and \ref{lemma-S1-S2-associated-functor}).  
Conversely, if a functor $F: \mathcal C_{\Lambda} \rightarrow 
\textnormal{(Sets)}$ arises naturally as the functor of isomorphism classes of 
a category $\mathcal F$ cofibered in groupoids, then it seems to happen in 
practice that an argument showing $F$ satisfies (H1) and (H2) will also show 
$\mathcal F$ satisfies (RS) (see Section \ref{section-examples} for examples).  
Moreover, if $\mathcal F$ satisfies (RS), then condition (H4) for 
$\overline{\mathcal F}$ has a simple interpretation in terms of extending 
automorphisms of objects of $\mathcal F$ (Lemma 
\ref{lemma-RS-associated-functor}).  These observations suggest that (RS) 
should be regarded as the fundamental deformation theoretic gluing condition.




\section{Notation and Conventions}
\label{section-notations-conventions}

\noindent
A ring is commutative with $1$. We denote by $\Lambda$ a complete Noetherian 
local ring with residue field $k$.  It is fixed throughout this document.  The 
maximal ideal of a local ring $A$ is denoted by $\mathfrak{m}_{A}$. The set of 
positive integers is denoted by $\mathbf{N} = \left\{1,2,3,\dots \right\}$.
If $U$ is an object of a category $\mathcal C$, we denote by $\underline{U}$ 
the functor $\textnormal{Hom}_{\mathcal C}(U,-): \mathcal C \rightarrow 
\textnormal{(Sets)}$ (see
Remarks \ref{remarks-cofibered-groupoids} (\ref{item-definition-yoneda})).




\section{Preliminary Notions}
\label{section-preliminary}

\noindent
In this section we discuss basic notions for our study of deformation theory: 
categories cofibered in groupoids over $\mathcal C_{\Lambda}$, completions of 
such categories to categories cofibered in groupoids over $\widehat{\mathcal 
C}_{\Lambda}$, and smooth morphisms.


\subsection{The category $\mathcal C_{\Lambda}$}
\label{subsection-CLambda}

\noindent
Recall that $\Lambda$ denotes a fixed complete Noetherian local ring with 
residue field $k$.

\begin{definition}
\label{definition-CLambda}
We define {\it $\mathcal C_{\Lambda}$} to be the category whose objects are
Artinian local $\Lambda$-algebras with residue field $k$, and whose morphisms
are local $\Lambda$-algebra homomorphisms.
\end{definition}

\noindent
The category $\mathcal C_{\Lambda}$ will be the base category for the cofibered 
categories considered below.

\begin{definition}
\label{definition-small-extension}
Let $f: B \rightarrow A$ be a ring map in $\mathcal C_{\Lambda}$.  We say $f$ 
is a {\it small extension} if it is surjective and $\ker(f)$ is a nonzero 
principal ideal which is annihilated by $\mathfrak{m}_{B}$.
\end{definition}

\noindent 
By the following lemma we can often reduce arguments involving surjective ring 
maps in $\mathcal C_{\Lambda}$ to the case of small extensions.

\begin{lemma}
\label{lemma-factor-small-extension}
Let $f: B \rightarrow A$ be a surjective ring map in $\mathcal C_{\Lambda}$. 
Then $f$ can be factored as a composition of small extensions.
\end{lemma}

\begin{proof}
Let $I$ be the kernel of $f$.  The maximal ideal $\mathfrak{m}_{B}$ is 
nilpotent since $B$ is Artinian, say $\mathfrak{m}_{B}^n = 0$. Hence we get a 
factorization
\[ B = B/I\mathfrak{m}_B^{n-1} \rightarrow B/I\mathfrak{m}_B^{n-2} \rightarrow 
\cdots \rightarrow B/I \cong A \]
of $f$ into a composition of surjective maps whose kernels are annihilated by 
the maximal ideal.  Thus it suffices to prove the lemma when $f$ itself is such 
a map, i.e.\ when $I$ is annihilated by $\mathfrak{m}_B$. For this, take a 
basis $x_1, \dots, x_n$ of $I$ as a $k$-vector space to get a factorization
\[ B \rightarrow B/(x_1) \rightarrow \cdots \rightarrow  B/(x_1, \dots, x_n) 
\cong  A \]
of $f$ into a composition of small extensions.
\end{proof}

\noindent
Next we define essential surjections in $\mathcal C_{\Lambda}$.  A necessary 
and sufficient condition for a surjection in $\mathcal C_{\Lambda}$ to be 
essential is given in Lemma \ref{lemma-essential-surjection}.

\begin{definition}
\label{definition-essential-surjection}
Let $f: B \rightarrow A$ be a ring map in $\mathcal C_{\Lambda}$.  We say $f$ 
is an {\it essential surjection} if it has the following properties:
\begin{enumerate}
\item $f$ is surjective.
\item If $g: C \rightarrow B$ is a ring map in $\mathcal C_{\Lambda}$ such that 
$f \circ g$ is surjective, then $g$ is surjective.
\end{enumerate}
\end{definition}

\noindent
The next lemma says that we can compute the length of a module over a local 
$\Lambda$-algebra with residue field $k$ as the length over $\Lambda$.  See 
Algebra, Lemma \ref{algebra-lemma-pushdown-module}
for a more general result.

\begin{lemma}
\label{lemma-length}
Let $A$ be a local $\Lambda$-algebra with residue field $k = 
\Lambda/\mathfrak{m}_{\Lambda}$.  Let $M$ be an $A$-module.  Then 
$\textnormal{length}_{A}(M) = \textnormal{length}_{\Lambda}(M)$.
\end{lemma}

\begin{proof}
If $M$ is a simple $A$-module then $\mathfrak{m}_{A}$ and 
$\mathfrak{m}_{\Lambda}$ annihilate $M$, hence $\textnormal{length}_{A}(M) = 
\textnormal{length}_{A/\mathfrak{m}_A}(M)$ and 
$\textnormal{length}_{\Lambda}(M) = 
\textnormal{length}_{\Lambda/\mathfrak{m}_{\Lambda}}(M)$ by
Algebra, Lemma \ref{algebra-lemma-length-additive}.
So in this case the result follows from the 
assumption on residue fields.  If $\textnormal{length}_{A}(M)$ is finite, the 
result then follows since a filtration of $M$ by $A$-submodules with simple 
quotients gives a filtration by $\Lambda$-submodules with simple quotients. If 
$\textnormal{length}_{A}(M)$ is infinite, the result follows from the obvious 
inequality $\textnormal{length}_{A}(M) \leq \textnormal{length}_{\Lambda}(M)$.
\end{proof}

\noindent
If $f_1: A_1 \rightarrow A$ and $f_2: A_2 \rightarrow A$ are two ring maps, 
then by definition the fiber product $A_1 \times_{A} A_2$ is the subring of 
$A_1 \times A_2$ consisting of elements whose two projections to $A$ are equal. 
Throughout this document we will be considering conditions involving such a 
fiber product when $f_1$ and $f_2$ are in $\mathcal C_{\Lambda}$.  The first 
part of the following lemma says that this fiber product remains in $\mathcal 
C_{\Lambda}$.

\begin{lemma}
\label{lemma-fiber-product-CLambda}
Let $f_1 : A_1 \rightarrow A$ and $f_2 : A_2 \rightarrow A$ be ring maps in 
$\mathcal C_{\Lambda}$. Then:
\begin{enumerate}
\item The ring $A_1 \times_{A} A_2$ is in $\mathcal C_{\Lambda}$.
\item If $A_2 \rightarrow A$ is a small extension, then so is $A_1 \times_{A} 
A_2 \rightarrow A_1$.
\end{enumerate}
\end{lemma}

\begin{proof}
First we prove (1).  The ring $A_1 \times_{A} A_2$ is a $\Lambda$-algebra via 
the map $\Lambda \rightarrow A_1 \times_{A} A_2$ induced by the maps $\Lambda 
\rightarrow A_1$ and $\Lambda \rightarrow A_2$.  It is a local ring with unique 
maximal ideal $\mathfrak{m}_{A_1} \times_{\mathfrak{m}_{A}} \mathfrak{m}_{A_2}$ 
and residue field $k$. Note that a ring is Artinian if and only if it has 
finite length as a module over itself
(Algebra, Lemma \ref{algebra-lemma-artinian-finite-length}).
Since $A_1$ and $A_2$ are Artinian, Lemma \ref{lemma-length} implies 
$\textnormal{length}_{\Lambda}(A_1)$ and $\textnormal{length}_{\Lambda}(A_2)$, 
and hence $\textnormal{length}_{\Lambda}(A_1 \times A_2)$, are all finite.  As 
$A_1 \times_A A_2 \subset A_1 \times A_2$ is a $\Lambda$-submodule, this 
implies $\textnormal{length}_{A_1 \times_A A_2}(A_1 \times_{A} A_2) = 
\textnormal{length}_{\Lambda}(A_1 \times_{A} A_2)$ is finite. So $A_1 
\times_{A} A_2$ is Artinian.

\medskip \noindent
As for (2), it holds because $A_2 \rightarrow A$ and $A_1 \times_{A} A_2 
\rightarrow A_1$ have the same kernel, and surjectivity of the first map 
implies that of the second.
\end{proof}


\subsection{Categories cofibered in groupoids over $\mathcal C_{\Lambda}$}
\label{subsection-cofibered-groupoids}

\noindent
In developing the theory we work with categories {\it cofibered} in groupoids. 
 We assume as known the definition and basic properties of categories 
{\it fibered} in groupoids (see
Categories, Section \ref{categories-section-fibred-categories}).

\begin{definition}
\label{definition-category-cofibred-groupoids}
Let $\mathcal C$ be a category.  A {\it category cofibered in groupoids over 
$\mathcal C$} is a category $\mathcal F$ equipped with a functor $p: \mathcal F 
\rightarrow \mathcal C$ such that $\mathcal F^{\textnormal{opp}}$ is a category 
fibered in groupoids over $\mathcal C^{\textnormal{opp}}$ via 
$p^{\textnormal{opp}}: \mathcal F^{\textnormal{opp}} \rightarrow \mathcal 
C^{\textnormal{opp}}$.
\end{definition}

\noindent
Explicitly, $p: \mathcal F \rightarrow \mathcal C$ is cofibered in groupoids if 
the following two conditions hold:
\begin{enumerate}
\item For every morphism $f: U \rightarrow V$ in $\mathcal C$ and every object 
$x$ lying over $U$, there is a morphism $x \rightarrow y$ of $\mathcal F$ lying 
over $f$.
\item For every pair of morphisms $a: x \rightarrow y$ and $b: x \rightarrow z$ 
of $\mathcal F$ and any morphism $f: p(y) \rightarrow p(z)$ such that $p(b) = f 
\circ p(a)$, there exists a unique morphism $c: y \rightarrow z$ of $\mathcal 
F$ lying over $f$ such that $b = c \circ a$.
\end{enumerate}

\begin{remarks}
\label{remarks-cofibered-groupoids}
Everything about categories fibered in groupoids translates directly to the 
cofibered setting.  The following remarks are meant to fix notation.
\begin{enumerate}
\item We often omit the functor $p: \mathcal F \rightarrow \mathcal C$ from the 
notation.
\item The fiber category over an object $U$ in $\mathcal C$ is denoted by 
$\mathcal F(U)$. Its objects are those of $\mathcal F$ lying over $U$ and its 
morphisms are those of $\mathcal F$ lying over $\textnormal{id}_{U}$.  If $x,y$ 
are objects of $\mathcal F(U)$, we sometimes write $\text{Hom}_{U}(x,y)$ for 
$\text{Hom}_{\mathcal F(U)}(x,y)$.
\item Let $\mathcal F$ be a category cofibered in groupoids over $\mathcal C$, 
let $f: U \rightarrow V$ be a morphism in $\mathcal C$, and let $x \in 
\textnormal{Ob}(\mathcal F(U))$.  A pushforward of $x$ along $f$ is a morphism 
$x \rightarrow y$ of $\mathcal F$ lying over $f$.  We sometimes write $x 
\rightarrow f_*x$ for ``the'' pushforward of $x$ along $f$, if it is assumed a 
fixed choice of pushforward has been made.  A choice of pushforwards for 
$\mathcal F$ is the choice of a pushforward of $x$ along $f$ for every pair 
$(x,f)$ as above.  We can make such a choice of pushforwards for $\mathcal F$ 
by the axiom of choice.
\item Let $\mathcal F$ be a category cofibered in groupoids over $\mathcal C$. 
Given a choice of pushforwards for $\mathcal F$, there is an associated 
pseudo-functor $\mathcal C \rightarrow \textnormal{(Groupoids)}$.  We will 
never use this construction so we give no details.
\item
\label{item-cofibered-morphism}
A morphism of categories cofibered in groupoids over $\mathcal C$ is a functor 
commuting with the projections to $\mathcal C$.  If $\mathcal F$ and $\mathcal 
F'$ are categories cofibered in groupoids over $\mathcal C$, we denote the 
morphisms from $\mathcal F$ to $\mathcal F'$ by $\textnormal{Hom}_{\mathcal 
C}(\mathcal F, \mathcal F')$.
\item 
\label{item-definition-cofibered-groupoids-2-category}
In fact categories cofibered in groupoids form a 2-category 
$\textnormal{Cof}(\mathcal C)$. Its 1-morphisms are the morphisms described in 
(\ref{item-cofibered-morphism}).  If $p: \mathcal F \rightarrow C$ and 
$p': \mathcal F' \rightarrow \mathcal C$ are categories cofibered in groupoids 
and $\varphi, \psi: \mathcal F \rightarrow \mathcal F'$ are $1$-morphisms, then 
a 2-morphism $t: \varphi \rightarrow \psi$ is a morphism of functors such that 
$p'(t_x) = \textnormal{id}_{p(x)}$ for all $x \in \textnormal{Ob}(\mathcal F)$.
\item
\label{item-construction-associated-cofibered-groupoid} 
Let $F: \mathcal C \rightarrow \textnormal{(Groupoids)}$ be a functor.  There 
is a category cofibered in groupoids $\mathcal F \rightarrow \mathcal C$ 
associated to $F$ as follows.  An object of $\mathcal F$ is a pair $(U,x)$ 
where $U \in \textnormal{Ob}(\mathcal C)$ and $x \in \textnormal{Ob}(F(U))$.  A 
morphism $(U,x) \rightarrow (V,y)$ is a pair $(f,a)$ where $f \in 
\textnormal{Hom}_{\mathcal C}(U,V)$ and $a \in 
\textnormal{Hom}_{F(V)}(F(f)(x),y)$.  The morphism $\mathcal F \rightarrow 
\mathcal C$ sends $(U,x)$ to $U$.
\item Given a category $\mathcal F$ cofibered in groupoids over $\mathcal C$, 
we denote by $\overline{\mathcal{F}} : \mathcal C \rightarrow 
\textnormal{(Sets)}$ the associated functor of isomorphism classes. Similarly, 
if $\varphi: \mathcal F \rightarrow \mathcal G$ is a morphism of cofibered 
categories, we denote by $\overline{\varphi}: \overline{\mathcal F} \rightarrow 
\overline{\mathcal G}$ the associated morphism of functors.
\item 
\label{item-convention-cofibered-sets}
Let $F: \mathcal C \rightarrow \textnormal{(Sets)}$ be a functor.  Then the 
construction (\ref{item-construction-associated-cofibered-groupoid})
associates to 
$F$ a category cofibered in sets. This defines a fully faithful embedding of 
the category of functors $\mathcal C \rightarrow \textnormal{(Sets)}$ to the 
category of categories cofibered in groupoids over $\mathcal C$. We identify 
the category of functors with its image under this embedding. Hence if $F: 
\mathcal C \rightarrow \textnormal{(Sets)}$ is a functor, we denote the 
associated category cofibered in sets also by $F$; and if $\varphi: F 
\rightarrow G$ is a morphism of functors, we denote still by $\varphi$ the 
corresponding morphism of categories cofibered in sets, and vice-versa.
\item 
\label{item-definition-yoneda}
Let $U$ be an object of $\mathcal C$.  We write $\underline{U}$ for the functor 
$\textnormal{Hom}_{\mathcal C}(U,-): \mathcal C \rightarrow 
\textnormal{(Sets)}$.  This defines a fully faithful embedding of $\mathcal 
C^{\textnormal{opp}}$ into the category of functors $\mathcal C \rightarrow 
\textnormal{(Sets)}$. Hence, if $f: U \rightarrow V$ is a morphism, we are 
justified in denoting still by $f$ the induced morphism $\underline{V} 
\rightarrow \underline{U}$, and vice-versa.
\item Fiber products of categories cofibered in groupoids: If $\mathcal F 
\rightarrow \mathcal H$ and $\mathcal G \rightarrow \mathcal H$ are morphisms 
of categories cofibered in groupoids over $\mathcal C_{\Lambda}$, then a 
construction of their 2-fiber product is given by the construction for their 
2-fiber product as categories over $\mathcal C_{\Lambda}$, as described in 
Categories, Lemma \ref{categories-lemma-2-product-categories-over-C}.
\item 
\label{item-definition-restricting-base-category}
Restricting the base category: Let $p : \mathcal F \rightarrow \mathcal C$ be a 
category cofibered in groupoids, and let $\mathcal C'$ be a full subcategory of 
$\mathcal C$.  The restriction $\mathcal F|_{\mathcal C'}$ is the full 
subcategory of $\mathcal F$ whose objects lie over $\mathcal C'$. It is a 
category cofibered in groupoids via the obvious functor $p|_{\mathcal C'}: 
\mathcal F|_{\mathcal C'} \rightarrow \mathcal C'$.
\end{enumerate}
\end{remarks}

\noindent
The categories cofibered in groupoids over $\mathcal C_{\Lambda}$ that arise in 
deformation theory will often satisfy the following condition.

\begin{definition}
\label{definition-predeformation-category}
A {\it predeformation category} $\mathcal F$ is a category cofibered in 
groupoids over $\mathcal C_{\Lambda}$ such that $\mathcal F(k)$ is a equivalent 
to a category with a single object and a single morphism, i.e.\ $\mathcal F(k)$ 
contains at least one object and there is a unique morphism between any two 
objects. A morphism of predeformation categories is a morphism of categories 
cofibered in groupoids over $\mathcal C_{\Lambda}$.
\end{definition}

\begin{remark}
\label{remark-predeformation-functor}
We say that a functor $F: \mathcal C_{\Lambda} \rightarrow \textnormal{(Sets)}$ 
is a {\it predeformation functor} if the associated cofibered set is a 
predeformation category, i.e.\ if $F(k)$ is a one element set.  Thus if 
$\mathcal F$ is a predeformation category, then $\overline{\mathcal F}$ is a 
predeformation functor.
\end{remark}

\begin{remark}
\label{remark-localize-cofibered-groupoid} 
Let $p: \mathcal F \rightarrow \mathcal C_{\Lambda}$ be a category cofibered in 
groupoids, and let $x \in \textnormal{Ob}(\mathcal F(k))$.  We denote by 
$\mathcal F_{x}$ the category of objects over $x$, i.e.\ the category whose 
objects are arrows $y \rightarrow x$ and whose morphisms are commutative 
diagrams
\[
\xymatrix{
y \ar[rr] \ar[dr] &   & z \ar[dl] \\
                 & x &. 
}
\]
There is an obvious functor $\mathcal F_{x} \rightarrow \mathcal F$.  We define 
the functor $p_x: \mathcal F_{x} \rightarrow \mathcal C_{\Lambda}$ as the 
composition $\mathcal F_x \rightarrow \mathcal F \xrightarrow{p} \mathcal 
C_{\Lambda}$. Then $p_x : \mathcal F_x \rightarrow \mathcal C_{\Lambda}$ is a 
predeformation category.  In this way we can pass from an arbitrary category 
cofibered in groupoids over $\mathcal C_{\Lambda}$ to a predeformation category 
at any point $x \in \textnormal{Ob}(\mathcal F(k))$.
\end{remark}

\subsection{The category $\widehat{\mathcal C}_{\Lambda}$}
\label{subsection-category-completion-CLambda}

\noindent
The following ``completion'' of the category $\mathcal C_{\Lambda}$ will serve 
as the base category of the completion of a category cofibered in groupoids 
over $\mathcal C_{\Lambda}$
(Subsection \ref{subsection-formal-objects}).

\begin{definition}
\label{definition-completion-CLambda}
We define {\it $\widehat{\mathcal C}_{\Lambda}$}
to be the category whose objects are 
complete Noetherian local $\Lambda$-algebras with residue field $k$, and whose 
morphisms are local $\Lambda$-algebra homomorphisms.
\end{definition}

\noindent
The aim of this document is to use prorepresentable functors to: (1) 
``approximate'' (as in find a minimal smooth morphism from a functor to) a 
category cofibered in groupoids over $\mathcal C_{\Lambda}$ (Section 
\ref{section-miniversal-objects}); (2) give ``presentations'' of categories 
cofibered in groupoids over $\mathcal C_{\Lambda}$ (Section 
\ref{section-deformation-groupoids-presentations}).  Prorepresentable functors 
are defined as follows.

\begin{definition}
\label{definition-prorepresentable}
Let $F: \mathcal C_{\Lambda} \rightarrow \textnormal{(Sets)}$ be a functor.
We  say $F$ is {\it prorepresentable} if there exists an isomorphism $F \cong 
\underline{R}|_{\mathcal C_{\Lambda}}$ of functors for some $R \in 
\textnormal{Ob}(\widehat{\mathcal C}_{\Lambda})$.
\end{definition}  

\noindent
Next we discuss basic properties of the category
$\widehat{\mathcal C}_{\Lambda}$.

\begin{definition}
\label{definition-tangent-space-ring}
Let $R \rightarrow S$ be a local homomorphism of local rings.  Let $\kappa(S)$ 
denote the residue field of $S$.  We write $T^*_{S/R}$ for the
{\it cotangent space} of the morphism $\text{Spec}(S) \to \text{Spec}(R)$
at the closed point  of $\text{Spec}(S)$; in other words, $T^*_{S/R}$ is
the $k(S)$-vector space 
$\mathfrak{m}_{S}/(\mathfrak{m}_{S}^2 + \mathfrak{m}_{R}S)$.  Similarly, we 
write $T_{S/R}$ for the {\it tangent space}, which is the dual $k(S)$-vector
space of $T^*_{S/R}$.
\end{definition}

\begin{lemma}
\label{lemma-surjective-cotangent-space}
Let $f: R \rightarrow S$ be a ring map in $\widehat{\mathcal C}_{\Lambda}$.  
Then $f$ is surjective if and only if the induced map $T^*_{R/\Lambda} 
\rightarrow T^*_{S/\Lambda}$ is surjective.
\end{lemma}

\begin{proof} 
The ``only if'' direction is obvious.  Conversely, assume $T^*_{R/\Lambda} 
\rightarrow T^*_{S/\Lambda}$ is surjective. In the proof, for any object $T$ of 
$\widehat{\mathcal C}_{\Lambda}$ and $n \geq 1$, we use the notation $T_n = 
T/\mathfrak{m}_{T}^n$. The ring $A_{n}$ is in $\mathcal C_{\Lambda}$, hence by 
Lemma \ref{lemma-length} it is of finite length over $\Lambda$ and in 
particular finite as a $\Lambda$-module.    

\medskip \noindent
We claim that for each $n \geq 1$, the map $R_n \rightarrow S_n$ is surjective. 
 By Nakayama's lemma it suffices to prove the same of $R_n \otimes_{\Lambda} k 
\rightarrow S_n \otimes_{\Lambda} k$.  But $R_n \otimes_{\Lambda} k \cong (R 
\otimes_{\Lambda} k)_n$ and $T^*_{R/\Lambda} \cong T^*_{R \otimes_{\Lambda} 
k/k}$, and similarly for $R$ replaced by $S$. Hence to prove the claim we may 
assume $\Lambda = k$. For $n = 1$, the claim is clearly true.  For $n \geq 2$, 
it follows by induction: the case $n = 2$ is true by the assumption that 
$T^*_{R/k} \rightarrow T^*_{S/k}$ is surjective, since $R_2 \cong k \oplus 
T^*_{R/k}$ and $S_2 \cong k \oplus T^*_{S/k}$ as $k$-vector spaces; and in the 
diagram
\[
\xymatrix{
0 \ar[r] & \mathfrak{m}_{R}^n/\mathfrak{m}_{R}^{n+1} \ar[r] \ar[d] & R_{n+1} 
\ar[r] \ar[d] & R_{n} \ar[r] \ar[d] & 0 \\
0 \ar[r] & \mathfrak{m}_S^{n}/\mathfrak{m}_{S}^{n+1} \ar[r] & S_{n+1} \ar[r] & 
S_{n} \ar[r] & 0
}
\]
the left vertical map is surjective by surjectivity of $T^*_{R/k} \rightarrow 
T^*_{S/k}$, so if the right vertical map is surjective then so is the middle 
vertical map.

\medskip \noindent
Now let $K_n$ be the kernel of $R_n \rightarrow S_n$.  Then the sequences 
\[ 0 \rightarrow K_n \rightarrow R_n \rightarrow S_n \rightarrow 0 \]
form an exact sequence of directed inverse systems.  The system $(K_n)$ is 
Mittag-Leffler since each $K_n$ is Artinian, hence by
Algebra, Lemma \ref{algebra-lemma-ML-exact-sequence}
taking limits preserves exactness.  So $f: R \cong \lim 
R_n \rightarrow \lim S_n \cong S$ is surjective.
\end{proof}

\noindent
Using Lemma \ref{lemma-surjective-cotangent-space}, we characterize when a 
surjection in $\mathcal C_{\Lambda}$ is essential.

\begin{lemma}
\label{lemma-essential-surjection}
Let $f: B \rightarrow A$ be a surjective ring map in $\mathcal C_{\Lambda}$.  
Then:
\begin{enumerate}
\item $f$ is an essential surjection if and only if the induced map 
$T^*_{B/\Lambda} \rightarrow T^*_{A/\Lambda}$ is an isomorphism.
\item If $f$ is a small extension, then $f$ is not essential if and only if $f$ 
has a section $s: A \rightarrow B$ with $f \circ s = \textnormal{id}_A$.
\end{enumerate}
\end{lemma}

\begin{proof}
First we prove (1). If $T^*_{B/\Lambda} \rightarrow T^*_{A/\Lambda}$ is an 
isomorphism, then $f$ is an essential surjection by Lemma 
\ref{lemma-surjective-cotangent-space}.  Conversely if $f$ is an essential 
surjection, take a basis $t_1, \dots, t_n$ for $T^*_{A/\Lambda}$ and choose 
$x_1, \dots, x_n \in B$ whose images in $T^*_{B/\Lambda}$ map to $t_1, \dots, 
t_n$. Let $C = \Lambda[x_1, \dots, x_r] \subset B$ and let $i: C 
\hookrightarrow B$ be the inclusion. Then $f \circ i: C \rightarrow A$ induces 
an isomorphism on cotangent spaces, so is surjective by Lemma 
\ref{lemma-surjective-cotangent-space}. This implies $C = B$ by essential 
surjectivity of $f$. Thus $\dim_{k} T^*_{B/\Lambda} = \dim_{k} T^*_{C/\Lambda} 
\leq n$, while also the induced map $T^*_{B/\Lambda} \rightarrow 
T^*_{A/\Lambda}$ is a surjection onto a $\dim_k T^*_{A/\Lambda} = n$ vector 
space.  We conclude the induced map $T^*_{B/\Lambda} \rightarrow 
T^*_{A/\Lambda}$ is an isomorphism.

\medskip \noindent
As for (2), a section $s$ of $f$ is not surjective (because by definition a 
small extension has nontrivial kernel), hence $f$ is not essentially 
surjective.  Conversely, assume $f$ is not essential.  Then let $C$ be the 
subring of $B$ as constructed in the previous paragraph.  It cannot be all of 
$B$, else we would conclude as above that $T^*_{B/\Lambda} \rightarrow 
T^*_{A/\Lambda}$ is an isomorphism and hence that $f$ is essentially surjective 
by (1).  Since $f: B \rightarrow A$ is a small extension, 
$\textnormal{length}_{\Lambda}(B) = \textnormal{length}_{\Lambda}(A) + 1$. Thus 
$\textnormal{length}_{\Lambda}(C) \leq \textnormal{length}_{\Lambda}(A)$ since 
$C$ is a proper subring of $B$.  But, as in the previous paragraph, the 
restriction $f|_{C}: C \rightarrow A$ is surjective, so in fact we must have 
$\textnormal{length}_{\Lambda}(C) = \textnormal{length}_{\Lambda}(A)$ and $f$ 
is an isomorphism.
\end{proof}

\noindent
We do not strictly need the following lemma, but it is psychologically useful.

\begin{lemma}
\label{lemma-CLambdahat-coproducts}
The category $\widehat{\mathcal C}_{\Lambda}$ admits coproducts.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\subsection{Formal objects and completion categories}
\label{subsection-formal-objects}

\begin{definition}
\label{definition-formal-objects}
Let $\mathcal F$ be a category cofibered in groupoids over
$\mathcal C_{\Lambda}$. The {\it category $\widehat{\mathcal F}$ of formal
objects of  $\mathcal F$} is the category with the following objects and
morphisms.
\begin{enumerate}
\item Objects: A {\it formal object $\xi = (R, \xi_n, f_n)$ of $\mathcal F$} 
consists of an object $R$ of $\widehat{\mathcal C}_{\Lambda}$, and a collection 
indexed by $n \in \mathbf{N}$ of objects $\xi_{n}$ of $\mathcal 
F(R/\mathfrak{m}_R^{n})$ and morphisms $f_{n}: \xi_{n+1} \rightarrow \xi_{n}$ 
lying over the projection $R/\mathfrak{m}_R^{n+1} \rightarrow 
R/\mathfrak{m}_R^{n}$.
\item Morphisms: Let $\xi = (R,\xi_n,f_n)$ and $\eta = (S,\eta_n,g_n)$ be 
formal objects of $\mathcal F$.  A {\it morphism $a: \xi \rightarrow \eta$ of 
formal objects} consists of a map $a_0: R \rightarrow S$ in $\widehat{\mathcal 
C}_{\Lambda}$ and a collection $a_n: \xi_n \rightarrow \eta_n$ of morphisms of 
$\mathcal F$ lying over $R/\mathfrak{m}_R^n \rightarrow S/\mathfrak{m}_S^n$, 
such that for every $n$ the diagram
\[
\xymatrix{
\xi_{n+1} \ar[r]^{f_{n}} \ar[d]_{a_{n+1}} & \xi_{n} \ar[d]^{a_{n}} \\
\eta_{n+1} \ar[r]^{g_{n}} & \eta_{n} 
}
\]
commutes.
\end{enumerate}
\end{definition}

\noindent
The category of formal objects comes with a functor $\widehat{p}: 
\widehat{\mathcal F} \rightarrow \widehat{\mathcal C}_{\Lambda}$ which sends an 
object $(R,\xi_n,f_n)$ to $R$ and a morphism $(R,\xi_n,f_n) \rightarrow 
(S,\eta_n,g_n)$ to the map $R \rightarrow S$.

\begin{lemma}
\label{lemma-completion-cofibred}
Let $p: \mathcal F \rightarrow \mathcal C_{\Lambda}$ be a category cofibered in 
groupoids.  Then $\widehat{p}: \widehat{\mathcal F} \rightarrow 
\widehat{\mathcal C}_{\Lambda}$ is a category cofibered in groupoids.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{definition}
\label{definition-completion}
Let $p: \mathcal F \rightarrow \mathcal C_{\Lambda}$ be a category cofibered in 
groupoids.  The category cofibered in groupoids $\widehat{p}: \widehat{\mathcal 
F} \rightarrow \widehat{\mathcal C}_{\Lambda}$ is called the
{\it completion of $\mathcal F$}.
\end{definition}

\noindent
If $\mathcal F$ is a category cofibered in groupoids over $\mathcal 
C_{\Lambda}$, we have defined $\widehat{\mathcal F}(R)$ for $R \in 
\textnormal{Ob}(\widehat{\mathcal C}_{\Lambda})$ in terms of the filtration of 
$R$ by powers of its maximal ideal.  But suppose $\mathcal I = (I_{n})$ is a 
filtration of $R$ by ideals inducing the $\mathfrak{m}_{R}$-adic topology.  We 
define $\widehat{\mathcal{F}}_{\mathcal I}(R)$ to be the category with the 
following objects and morphisms:
\begin{enumerate}
\item An object is a collection $(\xi_{n}, f_{n})_{n \in \mathbf{N}}$ of 
objects $\xi_{n}$ of $\mathcal F(I_{n})$ and morphisms $f_{n}: \xi_{n+1} 
\rightarrow \xi_{n}$ lying over the projections $R/I_{n+1} \rightarrow R/I_{n}$.
\item A morphism $a: (\xi_n,f_n) \rightarrow (\eta_n, g_n)$ consists of a 
collection $a_n: \xi_n \rightarrow \eta_n$ of morphisms in $\mathcal 
F(R/I_{n})$, such that for every $n$ the diagram
\[
\xymatrix{
\xi_{n+1} \ar[r]^{f_{n}} \ar[d]_{a_{n+1}} & \xi_{n} \ar[d]^{a_{n}} \\
\eta_{n+1} \ar[r]^{g_{n}} & \eta_{n} 
}
\]
commutes.
\end{enumerate}

\begin{lemma}
\label{lemma-formal-objects-different-filtration}
In the situation above, $\widehat{\mathcal{F}}_{\mathcal I}(R)$ is equivalent 
to the category $\widehat{\mathcal F}(R)$.
\end{lemma}

\begin{proof}
An equivalence $\widehat{\mathcal{F}}_{\mathcal I}(R) \rightarrow 
\widehat{\mathcal F}(R)$ can be defined as follows.  For each $n$, let $m(n)$ 
be the least $m$ that $I_{m} \subset \mathfrak{m}_{R}^{n}$.  Given an object 
$(\xi_n,f_n)$ of $\widehat{\mathcal{F}}_{\mathcal I}(R)$, let $\eta_{n}$ be the 
pushforward of $\xi_{n}$ along $R/I_{m(n)} \rightarrow R/\mathfrak{m}_{R}^{n}$ 
and let $g_{n}: \eta_{n+1} \rightarrow \eta_{n}$ be the induced morphism.  The 
equivalence $\widehat{\mathcal{F}}_{\mathcal I}(R) \rightarrow 
\widehat{\mathcal F}(R)$ sends $(\xi_n,f_n)$ to $(R,\eta_n,g_n)$.  We omit the 
verification that this is indeed an equivalence of categories.
\end{proof}

\begin{remark}
\label{remark-different-sequence-ideals}
Let $p: \mathcal F \rightarrow \mathcal C_{\Lambda}$ be a category cofibered in 
groupoids.  Suppose that for each $R \in \textnormal{Ob}(\widehat{\mathcal 
C}_{\Lambda})$ we are given a filtration $\mathcal I_{R}$ of $R$ by ideals.  
Then one can define a category $\widehat{\mathcal F}_{\mathcal I}$ by mimicking 
the definition of $\widehat{\mathcal F}$.  This category comes equipped with a 
morphism $\widehat{p}_{\mathcal I}: \widehat{\mathcal F}_{\mathcal I} 
\rightarrow \mathcal C_{\Lambda}$ making it into a category cofibered in 
groupoids such that $\widehat{\mathcal F}_{\mathcal I}(R)$ is isomorphic to 
$\widehat{\mathcal F}_{\mathcal I_{R}}(R)$ as defined above. If $\mathcal 
I_{R}$ induces the $\mathfrak{m}_{R}$-adic topology on $R$ for all $R$, then 
the categories cofibered in groupoids $\widehat{\mathcal F}_{\mathcal I}$ and 
$\widehat{\mathcal F}$ are equivalent---over an object $R \in 
\textnormal{Ob}(\widehat{\mathcal C}_{\Lambda})$ this equivalence is precisely 
that of Lemma \ref{lemma-formal-objects-different-filtration}.
\end{remark}

\begin{remark}
\label{remark-completion-functor}
Let $F: \mathcal C_{\Lambda} \rightarrow \textnormal{(Sets)}$ be a functor.  
Identifying functors with cofibered sets, the completion of $F$ is the functor 
$\widehat{F}: \widehat{\mathcal C}_{\Lambda} \rightarrow \textnormal{(Sets)}$ 
given by $\widehat{F}(S) = \lim_{n} F(S/\mathfrak{m}_{S}^{n})$.  This agrees 
with the definition in Schlessinger's paper \cite{Sch}.
\end{remark}

\begin{remark}
\label{remark-completion-morphism}
Let $\varphi: \mathcal F \rightarrow \mathcal G$ be a morphism of categories 
cofibered in groupoids over $\mathcal C_{\Lambda}$.  Then there is an induced 
morphism $\widehat{\varphi}: \widehat{\mathcal F} \rightarrow  
\widehat{\mathcal G}$ of categories cofibered in groupoids over 
$\widehat{\mathcal C}_{\Lambda}$. It sends an object $\xi = (R, \xi_n, f_n)$ of 
$\widehat{\mathcal F}$ to $(R, \varphi(\xi_n), \varphi(f_n))$, and it sends a 
morphism $(a_0: R \rightarrow S, a_n: \xi_n \rightarrow \eta_n)$ between 
objects $\xi$ and $\eta$ of $\widehat{\mathcal F}$ to $(a_0: R \rightarrow S, 
\varphi(a_n): \varphi(\xi_n) \rightarrow \varphi(\eta_n))$.
\end{remark} 

\begin{remark}
\label{remark-completion-restriction-adjoint}
As in
Remarks \ref{remarks-cofibered-groupoids}
(\ref{item-definition-cofibered-groupoids-2-category}),
for a category $\mathcal C$ 
we denote by $\textnormal{Cof}(\mathcal C)$ the 2-category of categories 
cofibered in groupoids over $\mathcal C$. Remark 
\ref{remark-completion-morphism} says that completion defines a functor 
$\widehat{~}: \textnormal{Cof}(\mathcal C_{\Lambda}) \rightarrow 
\textnormal{Cof}(\widehat{\mathcal C}_{\Lambda})$ on the $1$-category 
truncations (denoted still by $\textnormal{Cof}(\mathcal C_{\Lambda})$ and 
$\textnormal{Cof}(\widehat{\mathcal C}_{\Lambda})$).  As in
Remarks \ref{remarks-cofibered-groupoids}
(\ref{item-definition-restricting-base-category}), 
there is also a restriction functor $|_{\mathcal C_{\Lambda}}: 
\textnormal{Cof}(\widehat{\mathcal C}_{\Lambda}) \rightarrow 
\textnormal{Cof}(\mathcal C_{\Lambda})$ on the $1$-truncations.  

\medskip \noindent
The functors $\widehat{~}$ and $|_{\mathcal C_{\Lambda}}$ can be considered 
``2-adjoint'' in the following sense.  Let $\mathcal F \in 
\textnormal{Ob}(\textnormal{Cof}(\mathcal C_{\Lambda}))$ and let $\mathcal G 
\in \textnormal{Ob}(\textnormal{Cof}(\widehat{\mathcal C}_{\Lambda}))$.  Then 
there is an equivalence of categories
\[ 
\Phi: \textnormal{Hom}_{\mathcal C_{\Lambda}}(\mathcal G|_{\mathcal 
C_{\Lambda}}, \mathcal F) 
\xrightarrow{\sim} 
\textnormal{Hom}_{\widehat{\mathcal C}_{\Lambda}}(\mathcal G, \widehat{\mathcal 
F}) .
\]
(We do not address functoriality of $\Phi$.) To describe this equivalence, we 
first define the ``unit'' $\mathcal G \rightarrow \widehat{\mathcal 
G|_{\mathcal C_{\Lambda}}}$ and ``counit'' $\widehat{\mathcal F}|_{\mathcal 
C_{\Lambda}} \rightarrow \mathcal F$:
\begin{enumerate}
\item Let $\xi$ be an object of the fiber category $\mathcal G(R)$.  Choose a 
pushforward $\xi \rightarrow \xi_{n}$ of $\xi$ to $R/\mathfrak{m}_{R}^{n}$ for 
each $n \in \mathbf{N}$, and let $f_{n}: \xi_{n+1} \rightarrow \xi_{n}$ be the 
induced morphism.  The unit $\mathcal G \rightarrow \widehat{\mathcal 
G|_{\mathcal C_{\Lambda}}}$ sends $\xi$ to $(R,\xi_{n},f_{n})$.  
\item Let $(A,\xi_n,f_n)$ be an object of $\widehat{\mathcal F}|_{\mathcal 
C_{\Lambda}}(A)$. Since $A$ is Artinian, we can choose $m$ such that 
$\mathfrak{m}_{A}^{m} = 0$.  The counit $\widehat{\mathcal F}|_{\mathcal 
C_{\Lambda}} \rightarrow \mathcal F$ sends $(A,\xi_n,f_n)$ to $\xi_{m}$.  It is 
not difficult to see that $\widehat{\mathcal F}|_{\mathcal C_{\Lambda}} 
\rightarrow \mathcal F$ is in fact an equivalence of categories cofibered in 
groupoids.
\end{enumerate}
The equivalence $\Phi: \textnormal{Hom}_{\mathcal C_{\Lambda}}(\mathcal 
G|_{\mathcal C_{\Lambda}}, \mathcal F) 
\xrightarrow{\sim} 
\textnormal{Hom}_{\widehat{\mathcal C}_{\Lambda}}(\mathcal G, \widehat{\mathcal 
F})$ sends a morphism $\varphi: \mathcal G|_{\mathcal C_{\Lambda}} \rightarrow 
\mathcal F$ to
\[ \mathcal G \rightarrow \widehat{\mathcal G|_{\mathcal C_{\Lambda}}} 
\xrightarrow{\widehat{\varphi}} \widehat{\mathcal F} .\]
There is a quasi-inverse $\Psi: \textnormal{Hom}_{\widehat{\mathcal 
C}_{\Lambda}}(\mathcal G, \widehat{\mathcal F}) \rightarrow 
\textnormal{Hom}_{\mathcal C_{\Lambda}}(\mathcal G|_{\mathcal C_{\Lambda}}, 
\mathcal F)$ to $\Phi$ which sends $\psi: \mathcal G \rightarrow 
\widehat{\mathcal F}$ to
\[ \mathcal G|_{\mathcal C_{\Lambda}} \xrightarrow{\psi|_{\mathcal 
C_{\Lambda}}} \widehat{\mathcal F}|_{\mathcal C_{\Lambda}} \rightarrow \mathcal 
F.\]
\end{remark}

\begin{remark}
\label{remark-completion-restriction-cofset-adjoint}
For a category $\mathcal C$ we denote by $\textnormal{CofSet}(\mathcal C)$ the 
category of cofibered sets over $\mathcal C$.  It is a $1$-category isomorphic 
the category of functors $\mathcal C \rightarrow \textnormal{(Sets)}$.  The 
completion and restriction functors restrict to functors $\widehat{~}: 
\textnormal{CofSet}(\mathcal C_{\Lambda}) \rightarrow 
\textnormal{CofSet}(\widehat{\mathcal C}_{\Lambda})$ and $|_{\mathcal 
C_{\Lambda}}: \textnormal{CofSet}(\widehat{\mathcal C}_{\Lambda}) \rightarrow 
\textnormal{CofSet}(\mathcal C_{\Lambda})$ which we denote by the same symbols. 
 As functors on the categories of cofibered sets, completion and restriction 
are adjoints in the usual 1-categorical sense: the same construction as in 
Remark \ref{remark-completion-restriction-adjoint} defines a functorial 
bijection
\[ 
\textnormal{Hom}_{\mathcal C_{\Lambda}}(G|_{\mathcal C_{\Lambda}}, F) 
\xrightarrow{\sim} 
\textnormal{Hom}_{\widehat{\mathcal C}_{\Lambda}}(G, \widehat{F}) 
\]
for $F \in \textnormal{Ob}(\textnormal{CofSet}(\mathcal C_{\Lambda}))$ and $G 
\in \textnormal{Ob}(\textnormal{CofSet}(\widehat{\mathcal C}_{\Lambda}))$.  In 
this case the counit $\widehat{F}|_{\mathcal C_{\Lambda}} \rightarrow F$ is an 
isomorphism.
\end{remark}

\begin{remark}
\label{remark-formal-objects-yoneda}
Let $R$ be an object of $\widehat{\mathcal C}_{\Lambda}$.  It defines a functor 
$\underline{R}: \widehat{\mathcal C}_{\Lambda} \rightarrow \textnormal{(Sets)}$ 
as described in
Remarks \ref{remarks-cofibered-groupoids} (\ref{item-definition-yoneda}).
As usual we identify this functor with the 
associated cofibered set.  If $\mathcal F$ is a cofibered category over 
$\mathcal C_{\Lambda}$, then there is an equivalence of categories
\[
\textnormal{Hom}_{\mathcal C_{\Lambda}}(\underline{R}|_{\mathcal C_{\Lambda}}, 
\mathcal F) 
\xrightarrow{\sim} 
\widehat{\mathcal F}(R).
\]
It is given by the composition
\[
\textnormal{Hom}_{\mathcal C_{\Lambda}}(\underline{R}|_{\mathcal C_{\Lambda}}, 
\mathcal F) 
\xrightarrow{\Phi} 
\textnormal{Hom}_{\widehat{\mathcal C}_{\Lambda}}(\underline{R}, 
\widehat{\mathcal F}) 
\xrightarrow{\sim}
\widehat{\mathcal F}(R)
\]
where $\Phi$ is as in Remark \ref{remark-completion-restriction-adjoint} and 
the second equivalence comes from the 2-Yoneda lemma (the cofibered analogue of 
Categories, Lemma \ref{categories-lemma-yoneda-2category}).
Explicitly, the equivalence sends a 
morphism $\varphi: \underline{R}|_{\mathcal C_{\Lambda}} \rightarrow \mathcal 
F$ to the formal object $(R, \varphi(R \rightarrow R/\mathfrak{m}_R^n), 
\varphi(f_n))$ in $\widehat{\mathcal F}(R)$, where $f_{n}: 
R/\mathfrak{m}_R^{n+1} \rightarrow R/\mathfrak{m}_{R}^{n}$ is the projection.  

\medskip \noindent
Assume a choice of pushforwards for $\widehat{\mathcal F}$ has been made.  Then 
there is an explicit quasi-inverse
\[ \widehat{\mathcal F}(R) \rightarrow \textnormal{Hom}_{\widehat{\mathcal 
C}_{\Lambda}}(\underline{R}, \widehat{\mathcal F}) \]
to the 2-Yoneda equivalence which takes $\xi$ to the the morphism 
$\underline{R} \rightarrow \widehat{\mathcal F}$ sending $f \in 
\underline{R}(S) = \text{Hom}_{\mathcal C_{\Lambda}}(R,S)$ to $f_* \xi$.  Then 
a quasi-inverse to $\textnormal{Hom}_{\mathcal 
C_{\Lambda}}(\underline{R}|_{\mathcal C_{\Lambda}}, \mathcal F) 
\xrightarrow{\sim} 
\widehat{\mathcal F}(R)$ is given by
\[
\widehat{\mathcal F}(R) 
\rightarrow 
\textnormal{Hom}_{\widehat{\mathcal C}_{\Lambda}}(\underline{R}, 
\widehat{\mathcal F})
\xrightarrow{\Psi}
\textnormal{Hom}_{\mathcal C_{\Lambda}}(\underline{R}|_{\mathcal C_{\Lambda}}, 
\mathcal F)
\]
where $\Psi$ is as in Remark \ref{remark-completion-restriction-adjoint}.  
Given $\xi \in \text{Ob}(\widehat{\mathcal F}(R))$, we write $\underline{\xi}: 
\underline{R}|_{\mathcal C_{\Lambda}} \rightarrow \mathcal F$ for its image 
under this quasi-inverse.
\end{remark}

\begin{remark}
\label{remark-spell-out-formal-object}
According to Remark \ref{remark-formal-objects-yoneda}, giving a formal object 
$\xi$ of $\mathcal F$ is equivalent to giving a prorepresentable functor $U: 
\mathcal C_{\Lambda} \rightarrow \textnormal{(Sets)}$ and a morphism $U 
\rightarrow \mathcal{F}$. 
\end{remark}

\begin{remark}
\label{remark-restrict-complete-continuous-functor}
Let $F : \widehat{\mathcal C}_{\Lambda} \rightarrow \textnormal{(Sets)}$ be a 
functor that commutes with limits.  Then there is a canonical isomorphism $F 
\cong \widehat{F|_{\mathcal C_{\Lambda}}}$ (in fact it is just the unit $F 
\rightarrow \widehat{F|_{\mathcal C_{\Lambda}}}$ of the adjunction described in 
Remark \ref{remark-completion-restriction-cofset-adjoint}).  Indeed, if $S$ is 
an object of $\widehat{\mathcal C}_{\Lambda}$, then we have canonical bijections
\[ \widehat{F|_{\mathcal C_{\Lambda}}}(S) = \lim_{n} F(S/\mathfrak{m}_{S}^n) 
\cong F(\lim_{n} S/\mathfrak{m}_{S}^n) \cong F(S). \]
In particular, if $R$ is an object of $\widehat{\mathcal C}_{\Lambda}$ then 
$\underline{R} \cong \widehat{\underline{R}|_{\mathcal C_{\Lambda}}}$.
\end{remark}




\subsection{Smooth morphisms}
\label{subsection-smooth-morphisms}

\noindent
In the rest of this section we discuss smooth morphisms of categories 
cofibered in groupoids over $\mathcal C_{\Lambda}$.

\begin{definition}
\label{definition-smooth-morphism}
Let $\varphi: \mathcal F \rightarrow \mathcal G$ be a morphism of categories 
cofibered in groupoids over $\mathcal C_{\Lambda}$.  We say  $\varphi$ is 
{\it smooth} if it satisfies the following condition: Let $B \rightarrow A$ be 
a surjective ring map in $\mathcal C_{\Lambda}$.  Let $y \in 
\textnormal{Ob}(\mathcal G(B)), x \in \textnormal{Ob}(\mathcal F(A))$, and $y 
\rightarrow \varphi(x)$ be a morphism lying over $B \rightarrow A$.  Then there 
exists $x' \in \textnormal{Ob}(\mathcal F(B))$, a morphism $x' \rightarrow x$ 
lying over $B \rightarrow A$, and a morphism $\varphi(x') \rightarrow y$ lying 
over $\textnormal{id}: B \rightarrow B$, such that the diagram
\[
\xymatrix{
\varphi(x') \ar[r] \ar[dr] & y \ar[d] \\
                        & \varphi(x)
}
\]
commutes.
\end{definition}

\begin{lemma}
\label{lemma-smoothness-small-extensions}
Let $\varphi: \mathcal F \rightarrow \mathcal G$ be a morphism of categories 
cofibered in groupoids over $\mathcal C_{\Lambda}$.  Then $\varphi$ is smooth 
if the condition in Definition \ref{definition-smooth-morphism} is assumed to 
hold only for small extensions $B \rightarrow A$.
\end{lemma}

\begin{proof}
Let $B \rightarrow A$ be a surjective ring map in $\mathcal C_{\Lambda}$.  Let 
$y \in \textnormal{Ob}(\mathcal G(B)), x \in \textnormal{Ob}(\mathcal F(A))$, 
and $y \rightarrow \varphi(x)$ be a morphism lying over $B \rightarrow A$.  By 
Lemma \ref{lemma-factor-small-extension} we can factor $B \rightarrow A$ into 
small extensions $B = B_n \rightarrow B_{n-1} \rightarrow \cdots \rightarrow 
B_0 = A$.  By induction it suffices to consider the case where we have a 
factorization $B = B_2 \xrightarrow{f} B_1 \xrightarrow{g} B_0 = A$ into two 
small extensions.  Choose a pushforward $y \rightarrow f_* y$ of $y$ along $f$, 
so that the morphism $y \rightarrow \varphi(x)$ factors as $y \rightarrow f_* y 
\rightarrow \varphi(x)$.  By assumption we can find $x_1 \rightarrow x$ lying 
over $B_1 \rightarrow B_0$ and $a: \varphi(x_1) \rightarrow f_*y$ lying over 
$\textnormal{id}: B_1 \rightarrow B_1$ such that
\[
\xymatrix{
\varphi(x_1) \ar[r]^{a} \ar[dr] & f_*y \ar[d] \\
                        & \varphi(x)
}
\]
commutes. Similarly we can apply the assumption to $y \rightarrow f_*y 
\xrightarrow{a^{-1}} \varphi(x_1)$ to obtain $x_2 \rightarrow x_1$ lying over 
$B_2 \rightarrow B_1$ and $\varphi(x_2) \rightarrow y$ lying over 
$\textnormal{id}: B_2 \rightarrow B_2$ so that the diagram
\[
\xymatrix{
\varphi(x_2) \ar[r] \ar[d] & y \ar[d] \\
\varphi(x_1) \ar[r]^{a} \ar[dr] & f_*y \ar[d] \\
                        & \varphi(x)
}
\] 
commutes. Then the composition $x_2 \rightarrow x_1 \rightarrow x$ and 
$\varphi(x_2) \rightarrow y$ are the morphisms required by the definition of 
smoothness.
\end{proof}

\begin{remark}
\label{remark-smoothness-2-categorical}
Let $\varphi: \mathcal F \rightarrow \mathcal G$ be a morphism of categories 
cofibered in groupoids over $\mathcal C_{\Lambda}$.  Let $B \rightarrow A$ be a 
ring map in $\mathcal{C}_{\Lambda}$.  Choices of pushforwards along $B 
\rightarrow A$ for objects in the fiber categories $\mathcal F(B)$ and 
$\mathcal G(B)$ determine functors $\mathcal F(B) \rightarrow \mathcal F(A)$ 
and $\mathcal G(B) \rightarrow \mathcal G(A)$ fitting into a $2$-commutative 
diagram
\[
\xymatrix{
\mathcal F(B) \ar[r]^{\varphi} \ar[d] & \mathcal G(B) \ar[d] \\
\mathcal F(A) \ar[r]^{\varphi}        & \mathcal G(A) .
}
\]
Hence there is an induced functor $\mathcal F(B) \rightarrow \mathcal F(A) 
\times_{\mathcal G(A)} \mathcal G(B)$.  Unwinding the definitions shows that 
$\varphi: \mathcal F \rightarrow \mathcal G$ is smooth if and only if this 
induced functor is essentially surjective whenever $B \rightarrow A$ is 
surjective (or equivalently, by Lemma \ref{lemma-smoothness-small-extensions}, 
whenever $B \rightarrow A$ is a small extension).
\end{remark}

\begin{remark}
\label{remark-compare-smooth-schlessinger}
The equivalent definition of a smooth morphism from Remark 
\ref{remark-smoothness-2-categorical} is analogous to Schlessinger's notion of 
a smooth morphism of functors, cf.\ \cite[Definition 2.2.]{Sch}. In 
fact, it reduces to that notion when $\mathcal F$ and $\mathcal G$ are 
cofibered in sets.
\end{remark}

\begin{remark}
\label{remark-smooth-to-iso-classes}
Let $\mathcal F$ be a category cofibered in groupoids over
$\mathcal C_{\Lambda}$.  Then the morphism
$\mathcal F \rightarrow \overline{\mathcal F}$ is smooth.
\end{remark}

\noindent
If $R \rightarrow S$ is a ring map $\widehat{\mathcal C}_{\Lambda}$, then there 
is an induced morphism $\underline{S} \rightarrow \underline{R}$ between the 
functors $\underline{S},\underline{R}: \widehat{\mathcal C}_{\Lambda} 
\rightarrow \textnormal{(Sets)}$.  In this situation, smoothness of the 
restriction $\underline{S}|_{\mathcal C_{\Lambda}} \rightarrow 
\underline{R}|_{\mathcal C_{\Lambda}}$ is a familiar notion:

\begin{lemma}
\label{lemma-smooth-morphism-power-series}
Let $R \rightarrow S$ be a ring map in $\widehat{\mathcal C}_{\Lambda}$.  Then 
the induced morphism $\underline{S}|_{\mathcal C_{\Lambda}} \rightarrow 
\underline{R}|_{\mathcal C_{\Lambda}}$ is smooth if and only if $S$ is a power 
series ring over $R$.
\end{lemma}

\begin{proof}
If $S$ is a power series over $R$, then smoothness of $\underline{S}|_{\mathcal 
C_{\Lambda}} \rightarrow \underline{R}|_{\mathcal C_{\Lambda}}$ follows 
immediately from the universal property of a power series ring over $R$.  
Conversely, assume $\underline{S} \rightarrow \underline{R}$ is smooth.  Let 
$x_1, \dots, x_n \in S$ be elements whose images in $T^*_{S/R}$ form a basis, 
let $T = R[[X_1, \dots, X_n]]$, and let $S/(\mathfrak{m}_S^2 + 
\mathfrak{m}_{\Lambda}S) \rightarrow T/(\mathfrak{m}_T^2 + 
\mathfrak{m}_{\Lambda}T)$ be the local $R$-algebra isomorphism given by mapping 
the image of $x_i$ in $S/(\mathfrak{m}_S^2 + \mathfrak{m}_{\Lambda}S)$ to the 
image of $X_i$ in $T/(\mathfrak{m}_T^2 + \mathfrak{m}_{\Lambda}T)$.  Let $f_1: 
S \rightarrow T/(\mathfrak{m}_T^2 + \mathfrak{m}_{\Lambda}T)$ be the 
composition $S \rightarrow S/(\mathfrak{m}_S^2 + \mathfrak{m}_{\Lambda}S) 
\rightarrow T/(\mathfrak{m}_T^2 + \mathfrak{m}_{\Lambda}T)$.  By smoothness we 
can lift $f_1$ to a map $f_2: S \rightarrow T/\mathfrak{m}_T^2$, then to a map 
$f_3: S \rightarrow T/\mathfrak{m}_T^3$, and so on, for all $n \geq 1$.  Thus 
we get an induced map $f: S \rightarrow T$ of local $R$-algebras.  By the 
choice of $f_1$, $f$ induces an isomorphism $T^*_{S/R} \rightarrow T^*_{T/R}$, 
hence $f$ is surjective by Lemma \ref{lemma-surjective-cotangent-space}.  
Choosing preimages $y_i \in S$ of $X_i \in T$ under $f$, we obtain a local 
$R$-algebra homomorphism $s: T \rightarrow S$ which is a section for $f$, $f 
\circ s = \textnormal{id}$. Then $s$ is injective. But $s$ induces an 
isomorphism on cotangent spaces since $f$ does, so it is also surjective by 
Lemma \ref{lemma-surjective-cotangent-space}. 
\end{proof}

\noindent
Smooth morphisms satisfy the following functorial properties.

\begin{lemma}
\label{lemma-smooth-properties}
Let $\varphi: \mathcal F \rightarrow \mathcal G$ and $\psi: \mathcal G 
\rightarrow \mathcal H$ be morphisms of categories cofibered in groupoids over 
$\mathcal C_{\Lambda}$.
\begin{enumerate}
\item If $\varphi$ and $\psi$ are smooth, then $\psi \circ \varphi$ is smooth.
\item If $\varphi$ is essentially surjective and $\psi \circ \varphi$ is 
smooth, then $\psi$ is smooth.
\item If $\mathcal G' \rightarrow \mathcal G$ is a morphism of categories 
cofibered in groupoids and $\varphi$ is smooth, then $\mathcal F 
\times_{\mathcal G} \mathcal G' \rightarrow \mathcal G'$ is smooth.
\end{enumerate}
\end{lemma} 

\begin{proof}
Statements (1) and (2) follow immediately from the definitions.  For (3), use 
the formulation of smoothness given in Remark 
\ref{remark-smoothness-2-categorical}.
\end{proof}

\begin{lemma}
\label{lemma-smooth-morphism-essentially-surjective}
Let $\varphi: \mathcal F \rightarrow \mathcal G$ be a smooth morphism of 
categories cofibered in groupoids over $\mathcal C_{\Lambda}$.  Assume 
$\varphi: \mathcal F(k) \rightarrow \mathcal G(k)$ is essentially surjective, 
e.g.\ this holds if $\mathcal F$ and $\mathcal G$ are predeformation 
categories. Then $\widehat{\varphi}: \widehat{\mathcal F} \rightarrow 
\widehat{\mathcal G}$ is essentially surjective.  In particular, $\varphi: 
\mathcal F \rightarrow \mathcal G$ is also essentially surjective.
\end{lemma}

\begin{proof}
Let $\eta = (R,\eta_{n},g_n)$ be an object of $\widehat{\mathcal G}$.  We 
construct an object $\xi$ of $\widehat{\mathcal F}$ with an isomorphism $\eta 
\rightarrow \varphi(\xi)$. By the assumption on essential surjectivity of 
$\varphi: \mathcal F(k) \rightarrow \mathcal G(k)$, there exists a morphism 
$\eta_{1} \rightarrow \varphi(\xi_1)$ in $\mathcal G(k)$ for some $\xi_{1} \in 
\textnormal{Ob}(\mathcal F(k))$.  The morphism $\eta_{2} \xrightarrow{g_1} 
\eta_{1} \rightarrow  \varphi(\xi_1)$ lies over the surjective ring map 
$R/\mathfrak{m}_R^2 \rightarrow k$, hence by smoothness of $\varphi$ there 
exists $\xi_{2} \in \textnormal{Ob}(\mathcal F(R/\mathfrak{m}_R^2))$, a 
morphism $f_1: \xi_{2} \rightarrow \xi_{1}$ lying over $R/\mathfrak{m}_R^2 
\rightarrow k$, and a morphism $\eta_{2} \rightarrow \varphi(\xi_2)$ such that 
\[
\xymatrix{
\varphi(\xi_{2})  \ar[r]^{\varphi(f_1)} &  \varphi(\xi_{1})   \\
\eta_{2}   \ar[u] \ar[r]^{g_1}  & \eta_1  \ar[u] \\
}
\]
commutes.  Continuing in this way we construct an object $\xi = 
(R,\xi_{n},f_{n})$ of $\widehat{\mathcal F}$ and a morphism $\eta \rightarrow 
\varphi(\xi) = (R,\varphi(\xi_n),\varphi(f_{n}))$ in $\widehat{\mathcal G}(R)$.
\end{proof}

\begin{remark}
\label{remark-cofibered-groupoid-projection-smooth}
Let $p: \mathcal F \rightarrow \mathcal C_{\Lambda}$ be a category cofibered in 
groupoids. We can consider $\mathcal C_{\Lambda}$ as the trivial category 
cofibered in groupoids over $\mathcal C_{\Lambda}$, and then $p$ is a morphism 
of categories cofibered in groupoids over $\mathcal C_{\Lambda}$.  We say 
$\mathcal F$ is {\it smooth} if its structure morphism $p$ is smooth---this is 
the ``absolute'' notion of smoothness for a category cofibered in groupoids 
over $\mathcal C_{\Lambda}$.
\end{remark}

\begin{remark}
\label{remark-smooth-on-top}
Suppose $\mathcal F$ is a predeformation category admitting a smooth morphism 
$\varphi: \mathcal U \rightarrow \mathcal F$ from a predeformation category 
$\mathcal U$.  Then by
Lemma \ref{lemma-smooth-morphism-essentially-surjective} 
$\varphi$ is essentially surjective, so by
Lemma \ref{lemma-smooth-properties} 
$p: \mathcal F \rightarrow \mathcal C_{\Lambda}$ is smooth if and only if the 
composition $\mathcal U \xrightarrow{\varphi} \mathcal F \xrightarrow{p} 
\mathcal C_{\Lambda}$ is smooth, i.e.\ $\mathcal F$ is smooth if and only if 
$\mathcal U$ is smooth.  In particular, if $\mathcal U$ is a functor 
prorepresented by a ring $R$ in $\widehat{\mathcal C}_{\Lambda}$, $\mathcal U 
\cong \underline{R}|_{\mathcal C_{\Lambda}}$, then we see by
Lemma  \ref{lemma-smooth-morphism-power-series}
that $\mathcal F$ is smooth if and
only if $R$ is a power series over $\Lambda$.
\end{remark}

\noindent
In order to produce smooth morphisms from functors to a predeformation category 
$\mathcal F$ (the essential objective of
Subsection \ref{subsection-miniversal-objects-existence}),
we will construct formal 
objects of $\mathcal F$ whose corresponding morphisms to $\mathcal F$ are 
smooth.  These are the so-called versal formal objects of $\mathcal F$.

\begin{definition}
\label{definition-versal}
Let $\mathcal F$ be a category cofibered in groupoids.  Let $\xi$ be a formal 
object of $\mathcal F$ lying over $R \in \textnormal{Ob}(\widehat{\mathcal 
C}_{\Lambda})$.  We say $\xi$ is {\it versal} if the corresponding morphism 
$\underline{\xi}: \underline{R}|_{\mathcal C_{\Lambda}} \rightarrow \mathcal F$ 
of Remark \ref{remark-formal-objects-yoneda} is smooth.
\end{definition}

\begin{remark}
\label{remark-versal-object}
Let $\mathcal F$ be a category cofibered in groupoids over $\mathcal 
C_{\Lambda}$, and let $\xi$ be a formal object of $\mathcal F$.  It follows 
from the definition of smoothness that versality of $\xi$ is equivalent to the 
following condition: If 
\[
\xymatrix{
            &  y \ar[d] \\
\xi \ar[r]  &  x
}
\]
is a diagram in $\widehat{\mathcal F}$ such that $y \rightarrow x$ lies over a 
surjective map $B \rightarrow A$ of Artinian rings (we may assume it is a small 
extension),  then there exists a morphism $\xi \rightarrow y$ such that
\[
\xymatrix{
            &  y \ar[d] \\
\xi \ar[r] \ar[ur]  &  x
}
\] 
commutes. In particular, the condition that $\xi$ be versal does not depend on 
the choices of pushforwards made in the construction of $\underline{\xi}: 
\underline{R}|_{\mathcal C_{\Lambda}} \rightarrow \mathcal F$ in Remark 
\ref{remark-formal-objects-yoneda}.
\end{remark}

\begin{lemma}
\label{lemma-versal-object-quasi-initial}
Let $\mathcal F$ be a category cofibered in groupoids over $\mathcal 
C_{\Lambda}$.  Let $\xi$ be a versal formal object of $\mathcal F$.  For any 
formal object $\eta$ of $\widehat{\mathcal F}$, there exists a morphism $\xi 
\rightarrow \eta$.
\end{lemma}

\begin{proof}
Follows from Lemma \ref{lemma-smooth-morphism-essentially-surjective}.
\end{proof}




\section{Schlessinger's Conditions and Miniversal Formal Objects}
\label{section-miniversal-objects}

\noindent
In this section we introduce conditions on a predeformation category which 
guarantee the existence of a miniversal formal object (as defined in
Subsection \ref{subsection-miniversal-objects-existence}).




\subsection{Schlessinger's conditions}
\label{section-schlessinger-conditions}

\noindent
We denote by $k[\varepsilon]$ the ring of dual numbers over $k$.  More 
generally, for a $k$-vector space $V$, we denote by $k[V]$ the $k$-algebra 
whose underlying vector space is $k \oplus V$ and whose multiplication is given 
by $(a,v) \cdot (a',v') = (aa', av' + a'v)$.  When $V = k$, $k[V]$ is the ring 
of dual numbers over $k$.  For any finite dimensional $k$-vector space $V$, 
$k[V]$ is in $\mathcal C_{\Lambda}$.

\begin{definition}
\label{definition-S1-S2}
Let $\mathcal F$ be a category cofibered in groupoids over $\mathcal 
C_{\Lambda}$. We define {\it conditions (S1) and (S2)}
on $\mathcal F$ as follows:
\begin{enumerate}
\item[(S1)] Every diagram
\[
\xymatrix{
           & x_2 \ar[d] \\
x_1 \ar[r] & x   
}
\]
in $\mathcal F$ lying over
\[
\xymatrix{
           & A_2 \ar[d] \\
A_1 \ar[r] & A   
}
\]  
in $\mathcal C_{\Lambda}$ with $A_2 \rightarrow A$ surjective can be completed 
to a commutative diagram
\[
\xymatrix{
y \ar[r] \ar[d] & x_2 \ar[d] \\
x_1 \ar[r]      & x   
}
\]
over
\[
\xymatrix{
A_1 \times_{A} A_2 \ar[r] \ar[d] & A_2 \ar[d] \\ 
A_1 \ar[r]      & A.   
}
\]

\item[(S2)] The condition of (S1) holds for diagrams in $\mathcal F$ lying over 
a diagram in $\mathcal C_{\Lambda}$ of the form
\[
\xymatrix{
          & k[\varepsilon] \ar[d] \\
A  \ar[r] & k . 
}
\]  
Moreover, if
\[
\xymatrix{
A \times_{k} k[\varepsilon]  \ar[r]^{p_2} \ar[d]_{p_1}  & k[\varepsilon] \ar[d] 
\\
A  \ar[r] & k 
}
\]  
is a diagram in $\mathcal C_{\Lambda}$ and $a: y \rightarrow x$ and $a': y' 
\rightarrow x$ are morphisms in $\mathcal F$ lying over $p_{1}$ such that 
$(p_2)_{*}y \cong (p_2)_{*}y'$ in $\mathcal F(k[\varepsilon])$, then there 
exists an isomorphism $b: y \rightarrow y'$ in $\mathcal F(A \times_{k} 
k[\varepsilon])$ such that $a = a' \circ b$.
\end{enumerate}
\end{definition}

\begin{lemma}
\label{lemma-S1-small-extensions}
Let $\mathcal F$ be a category cofibered in groupoids over $\mathcal 
C_{\Lambda}$. Then $\mathcal F$ satisfies \textnormal{(S1)} if the condition of 
\textnormal{(S1)} is assumed to hold only when $A_2 \rightarrow A$ is a small 
extension.
\end{lemma}

\begin{proof}
Apply Lemma \ref{lemma-factor-small-extension}.  The proof is similar to that 
of Lemma \ref{lemma-smoothness-small-extensions}.
\end{proof}

\begin{remark}
\label{remark-compare-S1-S2-schlessinger}
When $\mathcal F$ is cofibered in sets, conditions (S1) and (S2) are exactly 
conditions (H1) and (H2) from Schlessinger's paper \cite{Sch}.
Namely, for a functor $F: \mathcal C_{\Lambda} \rightarrow 
\textnormal{(Sets)}$, conditions (S1) and (S2) state:
\begin{enumerate}
\item [(S1)] If $A_1 \rightarrow A$ and $A_2 \rightarrow A$ are maps in 
$\mathcal C_{\Lambda}$ with $A_2 \rightarrow A$ surjective, then the induced 
map $F(A_1 \times_{A} A_2) \rightarrow F(A_1) \times_{F(A)} F(A_2)$ is 
surjective.
\item [(S2)]  If $A \rightarrow k$ is a map in $\mathcal C_{\Lambda}$, then the 
induced map $F(A \times_{k} k[\varepsilon]) \rightarrow F(A) \times_{F(k)} 
F(k[\varepsilon])$ is bijective.
\end{enumerate}
\end{remark}

\begin{lemma}
\label{lemma-S2-extensions}
Let $F: \mathcal C_{\Lambda} \rightarrow \textnormal{(Sets)}$ be a functor.  If 
$F$ satisfies \textnormal{(S2)}, then the condition of \textnormal{(S2)} also 
holds when $k[\varepsilon]$ is replaced by $k[V]$ for any finite dimensional 
$k$-vector space $V$.
\end{lemma}

\begin{proof}
Follows from the fact that $k[V] \cong k[\varepsilon] \times_{k} \cdots 
\times_{k} k[\varepsilon]$, where there are $\dim_k V$ factors on the 
right-hand side.
\end{proof}

\begin{lemma}
\label{lemma-S1-S2-associated-functor}
Let $\mathcal F$ be a category cofibered in groupoids over $\mathcal 
C_{\Lambda}$. 
\begin{enumerate}
\item If $\mathcal F$ satisfies \textnormal{(S1)}, then so does 
$\overline{\mathcal F}$. 
\item If $\mathcal F$ satisfies \textnormal{(S2)}, then so does 
$\overline{\mathcal F}$.
\end{enumerate}
\end{lemma}

\begin{proof}
Follows immediately from the definitions.
\end{proof}




\section{Tangent spaces}
\label{section-tangent-spaces}

\noindent
First we discuss tangent spaces of functors. Then the tangent space of a 
predeformation category $\mathcal F \rightarrow \mathcal C_{\Lambda}$ is 
defined as the tangent space of the functor of isomorphism classes 
$\overline{\mathcal F}: \mathcal C_{\Lambda} \rightarrow \textnormal{(Sets)}$.



\subsection{Tangent spaces of functors}
\label{subsection-tangent-spaces-functors}

\noindent
Let $R$ be a ring. We write $\textnormal{Mod}_{R}$ for the category of 
$R$-modules and $\textnormal{f.g.-Mod}_{R}$ for the category of finitely 
generated $R$-modules.

\begin{definition}
\label{definition-linear}
Let $L: \textnormal{f.g.-Mod}_{R} \rightarrow \textnormal{Mod}_{R}$ be a 
functor.  We say that $L$ is {\it $R$-linear} if for every $M,N \in 
\textnormal{Ob}(\textnormal{f.g.-Mod}_{R})$ the map $\textnormal{Hom}_{R}(M,N) 
\rightarrow \textnormal{Hom}_{R}(L(M),L(N))$ is a map of $R$-modules.
\end{definition}

\begin{remark}
\label{remark-linear-enriched-over-modules}
One can define the notion of an $R$-linearity for any functor between 
categories enriched over $\textnormal{Mod}_{R}$. We made the definition 
specifically for a functor $L: \textnormal{f.g.-Mod}_{R} \rightarrow 
\textnormal{Mod}_{R}$ because this is the case that occurs below.
\end{remark}

\begin{remark}
\label{remark-linear-functor}
If $L: \textnormal{f.g.-Mod}_{R} \rightarrow \textnormal{Mod}_{R}$ is a 
$R$-linear functor, then $L$ preserves finite products and sends the zero 
module to the zero module, see
Homology, Lemma \ref{homology-lemma-additive-additive}.
On the other hand, if a functor
$\textnormal{f.g.-Mod}_{R} \rightarrow \textnormal{(Sets)}$ 
preserves finite products and sends the zero module to a one element set, then 
it has a unique lift to a $R$-linear functor (Lemma \ref{lemma-linear-functor}).
\end{remark}

\begin{lemma}
\label{lemma-linear-functor}
Let $L: \textnormal{f.g.-Mod}_{R} \rightarrow \textnormal{(Sets)}$ be a 
functor.  Suppose $L(0)$ is a one element set and $L$ preserves finite 
products.  Then there exists a unique $R$-linear functor $\widetilde{L}: 
\textnormal{f.g.-Mod}_{R} \rightarrow \textnormal{Mod}_{R}$ such that the 
diagram
\[ 
\xymatrix{
& \textnormal{Mod}_{R} \ar[dr]^{\textnormal{forget}} &   \\
\textnormal{f.g.-Mod}_{R}  \ar[ur]^{\widetilde{L}} \ar[rr]^{L} &  & 
\textnormal{(Sets)}
}
\]
commutes.
\end{lemma}

\begin{proof}
Let $M$ be a finitely generated $R$-module. We define $\widetilde{L}(M)$ to be 
the set $L(M)$ with the following $R$-module structure.

\medskip \noindent
Multiplication: If $r \in R$, multiplication by $r$ on $L(M)$ is defined to be 
the map $L(M) \rightarrow L(M)$ induced by the multiplication map $r \cdot: M 
\rightarrow M$.

\medskip \noindent
Addition: The sum map $M \times M \rightarrow M: (m_1,m_2) \mapsto m_1 + m_2$ 
induces a map $L(M \times M) \rightarrow L(M)$. By assumption $L(M \times M)$ 
is canonically isomorphic to $L(M) \times L(M)$.  Addition on $L(M)$ is defined 
by the map $L(M) \times L(M) \cong L(M \times M) \rightarrow L(M)$.

\medskip \noindent
Zero: There is a unique map $0 \rightarrow M$.  The zero element of $L(M)$ is 
the image of $L(0) \rightarrow L(M)$.

\medskip \noindent
We omit the verification that this defines an $R$-module $\widetilde{L}(M)$, 
the unique such that is $R$-linearly functorial in $M$.
\end{proof}

\begin{lemma}
\label{lemma-morphism-linear-functors}
Let $L_1,L_2: \textnormal{f.g.-Mod}_R \rightarrow \textnormal{(Sets)}$ be 
functors that take $0$ to a one element set and preserve finite products.  Let 
$t: L_1 \rightarrow L_2$ be a morphism of functors. Then $t$ induces a morphism 
$\widetilde{t}: \widetilde{L}_1 \rightarrow \widetilde{L}_2$ between the 
functors guaranteed by Lemma \ref{lemma-linear-functor}, which is given simply 
by $\widetilde{t}_M = t_M: \widetilde{L}_1(M) \rightarrow \widetilde{L}_2(M)$ 
for each $M \in \textnormal{Ob}(\textnormal{f.g.-Mod}_{R})$. In other words, 
$t_M: \widetilde{L}_1(M) \rightarrow \widetilde{L}_2(M)$ is a map of 
$R$-modules.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\noindent
In the case $R = K$ is a field, a $K$-linear functor $L: 
\textnormal{f.g.-Mod}_{K} \rightarrow \textnormal{Mod}_{K}$ is determined by 
$L(K)$:

\begin{lemma}
\label{lemma-linear-functor-over-field}
Let $K$ be a field. Let $L: \textnormal{f.g.-Mod}_{K} \rightarrow 
\textnormal{Mod}_{K}$ be a $K$-linear functor.  Then $L$ is isomorphic to the 
functor $L(K) \otimes_{K} - : \textnormal{f.g.-Mod}_{K} \rightarrow 
\textnormal{Mod}_{K}$.
\end{lemma}

\begin{proof}
For $V \in \textnormal{Ob}(\textnormal{f.g.-Mod}_{K})$, the isomorphism $L(K) 
\otimes_{K} V \rightarrow L(V)$ is given on pure tensors by $x \otimes v 
\mapsto L(f_{v})(x)$, where $f_{v}: K \rightarrow V$ is the $K$-linear map 
sending $1 \mapsto v$.  When $V = K$, this is the isomorphism $L(K) \otimes_{K} 
K \rightarrow L(K)$ given by multiplication by $K$.  For general $V$, it is an 
isomorphism by the case $V = K$ and the fact that $L$ commutes with finite 
products (Remark \ref{remark-linear-functor}).
\end{proof}

\noindent 
For a ring $R$ and an $R$-module $M$, let $R[M]$ be the $R$-algebra whose 
underlying $R$-module is $R \oplus M$ and whose multiplication is given by 
$(r,m) \cdot (r',m') = (rr', rm' + r'm)$.  When $M = R$ this is the ring of 
dual numbers over $R$, which we denote by $R[\varepsilon]$.  

\medskip \noindent
Now let $S$ be a ring and assume $R$ is an $S$-algebra.  Then the assignment $M 
\mapsto R[M]$ determines a functor $\textnormal{Mod}_{R} \rightarrow S 
\textnormal{-Alg}/R$, where $S \textnormal{-Alg}/R$ denotes the category of 
$S$-algebras over $R$.  Note that $S \textnormal{-Alg}/R$ admits finite 
products: if $A_1 \rightarrow R$ and $A_2 \rightarrow R$ are two objects, then 
$A_1 \times_{R} A_2$ is a product.

\begin{lemma}
\label{lemma-preserves-products}
Let $R$ be an $S$-algebra. Then the functor $\textnormal{Mod}_{R} \rightarrow S 
\textnormal{-Alg}/R$ described above preserves finite products.
\end{lemma}

\begin{proof}
This is merely the statement that if $M$ and $N$ are $R$-modules, then the map 
$R[M \times N] \rightarrow R[M] \times_{R} R[N]$ is an isomorphism in $S 
\textnormal{-Alg}/R$.
\end{proof}

\begin{lemma}
\label{lemma-tangent-space-functor}
Let $R$ be an $S$-algebra, and let $\mathcal C$ be a full subcategory of $S 
\textnormal{-Alg}/R$ containing $R[M]$ and the product $R[M] \times_{R} R[N]$ 
for all $M,N \in \textnormal{Ob}(\textnormal{f.g.-Mod}_{R})$.  

\smallskip \noindent
Let $F: \mathcal C \rightarrow \textnormal{(Sets)}$ be a functor.  Suppose that 
$F(R)$ is a one element set and that for any $M, N \in 
\textnormal{Ob}(\textnormal{f.g.-Mod}_{R})$, the induced map 
\[ F(R[M] \times_{R} R[N]) \rightarrow F(R[M]) \times F(R[N])\]
is a bijection.  Then $F(R[M])$ has a natural $R$-module structure for any $M 
\in \textnormal{Ob}(\textnormal{f.g.-Mod}_{R})$.
\end{lemma}

\begin{proof}
The functor $\textnormal{Mod}_{R} \rightarrow S \textnormal{-Alg}/R$ of Lemma 
\ref{lemma-preserves-products} restricts to a functor 
$\textnormal{f.g.-Mod}_{R} \rightarrow \mathcal C$ by the assumption on 
$\mathcal C$. Let $L$ be the composition $\textnormal{f.g.-Mod}_{R} \rightarrow 
\mathcal C \xrightarrow{F} \textnormal{(Sets)}$. Then $L$ preserves finite 
products by Lemma \ref{lemma-preserves-products} and the assumption on $F$.  
Hence Lemma \ref{lemma-linear-functor} shows that $L(M) = F(R[M])$ has a 
natural $R$-module structure for any $M \in 
\textnormal{Ob}(\textnormal{f.g.-Mod}_{R})$.
\end{proof}

\begin{definition}
\label{definition-tangent-space-over-R}
Let $\mathcal C$ be a category as in
Lemma \ref{lemma-tangent-space-functor}.  
Let $F: \mathcal C \rightarrow \textnormal{(Sets)}$ be a functor such that 
$F(R)$ is a one element set. The {\it tangent space $TF$ of $F$} is 
$F(R[\varepsilon])$.  When $F: \mathcal C \rightarrow \textnormal{(Sets)}$ 
satisfies the hypotheses of
Lemma \ref{lemma-tangent-space-functor},
the tangent space $TF$ has a natural $R$-module structure.
\end{definition}

\begin{example}
\label{example-tangent-space-prorepresentable-functor}
Let $F: \mathcal C_{\Lambda} \rightarrow \textnormal{(Sets)}$ be a 
prorepresentable functor, say $F \cong \underline{S}|_{\mathcal C_{\Lambda}}$ 
for $S \in \textnormal{Ob}(\widehat{\mathcal C}_{\Lambda})$.  Then $F$ commutes 
with arbitrary limits and thus satisfies the hypotheses of Lemma 
\ref{lemma-tangent-space-functor} with $R = k$.  There is an isomorphism of 
$k$-vector spaces $TF \cong T_{S/\Lambda}$, where $T_{S/\Lambda}$ is as in 
Definition \ref{definition-tangent-space-ring}.  In particular, since $S$ is 
Noetherian it follows that $\dim_{k} TF$ is finite.
\end{example}


\begin{lemma}
\label{lemma-morphism-tangent-spaces}
Let $F, G: \mathcal C \rightarrow \textnormal{(Sets)}$ be functors satisfying 
the hypotheses of Lemma \ref{lemma-tangent-space-functor}.  Let $t: F 
\rightarrow G$ be a morphism of functors.  Then for any $M \in 
\textnormal{Ob}(\textnormal{f.g.-Mod}_{R})$, the map $t_{R[M]}: F(R[M]) 
\rightarrow G(R[M])$ is a map of $R$-modules, where $F(R[M])$ and $G(R[M])$ are 
given the $R$-module structure from Lemma \ref{lemma-tangent-space-functor}.  
In particular, $t_{R[\varepsilon]} : TF \rightarrow TG$ is a map of $R$-modules.
\end{lemma}

\begin{proof}
Follows from Lemma \ref{lemma-morphism-linear-functors}.
\end{proof}

\begin{lemma}
\label{lemma-tangent-space-tensor}
Let $F: \mathcal C \rightarrow \textnormal{(Sets)}$ be a functor satisfying the 
hypotheses of Lemma \ref{lemma-tangent-space-functor}.  Assume $R = K$ is a 
field.  Then $F(K[V]) \cong TF \otimes_{K} V$ for any finite dimensional 
$K$-vector space $V$.
\end{lemma}

\begin{proof}
Follows from Lemma \ref{lemma-linear-functor-over-field}.
\end{proof}

\subsection{Tangent spaces of predeformation categories}
\label{subsection-tangent-spaces}

\begin{definition}
\label{definition-tangent-space}
Let $\mathcal F$ be a predeformation category.  The {\it tangent space $T 
\mathcal F$ of $\mathcal F$} is the set $\overline{\mathcal F}(k[\varepsilon])$ 
of isomorphism classes of objects in the fiber category $\mathcal 
F(k[\varepsilon])$.
\end{definition}

\noindent
Thus $T \mathcal F$ is nothing but the tangent space of the associated functor 
$\overline{\mathcal F}: \mathcal{C}_{\Lambda} \rightarrow \textnormal{(Sets)}$. 
It has a natural vector space structure when $\mathcal F$ satisfies (S2), or, 
in fact, as long as $\overline{\mathcal F}$ does:
\begin{lemma}
\label{lemma-tangent-space-vector-space}
Let $\mathcal F$ be a predeformation category such that $\overline{\mathcal F}$ 
satisfies \textnormal{(S2)}. Then $T \mathcal F$ has a natural $k$-vector space 
structure.
\end{lemma}

\begin{proof}
By definition $\mathcal C_{\Lambda}$ is a full subcategory of 
$\Lambda\textnormal{-Alg}/k$ containing $k[V]$ and $k[V] \times_{k} k[W]$ for 
all finite $k$-vector spaces $V,W$.  By assumption the functor 
$\overline{\mathcal F}: \mathcal C_{\Lambda} \rightarrow \textnormal{(Sets)}$ 
satisfies (S2), so by Lemma \ref{lemma-S2-extensions} it satisfies the 
hypotheses of Lemma \ref{lemma-tangent-space-functor}.  Hence $T \mathcal F = T 
\overline{\mathcal F}$ has a natural $k$-vector space structure.
\end{proof}

\noindent
A morphism of predeformation categories induces a map on tangent spaces as 
follows.

\begin{definition}
\label{definition-differential}
Let $\varphi: \mathcal F \rightarrow \mathcal G$ be a morphism predeformation 
categories. The {\it differential $d \varphi: T \mathcal F \rightarrow T 
\mathcal G$ of $\varphi$} is the map obtained by evaluating the morphism of 
functors $\overline{\varphi}: \overline{\mathcal F} \rightarrow  
\overline{\mathcal G}$ at $A = k[\varepsilon]$.
\end{definition}

\begin{lemma}
\label{lemma-k-linear-differential}
Let $\varphi: \mathcal F \rightarrow \mathcal G$ be a morphism predeformation 
categories. Assume $\overline{\mathcal F}$ and $\overline{\mathcal G}$ both 
satisfy \textnormal{(S2)}.  Then $d \varphi: T \mathcal F \rightarrow T 
\mathcal G$ is $k$-linear.
\end{lemma}

\begin{proof}
Follows from Lemma \ref{lemma-morphism-tangent-spaces}.
\end{proof}

\begin{remark}
\label{remark-tangent-space-cofibered-groupoid}
We can globalize the notions of tangent space and differential to arbitrary 
categories cofibered in groupoids as follows. Let $\mathcal F$ be a category 
cofibered in groupoids over $\mathcal C_{\Lambda}$, and let $x \in 
\textnormal{Ob}(\mathcal F(k))$.  As in Remark 
\ref{remark-localize-cofibered-groupoid}, we get a predeformation category 
$\mathcal F_x$.  We define the {\it tangent space $T_x \mathcal F$ of 
$\mathcal F$ at $x$} to be the tangent space $T \mathcal F_x$ of $\mathcal 
F_x$.  Similarly, if $\varphi: \mathcal F \rightarrow \mathcal G$ is a morphism 
of categories cofibered in groupoids over $\mathcal C_{\Lambda}$ and $x \in 
\textnormal{Ob}(\mathcal F(k))$, then there is an induced morphism $\varphi_x: 
\mathcal F_x \rightarrow \mathcal G_{\varphi(x)}$.  We define the 
{\it diferential $d_{x} \varphi: T_{x} \mathcal F \rightarrow T_{\varphi(x)} 
\mathcal G$ of $\varphi$ at $x$} to be the map $d \varphi_x: T \mathcal F_x 
\rightarrow T \mathcal G_{\varphi(x)}$.
\end{remark}



\subsection{Miniversal formal objects}
\label{subsection-miniversal-objects-existence}

\begin{definition}
\label{definition-minimal-morphism}
Let $\varphi: \mathcal F \rightarrow \mathcal G$ be a morphism of 
predeformation categories.  We say $\varphi$ is {\it minimal} if $d \varphi: 
 T \mathcal F \rightarrow T \mathcal G$ is bijective.
\end{definition}

\begin{remark}
\label{remark-predeformation-category-minimal-over-iso}
Let $\mathcal F$ be a predeformation category.  Then the morphism $\mathcal F 
\rightarrow \overline{\mathcal F}$ is minimal.
\end{remark}

\noindent
The rest of this section is devoted to proving the existence of a minimal 
smooth morphism $U \rightarrow \mathcal F$ from a prorepresentable functor $U$ 
to a predeformation category $\mathcal F$, provided that $\mathcal F$ satisfies 
(S1) and (S2) and $\dim_{k} T\mathcal F$ is finite.  This amounts to 
constructing a miniversal object for $\mathcal F$, defined as follows.

\begin{definition}
\label{definition-miniversal-object}
Let $\mathcal F$ be a predeformation category.  Let $\xi$ be a formal object of 
$\mathcal F$ lying over $R \in \textnormal{Ob}(\widehat{\mathcal 
C}_{\Lambda})$.  We say $\xi$ is {\it minimal} if the corresponding morphism 
$\underline{\xi}: \underline{R}|_{\mathcal C_{\Lambda}} \rightarrow \mathcal F$ 
of Remark \ref{remark-formal-objects-yoneda} is minimal.  We say $\xi$ is 
{\it miniversal} if it is minimal and versal.
\end{definition}

\begin{remark}
\label{remark-choice-pushforwards-iso-class}
The property of being minimal does not depend on the choices of pushforwards 
needed to define $\underline{\xi}: \underline{R}|_{\mathcal C_{\Lambda}} 
\rightarrow \mathcal F$.
\end{remark}

\noindent
Minimal objects satisfy the following uniqueness property.

\begin{lemma}
\label{lemma-miniversal-object-unique}
Let $\mathcal F$ be a predeformation category.  A miniversal formal object of 
$\mathcal F$, if it exists, is unique up to a (non-canonical) isomorphism in 
$\widehat{\mathcal F}$.
\end{lemma}

\begin{proof}
Let $\xi$ and $\xi'$ be miniversal formal objects lying over $R$ and $R'$ in 
$\widehat{\mathcal C}_{\Lambda}$.  By
Lemma \ref{lemma-versal-object-quasi-initial}
we have morphisms $a: \xi \rightarrow 
\xi'$ and $a': \xi' \rightarrow \xi$.  Let $f:R \rightarrow R'$ and $f': R' 
\rightarrow R$ be the projections of $a$ and $a'$ to $\mathcal C_{\Lambda}$.  
By minimality of $\xi$ and $\xi'$, $f$ and $f'$ induce isomorphisms of tangent 
spaces $T_{R/\Lambda} \xrightarrow{\sim} T_{R'/\Lambda}$ and $T_{R'/\Lambda} 
\xrightarrow{\sim} T_{R/\Lambda}$.  In particular, $f' \circ f: R \rightarrow 
R$ is an endomorphism of $R$ inducing a surjection on $T^*_{R/\Lambda}$. This 
implies $f' \circ f$ is a surjection by Lemma 
\ref{lemma-surjective-cotangent-space}. A surjective endomorphism of a 
Noetherian ring is an isomorphism: if $g: S \rightarrow S$ were such an 
endomorphism but not injective, then $\textnormal{Ker}(g) \subset 
\textnormal{Ker}(g \circ g) \subset \textnormal{Ker}(g \circ g \circ g) \subset 
\cdots$ would be a strictly increasing chain of ideals.  We conclude $f' \circ 
f$ is an isomorphism.  Similarly $f \circ f'$ is an isomorphism.  Thus $f$ and 
$f'$ are isomorphisms.
\end{proof}

\begin{lemma}
\label{lemma-lifting-section}
Let $p: \mathcal F \rightarrow \mathcal C_{\Lambda}$ be a category cofibered in 
groupoids.  Let 
\[
\xymatrix{
y \ar[r] \ar[d]_{a} & x_2 \ar[d] \\
x_1 \ar[r]        & x
}
\]
be a diagram in $\mathcal F$ lying over
\[
\xymatrix{
A \times_{k} k[\varepsilon] \ar[r]^{p_2} \ar[d]_{p_1} & k[\varepsilon] \ar[d] \\
A \ar[r] & k.
}
\]
Assume $\mathcal F$ satisfies \textnormal{(S2)}. Then there exists a morphism 
$s: x_1 \rightarrow y$ with $a \circ s = \textnormal{id}_{x_1}$ if and only if 
there exists a morphism $x_1 \rightarrow x_2$
\end{lemma}

\begin{proof}
The ``only if'' direction is clear.  Conversely, assume there exists a morphism 
$b: x_1 \rightarrow x_2$.  Let $s_0 = (\textnormal{id}_A, p(b)): A \rightarrow 
A \times_{k} k[\varepsilon]$.  Since $s_0$ is a section of $A \times_{k} 
k[\varepsilon] \rightarrow A$, we get morphisms $s': x_1 \rightarrow 
(s_0)_*x_1$ and $a': (s_0)_*x_1 \rightarrow x_1$ such that $a' \circ s' = 
\textnormal{id}_{x_1}$.  Since $p_2 \circ s_0 = p(b)$ and $\mathcal F$ is a 
category cofibered in groupoids, there exists a morphism $c: (s_0)_*x_1 
\rightarrow x_2$ such that $b = c \circ s'$.  In particular 
$(p_2)_*((s_0)_*x_1) \cong (p_2)_*y$ in $\mathcal F(k[\varepsilon])$, hence by 
(S2) there exists $d: (s_0)_*x_1 \rightarrow y$ such that $a' = a \circ d$.  
Then $s = d \circ s': x_1 \rightarrow y$ is the required morphism.
\end{proof}

\begin{lemma}
\label{lemma-lifting-along-small-extension}
Let $\mathcal F$ be a category cofibered in groupoids.  Let
\[
\xymatrix{
y \ar[r] \ar[d] & x_2 \ar[d]^{a_2} \\
x_1 \ar[r]^{a_1}        & x
}
\]
be a diagram in $\mathcal F$ lying over
\[
\xymatrix{
A' \times_{A} A' \ar[r] \ar[d] & A' \ar[d]^{f} \\
A' \ar[r]^{f} & A
}
\]
with $f: A' \rightarrow A$ a small extension. Let $I = \textnormal{Ker}(f)$ and 
let $g: A' \times_{A} A' \rightarrow k[I]$ be the map $(x,y) \mapsto q(x) + y - 
x$ where $q: A' \rightarrow A'/\mathfrak{m}_{A'} = k$.  Assume $\mathcal F$ 
satisfies \textnormal{(S2)}. If there exists a morphism $x_1 \rightarrow 
g_*(y)$, then there exists a morphism $b: x_1 \rightarrow x_2$ such that $a_1 = 
a_2 \circ b$.
\end{lemma}

\begin{proof}
Follows from Lemma \ref{lemma-lifting-section} and the fact that 
$\textnormal{id}_{A'} \times g: A' \times_{A} A' \xrightarrow{\sim} A' 
\times_{k} k[I]$ is an isomorphism.  
\end{proof}

\begin{lemma}
\label{lemma-versal-criterion}
Let $\mathcal F$ be a predeformation category satisfying \textnormal{(S1)} and 
\textnormal{(S2)}.  Let $\xi$ be a formal object of $\mathcal F$ lying over $R 
\in \textnormal{Ob}(\widehat{\mathcal C}_{\Lambda})$.  Then $\xi$ is versal if 
and only if the following two conditions hold:
\begin{enumerate}
\item $\underline{\xi}: \underline{R}|_{\mathcal C_{\Lambda}} \rightarrow 
\mathcal F$ is surjective on tangent spaces, i.e.\ $d\underline{\xi}: T 
\underline{R}|_{\mathcal C_{\Lambda}} \rightarrow T\mathcal F$ is surjective.
\item If 
\[
\xymatrix{
            &  y \ar[d] \\
\xi \ar[r]  &  x
}
\]
is a diagram in $\widehat{\mathcal F}$ lying over
\[
\xymatrix{
         &   B  \ar[d]^{f} \\
R \ar[r] &   A 
}
\]
in $\widehat{\mathcal C}_{\Lambda}$ with $B \rightarrow A$ a small extension of 
Artinian rings, then there exists a ring map $R \rightarrow B$ such that
\[
\xymatrix{
         &   B  \ar[d]^{f} \\
R \ar[ur] \ar[r] &   A 
}
\]
commutes.
\end{enumerate}
\end{lemma}

\begin{proof}
If $\xi$ is versal then (1) holds by Lemma 
\ref{lemma-smooth-morphism-essentially-surjective} and (2) holds by Remark 
\ref{remark-versal-object}.  Conversely if (1) and (2) hold, we must show that 
given a diagram in $\widehat{\mathcal F}$ as in (2), there exists $\xi 
\rightarrow y$ such that
\[
\xymatrix{
            &  y \ar[d] \\
\xi \ar[ur] \ar[r]  &  x
}
\]
commutes. Replacing $\xi$ by its pushforward under the map $R \rightarrow B$ 
guaranteed by (2), we may assume $\xi \rightarrow x$ lies over $f: B 
\rightarrow A$.  Then by (S2) we obtain a commutative diagram
\[
\xymatrix{
z  \ar[r] \ar[d]          &  y \ar[d] \\
\xi \ar[r]  &  x
}
\]
in $\mathcal F$ lying over
\[
\xymatrix{
B \times_{A} B \ar[d] \ar[r] &   B  \ar[d]^{f} \\
B \ar[r]^{f} &   A .
}
\]
By (1) there exists a morphism $\xi \rightarrow w$ for any $w \in \mathcal 
F(k[I])$, where $I = \textnormal{Ker}(f)$.  Hence Lemma 
\ref{lemma-lifting-along-small-extension} applies to give the required morphism 
$\xi \rightarrow y$. 
\end{proof}

\begin{lemma}
\label{lemma-miniversal-object-existence-1}
Let $\mathcal F$ be a predeformation category.  Assume $\mathcal F$ admits a 
minimal smooth morphism $U \rightarrow \mathcal F$ from a prorepresentable 
functor $U: \mathcal C_{\Lambda} \rightarrow \textnormal{(Sets)}$.  Then the 
following conditions hold:
\begin{enumerate}
\item $\mathcal F$ satisfies \textnormal{(S1)}.
\item $\mathcal F$ satisfies \textnormal{(S2)}.
\item $\dim_{k} T\mathcal F$ is finite.
\end{enumerate}
\end{lemma}

\begin{proof}
By Example \ref{example-tangent-space-prorepresentable-functor}, $\dim_{k} 
T\mathcal F = \dim_{k} TU$ is finite . To verify (1) and (2), let $\xi$ be a 
miniversal formal object corresponding to $U \rightarrow \mathcal F$. Let 
\[
\xymatrix{
           & x_2 \ar[d] \\
x_1 \ar[r] & x   
}
\]
be a diagram in $\mathcal F$ such that $x_2 \rightarrow x$ lies over a 
surjective ring map. Since the natural morphism $\widehat{\mathcal 
F}|_{\mathcal C_{\Lambda}} \xrightarrow{\sim} \mathcal F$ is an equivalence 
(see Remark \ref{remark-completion-restriction-adjoint}), we can consider this 
diagram also as a diagram in $\widehat{\mathcal F}$.  By Lemma 
\ref{lemma-versal-object-quasi-initial} there exists a morphism $\xi 
\rightarrow x_1$, so by Remark \ref{remark-versal-object} we also get a 
morphism $\xi \rightarrow x_2$ making the diagram
\[
\xymatrix{
\xi \ar[r] \ar[d]          & x_2 \ar[d] \\
x_1 \ar[r] & x   
}
\]
commute.  If $x_1 \rightarrow x$ and $x_2 \rightarrow x$ lie above ring maps 
$A_1 \rightarrow A$ and $A_2 \rightarrow A$ then taking the pushforward of 
$\xi$ to $A_1 \times_{A} A_2$ gives an object $y$ as required by (S1). The 
first part of (S2) holds since (S1) holds; for the second, let \[
\xymatrix{
A \times_{k} k[\varepsilon]  \ar[r]^{p_2} \ar[d]_{p_1}  & k[\varepsilon] \ar[d] 
\\
A  \ar[r] & k 
}
\]  
be a diagram in $\mathcal C_{\Lambda}$, and let $a: y \rightarrow x$ and $a': 
y' \rightarrow x$ be morphisms in $\mathcal F$ lying over $p_{1}$ such that 
$(p_2)_{*}y \cong (p_2)_{*}y'$ in $\mathcal F(k[\varepsilon])$.  As above we 
obtain morphisms $b: \xi \rightarrow y$ and $b': \xi \rightarrow y'$ such that
\[
\xymatrix{
\xi \ar[r]^{b'} \ar[d]_{b}          & y' \ar[d]^{a'} \\
y \ar[r]^{a} & x   
}
\]
commutes.  Letting $p: \mathcal F \rightarrow \mathcal C_{\Lambda}$ denote the 
structure morphism, we have in particular $p_1 \circ \widehat{p}(a) = p_2 \circ 
\widehat{p}(a')$.  Since $(p_2)_{*}y \cong (p_2)_{*}y'$ we also have $p_2 \circ 
\widehat{p}(b) = p_2 \circ \widehat{p}(b')$ by minimality of $\xi$.  Thus 
$\widehat{p}(b) = \widehat{p}(b')$, so there exists a unique morphism $c: y 
\rightarrow y'$ in $\mathcal F(A \times_{k} k[\varepsilon])$ such that $b' = c 
\circ b$.  Thus $a \circ b = a' \circ b' = (a' \circ c) \circ b$.  Since $p(a) 
= p(a' \circ c)$ and $\mathcal F$ is a category cofibered in groupoids, this 
implies $a = a' \circ c$.  Thus (S2) holds.
\end{proof}

\begin{lemma}
\label{lemma-miniversal-object-existence-2}
Let $\mathcal F$ be a predeformation category.  Assume the following conditions 
hold:
\begin{enumerate}
\item $\mathcal F$ satisfies \textnormal{(S1)}.
\item $\mathcal F$ satisfies \textnormal{(S2)}.
\item $\dim_{k} T\mathcal F$ is finite.
\end{enumerate}
Then $\mathcal F$ admits a minimal smooth morphism $U \rightarrow \mathcal F$ 
from a prorepresentable functor $U: \mathcal C_{\Lambda} \rightarrow 
\textnormal{(Sets)}$.
\end{lemma}

\begin{proof}
Assume conditions (1)-(3) hold.  Let $r = \dim_{k} T\mathcal F$ and put $S = 
\Lambda[[X_1, \dots, X_r]]$.  Let $J_{1} = \mathfrak{m}{S}$.  We are going to 
inductively construct for $n \geq 2$ pairs $(J_{n}, f_{n-1}: \xi_{n} 
\rightarrow \xi_{n-1})$ where $J_{n} \subset S$ is an decreasing sequence of 
ideals and $f_{n-1}: \xi_{n} \rightarrow \xi_{n-1}$ is a morphism of $\mathcal 
F$ lying over the projection $S/J_{n} \rightarrow S/J_{n-1}$.  We set $R_{n} = 
S/J_{n}$ at each step of the construction.  

\medskip \noindent
Let $J_{2} = \mathfrak{m}_{S}^2 + \mathfrak{m}_{\Lambda}S$.  Then $R_2 \cong 
k[\varepsilon] \times_{k} \cdots \times_{k} k[\varepsilon]$, where there are 
$r$ copies of $k[\varepsilon]$.  By (S2) for $\overline{\mathcal F}$ we get a 
bijection $\overline{\mathcal F}(R_2) \xrightarrow{\sim} T \mathcal F \oplus 
\cdots \oplus T \mathcal F$, where there are $r$ copies of $T\mathcal F$.  Thus 
if we choose a basis $x_1, \dots, x_r$ for $T\mathcal F$, we can choose 
$\xi_{2} \in \textnormal{Ob}(\mathcal F(R_2))$ such that the pushforward of 
$\xi_{2}$ along the $i$-th projection of $R_2 \cong k[\varepsilon] \times_{k} 
\cdots \times_{k} k[\varepsilon]$ is isomorphic to $x_i$.  This means the 
induced map $T_{R_{2}/\Lambda} \rightarrow T\mathcal F$ is an isomorphism.

\medskip \noindent
Assume $(J_{n}, f_{n-1}: \xi_{n} \rightarrow \xi_{n-1})$ has been constructed. 
We claim there is a minimal element (with respect to inclusion) of the set 
$\mathcal J_n$ of ideals $J \subset S$ satisfying: (a) $\mathfrak{m}_{S} J_{n} 
\subset J \subset J_{n}$ and (b) there exists a morphism $\eta \rightarrow 
\xi_{n}$ lying over $S/J \rightarrow S/J_n$.  The set $\mathcal J_n$ is 
nonempty as it contains $J_{n}$.  To prove the claim we must show that 
$\mathcal J_n$ is closed under intersections, i.e.\ that conditions (a) and (b) 
are preserved under intersections. This is clear for (a), and since an element 
$J$ of $\mathcal J_n$ corresponds to a subspace of the finite-dimensional 
$k$-vector space $J_n/\mathfrak{m}_{S}J_n$, it suffices to show (b) is 
preserved under pairwise intersection.  So let $J$ and $K$ be elements of 
$\mathcal J_n$.  We can assume $J+K = J_{n}$ by, if necessary, enlarging $J$ 
without changing $J \cap K$ (to see this is possible, work with $J$ and $K$ as 
$k$-vector spaces).  Then the natural map $S \rightarrow S/J \times_{S/J_n} 
S/K$ with kernel $J \cap K$ will be surjective.  Hence $S/(J \cap K) \cong S/J 
\times_{S/J_n} S/K$ and by (S1) it follows that $J \cap K$ is in $\mathcal 
J_n$.  Now we define $J_{n+1}$ to be the minimal element of $\mathcal J_n$ and 
let $f_{n}: \xi_{n+1} \rightarrow \xi_{n}$ be any morphism lying over 
$S/J_{n+1} \rightarrow S/J_{n}$.

\medskip \noindent
Let $J = \bigcap J_{n}$ and let $R$ be the complete Noetherian local 
$\Lambda$-algebra $S/J$.  Let $I_n$ be the image of $J_n$ in $R$. Then 
$(\xi_{n}, f_{n}: \xi_{n+1} \rightarrow \xi_{n})$ is an object of 
$\widehat{\mathcal F}_{\mathcal I}(R)$, where $\mathcal I$ is the filtration 
$(I_{n})$ (see Lemma \ref{lemma-formal-objects-different-filtration} and the 
remarks preceding it).  We prove that the $(I_n)$ induces the 
$\mathfrak{m}_R$-adic topology on $R$, so that by Lemma $(\xi_{n}, f_{n}: 
\xi_{n+1} \rightarrow \xi_{n})$ induces an object of $\widehat{\mathcal F}(R)$. 
 By construction we have $\mathfrak{m}_{S}^n \subset J_n$ for all $n$, hence we 
have exact sequences
\[ 0 \rightarrow J_n/\mathfrak{m}_{S}^n \rightarrow S/\mathfrak{m}^n_{S} 
\rightarrow S/J_{n} \rightarrow 0 \]
which form an exact sequence of directed inverse systems.  The system 
$(J_n/\mathfrak{m}_{S}^n)$ is Mittag-Leffler since each 
$J_n/\mathfrak{m}_{S}^n$ is Artinian, hence by
Algebra, Lemma \ref{algebra-lemma-ML-exact-sequence}
taking limits gives an exact sequence
\[ 0 \rightarrow J \rightarrow S \rightarrow \lim S/J_n \rightarrow 0 .\]
This shows $R \cong \lim S/J_n \cong \lim R/I_n$, so the filtration $(I_n)$ of 
$R$ induces the $\mathfrak{m}_{R}$-adic topology.

\medskip \noindent
Let $\eta = (R, \eta_{n}, g_n: \eta_{n+1} \rightarrow \eta_{n})$ be the formal 
object of $\mathcal F$ induced by $(\xi_{n}, f_{n}: \xi_{n+1} \rightarrow 
\xi_{n})$. We prove $\eta$ is miniversal. It follows from the choice of 
$\xi_{2}$ that $\eta$ is minimal.  For versality it thus suffices to check 
condition (2) of Lemma \ref{lemma-versal-criterion}.  So let
\[
\xymatrix{
            &  y \ar[d] \\
\eta \ar[r]  &  x
}
\]
be a diagram in $\widehat{\mathcal F}$ lying over
\[
\xymatrix{
         &   B  \ar[d]^{f} \\
R \ar[r] &   A 
}
\]
in $\widehat{\mathcal C}_{\Lambda}$ with $f: B \rightarrow A$ a small extension 
of Artinian rings. Then for some $n$, $R \rightarrow A$ factors through $R 
\rightarrow R_{n}$ and the pushforward of $\eta$ along $R \rightarrow R_n$ is 
$\xi_{n}$, so that we get a diagram
\[
\xymatrix{
            &  y \ar[d] \\
\xi_{n} \ar[r]  &  x
}
\]
in $\mathcal F$ lying over
\[
\xymatrix{
         &   B  \ar[d]^{f} \\
R_n \ar[r] &   A .
}
\]
To check condition (2) of Lemma \ref{lemma-versal-criterion} it suffices to 
complete the diagram
\[
\xymatrix{
R_{n+1} \ar[d] \ar@{-->}[r] & B \ar[d]^{f} \\
R_{n}   \ar[r] & A 
}
\]
or equivalently, to complete the diagram
\[
\xymatrix{
  &  R_{n} \times_{A} B \ar[d]^{p_1} \\
R_{n+1} \ar@{-->}[ur] \ar[r] &  R_{n} .
}
\]
If $p_1$ has a section we are done.  If not, note that by Lemma 
\ref{lemma-fiber-product-CLambda} (2) $p_1$ is a small extension, so by Lemma 
\ref{lemma-essential-surjection} (2) $p_1$ is an essential surjection. By the 
universal property of $S = \Lambda[[X_1, \dots, X_2]]$ choose a map $S 
\rightarrow B$ such that $S \rightarrow B \rightarrow A$ equals $S \rightarrow 
R_{n} \rightarrow A$.  This induces a map $g: S \rightarrow R_{n} \times_{A} B$ 
making the solid square in the diagram
\[
\xymatrix{
S \ar[d] \ar[r]^{g}  &  R_{n} \times_{A} B \ar[d]^{p_1} \\
R_{n+1} \ar@{-->}[ur] \ar[r] &  R_{n}
}
\]
commute. Then $g$ is a surjection since $p_1$ is an essential surjection. The 
ideal $K = \textnormal{Ker}(g)$ of $S$ satisfies conditions (a) and (b) 
defining the set of ideals $\mathcal J_n$ from above: $\mathfrak{m}_SJ_n 
\subset K \subset J_n$ by construction, so (a) holds; by \textnormal{(S1)} 
applied to
\[
\xymatrix{
            &  y \ar[d] \\
\xi_{n} \ar[r]  &  x,
}
\]
there exists a lifting of $\xi_n$ to $S/K \cong R_{n} \times_{A} B$, so (b) 
holds.  Since $J_{n+1}$ was chosen to be the minimal element of $\mathcal J_n$, 
this implies $J_{n+1} \subset K$.  Thus the desired map $R_{n+1} \rightarrow 
S/K \cong R_{n} \times_{A} B$ exists.
\end{proof}


\begin{theorem}
\label{theorem-miniversal-object-existence}
Let $\mathcal F$ be a predeformation category.  Then $\mathcal F$ admits a 
minimal smooth morphism $U \rightarrow \mathcal F$ from a prorepresentable 
functor $U: \mathcal C_{\Lambda} \rightarrow \textnormal{(Sets)}$ if and only 
if the following conditions hold:
\begin{enumerate}
\item $\mathcal F$ satisfies \textnormal{(S1)}.
\item $\mathcal F$ satisfies \textnormal{(S2)}.
\item $\dim_{k} T\mathcal F$ is finite.
\end{enumerate}
\end{theorem}

\begin{proof}
Follows from Lemmas \ref{lemma-miniversal-object-existence-1} and 
\ref{lemma-miniversal-object-existence-2}.
\end{proof}

\begin{remark}
\label{remark-compare-schlessinger-H3}
When $\mathcal F$ is a predeformation functor, the condition that $\dim_{k} 
T\mathcal F$ is finite is precisely condition (H3) from Schlessinger's paper. 
In this case, Theorem \ref{theorem-miniversal-object-existence} recovers 
Schlessinger's theorem on the existence of ``hulls.''
\end{remark}

\begin{remark}
\label{remark-compose-minimal-into-iso-classes}
Let $\mathcal F$ be a predeformation category satisfying the conditions of 
Theorem \ref{theorem-miniversal-object-existence}. Then $\overline{\mathcal F}$ 
satisfies the same conditions, so $\mathcal \overline{\mathcal F}$ admits a 
minimal smooth morphism from a prorepresentable functor.  In fact, if $U 
\rightarrow \mathcal F$ is the morphism guaranteed by Theorem 
\ref{theorem-miniversal-object-existence}, then the composition $U \rightarrow 
\mathcal F \rightarrow \overline{\mathcal F}$ is a minimal smooth morphism.  
This follows from the fact that $\mathcal F \rightarrow \overline{\mathcal F}$ 
is a minimal smooth morphism.
\end{remark}


\section{Deformation Categories and Presentations}
\label{section-deformation-groupoids-presentations}

\noindent
In this section we introduce conditions on a predeformation category which 
guarantee the existence of a presentation by a minimal smooth prorepresentable 
groupoid in functors on $\mathcal C_{\Lambda}$ (as defined in
Subsection \ref{subsection-presentations}).

\subsection{The Rim-Schlessinger condition and deformation categories}
\label{subsection-RS-condition}

\begin{definition}
\label{definition-RS}
Let $\mathcal F$ be a category cofibered in groupoids over $\mathcal 
C_{\Lambda}$.  We say that $\mathcal F$ satisfies {\it condition (RS)}
if for every diagram
\[
\xymatrix{
           & x_2 \ar[d] \\
x_1 \ar[r] & x   
}
\]
in $\mathcal F$ lying over
\[
\xymatrix{
           & A_2 \ar[d] \\
A_1 \ar[r] & A   
}
\]  
in $\mathcal C_{\Lambda}$ with $A_2 \rightarrow A$ surjective, there exits a 
fiber product $x_1 \times_{x} x_2$ in $\mathcal F$ such that the diagram
\[
\xymatrix{
x_1 \times_{x} x_2 \ar[r] \ar[d] & x_2 \ar[d] \\
x_1 \ar[r]      & x   
}
\]
lies over
\[
\xymatrix{
A_1 \times_{A} A_2 \ar[r] \ar[d] & A_2 \ar[d] \\
A_1 \ar[r]      & A.   
}
\]
\end{definition}

\begin{lemma}
\label{lemma-RS-fiber-square}
Let $\mathcal F$ be a category cofibered in groupoids over $\mathcal 
C_{\Lambda}$ satisfying \textnormal{(RS)}.  If
\[
\xymatrix{
y \ar[r] \ar[d] & x_2 \ar[d]   \\
x_1 \ar[r]      & x  
}
\]
is a commutative diagram in $\mathcal F$ lying over
\[
\xymatrix{
A_1 \times_{A} A_2 \ar[r] \ar[d] & A_2 \ar[d] \\
A_1 \ar[r]      & A.   
}
\]
with $A_2 \rightarrow A$ surjective, then it is a fiber square.
\end{lemma}

\begin{proof}
Since $\mathcal F$ satisfies (RS), there exists a fiber product diagram
\[
\xymatrix{
x_1 \times_{x} x_2 \ar[r] \ar[d] & x_2 \ar[d] \\
x_1 \ar[r]      & x   
}
\]
lying over 
\[
\xymatrix{
A_1 \times_{A} A_2 \ar[r] \ar[d] & A_2 \ar[d] \\
A_1 \ar[r]      & A.   
}
\]
The induced map $y \rightarrow x_1 \times_{x} x_2$ lies over $\textnormal{id}: 
A_1 \times_{A} A_1 \rightarrow A_1 \times_{A} A_1$, hence it is an isomorphism.
\end{proof}

\begin{lemma}
\label{lemma-RS-small-extension}
Let $\mathcal F$ be a category cofibered in groupoids over $\mathcal 
C_{\Lambda}$. Then $\mathcal F$ satisfies \textnormal{(RS)} if the condition in 
Definition \ref{definition-RS} is assumed to hold only when $A_2 \rightarrow A$ 
is a small extension. 
\end{lemma}

\begin{proof}
Apply Lemma \ref{lemma-factor-small-extension}.  The proof is similar to that 
of Lemma \ref{lemma-smoothness-small-extensions}.
\end{proof}

\begin{remark}
\label{remark-RS-2-categorical}
Let $\mathcal F$ be a category cofibered in groupoids over $\mathcal 
C_{\Lambda}$.  Let
\[
\xymatrix{
A_1 \times_{A} A_2 \ar[r] \ar[d] & A_2 \ar[d] \\
A_1 \ar[r]     & A.   
}
\]
be a diagram in $\mathcal C_{\Lambda}$.  Choices of pushforwards along the maps 
in the diagram determine a $2$-commutative diagram of functors
\[
\xymatrix{
\mathcal F(A_1 \times_{A} A_2) \ar[r] \ar[d] & \mathcal F(A_2) \ar[d] \\
\mathcal F(A_1)                \ar[r]        & \mathcal F(A) .
}
\]
Hence there is an induced functor $\mathcal F(A_1 \times_{A} A_2) \rightarrow 
\mathcal F(A_1) \times_{\mathcal F(A)} \mathcal F(A_2)$.  Unwinding the 
definitions and using Lemma \ref{lemma-RS-fiber-square} shows that $\mathcal F$ 
satisfies (RS) if and only if this induced functor is an equivalence of 
categories whenever $A_2 \rightarrow A$ is surjective (or equivalently, by 
Lemma \ref{lemma-RS-small-extension}, whenever $A_2 \rightarrow A$ is a small 
extension).
\end{remark}

\begin{remark}
\label{remark-compare-schlessinger-H4}
When $\mathcal F$ is cofibered in sets, condition (RS) is exactly condition 
(H4) from Schlessinger's paper \cite[Theorem 2.11]{Sch}.  Namely, for 
a functor $F: \mathcal C_{\Lambda} \rightarrow \textnormal{(Sets)}$, condition 
(RS) states: If $A_1 \rightarrow A$ and $A_2 \rightarrow A$ are maps in 
$\mathcal C_{\Lambda}$ with $A_2 \rightarrow A$ surjective, then the induced 
map $F(A_1 \times_{A} A_2) \rightarrow F(A_1) \times_{F(A)} F(A_2)$ is 
bijective.
\end{remark}

\begin{lemma}
\label{lemma-RS-implies-S1-S2}
The condition \textnormal{(RS)} implies both \textnormal{(S1)} and 
\textnormal{(S2)}.
\end{lemma}

\begin{proof}
Clearly (RS) implies (S1).  The fact that (RS) implies (S2) follows from Lemma 
\ref{lemma-RS-fiber-square}.
\end{proof}

\noindent
In Lemma \ref{lemma-S1-S2-associated-functor} we saw that the conditions (S1) 
and (S2) on a category cofibered in groupoids always pass to the associated 
functor of isomorphism classes. This is not true for the condition (RS), but 
the following lemma gives a necessary and sufficient condition for it to 
happen.  To state this condition, we note that if $\mathcal F$ is a category 
cofibered in groupoids over $\mathcal C_{\Lambda}$ and $x' \rightarrow x$ is a 
morphism in $\mathcal F$ lying over $A' \rightarrow A$, then there is an 
induced homomorphism
\[ \textnormal{Aut}_{A'}(x') \rightarrow \textnormal{Aut}_{A}(x). \]
Here $\textnormal{Aut}_{A}(x)$ denotes the group of automorphisms of $x$ in the 
fiber category $\mathcal F(A)$.

\begin{lemma}
\label{lemma-RS-associated-functor}
Let $\mathcal F$ be a category cofibered in groupoids over $\mathcal 
C_{\Lambda}$ satisfying \textnormal{(RS)}.  The following conditions are 
equivalent: 
\begin{enumerate}
\item $\overline{\mathcal F}$ satisfies \textnormal{(RS)}.
\item Let $f_1: A_1 \rightarrow A$ and $f_2: A_2 \rightarrow A$ be ring maps in 
$\mathcal C_{\Lambda}$ with $f_2$ surjective. Assume choices of pushforwards 
along $f_1$ and $f_2$ have been made.  Then the induced morphism
\[
\overline{\mathcal F(A_1) \times_{\mathcal F(A)} \mathcal F(A_2)}
\rightarrow \overline{\mathcal F}(A_1) \times_{\overline{\mathcal F}(A)} 
\overline{\mathcal F}(A_2)
\]
is injective.  Here $ \overline{\mathcal F(A_1) \times_{\mathcal F(A)} \mathcal 
F(A_2)}$ denotes the set of isomorphism classes.
\item For every morphism $x' \rightarrow x$ in $\mathcal F$ lying over a 
surjective ring map $A' \rightarrow A$, the map $\textnormal{Aut}_{A'}(x') 
\rightarrow \textnormal{Aut}_{A}(x)$ is surjective.
\item For every morphism $x' \rightarrow x$ in $\mathcal F$ lying over a small 
extension $A' \rightarrow A$, the map $\textnormal{Aut}_{A'}(x') \rightarrow 
\textnormal{Aut}_{A}(x)$ is surjective.
\end{enumerate}
\end{lemma}

\begin{proof}
We prove that (1) is equivalent to (2) and (2) is equivalent to (3).  The 
equivalence of (3) and (4) follows from Lemma 
\ref{lemma-factor-small-extension}.  

\medskip \noindent
Let $f_1: A_1 \rightarrow A$ and $f_2: A_2 \rightarrow A$ be ring maps in 
$\mathcal C_{\Lambda}$ with $f_2$ surjective.  As noted in Remark 
\ref{remark-RS-2-categorical}, $\overline{\mathcal F}$ satisfies (RS) if and 
only if the map
\[ 
\overline{\mathcal F}(A_1 \times_{A} A_2) \rightarrow \overline{\mathcal 
F}(A_1) \times_{\overline{\mathcal F}(A)} \overline{\mathcal F}(A_2)
\]
is bijective for any such $f_1,f_2$. This map is at least surjective since that 
is the condition of (S1) and $\overline{\mathcal F}$ satisfies (S1) by Lemma 
\ref{lemma-S1-S2-associated-functor}.  Moreover, this map factors as
\[ 
\overline{\mathcal F}(A_1 \times_{A} A_2) 
\xrightarrow{\sim} \overline{\mathcal F(A_1) \times_{\mathcal F(A)} \mathcal 
F(A_2)}
\rightarrow \overline{\mathcal F}(A_1) \times_{\overline{\mathcal F}(A)} 
\overline{\mathcal F}(A_2),
\]
where the first map is a bijection since 
\[
\mathcal F(A_1 \times_{A} A_2) \rightarrow \mathcal F(A_1) \times_{\mathcal 
F(A)} \mathcal F(A_2)
\]
is an equivalence by (RS) for $\mathcal F$.  Hence (1) is equivalent to (2).

\medskip \noindent
Assume (2) holds.  Let $x' \rightarrow x$  be a morphism in $\mathcal F$ lying 
over a surjective ring map $f: A' \rightarrow A$.  Let $a \in 
\textnormal{Aut}_{A}(x)$.  Choose pushforwards for objects of $\mathcal F(A')$ 
along $f$ such that $x' \rightarrow f_* x$ equals $x' \rightarrow x$. Then the 
objects
\[ (x',x', a: x \rightarrow x), (x',x', \textnormal{id}: x \rightarrow x) \]
of $\mathcal F(A') \times_{\mathcal F(A)} \mathcal F(A')$ have the same image 
in $\overline{\mathcal F}(A') \times_{\overline{\mathcal F}(A)} 
\overline{\mathcal F}(A')$.  By (2) there exists maps $b_1,b_2: x' \rightarrow 
x'$ such that
\[ 
\xymatrix{
x \ar[r]^{a} \ar[d]_{f_*b_1} & x \ar[d]^{f_*b_2} \\
x \ar[r]^{\textnormal{id}} & x
}
\]
commutes.  Then $b_2^{-1} \circ b_1 \in \textnormal{Aut}_{A'}(x')$ has image $a 
\in \textnormal{Aut}_{A}(x)$.  Hence (3) holds.

\medskip \noindent
Assume (3) holds. Suppose
\[ (x_1,x_2, a: (f_1)_*x_1 \rightarrow (f_2)_*x_2), (x'_1,x'_2, a': (f_1)_*x'_1 
\rightarrow (f_2)_*x'_2) \]
are objects of $\mathcal F(A_1) \times_{\mathcal F(A)} \mathcal F(A_2)$ with 
the same image in $\overline{\mathcal F}(A_1) \times_{\overline{\mathcal F}(A)} 
\overline{\mathcal F}(A_2)$. Then there are morphisms $b_1: x_1 \rightarrow 
x'_1$ in $\mathcal F(A_1)$ and $b_2: x_2 \rightarrow x'_2$ in $\mathcal 
F(A_2)$. By (3) we can modify $b_2$ by an automorphism of $x_2$ over $A_2$ so 
that the diagram
\[
\xymatrix{
(f_1)_*x_1 \ar[r]^{a} \ar[d]_{(f_1)_*b_1} & (f_2)_*x_2 \ar[d]^{(f_2)_*b_2} \\
(f_1)_*x'_1 \ar[r]^{a'} & (f_2)_*x'_2.
}
\]
commutes. This proves $(x_1,x_2, a) \cong (x'_1,x'_2,a')$ in 
$\overline{\mathcal F(A_1) \times_{\mathcal F(A)} \mathcal F(A_2)}$.  Hence (2) 
holds.
\end{proof}

\noindent
Finally we define the notion of a deformation category.

\begin{definition}
\label{definition-deformation-category}
A {\it deformation category} is a predeformation category $\mathcal F$ 
satisfying (RS).  A morphism of deformation categories is a morphism of 
predeformation categories.
\end{definition}

\begin{remark}
\label{remark-deformation-functor}
We say that a functor $F: \mathcal C_{\Lambda} \rightarrow \textnormal{(Sets)}$ 
is a {\it deformation functor} if the associated cofibered set is a 
deformation category, i.e.\ if $F(k)$ is a one element set and $F$ satisfies 
(RS).  If $\mathcal F$ is a deformation category, then $\overline{\mathcal F}$ 
is a predeformation functor but not necessarily a deformation functor, as
Lemma \ref{lemma-RS-associated-functor} shows.
\end{remark}

\begin{example}
\label{example-prorepresentable-deformation-functor}
A prorepresentable functor is a deformation functor: for any $R \in 
\textnormal{Ob}(\widehat{\mathcal C}_{\Lambda})$ there is a unique morphism $R 
\rightarrow k$, so $F(k)$ is a one element set; and $F$ commutes with arbitrary 
limits, so in particular satisfies (RS).
\end{example}

\noindent
The following is one of our typical remarks on passing from a category 
cofibered in groupoids to the predeformation category at a point over $k$: it 
says that this process preserves (RS).

\begin{lemma}
\label{lemma-localize-RS}
Let $\mathcal F$ be a category cofibered in groupoids over $\mathcal 
C_{\Lambda}$ satisfying \textnormal{(RS)}. Let $x \in \textnormal{Ob}(\mathcal 
F(k))$.  Then $\mathcal F_{x}$ is a deformation category.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\subsection{Lifts of objects}
\label{subsection-lifts}

\begin{definition}
\label{definition-lifts}
Let $\mathcal F$ be a category cofibered in groupoids over $\mathcal 
C_{\Lambda}$.  Let $f: A' \rightarrow A$ be a map in $\mathcal C_{\Lambda}$.  
Let $x \in \mathcal F(A)$.  The {\it category $\mathcal{L}\textit{ift}(x,f)$ 
of lifts of $x$ along $f$} is the category with the following objects and 
morphisms. 
\begin{enumerate}
\item Objects: A {\it lift of $x$ along $f$} is a morphism $x' \rightarrow x$ 
lying over $f$.  
\item Morphisms: A {\it morphism} from a lift $a_1: x'_{1} \rightarrow x$ to a 
lift $a_2: x'_{2} \rightarrow x$ is a morphism $b: x'_1 \rightarrow x'_2$ in 
$\mathcal F(A')$ such that $a_2 = a_1 \circ b$.
\end{enumerate}
The {\it set $\textnormal{Lift}(x,f)$ of lifts of $x$ along $f$} is the set of 
isomorphism classes of $\mathcal{L}\textit{ift}(x,f)$.
\end{definition}

\begin{remark}
\label{remark-omit-arrow}
When the map $f: A' \rightarrow A$ is clear from the context, we may write 
$\mathcal{L}\textit{ift}(x,A')$ and $\textnormal{Lift}(x,A')$ in place of 
$\mathcal{L}\textit{ift}(x,f)$ and $\textnormal{Lift}(x,f)$. 
\end{remark}

\begin{remark}
\label{remark-tangent-space-lifting}
Let $\mathcal F$ be a deformation category (or even just a predeformation 
category such that $\overline{\mathcal F}$ satisfies (S2), so that $\mathcal F$ 
has vector space structure on its tangent space).  Let $x_0 \in 
\textnormal{Ob}(\mathcal F(k))$.  Then $\textnormal{Lift}(x_0, k[I]) = 
\overline{\mathcal F}(k[I])$. Hence by Lemma \ref{lemma-tangent-space-tensor}, 
$\textnormal{Lift}(x_0, k[I])$ is bijective to the vector space $T\mathcal F 
\otimes_{k} I$.
\end{remark}

\begin{remark}
\label{remark-lift-bijections}
Let $\mathcal F$ be a category cofibered in groupoids over $\mathcal 
C_{\Lambda}$ satisfying (RS).  Let
\[
\xymatrix{ 
A_1 \times_{A} A_2 \ar[r] \ar[d] & A_2 \ar[d] \\
A_1 \ar[r] & A
}
\]
be a commutative diagram in $\mathcal C_{\Lambda}$ such that $A_1 \rightarrow 
A$ is surjective.  Let $x \in \textnormal{Ob}(\mathcal F(A))$. Given lifts $x_1 
\rightarrow x$ and $x_2 \rightarrow x$ of $x$ to $A_1$ and $A_2$, we get by 
(RS) a lift $x_1 \times_{x} x_2 \rightarrow x$ of $x$ to $A_1 \times_{A} A_2$. 
It is easy to see that this defines a bijection
\[ \textnormal{Lift}(x,A_1) \times \textnormal{Lift}(x,A_2) \xrightarrow{\sim} 
\textnormal{Lift}(x, A_1 \times_{A} A_2) .\]
Similarly, if $x_1 \rightarrow x$ is a fixed lifting of $x$ to $A_1$, then 
there is a bijection
\[ \textnormal{Lift}(x_1, A_1 \times_{A} A_2) \xrightarrow{\sim} 
\textnormal{Lift}(x, A_2) .\]

\medskip \noindent 
For use in Lemma \ref{lemma-free-transitive-action}, we also record the 
following bijection of liftings.  Let
\[
\xymatrix{
A_1' \times_{A} A_2 \ar[r] \ar[d] & A_1 \times_{A} A_2 \ar[r] \ar[d] & A_2 
\ar[d] \\
A_1' \ar[r] & A_1 \ar[r] & A
}
\]
be a commutative diagram in $\mathcal C_{\Lambda}$ with $A'_1 \rightarrow A_1$ 
and $A_1 \rightarrow A$ surjective.  Let $x_1 \rightarrow x$ be a morphism 
lying over $A_1 \rightarrow A$.  Then by the above we have bijections
\begin{eqnarray*}
\textnormal{Lift}(x_1,A_1' \times_{A} A_2) & \xrightarrow{\sim} & 
\textnormal{Lift}(x_1,A_1') \times \textnormal{Lift}(x_1, A_1 \times_{A} A_2) 
\\ 
& \xrightarrow{\sim} & \textnormal{Lift}(x_1,A_1') \times \textnormal{Lift}(x, 
A_2).
\end{eqnarray*}
\end{remark}

\begin{lemma}
\label{lemma-free-transitive-action}
Let $\mathcal F$ be a deformation category.  Let $A' \rightarrow A$ be a 
surjective ring map in $\mathcal C_{\Lambda}$ whose kernel $I$ is annihilated 
by $\mathfrak{m}_{A'}$.  Let $x \in \textnormal{Ob}(\mathcal F(A))$.  If 
$\textnormal{Lift}(x,A')$ is nonempty, then it has a free and transitive action 
by $T\mathcal F \otimes_{k} I$. 
\end{lemma}

\begin{proof}
There is an isomorphism
\[ A' \times_{A} A' \xrightarrow{\sim} A' \times_{k} k[I] \]
given by $(a_1,a_2) \mapsto (a_1, q(a_1) + a_2 - a_1)$ where $q: A' \rightarrow 
A'/\mathfrak{m}_{A'} = k$.  This isomorphism commutes with the projections to 
$A'$ on the first factor, and hence with the projections of to $A' \times_{A} 
A'$ and $A' \times_{k} k[I]$ to $A$. Thus there is a bijection
\[ 
\textnormal{Lift}(x, A' \times_{A} A') \xrightarrow{\sim} \textnormal{Lift}(x, 
A' \times_{k} k[I])  \hspace{4 mm} (1).\]
By Remark \ref{remark-lift-bijections} there is a bijection
\[ 
\textnormal{Lift}(x,A') \times \textnormal{Lift}(x,A') \xrightarrow{\sim} 
\textnormal{Lift}(x, A' \times_{A} A') \hspace{4 mm} (2).\]
There is a commutative diagram
\[
\xymatrix{
A' \times_{k} k[I] \ar[r] \ar[d] & A \times_{k} k[I] \ar[r] \ar[d] & k[I] 
\ar[d] \\
A' \ar[r] & A \ar[r] & k.
}
\]
Thus if we choose a pushforward $x \rightarrow x_0$ of $x$ along $A \rightarrow 
k$, we obtain by the end of Remark \ref{remark-lift-bijections} a bijection
\[
\textnormal{Lift}(x, A' \times_{k} k[I]) \xrightarrow{\sim} 
\textnormal{Lift}(x,A') \times \textnormal{Lift}(x_0,k[I]) \hspace{4 mm} (3).
\]
Taking bijection (2) followed by (1) followed by (3) and then using Remark 
\ref{remark-tangent-space-lifting}, we get a bijection
\[ \Phi: \textnormal{Lift}(x,A') \times \textnormal{Lift}(x,A') 
\xrightarrow{\sim} \textnormal{Lift}(x,A') \times (T\mathcal F \otimes_{k} I). 
\]
This bijection commutes with the projections on the first factors. If 
$\text{pr}_2$ is the second projection of $\textnormal{Lift}(x,A') \times 
\textnormal{Lift}(x,A')$, then we get a map
\[ \text{pr}_2 \circ \Phi^{-1}: \textnormal{Lift}(x,A') \times (T\mathcal F 
\otimes_{k} I) \rightarrow \textnormal{Lift}(x,A').\]
We omit the verification that this defines an action of $T\mathcal F 
\otimes_{k} I$ on $\textnormal{Lift}(x,A')$.  It is free and transitive because 
$\Phi$ is bijective.
\end{proof} 

\begin{remark}
\label{remark-free-transitive-action-functorial}
The action of Lemma \ref{lemma-free-transitive-action} is functorial with 
respect to morphisms of deformation categories in the following sense.  Let 
$\varphi: \mathcal F \rightarrow \mathcal G$ be a morphism of deformation 
categories.  Let $A' \rightarrow A$ be a surjective ring map whose kernel $I$ 
is annihilated by $\mathfrak{m}_{A'}$. Let $x \in \textnormal{Ob}(\mathcal 
F(A))$.  In this situation $\varphi$ induces a map $\textnormal{Lift}(x, A') 
\rightarrow \textnormal{Lift}(\varphi(x),A')$, denoted still by $\varphi$, and 
there is a a map $d\varphi \otimes \textnormal{id}: T\mathcal F \otimes_{k} I 
\rightarrow T\mathcal G \otimes_{k} I$. Denoting the action of $v \in TF 
\otimes_{k} I$ on a lifting $a \in \textnormal{Lift}(x,A')$ by $a \cdot v$, the 
functoriality with respect to $\varphi$ is: $\varphi(a \cdot v) = \varphi(a) 
\cdot (d\varphi \otimes \textnormal{id}(v))$.
\end{remark}




\subsection{Schlessinger's theorem on prorepresentable functors}
\label{subsection-schlessingers-theorem}

\noindent
We deduce Schlessinger's theorem characterizing prorepresentable functors on 
$\mathcal C_{\Lambda}$.

\begin{lemma}
\label{lemma-minimal-smooth-morphism-functors}
Let $F,G: \mathcal C_{\Lambda} \rightarrow \textnormal{(Sets)}$ be deformation 
functors.  Let $\varphi: F \rightarrow G$ be a minimal smooth morphism. Then 
$\varphi$ is an isomorphism.
\end{lemma}

\begin{proof}
We prove $F(A) \rightarrow G(A)$ is a bijection for all $A \in 
\textnormal{Ob}(\mathcal C_{\Lambda})$ by induction on 
$\textnormal{length}_{A}(A)$.  For $A = k$ the statement follows from the 
assumption that $F$ and $G$ are deformation functors. Suppose that the 
statement holds for rings of length less than $n$ and let $A'$ be a ring of 
length $n$. Choose a small extension $f: A' \rightarrow A$.  We have a 
commutative diagram
\[
\xymatrix{
F(A') \ar[r] \ar[d] & G(A') \ar[d] \\
F(A) \ar[r]^{\sim} & G(A)
}
\]
where the map $F(A) \rightarrow G(A)$ is a bijection.  By smoothness of $F 
\rightarrow G$, $F(A') \rightarrow G(A')$ is surjective (Lemma 
\ref{lemma-smooth-morphism-essentially-surjective}).  Thus we can check 
bijectivity by checking it on fibers $F(f)^{-1}(x) \rightarrow 
G(f)^{-1}(\varphi(x))$ for $x \in F(A)$ such that $F(f)^{-1}(x)$ is nonempty.  
These fibers are precisely $\textnormal{Lift}(x,A')$ and 
$\textnormal{Lift}(\varphi(x),A')$ and by minimality of $\varphi$ we have an 
isomorphism $d\varphi \otimes \textnormal{id}: TF \otimes_{k} I 
\xrightarrow{\sim} TG \otimes_{k} I$.  Thus, by Lemma 
\ref{lemma-free-transitive-action} and Remark 
\ref{remark-free-transitive-action-functorial}, for $x \in F(A)$ such that 
$F(f)^{-1}(x)$ is nonempty the map $F(f)^{-1}(x) \rightarrow 
G(f)^{-1}(\varphi(x))$ is a map of sets commuting with free transitive actions 
by $TF \otimes_{k} I$; hence it is bijective.
\end{proof}

\begin{theorem}
\label{lemma-Schlessinger-prorepresentability}
Let $F: \mathcal C_{\Lambda} \rightarrow \textnormal{(Sets)}$ be a functor.  
Then $F$ is prorepresentable if and only if it is a deformation functor and 
$\dim_k TF$ is finite.
\end{theorem}

\begin{proof}
If $F$ is prorepresentable, then $F$ is a deformation functor by Example 
\ref{example-prorepresentable-deformation-functor} and $\dim_k TF$ is finite by 
Example \ref{example-tangent-space-prorepresentable-functor}.  Conversely, if 
$F$ is a deformation functor and $\dim_k TF$ is finite, then by Theorem 
\ref{theorem-miniversal-object-existence} there exists a prorepresentable 
functor $U: \mathcal C_{\Lambda} \rightarrow \textnormal{(Sets)}$ and a minimal 
smooth morphism $f: U \rightarrow F$, which by Lemma 
\ref{lemma-minimal-smooth-morphism-functors} is an isomorphism.
\end{proof}

\subsection{Infinitesimal automorphisms}
\label{subsection-infinitesimal-automorphisms}

\noindent
Let $\mathcal F$ be a category cofibered in groupoids over $\mathcal 
C_{\Lambda}$. Given a morphism $x' \rightarrow x$ in $\mathcal F$ lying over 
$A' \rightarrow A$, there is an induced homomorphism
\[ \textnormal{Aut}_{A'}(x') \rightarrow \textnormal{Aut}_{A}(x). \]
Lemma \ref{lemma-RS-associated-functor} says that the cokernel of this 
homomorphism determines whether the condition (RS) on $\mathcal F$ passes to 
$\overline{\mathcal F}$. In this section we study the kernel of this 
homomorphism. We will see that it also gives a measure of how far $\mathcal F$ 
is from $\overline{\mathcal F}$ (Lemma \ref{lemma-infdef-trivial}).  

\begin{definition}
\label{definition-relative-infinitesimal-auts}
Let $\mathcal F$ be a category cofibered in groupoids over $\mathcal 
C_{\Lambda}$. Let $x' \rightarrow x$ be a morphism in $\mathcal F$ lying over 
$A' \rightarrow A$. The {\it group of infinitesimal automorphisms 
$\textnormal{Inf}({x'/x})$ of $x'$ over $x$} is the kernel of 
$\textnormal{Aut}_{A'}(x') \rightarrow \textnormal{Aut}_{A}(x)$.
\end{definition}

\begin{definition}
\label{definition-infinitesimal-auts}
Let $\mathcal F$ be a category cofibered in groupoids over $\mathcal 
C_{\Lambda}$. Let $x_0 \in \textnormal{Ob}(\mathcal F(k))$. Assume a choice of 
pushforward $x_0 \rightarrow x_0'$ of $x_0$ along the map $k \rightarrow 
k[\varepsilon]$ has been made.  Then there is a unique map $x'_0 \rightarrow 
x_0$ such that $x_0 \rightarrow x_0' \rightarrow x_0$ is the identity on $x_0$. 
The {\it group of infinitesimal automorphisms $\textnormal{Inf}_{x_0}(\mathcal 
F)$ of $x_0$} is $\textnormal{Inf}(x'_0/x_0)$.
\end{definition}

\begin{remark}
\label{remark-choice-pushforward-immaterial-infinitesimal-aut}
Up to isomorphism, $\textnormal{Inf}_{x_0}(\mathcal F)$ does not depend on the 
choice of pushforward $x_0 \rightarrow x_0'$.  Moreover, if $y_0 \in \mathcal 
F(k)$ and $x_0 \cong y_0$ in $\mathcal F(k)$, then 
$\textnormal{Inf}_{x_0}(\mathcal F) \cong \textnormal{Inf}_{y_0}(\mathcal F)$.
\end{remark}

\begin{remark}
\label{remark-trivial-aut-point}
When $\mathcal F$ is a predeformation category, $\textnormal{Aut}_{k}(x_0)$ is 
trivial and hence $\textnormal{Inf}_{x_0}(\mathcal F) = 
\textnormal{Aut}_{k[\varepsilon]}(x'_0)$.
\end{remark}

\noindent
Next we show that $\textnormal{Inf}_{x_0}(\mathcal F)$ has a natural $k$-vector 
space structure when $\mathcal F$ satisfies (RS) (Lemma 
\ref{lemma-infaut-vector-space}).  At the same time, we will see that if 
$\mathcal F$ satisfies (RS), then the infinitesimal automorphisms 
$\textnormal{Inf}(x'/x)$ of a morphism $x' \rightarrow x$ lying over a small 
extension are governed by $\textnormal{Inf}_{x_0}(\mathcal F)$, where $x_0$ is 
a pushforward of $x$ to $\mathcal F(k)$ (Lemma 
\ref{lemma-lifted-automorphisms-torsor}).  To this end, we introduce an 
automorphism functor for any object $x \in \textnormal{Ob}(\mathcal F)$ as 
follows.

\begin{definition}
\label{definition-automorphism-functor}
Let $p: \mathcal F \rightarrow \mathcal C$ be a category cofibered in groupoids 
over an arbitrary base category $\mathcal C$. Assume a choice of pushforwards 
has been made.  Let $x \in \textnormal{Ob}(\mathcal F)$ and let $U = p(x)$.  
Let $U/\mathcal C$ denote the category of objects under $U$. The 
{\it automorphism functor of $x$} is the functor $\textnormal{Aut}(x): 
U/\mathcal C \rightarrow \textnormal{(Sets)}$ sending an object $f: U 
\rightarrow V$ to $\textnormal{Aut}_{V}(f_*x)$ and sending a morphism
\[
\xymatrix{
V' \ar[rr] &                    & V\\
          & U \ar[ul]^{f}  \ar[ur]_{f'} & 
}
\]
to the homomorphism $\textnormal{Aut}_{V'}(f'_*x) \rightarrow 
\textnormal{Aut}_{V}(f_*x)$.
\end{definition}

\noindent 
We will be concerned with the automorphism functors of objects in a category 
cofibered in groupoids $\mathcal F$ over $\mathcal C_{\Lambda}$.  If $A \in 
\text{Ob}(\mathcal C_{\Lambda})$, then the category $A/\mathcal C_{\Lambda}$ is 
nothing but the category $\mathcal C_{A}$, i.e.\ the category defined in 
Subsection \ref{subsection-CLambda}
where we take $\Lambda = A$.  Hence the 
automorphism functor of an object $x \in \text{Ob}(\mathcal F(A))$ is a functor 
$\textnormal{Aut}(x): \mathcal C_{A} \rightarrow \textnormal{(Sets)}$.

\begin{lemma}
\label{lemma-Aut-functor-RS}
Let $\mathcal F$ be a category cofibered in groupoids over $\mathcal 
C_{\Lambda}$ satisfying \textnormal{(RS)}.  Let $x \in \textnormal{Ob}(\mathcal 
F(A))$.  Then $\textnormal{Aut}(x): \mathcal C_{A} \rightarrow 
\textnormal{(Sets)}$ satisfies \textnormal{(RS)}.
\end{lemma}

\begin{proof}
It follows that $\textnormal{Aut}(x)$ satisfies (RS) from the fully 
faithfulness of the functor $\mathcal F(A_1 \times_{A} A_2) \rightarrow 
\mathcal F(A_1) \times_{\mathcal F(A)} \mathcal F(A_2)$ in Remark 
\ref{remark-RS-2-categorical}.
\end{proof}

\begin{lemma}
\label{lemma-Aut-functor-tangent-space}
Let $\mathcal F$ be a category cofibered in groupoids over $\mathcal 
C_{\Lambda}$ satisfying \textnormal{(RS)}.  Let $x \in \textnormal{Ob}(\mathcal 
F(A))$.  Let $x_0$ be a pushforward of $x$ to $\mathcal F(k)$.
\begin{enumerate}
\item $T_{\textnormal{id}_{x_0}} \textnormal{Aut}(x)$ has a natural $k$-vector 
space structure such that addition agrees with composition in 
$T_{\textnormal{id}_{x_0}} \textnormal{Aut}(x)$.  In particular, composition in 
$T_{\textnormal{id}_{x_0}} \textnormal{Aut}(x)$ is commutative.
\item With the natural vector space structures, there is an isomorphism 
$T_{\textnormal{id}_{x_0}} \textnormal{Aut}(x) \cong T_{\textnormal{id}_{x_0}} 
\textnormal{Aut}(x_0)$.
\end{enumerate}
\end{lemma}

\begin{proof}
Let $F = \textnormal{Aut}(x)_{\textnormal{id}_{x_0}}$, the notation being that 
of Remark \ref{remark-localize-cofibered-groupoid}. By definition 
$T_{\textnormal{id}_{x_0}} \textnormal{Aut}(x) = TF = F(k[\varepsilon])$. It 
follows from Lemmas \ref{lemma-Aut-functor-RS} and \ref{lemma-localize-RS} that 
$F$ is a deformation category.  Hence $F(k[\varepsilon])$ has the natural 
$k$-vector space structure specified by Lemma 
\ref{lemma-tangent-space-functor}.  

\medskip \noindent
In particular, addition is defined as the composition
\[ +: F(k[\varepsilon]) \times F(k[\varepsilon]) \xrightarrow{\sim} 
F(k[\varepsilon] \times_{k} k[\varepsilon]) \rightarrow F(k[\varepsilon]) \]
where the first map is the inverse of the bijection guaranteed by (RS) and the 
second is induced by the ring map $k[\varepsilon] \times_{k} k[\varepsilon] 
\cong k[\varepsilon_1,\varepsilon_2]/(\varepsilon_1^2, \varepsilon_2^2, 
\varepsilon_1\varepsilon_2) \rightarrow k[\varepsilon]$ sending 
$\varepsilon_1,\varepsilon_2 \mapsto \varepsilon$. If $A \rightarrow B$ is a 
ring map in $\mathcal C_{\Lambda}$, then $F(A) \rightarrow F(B)$ is a 
homomorphism where $F(A) = \textnormal{Aut}(x)_{\textnormal{id}_{x_0}}(A)$ and 
$F(B) = \textnormal{Aut}(x)_{\textnormal{id}_{x_0}}(B)$ are groups under 
composition.  Hence $+: F(k[\varepsilon]) \times F(k[\varepsilon])\rightarrow 
F(k[\varepsilon])$ is a homomorphism where $F(k[\varepsilon])$ is regarded as a 
group under composition.  Moreover $+(v, \textnormal{id}_{x_0'}) = 
+(\textnormal{id}_{x_0'},v) = v$ for any $v \in F(k[\varepsilon])$, where 
$x_0'$ denotes the pushforward of $x_0$ along $k \rightarrow k[\varepsilon]$.  
In general it is easy to see that if $G$ is a group with multiplication $\circ$ 
and $+: G \times G \rightarrow G$ is a homomorphism such that $+(g,1) = 
+(1,g)$, where $1$ is the identity of $G$, then $+ = \circ$.  This shows 
addition in the $k$-vector space structure on $F(k[\varepsilon])$ agrees with 
composition.

\medskip \noindent
Finally, (2) follows from the fact that a pushforward $x \rightarrow x'$ of $x$ 
along $A \rightarrow k[\varepsilon]$ factors as $x \rightarrow x_0 \rightarrow 
x'$, hence $x'$ is also a pushforward of $x_0$ along $k \rightarrow 
k[\varepsilon]$.
\end{proof}

\begin{remark}
\label{remark-infaut-lifting-equalities}
We point out some basic relationships between infinitesimal automorphism 
groups, liftings, and tangent spaces to automorphism functors.  Let $\mathcal 
F$ be a category cofibered in groupoids over $\mathcal C_{\Lambda}$.  Let $x' 
\rightarrow x$ be a morphism lying over a ring map $A' \rightarrow A$.  Let 
$x_0$ be a pushforward of $x$ to $\mathcal F(k)$.  Then from the definitions we 
have an equality
\[ \textnormal{Inf}(x'/x) = \textnormal{Lift}(\textnormal{id}_{x}, A') \]
where the liftings are of $\textnormal{id}_{x}$ as an object of 
$\textnormal{Aut}(x')$.  If $x_0 \in \textnormal{Ob}(\mathcal F(k))$ and $x'_0$ 
is the pushforward to $\mathcal F(k[\varepsilon])$, then applying this to $x'_0 
\rightarrow x_0$ we get 
\[ \textnormal{Inf}_{x_0}(\mathcal F) = 
\textnormal{Lift}(\textnormal{id}_{x_0}, k[\varepsilon]) = 
T_{\textnormal{id}_{x_0}} \textnormal{Aut}(x_0), \]
the last equality following directly from the definitions.
\end{remark}

\begin{lemma}
\label{lemma-infaut-vector-space}
Let $\mathcal F$ be a category cofibered in groupoids over $\mathcal 
C_{\Lambda}$ satisfying \textnormal{(RS)}.  Let $x_0 \in 
\textnormal{Ob}(\mathcal F(k))$.  Then $\textnormal{Inf}_{x_0}(\mathcal F)$ is 
equal as a set to $T_{\textnormal{id}_{x_0}} \textnormal{Aut}(x_0)$, and so has 
a natural $k$-vector space structure such that addition agrees with composition 
of automorphisms.
\end{lemma}

\begin{proof}
The equality of sets is as in the end of Remark 
\ref{remark-infaut-lifting-equalities} and the statement about the vector space 
structure follows from Lemma \ref{lemma-Aut-functor-tangent-space}.
\end{proof} 

\begin{lemma}
\label{lemma-lifted-automorphisms-torsor}
Let $\mathcal F$ be a category cofibered in groupoids over $\mathcal 
C_{\Lambda}$ satisfying \textnormal{(RS)}.  Let $x' \rightarrow x$ be a 
morphism lying over a small extension $A' \rightarrow A$ with kernel $I$.  Let 
$x_0$ be a pushforward of $x$ to $\mathcal F(k)$.  Then 
$\textnormal{Inf}(x'/x)$ has a free and transitive action by 
$T_{\textnormal{id}_{x_0}} \textnormal{Aut}(x') \otimes_{k} I \cong 
\textnormal{Inf}_{x_0}(\mathcal F) \otimes_{k} I$.
\end{lemma}

\begin{proof}
It follows from Lemma \ref{lemma-free-transitive-action} and the equality 
$\textnormal{Inf}(x'/x) = \textnormal{Lift}(\textnormal{id}_{x}, A')$ of Remark 
\ref{remark-infaut-lifting-equalities} that $\textnormal{Inf}(x'/x)$ has a free 
an transitive action by $T_{\textnormal{id}_{x_0}} \textnormal{Aut}(x') 
\otimes_{k} I$.  The isomorphism $T_{\textnormal{id}_{x_0}} 
\textnormal{Aut}(x') \otimes_{k} I \cong \textnormal{Inf}_{x_0}(\mathcal F) 
\otimes_{k} I$ of vector spaces follows from Lemma 
\ref{lemma-Aut-functor-tangent-space} (2).
\end{proof}

\begin{lemma}
\label{lemma-infaut-trivial}
Let $\mathcal F$ be a category cofibered in groupoids over $\mathcal 
C_{\Lambda}$ satisfying \textnormal{(RS)}. Let $x' \rightarrow x$ be a morphism 
in $\mathcal F$ lying over a surjective ring map.  Let $x_0$ be a pushforward 
of $x$ to $\mathcal F(k)$.  If $\textnormal{Inf}_{x_0}(\mathcal F) = 0$ then 
$\textnormal{Inf}(x'/x) = 0$.
\end{lemma}

\begin{proof}
Follows from Lemmas \ref{lemma-factor-small-extension} and 
\ref{lemma-lifted-automorphisms-torsor}.
\end{proof}

\begin{lemma}
\label{lemma-infdef-trivial}
Let $\mathcal F$ be a category cofibered in groupoids over $\mathcal 
C_{\Lambda}$ satisfying (RS). Let $x_0 \in \textnormal{Ob}(\mathcal F(k))$. 
Then $\textnormal{Inf}_{x_0}(\mathcal F) = 0$ if and only if the natural 
morphism $\mathcal F_{x_0} \rightarrow \overline{\mathcal F_{x_0}}$ of 
categories cofibered in groupoids is an equivalence.
\end{lemma}

\begin{proof}
The morphism $\mathcal F_{x_0} \rightarrow \overline{\mathcal F_{x_0}}$ is an 
equivalence if and only if $\mathcal F_{x_0}$ is fibered in setoids,
cf.\ Categories, Section \ref{categories-section-fibred-in-setoids}
(a setoid is by definition a groupoid in 
which the only automorphism of any object is the identity).  We prove that 
$\textnormal{Inf}_{x_0}(\mathcal F) = 0$ if and only if this condition holds 
for $\mathcal F_{x_0}$.  Obviously if $\mathcal F_{x_0}$ is fibered in setoids 
then $\textnormal{Inf}_{x_0}(\mathcal F) = 0$.  Conversely assume 
$\textnormal{Inf}_{x_0}(\mathcal F) = 0$.  Let $A$ be an object of $\mathcal 
C_{\Lambda}$. Then by Lemma \ref{lemma-infaut-trivial}, 
$\textnormal{Inf}(x/x_0) = 0$ for any object $x \rightarrow x_0$ of $\mathcal 
F_{x_0}(A)$. Since by definition $\textnormal{Inf}(x/x_0)$ equals the group of 
automorphisms of $x \rightarrow x_0$ in $\mathcal F_{x_0}(A)$, this proves 
$\mathcal F_{x_0}(A)$ is a setoid.
\end{proof}


\subsection{Groupoids in functors}
\label{subsection-groupoids-in-functors}

\noindent
In this section we discuss groupoids in functors on $\mathcal C_{\Lambda}$. In
Subsection \ref{subsection-presentations}
we will see that minimal smooth 
prorepresentable groupoids in functors on $\mathcal C_{\Lambda}$ serve as 
``presentations'' for well-behaved deformation categories in the same way that 
smooth groupoids in algebraic spaces serve as presentations for algebraic 
stacks,
cf.\ Algebraic Stacks, Section \ref{algebraic-section-stack-to-presentation}.
We begin with generalities 
on groupoids in functors on an arbitrary category, then pass to the category 
$\mathcal C_{\Lambda}$.



\subsection{Groupoids in functors on an arbitrary category}
\label{subsection-groupoids-arbitrary}

\noindent
For clarity we shall sometimes refer to an ordinary groupoid, i.e.\ a category 
whose morphisms are all isomorphisms, as a groupoid category.

\begin{definition}
\label{definition-groupoid-in-functors}
Let $\mathcal C$ be a category. The {\it category of groupoids in functors on 
$\mathcal C$} is the category with the following objects and morphisms.
\begin{enumerate}
\item Objects: A {\it groupoid in functors on $\mathcal C$} is a quintuple 
$(U,R,s,t,c)$ where $U,R: \mathcal C \rightarrow \textnormal{(Sets)}$ are 
functors and $s,t: R \rightarrow U$ and $c: R \times_{s,U,t} R \rightarrow R$ 
are morphisms with the following property: For any object $T$ of $\mathcal C$, 
the quintuple
\[ (U(T), R(T), s,t,c) \]
is a groupoid category.
\item Morphisms: A {\it morphism $(U,R,s,t,c) \rightarrow (U',R',s',t',c')$ of 
groupoids in functors on $\mathcal C$} consists of morphisms $U \rightarrow U'$ 
and $R \rightarrow R'$ with the following property: For any object $T$ of 
$\mathcal C$, the induced maps $U(T) \rightarrow U'(T)$ and $R(T) \rightarrow 
R'(T)$ define a functor between groupoid categories
\[ (U(T), R(T), s,t,c) \rightarrow (U'(T), R'(T), s',t',c') .\] 
\end{enumerate}
\end{definition}

\begin{remark}
\label{remark-confusion-groupoids-in-functors}
A groupoid in functors on $\mathcal C$ amounts to the data of a functor $ 
\mathcal C \rightarrow \textnormal{(Groupoids)}$, and a morphism of groupoids 
in functors on $\mathcal C$ amounts to a morphism of the corresponding functors 
$\mathcal C \rightarrow \textnormal{(Groupoids)}$ (where 
$\textnormal{(Groupoids)}$ is regarded as a 1-category).  However, for our 
purposes it is more convenient to use the terminology of groupoids in functors. 
 In fact, thinking of a groupoid in functors as the corresponding functor 
$\mathcal C \rightarrow \textnormal{(Groupoids)}$, or equivalently as the 
category cofibered in groupoids associated to that functor, can lead to 
confusion (Remark \ref{remark-smooth-groupoid-in-functors-warning}).
\end{remark}

\begin{remark}
\label{remark-identity-inverse}
Let $(U,R,s,t,c)$ be a groupoid in functors on a category $\mathcal C$. There 
are unique morphisms $e: U \rightarrow R$ and $i: R \rightarrow R$ such that 
for every object $T$ of $\mathcal C$, $e: U(T) \rightarrow R(T)$ sends $x \in 
U(T)$ to the identity morphism on $x$ and $i: R(T) \rightarrow R(T)$ sends $a 
\in U(T)$ to the inverse of $a$ in the groupoid category $(U(T),R(T),s,t,c)$. 
We will sometimes refer to $s,t,c,e,$ and $i$ as ``source,'' ``target,'' 
``composition,'' ``identity,'' and ``inverse.''
\end{remark}

\begin{definition}
\label{definition-representable}
Let $\mathcal C$ be a category.  A groupoid in functors on $\mathcal C$ is 
{\it representable} if it is isomorphic to one of the form $(\underline{U}, 
\underline{R}, s,t,c)$ where $U$ and $R$ are objects of $\mathcal C$ and the 
coproduct $R \coprod_{s,U,t} R$ exists.
\end{definition}

\begin{remark}
\label{remark-reason-existence-coproduct}
Hence a representable groupoid in functors on $\mathcal C$ is given by objects 
$U$ and $R$ of $\mathcal C$ and morphisms $s,t: U \rightarrow R$ and $c: R 
\rightarrow R \coprod_{s,U,t} R$ such that 
$(\underline{U},\underline{R},s,t,c)$ satisfies the condition of Definition 
\ref{definition-groupoid-in-functors}. The reason for requiring the existence 
of $R \coprod_{s,U,t} R$ is so that the composition morphism $c$ is defined at 
the level of morphisms in $\mathcal C$.  This requirement will always be 
satisfied below when we consider representable groupoids in functors on 
$\widehat{\mathcal C}_{\Lambda}$, since by Lemma 
\ref{lemma-CLambdahat-coproducts} the category $\widehat{\mathcal C}_{\Lambda}$ 
admits coproducts.
\end{remark}

\begin{remark}
\label{remark-simplify-terminology}
We will simply say ``let $(\underline{U}, \underline{R}, s,t,c)$ be a groupoid 
in functors on $\mathcal C$'' to mean ``$U$ and $R$ are objects of $\mathcal C$ 
and $(\underline{U}, \underline{R}, s,t,c)$ is a groupoid in functors on 
$\mathcal C$.''
\end{remark}

\noindent
We introduce notation for restriction of groupoids in functors. This will be 
relevant below in situations where we restrict from $\widehat{\mathcal 
C}_{\Lambda}$ to $\mathcal C_{\Lambda}$.

\begin{definition}
\label{definition-restricting-groupoids-in-functors}
Let $(U,R,s,t,c)$ be a groupoid in functors on a category $\mathcal C$.  Let 
$\mathcal C'$ be a subcategory of $\mathcal C$.  The {\it restriction 
$(U,R,s,t,c)|_{\mathcal C'}$ of $(U,R,s,t,c)$ to $\mathcal C'$} is the groupoid 
in functors on $\mathcal C'$ given by $(U|_{\mathcal C'},R|_{\mathcal 
C'},s|_{\mathcal C'},t|_{\mathcal C'},c|_{\mathcal C'})$.
\end{definition}

\begin{remark}
\label{remark-notation-restriction}
In the situation of Definition 
\ref{definition-restricting-groupoids-in-functors}, we often denote 
$s|_{\mathcal C'},t|_{\mathcal C'},c|_{\mathcal C'}$ simply by $s,t,c$.
\end{remark}

\begin{definition}
\label{definition-quotient}
Let $(U,R,s,t,c)$ be a groupoid in functors on a category $\mathcal C$. 
\begin{enumerate}
\item The assignment $T \mapsto  (U(T), R(T), s,t,c)$ determines a functor 
$\mathcal C \rightarrow \textnormal{(Groupoids)}$. The {\it quotient category 
cofibered in groupoids $[U/R] \rightarrow \mathcal C$} is the category 
cofibered in groupoids over $\mathcal C$ associated to this functor (as in 
Remarks \ref{remarks-cofibered-groupoids} 
(\ref{item-construction-associated-cofibered-groupoid})).  
\item The {\it quotient morphism $U \rightarrow [U/R]$} is the morphism of 
categories cofibered in groupoids over $\mathcal C$ which sends an object $x 
\in U(T)$ to $(T,x) \in \textnormal{Ob}([U/R](T))$, and sends a morphism $f: T 
\rightarrow T'$ to $(f, \textnormal{id}_{x'}): (T,x) \rightarrow (T,x')$.
\end{enumerate} 
\end{definition}




\subsection{Prorepresentable groupoids in functors on $\mathcal C_{\Lambda}$}
\label{subsection-prerepresentable-groupoids-in-functors}

\begin{definition}
\label{definition-prorepresentable-groupoid-in-functors}
A groupoid in functors on $\mathcal C_{\Lambda}$ is {\it prorepresentable} if 
it is isomorphic to $(\underline{R_0}, \underline{R_1}, s,t,c)|_{\mathcal 
C_{\Lambda}}$ for $(\underline{R_0}, \underline{R_1}, s,t,c)$ a groupoid in 
functors on $\widehat{\mathcal C}_{\Lambda}$.
\end{definition}

\noindent
Let $(U,R,s,t,c)$ be a groupoid in functors on $\mathcal C_{\Lambda}$.  Then 
taking completions, we get a quintuple $(\widehat{U}, \widehat{R}, \widehat{s}, 
\widehat{t}, \widehat{c})$.  By Remark 
\ref{remark-completion-restriction-cofset-adjoint} completion as a functor on 
$\textnormal{CofSet}(\mathcal C_{\Lambda})$ is a right adjoint, so it commutes 
with limits.  In particular, there is a canonical isomorphism $\widehat{R 
\times_{s,U,t} R} \cong \widehat{R} \times_{\widehat{s}, \widehat{U}, 
\widehat{t}} \widehat{R}$, so $\widehat{c}$ can be regarded as a functor 
$\widehat{R} \times_{\widehat{s}, \widehat{U}, \widehat{t}} \widehat{R} 
\rightarrow \widehat{R}$.  Then $(\widehat{U}, \widehat{R}, \widehat{s}, 
\widehat{t}, \widehat{c})$ defines a groupoid in functors on $\widehat{\mathcal 
C}_{\Lambda}$, with identity and inverse morphisms being the completions of 
those of $(U,R,s,t,c)$.

\begin{definition}
\label{definition-completion-groupoud-in-functors}
Let $(U,R,s,t,c)$ be a groupoid in functors on $\mathcal C_{\Lambda}$.  The 
{\it completion $(U,R,s,t,c)^{\wedge}$ of $(U,R,s,t,c)$} is the groupoid in 
functors on $\widehat{\mathcal C}_{\Lambda}$ given by 
$(\widehat{U},\widehat{R},\widehat{s},\widehat{t},\widehat{c})$.
\end{definition}

\begin{remark}
\label{remark-groupoid-in-functors-complete-restrict}
Let $(U,R,s,t,c)$ be a groupoid in functors on $\mathcal C_{\Lambda}$. Then 
there is a canonical isomorphism $(U,R,s,t,c)^{\wedge}|_{\mathcal C_{\Lambda}} 
\cong (U,R,s,t,c)$.  This follows from the fact that for a functor $F: \mathcal 
C_{\Lambda} \rightarrow \textnormal{(Sets)}$, the natural map 
$\widehat{F}|_{\mathcal C_{\Lambda}} \rightarrow F$ is an isomorphism (see the 
end of Remark \ref{remark-completion-restriction-cofset-adjoint}).  On the 
other hand, let $(U,R,s,t,c)$ be a groupoid in functors on $\widehat{\mathcal 
C}_{\Lambda}$ such that $U, R: \widehat{\mathcal C}_{\Lambda} \rightarrow 
\textnormal{(Sets)}$ both commute with limits, e.g.\ if $U,R$ are 
representable. Then there is a canonical isomorphism $((U,R,s,t,c)|_{\mathcal 
C_{\Lambda}})^{\wedge} \cong (U,R,s,t,c)$. This follows from Remark 
\ref{remark-restrict-complete-continuous-functor}.
\end{remark}

\begin{lemma}
\label{lemma-groupoid-in-functors-prorep-equivalences}
Let $(U,R,s,t,c)$ be a groupoid in functors on $\mathcal C_{\Lambda}$.
\begin{enumerate}
\item $(U,R,s,t,c)$ is prorepresentable if and only if its completion is 
representable as a groupoid in functors on $\widehat{\mathcal C}_{\Lambda}$.
\item $(U,R,s,t,c)$ is prorepresentable if and only if $U$ and $R$ are 
prorepresentable.
\end{enumerate}
\end{lemma}

\begin{proof}
Statement (1) follows from Remark 
\ref{remark-groupoid-in-functors-complete-restrict}. For (2), the ``only if'' 
direction is clear from the definition of a prorepresentable groupoid in 
functors. Conversely, assume $U$ and $R$ are prorepresentable, say $U \cong 
\underline{R_0}|_{\mathcal C_{\Lambda}}$ and $R \cong 
\underline{R_1}|_{\mathcal C_{\Lambda}}$ for objects $R_0$ and $R_1$ of 
$\widehat{\mathcal C}_{\Lambda}$. It suffices by (1) to see that the completion 
$(U,R,s,t,c)^{\wedge}$ is representable in $\widehat{\mathcal C}_{\Lambda}$.  
But this follows from the isomorphisms $\underline{R_0} \cong 
\widehat{\underline{R_0}|_{\mathcal C_{\Lambda}}}$ and $\underline{R_1} \cong 
\widehat{\underline{R_1}|_{\mathcal C_{\Lambda}}}$ of Remark 
\ref{remark-restrict-complete-continuous-functor}.
\end{proof}

\subsection{Smooth and minimal groupoids in functors on $\mathcal C_{\Lambda}$}
\label{subsection-smooth-minimal-groupoids-in-functors}

\noindent
The notion of smoothness for groupoids in functors on $\mathcal C_{\Lambda}$ is 
defined as follows.

\begin{definition}
\label{definition-smooth-groupoid-in-functors}
Let $(U, R, s,t,c)$ be a groupoid in functors on $\mathcal C_{\Lambda}$.  We 
say $(U, R, s,t,c)$ is {\it smooth} if $s,t: R \rightarrow U$ are smooth.
\end{definition}

\begin{remark}
\label{remark-smooth-groupoid-in-functors-warning}
We note that this terminology is potentially confusing: if $(U, R, s,t,c)$ is a 
smooth groupoid in functors, then the quotient $[U/R]$ need not be smooth (see 
Remark \ref{remark-cofibered-groupoid-projection-smooth}).  However smoothness 
of $(U, R, s,t,c)$ does imply (and in fact is equivalent to) smoothness of the 
quotient morphism $U \rightarrow [U/R]$ (Lemma 
\ref{lemma-smooth-quotient-morphism}).  The situation is similar for minimality 
as defined in Definition \ref{definition-minimal-groupoid-in-functors}.
\end{remark}

\begin{remark}
\label{remark-smooth-power-series-prorepresentable-smooth-groupoid-in-functors}
Let $(\underline{R_0}, \underline{R_1}, s,t,c)|_{\mathcal C_{\Lambda}}$ be a 
prorepresentable groupoid in functors on $\mathcal C_{\Lambda}$.  Then 
$(\underline{R_0}, \underline{R_1}, s,t,c)|_{\mathcal C_{\Lambda}}$ is smooth 
if and only if $R_1$ is a power series over $R_0$ via both $s$ and $t$.  This 
follows from
Lemma \ref{lemma-smooth-morphism-power-series}.
\end{remark}

\begin{lemma}
\label{lemma-smooth-quotient-morphism}
Let $(U, R, s,t,c)$ be a groupoid in functors on $\mathcal C_{\Lambda}$.  The 
following are equivalent: 
\begin{enumerate}
\item The groupoid in functors $(U, R, s,t,c)$ is smooth.
\item The morphism $s: R \rightarrow U$ is smooth.
\item The morphism $t: R \rightarrow U$ is smooth.
\item The morphism $U \rightarrow [U/R]$ is smooth.
\end{enumerate}
\end{lemma}

\begin{proof}
Statement (2) is equivalent to (3) since the inverse $i: R \rightarrow R$ of 
$(U, R, s,t,c)$ is an isomorphism and $t = s \circ i$. By definition (1) is 
equivalent to (2) and (3) together, hence it is equivalent to either of them 
individually. 

\medskip \noindent
Finally we prove (2) is equivalent to (4). From the definitions:
\begin{enumerate}
\item[(2)] Smoothness of $s: R \rightarrow U$ amounts to the following 
condition: If $f: B \rightarrow A$ is a surjective ring map in $\mathcal 
C_{\Lambda}$, $a \in R(A)$, and $y \in U(B)$ such that $s(a) = U(f)(y)$, then 
there exists $a' \in R(B)$ such that $R(f)(a') = a$ and $s(a') = y$.

\item[(4)] Smoothness of $U \rightarrow [U/R]$ amounts to the following 
condition: If $f: B \rightarrow A$ be a surjective ring map in $\mathcal 
C_{\Lambda}$ and $(f,a): (B,y) \rightarrow (A,x)$ is a morphism of $[U/R]$, 
then there exists $x' \in U(B)$ and $b \in R(B)$ with $s(b) = x', t(b) = y$ 
such that $c(a,R(f)(b)) = e(x)$.  Here $e: U \rightarrow R$ denotes the 
identity and the notation $(f,a)$ is as in Remarks 
\ref{remarks-cofibered-groupoids} 
(\ref{item-construction-associated-cofibered-groupoid});
in particular $a \in R(A)$ with $s(a) = U(f)(y), t(a) = x$.  
\end{enumerate}
If (4) holds and $f,a,y$ as in (2) are given, let $x = t(a)$ so that we have a 
morphism $(f,a): (B,y) \rightarrow (A,x)$.  Then (4) produces $x'$ and $b$ as 
above, and $a' = i(b)$ satisfies the requirements of (2).  Conversely, assume 
(2) holds and let $(f,a): (B,y) \rightarrow (A,x)$ as in (4) be given.  Then 
(2) produces $a' \in R(B)$ as above, and $x' = t(a')$ and $b = i(a')$ satisfy 
the requirements of (4).
\end{proof}

\noindent
The notion of minimality for groupoids in functors on $\mathcal C_{\Lambda}$ is 
defined as follows.

\begin{definition}
\label{definition-minimal-groupoid-in-functors}
Let $(U, R, s,t,c)$ be a groupoid in functors on $\mathcal C_{\Lambda}$.  We 
say $(U, R, s,t,c)$ is {\it minimal} if the groupoid 
$(U(k[\varepsilon]),R(k[\varepsilon]), s,t,c)$ is totally disconnected, i.e.\ 
there are no morphisms between distinct objects.
\end{definition}

\begin{lemma}
\label{lemma-characterize-minimal-groupoid-in-functors}
Let $(U, R, s,t,c)$ be a groupoid in functors on $\mathcal C_{\Lambda}$.  
Assume $U$ and $R$ are predeformation functors.  Then $(U,R,s,t,c)$ is minimal 
if and only if the morphism $U \rightarrow [U/R]$ is minimal.
\end{lemma}

\begin{proof}
Follows immediately from the definitions.
\end{proof}

\noindent
The quotient of a minimal prorepresentable groupoid in functors on $\mathcal 
C_{\Lambda}$ does not admit autoequivalences which are not automorphisms.  To 
prove this, we first note the following lemma.

\begin{lemma}
\label{lemma-surjective-morphism-prorepresentable-functor}
Let $U: \mathcal C_{\Lambda} \rightarrow \textnormal{(Sets)}$ be a 
prorepresentable functor.  Let $\varphi: U \rightarrow U$ be a morphism such 
that $d\varphi: TU \rightarrow TU$ is an isomorphism.  Then $\varphi$ is an 
isomorphism.
\end{lemma}

\begin{proof}
The proof is essentially contained in the proof of Lemma 
\ref{lemma-miniversal-object-unique}. If $U \cong \underline{R}|_{\mathcal 
C_{\Lambda}}$ for some $R \in \textnormal{Ob}(\widehat{\mathcal C}_{\Lambda})$, 
then completing $\varphi$ gives a morphism $\underline{R} \rightarrow 
\underline{R}$.  If $f: R \rightarrow R$ is the corresponding morphism in 
$\mathcal C_{\Lambda}$, then $f$ induces an isomorphism of the tangent space 
$T_{R/\Lambda}$.  In particular $f$ is an endomorphism of $R$ inducing a 
surjection on $T^*_{R/\Lambda}$.  This implies $f$ is a surjection by Lemma 
\ref{lemma-surjective-cotangent-space}. As a surjective endomorphism of a 
Noetherian ring is an isomorphism, we conclude $f$, hence $\underline{R} 
\rightarrow \underline{R}$, hence the restriction $\varphi: U \rightarrow U$, 
is an isomorphism.
\end{proof}

\begin{lemma}
\label{lemma-minimal-prorepresentable-groupoid-autoequivalence}
Let $(U,R,s,t,c)$ be a minimal prorepresentable groupoid in functors on 
$\mathcal C_{\Lambda}$.  If $\varphi: [U/R] \rightarrow [U/R]$ is an 
equivalence of categories cofibered in groupoids, then $\varphi$ is an 
isomorphism.
\end{lemma}

\begin{proof}
The data of a morphism $\varphi: [U/R] \rightarrow [U/R]$ is equivalent to a 
morphism $\varphi: (U,R,s,t,c) \rightarrow (U,R,s,t,c)$ as in Definition 
\ref{definition-groupoid-in-functors}.  Over $k[\varepsilon]$, $\varphi$ gives 
an equivalence $(U(k[\varepsilon]),R(k[\varepsilon]), s,t,c) \rightarrow 
(U(k[\varepsilon]),R(k[\varepsilon]), s,t,c)$ of totally disconnected 
groupoids.  This equivalence is an isomorphism since an equivalence of totally 
disconnected categories is an isomorphism. Hence $\varphi: U(k[\varepsilon]) 
\rightarrow U(k[\varepsilon])$ and $\varphi: R(k[\varepsilon]) \rightarrow 
R(k[\varepsilon])$ are isomorphisms, and so by Lemma 
\ref{lemma-surjective-morphism-prorepresentable-functor}, $\varphi: U 
\rightarrow U$ and $\varphi: R \rightarrow R$ are isomorphisms.  This means 
$\varphi: (U,R,s,t,c) \rightarrow (U,R,s,t,c)$ is an isomorphism.
\end{proof}

\begin{lemma}
\label{lemma-minimal-prorepresentable-groupoid-equivalence}
Let $(U,R,s,t,c)$ and $(U',R',s',t',c')$ be minimal prorepresentable groupoids 
in functors on $\mathcal C_{\Lambda}$.  If $\varphi: [U/R] \rightarrow [U'/R']$ 
is an equivalence of categories cofibered in groupoids, then $\varphi$ is an 
isomorphism. 
\end{lemma}

\begin{proof}
Let $\psi: [U'/R'] \rightarrow [U/R]$ be a quasi-inverse to $\varphi$.  Then 
$\psi \circ \varphi$ and $\varphi \circ \psi$ are isomorphisms by Lemma 
\ref{lemma-minimal-prorepresentable-groupoid-autoequivalence}, hence $\varphi$ 
and $\psi$ are isomorphisms.
\end{proof}

\subsection{Deformation categories as quotients of groupoids in functors}
\label{subsection-deformation-categories-as-quotients}

\noindent
We discuss conditions on a groupoid in functors on $\mathcal C_{\Lambda}$ which 
guarantee that the quotient is a deformation category, and we calculate the 
tangent and infinitesimal automorphism spaces of such a quotient.

\begin{lemma}
\label{lemma-smooth-RS-groupoid-in-functors-quotient}
Let $(U, R, s,t,c)$ be a smooth groupoid in functors on $\mathcal C_{\Lambda}$. 
Assume $U$ and $R$ satisfy \textnormal{(RS)}. Then $[U/R]$ satisfies 
\textnormal{(RS)}.
\end{lemma}

\begin{proof}
Let 
\[
\xymatrix{
                           &     (A_2,x_2) \ar[d]^{(f_2,a_2)} \\
(A_1,x_1) \ar[r]^{(f_1,a_1)} &     (A,x)
}
\]
be a diagram in $[U/R]$ such that $f_2: A_2 \rightarrow A$ is surjective. The 
notation is as in Remarks \ref{remarks-cofibered-groupoids} 
(\ref{item-construction-associated-cofibered-groupoid}).
Hence $f_1: A_1 \rightarrow A, f_2: A_2 \rightarrow A$
are maps in $\mathcal C_{\Lambda}$, $x \in U(A), x_1 
\in U(A_1), x_2 \in U(A_2)$, and $a_1,a_2 \in R(A)$ with $s(a_1) = U(f_1)(x_1), 
t(a_1) = x$ and $s(a_2) = U(f_2)(x_2), t(a_2) = x$. We construct a fiber 
product lying over $A_1 \times_{A} A_2$ for this diagram in $[U/R]$ as follows. 

\medskip \noindent 
Let $a = c(i(a_1),a_2)$, where $i: R \rightarrow R$ is the inverse morphism. 
Then $a \in R(A)$ and $x_2 \in U(A_2)$ satisfy $s(a) = U(f_2)(x_2)$, hence they 
determine an element $a \times x_2 \in R(A) \times_{s,U(A),U(f_2)} U(A_2)$. By 
smoothness of $s: R \rightarrow U$, there is an element $\widetilde{a} \in 
R(A_2)$ mapping to $a \times x_2$ under
\[ R(A_2) \rightarrow R(A) \times_{s,U(A),U(f_2)} U(A_2). \]
This means $R(f_2)(\widetilde{a}) = a$ and $s(\widetilde{a}) = x_2$; in 
particular, $U(f_2)(t(\widetilde{a})) = t(a) = U(f_1)(x_1)$. Thus $x_1$ and 
$t(\widetilde{a})$ define an element 
\[ x_1 \times t(\widetilde{a}) \in U(A_1) \times_{U(A)} U(A_2).\]
By the assumption that $U$ satisfies (RS), we have an identification $U(A_1) 
\times_{U(A)} U(A_2) = U(A_1 \times_{A} A_2)$.  Let $p_1,p_2$ be the 
projections of $A_1 \times_{A} A_2$.  We claim 
\[ 
\xymatrix{
(A_1 \times_{A} A_2, x_1 \times t(\widetilde{a})) \ar[d]_{(p_1, e(x_1))} 
\ar[rr]^{(p_2, i(\widetilde{a}))} & & (A_2, x_2) \ar[d]^{(f_2,a_2)} \\
(A_1, x_1) \ar[rr]^{(f_1,a_1)} && (A,x) 
}
\]
is a fiber square in $[U/R]$. (Note $e: U \rightarrow R$ denotes the identity.)

\medskip \noindent
The diagram is commutative; this follows from $c(a_2,R(f_2)(i(\widetilde{a}))) 
= c(a_2, i(a)) = a_1$. To check it is a fiber square, let
\[ 
\xymatrix{
(B, z) \ar[d]_{(g_1, b_1)} \ar[rr]^{(g_2, b_2)} & & (A_2, x_2) 
\ar[d]^{(f_2,a_2)} \\
(A_1, x_1) \ar[rr]^{(f_1,a_1)} && (A,x) 
}
\]
be a commutative diagram in $[U/R]$; we show there is a unique morphism $(g,b): 
(B, z) \rightarrow (A_1 \times_{A} A_2, x_1 \times t(\widetilde{a}))$ commuting 
with the projections to $(A_1,x_1)$ and $(A_2,x_2)$. We must take $g = g_1 
\times g_2: B \rightarrow A_1 \times_{A} A_2$.  Since by assumption $R$ 
satisfies (RS), we have an identification $R(A_1 \times_{A} A_2) = R(A_1) 
\times_{R(A)} R(A_2)$.  Hence we can write $b = b'_1 \times b'_2$ for some 
$b'_1 \in R(A_1), b'_2 \in R(A_2)$ which agree in $R(A)$. Then $(g_1 \times 
g_2, b'_1 \times b'_2): (B, z) \rightarrow (A_1 \times_{A} A_2, x_1 \times 
t(\widetilde{a}))$ will commute with the projections if and only if $b'_1 = 
b_1$ and $b'_2 = c(\widetilde{a}, b_2)$.
\end{proof}

\begin{lemma}
\label{lemma-deformation-groupoid-quotient}
Let $(U, R, s,t,c)$ be a smooth groupoid in functors on $\mathcal C_{\Lambda}$. 
Assume $U$ and $R$ are deformation functors. Then:
\begin{enumerate}
\item The quotient $[U/R]$ is a deformation category.
\item The tangent space of $[U/R]$ is 
\[ T[U/R] = \textnormal{Coker}(ds-dt: TR \rightarrow TU).
\]
\item Let $x_0$ be the unique object of $[U/R](k)$.  The space of infinitesimal 
automorphisms of $[U/R]$ is 
\[ \textnormal{Inf}_{x_0}([U/R]) = \textnormal{Ker}(ds: TR \rightarrow TU) \cap 
\textnormal{Ker}(dt: TR \rightarrow TU).  
\]
\end{enumerate}
\end{lemma}

\begin{proof}
Since $U$ and $R$ are deformation functors $[U/R]$ is a predeformation 
category. Hence (1) holds by Lemma 
\ref{lemma-smooth-RS-groupoid-in-functors-quotient}.  Statements (2) and (3) 
follow directly from the definitions.
\end{proof}




\subsection{Presentations}
\label{subsection-presentations}
Given a deformation category $\mathcal F$ with finite dimensional tangent and 
infinitesimal automorphism spaces, we will produce a presentation of $\mathcal 
F$ by a minimal smooth prorepresentable groupoid in functors on $\mathcal 
C_{\Lambda}$ (Theorem \ref{theorem-presentation-deformation-groupoid}). 




\subsection{Presentations of categories cofibered in groupoids}
\label{subsection-presentation-categories-cofibred-in-groupoids}

\noindent
A presentation is defined as follows.

\begin{definition}
\label{definition-presentation}
Let $\mathcal F$ be a category cofibered in groupoids over a category $\mathcal 
C$.  Let $(U,R,s,t,c)$ be a groupoid in functors on $\mathcal C$.  A 
{\it presentation of $\mathcal F$ by $(U,R,s,t,c)$} is an equivalence 
$\varphi: [U/R] \rightarrow \mathcal F$ of categories cofibered in groupoids 
over $\mathcal C$.
\end{definition}

\noindent
The following two general lemmas will be used to get presentations.

\begin{lemma}
\label{lemma-presentation-construction}
Let $\mathcal F$ be category cofibered in groupoids over a category $\mathcal 
C$.  Let $U: \mathcal C \rightarrow \textnormal{(Sets)}$ be a functor. Let $f: 
U \rightarrow \mathcal F$ be a morphism of categories cofibered in groupoids 
over $\mathcal C$. Define $R,s,t,c$ as follows:
\begin{enumerate}
\item $R: \mathcal C \rightarrow \textnormal{(Sets)}$ is the functor $U 
\times_{f,\mathcal F,f} U$.
\item $t,s: R \rightarrow U$ are the first and second projections, 
respectively. 
\item $c: R \times_{s,U,t} R \rightarrow R$ is the morphism given by projection 
onto the first and last factors of $U \times_{f, \mathcal F, f} U 
\times_{f,\mathcal F,f} U$ under the canonical isomorphism $R \times_{s,U,t} R 
\cong U \times_{f, \mathcal F, f} U \times_{f,\mathcal F,f} U$.
\end{enumerate}
Then $(U,R,s,t,c)$ is a groupoid in functors on $\mathcal C$.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-presentation-morphism}
Let $\mathcal F$ be category cofibered in groupoids over a category $\mathcal 
C$.  Let $U: \mathcal C \rightarrow \textnormal{(Sets)}$ be a functor. Let $f: 
U \rightarrow \mathcal F$ be a morphism of categories cofibered in groupoids 
over $\mathcal C$. Let $(U,R,s,t,c)$ be the groupoid in functors on $\mathcal 
C$ constructed from $f: U \rightarrow \mathcal F$ in Lemma 
\ref{lemma-presentation-construction}.  Then there is a natural morphism $[f]: 
[U/R] \rightarrow \mathcal F$ such that:
\begin{enumerate}
\item $[f]: [U/R] \rightarrow \mathcal F$ is fully faithful.
\item $[f]: [U/R] \rightarrow \mathcal F$ is an equivalence if and only if $f: 
U \rightarrow \mathcal F$ is essentially surjective.
\end{enumerate}
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\subsection{Presentations of deformation categories}
\label{subsection-presentation-deformation-categories}

\noindent
According to the next lemma, a smooth morphism from a predeformation functor to 
a predeformation category $\mathcal F$ gives rise to a presentation of 
$\mathcal F$ by a smooth groupoid in functors.

\begin{lemma}
\label{lemma-smooth-groupoid-in-functors-construction}
Let $\mathcal F$ be a category cofibered in groupoids over $\mathcal 
C_{\Lambda}$.  Let $U: \mathcal C_{\Lambda} \rightarrow \textnormal{(Sets)}$ be 
a functor.  Let $f: U \rightarrow \mathcal F$ be a smooth morphism of 
categories cofibered in groupoids. Then:
\begin{enumerate}
\item If $(U,R,s,t,c)$ is the groupoid in functors on $\mathcal C_{\Lambda}$ 
constructed from $f: U \rightarrow \mathcal F$ in Lemma 
\ref{lemma-presentation-construction}, then $(U,R,s,t,c)$ is smooth. 
\item If $f: U(k) \rightarrow \mathcal F(k)$ is essentially surjective, e.g.\ 
if $U$ is a predeformation functor and $\mathcal F$ is a predeformation 
category, then the morphism $[f]: [U/R] \rightarrow \mathcal F$ of Lemma 
\ref{lemma-presentation-morphism} is an equivalence.
\end{enumerate}
\end{lemma}

\begin{proof}
From the construction of Lemma \ref{lemma-presentation-construction}, we have a 
commutative diagram
\[
\xymatrix{
R = U \times_{f,\mathcal F, f} U \ar[r]^{\hspace{7mm} s} \ar[d]_{t} & U 
\ar[d]^{f} \\
U \ar[r]^{f} & \mathcal F
}
\]
where $t,s$ are the first and second projections.  So $t,s$ are smooth by Lemma 
\ref{lemma-smooth-properties} (3).  Hence (1) holds.

\medskip \noindent
If the assumption of (2) holds, then by Lemma 
\ref{lemma-smooth-morphism-essentially-surjective} the morphism $f: U 
\rightarrow \mathcal F$ is essentially surjective. Hence by Lemma 
\ref{lemma-presentation-morphism} (2) the morphism $[f]: [U/R] \rightarrow 
\mathcal F$ is an equivalence.
\end{proof}

\begin{lemma}
\label{lemma-minimal-groupoid-in-functors-construction}
Let $\mathcal F$ be a predeformation category.  Let $U: \mathcal C_{\Lambda} 
\rightarrow \textnormal{(Sets)}$ be a predeformation functor.  Let $f: U 
\rightarrow \mathcal F$ be a minimal morphism of predeformation categories. Let 
$(U,R,s,t,c)$ be the groupoid in functors on $\mathcal C_{\Lambda}$ constructed 
from $f: U \rightarrow \mathcal F$ in Lemma 
\ref{lemma-presentation-construction}.  Then $(U,R,s,t,c)$ is minimal. 
\end{lemma}

\begin{proof}
By definition $R = U \times_{f,\mathcal F, f} U$.  Hence an element of 
$R(k[\varepsilon])$ is a triple $(u_1, u_2, a: f(u_1) \rightarrow f(u_2))$ 
where $u_1,u_2$ are objects of $U(k[\varepsilon])$ and $a$ is a morphism in 
$\mathcal F(k[\varepsilon])$.  By minimality of $f$ this means $u_1 = u_2$.  
Hence the projections $s,t: R(k[\varepsilon]) \rightarrow U(k[\varepsilon])$ 
are equal, meaning  $(U,R,s,t,c)$ is minimal.
\end{proof}

\noindent
Presentations by minimal prorepresentable groupoids in functors satisfy the 
following uniqueness property.

\begin{lemma}
\label{lemma-minimal-presentations-equivalent}
Let $\mathcal F$ be category cofibered in groupoids over $\mathcal 
C_{\Lambda}$. Assume there exist presentations of $\mathcal F$ by minimal 
prorepresentable groupoids in functors $(U,R,s,t,c)$ and $(U',R',s',t',c')$. 
Then $(U,R,s,t,c)$ and $(U',R',s',t',c')$ are isomorphic.
\end{lemma}

\begin{proof}
Follows from Lemma \ref{lemma-minimal-prorepresentable-groupoid-equivalence}.
\end{proof}

\begin{lemma}
\label{lemma-RS-fiber-product-morphisms}
Let $\mathcal F$ be a category cofibered in groupoids over $\mathcal 
C_{\Lambda}$.  Let $U,V: \mathcal C_{\Lambda} \rightarrow \textnormal{(Sets)}$ 
be functors.  Let $f: U \rightarrow \mathcal F$ and $g: V \rightarrow \mathcal 
F$ be morphisms of categories cofibered in groupoids.  Assume $\mathcal F, U, 
V$ all satisfy (RS).  Then $U \times_{f, \mathcal F, g} V$ satisfies (RS).
\end{lemma}

\begin{proof}
If $A$ is an object of $\mathcal C_{\Lambda}$, then an object of the fiber 
category $(U \times_{f, \mathcal F, g} V)(A)$ is a triple $(u,v,a)$ where $u 
\in U(A), v \in V(A),$ and $a: f(u) \rightarrow g(v)$ is a morphism in 
$\mathcal F(A)$.  

\medskip \noindent 
Let
\[
\xymatrix{
           & (u_2,v_2,a_2) \ar[d] \\
(u_1,v_1,a_1) \ar[r] & (u,v,a)  
}
\]
be a diagram in $U \times_{f, \mathcal F, g} V$ lying over
\[
\xymatrix{
           & A_2 \ar[d] \\
A_1 \ar[r] & A   
}
\]  
in $\mathcal C_{\Lambda}$ with $A_2 \rightarrow A$ surjective.  Since $U$ and 
$V$ satisfy (RS), there are fiber products $u_1 \times_{u} u_2$ and $v_1 
\times_{v} v_2$ lying over $A_1 \times_{A} A_2$.  Since $\mathcal F$ satisfies 
(RS), Lemma \ref{lemma-RS-fiber-square} shows
\[
\xymatrix{
 f(u_1 \times_{u} u_2) \ar[r] \ar[d] & f(u_2) \ar[d] \\
f(u_1) \ar[r] & f(u), 
} \hspace{4 mm} 
\xymatrix{
 g(v_1 \times_{v} v_2) \ar[r] \ar[d] & g(v_2) \ar[d] \\ 
 g(v_1) \ar[r] & g(v)
}
\]
are both fiber squares in $\mathcal F$.  It follows that
\[
\xymatrix{
 (u_1 \times_{u} u_2, v_1 \times_{v} v_2, a_{1} \times_{a} a_2) \ar[d] \ar[r] & 
(u_2,v_2,a_2) \ar[d] \\
(u_1,v_1,a_1) \ar[r] & (u,v,a)  
}
\]
is a fiber square in $U \times_{f, \mathcal F, g} V$ lying over
\[
\xymatrix{
A_1 \times_{A} A_2  \ar[r] \ar[d]         & A_2 \ar[d] \\
A_1 \ar[r] & A   .
}
\] 
\end{proof}

\begin{lemma}
\label{lemma-deformation-functor-fiber-product-morphisms}
Let $\mathcal F$ be a deformation category.  Let $U,V: \mathcal C_{\Lambda} 
\rightarrow \textnormal{(Sets)}$ be deformation functors.  Let $f: U 
\rightarrow \mathcal F$ and $g: V \rightarrow \mathcal F$ be morphisms of 
categories cofibered in groupoids. Then: 
\begin{enumerate}
\item $U \times_{f, \mathcal F, g} V$ is a deformation functor.
\item Let $u_0$ be the unique element of $U(k)$ and $u_0'$ its pushforward to 
$U(k[\varepsilon])$; define $v_0$ and $v'_0$ similarly.  There is an exact 
sequence of $k$-vector spaces
\[ 
0 \rightarrow K \rightarrow T(U \times_{f, \mathcal F, g} V) \rightarrow TU 
\oplus TV 
\]
where $K$ is the subspace of $T(U \times_{f, \mathcal F, g} V)$ consisting of 
elements of the form $(u'_0, v'_0, a: f(u'_0) \rightarrow g(v'_0))$, $a \in 
\textnormal{Hom}_{k[\varepsilon]}(f(u'_0), g(v'_0))$.
\end{enumerate}
\end{lemma}

\begin{proof}
Since $U,V$ are predeformation functors and $\mathcal F$ is a predeformation 
category, it follows immediately that $U \times_{f, \mathcal F, g} V$ is a 
predeformation functor.  Hence (1) holds by Lemma 
\ref{lemma-RS-fiber-product-morphisms}.

\medskip \noindent
Taking the differentials of the projections of $U \times_{f, \mathcal F, g} V$ 
to $U$ and $V$ gives $k$-linear maps $T(U \times_{f, \mathcal F, g} V) 
\rightarrow TU$ and $T(U \times_{f, \mathcal F, g} V) \rightarrow TV$, and 
hence a $k$-linear map $T(U \times_{f, \mathcal F, g} V) \rightarrow TU \oplus 
TV$.  Explicitly, this map sends an element $(u,v,a: f(u) \rightarrow g(v))$ of 
$T(U \times_{f, \mathcal F, g} V)$ to $(u,v)$.  So the kernel is exactly $K$ 
(this proves that $K$ is actually a subspace). Hence (2) holds.
\end{proof}

\begin{lemma}
\label{lemma-deformation-functor-diagonal}
Let $\mathcal F$ be a deformation category.  Let $U: \mathcal C_{\Lambda} 
\rightarrow \textnormal{(Sets)}$ be a deformation functor.  Let $f: U 
\rightarrow \mathcal F$ be a morphism of categories cofibered in groupoids. Let 
$u_0$ be the unique element of $U(k)$.  Then $U \times_{f,\mathcal F,f} U$ is a 
deformation functor with tangent space fitting into an exact sequence of 
$k$-vector spaces
\[ 
0 \rightarrow \textnormal{Inf}_{f(u_0)}(\mathcal F) \rightarrow T(U \times_{f, 
\mathcal F, g} U) \rightarrow TU \oplus TU 
\]
\end{lemma}

\begin{proof}
Follows from Lemma \ref{lemma-deformation-functor-fiber-product-morphisms}.
\end{proof}

\begin{lemma}
\label{lemma-prorepresentable-groupoid-in-functors-construction}
Let $\mathcal F$ be a deformation category.  Let $U: \mathcal C_{\Lambda} 
\rightarrow \textnormal{(Sets)}$ be a prorepresentable functor.  Let $f: U 
\rightarrow \mathcal F$ be a morphism of categories cofibered in groupoids.  
Let $(U,R,s,t,c)$ be the groupoid in functors on $\mathcal C_{\Lambda}$ 
constructed from $f: U \rightarrow \mathcal F$ in Lemma 
\ref{lemma-presentation-construction}. Assume $\dim_{k} 
\textnormal{Inf}_{x_0}(\mathcal F)$ is finite for some (and hence all) $x_0 \in 
\textnormal{Ob}(\mathcal F(k))$.  Then  $(U,R,s,t,c)$ is prorepresentable.
\end{lemma}

\begin{proof}
By the exact sequence of Lemma \ref{lemma-deformation-functor-diagonal}, 
$\dim_{k} T(U \times_{f,\mathcal F,f} U)$ is finite.  Thus $R =U 
\times_{f,\mathcal F,f} U$ is prorepresentable by Lemma 
\ref{lemma-Schlessinger-prorepresentability}. It follows from Lemma 
\ref{lemma-groupoid-in-functors-prorep-equivalences} (2) that $(U,R,s,t,c)$ is 
prorepresentable.
\end{proof}

\begin{theorem}
\label{theorem-presentation-deformation-groupoid}
Let $\mathcal F$ be a category cofibered in groupoids over $\mathcal 
C_{\Lambda}$.  Then $\mathcal F$ admits a presentation by a minimal smooth 
prorepresentable groupoid in functors on $\mathcal C_{\Lambda}$ if and only if 
the following conditions hold:
\begin{enumerate}
\item $\mathcal F$ is a deformation category.
\item $\dim_k T\mathcal F$ is finite.
\item $\dim_k \textnormal{Inf}_{x_0}(\mathcal F)$ is finite for some (and hence 
all) $x_0 \in \textnormal{Ob}(\mathcal F(k))$.
\end{enumerate}
\end{theorem}

\begin{proof}
If $\mathcal F$ is equivalent to a smooth prorepresentable groupoid in 
functors, then conditions (1)-(3) follow from Lemma 
\ref{lemma-deformation-groupoid-quotient} (1)-(3).  Conversely, assume 
conditions (1)-(3) hold. Then by Theorem 
\ref{theorem-miniversal-object-existence} there exists a prorepresentable 
functor $U: \mathcal C_{\Lambda} \rightarrow \textnormal{(Sets)}$ and a minimal 
smooth morphism $f: U \rightarrow \mathcal F$.  By Lemmas 
\ref{lemma-smooth-groupoid-in-functors-construction}, 
\ref{lemma-minimal-groupoid-in-functors-construction}, and 
\ref{lemma-prorepresentable-groupoid-in-functors-construction}, the 
construction of Lemma \ref{lemma-presentation-construction} applied to $f: U 
\rightarrow \mathcal F$ gives a minimal smooth prorepresentable groupoid in 
functors $(U,R,s,t,c)$. By Lemma 
\ref{lemma-smooth-groupoid-in-functors-construction}, the morphism $[f]: [U/R] 
\rightarrow \mathcal F$ of Lemma \ref{lemma-presentation-morphism} is an 
equivalence.  This is the desired presentation of $\mathcal F$.
\end{proof}




\section{The Deformation Category of a Point of an Algebraic Stack} 
\label{section-algebraic-stacks}

\noindent
To do: Show that an algebraic stack of finite type over a locally Noetherian
base satisfies (RS) at any finite type point (this may have to go in a later
chapter). This will provide some motivation for Artin's criteria later.
A perhaps more roundabout  way of showing this (which does give more
information, though) is to show that a groupoid presentation of the stack
gives rise to a presentation of the deformation category at any point.




\section{Examples}
\label{section-examples}

\noindent
List of things that should go here:
\begin{enumerate}
\item Describe the general outline of an example.
\item Deformations of schemes:
\begin{enumerate}
\item The Rim-Schlessinger condition.
\item Computing the tangent space.
\item Computing the infinitesimal deformations.
\item The deformation category of an affine hypersurface.
\end{enumerate}
\item Deformations of representations of abstract groups.
\item Deformations of representations of topological groups
(e.g., profinite ones).
\item Deformations of sheaves (for example fix $X/S$, a finite type point
$s$ of $S$, and a quasi-coherent sheaf $\mathcal{F}_s$ over $X_s$).
\item Deformations of algebraic spaces (very similar to deformations
of schemes; maybe even easier?).
\item Deformations of maps (eg morphisms between schemes; you can fix
both or one of the target and/or source).
\item Add more here.
\end{enumerate}


\input{chapters}

\bibliography{my}
\bibliographystyle{amsalpha}

\end{document}
