\input{preamble}


% OK, start here.
%
\begin{document}

\title{Formal Deformation Theory; UNDER CONSTRUCTION}


\maketitle

\phantomsection
\label{section-phantom}

\tableofcontents



\section{Introduction}
\label{section-introduction}

\noindent
Following Rim \cite[Exposee VI]{SGA7-I} and Schlessinger \cite{Sch}, we 
study formal deformation theory. Let $\Lambda$ be a complete Noetherian local 
ring with residue field $k$, and let $\mathcal{C}_\Lambda$ denote the category 
of Artinian local $\Lambda$-algebras with residue field $k$.  Given a functor 
$F: \mathcal{C}_\Lambda \to \textit{Sets}$ such that $F(k)$ is a 
one element set, Schlessinger \cite{Sch} introduced conditions 
(H1)-(H4) such that: 
\begin{enumerate}
\item $F$ has a ``hull'' if and only if (H1)-(H3) hold.
\item $F$ is prorepresentable if and only (H1)-(H4) hold.
\end{enumerate} 
The purpose of this document is to generalize these results to the case where 
the functor $F$ is replaced by a category $\mathcal{F}$ cofibered in groupoids 
over $\mathcal{C}_\Lambda$.  The analogue of the condition that $F(k)$ is a 
one element set is that $\mathcal{F}(k)$ is the trivial groupoid. If
$\mathcal{F}$ satisfies this condition then we say it is a predeformation
category, but in  general we do not make this assumption.  Rim's paper
\cite[Exposee VI]{SGA7-I} is the original 
source for the results in this document.  We also mention the useful paper 
\cite{Vistoli}, which discusses deformation theory with groupoids but in less 
generality than we do here.
  
\medskip \noindent
In
Section \ref{section-schlessinger-conditions},
we define conditions (S1) and (S2) 
on $\mathcal{F}$ generalizing Schlessinger's (H1) and (H2).  The analogue of 
Schlessinger's (H3)---the condition that $\mathcal{F}$ has finite dimensional 
tangent space---is not given a name.  In this document a ``hull'' for $\mathcal 
F$ is called a miniversal formal object of $\mathcal{F}$ (Definition 
\ref{definition-miniversal-object}); it is equivalent to the data of a minimal 
smooth morphism from a prorepresentable functor to $\mathcal{F}$.  In this 
language, Theorem \ref{theorem-miniversal-object-existence} is the direct 
generalization of (1) above. It recovers Schlessinger's result in the case that 
$\mathcal{F}$ is a functor.

\medskip \noindent
In Section \ref{section-deformation-groupoids-presentations}, we define 
condition (RS) on $\mathcal{F}$ generalizing Schlessinger's (H4).  A deformation 
category is defined as a predeformation category satisfying (RS); it is the 
fundamental type of object on which we do deformation theory. The analogue of a 
prorepresentation of a functor is a presentation of $\mathcal{F}$ by a 
prorepresentable groupoid in functors on $\mathcal{C}_\Lambda$ (see 
Subsections \ref{subsection-groupoids-in-functors} and 
\ref{subsection-presentations}). This notion of a presentation takes into 
account the groupoid structure of the fibers of $\mathcal{F}$. Given a functor 
$U: \mathcal{C}_\Lambda \to \textit{Sets}$ and a morphism $U 
\to \mathcal{F}$, a general procedure produces a groupoid in functors on 
$\mathcal{C}_\Lambda$ (Lemma \ref{lemma-presentation-construction}).  If 
$\mathcal{F}$ is a deformation category with finite dimensional tangent space, 
the generalization of (1) above (Theorem 
\ref{theorem-miniversal-object-existence}) produces such a morphism $U 
\to \mathcal{F}$.  The resulting groupoid in functors on $\mathcal 
C_\Lambda$ is minimal, smooth, and, assuming $\mathcal{F}$ has a finite 
dimensional infinitesimal automorphism space, prorepresentable. In Theorem 
\ref{theorem-presentation-deformation-groupoid} we prove that $\mathcal{F}$ has 
a presentation by the resulting groupoid in functors, and, conversely, that if 
$\mathcal{F}$ has presentation by a minimal smooth prorepresentable groupoid in 
functors, then it is a deformation category with finite dimensional tangent and 
infinitesimal automorphism spaces. This is the generalization of (2) above. It 
reduces to Schlessinger's result in the case that $\mathcal{F}$ is a functor.

\medskip \noindent
The generalization of Schlessinger's results to categories cofibered in 
groupoids provides a natural setting for the deformation theory of algebraic 
stacks.  In Section \ref{section-algebraic-stacks}, we discuss how to pass from 
a point of an algebraic stack to a category cofibered in groupoids over 
$\mathcal{C}_\Lambda$ satisfying (RS).

\medskip \noindent
We also find the following conceptual explanation for Schlessinger's 
conditions.  If $\mathcal{F}$ satisfies (RS), then the associated functor of 
isomorphism classes $\overline{\mathcal{F}}: \mathcal{C}_\Lambda \to 
\textit{Sets}$ satisfies (H1) and (H2) (Lemmas 
\ref{lemma-RS-implies-S1-S2} and \ref{lemma-S1-S2-associated-functor}).  
Conversely, if a functor $F: \mathcal{C}_\Lambda \to 
\textit{Sets}$ arises naturally as the functor of isomorphism classes of 
a category $\mathcal{F}$ cofibered in groupoids, then it seems to happen in 
practice that an argument showing $F$ satisfies (H1) and (H2) will also show 
$\mathcal{F}$ satisfies (RS) (see Section \ref{section-examples} for examples).  
Moreover, if $\mathcal{F}$ satisfies (RS), then condition (H4) for 
$\overline{\mathcal{F}}$ has a simple interpretation in terms of extending 
automorphisms of objects of $\mathcal{F}$ (Lemma 
\ref{lemma-RS-associated-functor}).  These observations suggest that (RS) 
should be regarded as the fundamental deformation theoretic gluing condition.




\section{Notation and Conventions}
\label{section-notations-conventions}

\noindent
A ring is commutative with $1$. The  maximal ideal of a local ring $A$
is denoted by $\mathfrak{m}_{A}$. The set of positive integers is denoted
by $\mathbf{N} = \{1, 2, 3, \dots\}$. If $U$ is an object of a
category $\mathcal{C}$, we denote by $\underline{U}$ 
the functor
$\text{Mor}_\mathcal{C}(U, -): \mathcal{C} \to \textit{Sets}$, see
Remarks \ref{remarks-cofibered-groupoids} (\ref{item-definition-yoneda}).
Warning: this may conflict with the notation in other chapters where sometimes
use $\underline{U}$ to denote $h_U(-) = \text{Mor}_\mathcal{C}(-, U)$.

\medskip\noindent
Throughout this chapter $\Lambda$ is a Noetherian ring and
$\Lambda \to k$ is a finite ring map from $\Lambda$ to a field.
The kernel of this map is denoted $\mathfrak m_\Lambda$ and the
image $k' \subset k$. It turns out that $\mathfrak m_\Lambda$ is
a maximal ideal, $k' = \Lambda/\mathfrak m_\Lambda$ is a field, and
the extension $k' \subset k$ is finite. See discussion surrounding
(\ref{equation-k-prime}).


\section{The category $\mathcal{C}_\Lambda$}
\label{section-CLambda}

\noindent
Motivation. An important application of formal deformation theory is
to criteria for representability by algebraic spaces. Suppose given a
locally Noetherian base change $S$ and a functor
$F : (\textit{Sch}/S)_{fppf}^{opp} \to \textit{Sets}$.
Let $k$ be a finite type field over $S$, i.e., we are given a
finite type morphism $\text{Spec}(k) \to S$.
One of Artin's criteria is that for any element $x \in F(\text{Spec}(k))$ 
the deformation functor associated to
the triple $(S, k, x)$ should be prorepresentable. By
Morphisms, Lemma \ref{morphisms-lemma-point-finite-type}
the condition that $k$ is of finite type over $S$ means that there exists
an affine open $\text{Spec}(\Lambda) \subset S$ such that $k$
is a finite $\Lambda$-algebra. This motivates why we work throughout
this chapter with a base category as follows.

\begin{definition}
\label{definition-CLambda}
Let $\Lambda$ be a Noetherian ring and let $\Lambda \to k$ be a finite
ring map where $k$ is a field. We define {\it $\mathcal{C}_\Lambda$} to be
the category with
\begin{enumerate}
\item objects are pairs $(A, \varphi)$ where $A$ is an Artinian local
$\Lambda$-algebra and where $\varphi : A/\mathfrak m_A \to k$ is a
$\Lambda$-algebra isomorphism, and
\item morphisms $f : (B, \psi) \to (A, \varphi)$ are local $\Lambda$-algebra
homomorphisms such that $\varphi \circ (f \bmod \mathfrak m) = \psi$.
\end{enumerate}
We say we are in the {\it classical case} if $\Lambda$ is a Noetherian
complete local ring and $k$ is its residue field.
\end{definition}

\noindent
Note that if $\Lambda \to k$ is surjective and if $A$ is an Artinian local
$\Lambda$-algebra, then the identification $\varphi$, if it exists,
is unique. Moreover, in this case any $\Lambda$-algebra map $A \to B$ is
going to be compatible with the identifications. Hence in this case
$\mathcal{C}_\Lambda$ is just the category of local Artinian $\Lambda$-algebras
whose residue field ``is'' $k$. By abuse of notation we also denote objects of
$\mathcal{C}_\Lambda$ simply $A$ in the general case. Moreover, we will
often write $A/\mathfrak m = k$, i.e., we will pretend all rings in
$\mathcal{C}_\Lambda$ have residue field $k$ (since all ring maps in
$\mathcal{C}_\Lambda$ are compatible with the given identifications this
should never cause any problems).
Throughout the rest of this chapter the base ring $\Lambda$ and the
field $k$ are fixed. The category $\mathcal{C}_\Lambda$ will be the base
category for the cofibered categories considered below.

\begin{definition}
\label{definition-small-extension}
Let $f: B \to A$ be a ring map in $\mathcal{C}_\Lambda$.  We say $f$ 
is a {\it small extension} if it is surjective and $\ker(f)$ is a nonzero 
principal ideal which is annihilated by $\mathfrak{m}_{B}$.
\end{definition}

\noindent 
By the following lemma we can often reduce arguments involving surjective ring 
maps in $\mathcal{C}_\Lambda$ to the case of small extensions.

\begin{lemma}
\label{lemma-factor-small-extension}
Let $f: B \to A$ be a surjective ring map in $\mathcal{C}_\Lambda$. 
Then $f$ can be factored as a composition of small extensions.
\end{lemma}

\begin{proof}
Let $I$ be the kernel of $f$.  The maximal ideal $\mathfrak{m}_{B}$ is 
nilpotent since $B$ is Artinian, say $\mathfrak{m}_{B}^n = 0$. Hence we get a 
factorization
\[ B = B/I\mathfrak{m}_B^{n-1} \to B/I\mathfrak{m}_B^{n-2} \to 
\cdots \to B/I \cong A \]
of $f$ into a composition of surjective maps whose kernels are annihilated by 
the maximal ideal.  Thus it suffices to prove the lemma when $f$ itself is such 
a map, i.e.\ when $I$ is annihilated by $\mathfrak{m}_B$. In this case
$I$ is a $k$-vector space, which has finite dimension, see
Algebra, Lemma \ref{algebra-lemma-artinian-finite-length}.
Take a basis $x_1, \dots, x_n$ of $I$ as a $k$-vector space to get a
factorization
$$
B \to B/(x_1) \to \cdots \to  B/(x_1, \dots, x_n) \cong  A
$$
of $f$ into a composition of small extensions.
\end{proof}

\noindent
The next lemma says that we can compute the length of a module over a local 
$\Lambda$-algebra with residue field $k$ in terms of the length over
$\Lambda$. To explain the notation in the statement, let $k' \subset k$
be the image of our fixed finite ring map $\Lambda \to k$. Note
that $k/k'$ is a finite extension of rings. Hence $k'$ is a field
and $k'/k$ is a finite extension, see
Algebra, Lemma \ref{algebra-lemma-integral-under-field}.
Moreover, as $\Lambda \to k'$ is surjective we see that its kernel
is a maximal ideal $\mathfrak m_\Lambda$. Thus
\begin{equation}
\label{equation-k-prime}
[k : k'] = [k : \Lambda/\mathfrak m_\Lambda] < \infty
\end{equation}
and in the classical case we have $k = k'$. The notation
$k' = \Lambda/\mathfrak m_\Lambda$ will be fixed throughout this chapter.

\begin{lemma}
\label{lemma-length}
Let $A$ be a local $\Lambda$-algebra with residue field $k$.
Let $M$ be an $A$-module. Then
$[k : k'] \text{length}_{A}(M) = \text{length}_\Lambda(M)$.
In the classical case we have
$\text{length}_{A}(M) = \text{length}_\Lambda(M)$.
\end{lemma}

\begin{proof}
If $M$ is a simple $A$-module then $M \cong k$ as an $A$-module, see
Algebra, Lemma \ref{algebra-lemma-characterize-length-1}.
In this case $\text{length}_A(M) = 1$ and
$\text{length}_\Lambda(M) = [k' : k]$, see
Algebra, Lemma \ref{algebra-lemma-dimension-is-length}.
If $\text{length}_A(M)$ is finite, then the result follows on
choosing a filtration of $M$ by $A$-submodules with simple quotients
using additivity, see
Algebra, Lemma \ref{algebra-lemma-length-additive}.
If $\text{length}_A(M)$ is infinite, the result follows from the obvious 
inequality $\text{length}_A(M) \leq \text{length}_\Lambda(M)$.
\end{proof}

\begin{lemma}
\label{lemma-surjective}
Let $A \to B$ be a ring map in $\mathcal{C}_\Lambda$.  
The following are equivalent
\begin{enumerate}
\item $f$ is surjective,
\item $\mathfrak m_A/\mathfrak m_A^2 \to \mathfrak m_B/\mathfrak m_B^2$
is surjective, and
\item $\mathfrak m_A/(\mathfrak m_\Lambda A + \mathfrak m_A^2)
\to \mathfrak m_B/(\mathfrak m_\Lambda B + \mathfrak m_B^2)$ is surjective.
\end{enumerate}
\end{lemma}

\begin{proof}
For any ring map $f : A \to B$ in $\mathcal{C}_\Lambda$ we have
$f(\mathfrak m_A) \subset \mathfrak m_B$ for example because
$\mathfrak m_A$, $\mathfrak m_B$ is the set of nilpotent elements of
$A$, $B$. Suppose $f$ is surjective. Let $y \in \mathfrak m_B$.
Choose $x \in A$ with $f(x) = y$. Since $f$ induces an isomorphism
$A/\mathfrak m_A \to B/\mathfrak m_B$ we see that $x \in \mathfrak m_A$.
Hence the induced map
$\mathfrak m_A/\mathfrak m_A^2 \to \mathfrak m_B/\mathfrak m_B^2$
is surjective. In this way we see that (1) implies (2).

\medskip\noindent
It is clear that (2) implies (3). The map $A \to B$ gives rise
to a canonical commutative diagram
$$
\xymatrix{
\mathfrak m_\Lambda/\mathfrak m_\Lambda^2 \otimes_{k'} k \ar[r] \ar[d] &
\mathfrak m_A/\mathfrak m_A^2 \ar[r] \ar[d] &
\mathfrak m_A/(\mathfrak m_\Lambda A + \mathfrak m_A^2) \ar[r] \ar[d] & 0 \\
\mathfrak m_\Lambda/\mathfrak m_\Lambda^2 \otimes_{k'} k \ar[r] &
\mathfrak m_B/\mathfrak m_B^2 \ar[r] &
\mathfrak m_B/(\mathfrak m_\Lambda B + \mathfrak m_B^2) \ar[r] & 0
}
$$
with exact rows. Hence if (3) holds, then so does (2).

\medskip\noindent
Assume (2). To show that $A \to B$ is surjective it suffices by
Nakayama's lemma (Algebra, Lemma \ref{algebra-lemma-NAK})
to show that $A/\mathfrak m_A \to B/\mathfrak m_AB$ is surjective.
(Note that $\mathfrak m_A$ is a nilpotent ideal.)
As $k = A/\mathfrak m_A = B/\mathfrak m_B$ it suffices to show that
$\mathfrak m_AB \to \mathfrak m_B$ is surjective. Applying
Nakayama's lemma once more we see that it suffces to see that
$\mathfrak m_AB/\mathfrak m_A\mathfrak m_B \to \mathfrak m_B/\mathfrak m_B^2$
is surjective which is what we assumed.
\end{proof}

\noindent
If $A \to B$ is a ring map in $\mathcal{C}_\Lambda$, then the map
$\mathfrak m_A/(\mathfrak m_\Lambda A + \mathfrak m_A^2)
\to \mathfrak m_B/(\mathfrak m_\Lambda B + \mathfrak m_B^2)$
is the map on relative cotangent spaces. Here is a formal definition.

\begin{definition}
\label{definition-tangent-space-ring}
Let $R \to S$ be a local homomorphism of local rings. The
{\it relative cotangent space} of $R$ over $S$ is the
$S/\mathfrak m_S$-vector space
$\mathfrak m_S/(\mathfrak m_R S + \mathfrak m_S^2)$.
Similarly, the {\it relative tangent space} is the dual vector
space $\text{Hom}_{S/\mathfrak m_S}(
\mathfrak m_S/(\mathfrak m_R S + \mathfrak m_S^2), S/\mathfrak m_S)$.
The relative tangent space is sometimes denoted $T_{S/R}$.
\end{definition}

\noindent
If $f_1: A_1 \to A$ and $f_2: A_2 \to A$ are two ring maps, then the fiber
product $A_1 \times_A A_2$ is the subring of $A_1 \times A_2$ consisting of
elements whose two projections to $A$ are equal. Throughout this chapter we
will be considering conditions involving such a fiber product when $f_1$
and $f_2$ are in $\mathcal{C}_\Lambda$. It isn't always the case that the
fibre product is an object of $\mathcal{C}_\Lambda$.

\begin{example}
\label{example-fibre-product}
Let $p$ be a prime number and let $n \in \mathbf{N}$.
Let $\Lambda = \mathbf{F}_p(t_1, t_2, \ldots, t_n)$ and let
$k = \mathbf{F}_p(x_1, \ldots, x_n)$ with map $\Lambda \to k$ given
by $t_i \mapsto x_i^p$. Let $A = k[\epsilon] = k[x]/(x^2)$.
Then $A$ is an object of $\mathcal{C}_\Lambda$. Suppose that
$D : k \to k$ is a derivation of $k$ over $\Lambda$, for example
$D = \partial/\partial x_i$. Then the map
$$
f_D : k \longrightarrow k[\epsilon],\quad
a \mapsto a + D(a)\epsilon
$$
is a morphism of $\mathcal{C}_\Lambda$. Set $A_1 = A_2 = k$ and set
$f_1 = f_{\partial/\partial x_1}$ and $f_2(a) = a$. Then
$A_1 \times_A A_2 = \{a \in k \mid \partial/\partial x_1(a) = 0\}$
which does not surject onto $k$. Hence the fibre product isn't
an object of $\mathcal{C}_\Lambda$.
\end{example}

\noindent
It turns out that this problem can only occur if the residue field
extension $k' \subset k$ (\ref{equation-k-prime}) is inseparable
and neither $f_1$ nor $f_2$ is surjective.

\begin{lemma}
\label{lemma-fiber-product-CLambda}
Let $f_1 : A_1 \to A$ and $f_2 : A_2 \to A$ be ring maps in 
$\mathcal{C}_\Lambda$. Then:
\begin{enumerate}
\item If $f_1$ or $f_2$ is surjective, then
$A_1 \times_A A_2$ is in $\mathcal{C}_\Lambda$.
\item If $f_2$ is a small extension, then so is
$A_1 \times_A A_2 \to A_1$.
\item If the field extension $k' \subset k$ is separable, then
$A_1 \times_A A_2$ is in $\mathcal{C}_\Lambda$.
\end{enumerate}
\end{lemma}

\begin{proof}
The ring $A_1 \times_A A_2$ is a $\Lambda$-algebra via  the map
$\Lambda \to A_1 \times_A A_2$ induced by the maps
$\Lambda \to A_1$ and $\Lambda \to A_2$. It is a local ring with unique
maximal ideal
$$
\mathfrak m_{A_1} \times_{\mathfrak m_A} \mathfrak m_{A_2} =
\text{Ker}(A_1 \times_A A_2 \longrightarrow k)
$$
A ring is Artinian if and only if it has finite length as a module
over itself, see
Algebra, Lemma \ref{algebra-lemma-artinian-finite-length}.
Since $A_1$ and $A_2$ are Artinian, Lemma \ref{lemma-length} implies 
$\text{length}_\Lambda(A_1)$ and $\text{length}_\Lambda(A_2)$, 
and hence $\text{length}_\Lambda(A_1 \times A_2)$, are all finite.  As 
$A_1 \times_A A_2 \subset A_1 \times A_2$ is a $\Lambda$-submodule, this 
implies
$\text{length}_{A_1 \times_A A_2}(A_1 \times_A A_2) \leq
\text{length}_\Lambda(A_1 \times_A A_2)$ is finite. So $A_1 
\times_{A} A_2$ is Artinian. Thus the only thing that is keeping
$A_1 \times_A A_2$ from being an object of $\mathcal{C}_\Lambda$ is
the possibility that its residue field maps to a proper subfield of $k$
via the map $A_1 \times_A A_2 \to A \to A/\mathfrak m_A = k$ above.

\medskip \noindent
Proof of (1). If $f_2$ is surjective, then the projection
$A_1 \times_A A_2 \to A_1$ is surjective. Hence the composition
$A_1 \times_A A_2 \to A_1 \to A_1/\mathfrak m_{A_1} = k$ is surjective
and we conclude that $A_1 \times_A A_2$ is an object of $\mathcal{C}_\Lambda$.

\medskip\noindent
Proof of (2). If $f_2$ is a small extension then $A_2 \to A$ and
$A_1 \times_A A_2  \to A_1$ are both surjective with the same kernel.
Hence the kernel of $A_1 \times_A A_2  \to A_1$ is a $1$-dimensional
$k$-vector space and we see that $A_1 \times_A A_2  \to A_1$ is a small
extension.

\medskip\noindent
Proof of (3). Choose $\overline{x} \in k$ such that
$k = k'(\overline{x})$ (see
Algebra, Lemma \ref{algebra-lemma-finite-separable}).
Let $P'(T) \in k'[T]$ be the minimal polynomial of $\overline{x}$ over $k'$.
Since $k/k'$ is separable we see that
$\text{d}P/\text{d}T(\overline{x}) \not = 0$.
Choose a monic $P \in \Lambda[T]$ which maps to $P'$ under the surjective map
$\Lambda[T] \to k'[T]$. Because $A, A_1, A_2$ are henselian, see
Algebra, Lemma \ref{algebra-lemma-local-dimension-zero-henselian},
we can find $x, x_1, x_2 \in A, A_1, A_2$ with $P(x) = 0, P(x_1) = 0,
P(x_2) = 0$ and such that the image of $x, x_1, x_2$ in $k$ is $\overline{x}$.
Then $(x_1, x_2) \in A_1 \times_A A_2$ because $x_1, x_2$
map to $x \in A$ by uniqueness, see
Algebra, Lemma \ref{algebra-lemma-uniqueness}.
Hence the residue field of
$A_1 \times_A A_2$ contains a generator of $k$ over $k'$ and we win.
\end{proof}

\noindent
Next we define essential surjections in $\mathcal{C}_\Lambda$. A necessary 
and sufficient condition for a surjection in $\mathcal{C}_\Lambda$ to be 
essential is given in Lemma \ref{lemma-essential-surjection}.

\begin{definition}
\label{definition-essential-surjection}
Let $f: B \to A$ be a ring map in $\mathcal{C}_\Lambda$.  We say $f$ 
is an {\it essential surjection} if it has the following properties:
\begin{enumerate}
\item $f$ is surjective.
\item If $g: C \to B$ is a ring map in $\mathcal{C}_\Lambda$ such that 
$f \circ g$ is surjective, then $g$ is surjective.
\end{enumerate}
\end{definition}

\noindent
Using Lemma \ref{lemma-surjective}, we can characterize
essential surjections in $\mathcal{C}_\Lambda$ as follows.

\begin{lemma}
\label{lemma-essential-surjection-mod-squares}
Let $f: B \to A$ be a ring map in $\mathcal{C}_\Lambda$.
The following are equivalent
\begin{enumerate}
\item $f$ is an essential surjection,
\item the map $B/\mathfrak m_B^2 \to A/\mathfrak m_A^2$ is an essential
surjection, and
\item the map
$B/(\mathfrak m_\Lambda B + \mathfrak m_B^2) \to
A/(\mathfrak m_\Lambda A + \mathfrak m_A^2)$ is an essential surjection.
\end{enumerate}
\end{lemma}

\begin{proof}
Assume (3). Let $C \to B$ be a ring map in $\mathcal{C}_\Lambda$ such
that $C \to A$ is surjective. Then
$C \to A/(\mathfrak m_\Lambda A + \mathfrak m_A^2)$ is surjective
too. We conclude that $C \to B/(\mathfrak m_\Lambda B + \mathfrak m_B^2)$
is surjective by our assumption. Hence $C \to B$ is surjective by applying
Lemma \ref{lemma-surjective} (2 times).

\medskip\noindent
Assume (1). Let $C \to B/(\mathfrak m_\Lambda B + \mathfrak m_B^2)$
be a morphism of $\mathcal{C}_\Lambda$ such that
$C \to A/(\mathfrak m_\Lambda A + \mathfrak m_A^2)$ is surjective. Set
$C' = C \times_{B/(\mathfrak m_\Lambda B + \mathfrak m_B^2)} B$
which is an object of $\mathcal{C}_\Lambda$ by
Lemma \ref{lemma-fiber-product-CLambda}.
Note that $C' \to A/(\mathfrak m_\Lambda A + \mathfrak m_A^2)$
is still surjective, hence $C' \to A$ is surjective by
Lemma \ref{lemma-surjective}.
Thus $C' \to B$ is surjective by our assumption. This implies
that $C' \to B/(\mathfrak m_\Lambda B + \mathfrak m_B^2)$ is
surjective, which implies by the construction of $C'$ that
$C \to B/(\mathfrak m_\Lambda B + \mathfrak m_B^2)$ is surjective.

\medskip\noindent
In the first paragraph we proved (3) $\Rightarrow$ (1) and in the second
paragraph we proved (1) $\Rightarrow$ (3). The equivalence of
(2) and (3) is a special case of the equivalence of (1) and (3), hence
we are done.
\end{proof}

\noindent
To analyze essential surjections in $\mathcal{C}_\Lambda$ a bit more
we introduce some notation. Suppose that $A$ is an object
of $\mathcal{C}_\Lambda$. There is a canonical exact sequence
\begin{equation}
\label{equation-sequence}
\mathfrak m_A/\mathfrak m_A^2 \xrightarrow{\text{d}_A}
\Omega_{A/\Lambda} \otimes_A k \to
\Omega_{k/\Lambda} \to 0
\end{equation}
see
Algebra, Lemma \ref{algebra-lemma-differential-seq}.
Note that $\Omega_{k/\Lambda} = \Omega_{k/k'}$ with $k'$ as
in (\ref{equation-k-prime}). Choose a presentation
$\alpha : \Lambda[x_1, \ldots, x_n] \to k$
of $k$ over $\Lambda$. Let $H_1(L_{k/\Lambda}) = H^{-1}(NL(\alpha))$
be the first homology module of the naive cotangent complex of $k$
over $\Lambda$. Then we can extend (\ref{equation-sequence})
to the exact sequence
\begin{equation}
\label{equation-sequence-extended}
H_1(L_{k/\Lambda}) \to
\mathfrak m_A/\mathfrak m_A^2 \xrightarrow{\text{d}_A}
\Omega_{A/\Lambda} \otimes_A k \to
\Omega_{k/\Lambda} \to 0,
\end{equation}
see
Algebra, Lemma \ref{algebra-lemma-exact-sequence-NL}.
If $B \to A$ is a ring map in $\mathcal{C}_\Lambda$ then we obtain a
commutative diagram
\begin{equation}
\label{equation-sequence-functorial}
\vcenter{
\xymatrix{
H_1(L_{k/\Lambda}) \ar[r] \ar@{=}[d] &
\mathfrak m_B/\mathfrak m_B^2 \ar[r]_{\text{d}_B} \ar[d] &
\Omega_{B/\Lambda} \otimes_B k \ar[r] \ar[d] &
\Omega_{k/\Lambda} \ar[r] \ar@{=}[d] & 0 \\
H_1(L_{k/\Lambda}) \ar[r] &
\mathfrak m_A/\mathfrak m_A^2 \ar[r]^{\text{d}_A} &
\Omega_{A/\Lambda} \otimes_A k \ar[r] &
\Omega_{k/\Lambda} \ar[r] & 0
}
}
\end{equation}
with exact rows.

\begin{lemma}
\label{lemma-H1-separable-case}
There is a canonical map
$$
\mathfrak m_\Lambda/\mathfrak m_\Lambda^2 \longrightarrow H_1(L_{k/\Lambda}).
$$
If $k' \subset k$ is separable (for example if the characteristic
of $k$ is zero), then this map induces an isomorphism
$\mathfrak m_\Lambda/\mathfrak m_\Lambda^2 \otimes_{k'} k = H_1(L_{k/\Lambda})$.
If $k = k'$ (for example in the classical case), then
$\mathfrak m_\Lambda/\mathfrak m_\Lambda^2 = H_1(L_{k/\Lambda})$.
The composition
$$
\mathfrak m_\Lambda/\mathfrak m_\Lambda^2 \longrightarrow
H_1(L_{k/\Lambda}) \longrightarrow \mathfrak m_A/\mathfrak m_A^2
$$
comes from the canonical map $\mathfrak m_\Lambda \to \mathfrak m_A$.
\end{lemma}

\begin{proof}
Note that $H_1(L_{k'/\Lambda}) = \mathfrak m_\Lambda/\mathfrak m_\Lambda^2$
as $\Lambda \to k'$ is surjective with kernel $\mathfrak m_\Lambda$.
The map arises from functoriality of the naive cotangent complex.
If $k' \subset k$ is separable, then $k' \to k$ is an \'etale ring map, see
Algebra, Lemma \ref{algebra-lemma-etale-over-field}.
Thus its naive cotangent complex has trivial homology groups, see
Algebra, Definition \ref{algebra-definition-etale}.
Then
Algebra, Lemma \ref{algebra-lemma-exact-sequence-NL}
applied to the ring maps $\Lambda \to k' \to k$ implies that
$\mathfrak m_\Lambda/\mathfrak m_\Lambda^2 \otimes_{k'} k = H_1(L_{k/\Lambda})$.
We omit the proof of the final statement.
\end{proof}

\begin{lemma}
\label{lemma-essential-surjection}
Let $f: B \to A$ be a ring map in $\mathcal{C}_\Lambda$.
Notation as in (\ref{equation-sequence-functorial}).
\begin{enumerate}
\item The equivalent conditions of
Lemma \ref{lemma-essential-surjection-mod-squares}
characterizing when $f$ is surjective are also equivalent to
\begin{enumerate}
\item $\text{Im}(\text{d}_B) \to \text{Im}(\text{d}_A)$ is surjective, and
\item the map $\Omega_{B/\Lambda} \otimes_B k \to
\Omega_{A/\Lambda} \otimes_A k$ is surjective.
\end{enumerate}
\item The following are equivalent
\begin{enumerate}
\item $f$ is an essential surjection,
\item the map $\text{Im}(\text{d}_B) \to \text{Im}(\text{d}_A)$ is an
isomorphism, and
\item the map $\Omega_{B/\Lambda} \otimes_B k \to
\Omega_{A/\Lambda} \otimes_A k$ is an isomorphism.
\end{enumerate}
\item If $k/k'$ is separable, then $f$ is an essential surjection if
and only if the map
$\mathfrak m_B/(\mathfrak m_\Lambda B + \mathfrak m_B^2) \to
\mathfrak m_A/(\mathfrak m_\Lambda A + \mathfrak m_A^2)$
is an isomorphism.
\item If $f$ is a small extension, then $f$ is not essential if and only if
$f$ has a section $s: A \to B$ in $\mathcal{C}_\Lambda$
with $f \circ s = \text{id}_A$.
\end{enumerate}
\end{lemma}

\begin{proof}
Proof of (1). It follows from (\ref{equation-sequence-functorial})
that (1)(a) and (1)(b) are equivalent. Also, if
$A \to B$ is surjective, then (1)(a) and (1)(b) hold. Assume (1)(a).
Since the kernel of $\text{d}_A$ is the image of
$H_1(L_{k/\Lambda})$ which also maps to
$\mathfrak m_B/\mathfrak m_B^2$ we conclude that
$\mathfrak m_B/\mathfrak m_B^2 \to \mathfrak m_A/\mathfrak m_A^2$
is surjective. Hence $B \to A$ is surjective by
Lemma \ref{lemma-surjective}. This finishes the proof of (1).

\medskip\noindent
Proof of (2). The equivalence of (2)(b) and (2)(c) is immediate from
(\ref{equation-sequence-functorial}).

\medskip\noindent
Assume (2)(b). Let $g : C \to B$ be a ring map in $\mathcal{C}_\Lambda$
such that $f \circ g$ is surjective. We conclude that
$\mathfrak m_C/\mathfrak m_C^2 \to \mathfrak m_A/\mathfrak m_A^2$
is surjective by
Lemma \ref{lemma-surjective}.
Hence
$\text{Im}(\text{d}_C) \to \text{Im}(\text{d}_A)$ is surjective
and by the assumption we see that
$\text{Im}(\text{d}_C) \to \text{Im}(\text{d}_B)$ is surjective.
It follows that $C \to B$ is surjective by (1).

\medskip\noindent
Assume (2)(a). Then $f$ is surjective and we see that
$\Omega_{B/\Lambda} \otimes_B k \to \Omega_{A/\Lambda} \otimes_A k$
is surjective. Let $K$ be the kernel. Note that
$K = \text{d}_B(\text{Ker}(\mathfrak m_B/\mathfrak m_B^2 \to
\mathfrak m_A/\mathfrak m_A^2))$ by (\ref{equation-sequence-functorial}).
Choose a splitting
$$
\Omega_{B/\Lambda} \otimes_B k =
\Omega_{A/\Lambda} \otimes_A k \oplus K
$$
of $k$-vector space. The map $\text{d} : B \to \Omega_{B/\Lambda}$
induces via the projection onto $K$ a map $D : B \to K$. Set
$C = \{b \in B \mid D(b) = 0\}$. The Leibniz rule shows that this is
a $\Lambda$-subalgebra of $B$. Let $\overline{x} \in k$. Choose $x \in B$
mapping to $\overline{x}$. If $D(x) \not = 0$, then we can find an element
$y \in \mathfrak m_B$ such that $D(y) = D(x)$. Hence $x - y \in C$ is
an element which maps to $\overline{x}$. Thus $C \to k$ is surjective
and $C$ is an object of $\mathcal{C}_\Lambda$. Similarly, pick
$\omega \in \text{Im}(\text{d}_A)$. We can find $x \in \mathfrak m_B$
such that $\text{d}_B(x)$ maps to $\omega$ by (1). If $D(x) \not = 0$, then
we can find an element $y \in \mathfrak m_B$ which maps to zero
in $\mathfrak m_A/\mathfrak m_A^2$ such that $D(y) = D(x)$.
Hence $z = x - y$ is an element of $\mathfrak m_C$ whose
image $\text{d}_C(z) \in \Omega_{C/k} \otimes_C k$ maps to $\omega$.
Hence $\text{Im}(\text{d}_C) \to \text{Im}(\text{d}_A)$ is surjective.
We conclude that $C \to A$ is surjective by (1). Hence $C \to B$ is
surjective by assumption. Hence $D = 0$, i.e., $K = 0$, i.e., (2)(c) holds.
This finishes the proof of (2).

\medskip \noindent
Proof of (3). If $k'/k$ is separable, then
$H_1(L_{k/\Lambda}) =
\mathfrak m_\Lambda/\mathfrak m_\Lambda^2 \otimes_{k'} k$, see
Lemma \ref{lemma-H1-separable-case}.
Hence $\text{Im}(\text{d}_A) =
\mathfrak m_A/(\mathfrak m_\Lambda A + \mathfrak m_A^2)$
and similarly for $B$. Thus (3) follows from (2).

\medskip\noindent
Proof of (4). A section $s$ of $f$ is not surjective (by definition a
small extension has nontrivial kernel), hence $f$ is not essentially
surjective. Conversely, assume $f$ is a small surjection but not an
essential surjection. Choose a ring map $C \to B$ in $\mathcal{C}_\Lambda$
which is not surjective, such that $C \to A$ is surjective. Let
$C' \subset B$ be the image of $C \to B$. Then $C' \not = B$ but
$C'$ surjects onto $A$. Since $f : B \to A$ is a small extension, 
$\text{length}_C(B) = \text{length}_C(A) + 1$. Thus 
$\text{length}_C(C') \leq \text{length}_C(A)$ since 
$C'$ is a proper subring of $B$. But $C' \to A$ is surjective, so in
fact we must have $\text{length}_C(C') = \text{length}_C(A)$ and
$C' \to A$ is an isomorphism which gives us our section.
\end{proof}

\begin{example}
\label{example-essential-surjection}
Let $\Lambda = k[[x]]$ be the power series ring in $1$ variable over $k$.
Set $A = k$ and $B = \Lambda/(x^2)$. Then $B \to A$ is an essential
surjection by
Lemma \ref{lemma-essential-surjection}
because it is a small extension and the map $B \to A$ does not have a
right inverse (in the category $\mathcal{C}_\Lambda$). But the map
$$
k \cong \mathfrak m_B/\mathfrak m_B^2
\longrightarrow
\mathfrak m_A/\mathfrak m_A^2 = 0
$$
is not an isomorphism. Thus in
Lemma \ref{lemma-essential-surjection} (3)
it is necessary to consider the map of relative cotangent spaces
$\mathfrak m_B/(\mathfrak m_\Lambda B + \mathfrak m_B^2) \to
\mathfrak m_A/(\mathfrak m_\Lambda A + \mathfrak m_A^2)$.
\end{example}







\section{The category $\widehat{\mathcal{C}}_\Lambda$}
\label{section-category-completion-CLambda}

\noindent
The following ``completion'' of the category $\mathcal{C}_\Lambda$ will serve 
as the base category of the completion of a category cofibered in groupoids 
over $\mathcal{C}_\Lambda$
(Section \ref{section-formal-objects}).

\begin{definition}
\label{definition-completion-CLambda}
Let $\Lambda$ be a Noetherian ring and let $\Lambda \to k$ be a finite
ring map where $k$ is a field. We define {\it $\widehat{\mathcal{C}}_\Lambda$}
to be the category with
\begin{enumerate}
\item objects are pairs $(R, \varphi)$ where $R$ is a Noetherian complete
local $\Lambda$-algebra and where $\varphi : R/\mathfrak m_R \to k$ is a
$\Lambda$-algebra isomorphism, and
\item morphisms $f : (S, \psi) \to (R, \varphi)$ are local $\Lambda$-algebra
homomorphisms such that $\varphi \circ (f \bmod \mathfrak m) = \psi$.
\end{enumerate}
\end{definition}

\noindent
As in the discussion following
Definition \ref{definition-CLambda}
we will usually denote an object of $\widehat{\mathcal{C}}_\Lambda$
simply $R$, with the identification $R/\mathfrak m_R = k$ understood.
In this section we discuss some basic properties of objects and morphisms
of the category $\widehat{\mathcal{C}}_\Lambda$ paralleling our discussion of
the category $\mathcal{C}_\Lambda$ in the previous section.

\medskip\noindent
Our first observation is that any object $A \in \mathcal{C}_\Lambda$
is an object of $\widehat{\mathcal{C}}_\Lambda$ as an Artinian local
ring is always Noetherian and complete with respect to its maximal ideal
(which is after all a nilpotent ideal). Moreover, it is clear from the
definitions that
$\mathcal{C}_\Lambda \subset \widehat{\mathcal{C}}_\Lambda$
is the strictly full subcategory consisting of all Artinian rings.
As it turns out, conversely every object of
$\widehat{\mathcal{C}}_\Lambda$ is a limit of objects of
$\mathcal{C}_\Lambda$.

\medskip\noindent
Suppose that $R$ is an object of $\widehat{\mathcal{C}}_\Lambda$.
Consider the rings $R_n = R/\mathfrak m_R^n$ for $n \in \mathbf{N}$.
These are Noetherian local rings with a unique nilpotent prime ideal, hence
Artinian, see
Algebra, Proposition \ref{algebra-proposition-dimension-zero-ring}.
The ring maps
$$
\ldots \to R_{n + 1} \to R_n \to \ldots \to R_2 \to R_1 = k
$$
are all surjective. Completeness of $R$ by definition means
that $R = \lim R_n$. If $f : R \to S$ is a ring map in
$\widehat{\mathcal{C}}_\Lambda$ then we obtain a system of ring maps
$f_n : R_n \to S_n$ whose limit is the given map.

\begin{lemma}
\label{lemma-surjective-cotangent-space}
Let $f: R \to S$ be a ring map in $\widehat{\mathcal{C}}_\Lambda$.
The following are equivalent
\begin{enumerate}
\item $f$ is surjective,
\item the map
$\mathfrak m_R/\mathfrak m_R^2 \to \mathfrak m_S/\mathfrak m_S^2$
is surjective, and
\item the map
$\mathfrak m_R/(\mathfrak m_\Lambda R + \mathfrak m_R^2) \to
\mathfrak m_S/(\mathfrak m_\Lambda S + \mathfrak m_S^2)$
is surjective.
\end{enumerate}
\end{lemma}

\begin{proof}
Note that for $n \geq 2$ we have the equality of relative cotangent spaces
$$
\mathfrak m_R/(\mathfrak m_\Lambda R + \mathfrak m_R^2)
=
\mathfrak m_{R_n}/(\mathfrak m_\Lambda R_n + \mathfrak m_{R_n}^2)
$$
and similarly for $S$. Hence by
Lemma \ref{lemma-surjective}
we see that $R_n \to S_n$ is surjective for all $n$.
Now let $K_n$ be the kernel of $R_n \to S_n$.  Then the sequences 
$$
0 \to K_n \to R_n \to S_n \to 0
$$
form an exact sequence of directed inverse systems. The system $(K_n)$ is 
Mittag-Leffler since each $K_n$ is Artinian. Hence by
Algebra, Lemma \ref{algebra-lemma-ML-exact-sequence}
taking limits preserves exactness. So
$\lim R_n \to \lim S_n$ is surjective, i.e., $f$ is surjective.
\end{proof}

\noindent
We will not need the following lemma.

\begin{lemma}
\label{lemma-CLambdahat-coproducts}
The category $\widehat{\mathcal{C}}_\Lambda$ admits coproducts
of pairs of objects.
\end{lemma}

\begin{proof}
Let $R$ and $S$ be objects of $\widehat{\mathcal{C}}_\Lambda$.
Consider the ring $C = R \otimes_\Lambda S$. There is a canonical
surjective map $C \to R \otimes_\Lambda S \to k \otimes_\Lambda k \to k$
where the last map is the multiplication map. The kernel of
$C \to k$ is a maximal ideal $\mathfrak m$. Note that $\mathfrak m$
is generated by $\mathfrak m_R C$, $\mathfrak m_S C$ and finitely many
elements of $C$ which map to generators of the kernel of
$k \otimes_\Lambda k \to k$. Hence $\mathfrak m$ is a finitely
generated ideal. Set
$C^\wedge$ equal to the completion of $C$ with respect to $\mathfrak m$.
We conclude that $C^\wedge$ is a Noetherian ring complete with respect to
the maximal ideal $\mathfrak m^\wedge = \mathfrak mC^\wedge$, see
Algebra, Lemma \ref{algebra-lemma-completion-Noetherian}.
Hence $C^\wedge$ is an object of $\widehat{\mathcal{C}}_\Lambda$.
Then $R \to C^\wedge$ and $S \to C^\wedge$ turn $C^\wedge$
into a coproduct in $\widehat{\mathcal{C}}_\Lambda$ (details omitted).
\end{proof}

\noindent
An empty coproduct in a category is an initial object of the category.
In the classical case $\widehat{\mathcal{C}}_\Lambda$ has an initial
object, namely $\Lambda$ itself. More generally, if $k' = k$, then
the completion $\Lambda^\wedge$ of $\Lambda$ with respect to
$\mathfrak m_\Lambda$ is an initial object. More generally still, if
$k' \subset k$ is separable, then $\widehat{\mathcal{C}}_\Lambda$ has an
initial object too. Namely, choose a monic polynomial $P \in \Lambda[T]$
such that $k \cong k'[T]/(P')$ where $p' \in k'[T]$ is the image
of $P$. Then $R = \Lambda^\wedge[T]/(P)$ is an initial object, see proof of
Lemma \ref{lemma-fiber-product-CLambda}.

\medskip\noindent
If $R$ is an initial object as above, then we have
$\mathcal{C}_\Lambda = \mathcal{C}_R$ and
$\widehat{\mathcal{C}}_\Lambda = \widehat{\mathcal{C}}_R$ which effectively
brings the whole discussion in this chapter back to the classical case.
But, if $k' \subset k$ is inseparable, then an initial object does not
exist.



\section{Categories cofibered in groupoids}
\label{section-preliminary}

\noindent
In developing the theory we work with categories {\it cofibered} in groupoids. 
 We assume as known the definition and basic properties of categories 
{\it fibered} in groupoids, see
Categories, Section \ref{categories-section-fibred-groupoids}.

\begin{definition}
\label{definition-category-cofibred-groupoids}
Let $\mathcal{C}$ be a category.  A {\it category cofibered in groupoids over 
$\mathcal{C}$} is a category $\mathcal{F}$ equipped with a functor
$p: \mathcal{F} \to \mathcal{C}$ such that $\mathcal{F}^{opp}$ is a category 
fibered in groupoids over $\mathcal{C}^{opp}$ via
$p^{opp}: \mathcal{F}^{opp} \to \mathcal{C}^{opp}$.
\end{definition}

\noindent
Explicitly, $p: \mathcal{F} \to \mathcal{C}$ is cofibered in groupoids if 
the following two conditions hold:
\begin{enumerate}
\item For every morphism $f: U \to V$ in $\mathcal{C}$ and every object 
$x$ lying over $U$, there is a morphism $x \to y$ of $\mathcal{F}$ lying 
over $f$.
\item For every pair of morphisms $a: x \to y$ and $b: x \to z$ 
of $\mathcal{F}$ and any morphism $f: p(y) \to p(z)$ such that $p(b) = f 
\circ p(a)$, there exists a unique morphism $c: y \to z$ of $\mathcal 
F$ lying over $f$ such that $b = c \circ a$.
\end{enumerate}

\begin{remarks}
\label{remarks-cofibered-groupoids}
Everything about categories fibered in groupoids translates directly to the 
cofibered setting. The following remarks are meant to fix notation.
Let $\mathcal{C}$ be a category.
\begin{enumerate}
\item We often omit the functor $p: \mathcal{F} \to \mathcal{C}$ from the 
notation.
\item The fiber category over an object $U$ in $\mathcal{C}$ is denoted by 
$\mathcal{F}(U)$. Its objects are those of $\mathcal{F}$ lying over $U$ and its 
morphisms are those of $\mathcal{F}$ lying over $\text{id}_{U}$.
If $x,y$  are objects of $\mathcal{F}(U)$, we sometimes write
$\text{Mor}_{U}(x,y)$ for $\text{Mor}_{\mathcal{F}(U)}(x,y)$.
\item The fibre categories $\mathcal{F}(U)$ are groupoids, see
Categories, Lemma \ref{categories-lemma-fibred-groupoids}.
\item
\label{item-pushforward}
Let $\mathcal{F}$ be a category cofibered in groupoids over
$\mathcal{C}$, let $f: U \to V$ be a morphism in $\mathcal{C}$, and
let $x \in \text{Ob}(\mathcal{F}(U))$.
A {\it pushforward} of $x$ along $f$ is a morphism 
$x \to y$ of $\mathcal{F}$ lying over $f$. A pushforward
is unique up to unique isomorphism (see the discussion following
Categories, Definition \ref{categories-definition-cartesian-over-C}).
We sometimes write $x \to f_*x$ for ``the'' pushforward of $x$
along $f$.
\item A {\it choice of pushforwards for $\mathcal{F}$} is the choice of
a pushforward of $x$ along $f$ for every pair $(x,f)$ as above. We can make
such a choice of pushforwards for $\mathcal{F}$ by the axiom of choice.
\item Let $\mathcal{F}$ be a category cofibered in groupoids over
$\mathcal{C}$. Given a choice of pushforwards for $\mathcal{F}$, there
is an associated pseudo-functor $\mathcal{C} \to \textit{Groupoids}$.
We will never use this construction so we give no details.
\item
\label{item-cofibered-morphism}
A morphism of categories cofibered in groupoids over $\mathcal{C}$ is a
functor commuting with the projections to $\mathcal{C}$. If $\mathcal{F}$
and $\mathcal{F}'$ are categories cofibered in groupoids over
$\mathcal{C}$, we denote the morphisms from $\mathcal{F}$ to $\mathcal{F}'$
by $\text{Mor}_{\mathcal{C}}(\mathcal{F}, \mathcal{F}')$.
\item 
\label{item-definition-cofibered-groupoids-2-category}
Categories cofibered in groupoids form a $(2, 1)$-category 
$\text{Cof}(\mathcal{C})$. Its 1-morphisms are the morphisms described in 
(\ref{item-cofibered-morphism}). If $p: \mathcal{F} \to C$ and 
$p': \mathcal{F}' \to \mathcal{C}$ are categories cofibered in groupoids 
and $\varphi, \psi: \mathcal{F} \to \mathcal{F}'$ are $1$-morphisms, then 
a 2-morphism $t: \varphi \to \psi$ is a morphism of functors such that 
$p'(t_x) = \text{id}_{p(x)}$ for all $x \in \text{Ob}(\mathcal{F})$.
\item
\label{item-construction-associated-cofibered-groupoid} 
Let $F : \mathcal{C} \to \textit{Groupoids}$ be a functor. There 
is a category cofibered in groupoids $\mathcal{F} \to \mathcal{C}$ 
associated to $F$ as follows. An object of $\mathcal{F}$ is a pair $(U, x)$ 
where $U \in \text{Ob}(\mathcal{C})$ and $x \in \text{Ob}(F(U))$. A 
morphism $(U,x) \to (V,y)$ is a pair $(f, a)$ where
$f \in \text{Mor}_{\mathcal{C}}(U,V)$ and
$a \in \text{Mor}_{F(V)}(F(f)(x),y)$.
The functor $\mathcal{F} \to \mathcal{C}$ sends $(U, x)$ to $U$. See
Categories, Section \ref{categories-section-presheaves-groupoids}.
\item Let $\mathcal{F}$ be cofibered in groupoids over $\mathcal{C}$.
For $U \in \text{Ob}(\mathcal{C})$ set $\overline{F}(U)$ equal to
the set of isomorphisms classes of the category $\mathcal{F}(U)$.
If $f : U \to V$ is a morphism of $\mathcal{C}$, then we obtain a
map of sets $\overline{F}(U) \to \overline{F}(V)$ by mapping the
isomorphism class of $x$ to the isomorphism class of a pushforward
$f_*x$ of $x$ see (\ref{item-pushforward}). Then
$\overline{\mathcal{F}} : \mathcal{C} \to \textit{Sets}$ is a
functor. Similarly, if $\varphi: \mathcal{F} \to \mathcal{G}$ is a
morphism of cofibered categories, we denote by
$\overline{\varphi}: \overline{\mathcal{F}} \to  \overline{\mathcal{G}}$
the associated morphism of functors.
\item 
\label{item-convention-cofibered-sets}
Let $F: \mathcal{C} \to \textit{Sets}$ be a functor. We can think of a
set as a discrete category, i.e., as a groupoid with only identity morphisms.
Then the construction (\ref{item-construction-associated-cofibered-groupoid})
associates to $F$ a category cofibered in sets. This defines a fully
faithful embedding of the category of functors $\mathcal{C} \to \textit{Sets}$
to the category of categories cofibered in groupoids over $\mathcal{C}$.
We identify the category of functors with its image under this embedding.
Hence if $F : \mathcal{C} \to \textit{Sets}$ is a functor, we denote the 
associated category cofibered in sets also by $F$; and if
$\varphi : F \to G$ is a morphism of functors, we denote still by $\varphi$
the corresponding morphism of categories cofibered in sets, and vice-versa.
See Categories, Section \ref{categories-section-fibred-in-sets}.
\item 
\label{item-definition-yoneda}
Let $U$ be an object of $\mathcal{C}$.  We write $\underline{U}$ for the
functor 
$\text{Mor}_{\mathcal{C}}(U,-): \mathcal{C} \to 
\textit{Sets}$.  This defines a fully faithful embedding of $\mathcal 
C^{opp}$ into the category of functors $\mathcal{C} \to 
\textit{Sets}$. Hence, if $f: U \to V$ is a morphism, we are 
justified in denoting still by $f$ the induced morphism $\underline{V} 
\to \underline{U}$, and vice-versa.
\item
\label{item-fibre-product}
Fiber products of categories cofibered in groupoids: If $\mathcal{F} 
\to \mathcal{H}$ and $\mathcal{G} \to \mathcal{H}$ are morphisms 
of categories cofibered in groupoids over $\mathcal{C}_\Lambda$, then a 
construction of their 2-fiber product is given by the construction for their 
2-fiber product as categories over $\mathcal{C}_\Lambda$, as described in 
Categories, Lemma \ref{categories-lemma-2-product-categories-over-C}.
\item 
\label{item-definition-restricting-base-category}
Restricting the base category: Let $p : \mathcal{F} \to \mathcal{C}$ be a
category cofibered in groupoids, and let $\mathcal{C}'$ be a full
subcategory of $\mathcal{C}$. The restriction $\mathcal{F}|_{\mathcal{C}'}$
is the full subcategory of $\mathcal{F}$ whose objects lie over
objects of $\mathcal{C}'$. It is a category cofibered in groupoids via
the functor
$p|_{\mathcal{C}'}: \mathcal{F}|_{\mathcal{C}'} \to \mathcal{C}'$.
\end{enumerate}
\end{remarks}









\section{Prorepresentable functors and predeformation categories}
\label{section-cofibered-groupoids}

\noindent
Our basic goal is to understand categories cofibered in groupoids over
$\mathcal{C}_\Lambda$ and $\widehat{\mathcal{C}}_\Lambda$. Since
$\mathcal{C}_\Lambda$ is a full subcategory of
$\widehat{\mathcal{C}}_\Lambda$ we can restrict categories cofibred in
groupoids over $\widehat{\mathcal{C}}_\Lambda$ to $\mathcal{C}_\Lambda$, see
Remarks \ref{remarks-cofibered-groupoids}
(\ref{item-definition-restricting-base-category}).
In particular we can do this with functors, in particular with
representable functors. The functors on $\mathcal{C}_\Lambda$
one obtains in this way are called
prorepresentable functors.

\begin{definition}
\label{definition-prorepresentable}
Let $F : \mathcal{C}_\Lambda \to \textit{Sets}$ be a functor.
We say $F$ is {\it prorepresentable} if there exists an isomorphism
$F \cong \underline{R}|_{\mathcal{C}_\Lambda}$ of functors for some
$R \in \text{Ob}(\widehat{\mathcal{C}}_\Lambda)$.
\end{definition}  

\noindent
Note that if $F : \mathcal{C}_\Lambda \to \textit{Sets}$ is prorepresentable
by $R \in \text{Ob}(\widehat{\mathcal{C}}_\Lambda)$, then
$$
F(k) = \text{Mor}_{\widehat{\mathcal{C}}_\Lambda}(R, k) = \{*\}
$$
is a singleton. The categories cofibered in groupoids over
$\mathcal{C}_\Lambda$ that are arise in deformation theory will often satisfy
an analogous condition.

\begin{definition}
\label{definition-predeformation-category}
A {\it predeformation category} $\mathcal{F}$ is a category cofibered
in groupoids over $\mathcal{C}_\Lambda$ such that $\mathcal{F}(k)$ is
equivalent to a category with a single object and a single morphism,
i.e., $\mathcal{F}(k)$ contains at least one object and there is a
unique morphism between any two objects. A {\it morphism of predeformation
categories} is a morphism of categories cofibered in groupoids over
$\mathcal{C}_\Lambda$.
\end{definition}

\noindent
A feature of a predeformation category is the following.
Let $x_0 \in \text{Ob}(\mathcal{F}(k))$. Then every object of
$\mathcal{F}$ comes equipped with a unique morphism to $x_0$.
Namely, if $x$ is an object of $\mathcal{F}$ over $A$, then we
can choose a pushforward $x \to q_*x$ where $q : A \to k$ is the quotient
map. There is a unique isomorphism $q_*x \to x_0$ and the composition
$x \to q_*x \to x_0$ is the desired morphism.

\begin{remark}
\label{remark-predeformation-functor}
We say that a functor $F: \mathcal{C}_\Lambda \to \textit{Sets}$ 
is a {\it predeformation functor} if the associated cofibered set is a 
predeformation category, i.e.\ if $F(k)$ is a one element set.  Thus if 
$\mathcal{F}$ is a predeformation category, then $\overline{\mathcal{F}}$ is a 
predeformation functor.
\end{remark}

\begin{remark}
\label{remark-localize-cofibered-groupoid} 
Let $p: \mathcal{F} \to \mathcal{C}_\Lambda$ be a category cofibered in 
groupoids, and let $x \in \text{Ob}(\mathcal{F}(k))$.  We denote by 
$\mathcal{F}_{x}$ the category of objects over $x$.
An object of $\mathcal{F}_x$ is an arrow $y \to x$.
A morphism $(y \to x) \to (z \to x)$ in $\mathcal{F}_x$ is a commutative 
diagram
$$
\xymatrix{
y \ar[rr] \ar[dr] & & z \ar[dl] \\
& x &
}
$$
There is a forgetful functor $\mathcal{F}_{x} \to \mathcal{F}$. We define 
the functor $p_x : \mathcal{F}_{x} \to \mathcal{C}_\Lambda$ as the 
composition
$\mathcal{F}_x \to \mathcal{F} \xrightarrow{p} \mathcal{C}_\Lambda$.
Then $p_x : \mathcal{F}_x \to \mathcal{C}_\Lambda$ is a 
predeformation category (proof omitted). In this way we can pass from an
arbitrary category cofibered in groupoids over $\mathcal{C}_\Lambda$
to a predeformation category at any $x \in \text{Ob}(\mathcal{F}(k))$.
\end{remark}






\section{Formal objects and completion categories}
\label{section-formal-objects}

\noindent
In this section we discuss how to go between categories cofibred in
groupoids over $\mathcal{C}_\Lambda$ to categories cofibred in
groupoids over $\widehat{\mathcal{C}}_\Lambda$ and vice versa.

\begin{definition}
\label{definition-formal-objects}
Let $\mathcal{F}$ be a category cofibered in groupoids over
$\mathcal{C}_\Lambda$. The {\it category $\widehat{\mathcal{F}}$ of formal
objects of  $\mathcal{F}$} is the category with the following objects and
morphisms.
\begin{enumerate}
\item A {\it formal object $\xi = (R, \xi_n, f_n)$ of $\mathcal{F}$} 
consists of an object $R$ of $\widehat{\mathcal{C}}_\Lambda$, and a collection 
indexed by $n \in \mathbf{N}$ of objects $\xi_{n}$ of
$\mathcal{F}(R/\mathfrak m_R^n)$ and morphisms
$f_n : \xi_{n + 1} \to \xi_n$ lying over the projection
$R/\mathfrak m_R^{n + 1} \to R/\mathfrak m_R^n$.
\item Let $\xi = (R, \xi_n, f_n)$ and $\eta = (S, \eta_n, g_n)$ be 
formal objects of $\mathcal{F}$.  A {\it morphism $a: \xi \to \eta$ of 
formal objects} consists of a map $a_0 : R \to S$ in
$\widehat{\mathcal{C}}_\Lambda$ and a collection $a_n : \xi_n \to \eta_n$
of morphisms of $\mathcal{F}$ lying over
$R/\mathfrak m_R^n \to S/\mathfrak m_S^n$, 
such that for every $n$ the diagram
$$
\xymatrix{
\xi_{n + 1} \ar[r]^{f_n} \ar[d]_{a_{n + 1}} & \xi_n \ar[d]^{a_n} \\
\eta_{n + 1} \ar[r]^{g_n} & \eta_n
}
$$
commutes.
\end{enumerate}
\end{definition}

\noindent
The category of formal objects comes with a functor $\widehat{p}: 
\widehat{\mathcal{F}} \to \widehat{\mathcal{C}}_\Lambda$ which sends an 
object $(R, \xi_n, f_n)$ to $R$ and a morphism
$(R, \xi_n, f_n) \to (S, \eta_n, g_n)$ to the map $R \to S$.

\begin{lemma}
\label{lemma-completion-cofibred}
Let $p : \mathcal{F} \to \mathcal{C}_\Lambda$ be a category cofibered in 
groupoids. Then
$\widehat{p} : \widehat{\mathcal{F}} \to \widehat{\mathcal{C}}_\Lambda$
is a category cofibered in groupoids.
\end{lemma}

\begin{proof}
Let $R \to S$ be a ring map in $\widehat{\mathcal{C}}_\Lambda$.
Let $(R, \xi_n, f_n)$ be an object of $\widehat{\mathcal{F}}$.
For each $n$ choose a pushforward $\xi_n \to \eta_n$ of $\xi_n$
along $R/\mathfrak m_R^n \to S/\mathfrak m_S^n$. For each $n$ there
exists a unique morphism $g_n : \eta_{n + 1} \to \eta_n$ in $\mathcal{F}$
lying over $S/\mathfrak m_S^{n + 1} \to S/\mathfrak m_S^n$ such that
$$
\xymatrix{
\xi_{n + 1} \ar[d] \ar[r]_{f_n} & \xi_n \ar[d] \\
\eta_{n + 1} \ar[r]^{g_n} & \eta_n
}
$$
commutes (by the first axiom of a category cofibred in groupoids).
Hence we obtain a morphism $(R, \xi_n, f_n) \to (S, \eta_n, g_n)$
lying over $R \to S$, i.e., the first axiom of a category cofibred in
groupoids holds for $\widehat{\mathcal{F}}$. To see the second axiom
suppose that we have morphisms
$a : (R, \xi_n, f_n) \to (S, \eta_n, g_n)$ and
$b : (R, \xi_n, f_n) \to (T, \theta_n, h_n)$ in $\widehat{\mathcal{F}}$
and a morphism $c_0 : S \to T$ in $\widehat{\mathcal{C}}_\Lambda$ such that
$c_0 \circ a_0 = b_0$. By the second axiom of a category cofibred in groupoids
for $\mathcal{F}$ we obtain unique maps $c_n : \eta_n \to \theta_n$
lying over $S/\mathfrak m_S^n \to T/\mathfrak m_T^n$ such that
$c_n \circ a_n = b_n$. Setting $c = (c_n)_{n \geq 0}$ gives the desired
morphism $c : (S, \eta_n, g_n) \to (T, \theta_n, h_n)$ in
$\widehat{\mathcal{F}}$ (we omit the verification that
$h_n \circ c_{n + 1} = c_n \circ g_n$).
\end{proof}

\begin{definition}
\label{definition-completion}
Let $p : \mathcal{F} \to \mathcal{C}_\Lambda$ be a category cofibered in 
groupoids. The category cofibered in groupoids
$\widehat{p} : \widehat{\mathcal  F} \to \widehat{\mathcal{C}}_\Lambda$
is called the {\it completion of $\mathcal{F}$}.
\end{definition}

\noindent
If $\mathcal{F}$ is a category cofibered in groupoids over $\mathcal 
C_\Lambda$, we have defined $\widehat{\mathcal{F}}(R)$ for $R \in 
\text{Ob}(\widehat{\mathcal{C}}_\Lambda)$ in terms of the filtration of 
$R$ by powers of its maximal ideal.  But suppose $\mathcal{I} = (I_{n})$ is a 
filtration of $R$ by ideals inducing the $\mathfrak{m}_{R}$-adic topology.  We 
define $\widehat{\mathcal{F}}_{\mathcal{I}}(R)$ to be the category with the 
following objects and morphisms:
\begin{enumerate}
\item An object is a collection $(\xi_n, f_n)_{n \in \mathbf{N}}$ of 
objects $\xi_n$ of $\mathcal{F}(R/I_n)$ and morphisms
$f_n : \xi_{n + 1} \to \xi_n$ lying over the projections
$R/I_{n + 1} \to R/I_n$.
\item A morphism $a: (\xi_n, f_n) \to (\eta_n, g_n)$ consists of a 
collection $a_n : \xi_n \to \eta_n$ of morphisms in
$\mathcal{F}(R/I_n)$, such that for every $n$ the diagram
$$
\xymatrix{
\xi_{n + 1} \ar[r]^{f_n} \ar[d]_{a_{n + 1}} & \xi_n \ar[d]^{a_n} \\
\eta_{n + 1} \ar[r]^{g_n} & \eta_n
}
$$
commutes.
\end{enumerate}

\begin{lemma}
\label{lemma-formal-objects-different-filtration}
In the situation above, $\widehat{\mathcal{F}}_{\mathcal{I}}(R)$ is equivalent
to the category $\widehat{\mathcal{F}}(R)$.
\end{lemma}

\begin{proof}
An equivalence
$\widehat{\mathcal{F}}_{\mathcal{I}}(R) \to \widehat{\mathcal{F}}(R)$
can be defined as follows.  For each $n$, let $m(n)$ be the least $m$
that $I_m \subset \mathfrak m_R^n$.  Given an object 
$(\xi_n, f_n)$ of $\widehat{\mathcal{F}}_{\mathcal{I}}(R)$, let
$\eta_n$ be the pushforward of $\xi_{m(n)}$ along
$R/I_{m(n)} \to R/\mathfrak m_R^n$. Let $g_n : \eta_{n + 1} \to \eta_n$
be the unique morphism of $\mathcal{F}$ lying over
$R/\mathfrak m_R^{n + 1} \to R/\mathfrak m_R^n$ such that
$$
\xymatrix{
\xi_{m(n + 1)} \ar[rrr]_{f_{m(n)} \circ \ldots \circ f_{m(n + 1) - 1}} \ar[d]
& & & \xi_{m(n)} \ar[d] \\
\eta_{n + 1} \ar[rrr]^{g_n} & & & \eta_n
}
$$
commutes (existence and uniqueness is garanteed by the axioms of a
cofibred category). The functor
$\widehat{\mathcal{F}}_{\mathcal{I}}(R) \to \widehat{\mathcal{F}}(R)$
sends $(\xi_n, f_n)$ to $(R, \eta_n, g_n)$. We omit the 
verification that this is indeed an equivalence of categories.
\end{proof}

\begin{remark}
\label{remark-different-sequence-ideals}
Let $p: \mathcal{F} \to \mathcal{C}_\Lambda$ be a category cofibered in 
groupoids. Suppose that for each
$R \in \text{Ob}(\widehat{\mathcal{C}}_\Lambda)$ we are given a filtration
$\mathcal{I}_R$ of $R$ by ideals. If
$\mathcal{I}_R$ induces the $\mathfrak m_R$-adic topology on $R$ for all $R$,
then one can define a category
$\widehat{\mathcal{F}}_\mathcal{I}$ by mimicking 
the definition of $\widehat{\mathcal{F}}$. This category comes equipped with a
morphism
$\widehat{p}_\mathcal{I} : \widehat{\mathcal{F}}_\mathcal{I} \to
\widehat{\mathcal{C}}_\Lambda$ making it into a category cofibered in 
groupoids such that $\widehat{\mathcal{F}}_\mathcal{I}(R)$ is isomorphic to 
$\widehat{\mathcal{F}}_{\mathcal{I}_R}(R)$ as defined above. The categories
cofibered in groupoids $\widehat{\mathcal{F}}_{\mathcal{I}}$ and 
$\widehat{\mathcal{F}}$ are equivalent, by using over an object
$R \in \text{Ob}(\widehat{\mathcal{C}}_\Lambda)$
the equivalence of
Lemma \ref{lemma-formal-objects-different-filtration}.
\end{remark}

\begin{remark}
\label{remark-completion-functor}
Let $F: \mathcal{C}_\Lambda \to \textit{Sets}$ be a functor.
Identifying functors with cofibered sets, the completion of $F$ is the functor 
$\widehat{F} : \widehat{\mathcal{C}}_\Lambda \to \textit{Sets}$ 
given by $\widehat{F}(S) = \lim F(S/\mathfrak{m}_{S}^{n})$.  This agrees 
with the definition in Schlessinger's paper \cite{Sch}.
\end{remark}

\begin{remark}
\label{remark-restrict-completion}
Let $\mathcal{F}$ be a category cofibred in groupoids over
$\mathcal{C}_\Lambda$. We claim that there is a canonical
equivalence
$$
can :
\widehat{\mathcal{F}}|_{\mathcal{C}_\Lambda}
\longrightarrow
\mathcal{F}.
$$
Namely, let $A \in \text{Ob}(\mathcal{C}_\Lambda)$ and let
$(A, \xi_n, f_n)$ be an object of
$\widehat{\mathcal{F}}|_{\mathcal{C}_\Lambda}(A)$.
Since $A$ is Artinian there is a minimal $m \in \mathbf{N}$
such that $\mathfrak m_A^m = 0$. Then $can$ sends $(A, \xi_n, f_n)$ to $\xi_m$.
This functor is an equivalence of categories cofibered in groupoids by
Categories, Lemma \ref{categories-lemma-equivalence-fibred-categories}
because it is an equivalence on all fibre categories by
Lemma \ref{lemma-formal-objects-different-filtration}
and the fact that the $\mathfrak m_A$-adic topology on a local
Artinian ring $A$ comes from the zero ideal. We will frequently identify
$\mathcal{F}$ with a full subcategory of $\widehat{\mathcal{F}}$ via a
quasi-inverse to the functor $can$.
\end{remark}

\begin{remark}
\label{remark-completion-morphism}
Let $\varphi: \mathcal{F} \to \mathcal{G}$ be a morphism of categories 
cofibered in groupoids over $\mathcal{C}_\Lambda$. Then there is an induced 
morphism
$\widehat{\varphi}: \widehat{\mathcal{F}} \to \widehat{\mathcal{G}}$
of categories cofibered in groupoids over $\widehat{\mathcal{C}}_\Lambda$.
It sends an object $\xi = (R, \xi_n, f_n)$ of 
$\widehat{\mathcal{F}}$ to $(R, \varphi(\xi_n), \varphi(f_n))$, and it sends a 
morphism $(a_0 : R \to S, a_n : \xi_n \to \eta_n)$ between 
objects $\xi$ and $\eta$ of $\widehat{\mathcal{F}}$ to
$(a_0 : R \to S, \varphi(a_n) : \varphi(\xi_n) \to \varphi(\eta_n))$.
Finally, if $t : \varphi \to \varphi'$ is a $2$-morphism between
$1$-morphisms $\varphi, \varphi': \mathcal{F} \to \mathcal{G}$ of
categories cofibred in groupoids, then we obtain a $2$-morphism
$\widehat{t} : \widehat{\varphi} \to \widehat{\varphi}'$. Namely, for
$\xi = (R, \xi_n, f_n)$ as above we set
$\widehat{t}_\xi = (t_{\varphi(\xi_n)})$. Hence completion defines a
functor between $2$-categories
$$
\widehat{~} :
\text{Cof}(\mathcal{C}_\Lambda)
\longrightarrow 
\text{Cof}(\widehat{\mathcal{C}}_\Lambda)
$$
from the $2$-category of categories cofibred in groupoids over
$\mathcal{C}_\Lambda$ to the $2$-category of categories cofibred
in groupoids over $\widehat{\mathcal{C}}_\Lambda$.
\end{remark}

\begin{remark}
\label{remark-completion-restriction-adjoint}
We claim the completion functor of
Remark \ref{remark-completion-morphism}
and the restriction functor
$|_{\mathcal{C}_\Lambda} : \text{Cof}(\widehat{\mathcal{C}}_\Lambda)
\to \text{Cof}(\mathcal{C}_\Lambda)$ of
Remarks \ref{remarks-cofibered-groupoids}
(\ref{item-definition-restricting-base-category})
are ``2-adjoint'' in the following precise sense. Let
$\mathcal{F} \in \text{Ob}(\text{Cof}(\mathcal{C}_\Lambda))$
and let
$\mathcal{G} \in \text{Ob}(\text{Cof}(\widehat{\mathcal{C}}_\Lambda))$.
Then there is an equivalence of categories
$$
\Phi :
\text{Mor}_{\mathcal{C}_\Lambda}(
\mathcal{G}|_{\mathcal{C}_\Lambda}, \mathcal{F}) 
\longrightarrow
\text{Mor}_{\widehat{\mathcal{C}}_\Lambda}(\mathcal{G}, \widehat{\mathcal{F}})
$$
To describe this equivalence, we 
define canonical morphisms
$\mathcal{G} \to \widehat{\mathcal{G}|_{\mathcal{C}_\Lambda}}$ and
$\widehat{\mathcal{F}}|_{\mathcal{C}_\Lambda} \to \mathcal{F}$ as follows
\begin{enumerate}
\item Let $R \in \text{Ob}(\widehat{\mathcal{C}}_\Lambda))$ and let $\xi$
be an object of the fiber category $\mathcal{G}(R)$.
Choose a pushforward $\xi \to \xi_n$ of $\xi$ to
$R/\mathfrak m_R^n$ for each $n \in \mathbf{N}$, and let
$f_n : \xi_{n + 1} \to \xi_n$ be the induced morphism.
Then $\mathcal{G} \to \widehat{\mathcal{G}|_{\mathcal{C}_\Lambda}}$
sends $\xi$ to $(R, \xi_n, f_n)$.  
\item This is the equivalence
$can : \widehat{\mathcal{F}}|_{\mathcal{C}_\Lambda} \to \mathcal{F}$
of
Remark \ref{remark-restrict-completion}.
\end{enumerate}
Having said this, the equivalence
$\Phi : \text{Mor}_{\mathcal{C}_\Lambda}(
\mathcal{G}|_{\mathcal{C}_\Lambda}, \mathcal{F})  \to
\text{Mor}_{\widehat{\mathcal{C}}_\Lambda}(\mathcal{G},
\widehat{\mathcal{F}})$
sends a morphism
$\varphi : \mathcal{G}|_{\mathcal{C}_\Lambda} \to \mathcal{F}$
to
$$
\mathcal{G} \to \widehat{\mathcal{G}|_{\mathcal{C}_\Lambda}} 
\xrightarrow{\widehat{\varphi}} \widehat{\mathcal{F}}
$$
There is a quasi-inverse
$\Psi :
\text{Mor}_{\widehat{\mathcal{C}}_\Lambda}(
\mathcal{G}, \widehat{\mathcal{F}}) \to 
\text{Mor}_{\mathcal{C}_\Lambda}(
\mathcal{G}|_{\mathcal{C}_\Lambda}, \mathcal{F})$
to $\Phi$ which sends $\psi : \mathcal{G} \to \widehat{\mathcal{F}}$ to
$$
\mathcal{G}|_{\mathcal{C}_\Lambda} \xrightarrow{\psi|_{\mathcal{C}_\Lambda}}
\widehat{\mathcal{F}}|_{\mathcal{C}_\Lambda} \to \mathcal{F}.
$$
We omit the verification that $\Phi$ and $\Psi$ are quasi-inverse.
We also do not address functoriality of $\Phi$ (because it would
lead into 3-category territory which we want to avoid at all cost).
\end{remark}

\begin{remark}
\label{remark-completion-restriction-cofset-adjoint}
For a category $\mathcal{C}$ we denote by $\text{CofSet}(\mathcal{C})$ the
category of cofibered sets over $\mathcal{C}$. It is a $1$-category
isomorphic the category of functors $\mathcal{C} \to \textit{Sets}$.
See Remarks \ref{remarks-cofibered-groupoids}
(\ref{item-convention-cofibered-sets}).
The completion and restriction functors restrict to functors
$\widehat{~} : \text{CofSet}(\mathcal{C}_\Lambda) \to 
\text{CofSet}(\widehat{\mathcal{C}}_\Lambda)$ and
$|_{\mathcal{C}_\Lambda} : \text{CofSet}(\widehat{\mathcal{C}}_\Lambda) \to
\text{CofSet}(\mathcal{C}_\Lambda)$ which we denote by the same symbols.
As functors on the categories of cofibered sets, completion and restriction 
are adjoints in the usual 1-categorical sense: the same construction as in 
Remark \ref{remark-completion-restriction-adjoint} defines a functorial 
bijection
$$
\text{Mor}_{\mathcal{C}_\Lambda}(G|_{\mathcal{C}_\Lambda}, F) 
\longrightarrow
\text{Mor}_{\widehat{\mathcal{C}}_\Lambda}(G, \widehat{F}) 
$$
for $F \in \text{Ob}(\text{CofSet}(\mathcal{C}_\Lambda))$ and
$G \in \text{Ob}(\text{CofSet}(\widehat{\mathcal{C}}_\Lambda))$.
Again the map $\widehat{F}|_{\mathcal{C}_\Lambda} \to F$ is an 
isomorphism.
\end{remark}

\begin{remark}
\label{remark-formal-objects-yoneda}
Let $R$ be an object of $\widehat{\mathcal{C}}_\Lambda$.  It defines a functor 
$\underline{R}: \widehat{\mathcal{C}}_\Lambda \to \textit{Sets}$ 
as described in
Remarks \ref{remarks-cofibered-groupoids} (\ref{item-definition-yoneda}).
As usual we identify this functor with the 
associated cofibered set.  If $\mathcal{F}$ is a cofibered category over 
$\mathcal{C}_\Lambda$, then there is an equivalence of categories
\begin{equation}
\label{equation-formal-objects-maps}
\text{Mor}_{\mathcal{C}_\Lambda}(
\underline{R}|_{\mathcal{C}_\Lambda}, \mathcal{F}) 
\longrightarrow
\widehat{\mathcal{F}}(R).
\end{equation}
It is given by the composition
$$
\text{Mor}_{\mathcal{C}_\Lambda}(
\underline{R}|_{\mathcal{C}_\Lambda}, \mathcal{F}) 
\xrightarrow{\Phi}
\text{Mor}_{\widehat{\mathcal{C}}_\Lambda}(
\underline{R}, \widehat{\mathcal{F}}) 
\xrightarrow{\sim}
\widehat{\mathcal{F}}(R)
$$
where $\Phi$ is as in
Remark \ref{remark-completion-restriction-adjoint}
and the second equivalence comes from the 2-Yoneda lemma
(the cofibered analogue of 
Categories, Lemma \ref{categories-lemma-yoneda-2category}).
Explicitly, the equivalence sends a morphism
$\varphi: \underline{R}|_{\mathcal{C}_\Lambda} \to \mathcal{F}$
to the formal object
$(R, \varphi(R \to R/\mathfrak{m}_R^n), \varphi(f_n))$ in
$\widehat{\mathcal{F}}(R)$, where
$f_n : R/\mathfrak m_R^{n + 1} \to R/\mathfrak m_R^n$ is the projection.  

\medskip\noindent
Assume a choice of pushforwards for $\mathcal{F}$ has been made.
Given any $\xi \in \text{Ob}(\widehat{\mathcal{F}}(R))$ we construct
an explicit
$\underline{\xi} : \underline{R}|_{\mathcal{C}_\Lambda} \to \mathcal{F}$
which maps to $\xi$ under (\ref{equation-formal-objects-maps}).
Namely, say $\xi = (R, \xi_n, f_n)$. An object $\alpha$ in
$\underline{R}|_{\mathcal{C}_\Lambda}$ is the same thing as a morphism
$\alpha : R \to A$ of $\widehat{\mathcal{C}}_\Lambda$ with $A$
Artinian. Let $m \in \mathbf{N}$ be minimal such that $\mathfrak m_A^m = 0$.
Then $\alpha$ factors through a unique $\alpha_m : R/\mathfrak m_R^m \to A$
and we can set $\underline{\xi}(\alpha) = \alpha_{m, *}\xi_m$.
We omit the description of $\underline{\xi}$ on morphisms and we
omit the proof that $\underline{\xi}$ maps to $\xi$
via (\ref{equation-formal-objects-maps}).

\medskip \noindent
Assume a choice of pushforwards for $\widehat{\mathcal{F}}$ has been made.
Then there is an explicit quasi-inverse
$$
\iota :
\widehat{\mathcal{F}}(R) \longrightarrow
\text{Mor}_{\widehat{\mathcal{C}}_\Lambda}(
\underline{R}, \widehat{\mathcal{F}})
$$
to the 2-Yoneda equivalence. This takes $\xi$ to the the morphism
$i(\xi) : \underline{R} \to \widehat{\mathcal{F}}$ sending
$f \in \underline{R}(S) = \text{Mor}_{\mathcal{C}_\Lambda}(R, S)$
to $f_*\xi$. A quasi-inverse to (\ref{equation-formal-objects-maps})
is then
$$
\widehat{\mathcal{F}}(R)
\xrightarrow {\iota}
\text{Mor}_{\widehat{\mathcal{C}}_\Lambda}(
\underline{R}, \widehat{\mathcal{F}})
\xrightarrow{\Psi}
\text{Mor}_{\mathcal{C}_\Lambda}(
\underline{R}|_{\mathcal{C}_\Lambda}, \mathcal{F})
$$
where $\Psi$ is as in
Remark \ref{remark-completion-restriction-adjoint}.  
Given $\xi \in \text{Ob}(\widehat{\mathcal{F}}(R))$ we have
$\Psi(\iota(\xi)) \cong \underline{\xi}$ where
$\underline{\xi}$ is as in the previous paragraph.
\end{remark}

\begin{remark}
\label{remark-spell-out-formal-object}
According to Remark \ref{remark-formal-objects-yoneda}, giving a formal object 
$\xi$ of $\mathcal{F}$ is equivalent to giving a prorepresentable functor $U: 
\mathcal{C}_\Lambda \to \textit{Sets}$ and a morphism $U 
\to \mathcal{F}$. 
\end{remark}

\begin{remark}
\label{remark-restrict-complete-continuous-functor}
Let $F : \widehat{\mathcal{C}}_\Lambda \to \textit{Sets}$
be a functor that commutes with limits.
Then the map $F \to \widehat{F|_{\mathcal{C}_\Lambda}}$ described in 
Remark \ref{remark-completion-restriction-cofset-adjoint}
is an isomorphism. Indeed, if $S$ is 
an object of $\widehat{\mathcal{C}}_\Lambda$, then we have canonical
bijections
$$
\widehat{F|_{\mathcal{C}_\Lambda}}(S) =
\lim\nolimits_n F(S/\mathfrak{m}_{S}^n) =
F(\lim\nolimits_n S/\mathfrak{m}_{S}^n) = F(S).
$$
In particular, if $R$ is an object of $\widehat{\mathcal{C}}_\Lambda$ then 
$\underline{R} = \widehat{\underline{R}|_{\mathcal{C}_\Lambda}}$ because
the representable functor $\underline{R}$ commutes with limits by definition
of limits.
\end{remark}




\section{Smooth morphisms}
\label{section-smooth-morphisms}

\noindent
In this section we discuss smooth morphisms of categories 
cofibered in groupoids over $\mathcal{C}_\Lambda$.

\begin{definition}
\label{definition-smooth-morphism}
Let $\varphi: \mathcal{F} \to \mathcal{G}$ be a morphism of categories 
cofibered in groupoids over $\mathcal{C}_\Lambda$.  We say  $\varphi$ is 
{\it smooth} if it satisfies the following condition: Let $B \to A$ be 
a surjective ring map in $\mathcal{C}_\Lambda$.  Let $y \in 
\text{Ob}(\mathcal{G}(B)), x \in \text{Ob}(\mathcal{F}(A))$, and $y 
\to \varphi(x)$ be a morphism lying over $B \to A$.  Then there 
exists $x' \in \text{Ob}(\mathcal{F}(B))$, a morphism $x' \to x$ 
lying over $B \to A$, and a morphism $\varphi(x') \to y$ lying 
over $\text{id}: B \to B$, such that the diagram
$$
\xymatrix{
\varphi(x') \ar[r] \ar[dr] & y \ar[d] \\
& \varphi(x)
}
$$
commutes.
\end{definition}

\begin{lemma}
\label{lemma-smoothness-small-extensions}
Let $\varphi: \mathcal{F} \to \mathcal{G}$ be a morphism of categories 
cofibered in groupoids over $\mathcal{C}_\Lambda$.  Then $\varphi$ is smooth 
if the condition in Definition \ref{definition-smooth-morphism} is assumed to 
hold only for small extensions $B \to A$.
\end{lemma}

\begin{proof}
Let $B \to A$ be a surjective ring map in $\mathcal{C}_\Lambda$.
Let $y \in \text{Ob}(\mathcal{G}(B))$, $x \in \text{Ob}(\mathcal{F}(A))$, 
and $y \to \varphi(x)$ be a morphism lying over $B \to A$. By 
Lemma \ref{lemma-factor-small-extension} we can factor $B \to A$ into 
small extensions $B = B_n \to B_{n-1} \to \ldots \to B_0 = A$.
We argue by induction on $n$. If $n = 1$ the result is true by assumption.
If $n > 1$, then denote $f : B = B_n \to B_{n - 1}$ and denote
$g : B_{n - 1} \to B_0 = A$. Choose a pushforward
$y \to f_* y$ of $y$ along $f$, so that the morphism $y \to \varphi(x)$
factors as $y \to f_* y \to \varphi(x)$. By the induction hypothesis
we can find $x_{n - 1} \to x$ lying over $g : B_{n - 1} \to A$ and
$a : \varphi(x_{n - 1}) \to f_*y$ lying over
$\text{id} : B_{n - 1} \to B_{n - 1}$ such that
$$
\xymatrix{
\varphi(x_{n - 1}) \ar[r]_-a \ar[dr] & f_*y \ar[d] \\
& \varphi(x)
}
$$
commutes. We can apply the assumption to the composition
$y \to \varphi(x_{n - 1})$ of
$y \to f_*y$ with $a^{-1} : f_*y \to \varphi(x_{n - 1})$. We obtain
$x_n \to x_{n - 1}$ lying over $B_n \to B_{n - 1}$ and
$\varphi(x_n) \to y$ lying over  $\text{id} : B_n \to B_n$ so that the diagram
$$
\xymatrix{
\varphi(x_n) \ar[r] \ar[d] & y \ar[d] \\
\varphi(x_{n - 1}) \ar[r]^-a \ar[dr] & f_*y \ar[d] \\
& \varphi(x)
}
$$ 
commutes. Then the composition $x_n \to x_{n - 1} \to x$ and 
$\varphi(x_n) \to y$ are the morphisms required by the definition of 
smoothness.
\end{proof}

\begin{remark}
\label{remark-smoothness-2-categorical}
Let $\varphi: \mathcal{F} \to \mathcal{G}$ be a morphism of categories 
cofibered in groupoids over $\mathcal{C}_\Lambda$.  Let $B \to A$ be a 
ring map in $\mathcal{C}_\Lambda$.  Choices of pushforwards along $B 
\to A$ for objects in the fiber categories $\mathcal{F}(B)$ and 
$\mathcal{G}(B)$ determine functors $\mathcal{F}(B) \to \mathcal{F}(A)$ 
and $\mathcal{G}(B) \to \mathcal{G}(A)$ fitting into a $2$-commutative 
diagram
\[
\xymatrix{
\mathcal{F}(B) \ar[r]^{\varphi} \ar[d] & \mathcal{G}(B) \ar[d] \\
\mathcal{F}(A) \ar[r]^{\varphi}        & \mathcal{G}(A) .
}
\]
Hence there is an induced functor $\mathcal{F}(B) \to \mathcal{F}(A) 
\times_{\mathcal{G}(A)} \mathcal{G}(B)$.  Unwinding the definitions shows that 
$\varphi: \mathcal{F} \to \mathcal{G}$ is smooth if and only if this 
induced functor is essentially surjective whenever $B \to A$ is 
surjective (or equivalently, by
Lemma \ref{lemma-smoothness-small-extensions},
whenever $B \to A$ is a small extension).
\end{remark}

\begin{remark}
\label{remark-compare-smooth-schlessinger}
The characterization of smooth morphisms in
Remark \ref{remark-smoothness-2-categorical}
is analogous to Schlessinger's notion of 
a smooth morphism of functors, cf.\ \cite[Definition 2.2.]{Sch}. In 
fact, when $\mathcal{F}$ and $\mathcal{G}$ are cofibered in sets
then our notion is equivalent to Schlessinger's. Namely, in this case
let $F, G : \mathcal{C}_\Lambda \to \textit{Sets}$ be the corresponding
functors, see
Remarks \ref{remarks-cofibered-groupoids}
(\ref{item-convention-cofibered-sets}).
Then $F \to G$ is smooth if and only if for every surjection of rings
$B \to A$ in $\mathcal{C}_\Lambda$ the map $F(B) \to F(A) \times_{G(A)} G(B)$
is surjective.
\end{remark}

\begin{remark}
\label{remark-smooth-to-iso-classes}
Let $\mathcal{F}$ be a category cofibered in groupoids over
$\mathcal{C}_\Lambda$. Then the morphism
$\mathcal{F} \to \overline{\mathcal{F}}$ is smooth.
\end{remark}

\noindent
If $R \to S$ is a ring map $\widehat{\mathcal{C}}_\Lambda$, then there 
is an induced morphism $\underline{S} \to \underline{R}$ between the 
functors $\underline{S},\underline{R}: \widehat{\mathcal{C}}_\Lambda 
\to \textit{Sets}$.  In this situation, smoothness of the 
restriction $\underline{S}|_{\mathcal{C}_\Lambda} \to 
\underline{R}|_{\mathcal{C}_\Lambda}$ is a familiar notion:

\begin{lemma}
\label{lemma-smooth-morphism-power-series}
Let $R \to S$ be a ring map in $\widehat{\mathcal{C}}_\Lambda$. Then
the induced morphism
$\underline{S}|_{\mathcal{C}_\Lambda} \to \underline{R}|_{\mathcal{C}_\Lambda}$
is smooth if and only if $S$ is a power series ring over $R$.
\end{lemma}

\begin{proof}
Assume $S$ is a power series ring over $R$. Say $S = R[[x_1, \ldots, x_n]]$.
Smoothness of
$\underline{S}|_{\mathcal{C}_\Lambda} \to \underline{R}|_{\mathcal{C}_\Lambda}$
means the following (see Remark \ref{remark-compare-smooth-schlessinger}):
Given a surjective ring map $B \to A$ in
$\mathcal{C}_\Lambda$, a ring map $R \to B$, a ring map $S \to A$ such that
the solid diagram
$$
\xymatrix{
S \ar[r] \ar@{..>}[rd] & A \\
R \ar[u] \ar[r] & B \ar[u]
}
$$
is commutative then a dotted arrow exists making the diagram commute.
(Note the similarity with
Algebra, Definition \ref{algebra-definition-formally-smooth}.)
To construct the dotted arrow choose elements $b_i \in B$ whose images
in $A$ are equal to the images of $x_i$ in $A$. Note that
$b_i \in \mathfrak m_B$ as $x_i$ maps to an element of $\mathfrak m_A$.
Hence there is a unique $R$-algebra map $R[[x_1, \ldots, x_n]] \to B$
which maps $x_i$ to $b_i$ and which can serve as our dotted arrow.

\medskip\noindent
Conversely, assume
$\underline{S}|_{\mathcal{C}_\Lambda} \to \underline{R}|_{\mathcal{C}_\Lambda}$
is smooth. Let $x_1, \dots, x_n \in S$ be elements whose images
form a basis in the relative cotangent space
$\mathfrak m_S/(\mathfrak m_R S + \mathfrak m_S^2)$ of $S$ over $R$.
Set $T = R[[X_1, \dots, X_n]]$. Note that both
$$
S/(\mathfrak m_R S + \mathfrak m_S^2) \cong
R/\mathfrak m_R[x_1, \ldots, x_n]/(x_ix_j)
$$
and
$$
T/(\mathfrak m_R T + \mathfrak m_T^2) \cong
R/\mathfrak m_R[X_1, \ldots, X_n]/(X_iX_j).
$$
Let
$S/(\mathfrak m_R S + \mathfrak m_S^2) \to
T/(\mathfrak m_R T + \mathfrak m_T^2)$
be the local $R$-algebra isomorphism given by mapping 
the class of $x_i$ to the class of $X_i$. Let
$f_1 : S \to T/(\mathfrak m_R T + \mathfrak m_T^2)$ be the 
composition
$S \to S/(\mathfrak m_R S + \mathfrak m_S^2) 
\to T/(\mathfrak m_R T + \mathfrak m_T^2)$.
The assumption that 
$\underline{S}|_{\mathcal{C}_\Lambda} \to \underline{R}|_{\mathcal{C}_\Lambda}$
is smooth means we can lift $f_1$ to a map
$f_2 : S \to T/\mathfrak{m}_T^2$, then to a map 
$f_3 : S \to T/\mathfrak{m}_T^3$, and so on, for all $n \geq 1$. Thus 
we get an induced map $f : S \to T = \lim T/\mathfrak m_T^n$
of local $R$-algebras. By our choice of $f_1$, the map $f$ induces an
isomorphism
$\mathfrak m_S/(\mathfrak m_R S + \mathfrak m_S^2) \to
\mathfrak m_T/(\mathfrak m_R T + \mathfrak m_T^2)$
of relative cotangent spaces.
Hence $f$ is surjective by
Lemma \ref{lemma-surjective-cotangent-space}
(where we think of $f$ as a map in $\widehat{\mathcal{C}}_R$).
Choose preimages $y_i \in S$ of $X_i \in T$ under $f$. As $T$ is a
power series ring over $R$ there exists a local 
$R$-algebra homomorphism $s : T \to S$ mapping $X_i$ to $y_i$.
By construction $f \circ s = \text{id}$. Then $s$ is injective.
But $s$ induces an isomorphism on relative cotangent spaces since
$f$ does, so it is also surjective by 
Lemma \ref{lemma-surjective-cotangent-space}
again. Hence $s$ and $f$ are isomorphisms.
\end{proof}

\noindent
Smooth morphisms satisfy the following functorial properties.

\begin{lemma}
\label{lemma-smooth-properties}
Let $\varphi: \mathcal{F} \to \mathcal{G}$ and $\psi: \mathcal{G} 
\to \mathcal{H}$ be morphisms of categories cofibered in groupoids over 
$\mathcal{C}_\Lambda$.
\begin{enumerate}
\item If $\varphi$ and $\psi$ are smooth, then $\psi \circ \varphi$ is smooth.
\item If $\varphi$ is essentially surjective and $\psi \circ \varphi$ is 
smooth, then $\psi$ is smooth.
\item If $\mathcal{G}' \to \mathcal{G}$ is a morphism of categories 
cofibered in groupoids and $\varphi$ is smooth, then
$\mathcal{F} \times_{\mathcal{G}} \mathcal{G}' \to \mathcal{G}'$ is smooth.
\end{enumerate}
\end{lemma} 

\begin{proof}
Statements (1) and (2) follow immediately from the definitions.
Proof of (3) omitted. Hints: use the formulation of smoothness given in
Remark \ref{remark-smoothness-2-categorical}
and use that $\mathcal{F} \times_{\mathcal{G}} \mathcal{G}'$
is the $2$-fibre product, see
Remarks \ref{remarks-cofibered-groupoids} (\ref{item-fibre-product}).
\end{proof}

\begin{lemma}
\label{lemma-smooth-morphism-essentially-surjective}
Let $\varphi: \mathcal{F} \to \mathcal{G}$ be a smooth morphism of 
categories cofibered in groupoids over $\mathcal{C}_\Lambda$.  Assume 
$\varphi : \mathcal{F}(k) \to \mathcal{G}(k)$ is essentially surjective, 
e.g.\ this holds if $\mathcal{G}$ is a predeformation 
category. Then
$\varphi : \mathcal{F} \to \mathcal{G}$ and
$\widehat{\varphi} : \widehat{\mathcal{F}} \to \widehat{\mathcal{G}}$
are essentially surjective.
\end{lemma}

\begin{proof}
Let $y$ be an object of $\mathcal{G}$ lying over
$A \in \text{Ob}(\mathcal{C}_\Lambda)$. Let $y \to y_0$ be a pushforward
of $y$ along $A \to k$. By the assumption on essential surjectivity of 
$\varphi: \mathcal{F}(k) \to \mathcal{G}(k)$ there exist an object
$x_0$ of $\mathcal{F}$ lying over $k$ and an isomorphism
$y_0 \to \varphi(x_0)$. Smoothness of $\varphi$ implies there exists
an object $x$ of $\mathcal{F}$ over $A$ whose image $\varphi(x)$
is isomorphic to $y$. Thus $\varphi : \mathcal{F} \to \mathcal{G}$
is essentially surjective.

\medskip\noindent
Let $\eta = (R,\eta_{n},g_n)$ be an object of $\widehat{\mathcal{G}}$.  We 
construct an object $\xi$ of $\widehat{\mathcal{F}}$ with an isomorphism
$\eta \to \varphi(\xi)$. By the assumption on essential surjectivity of 
$\varphi : \mathcal{F}(k) \to \mathcal{G}(k)$, there exists a morphism 
$\eta_1 \to \varphi(\xi_1)$ in $\mathcal{G}(k)$ for some
$\xi_1 \in \text{Ob}(\mathcal{F}(k))$. The morphism
$\eta_2 \xrightarrow{g_1} \eta_1 \to \varphi(\xi_1)$
lies over the surjective ring map $R/\mathfrak m_R^2 \to k$, hence
by smoothness of $\varphi$ there exists
$\xi_2 \in \text{Ob}(\mathcal{F}(R/\mathfrak m_R^2))$, a 
morphism $f_1: \xi_2 \to \xi_1$ lying over
$R/\mathfrak m_R^2 \to k$, and a morphism
$\eta_2 \to \varphi(\xi_2)$ such that 
$$
\xymatrix{
\varphi(\xi_2)  \ar[r]^{\varphi(f_1)} &  \varphi(\xi_{1})   \\
\eta_2   \ar[u] \ar[r]^{g_1}  & \eta_1  \ar[u] \\
}
$$
commutes. Continuing in this way we construct an object
$\xi = (R, \xi_n, f_n)$ of $\widehat{\mathcal{F}}$ and a morphism
$\eta \to \varphi(\xi) = (R, \varphi(\xi_n), \varphi(f_n))$
in $\widehat{\mathcal{G}}(R)$.
\end{proof}

\begin{remark}
\label{remark-cofibered-groupoid-projection-smooth}
Let $p: \mathcal{F} \to \mathcal{C}_\Lambda$ be a category cofibered in 
groupoids. We can consider $\mathcal{C}_\Lambda$ as the trivial category 
cofibered in groupoids over $\mathcal{C}_\Lambda$, and then $p$ is a morphism 
of categories cofibered in groupoids over $\mathcal{C}_\Lambda$.  We say 
$\mathcal{F}$ is {\it smooth} if its structure morphism $p$ is smooth---this is 
the ``absolute'' notion of smoothness for a category cofibered in groupoids 
over $\mathcal{C}_\Lambda$.
\end{remark}

\begin{remark}
\label{remark-smooth-on-top}
Suppose $\mathcal{F}$ is a predeformation category admitting a smooth morphism 
$\varphi: \mathcal U \to \mathcal{F}$ from a predeformation category 
$\mathcal U$.  Then by
Lemma \ref{lemma-smooth-morphism-essentially-surjective} 
$\varphi$ is essentially surjective, so by
Lemma \ref{lemma-smooth-properties} 
$p: \mathcal{F} \to \mathcal{C}_\Lambda$ is smooth if and only if the 
composition $\mathcal U \xrightarrow{\varphi} \mathcal{F} \xrightarrow{p} 
\mathcal{C}_\Lambda$ is smooth, i.e.\ $\mathcal{F}$ is smooth if and only if 
$\mathcal U$ is smooth.
\end{remark}

\noindent
Later we are interested in producing smooth morphisms from
prorepresentable functors to predeformation categories $\mathcal{F}$.
By the discussion in
Remark \ref{remark-formal-objects-yoneda}
these morphisms correspond to certain formal objects of $\mathcal{F}$
More precisely, these are the so-called versal formal objects of $\mathcal{F}$.

\begin{definition}
\label{definition-versal}
Let $\mathcal{F}$ be a category cofibered in groupoids.  Let $\xi$ be a formal 
object of $\mathcal{F}$ lying over $R \in \text{Ob}(\widehat{\mathcal 
C}_\Lambda)$.  We say $\xi$ is {\it versal} if the corresponding morphism 
$\underline{\xi}: \underline{R}|_{\mathcal{C}_\Lambda} \to \mathcal{F}$ 
of Remark \ref{remark-formal-objects-yoneda} is smooth.
\end{definition}

\begin{remark}
\label{remark-versal-object}
Let $\mathcal{F}$ be a category cofibered in groupoids over $\mathcal 
C_\Lambda$, and let $\xi$ be a formal object of $\mathcal{F}$.  It follows 
from the definition of smoothness that versality of $\xi$ is equivalent to the 
following condition: If 
$$
\xymatrix{
& y \ar[d] \\
\xi \ar[r] & x
}
$$
is a diagram in $\widehat{\mathcal{F}}$ such that $y \to x$ lies over a 
surjective map $B \to A$ of Artinian rings (we may assume it is a small 
extension),  then there exists a morphism $\xi \to y$ such that
$$
\xymatrix{
& y \ar[d] \\
\xi \ar[r] \ar[ur] & x
}
$$ 
commutes. In particular, the condition that $\xi$ be versal does not depend on 
the choices of pushforwards made in the construction of
$\underline{\xi} : \underline{R}|_{\mathcal{C}_\Lambda} \to \mathcal{F}$ in
Remark \ref{remark-formal-objects-yoneda}.
\end{remark}

\begin{lemma}
\label{lemma-versal-object-quasi-initial}
Let $\mathcal{F}$ be a predeformation category.
Let $\xi$ be a versal formal object of $\mathcal{F}$.
For any formal object $\eta$ of $\widehat{\mathcal{F}}$,
there exists a morphism $\xi \to \eta$.
\end{lemma}

\begin{proof}
Follows from Lemma \ref{lemma-smooth-morphism-essentially-surjective}.
\end{proof}






\section{Schlessinger's conditions}
\label{section-schlessinger-conditions}

\noindent
In the following we often consider fibre products $A_1 \times_A A_2$
of rings in the category $\mathcal{C}_\Lambda$. We have seen in
Example \ref{example-fibre-product}
that such a fibre product may not always be an object of
$\mathcal{C}_\Lambda$. However, in virtually all cases below one of the
two maps $A_i \to A$ is surjective and $A_1 \times_A A_2$ will be
an object of $\mathcal{C}_\Lambda$ by
Lemma \ref{lemma-fiber-product-CLambda}.
We will use this result without further mention.

\medskip\noindent
We denote by $k[\epsilon]$ the ring of dual numbers over $k$.  More 
generally, for a $k$-vector space $V$, we denote by $k[V]$ the $k$-algebra 
whose underlying vector space is $k \oplus V$ and whose multiplication is given 
by $(a,v) \cdot (a',v') = (aa', av' + a'v)$.  When $V = k$, $k[V]$ is the ring 
of dual numbers over $k$.  For any finite dimensional $k$-vector space $V$
the ring $k[V]$ is in $\mathcal{C}_\Lambda$.

\begin{definition}
\label{definition-S1-S2}
Let $\mathcal{F}$ be a category cofibered in groupoids over $\mathcal 
C_\Lambda$. We define {\it conditions (S1) and (S2)}
on $\mathcal{F}$ as follows:
\begin{enumerate}
\item[(S1)] Every diagram in $\mathcal{F}$
$$
\vcenter{
\xymatrix{
           & x_2 \ar[d] \\
x_1 \ar[r] & x   
}
}
\quad\text{lying over}\quad
\vcenter{
\xymatrix{
           & A_2 \ar[d] \\
A_1 \ar[r] & A   
}
}
$$  
in $\mathcal{C}_\Lambda$ with $A_2 \to A$ surjective can be completed 
to a commutative diagram
$$
\vcenter{
\xymatrix{
y \ar[r] \ar[d] & x_2 \ar[d] \\
x_1 \ar[r]      & x   
}
}
\quad\text{lying over}\quad
\vcenter{
\xymatrix{
A_1 \times_{A} A_2 \ar[r] \ar[d] & A_2 \ar[d] \\ 
A_1 \ar[r]      & A.   
}
}
$$
\item[(S2)]
The condition of (S1) holds for diagrams in $\mathcal{F}$ lying over 
a diagram in $\mathcal{C}_\Lambda$ of the form
$$
\xymatrix{
          & k[\epsilon] \ar[d] \\
A  \ar[r] & k.
}
$$  
Moreover, if we have two diagrams in $\mathcal{F}$
$$
\vcenter{
\xymatrix{
y \ar[r]_c \ar[d]_a & x_\epsilon \ar[d]^e \\
x \ar[r]^d          & x_0
}
}
\quad\text{and}\quad
\vcenter{
\xymatrix{
y' \ar[r]_{c'} \ar[d]_{a'} & x_\epsilon \ar[d]^e \\
x \ar[r]^d                 & x_0
}
}
\quad\text{lying over}\quad
\vcenter{
\xymatrix{
A \times_{k} k[\epsilon] \ar[r] \ar[d] & k[\epsilon] \ar[d] \\
A  \ar[r] & k 
}
}
$$  
then there exists a morphism $b : y \to y'$ in
$\mathcal{F}(A \times_{k} k[\epsilon])$ such that $a = a' \circ b$
and such that $c' \circ b = c$.
\end{enumerate}
\end{definition}

\noindent
Let us explain the meaning of conditions (S1) and (S2) in terms of
fibre categories. Suppose that $f_1 : A_1 \to A$ and $f_2 : A_2 \to A$ are
ring maps in $\mathcal{C}_\Lambda$ with $f_2$ surjective.
Denote $p_i : A_1 \times_A A_2 \to A_i$ the projection maps.
Assume a choice of pushforwards for $\mathcal{F}$ has been made.
Then the commutative diagram of rings tranlates into a $2$-commutative diagram
$$
\xymatrix{
\mathcal{F}(A_1 \times_A A_2) \ar[r]_-{p_{2, *}} \ar[d]_{p_{1, *}} &
\mathcal{F}(A_2) \ar[d]^{f_{2, *}} \\
\mathcal{F}(A_1) \ar[r]^{f_{1, *}} & \mathcal{F}(A)
}
$$
of fibre categories whence a functor
$$
\mathcal{F}(A_1 \times_A A_2) \to
\mathcal{F}(A_1) \times_{\mathcal{F}(A)} \mathcal{F}(A_2)
$$
into the $2$-fibre product of categories.
Condition (S1) requires that this functor be essentially surjective.
Condition (S2) requires that this functor be a essentially surjective
and surjective on morphism sets if $f_2$ equals the map $k[\epsilon] \to k$.
The advantage of stating the conditions as in the definition
is that no choices have to be made.

\begin{lemma}
\label{lemma-S1-small-extensions}
Let $\mathcal{F}$ be a category cofibered in groupoids over $\mathcal 
C_\Lambda$. Then $\mathcal{F}$ satisfies (S1) if the condition of (S1)
is assumed to hold only when $A_2 \to A$ is a small extension.
\end{lemma}

\begin{proof}
Proof omitted. Hints: apply Lemma \ref{lemma-factor-small-extension}
and use induction similar to the proof of
Lemma \ref{lemma-smoothness-small-extensions}.
\end{proof}

\begin{remark}
\label{remark-compare-S1-S2-schlessinger}
When $\mathcal{F}$ is cofibered in sets, conditions (S1) and (S2) are exactly 
conditions (H1) and (H2) from Schlessinger's paper \cite{Sch}.
Namely, for a functor $F: \mathcal{C}_\Lambda \to 
\textit{Sets}$, conditions (S1) and (S2) state:
\begin{enumerate}
\item [(S1)] If $A_1 \to A$ and $A_2 \to A$ are maps in 
$\mathcal{C}_\Lambda$ with $A_2 \to A$ surjective, then the induced 
map $F(A_1 \times_{A} A_2) \to F(A_1) \times_{F(A)} F(A_2)$ is 
surjective.
\item [(S2)]  If $A \to k$ is a map in $\mathcal{C}_\Lambda$, then the 
induced map
$F(A \times_{k} k[\epsilon]) \to F(A) \times_{F(k)} F(k[\epsilon])$
is bijective.
\end{enumerate}
The injectivity of the map
$F(A \times_{k} k[\epsilon]) \to F(A) \times_{F(k)} F(k[\epsilon])$
comes from the second part of condition (S2).
\end{remark}

\begin{lemma}
\label{lemma-S2-extensions}
Let $F: \mathcal{C}_\Lambda \to \textit{Sets}$ be a functor.  If 
$F$ satisfies (S2), then the condition of (S2) also 
holds when $k[\epsilon]$ is replaced by $k[V]$ for any finite dimensional 
$k$-vector space $V$.
\end{lemma}

\begin{proof}
We prove this by induction on $\dim(V)$. If $\dim(V) = 1$, then
$k[V] \cong k[\epsilon]$ and the result holds by assumption.
If $\dim(V) > 1$ we write $V = V' \oplus k\epsilon$. Pick a diagram
$$
\vcenter{
\xymatrix{
& x_V \ar[d] \\
x \ar[r] & x_0
}
}
\quad\text{lying over}\quad
\vcenter{
\xymatrix{
& k[V] \ar[d] \\
A \ar[r] & k
}
}
$$
Choose a morphism $x_V \to x_{V'}$ lying over $k[V] \to k[V']$
and a morphism $x_V \to x_\epsilon$ lying over $k[V] \to k[\epsilon]$.
Note that the morphism $x_V \to x_0$ factors as
$x_V \to x_{V'} \to x_0$ and as $x_V \to x_\epsilon \to x_0$.
By induction hypothesis we can find a diagram
$$
\vcenter{
\xymatrix{
y' \ar[d] \ar[r] & x_{V'} \ar[d] \\
x \ar[r] & x_0
}
}
\quad\text{lying over}\quad
\vcenter{
\xymatrix{
A \times_k k[V'] \ar[d] \ar[r] & k[V'] \ar[d] \\
A \ar[r] & k
}
}
$$
This gives us a diagram
$$
\vcenter{
\xymatrix{
& x_\epsilon \ar[d] \\
y' \ar[r] & x_0
}
}
\quad\text{lying over}\quad
\vcenter{
\xymatrix{
& k[\epsilon] \ar[d] \\
A \times_k k[V'] \ar[r] & k
}
}
$$
Hence by (S2) we get a
$$
\vcenter{
\xymatrix{
y \ar[d] \ar[r] & x_\epsilon \ar[d] \\
y' \ar[r] & x_0
}
}
\quad\text{lying over}\quad
\vcenter{
\xymatrix{
(A \times_k k[V']) \times_k k[\epsilon] \ar[d] \ar[r] & k[\epsilon] \ar[d] \\
A \times_k k[V'] \ar[r] & k
}
}
$$
Note that
$(A \times_k k[V']) \times_k k[\epsilon] = A \times_k k[V' \oplus k\epsilon]
= A \times_k k[V]$. We claim that $y$ fits into the correct commutative
diagram. To see this we let $y \to y_V$ be a morphism lying over
$A \times_k k[V] \to k[V]$. We can factor the morphisms
$y \to y' \to x_{V'}$ and $y \to x_\epsilon$ through the morphism
$y \to y_V$ (by the axioms of categories cofibred in groupoids).
Hence we see that both $y_V$ and $x_V$ fit into commutative diagrams
$$
\vcenter{
\xymatrix{
y_V \ar[r] \ar[d] & x_\epsilon \ar[d] \\
x_{V'} \ar[r]          & x_0
}
}
\quad\text{and}\quad
\vcenter{
\xymatrix{
x_V \ar[r] \ar[d] & x_\epsilon \ar[d] \\
x_{V'} \ar[r]                 & x_0
}
}
$$
and hence by the second part of (S2) there exists an isomorphism
$y_V \to x_V$ compatible with these diagrams. The composition
$y \to y_V \to x_V$ then fits into the required commutative diagram
$$
\vcenter{
\xymatrix{
y \ar[r] \ar[d] & x_V \ar[d] \\
x \ar[r] & x_0
}
}
\quad\text{lying over}\quad
\vcenter{
\xymatrix{
A \times_k k[V] \ar[d] \ar[r] & k[V] \ar[d] \\
A \ar[r] & k
}
}
$$
In this way we see that the first part of $(S2)$ holds with $k[\epsilon]$
replaced by $k[V]$.

\medskip\noindent
To prove the second part suppose given two commutative
diagrams
$$
\vcenter{
\xymatrix{
y \ar[r] \ar[d] & x_V \ar[d] \\
x \ar[r] & x_0
}
}
\quad\text{and}\quad
\vcenter{
\xymatrix{
y' \ar[r] \ar[d] & x_V \ar[d] \\
x \ar[r] & x_0
}
}
\quad\text{lying over}\quad
\vcenter{
\xymatrix{
A \times_k k[V] \ar[d] \ar[r] & k[V] \ar[d] \\
A \ar[r] & k
}
}
$$
Then we can find morphisms $y \to y_{V'}$ and $y' \to y'_{V'}$
lying over $A \times_k k[V] \to A \times_k k[V']$. By induction hypothesis
we obtain an isomorphism $y_{V'} \to y'_{V'}$ compatible with all
morphisms in sight. Then we use the second part of (S2) once more
to ``lift'' this to an isomorphism $y \to y'$ as desired (some details
omitted).
\end{proof}

\begin{lemma}
\label{lemma-S1-S2-associated-functor}
Let $\mathcal{F}$ be a category cofibered in groupoids over
$\mathcal{C}_\Lambda$. 
\begin{enumerate}
\item If $\mathcal{F}$ satisfies (S1), then so does 
$\overline{\mathcal{F}}$. 
\item If $\mathcal{F}$ satisfies (S2), then so does 
$\overline{\mathcal{F}}$ provided at least one of the following conditions is
satisfied
\begin{enumerate}
\item $\mathcal{F}$ is a predeformation category,
\item the category $\mathcal{F}(k)$ is a set or a setoid, or
\item for any morphism $x_\epsilon \to x_0$ of $\mathcal{F}$
lying over $k[\epsilon] \to k$ the pushforward map
$\text{Mor}_{k[\epsilon]}(x_\epsilon, x_\epsilon)
\to \text{Mor}_k(x_0, x_0)$
is surjective.
\end{enumerate}
\end{enumerate}
\end{lemma}

\begin{proof}
Assume $\mathcal{F}$ has (S1).
Suppose we have ring maps $f_i : A_i \to A$ in $\mathcal{C}_\Lambda$
with $f_2$ surjective. Let $x_i \in \mathcal{F}(A_i)$ such that
the pushforwards $f_{1, *}(x_1)$ and $f_{2, *}(x_2)$ are isomorphic.
Then we can denote $x$ an object of $\mathcal{F}$ over $A$ isomorphic
to both of these and we obtain a diagram as in (S1). Hence we find
an object $y$ of $\mathcal{F}$ over $A_1 \times_A A_2$ whose pushforward
to $A_1$, resp.\ $A_2$ is isomorphic to $x_1$, resp.\ $x_2$. In this way
we see that (S1) holds for $\overline{\mathcal{F}}$.

\medskip\noindent
Assume $\mathcal{F}$ has (S2).
The first part of (S2) for $\overline{\mathcal{F}}$ follows as in
the argument above. The second part of (S2) for
$\overline{\mathcal{F}}$ signifies that the map
$$
\overline{\mathcal{F}}(A \times_{k} k[\epsilon]) \to
\overline{\mathcal{F}}(A)
\times_{\overline{\mathcal{F}}(k)} \overline{\mathcal{F}}(k[\epsilon])
$$
is injective for any ring $A$ in $\mathcal{C}_\Lambda$. Suppose that
$y, y' \in \mathcal{F}(A \times_k k[\epsilon])$. Using the axioms
of cofibred categories we can choose commutative diagrams
$$
\vcenter{
\xymatrix{
y \ar[r]_c \ar[d]_a & x_\epsilon \ar[d]^e \\
x \ar[r]^d          & x_0
}
}
\quad\text{and}\quad
\vcenter{
\xymatrix{
y' \ar[r]_{c'} \ar[d]_{a'} & x'_\epsilon \ar[d]^{e'} \\
x' \ar[r]^{d'}                 & x'_0
}
}
\quad\text{lying over}\quad
\vcenter{
\xymatrix{
A \times_k k[\epsilon] \ar[d] \ar[r] & k[\epsilon] \ar[d] \\
A \ar[r] & k
}
}
$$
Assume that there exist isomorphisms
$\alpha : x \to x'$ in $\mathcal{F}(A)$ and
$\beta : x_\epsilon \to x'_\epsilon$ in $\mathcal{F}(k[\epsilon])$.
This also means there exists an isomorphism $\gamma : x_0 \to x'_0$
compatible with $\alpha$. To prove (S2) for $\overline{\mathcal{F}}$
we have to show that there exists an isomorphism $y \to y'$ in
$\mathcal{F}(A \times_k k[\epsilon])$.
By (S2) for $\mathcal{F}$ such a morphism will exist if we can
choose the isomorphisms $\alpha$ and $\beta$ and $\gamma$ such that
$$
\xymatrix{
x \ar[d]^\alpha \ar[r] & x_0 \ar[d]^\gamma &
x_\epsilon \ar[d]^\beta \ar[l]^e \\
x' \ar[r] & x'_0 & x'_\epsilon \ar[l]_{e'}
}
$$
is commutative. The left hand square commutes by our choice of $\gamma$.
We can factor $e' \circ \beta$ as $\gamma' \circ e$ for some second map
$\gamma' : x_0 \to x'_0$. Now the question is whether we can arrange it so
that $\gamma = \gamma'$? This is clear if $\mathcal{F}(k)$ is a set, or a
setoid. Moreover, if
$\text{Mor}_{k[\epsilon]}(x_\epsilon, x_\epsilon) \to \text{Mor}_k(x_0, x_0)$
is surjective, then we can adjust the choice of $\beta$ by precomposing
with an automorphism of $x_\epsilon$ whose image is
$\gamma^{-1} \circ \gamma'$ to make things work.
\end{proof}

\begin{lemma}
\label{lemma-S1-S2-localize}
Let $\mathcal{F}$ be a category cofibered in groupoids over
$\mathcal{C}_\Lambda$. Let $x \in \text{Ob}(\mathcal{F}(k))$.
Let $\mathcal{F}_x$ be the category cofibred in groupoids over
$\mathcal{C}_\Lambda$ constructed in
Remark \ref{remark-localize-cofibered-groupoid}.
\begin{enumerate}
\item If $\mathcal{F}$ satisfies (S1), then so does $\mathcal{F}_x$. 
\item If $\mathcal{F}$ satisfies (S2), then so does $\mathcal{F}_x$.
\end{enumerate}
\end{lemma}

\begin{proof}
Any diagram as in
Definition \ref{definition-S1-S2}
in $\mathcal{F}_x$ gives rise to a diagram in $\mathcal{F}$
and the output of condition (S1) or (S2) for this diagram in $\mathcal{F}$
can be viewed as an output for $\mathcal{F}_x$ as well.
\end{proof}

\begin{lemma}
\label{lemma-lifting-section}
Let $p: \mathcal{F} \to \mathcal{C}_\Lambda$ be a category cofibered in 
groupoids. Consider a diagram of $\mathcal{F}$
$$
\vcenter{
\xymatrix{
y \ar[r] \ar[d]_a & x_\epsilon \ar[d]_e \\
x \ar[r]^d        & x_0
}
}
\quad\text{lying over}\quad
\vcenter{
\xymatrix{
A \times_k k[\epsilon] \ar[r] \ar[d] & k[\epsilon] \ar[d] \\
A \ar[r] & k.
}
}
$$
in $\mathcal{C}_\Lambda$. Assume $\mathcal{F}$ satisfies (S2).
Then there exists a morphism $s : x \to y$ with $a \circ s = \text{id}_x$
if and only if there exists a morphism $s_\epsilon : x \to x_\epsilon$
with $e \circ s_\epsilon = d$.
\end{lemma}

\begin{proof}
The ``only if'' direction is clear.  Conversely, assume there exists a
morphism $s_\epsilon : x \to x_\epsilon$ with $e \circ s_\epsilon = d$.
Note that $p(s_\epsilon) : A \to k[\epsilon]$ is a ring map compatible
with the map $A \to k$. Hence we obtain
$$
\sigma = (\text{id}_A, p(s_\epsilon)) : A \to A \times_{k} k[\epsilon].
$$
Choose a pushforward $x \to \sigma_*x$. By construction we can factor
$s_\epsilon$ as $x \to \sigma_*x \to x_\epsilon$. Moreover, as $\sigma$
is a section of $A \times_k k[\epsilon] \to A$, we get a morphism
$\sigma_*x \to x$ which is a section of $x \to \sigma_*x$. Because
$e \circ s_\epsilon = d$ we find that the diagram
$$
\xymatrix{
\sigma_*x \ar[r] \ar[d] & x_\epsilon \ar[d]_e \\
x \ar[r]^d        & x_0
}
$$
is commutative. Hence by (S2) we obtain a morphism $\sigma_*x \to y$
such that $\sigma_*x \to y \to x$ is the given map $\sigma_*x \to x$.
The solution to the problem is now to take $a : x \to y$ equal to
the composition $x \to \sigma_*x \to y$.
\end{proof}

\begin{lemma}
\label{lemma-lifting-along-small-extension}
Let $\mathcal{F}$ be a predeformation category.
Consider a diagram in $\mathcal{F}$
$$
\vcenter{
\xymatrix{
y \ar[r] \ar[d] & x_2 \ar[d]^{a_2} \\
x_1 \ar[r]^{a_1}        & x
}
}
\quad\text{lying over}
\vcenter{
\xymatrix{
A' \times_{A} A' \ar[r] \ar[d] & A' \ar[d]^{f} \\
A' \ar[r]^{f} & A
}
}
$$
with $f: A' \to A$ a small extension. Let $I = \text{Ker}(f)$. Consider
the ring map
$$
g : A' \times_{A} A' \longrightarrow k[I] = k \oplus I,\quad
(u, v) \longmapsto \overline{u} \oplus (v - u)
$$
Choose a pushforward $y \to g_*y$. Assume $\mathcal{F}$ satisfies (S2).
If there exists a morphism $x_1 \to g_*y$, then there exists a
morphism $b: x_1 \to x_2$ such that $a_1 =  a_2 \circ b$.
\end{lemma}

\begin{proof}
Note that $\text{id}_{A'} \times g: A' \times_{A} A' \to A' \times_{k} k[I]$
is an isomorphism and that $k[I] \cong k[\epsilon]$. Hence we have a diagram
$$
\vcenter{
\xymatrix{
y \ar[r] \ar[d] & g_*y \ar[d] \\
x_1 \ar[r]        & x_0
}
}
\quad\text{lying over}\quad
\vcenter{
\xymatrix{
A \times_k k[\epsilon] \ar[r] \ar[d] & k[\epsilon] \ar[d] \\
A \ar[r] & k.
}
}
$$
where $x_0$ is an object of $\mathcal{F}$ lying over $k$ (every object
of $\mathcal{F}$ has a unique morphism to $x_0$, see
discussion following Definition \ref{definition-predeformation-category}).
If we have a morphism $x_1 \to g_*y$ then
Lemma \ref{lemma-lifting-section}
provides us with a section $s : x_1 \to y$ of the map $y \to x_1$.
Composing this with the map $y \to x_2$ we obtain $b : x_1 \to x_2$
which has the property that $a_1 =  a_2 \circ b$ because
the diagram of the lemma commutes and because $s$ is a section.
\end{proof}




\section{Tangent spaces}
\label{section-tangent-spaces}

\noindent
First we discuss tangent spaces of functors. Then the tangent space of a 
predeformation category $\mathcal{F} \to \mathcal{C}_\Lambda$ is 
defined as the tangent space of the functor of isomorphism classes 
$\overline{\mathcal{F}}: \mathcal{C}_\Lambda \to \textit{Sets}$.



\subsection{Tangent spaces of functors}
\label{subsection-tangent-spaces-functors}

\noindent
Let $R$ be a ring. We write $\text{Mod}_{R}$ for the category of 
$R$-modules and $\text{f.g.-Mod}_{R}$ for the category of finitely 
generated $R$-modules.

\begin{definition}
\label{definition-linear}
Let $L: \text{f.g.-Mod}_{R} \to \text{Mod}_{R}$ be a 
functor.  We say that $L$ is {\it $R$-linear} if for every $M,N \in 
\text{Ob}(\text{f.g.-Mod}_{R})$ the map $\text{Hom}_{R}(M,N) 
\to \text{Hom}_{R}(L(M),L(N))$ is a map of $R$-modules.
\end{definition}

\begin{remark}
\label{remark-linear-enriched-over-modules}
One can define the notion of an $R$-linearity for any functor between 
categories enriched over $\text{Mod}_{R}$. We made the definition 
specifically for a functor $L: \text{f.g.-Mod}_{R} \to 
\text{Mod}_{R}$ because this is the case that occurs below.
\end{remark}

\begin{remark}
\label{remark-linear-functor}
If $L: \text{f.g.-Mod}_{R} \to \text{Mod}_{R}$ is a 
$R$-linear functor, then $L$ preserves finite products and sends the zero 
module to the zero module, see
Homology, Lemma \ref{homology-lemma-additive-additive}.
On the other hand, if a functor
$\text{f.g.-Mod}_{R} \to \textit{Sets}$ 
preserves finite products and sends the zero module to a one element set, then 
it has a unique lift to a $R$-linear functor (Lemma \ref{lemma-linear-functor}).
\end{remark}

\begin{lemma}
\label{lemma-linear-functor}
Let $L: \text{f.g.-Mod}_{R} \to \textit{Sets}$ be a 
functor.  Suppose $L(0)$ is a one element set and $L$ preserves finite 
products.  Then there exists a unique $R$-linear functor $\widetilde{L}: 
\text{f.g.-Mod}_{R} \to \text{Mod}_{R}$ such that the 
diagram
\[ 
\xymatrix{
& \text{Mod}_{R} \ar[dr]^{\text{forget}} &   \\
\text{f.g.-Mod}_{R}  \ar[ur]^{\widetilde{L}} \ar[rr]^{L} &  & 
\textit{Sets}
}
\]
commutes.
\end{lemma}

\begin{proof}
Let $M$ be a finitely generated $R$-module. We define $\widetilde{L}(M)$ to be 
the set $L(M)$ with the following $R$-module structure.

\medskip \noindent
Multiplication: If $r \in R$, multiplication by $r$ on $L(M)$ is defined to be 
the map $L(M) \to L(M)$ induced by the multiplication map $r \cdot: M 
\to M$.

\medskip \noindent
Addition: The sum map $M \times M \to M: (m_1,m_2) \mapsto m_1 + m_2$ 
induces a map $L(M \times M) \to L(M)$. By assumption $L(M \times M)$ 
is canonically isomorphic to $L(M) \times L(M)$.  Addition on $L(M)$ is defined 
by the map $L(M) \times L(M) \cong L(M \times M) \to L(M)$.

\medskip \noindent
Zero: There is a unique map $0 \to M$.  The zero element of $L(M)$ is 
the image of $L(0) \to L(M)$.

\medskip \noindent
We omit the verification that this defines an $R$-module $\widetilde{L}(M)$, 
the unique such that is $R$-linearly functorial in $M$.
\end{proof}

\begin{lemma}
\label{lemma-morphism-linear-functors}
Let $L_1,L_2: \text{f.g.-Mod}_R \to \textit{Sets}$ be 
functors that take $0$ to a one element set and preserve finite products.  Let 
$t: L_1 \to L_2$ be a morphism of functors. Then $t$ induces a morphism 
$\widetilde{t}: \widetilde{L}_1 \to \widetilde{L}_2$ between the 
functors guaranteed by Lemma \ref{lemma-linear-functor}, which is given simply 
by $\widetilde{t}_M = t_M: \widetilde{L}_1(M) \to \widetilde{L}_2(M)$ 
for each $M \in \text{Ob}(\text{f.g.-Mod}_{R})$. In other words, 
$t_M: \widetilde{L}_1(M) \to \widetilde{L}_2(M)$ is a map of 
$R$-modules.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\noindent
In the case $R = K$ is a field, a $K$-linear functor $L: 
\text{f.g.-Mod}_{K} \to \text{Mod}_{K}$ is determined by 
$L(K)$:

\begin{lemma}
\label{lemma-linear-functor-over-field}
Let $K$ be a field. Let $L: \text{f.g.-Mod}_{K} \to 
\text{Mod}_{K}$ be a $K$-linear functor.  Then $L$ is isomorphic to the 
functor $L(K) \otimes_{K} - : \text{f.g.-Mod}_{K} \to 
\text{Mod}_{K}$.
\end{lemma}

\begin{proof}
For $V \in \text{Ob}(\text{f.g.-Mod}_{K})$, the isomorphism $L(K) 
\otimes_{K} V \to L(V)$ is given on pure tensors by $x \otimes v 
\mapsto L(f_{v})(x)$, where $f_{v}: K \to V$ is the $K$-linear map 
sending $1 \mapsto v$.  When $V = K$, this is the isomorphism $L(K) \otimes_{K} 
K \to L(K)$ given by multiplication by $K$.  For general $V$, it is an 
isomorphism by the case $V = K$ and the fact that $L$ commutes with finite 
products (Remark \ref{remark-linear-functor}).
\end{proof}

\noindent 
For a ring $R$ and an $R$-module $M$, let $R[M]$ be the $R$-algebra whose 
underlying $R$-module is $R \oplus M$ and whose multiplication is given by 
$(r,m) \cdot (r',m') = (rr', rm' + r'm)$.  When $M = R$ this is the ring of 
dual numbers over $R$, which we denote by $R[\epsilon]$.  

\medskip \noindent
Now let $S$ be a ring and assume $R$ is an $S$-algebra.  Then the assignment $M 
\mapsto R[M]$ determines a functor $\text{Mod}_{R} \to S 
\text{-Alg}/R$, where $S \text{-Alg}/R$ denotes the category of 
$S$-algebras over $R$.  Note that $S \text{-Alg}/R$ admits finite 
products: if $A_1 \to R$ and $A_2 \to R$ are two objects, then 
$A_1 \times_{R} A_2$ is a product.

\begin{lemma}
\label{lemma-preserves-products}
Let $R$ be an $S$-algebra. Then the functor $\text{Mod}_{R} \to S 
\text{-Alg}/R$ described above preserves finite products.
\end{lemma}

\begin{proof}
This is merely the statement that if $M$ and $N$ are $R$-modules, then the map 
$R[M \times N] \to R[M] \times_{R} R[N]$ is an isomorphism in $S 
\text{-Alg}/R$.
\end{proof}

\begin{lemma}
\label{lemma-tangent-space-functor}
Let $R$ be an $S$-algebra, and let $\mathcal{C}$ be a full subcategory of $S 
\text{-Alg}/R$ containing $R[M]$ and the product $R[M] \times_{R} R[N]$ 
for all $M,N \in \text{Ob}(\text{f.g.-Mod}_{R})$.  

\smallskip \noindent
Let $F: \mathcal{C} \to \textit{Sets}$ be a functor.  Suppose that 
$F(R)$ is a one element set and that for any $M, N \in 
\text{Ob}(\text{f.g.-Mod}_{R})$, the induced map 
\[ F(R[M] \times_{R} R[N]) \to F(R[M]) \times F(R[N])\]
is a bijection.  Then $F(R[M])$ has a natural $R$-module structure for any $M 
\in \text{Ob}(\text{f.g.-Mod}_{R})$.
\end{lemma}

\begin{proof}
The functor $\text{Mod}_{R} \to S \text{-Alg}/R$ of Lemma 
\ref{lemma-preserves-products} restricts to a functor 
$\text{f.g.-Mod}_{R} \to \mathcal{C}$ by the assumption on 
$\mathcal{C}$. Let $L$ be the composition $\text{f.g.-Mod}_{R} \to 
\mathcal{C} \xrightarrow{F} \textit{Sets}$. Then $L$ preserves finite 
products by Lemma \ref{lemma-preserves-products} and the assumption on $F$.  
Hence Lemma \ref{lemma-linear-functor} shows that $L(M) = F(R[M])$ has a 
natural $R$-module structure for any $M \in 
\text{Ob}(\text{f.g.-Mod}_{R})$.
\end{proof}

\begin{definition}
\label{definition-tangent-space-over-R}
Let $\mathcal{C}$ be a category as in
Lemma \ref{lemma-tangent-space-functor}.  
Let $F: \mathcal{C} \to \textit{Sets}$ be a functor such that 
$F(R)$ is a one element set. The {\it tangent space $TF$ of $F$} is 
$F(R[\epsilon])$.  When $F: \mathcal{C} \to \textit{Sets}$ 
satisfies the hypotheses of
Lemma \ref{lemma-tangent-space-functor},
the tangent space $TF$ has a natural $R$-module structure.
\end{definition}

\begin{example}
\label{example-tangent-space-prorepresentable-functor}
Let $F: \mathcal{C}_\Lambda \to \textit{Sets}$ be a 
prorepresentable functor, say $F \cong \underline{S}|_{\mathcal{C}_\Lambda}$ 
for $S \in \text{Ob}(\widehat{\mathcal{C}}_\Lambda)$.  Then $F$ commutes 
with arbitrary limits and thus satisfies the hypotheses of Lemma 
\ref{lemma-tangent-space-functor} with $R = k$.  There is an isomorphism of 
$k$-vector spaces $TF \cong T_{S/\Lambda}$, where $T_{S/\Lambda}$ is as in 
Definition \ref{definition-tangent-space-ring}.  In particular, since $S$ is 
Noetherian it follows that $\dim_{k} TF$ is finite.
\end{example}


\begin{lemma}
\label{lemma-morphism-tangent-spaces}
Let $F, G: \mathcal{C} \to \textit{Sets}$ be functors satisfying 
the hypotheses of Lemma \ref{lemma-tangent-space-functor}.  Let $t: F 
\to G$ be a morphism of functors.  Then for any $M \in 
\text{Ob}(\text{f.g.-Mod}_{R})$, the map $t_{R[M]}: F(R[M]) 
\to G(R[M])$ is a map of $R$-modules, where $F(R[M])$ and $G(R[M])$ are 
given the $R$-module structure from Lemma \ref{lemma-tangent-space-functor}.  
In particular, $t_{R[\epsilon]} : TF \to TG$ is a map of $R$-modules.
\end{lemma}

\begin{proof}
Follows from Lemma \ref{lemma-morphism-linear-functors}.
\end{proof}

\begin{lemma}
\label{lemma-tangent-space-tensor}
Let $F: \mathcal{C} \to \textit{Sets}$ be a functor satisfying the 
hypotheses of Lemma \ref{lemma-tangent-space-functor}.  Assume $R = K$ is a 
field.  Then $F(K[V]) \cong TF \otimes_{K} V$ for any finite dimensional 
$K$-vector space $V$.
\end{lemma}

\begin{proof}
Follows from Lemma \ref{lemma-linear-functor-over-field}.
\end{proof}

\subsection{Tangent spaces of predeformation categories}
\label{subsection-tangent-spaces}

\begin{definition}
\label{definition-tangent-space}
Let $\mathcal{F}$ be a predeformation category.  The {\it tangent space $T 
\mathcal{F}$ of $\mathcal{F}$} is the set $\overline{\mathcal{F}}(k[\epsilon])$ 
of isomorphism classes of objects in the fiber category $\mathcal 
F(k[\epsilon])$.
\end{definition}

\noindent
Thus $T \mathcal{F}$ is nothing but the tangent space of the associated functor 
$\overline{\mathcal{F}}: \mathcal{C}_\Lambda \to \textit{Sets}$. 
It has a natural vector space structure when $\mathcal{F}$ satisfies (S2), or, 
in fact, as long as $\overline{\mathcal{F}}$ does.

\begin{lemma}
\label{lemma-tangent-space-vector-space}
Let $\mathcal{F}$ be a predeformation category such that
$\overline{\mathcal{F}}$ 
satisfies (S2). Then $T \mathcal{F}$ has a natural $k$-vector space 
structure.
\end{lemma}

\begin{proof}
By definition $\mathcal{C}_\Lambda$ is a full subcategory of 
$\Lambda\text{-Alg}/k$ containing $k[V]$ and $k[V] \times_{k} k[W]$ for 
all finite $k$-vector spaces $V,W$.  By assumption the functor 
$\overline{\mathcal{F}}: \mathcal{C}_\Lambda \to \textit{Sets}$ 
satisfies (S2), so by Lemma \ref{lemma-S2-extensions} it satisfies the 
hypotheses of Lemma \ref{lemma-tangent-space-functor}.  Hence
$T \mathcal{F} = T \overline{\mathcal{F}}$ has a natural $k$-vector
space structure.
\end{proof}

\noindent
A morphism of predeformation categories induces a map on tangent spaces as 
follows.

\begin{definition}
\label{definition-differential}
Let $\varphi: \mathcal{F} \to \mathcal{G}$ be a morphism predeformation 
categories. The {\it differential $d \varphi: T \mathcal{F} \to T 
\mathcal{G}$ of $\varphi$} is the map obtained by evaluating the morphism of 
functors $\overline{\varphi}: \overline{\mathcal{F}} \to  
\overline{\mathcal{G}}$ at $A = k[\epsilon]$.
\end{definition}

\begin{lemma}
\label{lemma-k-linear-differential}
Let $\varphi: \mathcal{F} \to \mathcal{G}$ be a morphism predeformation 
categories. Assume $\overline{\mathcal{F}}$ and $\overline{\mathcal{G}}$ both 
satisfy (S2).  Then $d \varphi: T \mathcal{F} \to T 
\mathcal{G}$ is $k$-linear.
\end{lemma}

\begin{proof}
Follows from Lemma \ref{lemma-morphism-tangent-spaces}.
\end{proof}

\begin{remark}
\label{remark-tangent-space-cofibered-groupoid}
We can globalize the notions of tangent space and differential to arbitrary 
categories cofibered in groupoids as follows. Let $\mathcal{F}$ be a category 
cofibered in groupoids over $\mathcal{C}_\Lambda$, and let $x \in 
\text{Ob}(\mathcal{F}(k))$.  As in Remark 
\ref{remark-localize-cofibered-groupoid}, we get a predeformation category 
$\mathcal{F}_x$.  We define the {\it tangent space $T_x \mathcal{F}$ of 
$\mathcal{F}$ at $x$} to be the tangent space $T \mathcal{F}_x$ of $\mathcal 
F_x$.  Similarly, if $\varphi: \mathcal{F} \to \mathcal{G}$ is a morphism 
of categories cofibered in groupoids over $\mathcal{C}_\Lambda$ and $x \in 
\text{Ob}(\mathcal{F}(k))$, then there is an induced morphism $\varphi_x: 
\mathcal{F}_x \to \mathcal{G}_{\varphi(x)}$.  We define the 
{\it diferential $d_{x} \varphi: T_{x} \mathcal{F} \to T_{\varphi(x)} 
\mathcal{G}$ of $\varphi$ at $x$} to be the map $d \varphi_x: T \mathcal{F}_x 
\to T \mathcal{G}_{\varphi(x)}$.
\end{remark}



\subsection{Miniversal formal objects}
\label{subsection-miniversal-objects-existence}

\begin{definition}
\label{definition-minimal-morphism}
Let $\varphi: \mathcal{F} \to \mathcal{G}$ be a morphism of 
predeformation categories.  We say $\varphi$ is {\it minimal} if $d \varphi: 
 T \mathcal{F} \to T \mathcal{G}$ is bijective.
\end{definition}

\begin{remark}
\label{remark-predeformation-category-minimal-over-iso}
Let $\mathcal{F}$ be a predeformation category.  Then the morphism $\mathcal{F} 
\to \overline{\mathcal{F}}$ is minimal.
\end{remark}

\noindent
The rest of this section is devoted to proving the existence of a minimal 
smooth morphism $U \to \mathcal{F}$ from a prorepresentable functor $U$ 
to a predeformation category $\mathcal{F}$, provided that $\mathcal{F}$ satisfies 
(S1) and (S2) and $\dim_{k} T\mathcal{F}$ is finite.  This amounts to 
constructing a miniversal object for $\mathcal{F}$, defined as follows.

\begin{definition}
\label{definition-miniversal-object}
Let $\mathcal{F}$ be a predeformation category.  Let $\xi$ be a formal object of 
$\mathcal{F}$ lying over $R \in \text{Ob}(\widehat{\mathcal 
C}_\Lambda)$.  We say $\xi$ is {\it minimal} if the corresponding morphism 
$\underline{\xi}: \underline{R}|_{\mathcal{C}_\Lambda} \to \mathcal{F}$ 
of Remark \ref{remark-formal-objects-yoneda} is minimal.  We say $\xi$ is 
{\it miniversal} if it is minimal and versal.
\end{definition}

\begin{remark}
\label{remark-choice-pushforwards-iso-class}
The property of being minimal does not depend on the choices of pushforwards 
needed to define $\underline{\xi}: \underline{R}|_{\mathcal{C}_\Lambda} 
\to \mathcal{F}$.
\end{remark}

\noindent
Minimal objects satisfy the following uniqueness property.

\begin{lemma}
\label{lemma-miniversal-object-unique}
Let $\mathcal{F}$ be a predeformation category.  A miniversal formal object of 
$\mathcal{F}$, if it exists, is unique up to a (non-canonical) isomorphism in 
$\widehat{\mathcal{F}}$.
\end{lemma}

\begin{proof}
Let $\xi$ and $\xi'$ be miniversal formal objects lying over $R$ and $R'$ in 
$\widehat{\mathcal{C}}_\Lambda$.  By
Lemma \ref{lemma-versal-object-quasi-initial}
we have morphisms $a: \xi \to 
\xi'$ and $a': \xi' \to \xi$.  Let $f:R \to R'$ and $f': R' 
\to R$ be the projections of $a$ and $a'$ to $\mathcal{C}_\Lambda$.  
By minimality of $\xi$ and $\xi'$, $f$ and $f'$ induce isomorphisms of tangent 
spaces $T_{R/\Lambda} \xrightarrow{\sim} T_{R'/\Lambda}$ and $T_{R'/\Lambda} 
\xrightarrow{\sim} T_{R/\Lambda}$.  In particular, $f' \circ f: R \to 
R$ is an endomorphism of $R$ inducing a surjection on $T^*_{R/\Lambda}$. This 
implies $f' \circ f$ is a surjection by Lemma 
\ref{lemma-surjective-cotangent-space}. A surjective endomorphism of a 
Noetherian ring is an isomorphism: if $g: S \to S$ were such an 
endomorphism but not injective, then $\text{Ker}(g) \subset 
\text{Ker}(g \circ g) \subset \text{Ker}(g \circ g \circ g) \subset 
\cdots$ would be a strictly increasing chain of ideals.  We conclude $f' \circ 
f$ is an isomorphism.  Similarly $f \circ f'$ is an isomorphism.  Thus $f$ and 
$f'$ are isomorphisms.
\end{proof}

\begin{lemma}
\label{lemma-versal-criterion}
Let $\mathcal{F}$ be a predeformation category satisfying (S1) and 
(S2).  Let $\xi$ be a formal object of $\mathcal{F}$ lying over $R 
\in \text{Ob}(\widehat{\mathcal{C}}_\Lambda)$.  Then $\xi$ is versal if 
and only if the following two conditions hold:
\begin{enumerate}
\item $\underline{\xi}: \underline{R}|_{\mathcal{C}_\Lambda} \to 
\mathcal{F}$ is surjective on tangent spaces, i.e.\ $d\underline{\xi}: T 
\underline{R}|_{\mathcal{C}_\Lambda} \to T\mathcal{F}$ is surjective.
\item If 
\[
\xymatrix{
            &  y \ar[d] \\
\xi \ar[r]  &  x
}
\]
is a diagram in $\widehat{\mathcal{F}}$ lying over
\[
\xymatrix{
         &   B  \ar[d]^{f} \\
R \ar[r] &   A 
}
\]
in $\widehat{\mathcal{C}}_\Lambda$ with $B \to A$ a small extension of 
Artinian rings, then there exists a ring map $R \to B$ such that
\[
\xymatrix{
         &   B  \ar[d]^{f} \\
R \ar[ur] \ar[r] &   A 
}
\]
commutes.
\end{enumerate}
\end{lemma}

\begin{proof}
If $\xi$ is versal then (1) holds by Lemma 
\ref{lemma-smooth-morphism-essentially-surjective} and (2) holds by Remark 
\ref{remark-versal-object}.  Conversely if (1) and (2) hold, we must show that 
given a diagram in $\widehat{\mathcal{F}}$ as in (2), there exists $\xi 
\to y$ such that
\[
\xymatrix{
            &  y \ar[d] \\
\xi \ar[ur] \ar[r]  &  x
}
\]
commutes. Replacing $\xi$ by its pushforward under the map $R \to B$ 
guaranteed by (2), we may assume $\xi \to x$ lies over $f: B 
\to A$.  Then by (S2) we obtain a commutative diagram
\[
\xymatrix{
z  \ar[r] \ar[d]          &  y \ar[d] \\
\xi \ar[r]  &  x
}
\]
in $\mathcal{F}$ lying over
\[
\xymatrix{
B \times_{A} B \ar[d] \ar[r] &   B  \ar[d]^{f} \\
B \ar[r]^{f} &   A .
}
\]
By (1) there exists a morphism $\xi \to w$ for any $w \in \mathcal 
F(k[I])$, where $I = \text{Ker}(f)$.  Hence Lemma 
\ref{lemma-lifting-along-small-extension} applies to give the required morphism 
$\xi \to y$. 
\end{proof}

\begin{lemma}
\label{lemma-miniversal-object-existence-1}
Let $\mathcal{F}$ be a predeformation category.  Assume $\mathcal{F}$ admits a 
minimal smooth morphism $U \to \mathcal{F}$ from a prorepresentable 
functor $U: \mathcal{C}_\Lambda \to \textit{Sets}$.  Then the 
following conditions hold:
\begin{enumerate}
\item $\mathcal{F}$ satisfies (S1).
\item $\mathcal{F}$ satisfies (S2).
\item $\dim_{k} T\mathcal{F}$ is finite.
\end{enumerate}
\end{lemma}

\begin{proof}
By Example \ref{example-tangent-space-prorepresentable-functor}, $\dim_{k} 
T\mathcal{F} = \dim_{k} TU$ is finite . To verify (1) and (2), let $\xi$ be a 
miniversal formal object corresponding to $U \to \mathcal{F}$. Let 
\[
\xymatrix{
           & x_2 \ar[d] \\
x_1 \ar[r] & x   
}
\]
be a diagram in $\mathcal{F}$ such that $x_2 \to x$ lies over a 
surjective ring map. Since the natural morphism $\widehat{\mathcal 
F}|_{\mathcal{C}_\Lambda} \xrightarrow{\sim} \mathcal{F}$ is an equivalence 
(see Remark \ref{remark-completion-restriction-adjoint}), we can consider this 
diagram also as a diagram in $\widehat{\mathcal{F}}$.  By Lemma 
\ref{lemma-versal-object-quasi-initial} there exists a morphism $\xi 
\to x_1$, so by Remark \ref{remark-versal-object} we also get a 
morphism $\xi \to x_2$ making the diagram
\[
\xymatrix{
\xi \ar[r] \ar[d]          & x_2 \ar[d] \\
x_1 \ar[r] & x   
}
\]
commute.  If $x_1 \to x$ and $x_2 \to x$ lie above ring maps 
$A_1 \to A$ and $A_2 \to A$ then taking the pushforward of 
$\xi$ to $A_1 \times_{A} A_2$ gives an object $y$ as required by (S1). The 
first part of (S2) holds since (S1) holds; for the second, let \[
\xymatrix{
A \times_{k} k[\epsilon]  \ar[r]^{p_2} \ar[d]_{p_1}  & k[\epsilon] \ar[d] 
\\
A  \ar[r] & k 
}
\]  
be a diagram in $\mathcal{C}_\Lambda$, and let $a: y \to x$ and $a': 
y' \to x$ be morphisms in $\mathcal{F}$ lying over $p_{1}$ such that 
$(p_2)_{*}y \cong (p_2)_{*}y'$ in $\mathcal{F}(k[\epsilon])$.  As above we 
obtain morphisms $b: \xi \to y$ and $b': \xi \to y'$ such that
\[
\xymatrix{
\xi \ar[r]^{b'} \ar[d]_{b}          & y' \ar[d]^{a'} \\
y \ar[r]^{a} & x   
}
\]
commutes.  Letting $p: \mathcal{F} \to \mathcal{C}_\Lambda$ denote the 
structure morphism, we have in particular $p_1 \circ \widehat{p}(a) = p_2 \circ 
\widehat{p}(a')$.  Since $(p_2)_{*}y \cong (p_2)_{*}y'$ we also have $p_2 \circ 
\widehat{p}(b) = p_2 \circ \widehat{p}(b')$ by minimality of $\xi$.  Thus 
$\widehat{p}(b) = \widehat{p}(b')$, so there exists a unique morphism $c: y 
\to y'$ in $\mathcal{F}(A \times_{k} k[\epsilon])$ such that $b' = c 
\circ b$.  Thus $a \circ b = a' \circ b' = (a' \circ c) \circ b$.  Since $p(a) 
= p(a' \circ c)$ and $\mathcal{F}$ is a category cofibered in groupoids, this 
implies $a = a' \circ c$.  Thus (S2) holds.
\end{proof}

\begin{lemma}
\label{lemma-miniversal-object-existence-2}
Let $\mathcal{F}$ be a predeformation category.  Assume the following conditions 
hold:
\begin{enumerate}
\item $\mathcal{F}$ satisfies (S1).
\item $\mathcal{F}$ satisfies (S2).
\item $\dim_{k} T\mathcal{F}$ is finite.
\end{enumerate}
Then $\mathcal{F}$ admits a minimal smooth morphism $U \to \mathcal{F}$ 
from a prorepresentable functor $U: \mathcal{C}_\Lambda \to 
\textit{Sets}$.
\end{lemma}

\begin{proof}
Assume conditions (1)-(3) hold.  Let $r = \dim_{k} T\mathcal{F}$ and put $S = 
\Lambda[[X_1, \dots, X_r]]$.  Let $J_{1} = \mathfrak{m}{S}$.  We are going to 
inductively construct for $n \geq 2$ pairs $(J_{n}, f_{n-1}: \xi_{n} 
\to \xi_{n-1})$ where $J_{n} \subset S$ is an decreasing sequence of 
ideals and $f_{n-1}: \xi_{n} \to \xi_{n-1}$ is a morphism of $\mathcal 
F$ lying over the projection $S/J_{n} \to S/J_{n-1}$.  We set $R_{n} = 
S/J_{n}$ at each step of the construction.  

\medskip \noindent
Let $J_{2} = \mathfrak{m}_{S}^2 + \mathfrak{m}_\Lambda S$.  Then $R_2 \cong 
k[\epsilon] \times_{k} \cdots \times_{k} k[\epsilon]$, where there are 
$r$ copies of $k[\epsilon]$.  By (S2) for $\overline{\mathcal{F}}$ we get a 
bijection $\overline{\mathcal{F}}(R_2) \xrightarrow{\sim} T \mathcal{F} \oplus 
\cdots \oplus T \mathcal{F}$, where there are $r$ copies of $T\mathcal{F}$.
Thus if we choose a basis $x_1, \dots, x_r$ for $T\mathcal{F}$, we can choose 
$\xi_{2} \in \text{Ob}(\mathcal{F}(R_2))$ such that the pushforward of 
$\xi_{2}$ along the $i$-th projection of $R_2 \cong k[\epsilon] \times_{k} 
\cdots \times_{k} k[\epsilon]$ is isomorphic to $x_i$.  This means the 
induced map $T_{R_{2}/\Lambda} \to T\mathcal{F}$ is an isomorphism.

\medskip \noindent
Assume $(J_{n}, f_{n-1}: \xi_{n} \to \xi_{n-1})$ has been constructed. 
We claim there is a minimal element (with respect to inclusion) of the set 
$\mathcal J_n$ of ideals $J \subset S$ satisfying: (a) $\mathfrak{m}_{S} J_{n} 
\subset J \subset J_{n}$ and (b) there exists a morphism $\eta \to 
\xi_{n}$ lying over $S/J \to S/J_n$.  The set $\mathcal J_n$ is 
nonempty as it contains $J_{n}$.  To prove the claim we must show that 
$\mathcal J_n$ is closed under intersections, i.e.\ that conditions (a) and (b) 
are preserved under intersections. This is clear for (a), and since an element 
$J$ of $\mathcal J_n$ corresponds to a subspace of the finite-dimensional 
$k$-vector space $J_n/\mathfrak{m}_{S}J_n$, it suffices to show (b) is 
preserved under pairwise intersection.  So let $J$ and $K$ be elements of 
$\mathcal J_n$.  We can assume $J+K = J_{n}$ by, if necessary, enlarging $J$ 
without changing $J \cap K$ (to see this is possible, work with $J$ and $K$ as 
$k$-vector spaces).  Then the natural map $S \to S/J \times_{S/J_n} 
S/K$ with kernel $J \cap K$ will be surjective.  Hence $S/(J \cap K) \cong S/J 
\times_{S/J_n} S/K$ and by (S1) it follows that $J \cap K$ is in $\mathcal 
J_n$.  Now we define $J_{n+1}$ to be the minimal element of $\mathcal J_n$ and 
let $f_{n}: \xi_{n+1} \to \xi_{n}$ be any morphism lying over 
$S/J_{n+1} \to S/J_{n}$.

\medskip \noindent
Let $J = \bigcap J_{n}$ and let $R$ be the complete Noetherian local 
$\Lambda$-algebra $S/J$.  Let $I_n$ be the image of $J_n$ in $R$. Then 
$(\xi_{n}, f_{n}: \xi_{n+1} \to \xi_{n})$ is an object of 
$\widehat{\mathcal{F}}_{\mathcal{I}}(R)$, where $\mathcal{I}$ is the filtration 
$(I_{n})$ (see Lemma \ref{lemma-formal-objects-different-filtration} and the 
remarks preceding it).  We prove that the $(I_n)$ induces the 
$\mathfrak{m}_R$-adic topology on $R$, so that by Lemma $(\xi_{n}, f_{n}: 
\xi_{n+1} \to \xi_{n})$ induces an object of $\widehat{\mathcal{F}}(R)$. 
 By construction we have $\mathfrak{m}_{S}^n \subset J_n$ for all $n$, hence we 
have exact sequences
\[ 0 \to J_n/\mathfrak{m}_{S}^n \to S/\mathfrak{m}^n_{S} 
\to S/J_{n} \to 0 \]
which form an exact sequence of directed inverse systems.  The system 
$(J_n/\mathfrak{m}_{S}^n)$ is Mittag-Leffler since each 
$J_n/\mathfrak{m}_{S}^n$ is Artinian, hence by
Algebra, Lemma \ref{algebra-lemma-ML-exact-sequence}
taking limits gives an exact sequence
\[ 0 \to J \to S \to \lim S/J_n \to 0 .\]
This shows $R \cong \lim S/J_n \cong \lim R/I_n$, so the filtration $(I_n)$ of 
$R$ induces the $\mathfrak{m}_{R}$-adic topology.

\medskip \noindent
Let $\eta = (R, \eta_{n}, g_n: \eta_{n+1} \to \eta_{n})$ be the formal 
object of $\mathcal{F}$ induced by $(\xi_{n}, f_{n}: \xi_{n+1} \to 
\xi_{n})$. We prove $\eta$ is miniversal. It follows from the choice of 
$\xi_{2}$ that $\eta$ is minimal.  For versality it thus suffices to check 
condition (2) of Lemma \ref{lemma-versal-criterion}.  So let
\[
\xymatrix{
            &  y \ar[d] \\
\eta \ar[r]  &  x
}
\]
be a diagram in $\widehat{\mathcal{F}}$ lying over
\[
\xymatrix{
         &   B  \ar[d]^{f} \\
R \ar[r] &   A 
}
\]
in $\widehat{\mathcal{C}}_\Lambda$ with $f: B \to A$ a small extension 
of Artinian rings. Then for some $n$, $R \to A$ factors through $R 
\to R_{n}$ and the pushforward of $\eta$ along $R \to R_n$ is 
$\xi_{n}$, so that we get a diagram
\[
\xymatrix{
            &  y \ar[d] \\
\xi_{n} \ar[r]  &  x
}
\]
in $\mathcal{F}$ lying over
\[
\xymatrix{
         &   B  \ar[d]^{f} \\
R_n \ar[r] &   A .
}
\]
To check condition (2) of Lemma \ref{lemma-versal-criterion} it suffices to 
complete the diagram
\[
\xymatrix{
R_{n+1} \ar[d] \ar@{-->}[r] & B \ar[d]^{f} \\
R_{n}   \ar[r] & A 
}
\]
or equivalently, to complete the diagram
\[
\xymatrix{
  &  R_{n} \times_{A} B \ar[d]^{p_1} \\
R_{n+1} \ar@{-->}[ur] \ar[r] &  R_{n} .
}
\]
If $p_1$ has a section we are done.  If not, note that by Lemma 
\ref{lemma-fiber-product-CLambda} (2) $p_1$ is a small extension, so by Lemma 
\ref{lemma-essential-surjection} (2) $p_1$ is an essential surjection. By the 
universal property of $S = \Lambda[[X_1, \dots, X_2]]$ choose a map $S 
\to B$ such that $S \to B \to A$ equals $S \to 
R_{n} \to A$.  This induces a map $g: S \to R_{n} \times_{A} B$ 
making the solid square in the diagram
\[
\xymatrix{
S \ar[d] \ar[r]^{g}  &  R_{n} \times_{A} B \ar[d]^{p_1} \\
R_{n+1} \ar@{-->}[ur] \ar[r] &  R_{n}
}
\]
commute. Then $g$ is a surjection since $p_1$ is an essential surjection. The 
ideal $K = \text{Ker}(g)$ of $S$ satisfies conditions (a) and (b) 
defining the set of ideals $\mathcal J_n$ from above: $\mathfrak{m}_SJ_n 
\subset K \subset J_n$ by construction, so (a) holds; by (S1) 
applied to
\[
\xymatrix{
            &  y \ar[d] \\
\xi_{n} \ar[r]  &  x,
}
\]
there exists a lifting of $\xi_n$ to $S/K \cong R_{n} \times_{A} B$, so (b) 
holds.  Since $J_{n+1}$ was chosen to be the minimal element of $\mathcal J_n$, 
this implies $J_{n+1} \subset K$.  Thus the desired map $R_{n+1} \to 
S/K \cong R_{n} \times_{A} B$ exists.
\end{proof}


\begin{theorem}
\label{theorem-miniversal-object-existence}
Let $\mathcal{F}$ be a predeformation category.  Then $\mathcal{F}$ admits a 
minimal smooth morphism $U \to \mathcal{F}$ from a prorepresentable 
functor $U: \mathcal{C}_\Lambda \to \textit{Sets}$ if and only 
if the following conditions hold:
\begin{enumerate}
\item $\mathcal{F}$ satisfies (S1).
\item $\mathcal{F}$ satisfies (S2).
\item $\dim_{k} T\mathcal{F}$ is finite.
\end{enumerate}
\end{theorem}

\begin{proof}
Follows from Lemmas \ref{lemma-miniversal-object-existence-1} and 
\ref{lemma-miniversal-object-existence-2}.
\end{proof}

\begin{remark}
\label{remark-compare-schlessinger-H3}
When $\mathcal{F}$ is a predeformation functor, the condition that $\dim_{k} 
T\mathcal{F}$ is finite is precisely condition (H3) from Schlessinger's paper. 
In this case, Theorem \ref{theorem-miniversal-object-existence} recovers 
Schlessinger's theorem on the existence of ``hulls.''
\end{remark}

\begin{remark}
\label{remark-compose-minimal-into-iso-classes}
Let $\mathcal{F}$ be a predeformation category satisfying the conditions of 
Theorem \ref{theorem-miniversal-object-existence}. Then $\overline{\mathcal{F}}$ 
satisfies the same conditions, so $\mathcal \overline{\mathcal{F}}$ admits a 
minimal smooth morphism from a prorepresentable functor.  In fact, if $U 
\to \mathcal{F}$ is the morphism guaranteed by Theorem 
\ref{theorem-miniversal-object-existence}, then the composition $U \to 
\mathcal{F} \to \overline{\mathcal{F}}$ is a minimal smooth morphism.  
This follows from the fact that $\mathcal{F} \to \overline{\mathcal{F}}$ 
is a minimal smooth morphism.
\end{remark}


\section{Deformation Categories and Presentations}
\label{section-deformation-groupoids-presentations}

\noindent
In this section we introduce conditions on a predeformation category which 
guarantee the existence of a presentation by a minimal smooth prorepresentable 
groupoid in functors on $\mathcal{C}_\Lambda$ (as defined in
Subsection \ref{subsection-presentations}).

\subsection{The Rim-Schlessinger condition and deformation categories}
\label{subsection-RS-condition}

\begin{definition}
\label{definition-RS}
Let $\mathcal{F}$ be a category cofibered in groupoids over $\mathcal 
C_\Lambda$.  We say that $\mathcal{F}$ satisfies {\it condition (RS)}
if for every diagram
\[
\xymatrix{
           & x_2 \ar[d] \\
x_1 \ar[r] & x   
}
\]
in $\mathcal{F}$ lying over
\[
\xymatrix{
           & A_2 \ar[d] \\
A_1 \ar[r] & A   
}
\]  
in $\mathcal{C}_\Lambda$ with $A_2 \to A$ surjective, there exits a 
fiber product $x_1 \times_{x} x_2$ in $\mathcal{F}$ such that the diagram
\[
\xymatrix{
x_1 \times_{x} x_2 \ar[r] \ar[d] & x_2 \ar[d] \\
x_1 \ar[r]      & x   
}
\]
lies over
\[
\xymatrix{
A_1 \times_{A} A_2 \ar[r] \ar[d] & A_2 \ar[d] \\
A_1 \ar[r]      & A.   
}
\]
\end{definition}

\begin{lemma}
\label{lemma-RS-fiber-square}
Let $\mathcal{F}$ be a category cofibered in groupoids over $\mathcal 
C_\Lambda$ satisfying (RS).  If
\[
\xymatrix{
y \ar[r] \ar[d] & x_2 \ar[d]   \\
x_1 \ar[r]      & x  
}
\]
is a commutative diagram in $\mathcal{F}$ lying over
\[
\xymatrix{
A_1 \times_{A} A_2 \ar[r] \ar[d] & A_2 \ar[d] \\
A_1 \ar[r]      & A.   
}
\]
with $A_2 \to A$ surjective, then it is a fiber square.
\end{lemma}

\begin{proof}
Since $\mathcal{F}$ satisfies (RS), there exists a fiber product diagram
\[
\xymatrix{
x_1 \times_{x} x_2 \ar[r] \ar[d] & x_2 \ar[d] \\
x_1 \ar[r]      & x   
}
\]
lying over 
\[
\xymatrix{
A_1 \times_{A} A_2 \ar[r] \ar[d] & A_2 \ar[d] \\
A_1 \ar[r]      & A.   
}
\]
The induced map $y \to x_1 \times_{x} x_2$ lies over $\text{id}: 
A_1 \times_{A} A_1 \to A_1 \times_{A} A_1$, hence it is an isomorphism.
\end{proof}

\begin{lemma}
\label{lemma-RS-small-extension}
Let $\mathcal{F}$ be a category cofibered in groupoids over $\mathcal 
C_\Lambda$. Then $\mathcal{F}$ satisfies (RS) if the condition in 
Definition \ref{definition-RS} is assumed to hold only when $A_2 \to A$ 
is a small extension. 
\end{lemma}

\begin{proof}
Apply Lemma \ref{lemma-factor-small-extension}.  The proof is similar to that 
of Lemma \ref{lemma-smoothness-small-extensions}.
\end{proof}

\begin{remark}
\label{remark-RS-2-categorical}
Let $\mathcal{F}$ be a category cofibered in groupoids over $\mathcal 
C_\Lambda$.  Let
\[
\xymatrix{
A_1 \times_{A} A_2 \ar[r] \ar[d] & A_2 \ar[d] \\
A_1 \ar[r]     & A.   
}
\]
be a diagram in $\mathcal{C}_\Lambda$.  Choices of pushforwards along the maps 
in the diagram determine a $2$-commutative diagram of functors
\[
\xymatrix{
\mathcal{F}(A_1 \times_{A} A_2) \ar[r] \ar[d] & \mathcal{F}(A_2) \ar[d] \\
\mathcal{F}(A_1)                \ar[r]        & \mathcal{F}(A) .
}
\]
Hence there is an induced functor $\mathcal{F}(A_1 \times_{A} A_2) \to 
\mathcal{F}(A_1) \times_{\mathcal{F}(A)} \mathcal{F}(A_2)$.  Unwinding the 
definitions and using Lemma \ref{lemma-RS-fiber-square} shows that $\mathcal{F}$ 
satisfies (RS) if and only if this induced functor is an equivalence of 
categories whenever $A_2 \to A$ is surjective (or equivalently, by 
Lemma \ref{lemma-RS-small-extension}, whenever $A_2 \to A$ is a small 
extension).
\end{remark}

\begin{remark}
\label{remark-compare-schlessinger-H4}
When $\mathcal{F}$ is cofibered in sets, condition (RS) is exactly condition 
(H4) from Schlessinger's paper \cite[Theorem 2.11]{Sch}.  Namely, for 
a functor $F: \mathcal{C}_\Lambda \to \textit{Sets}$, condition 
(RS) states: If $A_1 \to A$ and $A_2 \to A$ are maps in 
$\mathcal{C}_\Lambda$ with $A_2 \to A$ surjective, then the induced 
map $F(A_1 \times_{A} A_2) \to F(A_1) \times_{F(A)} F(A_2)$ is 
bijective.
\end{remark}

\begin{lemma}
\label{lemma-RS-implies-S1-S2}
The condition (RS) implies both (S1) and (S2).
\end{lemma}

\begin{proof}
Clearly (RS) implies (S1).  The fact that (RS) implies (S2) follows from Lemma 
\ref{lemma-RS-fiber-square}.
\end{proof}

\noindent
In Lemma \ref{lemma-S1-S2-associated-functor} we saw that the conditions (S1) 
and (S2) on a category cofibered in groupoids always pass to the associated 
functor of isomorphism classes. This is not true for the condition (RS), but 
the following lemma gives a necessary and sufficient condition for it to 
happen.  To state this condition, we note that if $\mathcal{F}$ is a category 
cofibered in groupoids over $\mathcal{C}_\Lambda$ and $x' \to x$ is a 
morphism in $\mathcal{F}$ lying over $A' \to A$, then there is an 
induced homomorphism
\[ \text{Aut}_{A'}(x') \to \text{Aut}_{A}(x). \]
Here $\text{Aut}_{A}(x)$ denotes the group of automorphisms of $x$ in the 
fiber category $\mathcal{F}(A)$.

\begin{lemma}
\label{lemma-RS-associated-functor}
Let $\mathcal{F}$ be a category cofibered in groupoids over $\mathcal 
C_\Lambda$ satisfying (RS).  The following conditions are 
equivalent: 
\begin{enumerate}
\item $\overline{\mathcal{F}}$ satisfies (RS).
\item Let $f_1: A_1 \to A$ and $f_2: A_2 \to A$ be ring maps in 
$\mathcal{C}_\Lambda$ with $f_2$ surjective. Assume choices of pushforwards 
along $f_1$ and $f_2$ have been made.  Then the induced morphism
\[
\overline{\mathcal{F}(A_1) \times_{\mathcal{F}(A)} \mathcal{F}(A_2)}
\to \overline{\mathcal{F}}(A_1) \times_{\overline{\mathcal{F}}(A)} 
\overline{\mathcal{F}}(A_2)
\]
is injective.  Here $ \overline{\mathcal{F}(A_1) \times_{\mathcal{F}(A)} \mathcal 
F(A_2)}$ denotes the set of isomorphism classes.
\item For every morphism $x' \to x$ in $\mathcal{F}$ lying over a 
surjective ring map $A' \to A$, the map $\text{Aut}_{A'}(x') 
\to \text{Aut}_{A}(x)$ is surjective.
\item For every morphism $x' \to x$ in $\mathcal{F}$ lying over a small 
extension $A' \to A$, the map $\text{Aut}_{A'}(x') \to 
\text{Aut}_{A}(x)$ is surjective.
\end{enumerate}
\end{lemma}

\begin{proof}
We prove that (1) is equivalent to (2) and (2) is equivalent to (3).  The 
equivalence of (3) and (4) follows from Lemma 
\ref{lemma-factor-small-extension}.  

\medskip \noindent
Let $f_1: A_1 \to A$ and $f_2: A_2 \to A$ be ring maps in 
$\mathcal{C}_\Lambda$ with $f_2$ surjective.  As noted in Remark 
\ref{remark-RS-2-categorical}, $\overline{\mathcal{F}}$ satisfies (RS) if and 
only if the map
\[ 
\overline{\mathcal{F}}(A_1 \times_{A} A_2) \to \overline{\mathcal 
F}(A_1) \times_{\overline{\mathcal{F}}(A)} \overline{\mathcal{F}}(A_2)
\]
is bijective for any such $f_1,f_2$. This map is at least surjective since that 
is the condition of (S1) and $\overline{\mathcal{F}}$ satisfies (S1) by Lemma 
\ref{lemma-S1-S2-associated-functor}.  Moreover, this map factors as
\[ 
\overline{\mathcal{F}}(A_1 \times_{A} A_2) 
\xrightarrow{\sim} \overline{\mathcal{F}(A_1) \times_{\mathcal{F}(A)} \mathcal 
F(A_2)}
\to \overline{\mathcal{F}}(A_1) \times_{\overline{\mathcal{F}}(A)} 
\overline{\mathcal{F}}(A_2),
\]
where the first map is a bijection since 
\[
\mathcal{F}(A_1 \times_{A} A_2) \to \mathcal{F}(A_1) \times_{\mathcal 
F(A)} \mathcal{F}(A_2)
\]
is an equivalence by (RS) for $\mathcal{F}$.  Hence (1) is equivalent to (2).

\medskip \noindent
Assume (2) holds.  Let $x' \to x$  be a morphism in $\mathcal{F}$ lying 
over a surjective ring map $f: A' \to A$.  Let $a \in 
\text{Aut}_{A}(x)$.  Choose pushforwards for objects of $\mathcal{F}(A')$ 
along $f$ such that $x' \to f_* x$ equals $x' \to x$. Then the 
objects
\[ (x',x', a: x \to x), (x',x', \text{id}: x \to x) \]
of $\mathcal{F}(A') \times_{\mathcal{F}(A)} \mathcal{F}(A')$ have the same image 
in $\overline{\mathcal{F}}(A') \times_{\overline{\mathcal{F}}(A)} 
\overline{\mathcal{F}}(A')$.  By (2) there exists maps $b_1,b_2: x' \to 
x'$ such that
\[ 
\xymatrix{
x \ar[r]^{a} \ar[d]_{f_*b_1} & x \ar[d]^{f_*b_2} \\
x \ar[r]^{\text{id}} & x
}
\]
commutes.  Then $b_2^{-1} \circ b_1 \in \text{Aut}_{A'}(x')$ has image $a 
\in \text{Aut}_{A}(x)$.  Hence (3) holds.

\medskip \noindent
Assume (3) holds. Suppose
\[ (x_1,x_2, a: (f_1)_*x_1 \to (f_2)_*x_2), (x'_1,x'_2, a': (f_1)_*x'_1 
\to (f_2)_*x'_2) \]
are objects of $\mathcal{F}(A_1) \times_{\mathcal{F}(A)} \mathcal{F}(A_2)$ with 
the same image in $\overline{\mathcal{F}}(A_1) \times_{\overline{\mathcal{F}}(A)} 
\overline{\mathcal{F}}(A_2)$. Then there are morphisms $b_1: x_1 \to 
x'_1$ in $\mathcal{F}(A_1)$ and $b_2: x_2 \to x'_2$ in $\mathcal 
F(A_2)$. By (3) we can modify $b_2$ by an automorphism of $x_2$ over $A_2$ so 
that the diagram
\[
\xymatrix{
(f_1)_*x_1 \ar[r]^{a} \ar[d]_{(f_1)_*b_1} & (f_2)_*x_2 \ar[d]^{(f_2)_*b_2} \\
(f_1)_*x'_1 \ar[r]^{a'} & (f_2)_*x'_2.
}
\]
commutes. This proves $(x_1,x_2, a) \cong (x'_1,x'_2,a')$ in 
$\overline{\mathcal{F}(A_1) \times_{\mathcal{F}(A)} \mathcal{F}(A_2)}$.  Hence (2) 
holds.
\end{proof}

\noindent
Finally we define the notion of a deformation category.

\begin{definition}
\label{definition-deformation-category}
A {\it deformation category} is a predeformation category $\mathcal{F}$ 
satisfying (RS).  A morphism of deformation categories is a morphism of 
predeformation categories.
\end{definition}

\begin{remark}
\label{remark-deformation-functor}
We say that a functor $F: \mathcal{C}_\Lambda \to \textit{Sets}$ 
is a {\it deformation functor} if the associated cofibered set is a 
deformation category, i.e.\ if $F(k)$ is a one element set and $F$ satisfies 
(RS).  If $\mathcal{F}$ is a deformation category, then $\overline{\mathcal{F}}$ 
is a predeformation functor but not necessarily a deformation functor, as
Lemma \ref{lemma-RS-associated-functor} shows.
\end{remark}

\begin{example}
\label{example-prorepresentable-deformation-functor}
A prorepresentable functor is a deformation functor: for any $R \in 
\text{Ob}(\widehat{\mathcal{C}}_\Lambda)$ there is a unique morphism $R 
\to k$, so $F(k)$ is a one element set; and $F$ commutes with arbitrary 
limits, so in particular satisfies (RS).
\end{example}

\noindent
The following is one of our typical remarks on passing from a category 
cofibered in groupoids to the predeformation category at a point over $k$: it 
says that this process preserves (RS).

\begin{lemma}
\label{lemma-localize-RS}
Let $\mathcal{F}$ be a category cofibered in groupoids over $\mathcal 
C_\Lambda$ satisfying (RS). Let $x \in \text{Ob}(\mathcal 
F(k))$.  Then $\mathcal{F}_{x}$ is a deformation category.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\subsection{Lifts of objects}
\label{subsection-lifts}

\begin{definition}
\label{definition-lifts}
Let $\mathcal{F}$ be a category cofibered in groupoids over $\mathcal 
C_\Lambda$.  Let $f: A' \to A$ be a map in $\mathcal{C}_\Lambda$.  
Let $x \in \mathcal{F}(A)$.  The {\it category $\mathcal{L}\textit{ift}(x,f)$ 
of lifts of $x$ along $f$} is the category with the following objects and 
morphisms. 
\begin{enumerate}
\item Objects: A {\it lift of $x$ along $f$} is a morphism $x' \to x$ 
lying over $f$.  
\item Morphisms: A {\it morphism} from a lift $a_1: x'_{1} \to x$ to a 
lift $a_2: x'_{2} \to x$ is a morphism $b: x'_1 \to x'_2$ in 
$\mathcal{F}(A')$ such that $a_2 = a_1 \circ b$.
\end{enumerate}
The {\it set $\text{Lift}(x,f)$ of lifts of $x$ along $f$} is the set of 
isomorphism classes of $\mathcal{L}\textit{ift}(x,f)$.
\end{definition}

\begin{remark}
\label{remark-omit-arrow}
When the map $f: A' \to A$ is clear from the context, we may write 
$\mathcal{L}\textit{ift}(x,A')$ and $\text{Lift}(x,A')$ in place of 
$\mathcal{L}\textit{ift}(x,f)$ and $\text{Lift}(x,f)$. 
\end{remark}

\begin{remark}
\label{remark-tangent-space-lifting}
Let $\mathcal{F}$ be a deformation category (or even just a predeformation 
category such that $\overline{\mathcal{F}}$ satisfies (S2), so that $\mathcal{F}$ 
has vector space structure on its tangent space).  Let $x_0 \in 
\text{Ob}(\mathcal{F}(k))$.  Then $\text{Lift}(x_0, k[I]) = 
\overline{\mathcal{F}}(k[I])$. Hence by Lemma \ref{lemma-tangent-space-tensor}, 
$\text{Lift}(x_0, k[I])$ is bijective to the vector space $T\mathcal{F} 
\otimes_{k} I$.
\end{remark}

\begin{remark}
\label{remark-lift-bijections}
Let $\mathcal{F}$ be a category cofibered in groupoids over $\mathcal 
C_\Lambda$ satisfying (RS).  Let
\[
\xymatrix{ 
A_1 \times_{A} A_2 \ar[r] \ar[d] & A_2 \ar[d] \\
A_1 \ar[r] & A
}
\]
be a commutative diagram in $\mathcal{C}_\Lambda$ such that $A_1 \to 
A$ is surjective.  Let $x \in \text{Ob}(\mathcal{F}(A))$. Given lifts $x_1 
\to x$ and $x_2 \to x$ of $x$ to $A_1$ and $A_2$, we get by 
(RS) a lift $x_1 \times_{x} x_2 \to x$ of $x$ to $A_1 \times_{A} A_2$. 
It is easy to see that this defines a bijection
\[ \text{Lift}(x,A_1) \times \text{Lift}(x,A_2) \xrightarrow{\sim} 
\text{Lift}(x, A_1 \times_{A} A_2) .\]
Similarly, if $x_1 \to x$ is a fixed lifting of $x$ to $A_1$, then 
there is a bijection
\[ \text{Lift}(x_1, A_1 \times_{A} A_2) \xrightarrow{\sim} 
\text{Lift}(x, A_2) .\]

\medskip \noindent 
For use in Lemma \ref{lemma-free-transitive-action}, we also record the 
following bijection of liftings.  Let
\[
\xymatrix{
A_1' \times_{A} A_2 \ar[r] \ar[d] & A_1 \times_{A} A_2 \ar[r] \ar[d] & A_2 
\ar[d] \\
A_1' \ar[r] & A_1 \ar[r] & A
}
\]
be a commutative diagram in $\mathcal{C}_\Lambda$ with $A'_1 \to A_1$ 
and $A_1 \to A$ surjective.  Let $x_1 \to x$ be a morphism 
lying over $A_1 \to A$.  Then by the above we have bijections
\begin{eqnarray*}
\text{Lift}(x_1,A_1' \times_{A} A_2) & \xrightarrow{\sim} & 
\text{Lift}(x_1,A_1') \times \text{Lift}(x_1, A_1 \times_{A} A_2) 
\\ 
& \xrightarrow{\sim} & \text{Lift}(x_1,A_1') \times \text{Lift}(x, 
A_2).
\end{eqnarray*}
\end{remark}

\begin{lemma}
\label{lemma-free-transitive-action}
Let $\mathcal{F}$ be a deformation category.  Let $A' \to A$ be a 
surjective ring map in $\mathcal{C}_\Lambda$ whose kernel $I$ is annihilated 
by $\mathfrak{m}_{A'}$.  Let $x \in \text{Ob}(\mathcal{F}(A))$.  If 
$\text{Lift}(x,A')$ is nonempty, then it has a free and transitive action 
by $T\mathcal{F} \otimes_{k} I$. 
\end{lemma}

\begin{proof}
There is an isomorphism
\[ A' \times_{A} A' \xrightarrow{\sim} A' \times_{k} k[I] \]
given by $(a_1,a_2) \mapsto (a_1, q(a_1) + a_2 - a_1)$ where $q: A' \to 
A'/\mathfrak{m}_{A'} = k$.  This isomorphism commutes with the projections to 
$A'$ on the first factor, and hence with the projections of to $A' \times_{A} 
A'$ and $A' \times_{k} k[I]$ to $A$. Thus there is a bijection
\[ 
\text{Lift}(x, A' \times_{A} A') \xrightarrow{\sim} \text{Lift}(x, 
A' \times_{k} k[I])  \hspace{4 mm} (1).\]
By Remark \ref{remark-lift-bijections} there is a bijection
\[ 
\text{Lift}(x,A') \times \text{Lift}(x,A') \xrightarrow{\sim} 
\text{Lift}(x, A' \times_{A} A') \hspace{4 mm} (2).\]
There is a commutative diagram
\[
\xymatrix{
A' \times_{k} k[I] \ar[r] \ar[d] & A \times_{k} k[I] \ar[r] \ar[d] & k[I] 
\ar[d] \\
A' \ar[r] & A \ar[r] & k.
}
\]
Thus if we choose a pushforward $x \to x_0$ of $x$ along $A \to 
k$, we obtain by the end of Remark \ref{remark-lift-bijections} a bijection
\[
\text{Lift}(x, A' \times_{k} k[I]) \xrightarrow{\sim} 
\text{Lift}(x,A') \times \text{Lift}(x_0,k[I]) \hspace{4 mm} (3).
\]
Taking bijection (2) followed by (1) followed by (3) and then using Remark 
\ref{remark-tangent-space-lifting}, we get a bijection
\[ \Phi: \text{Lift}(x,A') \times \text{Lift}(x,A') 
\xrightarrow{\sim} \text{Lift}(x,A') \times (T\mathcal{F} \otimes_{k} I). 
\]
This bijection commutes with the projections on the first factors. If 
$\text{pr}_2$ is the second projection of $\text{Lift}(x,A') \times 
\text{Lift}(x,A')$, then we get a map
\[ \text{pr}_2 \circ \Phi^{-1}: \text{Lift}(x,A') \times (T\mathcal{F} 
\otimes_{k} I) \to \text{Lift}(x,A').\]
We omit the verification that this defines an action of $T\mathcal{F} 
\otimes_{k} I$ on $\text{Lift}(x,A')$.  It is free and transitive because 
$\Phi$ is bijective.
\end{proof} 

\begin{remark}
\label{remark-free-transitive-action-functorial}
The action of Lemma \ref{lemma-free-transitive-action} is functorial with 
respect to morphisms of deformation categories in the following sense.  Let 
$\varphi: \mathcal{F} \to \mathcal{G}$ be a morphism of deformation 
categories.  Let $A' \to A$ be a surjective ring map whose kernel $I$ 
is annihilated by $\mathfrak{m}_{A'}$. Let $x \in \text{Ob}(\mathcal 
F(A))$.  In this situation $\varphi$ induces a map $\text{Lift}(x, A') 
\to \text{Lift}(\varphi(x),A')$, denoted still by $\varphi$, and 
there is a a map $d\varphi \otimes \text{id}: T\mathcal{F} \otimes_{k} I 
\to T\mathcal{G} \otimes_{k} I$. Denoting the action of $v \in TF 
\otimes_{k} I$ on a lifting $a \in \text{Lift}(x,A')$ by $a \cdot v$, the 
functoriality with respect to $\varphi$ is: $\varphi(a \cdot v) = \varphi(a) 
\cdot (d\varphi \otimes \text{id}(v))$.
\end{remark}




\subsection{Schlessinger's theorem on prorepresentable functors}
\label{subsection-schlessingers-theorem}

\noindent
We deduce Schlessinger's theorem characterizing prorepresentable functors on 
$\mathcal{C}_\Lambda$.

\begin{lemma}
\label{lemma-minimal-smooth-morphism-functors}
Let $F,G: \mathcal{C}_\Lambda \to \textit{Sets}$ be deformation 
functors.  Let $\varphi: F \to G$ be a minimal smooth morphism. Then 
$\varphi$ is an isomorphism.
\end{lemma}

\begin{proof}
We prove $F(A) \to G(A)$ is a bijection for all $A \in 
\text{Ob}(\mathcal{C}_\Lambda)$ by induction on 
$\text{length}_{A}(A)$.  For $A = k$ the statement follows from the 
assumption that $F$ and $G$ are deformation functors. Suppose that the 
statement holds for rings of length less than $n$ and let $A'$ be a ring of 
length $n$. Choose a small extension $f: A' \to A$.  We have a 
commutative diagram
\[
\xymatrix{
F(A') \ar[r] \ar[d] & G(A') \ar[d] \\
F(A) \ar[r]^{\sim} & G(A)
}
\]
where the map $F(A) \to G(A)$ is a bijection.  By smoothness of $F 
\to G$, $F(A') \to G(A')$ is surjective (Lemma 
\ref{lemma-smooth-morphism-essentially-surjective}).  Thus we can check 
bijectivity by checking it on fibers $F(f)^{-1}(x) \to 
G(f)^{-1}(\varphi(x))$ for $x \in F(A)$ such that $F(f)^{-1}(x)$ is nonempty.  
These fibers are precisely $\text{Lift}(x,A')$ and 
$\text{Lift}(\varphi(x),A')$ and by minimality of $\varphi$ we have an 
isomorphism $d\varphi \otimes \text{id}: TF \otimes_{k} I 
\xrightarrow{\sim} TG \otimes_{k} I$.  Thus, by Lemma 
\ref{lemma-free-transitive-action} and Remark 
\ref{remark-free-transitive-action-functorial}, for $x \in F(A)$ such that 
$F(f)^{-1}(x)$ is nonempty the map $F(f)^{-1}(x) \to 
G(f)^{-1}(\varphi(x))$ is a map of sets commuting with free transitive actions 
by $TF \otimes_{k} I$; hence it is bijective.
\end{proof}

\begin{theorem}
\label{lemma-Schlessinger-prorepresentability}
Let $F: \mathcal{C}_\Lambda \to \textit{Sets}$ be a functor.  
Then $F$ is prorepresentable if and only if it is a deformation functor and 
$\dim_k TF$ is finite.
\end{theorem}

\begin{proof}
If $F$ is prorepresentable, then $F$ is a deformation functor by Example 
\ref{example-prorepresentable-deformation-functor} and $\dim_k TF$ is finite by 
Example \ref{example-tangent-space-prorepresentable-functor}.  Conversely, if 
$F$ is a deformation functor and $\dim_k TF$ is finite, then by Theorem 
\ref{theorem-miniversal-object-existence} there exists a prorepresentable 
functor $U: \mathcal{C}_\Lambda \to \textit{Sets}$ and a minimal 
smooth morphism $f: U \to F$, which by Lemma 
\ref{lemma-minimal-smooth-morphism-functors} is an isomorphism.
\end{proof}

\subsection{Infinitesimal automorphisms}
\label{subsection-infinitesimal-automorphisms}

\noindent
Let $\mathcal{F}$ be a category cofibered in groupoids over $\mathcal 
C_\Lambda$. Given a morphism $x' \to x$ in $\mathcal{F}$ lying over 
$A' \to A$, there is an induced homomorphism
\[ \text{Aut}_{A'}(x') \to \text{Aut}_{A}(x). \]
Lemma \ref{lemma-RS-associated-functor} says that the cokernel of this 
homomorphism determines whether the condition (RS) on $\mathcal{F}$ passes to 
$\overline{\mathcal{F}}$. In this section we study the kernel of this 
homomorphism. We will see that it also gives a measure of how far $\mathcal{F}$ 
is from $\overline{\mathcal{F}}$ (Lemma \ref{lemma-infdef-trivial}).  

\begin{definition}
\label{definition-relative-infinitesimal-auts}
Let $\mathcal{F}$ be a category cofibered in groupoids over $\mathcal 
C_\Lambda$. Let $x' \to x$ be a morphism in $\mathcal{F}$ lying over 
$A' \to A$. The {\it group of infinitesimal automorphisms 
$\text{Inf}({x'/x})$ of $x'$ over $x$} is the kernel of 
$\text{Aut}_{A'}(x') \to \text{Aut}_{A}(x)$.
\end{definition}

\begin{definition}
\label{definition-infinitesimal-auts}
Let $\mathcal{F}$ be a category cofibered in groupoids over $\mathcal 
C_\Lambda$. Let $x_0 \in \text{Ob}(\mathcal{F}(k))$. Assume a choice of 
pushforward $x_0 \to x_0'$ of $x_0$ along the map $k \to 
k[\epsilon]$ has been made.  Then there is a unique map $x'_0 \to 
x_0$ such that $x_0 \to x_0' \to x_0$ is the identity on $x_0$. 
The {\it group of infinitesimal automorphisms $\text{Inf}_{x_0}(\mathcal 
F)$ of $x_0$} is $\text{Inf}(x'_0/x_0)$.
\end{definition}

\begin{remark}
\label{remark-choice-pushforward-immaterial-infinitesimal-aut}
Up to isomorphism, $\text{Inf}_{x_0}(\mathcal{F})$ does not depend on the 
choice of pushforward $x_0 \to x_0'$.  Moreover, if $y_0 \in \mathcal 
F(k)$ and $x_0 \cong y_0$ in $\mathcal{F}(k)$, then 
$\text{Inf}_{x_0}(\mathcal{F}) \cong \text{Inf}_{y_0}(\mathcal{F})$.
\end{remark}

\begin{remark}
\label{remark-trivial-aut-point}
When $\mathcal{F}$ is a predeformation category, $\text{Aut}_{k}(x_0)$ is 
trivial and hence $\text{Inf}_{x_0}(\mathcal{F}) = 
\text{Aut}_{k[\epsilon]}(x'_0)$.
\end{remark}

\noindent
Next we show that $\text{Inf}_{x_0}(\mathcal{F})$ has a natural $k$-vector 
space structure when $\mathcal{F}$ satisfies (RS) (Lemma 
\ref{lemma-infaut-vector-space}).  At the same time, we will see that if 
$\mathcal{F}$ satisfies (RS), then the infinitesimal automorphisms 
$\text{Inf}(x'/x)$ of a morphism $x' \to x$ lying over a small 
extension are governed by $\text{Inf}_{x_0}(\mathcal{F})$, where $x_0$ is 
a pushforward of $x$ to $\mathcal{F}(k)$ (Lemma 
\ref{lemma-lifted-automorphisms-torsor}).  To this end, we introduce an 
automorphism functor for any object $x \in \text{Ob}(\mathcal{F})$ as 
follows.

\begin{definition}
\label{definition-automorphism-functor}
Let $p: \mathcal{F} \to \mathcal{C}$ be a category cofibered in groupoids 
over an arbitrary base category $\mathcal{C}$. Assume a choice of pushforwards 
has been made.  Let $x \in \text{Ob}(\mathcal{F})$ and let $U = p(x)$.  
Let $U/\mathcal{C}$ denote the category of objects under $U$. The 
{\it automorphism functor of $x$} is the functor $\text{Aut}(x): 
U/\mathcal{C} \to \textit{Sets}$ sending an object $f: U 
\to V$ to $\text{Aut}_{V}(f_*x)$ and sending a morphism
\[
\xymatrix{
V' \ar[rr] &                    & V\\
          & U \ar[ul]^{f}  \ar[ur]_{f'} & 
}
\]
to the homomorphism $\text{Aut}_{V'}(f'_*x) \to 
\text{Aut}_{V}(f_*x)$.
\end{definition}

\noindent 
We will be concerned with the automorphism functors of objects in a category 
cofibered in groupoids $\mathcal{F}$ over $\mathcal{C}_\Lambda$.  If $A \in 
\text{Ob}(\mathcal{C}_\Lambda)$, then the category $A/\mathcal{C}_\Lambda$ is 
nothing but the category $\mathcal{C}_{A}$, i.e.\ the category defined in 
Section \ref{section-CLambda}
where we take $\Lambda = A$.  Hence the 
automorphism functor of an object $x \in \text{Ob}(\mathcal{F}(A))$ is a functor 
$\text{Aut}(x): \mathcal{C}_{A} \to \textit{Sets}$.

\begin{lemma}
\label{lemma-Aut-functor-RS}
Let $\mathcal{F}$ be a category cofibered in groupoids over $\mathcal 
C_\Lambda$ satisfying (RS).  Let $x \in \text{Ob}(\mathcal 
F(A))$.  Then $\text{Aut}(x): \mathcal{C}_{A} \to 
\textit{Sets}$ satisfies (RS).
\end{lemma}

\begin{proof}
It follows that $\text{Aut}(x)$ satisfies (RS) from the fully 
faithfulness of the functor $\mathcal{F}(A_1 \times_{A} A_2) \to 
\mathcal{F}(A_1) \times_{\mathcal{F}(A)} \mathcal{F}(A_2)$ in Remark 
\ref{remark-RS-2-categorical}.
\end{proof}

\begin{lemma}
\label{lemma-Aut-functor-tangent-space}
Let $\mathcal{F}$ be a category cofibered in groupoids over $\mathcal 
C_\Lambda$ satisfying (RS).  Let $x \in \text{Ob}(\mathcal 
F(A))$.  Let $x_0$ be a pushforward of $x$ to $\mathcal{F}(k)$.
\begin{enumerate}
\item $T_{\text{id}_{x_0}} \text{Aut}(x)$ has a natural $k$-vector 
space structure such that addition agrees with composition in 
$T_{\text{id}_{x_0}} \text{Aut}(x)$.  In particular, composition in 
$T_{\text{id}_{x_0}} \text{Aut}(x)$ is commutative.
\item With the natural vector space structures, there is an isomorphism 
$T_{\text{id}_{x_0}} \text{Aut}(x) \cong T_{\text{id}_{x_0}} 
\text{Aut}(x_0)$.
\end{enumerate}
\end{lemma}

\begin{proof}
Let $F = \text{Aut}(x)_{\text{id}_{x_0}}$, the notation being that 
of Remark \ref{remark-localize-cofibered-groupoid}. By definition 
$T_{\text{id}_{x_0}} \text{Aut}(x) = TF = F(k[\epsilon])$. It 
follows from Lemmas \ref{lemma-Aut-functor-RS} and \ref{lemma-localize-RS} that 
$F$ is a deformation category.  Hence $F(k[\epsilon])$ has the natural 
$k$-vector space structure specified by Lemma 
\ref{lemma-tangent-space-functor}.  

\medskip \noindent
In particular, addition is defined as the composition
\[ +: F(k[\epsilon]) \times F(k[\epsilon]) \xrightarrow{\sim} 
F(k[\epsilon] \times_{k} k[\epsilon]) \to F(k[\epsilon]) \]
where the first map is the inverse of the bijection guaranteed by (RS) and the 
second is induced by the ring map $k[\epsilon] \times_{k} k[\epsilon] 
\cong k[\epsilon_1,\epsilon_2]/(\epsilon_1^2, \epsilon_2^2, 
\epsilon_1\epsilon_2) \to k[\epsilon]$ sending 
$\epsilon_1,\epsilon_2 \mapsto \epsilon$. If $A \to B$ is a 
ring map in $\mathcal{C}_\Lambda$, then $F(A) \to F(B)$ is a 
homomorphism where $F(A) = \text{Aut}(x)_{\text{id}_{x_0}}(A)$ and 
$F(B) = \text{Aut}(x)_{\text{id}_{x_0}}(B)$ are groups under 
composition.  Hence $+: F(k[\epsilon]) \times F(k[\epsilon])\to 
F(k[\epsilon])$ is a homomorphism where $F(k[\epsilon])$ is regarded as a 
group under composition.  Moreover $+(v, \text{id}_{x_0'}) = 
+(\text{id}_{x_0'},v) = v$ for any $v \in F(k[\epsilon])$, where 
$x_0'$ denotes the pushforward of $x_0$ along $k \to k[\epsilon]$.  
In general it is easy to see that if $G$ is a group with multiplication $\circ$ 
and $+: G \times G \to G$ is a homomorphism such that $+(g,1) = 
+(1,g)$, where $1$ is the identity of $G$, then $+ = \circ$.  This shows 
addition in the $k$-vector space structure on $F(k[\epsilon])$ agrees with 
composition.

\medskip \noindent
Finally, (2) follows from the fact that a pushforward $x \to x'$ of $x$ 
along $A \to k[\epsilon]$ factors as $x \to x_0 \to 
x'$, hence $x'$ is also a pushforward of $x_0$ along $k \to 
k[\epsilon]$.
\end{proof}

\begin{remark}
\label{remark-infaut-lifting-equalities}
We point out some basic relationships between infinitesimal automorphism 
groups, liftings, and tangent spaces to automorphism functors.  Let $\mathcal 
F$ be a category cofibered in groupoids over $\mathcal{C}_\Lambda$.  Let $x' 
\to x$ be a morphism lying over a ring map $A' \to A$.  Let 
$x_0$ be a pushforward of $x$ to $\mathcal{F}(k)$.  Then from the definitions we 
have an equality
\[ \text{Inf}(x'/x) = \text{Lift}(\text{id}_{x}, A') \]
where the liftings are of $\text{id}_{x}$ as an object of 
$\text{Aut}(x')$.  If $x_0 \in \text{Ob}(\mathcal{F}(k))$ and $x'_0$ 
is the pushforward to $\mathcal{F}(k[\epsilon])$, then applying this to $x'_0 
\to x_0$ we get 
\[ \text{Inf}_{x_0}(\mathcal{F}) = 
\text{Lift}(\text{id}_{x_0}, k[\epsilon]) = 
T_{\text{id}_{x_0}} \text{Aut}(x_0), \]
the last equality following directly from the definitions.
\end{remark}

\begin{lemma}
\label{lemma-infaut-vector-space}
Let $\mathcal{F}$ be a category cofibered in groupoids over $\mathcal 
C_\Lambda$ satisfying (RS).  Let $x_0 \in 
\text{Ob}(\mathcal{F}(k))$.  Then $\text{Inf}_{x_0}(\mathcal{F})$ is 
equal as a set to $T_{\text{id}_{x_0}} \text{Aut}(x_0)$, and so has 
a natural $k$-vector space structure such that addition agrees with composition 
of automorphisms.
\end{lemma}

\begin{proof}
The equality of sets is as in the end of Remark 
\ref{remark-infaut-lifting-equalities} and the statement about the vector space 
structure follows from Lemma \ref{lemma-Aut-functor-tangent-space}.
\end{proof} 

\begin{lemma}
\label{lemma-lifted-automorphisms-torsor}
Let $\mathcal{F}$ be a category cofibered in groupoids over $\mathcal 
C_\Lambda$ satisfying (RS).  Let $x' \to x$ be a 
morphism lying over a small extension $A' \to A$ with kernel $I$.  Let 
$x_0$ be a pushforward of $x$ to $\mathcal{F}(k)$.  Then 
$\text{Inf}(x'/x)$ has a free and transitive action by 
$T_{\text{id}_{x_0}} \text{Aut}(x') \otimes_{k} I \cong 
\text{Inf}_{x_0}(\mathcal{F}) \otimes_{k} I$.
\end{lemma}

\begin{proof}
It follows from Lemma \ref{lemma-free-transitive-action} and the equality 
$\text{Inf}(x'/x) = \text{Lift}(\text{id}_{x}, A')$ of Remark 
\ref{remark-infaut-lifting-equalities} that $\text{Inf}(x'/x)$ has a free 
an transitive action by $T_{\text{id}_{x_0}} \text{Aut}(x') 
\otimes_{k} I$.  The isomorphism $T_{\text{id}_{x_0}} 
\text{Aut}(x') \otimes_{k} I \cong \text{Inf}_{x_0}(\mathcal{F}) 
\otimes_{k} I$ of vector spaces follows from Lemma 
\ref{lemma-Aut-functor-tangent-space} (2).
\end{proof}

\begin{lemma}
\label{lemma-infaut-trivial}
Let $\mathcal{F}$ be a category cofibered in groupoids over $\mathcal 
C_\Lambda$ satisfying (RS). Let $x' \to x$ be a morphism 
in $\mathcal{F}$ lying over a surjective ring map.  Let $x_0$ be a pushforward 
of $x$ to $\mathcal{F}(k)$.  If $\text{Inf}_{x_0}(\mathcal{F}) = 0$ then 
$\text{Inf}(x'/x) = 0$.
\end{lemma}

\begin{proof}
Follows from Lemmas \ref{lemma-factor-small-extension} and 
\ref{lemma-lifted-automorphisms-torsor}.
\end{proof}

\begin{lemma}
\label{lemma-infdef-trivial}
Let $\mathcal{F}$ be a category cofibered in groupoids over $\mathcal 
C_\Lambda$ satisfying (RS). Let $x_0 \in \text{Ob}(\mathcal{F}(k))$. 
Then $\text{Inf}_{x_0}(\mathcal{F}) = 0$ if and only if the natural 
morphism $\mathcal{F}_{x_0} \to \overline{\mathcal{F}_{x_0}}$ of 
categories cofibered in groupoids is an equivalence.
\end{lemma}

\begin{proof}
The morphism $\mathcal{F}_{x_0} \to \overline{\mathcal{F}_{x_0}}$ is an 
equivalence if and only if $\mathcal{F}_{x_0}$ is fibered in setoids,
cf.\ Categories, Section \ref{categories-section-fibred-in-setoids}
(a setoid is by definition a groupoid in 
which the only automorphism of any object is the identity).  We prove that 
$\text{Inf}_{x_0}(\mathcal{F}) = 0$ if and only if this condition holds 
for $\mathcal{F}_{x_0}$.  Obviously if $\mathcal{F}_{x_0}$ is fibered in setoids 
then $\text{Inf}_{x_0}(\mathcal{F}) = 0$.  Conversely assume 
$\text{Inf}_{x_0}(\mathcal{F}) = 0$.  Let $A$ be an object of $\mathcal 
C_\Lambda$. Then by Lemma \ref{lemma-infaut-trivial}, 
$\text{Inf}(x/x_0) = 0$ for any object $x \to x_0$ of $\mathcal 
F_{x_0}(A)$. Since by definition $\text{Inf}(x/x_0)$ equals the group of 
automorphisms of $x \to x_0$ in $\mathcal{F}_{x_0}(A)$, this proves 
$\mathcal{F}_{x_0}(A)$ is a setoid.
\end{proof}


\subsection{Groupoids in functors}
\label{subsection-groupoids-in-functors}

\noindent
In this section we discuss groupoids in functors on $\mathcal{C}_\Lambda$. In
Subsection \ref{subsection-presentations}
we will see that minimal smooth 
prorepresentable groupoids in functors on $\mathcal{C}_\Lambda$ serve as 
``presentations'' for well-behaved deformation categories in the same way that 
smooth groupoids in algebraic spaces serve as presentations for algebraic 
stacks,
cf.\ Algebraic Stacks, Section \ref{algebraic-section-stack-to-presentation}.
We begin with generalities 
on groupoids in functors on an arbitrary category, then pass to the category 
$\mathcal{C}_\Lambda$.



\subsection{Groupoids in functors on an arbitrary category}
\label{subsection-groupoids-arbitrary}

\noindent
For clarity we shall sometimes refer to an ordinary groupoid, i.e.\ a category 
whose morphisms are all isomorphisms, as a groupoid category.

\begin{definition}
\label{definition-groupoid-in-functors}
Let $\mathcal{C}$ be a category. The {\it category of groupoids in functors on 
$\mathcal{C}$} is the category with the following objects and morphisms.
\begin{enumerate}
\item Objects: A {\it groupoid in functors on $\mathcal{C}$} is a quintuple 
$(U,R,s,t,c)$ where $U,R: \mathcal{C} \to \textit{Sets}$ are 
functors and $s,t: R \to U$ and $c: R \times_{s,U,t} R \to R$ 
are morphisms with the following property: For any object $T$ of $\mathcal{C}$, 
the quintuple
\[ (U(T), R(T), s,t,c) \]
is a groupoid category.
\item Morphisms: A {\it morphism $(U,R,s,t,c) \to (U',R',s',t',c')$ of 
groupoids in functors on $\mathcal{C}$} consists of morphisms $U \to U'$ 
and $R \to R'$ with the following property: For any object $T$ of 
$\mathcal{C}$, the induced maps $U(T) \to U'(T)$ and $R(T) \to 
R'(T)$ define a functor between groupoid categories
\[ (U(T), R(T), s,t,c) \to (U'(T), R'(T), s',t',c') .\] 
\end{enumerate}
\end{definition}

\begin{remark}
\label{remark-confusion-groupoids-in-functors}
A groupoid in functors on $\mathcal{C}$ amounts to the data of a functor $ 
\mathcal{C} \to \textit{Groupoids}$, and a morphism of groupoids 
in functors on $\mathcal{C}$ amounts to a morphism of the corresponding functors 
$\mathcal{C} \to \textit{Groupoids}$ (where 
$\textit{Groupoids}$ is regarded as a 1-category).  However, for our 
purposes it is more convenient to use the terminology of groupoids in functors. 
 In fact, thinking of a groupoid in functors as the corresponding functor 
$\mathcal{C} \to \textit{Groupoids}$, or equivalently as the 
category cofibered in groupoids associated to that functor, can lead to 
confusion (Remark \ref{remark-smooth-groupoid-in-functors-warning}).
\end{remark}

\begin{remark}
\label{remark-identity-inverse}
Let $(U,R,s,t,c)$ be a groupoid in functors on a category $\mathcal{C}$. There 
are unique morphisms $e: U \to R$ and $i: R \to R$ such that 
for every object $T$ of $\mathcal{C}$, $e: U(T) \to R(T)$ sends $x \in 
U(T)$ to the identity morphism on $x$ and $i: R(T) \to R(T)$ sends $a 
\in U(T)$ to the inverse of $a$ in the groupoid category $(U(T),R(T),s,t,c)$. 
We will sometimes refer to $s,t,c,e,$ and $i$ as ``source,'' ``target,'' 
``composition,'' ``identity,'' and ``inverse.''
\end{remark}

\begin{definition}
\label{definition-representable}
Let $\mathcal{C}$ be a category.  A groupoid in functors on $\mathcal{C}$ is 
{\it representable} if it is isomorphic to one of the form $(\underline{U}, 
\underline{R}, s,t,c)$ where $U$ and $R$ are objects of $\mathcal{C}$ and the 
coproduct $R \coprod_{s,U,t} R$ exists.
\end{definition}

\begin{remark}
\label{remark-reason-existence-coproduct}
Hence a representable groupoid in functors on $\mathcal{C}$ is given by objects 
$U$ and $R$ of $\mathcal{C}$ and morphisms $s,t: U \to R$ and $c: R 
\to R \coprod_{s,U,t} R$ such that 
$(\underline{U},\underline{R},s,t,c)$ satisfies the condition of Definition 
\ref{definition-groupoid-in-functors}. The reason for requiring the existence 
of $R \coprod_{s,U,t} R$ is so that the composition morphism $c$ is defined at 
the level of morphisms in $\mathcal{C}$.  This requirement will always be 
satisfied below when we consider representable groupoids in functors on 
$\widehat{\mathcal{C}}_\Lambda$, since by Lemma 
\ref{lemma-CLambdahat-coproducts} the category $\widehat{\mathcal{C}}_\Lambda$ 
admits coproducts.
\end{remark}

\begin{remark}
\label{remark-simplify-terminology}
We will simply say ``let $(\underline{U}, \underline{R}, s,t,c)$ be a groupoid 
in functors on $\mathcal{C}$'' to mean ``$U$ and $R$ are objects of $\mathcal{C}$ 
and $(\underline{U}, \underline{R}, s,t,c)$ is a groupoid in functors on 
$\mathcal{C}$.''
\end{remark}

\noindent
We introduce notation for restriction of groupoids in functors. This will be 
relevant below in situations where we restrict from $\widehat{\mathcal 
C}_\Lambda$ to $\mathcal{C}_\Lambda$.

\begin{definition}
\label{definition-restricting-groupoids-in-functors}
Let $(U,R,s,t,c)$ be a groupoid in functors on a category $\mathcal{C}$.  Let 
$\mathcal{C}'$ be a subcategory of $\mathcal{C}$.  The {\it restriction 
$(U,R,s,t,c)|_{\mathcal{C}'}$ of $(U,R,s,t,c)$ to $\mathcal{C}'$} is the groupoid 
in functors on $\mathcal{C}'$ given by $(U|_{\mathcal{C}'},R|_{\mathcal 
C'},s|_{\mathcal{C}'},t|_{\mathcal{C}'},c|_{\mathcal{C}'})$.
\end{definition}

\begin{remark}
\label{remark-notation-restriction}
In the situation of Definition 
\ref{definition-restricting-groupoids-in-functors}, we often denote 
$s|_{\mathcal{C}'},t|_{\mathcal{C}'},c|_{\mathcal{C}'}$ simply by $s,t,c$.
\end{remark}

\begin{definition}
\label{definition-quotient}
Let $(U,R,s,t,c)$ be a groupoid in functors on a category $\mathcal{C}$. 
\begin{enumerate}
\item The assignment $T \mapsto  (U(T), R(T), s,t,c)$ determines a functor 
$\mathcal{C} \to \textit{Groupoids}$. The {\it quotient category 
cofibered in groupoids $[U/R] \to \mathcal{C}$} is the category 
cofibered in groupoids over $\mathcal{C}$ associated to this functor (as in 
Remarks \ref{remarks-cofibered-groupoids} 
(\ref{item-construction-associated-cofibered-groupoid})).  
\item The {\it quotient morphism $U \to [U/R]$} is the morphism of 
categories cofibered in groupoids over $\mathcal{C}$ which sends an object $x 
\in U(T)$ to $(T,x) \in \text{Ob}([U/R](T))$, and sends a morphism $f: T 
\to T'$ to $(f, \text{id}_{x'}): (T,x) \to (T,x')$.
\end{enumerate} 
\end{definition}




\subsection{Prorepresentable groupoids in functors on $\mathcal{C}_\Lambda$}
\label{subsection-prerepresentable-groupoids-in-functors}

\begin{definition}
\label{definition-prorepresentable-groupoid-in-functors}
A groupoid in functors on $\mathcal{C}_\Lambda$ is {\it prorepresentable} if 
it is isomorphic to $(\underline{R_0}, \underline{R_1}, s,t,c)|_{\mathcal 
C_\Lambda}$ for $(\underline{R_0}, \underline{R_1}, s,t,c)$ a groupoid in 
functors on $\widehat{\mathcal{C}}_\Lambda$.
\end{definition}

\noindent
Let $(U,R,s,t,c)$ be a groupoid in functors on $\mathcal{C}_\Lambda$.  Then 
taking completions, we get a quintuple $(\widehat{U}, \widehat{R}, \widehat{s}, 
\widehat{t}, \widehat{c})$.  By Remark 
\ref{remark-completion-restriction-cofset-adjoint} completion as a functor on 
$\text{CofSet}(\mathcal{C}_\Lambda)$ is a right adjoint, so it commutes 
with limits.  In particular, there is a canonical isomorphism $\widehat{R 
\times_{s,U,t} R} \cong \widehat{R} \times_{\widehat{s}, \widehat{U}, 
\widehat{t}} \widehat{R}$, so $\widehat{c}$ can be regarded as a functor 
$\widehat{R} \times_{\widehat{s}, \widehat{U}, \widehat{t}} \widehat{R} 
\to \widehat{R}$.  Then $(\widehat{U}, \widehat{R}, \widehat{s}, 
\widehat{t}, \widehat{c})$ defines a groupoid in functors on $\widehat{\mathcal 
C}_\Lambda$, with identity and inverse morphisms being the completions of 
those of $(U,R,s,t,c)$.

\begin{definition}
\label{definition-completion-groupoud-in-functors}
Let $(U,R,s,t,c)$ be a groupoid in functors on $\mathcal{C}_\Lambda$.  The 
{\it completion $(U,R,s,t,c)^{\wedge}$ of $(U,R,s,t,c)$} is the groupoid in 
functors on $\widehat{\mathcal{C}}_\Lambda$ given by 
$(\widehat{U},\widehat{R},\widehat{s},\widehat{t},\widehat{c})$.
\end{definition}

\begin{remark}
\label{remark-groupoid-in-functors-complete-restrict}
Let $(U,R,s,t,c)$ be a groupoid in functors on $\mathcal{C}_\Lambda$. Then 
there is a canonical isomorphism $(U,R,s,t,c)^{\wedge}|_{\mathcal{C}_\Lambda} 
\cong (U,R,s,t,c)$.  This follows from the fact that for a functor $F: \mathcal 
C_\Lambda \to \textit{Sets}$, the natural map 
$\widehat{F}|_{\mathcal{C}_\Lambda} \to F$ is an isomorphism (see the 
end of Remark \ref{remark-completion-restriction-cofset-adjoint}).  On the 
other hand, let $(U,R,s,t,c)$ be a groupoid in functors on $\widehat{\mathcal 
C}_\Lambda$ such that $U, R: \widehat{\mathcal{C}}_\Lambda \to 
\textit{Sets}$ both commute with limits, e.g.\ if $U,R$ are 
representable. Then there is a canonical isomorphism $((U,R,s,t,c)|_{\mathcal 
C_\Lambda})^{\wedge} \cong (U,R,s,t,c)$. This follows from Remark 
\ref{remark-restrict-complete-continuous-functor}.
\end{remark}

\begin{lemma}
\label{lemma-groupoid-in-functors-prorep-equivalences}
Let $(U,R,s,t,c)$ be a groupoid in functors on $\mathcal{C}_\Lambda$.
\begin{enumerate}
\item $(U,R,s,t,c)$ is prorepresentable if and only if its completion is 
representable as a groupoid in functors on $\widehat{\mathcal{C}}_\Lambda$.
\item $(U,R,s,t,c)$ is prorepresentable if and only if $U$ and $R$ are 
prorepresentable.
\end{enumerate}
\end{lemma}

\begin{proof}
Statement (1) follows from Remark 
\ref{remark-groupoid-in-functors-complete-restrict}. For (2), the ``only if'' 
direction is clear from the definition of a prorepresentable groupoid in 
functors. Conversely, assume $U$ and $R$ are prorepresentable, say $U \cong 
\underline{R_0}|_{\mathcal{C}_\Lambda}$ and $R \cong 
\underline{R_1}|_{\mathcal{C}_\Lambda}$ for objects $R_0$ and $R_1$ of 
$\widehat{\mathcal{C}}_\Lambda$. It suffices by (1) to see that the completion 
$(U,R,s,t,c)^{\wedge}$ is representable in $\widehat{\mathcal{C}}_\Lambda$.  
But this follows from the isomorphisms $\underline{R_0} \cong 
\widehat{\underline{R_0}|_{\mathcal{C}_\Lambda}}$ and $\underline{R_1} \cong 
\widehat{\underline{R_1}|_{\mathcal{C}_\Lambda}}$ of Remark 
\ref{remark-restrict-complete-continuous-functor}.
\end{proof}

\subsection{Smooth and minimal groupoids in functors on $\mathcal{C}_\Lambda$}
\label{subsection-smooth-minimal-groupoids-in-functors}

\noindent
The notion of smoothness for groupoids in functors on $\mathcal{C}_\Lambda$ is 
defined as follows.

\begin{definition}
\label{definition-smooth-groupoid-in-functors}
Let $(U, R, s,t,c)$ be a groupoid in functors on $\mathcal{C}_\Lambda$.  We 
say $(U, R, s,t,c)$ is {\it smooth} if $s,t: R \to U$ are smooth.
\end{definition}

\begin{remark}
\label{remark-smooth-groupoid-in-functors-warning}
We note that this terminology is potentially confusing: if $(U, R, s,t,c)$ is a 
smooth groupoid in functors, then the quotient $[U/R]$ need not be smooth (see 
Remark \ref{remark-cofibered-groupoid-projection-smooth}).  However smoothness 
of $(U, R, s,t,c)$ does imply (and in fact is equivalent to) smoothness of the 
quotient morphism $U \to [U/R]$ (Lemma 
\ref{lemma-smooth-quotient-morphism}).  The situation is similar for minimality 
as defined in Definition \ref{definition-minimal-groupoid-in-functors}.
\end{remark}

\begin{remark}
\label{remark-smooth-power-series-prorepresentable-smooth-groupoid-in-functors}
Let $(\underline{R_0}, \underline{R_1}, s,t,c)|_{\mathcal{C}_\Lambda}$ be a 
prorepresentable groupoid in functors on $\mathcal{C}_\Lambda$.  Then 
$(\underline{R_0}, \underline{R_1}, s,t,c)|_{\mathcal{C}_\Lambda}$ is smooth 
if and only if $R_1$ is a power series over $R_0$ via both $s$ and $t$.  This 
follows from
Lemma \ref{lemma-smooth-morphism-power-series}.
\end{remark}

\begin{lemma}
\label{lemma-smooth-quotient-morphism}
Let $(U, R, s,t,c)$ be a groupoid in functors on $\mathcal{C}_\Lambda$.  The 
following are equivalent: 
\begin{enumerate}
\item The groupoid in functors $(U, R, s,t,c)$ is smooth.
\item The morphism $s: R \to U$ is smooth.
\item The morphism $t: R \to U$ is smooth.
\item The morphism $U \to [U/R]$ is smooth.
\end{enumerate}
\end{lemma}

\begin{proof}
Statement (2) is equivalent to (3) since the inverse $i: R \to R$ of 
$(U, R, s,t,c)$ is an isomorphism and $t = s \circ i$. By definition (1) is 
equivalent to (2) and (3) together, hence it is equivalent to either of them 
individually. 

\medskip \noindent
Finally we prove (2) is equivalent to (4). From the definitions:
\begin{enumerate}
\item[(2)] Smoothness of $s: R \to U$ amounts to the following 
condition: If $f: B \to A$ is a surjective ring map in $\mathcal 
C_\Lambda$, $a \in R(A)$, and $y \in U(B)$ such that $s(a) = U(f)(y)$, then 
there exists $a' \in R(B)$ such that $R(f)(a') = a$ and $s(a') = y$.

\item[(4)] Smoothness of $U \to [U/R]$ amounts to the following 
condition: If $f: B \to A$ be a surjective ring map in $\mathcal 
C_\Lambda$ and $(f,a): (B,y) \to (A,x)$ is a morphism of $[U/R]$, 
then there exists $x' \in U(B)$ and $b \in R(B)$ with $s(b) = x', t(b) = y$ 
such that $c(a,R(f)(b)) = e(x)$.  Here $e: U \to R$ denotes the 
identity and the notation $(f,a)$ is as in Remarks 
\ref{remarks-cofibered-groupoids} 
(\ref{item-construction-associated-cofibered-groupoid});
in particular $a \in R(A)$ with $s(a) = U(f)(y), t(a) = x$.  
\end{enumerate}
If (4) holds and $f,a,y$ as in (2) are given, let $x = t(a)$ so that we have a 
morphism $(f,a): (B,y) \to (A,x)$.  Then (4) produces $x'$ and $b$ as 
above, and $a' = i(b)$ satisfies the requirements of (2).  Conversely, assume 
(2) holds and let $(f,a): (B,y) \to (A,x)$ as in (4) be given.  Then 
(2) produces $a' \in R(B)$ as above, and $x' = t(a')$ and $b = i(a')$ satisfy 
the requirements of (4).
\end{proof}

\noindent
The notion of minimality for groupoids in functors on $\mathcal{C}_\Lambda$ is 
defined as follows.

\begin{definition}
\label{definition-minimal-groupoid-in-functors}
Let $(U, R, s,t,c)$ be a groupoid in functors on $\mathcal{C}_\Lambda$.  We 
say $(U, R, s,t,c)$ is {\it minimal} if the groupoid 
$(U(k[\epsilon]),R(k[\epsilon]), s,t,c)$ is totally disconnected, i.e.\ 
there are no morphisms between distinct objects.
\end{definition}

\begin{lemma}
\label{lemma-characterize-minimal-groupoid-in-functors}
Let $(U, R, s,t,c)$ be a groupoid in functors on $\mathcal{C}_\Lambda$.  
Assume $U$ and $R$ are predeformation functors.  Then $(U,R,s,t,c)$ is minimal 
if and only if the morphism $U \to [U/R]$ is minimal.
\end{lemma}

\begin{proof}
Follows immediately from the definitions.
\end{proof}

\noindent
The quotient of a minimal prorepresentable groupoid in functors on $\mathcal 
C_\Lambda$ does not admit autoequivalences which are not automorphisms.  To 
prove this, we first note the following lemma.

\begin{lemma}
\label{lemma-surjective-morphism-prorepresentable-functor}
Let $U: \mathcal{C}_\Lambda \to \textit{Sets}$ be a 
prorepresentable functor.  Let $\varphi: U \to U$ be a morphism such 
that $d\varphi: TU \to TU$ is an isomorphism.  Then $\varphi$ is an 
isomorphism.
\end{lemma}

\begin{proof}
The proof is essentially contained in the proof of Lemma 
\ref{lemma-miniversal-object-unique}. If $U \cong \underline{R}|_{\mathcal 
C_\Lambda}$ for some $R \in \text{Ob}(\widehat{\mathcal{C}}_\Lambda)$, 
then completing $\varphi$ gives a morphism $\underline{R} \to 
\underline{R}$.  If $f: R \to R$ is the corresponding morphism in 
$\mathcal{C}_\Lambda$, then $f$ induces an isomorphism of the tangent space 
$T_{R/\Lambda}$.  In particular $f$ is an endomorphism of $R$ inducing a 
surjection on $T^*_{R/\Lambda}$.  This implies $f$ is a surjection by Lemma 
\ref{lemma-surjective-cotangent-space}. As a surjective endomorphism of a 
Noetherian ring is an isomorphism, we conclude $f$, hence $\underline{R} 
\to \underline{R}$, hence the restriction $\varphi: U \to U$, 
is an isomorphism.
\end{proof}

\begin{lemma}
\label{lemma-minimal-prorepresentable-groupoid-autoequivalence}
Let $(U,R,s,t,c)$ be a minimal prorepresentable groupoid in functors on 
$\mathcal{C}_\Lambda$.  If $\varphi: [U/R] \to [U/R]$ is an 
equivalence of categories cofibered in groupoids, then $\varphi$ is an 
isomorphism.
\end{lemma}

\begin{proof}
The data of a morphism $\varphi: [U/R] \to [U/R]$ is equivalent to a 
morphism $\varphi: (U,R,s,t,c) \to (U,R,s,t,c)$ as in Definition 
\ref{definition-groupoid-in-functors}.  Over $k[\epsilon]$, $\varphi$ gives 
an equivalence $(U(k[\epsilon]),R(k[\epsilon]), s,t,c) \to 
(U(k[\epsilon]),R(k[\epsilon]), s,t,c)$ of totally disconnected 
groupoids.  This equivalence is an isomorphism since an equivalence of totally 
disconnected categories is an isomorphism. Hence $\varphi: U(k[\epsilon]) 
\to U(k[\epsilon])$ and $\varphi: R(k[\epsilon]) \to 
R(k[\epsilon])$ are isomorphisms, and so by Lemma 
\ref{lemma-surjective-morphism-prorepresentable-functor}, $\varphi: U 
\to U$ and $\varphi: R \to R$ are isomorphisms.  This means 
$\varphi: (U,R,s,t,c) \to (U,R,s,t,c)$ is an isomorphism.
\end{proof}

\begin{lemma}
\label{lemma-minimal-prorepresentable-groupoid-equivalence}
Let $(U,R,s,t,c)$ and $(U',R',s',t',c')$ be minimal prorepresentable groupoids 
in functors on $\mathcal{C}_\Lambda$.  If $\varphi: [U/R] \to [U'/R']$ 
is an equivalence of categories cofibered in groupoids, then $\varphi$ is an 
isomorphism. 
\end{lemma}

\begin{proof}
Let $\psi: [U'/R'] \to [U/R]$ be a quasi-inverse to $\varphi$.  Then 
$\psi \circ \varphi$ and $\varphi \circ \psi$ are isomorphisms by Lemma 
\ref{lemma-minimal-prorepresentable-groupoid-autoequivalence}, hence $\varphi$ 
and $\psi$ are isomorphisms.
\end{proof}

\subsection{Deformation categories as quotients of groupoids in functors}
\label{subsection-deformation-categories-as-quotients}

\noindent
We discuss conditions on a groupoid in functors on $\mathcal{C}_\Lambda$ which 
guarantee that the quotient is a deformation category, and we calculate the 
tangent and infinitesimal automorphism spaces of such a quotient.

\begin{lemma}
\label{lemma-smooth-RS-groupoid-in-functors-quotient}
Let $(U, R, s,t,c)$ be a smooth groupoid in functors on $\mathcal{C}_\Lambda$. 
Assume $U$ and $R$ satisfy (RS). Then $[U/R]$ satisfies (RS).
\end{lemma}

\begin{proof}
Let 
\[
\xymatrix{
                           &     (A_2,x_2) \ar[d]^{(f_2,a_2)} \\
(A_1,x_1) \ar[r]^{(f_1,a_1)} &     (A,x)
}
\]
be a diagram in $[U/R]$ such that $f_2: A_2 \to A$ is surjective. The 
notation is as in Remarks \ref{remarks-cofibered-groupoids} 
(\ref{item-construction-associated-cofibered-groupoid}).
Hence $f_1: A_1 \to A, f_2: A_2 \to A$
are maps in $\mathcal{C}_\Lambda$, $x \in U(A), x_1 
\in U(A_1), x_2 \in U(A_2)$, and $a_1,a_2 \in R(A)$ with $s(a_1) = U(f_1)(x_1), 
t(a_1) = x$ and $s(a_2) = U(f_2)(x_2), t(a_2) = x$. We construct a fiber 
product lying over $A_1 \times_{A} A_2$ for this diagram in $[U/R]$ as follows. 

\medskip \noindent 
Let $a = c(i(a_1),a_2)$, where $i: R \to R$ is the inverse morphism. 
Then $a \in R(A)$ and $x_2 \in U(A_2)$ satisfy $s(a) = U(f_2)(x_2)$, hence they 
determine an element $a \times x_2 \in R(A) \times_{s,U(A),U(f_2)} U(A_2)$. By 
smoothness of $s: R \to U$, there is an element $\widetilde{a} \in 
R(A_2)$ mapping to $a \times x_2$ under
\[ R(A_2) \to R(A) \times_{s,U(A),U(f_2)} U(A_2). \]
This means $R(f_2)(\widetilde{a}) = a$ and $s(\widetilde{a}) = x_2$; in 
particular, $U(f_2)(t(\widetilde{a})) = t(a) = U(f_1)(x_1)$. Thus $x_1$ and 
$t(\widetilde{a})$ define an element 
\[ x_1 \times t(\widetilde{a}) \in U(A_1) \times_{U(A)} U(A_2).\]
By the assumption that $U$ satisfies (RS), we have an identification $U(A_1) 
\times_{U(A)} U(A_2) = U(A_1 \times_{A} A_2)$.  Let $p_1,p_2$ be the 
projections of $A_1 \times_{A} A_2$.  We claim 
\[ 
\xymatrix{
(A_1 \times_{A} A_2, x_1 \times t(\widetilde{a})) \ar[d]_{(p_1, e(x_1))} 
\ar[rr]^{(p_2, i(\widetilde{a}))} & & (A_2, x_2) \ar[d]^{(f_2,a_2)} \\
(A_1, x_1) \ar[rr]^{(f_1,a_1)} && (A,x) 
}
\]
is a fiber square in $[U/R]$. (Note $e: U \to R$ denotes the identity.)

\medskip \noindent
The diagram is commutative; this follows from $c(a_2,R(f_2)(i(\widetilde{a}))) 
= c(a_2, i(a)) = a_1$. To check it is a fiber square, let
\[ 
\xymatrix{
(B, z) \ar[d]_{(g_1, b_1)} \ar[rr]^{(g_2, b_2)} & & (A_2, x_2) 
\ar[d]^{(f_2,a_2)} \\
(A_1, x_1) \ar[rr]^{(f_1,a_1)} && (A,x) 
}
\]
be a commutative diagram in $[U/R]$; we show there is a unique morphism $(g,b): 
(B, z) \to (A_1 \times_{A} A_2, x_1 \times t(\widetilde{a}))$ commuting 
with the projections to $(A_1,x_1)$ and $(A_2,x_2)$. We must take $g = g_1 
\times g_2: B \to A_1 \times_{A} A_2$.  Since by assumption $R$ 
satisfies (RS), we have an identification $R(A_1 \times_{A} A_2) = R(A_1) 
\times_{R(A)} R(A_2)$.  Hence we can write $b = b'_1 \times b'_2$ for some 
$b'_1 \in R(A_1), b'_2 \in R(A_2)$ which agree in $R(A)$. Then $(g_1 \times 
g_2, b'_1 \times b'_2): (B, z) \to (A_1 \times_{A} A_2, x_1 \times 
t(\widetilde{a}))$ will commute with the projections if and only if $b'_1 = 
b_1$ and $b'_2 = c(\widetilde{a}, b_2)$.
\end{proof}

\begin{lemma}
\label{lemma-deformation-groupoid-quotient}
Let $(U, R, s,t,c)$ be a smooth groupoid in functors on $\mathcal{C}_\Lambda$. 
Assume $U$ and $R$ are deformation functors. Then:
\begin{enumerate}
\item The quotient $[U/R]$ is a deformation category.
\item The tangent space of $[U/R]$ is 
\[ T[U/R] = \text{Coker}(ds-dt: TR \to TU).
\]
\item Let $x_0$ be the unique object of $[U/R](k)$.  The space of infinitesimal 
automorphisms of $[U/R]$ is 
\[ \text{Inf}_{x_0}([U/R]) = \text{Ker}(ds: TR \to TU) \cap 
\text{Ker}(dt: TR \to TU).  
\]
\end{enumerate}
\end{lemma}

\begin{proof}
Since $U$ and $R$ are deformation functors $[U/R]$ is a predeformation 
category. Hence (1) holds by Lemma 
\ref{lemma-smooth-RS-groupoid-in-functors-quotient}.  Statements (2) and (3) 
follow directly from the definitions.
\end{proof}




\subsection{Presentations}
\label{subsection-presentations}
Given a deformation category $\mathcal{F}$ with finite dimensional tangent and 
infinitesimal automorphism spaces, we will produce a presentation of $\mathcal 
F$ by a minimal smooth prorepresentable groupoid in functors on $\mathcal 
C_\Lambda$ (Theorem \ref{theorem-presentation-deformation-groupoid}). 




\subsection{Presentations of categories cofibered in groupoids}
\label{subsection-presentation-categories-cofibred-in-groupoids}

\noindent
A presentation is defined as follows.

\begin{definition}
\label{definition-presentation}
Let $\mathcal{F}$ be a category cofibered in groupoids over a category $\mathcal 
C$.  Let $(U,R,s,t,c)$ be a groupoid in functors on $\mathcal{C}$.  A 
{\it presentation of $\mathcal{F}$ by $(U,R,s,t,c)$} is an equivalence 
$\varphi: [U/R] \to \mathcal{F}$ of categories cofibered in groupoids 
over $\mathcal{C}$.
\end{definition}

\noindent
The following two general lemmas will be used to get presentations.

\begin{lemma}
\label{lemma-presentation-construction}
Let $\mathcal{F}$ be category cofibered in groupoids over a category $\mathcal 
C$.  Let $U: \mathcal{C} \to \textit{Sets}$ be a functor. Let $f: 
U \to \mathcal{F}$ be a morphism of categories cofibered in groupoids 
over $\mathcal{C}$. Define $R,s,t,c$ as follows:
\begin{enumerate}
\item $R: \mathcal{C} \to \textit{Sets}$ is the functor $U 
\times_{f,\mathcal{F},f} U$.
\item $t,s: R \to U$ are the first and second projections, 
respectively. 
\item $c: R \times_{s,U,t} R \to R$ is the morphism given by projection 
onto the first and last factors of $U \times_{f, \mathcal{F}, f} U 
\times_{f,\mathcal{F},f} U$ under the canonical isomorphism $R \times_{s,U,t} R 
\cong U \times_{f, \mathcal{F}, f} U \times_{f,\mathcal{F},f} U$.
\end{enumerate}
Then $(U,R,s,t,c)$ is a groupoid in functors on $\mathcal{C}$.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-presentation-morphism}
Let $\mathcal{F}$ be category cofibered in groupoids over a category $\mathcal 
C$.  Let $U: \mathcal{C} \to \textit{Sets}$ be a functor. Let $f: 
U \to \mathcal{F}$ be a morphism of categories cofibered in groupoids 
over $\mathcal{C}$. Let $(U,R,s,t,c)$ be the groupoid in functors on $\mathcal 
C$ constructed from $f: U \to \mathcal{F}$ in Lemma 
\ref{lemma-presentation-construction}.  Then there is a natural morphism $[f]: 
[U/R] \to \mathcal{F}$ such that:
\begin{enumerate}
\item $[f]: [U/R] \to \mathcal{F}$ is fully faithful.
\item $[f]: [U/R] \to \mathcal{F}$ is an equivalence if and only if $f: 
U \to \mathcal{F}$ is essentially surjective.
\end{enumerate}
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\subsection{Presentations of deformation categories}
\label{subsection-presentation-deformation-categories}

\noindent
According to the next lemma, a smooth morphism from a predeformation functor to 
a predeformation category $\mathcal{F}$ gives rise to a presentation of 
$\mathcal{F}$ by a smooth groupoid in functors.

\begin{lemma}
\label{lemma-smooth-groupoid-in-functors-construction}
Let $\mathcal{F}$ be a category cofibered in groupoids over $\mathcal 
C_\Lambda$.  Let $U: \mathcal{C}_\Lambda \to \textit{Sets}$ be 
a functor.  Let $f: U \to \mathcal{F}$ be a smooth morphism of 
categories cofibered in groupoids. Then:
\begin{enumerate}
\item If $(U,R,s,t,c)$ is the groupoid in functors on $\mathcal{C}_\Lambda$ 
constructed from $f: U \to \mathcal{F}$ in Lemma 
\ref{lemma-presentation-construction}, then $(U,R,s,t,c)$ is smooth. 
\item If $f: U(k) \to \mathcal{F}(k)$ is essentially surjective, e.g.\ 
if $U$ is a predeformation functor and $\mathcal{F}$ is a predeformation 
category, then the morphism $[f]: [U/R] \to \mathcal{F}$ of Lemma 
\ref{lemma-presentation-morphism} is an equivalence.
\end{enumerate}
\end{lemma}

\begin{proof}
From the construction of Lemma \ref{lemma-presentation-construction}, we have a 
commutative diagram
\[
\xymatrix{
R = U \times_{f,\mathcal{F}, f} U \ar[r]^{\hspace{7mm} s} \ar[d]_{t} & U 
\ar[d]^{f} \\
U \ar[r]^{f} & \mathcal{F}
}
\]
where $t,s$ are the first and second projections.  So $t,s$ are smooth by Lemma 
\ref{lemma-smooth-properties} (3).  Hence (1) holds.

\medskip \noindent
If the assumption of (2) holds, then by Lemma 
\ref{lemma-smooth-morphism-essentially-surjective} the morphism $f: U 
\to \mathcal{F}$ is essentially surjective. Hence by Lemma 
\ref{lemma-presentation-morphism} (2) the morphism $[f]: [U/R] \to 
\mathcal{F}$ is an equivalence.
\end{proof}

\begin{lemma}
\label{lemma-minimal-groupoid-in-functors-construction}
Let $\mathcal{F}$ be a predeformation category.  Let $U: \mathcal{C}_\Lambda 
\to \textit{Sets}$ be a predeformation functor.  Let $f: U 
\to \mathcal{F}$ be a minimal morphism of predeformation categories. Let 
$(U,R,s,t,c)$ be the groupoid in functors on $\mathcal{C}_\Lambda$ constructed 
from $f: U \to \mathcal{F}$ in Lemma 
\ref{lemma-presentation-construction}.  Then $(U,R,s,t,c)$ is minimal. 
\end{lemma}

\begin{proof}
By definition $R = U \times_{f,\mathcal{F}, f} U$.  Hence an element of 
$R(k[\epsilon])$ is a triple $(u_1, u_2, a: f(u_1) \to f(u_2))$ 
where $u_1,u_2$ are objects of $U(k[\epsilon])$ and $a$ is a morphism in 
$\mathcal{F}(k[\epsilon])$.  By minimality of $f$ this means $u_1 = u_2$.  
Hence the projections $s,t: R(k[\epsilon]) \to U(k[\epsilon])$ 
are equal, meaning  $(U,R,s,t,c)$ is minimal.
\end{proof}

\noindent
Presentations by minimal prorepresentable groupoids in functors satisfy the 
following uniqueness property.

\begin{lemma}
\label{lemma-minimal-presentations-equivalent}
Let $\mathcal{F}$ be category cofibered in groupoids over $\mathcal 
C_\Lambda$. Assume there exist presentations of $\mathcal{F}$ by minimal 
prorepresentable groupoids in functors $(U,R,s,t,c)$ and $(U',R',s',t',c')$. 
Then $(U,R,s,t,c)$ and $(U',R',s',t',c')$ are isomorphic.
\end{lemma}

\begin{proof}
Follows from Lemma \ref{lemma-minimal-prorepresentable-groupoid-equivalence}.
\end{proof}

\begin{lemma}
\label{lemma-RS-fiber-product-morphisms}
Let $\mathcal{F}$ be a category cofibered in groupoids over $\mathcal 
C_\Lambda$.  Let $U,V: \mathcal{C}_\Lambda \to \textit{Sets}$ 
be functors.  Let $f: U \to \mathcal{F}$ and $g: V \to \mathcal 
F$ be morphisms of categories cofibered in groupoids.  Assume $\mathcal{F}, U, 
V$ all satisfy (RS).  Then $U \times_{f, \mathcal{F}, g} V$ satisfies (RS).
\end{lemma}

\begin{proof}
If $A$ is an object of $\mathcal{C}_\Lambda$, then an object of the fiber 
category $(U \times_{f, \mathcal{F}, g} V)(A)$ is a triple $(u,v,a)$ where $u 
\in U(A), v \in V(A),$ and $a: f(u) \to g(v)$ is a morphism in 
$\mathcal{F}(A)$.  

\medskip \noindent 
Let
\[
\xymatrix{
           & (u_2,v_2,a_2) \ar[d] \\
(u_1,v_1,a_1) \ar[r] & (u,v,a)  
}
\]
be a diagram in $U \times_{f, \mathcal{F}, g} V$ lying over
\[
\xymatrix{
           & A_2 \ar[d] \\
A_1 \ar[r] & A   
}
\]  
in $\mathcal{C}_\Lambda$ with $A_2 \to A$ surjective.  Since $U$ and 
$V$ satisfy (RS), there are fiber products $u_1 \times_{u} u_2$ and $v_1 
\times_{v} v_2$ lying over $A_1 \times_{A} A_2$.  Since $\mathcal{F}$ satisfies 
(RS), Lemma \ref{lemma-RS-fiber-square} shows
\[
\xymatrix{
 f(u_1 \times_{u} u_2) \ar[r] \ar[d] & f(u_2) \ar[d] \\
f(u_1) \ar[r] & f(u), 
} \hspace{4 mm} 
\xymatrix{
 g(v_1 \times_{v} v_2) \ar[r] \ar[d] & g(v_2) \ar[d] \\ 
 g(v_1) \ar[r] & g(v)
}
\]
are both fiber squares in $\mathcal{F}$.  It follows that
\[
\xymatrix{
 (u_1 \times_{u} u_2, v_1 \times_{v} v_2, a_{1} \times_{a} a_2) \ar[d] \ar[r] & 
(u_2,v_2,a_2) \ar[d] \\
(u_1,v_1,a_1) \ar[r] & (u,v,a)  
}
\]
is a fiber square in $U \times_{f, \mathcal{F}, g} V$ lying over
\[
\xymatrix{
A_1 \times_{A} A_2  \ar[r] \ar[d]         & A_2 \ar[d] \\
A_1 \ar[r] & A   .
}
\] 
\end{proof}

\begin{lemma}
\label{lemma-deformation-functor-fiber-product-morphisms}
Let $\mathcal{F}$ be a deformation category.  Let $U,V: \mathcal{C}_\Lambda 
\to \textit{Sets}$ be deformation functors.  Let $f: U 
\to \mathcal{F}$ and $g: V \to \mathcal{F}$ be morphisms of 
categories cofibered in groupoids. Then: 
\begin{enumerate}
\item $U \times_{f, \mathcal{F}, g} V$ is a deformation functor.
\item Let $u_0$ be the unique element of $U(k)$ and $u_0'$ its pushforward to 
$U(k[\epsilon])$; define $v_0$ and $v'_0$ similarly.  There is an exact 
sequence of $k$-vector spaces
\[ 
0 \to K \to T(U \times_{f, \mathcal{F}, g} V) \to TU 
\oplus TV 
\]
where $K$ is the subspace of $T(U \times_{f, \mathcal{F}, g} V)$ consisting of 
elements of the form $(u'_0, v'_0, a: f(u'_0) \to g(v'_0))$, $a \in 
\text{Hom}_{k[\epsilon]}(f(u'_0), g(v'_0))$.
\end{enumerate}
\end{lemma}

\begin{proof}
Since $U,V$ are predeformation functors and $\mathcal{F}$ is a predeformation 
category, it follows immediately that $U \times_{f, \mathcal{F}, g} V$ is a 
predeformation functor.  Hence (1) holds by Lemma 
\ref{lemma-RS-fiber-product-morphisms}.

\medskip \noindent
Taking the differentials of the projections of $U \times_{f, \mathcal{F}, g} V$ 
to $U$ and $V$ gives $k$-linear maps $T(U \times_{f, \mathcal{F}, g} V) 
\to TU$ and $T(U \times_{f, \mathcal{F}, g} V) \to TV$, and 
hence a $k$-linear map $T(U \times_{f, \mathcal{F}, g} V) \to TU \oplus 
TV$.  Explicitly, this map sends an element $(u,v,a: f(u) \to g(v))$ of 
$T(U \times_{f, \mathcal{F}, g} V)$ to $(u,v)$.  So the kernel is exactly $K$ 
(this proves that $K$ is actually a subspace). Hence (2) holds.
\end{proof}

\begin{lemma}
\label{lemma-deformation-functor-diagonal}
Let $\mathcal{F}$ be a deformation category.  Let $U: \mathcal{C}_\Lambda 
\to \textit{Sets}$ be a deformation functor.  Let $f: U 
\to \mathcal{F}$ be a morphism of categories cofibered in groupoids. Let 
$u_0$ be the unique element of $U(k)$.  Then $U \times_{f,\mathcal{F},f} U$ is a 
deformation functor with tangent space fitting into an exact sequence of 
$k$-vector spaces
\[ 
0 \to \text{Inf}_{f(u_0)}(\mathcal{F}) \to T(U \times_{f, 
\mathcal{F}, g} U) \to TU \oplus TU 
\]
\end{lemma}

\begin{proof}
Follows from Lemma \ref{lemma-deformation-functor-fiber-product-morphisms}.
\end{proof}

\begin{lemma}
\label{lemma-prorepresentable-groupoid-in-functors-construction}
Let $\mathcal{F}$ be a deformation category.  Let $U: \mathcal{C}_\Lambda 
\to \textit{Sets}$ be a prorepresentable functor.  Let $f: U 
\to \mathcal{F}$ be a morphism of categories cofibered in groupoids.  
Let $(U,R,s,t,c)$ be the groupoid in functors on $\mathcal{C}_\Lambda$ 
constructed from $f: U \to \mathcal{F}$ in Lemma 
\ref{lemma-presentation-construction}. Assume $\dim_{k} 
\text{Inf}_{x_0}(\mathcal{F})$ is finite for some (and hence all) $x_0 \in 
\text{Ob}(\mathcal{F}(k))$.  Then  $(U,R,s,t,c)$ is prorepresentable.
\end{lemma}

\begin{proof}
By the exact sequence of Lemma \ref{lemma-deformation-functor-diagonal}, 
$\dim_{k} T(U \times_{f,\mathcal{F},f} U)$ is finite.  Thus $R =U 
\times_{f,\mathcal{F},f} U$ is prorepresentable by Lemma 
\ref{lemma-Schlessinger-prorepresentability}. It follows from Lemma 
\ref{lemma-groupoid-in-functors-prorep-equivalences} (2) that $(U,R,s,t,c)$ is 
prorepresentable.
\end{proof}

\begin{theorem}
\label{theorem-presentation-deformation-groupoid}
Let $\mathcal{F}$ be a category cofibered in groupoids over $\mathcal 
C_\Lambda$.  Then $\mathcal{F}$ admits a presentation by a minimal smooth 
prorepresentable groupoid in functors on $\mathcal{C}_\Lambda$ if and only if 
the following conditions hold:
\begin{enumerate}
\item $\mathcal{F}$ is a deformation category.
\item $\dim_k T\mathcal{F}$ is finite.
\item $\dim_k \text{Inf}_{x_0}(\mathcal{F})$ is finite for some (and hence 
all) $x_0 \in \text{Ob}(\mathcal{F}(k))$.
\end{enumerate}
\end{theorem}

\begin{proof}
If $\mathcal{F}$ is equivalent to a smooth prorepresentable groupoid in 
functors, then conditions (1)-(3) follow from Lemma 
\ref{lemma-deformation-groupoid-quotient} (1)-(3).  Conversely, assume 
conditions (1)-(3) hold. Then by Theorem 
\ref{theorem-miniversal-object-existence} there exists a prorepresentable 
functor $U: \mathcal{C}_\Lambda \to \textit{Sets}$ and a minimal 
smooth morphism $f: U \to \mathcal{F}$.  By Lemmas 
\ref{lemma-smooth-groupoid-in-functors-construction}, 
\ref{lemma-minimal-groupoid-in-functors-construction}, and 
\ref{lemma-prorepresentable-groupoid-in-functors-construction}, the 
construction of Lemma \ref{lemma-presentation-construction} applied to $f: U 
\to \mathcal{F}$ gives a minimal smooth prorepresentable groupoid in 
functors $(U,R,s,t,c)$. By Lemma 
\ref{lemma-smooth-groupoid-in-functors-construction}, the morphism $[f]: [U/R] 
\to \mathcal{F}$ of Lemma \ref{lemma-presentation-morphism} is an 
equivalence.  This is the desired presentation of $\mathcal{F}$.
\end{proof}




\section{The Deformation Category of a Point of an Algebraic Stack} 
\label{section-algebraic-stacks}

\noindent
To do: Show that an algebraic stack of finite type over a locally Noetherian
base satisfies (RS) at any finite type point (this may have to go in a later
chapter). This will provide some motivation for Artin's criteria later.
A perhaps more roundabout  way of showing this (which does give more
information, though) is to show that a groupoid presentation of the stack
gives rise to a presentation of the deformation category at any point.




\section{Examples}
\label{section-examples}

\noindent
List of things that should go here:
\begin{enumerate}
\item Describe the general outline of an example.
\item Deformations of schemes:
\begin{enumerate}
\item The Rim-Schlessinger condition.
\item Computing the tangent space.
\item Computing the infinitesimal deformations.
\item The deformation category of an affine hypersurface.
\end{enumerate}
\item Deformations of representations of abstract groups.
\item Deformations of representations of topological groups
(e.g., profinite ones).
\item Deformations of sheaves (for example fix $X/S$, a finite type point
$s$ of $S$, and a quasi-coherent sheaf $\mathcal{F}_s$ over $X_s$).
\item Deformations of algebraic spaces (very similar to deformations
of schemes; maybe even easier?).
\item Deformations of maps (eg morphisms between schemes; you can fix
both or one of the target and/or source).
\item Add more here.
\end{enumerate}


\input{chapters}

\bibliography{my}
\bibliographystyle{amsalpha}

\end{document}
