\input{preamble}

% OK, start here.
%
\begin{document}

\title{Criteria for Representability}

\maketitle

\phantomsection
\label{section-phantom}

\tableofcontents




\section{Introduction}
\label{section-introduction}

\noindent
The purpose of this chapter is to find criteria guaranteeing that a
a stack in groupoids over the category of schemes with the fppf topology
is an algebraic stack. Historically, this often involved proving that
certain functors were representable, see Grothendieck's lectures
\cite{Gr-I},
\cite{Gr-II},
\cite{Gr-III},
\cite{Gr-IV},
\cite{Gr-V}, and
\cite{Gr-VI}.
This explains the title of this chapter. Another important source
of this material comes from the work of Artin, see
\cite{ArtinI},
\cite{ArtinII},
\cite{Artin-Theorem-Representability},
\cite{Artin-Construction-Techniques},
\cite{Artin-Algebraic-Spaces},
\cite{Artin-Algebraic-Approximation},
\cite{Artin-Implicit-Function}, and
\cite{ArtinVersal}.



\section{Conventions}
\label{section-conventions}

\noindent
The conventions we use in this chapter are the same as those in the
chapter on algebraic stacks, see
Algebraic Stacks, Section \ref{algebraic-section-conventions}.




\section{What we already know}
\label{section-done-so-far}

\noindent
The analogue of this chapter for algebraic spaces is the chapter entitled
``Bootstrap'', see
Bootstrap, Section \ref{bootstrap-section-introduction}.
That chapter already contains some representability results.
Moreover, some of the preliminary material treated there we already
have worked out in the chapter on algebraic stacks.
Here is a list:
\begin{enumerate}
\item We discuss morphisms of presheaves representable by algebraic spaces in
Bootstrap, Section
\ref{bootstrap-section-morphism-representable-by-spaces}.
In
Algebraic Stacks, Section
\ref{algebraic-section-morphisms-representable-by-algebraic-spaces}
we discuss the notion of a $1$-morphism of categories fibred in groupoids
being representable by algebraic spaces.
\item We discuss properties of morphisms of presheaves representable by
algebraic spaces in
Bootstrap, Section
\ref{bootstrap-section-representable-by-spaces-properties}.
In
Algebraic Stacks, Section
\ref{algebraic-section-representable-properties}
we discuss the notion of a $1$-morphism of categories fibred in groupoids
being representable by algebraic spaces.
\item We proved that if $F$ is a sheaf whose diagonal is representable
by algebraic spaces and which has an \'etale covering by an algebraic
space, then $F$ is an algebraic space, see
Bootstrap, Theorem \ref{bootstrap-theorem-bootstrap}.
(This is a weak version of the result in the next item on the list.)
\item
\label{item-bootstrap-final}
We proved that if $F$ is a sheaf and if there exists an algebraic
space $U$ and a morphism $U \to F$ which is representable by algebraic
spaces, surjective, flat, and locally of finite presentation, then
$F$ is an algebraic space, see
Bootstrap, Theorem \ref{bootstrap-theorem-final-bootstrap}.
\item We have also proved the ``smooth'' analogue of
(\ref{item-bootstrap-final}) for algebraic
stacks: If $\mathcal{X}$ is a stack in groupoids over
$(\textit{Sch}/S)_{fppf}$ and if there exists a stack in groupoids
$\mathcal{U}$ over $(\textit{Sch}/S)_{fppf}$ which is representably
by an algebraic space and a $1$-morphism $u : \mathcal{U} \to \mathcal{X}$
which is representable by algebraic spaces, surjective, and smooth
then $\mathcal{X}$ is an algebraic stack, see
Algebraic Stacks, Lemma
\ref{algebraic-lemma-smooth-surjective-morphism-implies-algebraic}.
\end{enumerate}
Our first task now is to prove the analogue of
(\ref{item-bootstrap-final}) for algebraic
stacks in general.



\section{Morphisms of stacks in groupoids}
\label{section-1-morphisms}

\noindent
This section is preliminary and should be skipped on a first reading.

\begin{lemma}
\label{lemma-etale-permanence}
Let $\mathcal{X} \to \mathcal{Y} \to \mathcal{Z}$
be $1$-morphisms of categories fibred in groupoids over
$(\textit{Sch}/S)_{fppf}$.
If $\mathcal{X} \to \mathcal{Z}$ and $\mathcal{Y} \to \mathcal{Z}$ are
representable by algebraic spaces and \'etale so is
$\mathcal{X} \to \mathcal{Y}$.
\end{lemma}

\begin{proof}
Let $\mathcal{U}$ be a representable category fibred in groupoids over $S$.
Let $f : \mathcal{U} \to \mathcal{Y}$ be a $1$-morphism. We have to show that
$\mathcal{X} \times_{\mathcal{Y}} \mathcal{U}$ is representable by an
algebraic space and \'etale over $\mathcal{U}$.
Consider the composition $h : \mathcal{U} \to \mathcal{Z}$. Then
$$
\mathcal{X} \times_{\mathcal{Z}} \mathcal{U}
\longrightarrow
\mathcal{Y} \times_{\mathcal{Z}} \mathcal{U}
$$
is a $1$-morphism between categories fibres in groupoids which are both
representable by algebraic spaces and both \'etale over $\mathcal{U}$.
Hence by
Properties of Spaces, Lemma \ref{spaces-properties-lemma-etale-permanence}
this is represented by an \'etale morphism of algebraic spaces.
Finally, we obtain the result we want as the morphism $f$ induces
a morphism $\mathcal{U} \to \mathcal{Y} \times_{\mathcal{Z}} \mathcal{U}$
and we have
$$
\mathcal{X} \times_{\mathcal{Y}} \mathcal{U} =
(\mathcal{X} \times_{\mathcal{Z}} \mathcal{U})
\times_{(\mathcal{Y} \times_{\mathcal{Z}} \mathcal{U})}
\mathcal{U}.
$$
\end{proof}

\begin{lemma}
\label{lemma-stack-in-setoids-descent}
Let $\mathcal{X}, \mathcal{Y}, \mathcal{Z}$ be stacks in groupoids
over $(\textit{Sch}/S)_{fppf}$. Suppose that $\mathcal{X} \to \mathcal{Y}$
and $\mathcal{Z} \to \mathcal{Y}$ are $1$-morphisms.
If
\begin{enumerate}
\item $\mathcal{Y}$, $\mathcal{Z}$ are representable by algebraic spaces
$Y$, $Z$ over $S$,
\item the associated morphism of algebraic spaces $Y \to Z$ is surjective,
flat and locally of finite presentation, and
\item $\mathcal{Y} \times_{\mathcal{Z}} \mathcal{X}$ is a stack in
setoids,
\end{enumerate}
then $\mathcal{X}$ is a stack in setoids.
\end{lemma}

\begin{proof}
This is a special case of
Stacks, Lemma \ref{stacks-lemma-stack-in-setoids-descent}.
\end{proof}

\noindent
The following lemma is the analogue of
Algebraic Stacks, Lemma
\ref{algebraic-lemma-smooth-surjective-morphism-implies-algebraic}
and will be superseded by the stronger (insert future reference here).

\begin{lemma}
\label{lemma-flat-finite-presentation-surjective-diagonal}
Let $S$ be a scheme.
Let $u : \mathcal{U} \to \mathcal{X}$ be a $1$-morphism of
stacks in groupoids over $(\textit{Sch}/S)_{fppf}$. If
\begin{enumerate}
\item $\mathcal{U}$ is representable by an algebraic space, and
\item $u$ is representable by algebraic spaces, surjective, flat and
locally of finite presentation,
\end{enumerate}
then
$\Delta : \mathcal{X} \to \mathcal{X} \times \mathcal{X}$
representable by algebraic spaces.
\end{lemma}

\begin{proof}
Given two schemes $T_1$, $T_2$ over $S$ denote
$\mathcal{T}_i = (\textit{Sch}/T_i)_{fppf}$ the associated representable
fibre categories. Suppose given $1$-morphisms
$f_i : \mathcal{T}_i \to \mathcal{X}$.
According to
Algebraic Stacks, Lemma \ref{algebraic-lemma-representable-diagonal}
it suffices to prove that the $2$-fibered
product $\mathcal{T}_1 \times_{\mathcal{X}} \mathcal{T}_2$
is representable by an algebraic space. By
Stacks, Lemma
\ref{stacks-lemma-2-fibre-product-stacks-in-setoids-over-stack-in-groupoids}
this is in any case a stack in setoids. Thus
$\mathcal{T}_1 \times_{\mathcal{X}} \mathcal{T}_2$ corresponds
to some sheaf $F$ on $(\textit{Sch}/S)_{fppf}$, see
Stacks, Lemma \ref{stacks-lemma-stack-in-setoids-characterize}.
Let $U$ be the algebraic space which represents $\mathcal{U}$.
By assumption
$$
\mathcal{T}_i' = \mathcal{U} \times_{u, \mathcal{X}, f_i} \mathcal{T}_i
$$
is representable by an algebraic space $T'_i$ over $S$. Hence
$\mathcal{T}_1' \times_\mathcal{U} \mathcal{T}_2'$ is representable
by the algebraic space $T'_1 \times_U T'_2$.
Consider the commutative diagram
$$
\xymatrix{
&
\mathcal{T}_1 \times_{\mathcal X} \mathcal{T}_2 \ar[rr]\ar'[d][dd] & &
\mathcal{T}_1 \ar[dd] \\ 
\mathcal{T}_1' \times_\mathcal{U} \mathcal{T}_2' \ar[ur]\ar[rr]\ar[dd] & &
\mathcal{T}_1' \ar[ur]\ar[dd] \\ 
&
\mathcal{T}_2 \ar'[r][rr] & &
\mathcal X \\ 
\mathcal{T}_2' \ar[rr]\ar[ur] & &
\mathcal{U} \ar[ur] }
$$
In this diagram the bottom square, the right square, the back square, and
the front square are $2$-fibre products. A formal argument then shows
that $\mathcal{T}_1' \times_\mathcal{U} \mathcal{T}_2' \to 
\mathcal{T}_1 \times_{\mathcal X} \mathcal{T}_2$
is the ``base change'' of $\mathcal{U} \to \mathcal{X}$, more precisely
the diagram
$$
\xymatrix{
\mathcal{T}_1' \times_\mathcal{U} \mathcal{T}_2' \ar[d] \ar[r] &
\mathcal{U} \ar[d] \\
\mathcal{T}_1 \times_{\mathcal X} \mathcal{T}_2 \ar[r] &
\mathcal{X}
}
$$
is a $2$-fibre square.
Hence $T'_1 \times_U T'_2 \to F$ is representable by algebraic spaces,
flat, locally of finite presentation and surjective, see
Algebraic Stacks, Lemmas
\ref{algebraic-lemma-map-fibred-setoids-representable-algebraic-spaces},
\ref{algebraic-lemma-base-change-representable-by-spaces},
\ref{algebraic-lemma-map-fibred-setoids-property}, and
\ref{algebraic-lemma-base-change-representable-transformations-property}.
Therefore $F$ is an algebraic space by
Bootstrap, Theorem \ref{bootstrap-theorem-final-bootstrap}
and we win.
\end{proof}









\section{Algebraic morphisms}
\label{section-algebraic}

\noindent
The following notion is occasionally useful.

\begin{definition}
\label{definition-algebraic}
Let $S$ be a scheme. Let $F : \mathcal{X} \to \mathcal{Y}$ be a
$1$-morphism of stacks in groupoids over $(\textit{Sch}/S)_{fppf}$.
We say that $F$ is {\it algebraic} if for every scheme $T$ and every
object $\xi$ of $\mathcal{Y}$ over $T$ the $2$-fibre product
$$
(\textit{Sch}/T)_{fppf} \times_{\xi, \mathcal{Y}} \mathcal{X}
$$
is an algebraic stack over $S$.
\end{definition}

\noindent
With this terminology in place we have the following result that generalizes
Algebraic Stacks, Lemma
\ref{algebraic-lemma-representable-morphism-to-algebraic}.

\begin{lemma}
\label{lemma-algebraic-morphism-to-algebraic}
Let $S$ be a scheme.
Let $F : \mathcal{X} \to \mathcal{Y}$ be a $1$-morphism of
stacks in groupoids over $(\textit{Sch}/S)_{fppf}$. If
\begin{enumerate}
\item $\mathcal{Y}$ is an algebraic stack, and
\item $F$ is algebraic (see above),
\end{enumerate}
then $\mathcal{X}$ is an algebraic stack.
\end{lemma}

\begin{proof}
By assumption (1) there exists a scheme $T$ and an object
$\xi$ of $\mathcal{Y}$ over $T$ such that the corresponding
$1$-morphism $\xi : (\textit{Sch}/T)_{fppf} \to \mathcal{Y}$
is smooth an surjective. Then
$\mathcal{U} = (\textit{Sch}/T)_{fppf} \times_{\xi, \mathcal{Y}} \mathcal{X}$
is is an algebraic stack by assumption (2).
Choose a scheme $U$ and a surjective smooth $1$-morphism
$(\textit{Sch}/U)_{fppf} \to \mathcal{U}$.
The projection $\mathcal{U} \longrightarrow \mathcal{X}$
is, as the base change of the morphism
$\xi : (\textit{Sch}/T)_{fppf} \to \mathcal{Y}$,
surjective and smooth, see
Algebraic Stacks, Lemma
\ref{algebraic-lemma-base-change-representable-transformations-property}.
Then the composition
$(\textit{Sch}/U)_{fppf} \to \mathcal{U} \to \mathcal{X}$
is surjective and smooth as a composition of surjective and smooth
morphisms, see
Algebraic Stacks, Lemma
\ref{algebraic-lemma-composition-representable-transformations-property}.
Hence $\mathcal{X}$ is an algebraic stack by
Algebraic Stacks, Lemma
\ref{algebraic-lemma-smooth-surjective-morphism-implies-algebraic}.
\end{proof}

\begin{lemma}
\label{lemma-map-from-algebraic}
Let $S$ be a scheme. Let $F : \mathcal{X} \to \mathcal{Y}$ be a $1$-morphism
of stacks in groupoids over $(\textit{Sch}/S)_{fppf}$. If $\mathcal{X}$ is an
algebraic stack and $\Delta : \mathcal{Y} \to \mathcal{Y} \times \mathcal{Y}$
is representable by algebraic spaces, then $F$ is algebraic.
\end{lemma}

\begin{proof}
Choose a representable stack in groupoids $\mathcal{U}$ and a surjective
smooth $1$-morphism $\mathcal{U} \to \mathcal{X}$. Let $T$ be a scheme and
let $\xi$ be an object of $\mathcal{Y}$ over $T$. The morphism of
$2$-fibre products
$$
(\textit{Sch}/T)_{fppf} \times_{\xi, \mathcal{Y}} \mathcal{U}
\longrightarrow
(\textit{Sch}/T)_{fppf} \times_{\xi, \mathcal{Y}} \mathcal{X}
$$
is representable by algebraic spaces, surjective, and smooth as a
base change of $\mathcal{U} \to \mathcal{X}$, see
Algebraic Stacks,
Lemmas \ref{algebraic-lemma-base-change-representable-by-spaces} and
\ref{algebraic-lemma-base-change-representable-transformations-property}.
By our condition on the diagonal of $\mathcal{Y}$ we see that
the source of this morphism is representable by an algebraic space, see
Algebraic Stacks, Lemma \ref{algebraic-lemma-representable-diagonal}.
Hence the target is an algebraic stack by
Algebraic Stacks,
Lemma \ref{algebraic-lemma-smooth-surjective-morphism-implies-algebraic}.
\end{proof}
















\section{Spaces of sections}
\label{section-spaces-sections}

\noindent
Given morphisms $W \to Z \to U$ we can consider the functor that associates
to a scheme $U'$ over $U$ the set of sections $\sigma : Z_{U'} \to W_{U'}$
of the base change $W_{U'} \to Z_{U'}$ of the morphism $W \to Z$.
In this section we prove some preliminary lemmas on this functor.

\begin{lemma}
\label{lemma-surjection-space-of-sections}
Let $Z \to U$ be a finite morphism of schemes.
Let $W$ be an algebraic space and let $W \to Z$ be a
surjective \'etale morphism. Then there exists a surjective
\'etale morphism $U' \to U$ and a section
$$
\sigma : Z_{U'} \to W_{U'}
$$
of the morphism $W_{U'} \to Z_{U'}$.
\end{lemma}

\begin{proof}
We may choose a separated scheme $W'$ and a surjective \'etale morphism
$W' \to W$. Hence after replacing $W$ by $W'$ we may assume that $W$
is a separated scheme. Write $f : W \to Z$ and $\pi : Z \to U$.
Note that $f \circ \pi : W \to U$ is separated as
$W$ is separated (see
Schemes, Lemma \ref{schemes-lemma-compose-after-separated}).
Let $u \in U$ be a point. Clearly it suffices
to find an \'etale neighbourhood $(U', u')$ of $(U, u)$ such that
a section $\sigma$ exists over $U'$. Let $z_1, \ldots, z_r$
be the points of $Z$ lying above $u$. For each $i$ choose a point
$w_i \in W$ which maps to $z_i$. We may pick an \'etale neighbourhood
$(U', u') \to (U, u)$ such that the conclusions of
More on Morphisms, Lemma
\ref{more-morphisms-lemma-etale-splits-off-quasi-finite-part-technical-variant}
hold for both $Z \to U$ and the points $z_1, \ldots, z_r$
and $W \to U$ and the points $w_1, \ldots, w_r$. Hence, after
replacing $(U, u)$ by $(U', u')$ and relabeling, we may assume that
all the field extensions $\kappa(u) \subset \kappa(z_i)$ and
$\kappa(u) \subset \kappa(w_i)$ are purely inseparable, and moreover
that there exist disjoint union decompositions
$$
Z = V_1 \amalg \ldots \amalg V_r \amalg A, \quad
W = W_1 \amalg \ldots \amalg W_r \amalg B
$$
by open and closed subschemes
with $z_i \in V_i$, $w_i \in W_i$ and $V_i \to U$, $W_i \to U$ finite.
After replacing $U$ by $U \setminus \pi(A)$ we may assume that
$A = \emptyset$, i.e., $Z = V_1 \amalg \ldots \amalg V_r$.
After replacing $W_i$ by $W_i \cap f^{-1}(V_i)$ and
$B$ by $B \cup \bigcup W_i \cap f^{-1}(Z \setminus V_i)$
we may assume that $f$ maps $W_i$ into $V_i$.
Then $f_i = f|_{W_i} : W_i \to V_i$ is a morphism of schemes finite over $U$,
hence finite (see
Morphisms, Lemma \ref{morphisms-lemma-finite-permanence}).
It is also \'etale (by assumption),
$f_i^{-1}(\{z_i\}) = w_i$, and induces an isomorphism of residue
fields $\kappa(z_i) = \kappa(w_i)$ (because both are purely inseparable
extensions of $\kappa(u)$ and $\kappa(z_i) \subset \kappa(w_i)$
is separable as $f$ is \'etale). Hence by
\'Etale Morphisms of Schemes, Lemma \ref{etale-lemma-finite-etale-one-point}
we see that $f_i$ is an isomorphism in a neighbourhood $V_i'$ of
$z_i$. Since $\pi : Z \to U$ is closed, after shrinking $U$, we may assume
that $W_i \to V_i$ is an isomorphism. This proves the lemma.
\end{proof}

\begin{lemma}
\label{lemma-space-of-sections}
Let $Z \to U$ be a finite locally free morphism of schemes.
Let $W$ be an algebraic space and let $W \to Z$ be an \'etale morphism.
Then the functor
$$
F : (\textit{Sch}/U)_{fppf}^{opp} \longrightarrow \textit{Sets},
$$
defined by the rule
$$
U' \longmapsto
F(U') =
\{\sigma : Z_{U'} \to W_{U'}\text{ section of }W_{U'} \to Z_{U'}\}
$$
is an algebraic space and the morphism $F \to U$ is \'etale.
\end{lemma}

\begin{proof}
Assume first that $W \to Z$ is also separated.
Let $U'$ be a scheme over $U$ and let $\sigma \in F(U')$. By
Morphisms of Spaces, Lemma \ref{spaces-morphisms-lemma-section-immersion}
the morphism $\sigma$ is a closed immersion.
Moreover, $\sigma$ is \'etale by
Properties of Spaces, Lemma \ref{spaces-properties-lemma-etale-permanence}.
Hence $\sigma$ is also an open immersion, see
Morphisms of Spaces,
Lemma \ref{spaces-morphisms-lemma-etale-universally-injective-open}.
In other words, $Z_\sigma = \sigma(Z_{U'}) \subset W_{U'}$ is
an open subspace such that the morphism $Z_\sigma \to Z_{U'}$
is an isomorphism. In particular, the morphism $Z_\sigma \to U'$
is finite. Hence we obtain a transformation of functors
$$
F \longrightarrow (W/U)_{fin},\quad
\sigma \longmapsto (U' \to U, Z_\sigma)
$$
where $(W/U)_{fin}$ is the finite part of the morphism $W \to U$
introduced in
More on Groupoid Spaces, Section \ref{spaces-more-groupoids-section-finite}.
It is clear that this transformation of functors is injective (since we can
recover $\sigma$ from $Z_\sigma$ as the inverse of the isomorphism
$Z_\sigma \to Z_{U'}$). By
More on Groupoids in Space, Proposition
\ref{spaces-more-groupoids-proposition-finite-algebraic-space}
we know that $(W/U)_{fin}$ is an algebraic space \'etale over $U$.
Hence to finish the proof in this case it suffices to show that
$F \to (W/U)_{fin}$ is representable and an open immersion.
To see this suppose that we are given a morphism of schemes $U' \to U$
and an open subspace $Z' \subset W_{U'}$ such that $Z' \to U'$
is finite. Then it suffices to show that there exists an
open subscheme $U'' \subset U'$ such that a morphism
$T \to U'$ factors through $U''$ if and only if $Z' \times_{U'} T$
maps isomorphically to $Z \times_{U'} T$. This follows from
Quot and Hilbert Spaces, Lemma \ref{quot-lemma-where-isomorphism}
(here we use that $Z \to B$ is flat and locally of finite presentation
as well as finite).
Hence we have proved the lemma in case $W \to Z$ is separated
as well as \'etale.

\medskip\noindent
In the general case we choose a separated scheme $W'$ and a surjective
\'etale morphism $W' \to W$. Note that the morphisms $W' \to W$ and
$W \to Z$ are separated as their source is separated. Denote $F'$ the
functor associated to $W' \to Z \to U$ as in the lemma. In the first
paragraph of the proof we showed that $F'$ is representable by an
algebraic space \'etale over $U$. By
Lemma \ref{lemma-surjection-space-of-sections}
the map of functors $F' \to F$ is surjective for the \'etale topology
on $\textit{Sch}/U$. Moreover, if $U'$ and $\sigma : Z_{U'} \to W_{U'}$
define a point $\xi \in F(U')$, then the fibre product
$$
F'' = F' \times_{F, \xi} U'
$$
is the functor on $\textit{Sch}/U'$ associated to the morphisms
$$
W'_{U'} \times_{W_{U'}, \sigma} Z_{U'} \to Z_{U'} \to U'.
$$
Since the first morphism is separated as a base change of a separated
morphism, we see that $F''$ is an algebraic space \'etale over $U'$
by the result of the first paragraph. It follows that $F' \to F$ is a
surjective \'etale transformation of functors, which is representable
by algebraic spaces. Hence $F$ is an algebraic space by
Bootstrap, Theorem \ref{bootstrap-theorem-final-bootstrap}.
Since $F' \to F$ is an \'etale surjective morphism of algebraic spaces
it follows that $F \to U$ is \'etale because $F' \to U$ is \'etale.
\end{proof}









\section{Relative morphisms}
\label{section-relative-morphisms}

\noindent
Let $S$ be a scheme. Let $Z \to B$ and $X \to B$ be morphisms of
algebraic spaces over $S$. Given a scheme $T$ we can consider pairs
$(a, b)$ where $a : T \to B$
is a morphism and $b : T \times_{a, B} Z \to T \times_{a, B} X$
is a morphism over $T$. Picture
\begin{equation}
\label{equation-hom}
\vcenter{
\xymatrix{
T \times_{a, B} Z \ar[rd] \ar[rr]_b & &
T \times_{a, B} X \ar[ld] & Z \ar[rd] & & X \ar[ld] \\
& T \ar[rrr]^a & & & B
}
}
\end{equation}
Of course, we can also think of $b$ as a morphism
$b : T \times_{a, B} Z \to X$ such that
$$
\xymatrix{
T \times_{a, B} Z \ar[r] \ar[d] \ar@/^1pc/[rrr]_-b &
Z \ar[rd] & & X \ar[ld] \\
T \ar[rr]^a & & B
}
$$
commutes. In this situation we can define a functor
\begin{equation}
\label{equation-hom-functor}
\mathit{Mor}_{B}(Z, X) : (\text{Sch}/S)^{opp} \longrightarrow \textit{Sets},
\quad
T \longmapsto \{(a, b)\text{ as above}\}
\end{equation}
Sometimes we think of this as a functor defined on the category
of schemes over $B$, in which case we drop $a$ from the notation.

\begin{lemma}
\label{lemma-hom-functor-sheaf}
Let $S$ be a scheme. Let $Z \to B$ and $X \to B$ be morphisms of
algebraic spaces over $S$. Then
\begin{enumerate}
\item $\mathit{Mor}_B(Z, X)$ is a sheaf on
$(\text{Sch}/S)_{fppf}$.
\item If $T$ is an algebraic space over $S$, then there is a
canonical bijection
$$
\text{Mor}_{\textit{Sh}((\textit{Sch}/S)_{fppf})}(T, \mathit{Mor}_B(Z, X))
=
\{(a, b)\text{ as in }(\ref{equation-hom})\}
$$
\end{enumerate}
\end{lemma}

\begin{proof}
Let $T$ be an algebraic space over $S$. Let $\{T_i \to T\}$ be an fppf
covering of $T$ (as in
Topologies on Spaces, Section \ref{spaces-topologies-section-fppf}).
Suppose that $(a_i, b_i) \in \mathit{Mor}_B(Z, X)(T_i)$ such
that $(a_i, b_i)|_{T_i \times_T T_j} = (a_j, b_j)|_{T_i \times_T T_j}$
for all $i, j$. Then by
Descent on Spaces,
Lemma \ref{spaces-descent-lemma-fppf-universal-effective-epimorphisms}
there exists a unique morphism $a : T \to B$ such that $a_i$ is the
composition of $T_i \to T$ and $a$. Then
$\{T_i \times_{a_i, B} Z \to T \times_{a, B} Z\}$ is an fppf covering
too and the same lemma implies there exists a unique morphism
$b : T \times_{a, B} Z \to T \times_{a, B} X$ such that $b_i$ is the
composition of $T_i \times_{a_i, B} Z \to T \times_{a, B} Z$ and $b$. Hence
$(a, b) \in \mathit{Mor}_B(Z, X)(T)$ restricts to $(a_i, b_i)$
over $T_i$ for all $i$.

\medskip\noindent
Note that the result of the preceding paragraph in particular implies (1).

\medskip\noindent
Let $T$ be an algebraic space over $S$. In order to prove (2) we will
construct mutually inverse maps between the displayed sets. In the
following when we say ``pair'' we mean a pair $(a, b)$ fitting
into (\ref{equation-hom}).

\medskip\noindent
Let $v : T \to \mathit{Mor}_B(Z, X)$ be a natural transformation.
Choose a scheme $U$ and a surjective \'etale morphism $p : U \to T$.
Then $v(p) \in \mathit{Mor}_B(Z, X)(U)$ corresponds to a pair $(a_U, b_U)$
over $U$. Let $R = U \times_T U$ with projections $t, s : R \to U$.
As $v$ is a transformation of functors we see that the pullbacks of
$(a_U, b_U)$ by $s$ and $t$ agree. Hence, since $\{U \to T\}$ is an
fppf covering, we may apply the result of the first paragraph that
deduce that there exists a unique pair $(a, b)$ over $T$.

\medskip\noindent
Conversely, let $(a, b)$ be a pair over $T$. 
Let $U \to T$, $R = U \times_T U$, and $t, s : R \to U$ be as
above. Then the restriction $(a, b)|_U$ gives rise to a
tranformation of functors $v : h_U \to \mathit{Mor}_B(Z, X)$ by the
Yoneda lemma
(Categories, Lemma \ref{categories-lemma-yoneda}).
As the two pullbacks $s^*(a, b)|_U$ and $t^*(a, b)|_U$
are equal, we see that $v$ coequalizes the two maps
$h_t, h_s : h_R \to h_U$. Since $T = U/R$ is the fppf quotient sheaf by
Spaces, Lemma \ref{spaces-lemma-space-presentation}
and since $\mathit{Mor}_B(Z, X)$ is an fppf sheaf by (1) we conclude
that $v$ factors through a map $T \to \mathit{Mor}_B(Z, X)$.

\medskip\noindent
We omit the verification that the two constructions above are mutually
inverse.
\end{proof}

\begin{lemma}
\label{lemma-base-change-hom-functor}
Let $S$ be a scheme. Let $Z \to B$, $X \to B$, and $B' \to B$
be morphisms of algebraic spaces over $S$. Set $Z' = B' \times_B Z$
and $X' = B' \times_B X$. Then
$$
\mathit{Mor}_{B'}(Z', X')
=
B' \times_B \mathit{Mor}_B(Z, X)
$$
in $\textit{Sh}((\textit{Sch}/S)_{fppf})$.
\end{lemma}

\begin{proof}
The equality as functors follows immediately from the definitions.
The equality as sheaves follows from this because both sides are
sheaves according to
Lemma \ref{lemma-hom-functor-sheaf}
and the fact that a fibre product of sheaves is the same as the
corresponding fibre product of pre-sheaves (i.e., functors).
\end{proof}

\begin{lemma}
\label{lemma-etale-covering-hom-functor}
Let $S$ be a scheme. Let $Z \to B$ and $X' \to X \to B$ be morphisms of
algebraic spaces over $S$. Assume
\begin{enumerate}
\item $X' \to X$ is \'etale, and
\item $Z \to B$ is finite locally free.
\end{enumerate}
Then $\mathit{Mor}_B(Z, X') \to \mathit{Mor}_B(Z, X)$ is representable
by algebraic spaces and \'etale. If $X' \to X$ is also surjective,
then $\mathit{Mor}_B(Z, X') \to \mathit{Mor}_B(Z, X)$ is surjective.
\end{lemma}

\begin{proof}
Let $U$ be a scheme and let $\xi = (a, b)$ be an element of
$\mathit{Mor}_B(Z, X)(U)$. We have to prove that the functor
$$
h_U \times_{\xi, \mathit{Mor}_B(Z, X)} \mathit{Mor}_B(Z, X')
$$
is representable by an algebaic space \'etale over $U$. Set
$Z_U = U \times_{a, B} Z$ and $W = Z_U \times_{b, X} X'$.
Then $W \to Z_U \to U$ is as in
Lemma \ref{lemma-space-of-sections}
and the sheaf $F$ defined there is identified with the fibre product
displayed above. Hence the first assertion of the lemma.
The second assertion follows from this and
Lemma \ref{lemma-surjection-space-of-sections}
which guarantees that $F \to U$ is surjective in the situation above.
\end{proof}

\begin{lemma}
\label{lemma-hom-from-finite-free-into-affine}
Let $Z \to B$ and $X \to B$ be morphisms of affine schemes.
Assume $\Gamma(Z, \mathcal{O}_Z)$ is a finite free
$\Gamma(B, \mathcal{O}_B)$-module. Then $\mathit{Mor}_B(Z, X)$
is representable by an affine scheme over $B$.
\end{lemma}

\begin{proof}
Write $B = \text{Spec}(R)$. Choose a basis $\{e_1, \ldots, e_m\}$
for $\Gamma(Z, \mathcal{O}_Z)$. Finally, choose a presentation
$$
\Gamma(X, \mathcal{O}_X) = R[\{x_i\}_{i \in I}]/(\{f_k\}_{k \in K}).
$$
We will denote $\overline{x}_i$ the image of $x_i$ in this quotient.
Write
$$
P = R[\{a_{ij}\}_{i \in I, 1 \leq j \leq m}].
$$
Consider the $R$-algebra map
$$
\Psi :
R[\{x_i\}_{i \in I}]
\longrightarrow
P \otimes_R \Gamma(Z, \mathcal{O}_Z),\quad
x_i \longmapsto \sum\nolimits_j a_{ij} \otimes e_j.
$$
Write $\Psi(f_k) = \sum c_{kj} \otimes e_j$ with $c_{kj} \in P$.
Finally, denote $J \subset P$ the ideal generated by the elements
$c_{kj}$, $k \in K$, $1 \leq j \leq m$. We claim that
$W = \text{Spec}(P/J)$ represents the functor $\mathit{Mor}_B(Z, X)$.

\medskip\noindent
First, note that by construction $P/J$ is an $R$-algebra, hence
a morphism $a_{univ} : W \to B$. Second, by construction the map
$\Psi$ factors through $\Gamma(X, \mathcal{O}_X)$, hence we obtain
an $P/J$-algebra homomorphism
$$
P/J \otimes_R \Gamma(X, \mathcal{O}_X)
\longrightarrow
P/J \otimes_R \Gamma(Z, \mathcal{O}_Z)
$$
which determines a morphism
$b_{univ} : W \times_{a_{univ}, B} Z \to W \times_{a_{univ}, B} X$.
By the Yoneda lemma the pair $(a_{univ}, b_{univ})$ determines a
transformation of functors $W \to \mathit{Mor}_B(Z, X)$ which we
claim is an isomorphism. To show that it is an isomorphism it suffices
to show that it induces a bijection of sets
$W(T) \to \mathit{Mor}_B(Z, X)(T)$ over any affine
scheme $T$.

\medskip\noindent
Suppose $T = \text{Spec}(R')$ is an affine scheme
and $(a, b) \in \mathit{Mor}_B(Z, X)(T)$, then $a$ defines an
$R$-algebra structure on $R'$ and $b$ defines an $R'$-algebra map
$$
b^\sharp :
R' \otimes_R \Gamma(X, \mathcal{O}_X)
\longrightarrow
R' \otimes_R \Gamma(Z, \mathcal{O}_Z).
$$
In particular we can write
$b^\sharp(1 \otimes \overline{x}_i) = \sum \alpha_{ij} \otimes e_j$
for some $\alpha_{ij} \in R'$. This corresponds to an $R$-algebra map
$P \to R'$ determined by the rule $a_{ij} \mapsto \alpha_{ij}$. This
map factors through the quotient $P/J$ by the construction of the ideal
$J$ to give a map $P/J \to R'$. This in turn corresponds to a morphism
$T \to W$ such that $(a, b)$ is the pullback of $(a_{univ}, b_{univ})$.
Some details omitted.
\end{proof}

\begin{proposition}
\label{proposition-hom-functor-algebraic-space}
Let $S$ be a scheme. Let $Z \to B$ and $X \to B$ be morphisms of
algebraic spaces over $S$. If $Z \to B$ is finite locally free
then $\mathit{Mor}_B(Z, X)$ is an algebraic space.
\end{proposition}

\begin{proof}
Choose a scheme $B' = \coprod B'_i$ which is a disjoint union of
affine schemes $B'_i$ and an \'etale surjective morphism $B' \to B$. 
We may also assume that $B'_i \times_B Z$ is the spectrum of a ring
which is finite free as a $\Gamma(B'_i, \mathcal{O}_{B'_i})$-module.
By
Lemma \ref{lemma-base-change-hom-functor}
and
Algebraic Spaces, Lemma
\ref{spaces-lemma-base-change-representable-transformations-property}
the morphism $\mathit{Mor}_{B'}(Z', X') \to \mathit{Mor}_B(Z, X)$
is surjective \'etale. Hence by
Bootstrap, Theorem \ref{bootstrap-theorem-final-bootstrap}
it suffices to prove the proposition when $B = B'$ is a disjoint union of
affine schemes $B'_i$ so that each $B'_i \times_B Z$ is finite free
over $B'_i$. Then it actually suffices to prove the result for the restriction
to each $B'_i$. Thus we may assume that $B$ is affine and that
$\Gamma(Z, \mathcal{O}_Z)$ is a finite free $\Gamma(B, \mathcal{O}_B)$-module.

\medskip\noindent
Choose a scheme $X'$ which is a disjoint union of affine schemes and
a surjective \'etale morphism $X' \to X$. By
Lemma \ref{lemma-etale-covering-hom-functor}
the morphism $\mathit{Mor}_B(Z, X') \to \mathit{Mor}_B(Z, X)$
is representable by algebraic spaces, \'etale, and surjective.
Hence by
Bootstrap, Theorem \ref{bootstrap-theorem-final-bootstrap}
it suffices to prove the proposition when $X$ is a disjoint union
of affine schemes. This reduces us to the case discussed in the next
paragraph.

\medskip\noindent
Assume $X = \coprod_{i \in I} X_i$ is a disjoint union of affine
schemes, $B$ is affine, and that $\Gamma(Z, \mathcal{O}_Z)$ is a finite
free $\Gamma(B, \mathcal{O}_B)$-module. For any finite subset
$E \subset I$ set
$$
F_E = \mathit{Mor}_B(Z, \coprod\nolimits_{i \in E} X_i).
$$
By
Lemma \ref{lemma-hom-from-finite-free-into-affine}
we see that $F_E$ is an algebraic space. Consider the morphism
$$
\coprod\nolimits_{E \subset I\text{ finite}} F_E
\longrightarrow
\mathit{Mor}_B(Z, X)
$$
Each of the morphisms
$F_E \to \mathit{Mor}_B(Z, X)$ is an open immersion, because it is
simply the locus parametrizing pairs $(a, b)$ where $b$ maps into
the open subscheme $\coprod\nolimits_{i \in E} X_i$ of $X$. Moreover,
if $T$ is quasi-compact, then for any pair $(a, b)$ the image
of $b$ is contained in $\coprod\nolimits_{i \in E} X_i$ for some
$E \subset I$ finite. Hence the displayed arrow is in fact an
open covering and we win\footnote{Modulo
some set theoretic arguments. Namely, we have to show that
$\coprod F_E$ is an algebraic space. This follows because
$|I| \leq \text{size}(X)$ and $\text{size}(F_E) \leq \text{size}(X)$
as follows from the explicit description of $F_E$ in the proof of
Lemma \ref{lemma-hom-from-finite-free-into-affine}.
Some details omitted.} by
Algebraic Spaces, Lemma \ref{spaces-lemma-glueing-algebraic-spaces}.
\end{proof}










\section{Restriction of scalars}
\label{section-restriction-of-scalars}

\noindent
Suppose $X \to Z \to B$ are morphisms of algebraic spaces over $S$.
Given a scheme $T$ we can consider pairs $(a, b)$ where $a : T \to B$
is a morphism and $b : T \times_{a, B} Z \to X$ is a morphism over $Z$.
Picture
\begin{equation}
\label{equation-pairs}
\vcenter{
\xymatrix{
& X \ar[d] \\
T \times_{a, B} Z \ar[d] \ar[ru]^b \ar[r] & Z \ar[d] \\
T \ar[r]^a & B
}
}
\end{equation}
In this situation we can define a
functor
\begin{equation}
\label{equation-restriction-of-scalars}
\text{Res}_{Z/B}(X) : (\text{Sch}/S)^{opp} \longrightarrow \textit{Sets},
\quad
T \longmapsto \{(a, b)\text{ as above}\}
\end{equation}
Sometimes we think of this as a functor defined on the category
of schemes over $B$, in which case we drop $a$ from the notation.

\begin{lemma}
\label{lemma-restriction-of-scalars-sheaf}
Let $S$ be a scheme. Let $X \to Z \to B$ be morphisms of
algebraic spaces over $S$. Then
\begin{enumerate}
\item $\text{Res}_{Z/B}(X)$ is a sheaf on
$(\text{Sch}/S)_{fppf}$.
\item If $T$ is an algebraic space over $S$, then there is a
canonical bijection
$$
\text{Mor}_{\textit{Sh}((\textit{Sch}/S)_{fppf})}(T, \text{Res}_{Z/B}(X))
=
\{(a, b)\text{ as in }(\ref{equation-pairs})\}
$$
\end{enumerate}
\end{lemma}

\begin{proof}
Let $T$ be an algebraic space over $S$. Let $\{T_i \to T\}$ be an fppf
covering of $T$ (as in
Topologies on Spaces, Section \ref{spaces-topologies-section-fppf}).
Suppose that $(a_i, b_i) \in \text{Res}_{Z/B}(X)(T_i)$ such
that $(a_i, b_i)|_{T_i \times_T T_j} = (a_j, b_j)|_{T_i \times_T T_j}$
for all $i, j$. Then by
Descent on Spaces,
Lemma \ref{spaces-descent-lemma-fppf-universal-effective-epimorphisms}
there exists a unique morphism $a : T \to B$ such that $a_i$ is the
composition of $T_i \to T$ and $a$. Then
$\{T_i \times_{a_i, B} Z \to T \times_{a, B} Z\}$ is an fppf covering
too and the same lemma implies there exists a unique morphism
$b : T \times_{a, B} Z \to X$ such that $b_i$ is the composition
of $T_i \times_{a_i, B} Z \to T \times_{a, B} Z$ and $b$. Hence
$(a, b) \in \text{Res}_{Z/B}(X)(T)$ restricts to $(a_i, b_i)$ 
over $T_i$ for all $i$.

\medskip\noindent
Note that the result of the preceding paragraph in particular implies (1).

\medskip\noindent
Let $T$ be an algebraic space over $S$. In order to prove (2) we will
construct mutually inverse maps between the displayed sets. In the
following when we say ``pair'' we mean a pair $(a, b)$ fitting
into (\ref{equation-pairs}).

\medskip\noindent
Let $v : T \to \text{Res}_{Z/B}(X)$ be a natural transformation.
Choose a scheme $U$ and a surjective \'etale morphism $p : U \to T$.
Then $v(p) \in \text{Res}_{Z/B}(X)(U)$ corresponds to a pair $(a_U, b_U)$
over $U$. Let $R = U \times_T U$ with projections $t, s : R \to U$.
As $v$ is a transformation of functors we see that the pullbacks of
$(a_U, b_U)$ by $s$ and $t$ agree. Hence, since $\{U \to T\}$ is an
fppf covering, we may apply the result of the first paragraph that
deduce that there exists a unique pair $(a, b)$ over $T$.

\medskip\noindent
Conversely, let $(a, b)$ be a pair over $T$. 
Let $U \to T$, $R = U \times_T U$, and $t, s : R \to U$ be as
above. Then the restriction $(a, b)|_U$ gives rise to a
tranformation of functors $v : h_U \to \text{Res}_{Z/B}(X)$ by the
Yoneda lemma
(Categories, Lemma \ref{categories-lemma-yoneda}).
As the two pullbacks $s^*(a, b)|_U$ and $t^*(a, b)|_U$
are equal, we see that $v$ coequalizes the two maps
$h_t, h_s : h_R \to h_U$. Since $T = U/R$ is the fppf quotient sheaf by
Spaces, Lemma \ref{spaces-lemma-space-presentation}
and since $\text{Res}_{Z/B}(X)$ is an fppf sheaf by (1) we conclude
that $v$ factors through a map $T \to \text{Res}_{Z/B}(X)$.

\medskip\noindent
We omit the verification that the two constructions above are mutually
inverse.
\end{proof}

\noindent
Of course the sheaf $\text{Res}_{Z/B}(X)$ comes with a natural transformation
of functors $\text{Res}_{Z/B}(X) \to B$. We will use this without further
mention in the following.

\begin{lemma}
\label{lemma-etale-base-change-restriction-of-scalars}
Let $S$ be a scheme. Let $X \to Z \to B$ and $B' \to B$
be morphisms of algebraic spaces over $S$.
Set $Z' = B' \times_B Z$ and $X' = B' \times_B X$. Then
$$
\text{Res}_{Z'/B'}(X')
=
B' \times_B \text{Res}_{Z/B}(X)
$$
in $\textit{Sh}((\textit{Sch}/S)_{fppf})$.
\end{lemma}

\begin{proof}
The equality as functors follows immediately from the definitions.
The equality as sheaves follows from this because both sides are
sheaves according to
Lemma \ref{lemma-restriction-of-scalars-sheaf}
and the fact that a fibre product of sheaves is the same as the
corresponding fibre product of pre-sheaves (i.e., functors).
\end{proof}

\begin{lemma}
\label{lemma-etale-covering-restriction-of-scalars}
Let $S$ be a scheme. Let $X' \to X \to Z \to B$ be morphisms of
algebraic spaces over $S$. Assume
\begin{enumerate}
\item $X' \to X$ is \'etale, and
\item $Z \to B$ is finite locally free.
\end{enumerate}
Then $\text{Res}_{Z/B}(X') \to \text{Res}_{Z/B}(X)$ is representable
by algebraic spaces and \'etale. If $X' \to X$ is also surjective,
then $\text{Res}_{Z/B}(X') \to \text{Res}_{Z/B}(X)$ is surjective.
\end{lemma}

\begin{proof}
Let $U$ be a scheme and let $\xi = (a, b)$ be an element of
$\text{Res}_{Z/B}(X)(U)$. We have to prove that the functor
$$
h_U \times_{\xi, \text{Res}_{Z/B}(X)} \text{Res}_{Z/B}(X')
$$
is representable by an algebaic space \'etale over $U$. Set
$Z_U = U \times_{a, B} Z$ and $W = Z_U \times_{b, X} X'$.
Then $W \to Z_U \to U$ is as in
Lemma \ref{lemma-space-of-sections}
and the sheaf $F$ defined there is identified with the fibre product
displayed above. Hence the first assertion of the lemma.
The second assertion follows from this and
Lemma \ref{lemma-surjection-space-of-sections}
which guarantees that $F \to U$ is surjective in the situation above.
\end{proof}

\noindent
At this point we can use the lemmas above to prove that $\text{Res}_{Z/B}(X)$
is an algebraic space whenever $Z \to B$ is finite locally free in almost
exactly the same way as in the proof that $\mathit{Mor}_B(Z, X)$ is an
algebraic spaces, see
Proposition \ref{proposition-hom-functor-algebraic-space}.
Instead we will directly deduce this result from the following lemma
and the fact that $\mathit{Mor}_B(Z, X)$ is an algebraic space.

\begin{lemma}
\label{lemma-fibre-diagram}
Let $S$ be a scheme. Let $X \to Z \to B$ be morphisms of
algebraic spaces over $S$. The following diagram
$$
\xymatrix{
\mathit{Mor}_B(Z, X) \ar[r] & \mathit{Mor}_B(Z, Z) \\
\text{Res}_{Z/B}(X) \ar[r] \ar[u] & B \ar[u]_{\text{id}_Z}
}
$$
is a cartesian diagram of sheaves on $(\textit{Sch}/S)_{fppf}$.
\end{lemma}

\begin{proof}
Omitted. Hint: Exercise in the functorial point of view in algebraic
geometry.
\end{proof}

\begin{proposition}
\label{proposition-restriction-of-scalars-algebraic-space}
Let $S$ be a scheme. Let $X \to Z \to B$ be morphisms of
algebraic spaces over $S$. If $Z \to B$ is finite locally free
then $\text{Res}_{Z/B}(X)$ is an algebraic space.
\end{proposition}

\begin{proof}
By
Proposition \ref{proposition-hom-functor-algebraic-space}
the functors $\mathit{Mor}_B(Z, X)$ and $\mathit{Mor}_B(Z, Z)$
are algebraic spaces. Hence this follows from the cartesian
diagram of
Lemma \ref{lemma-fibre-diagram}
and the fact that fibre products of algebraic spaces exist and
are given by the fibre product in the underlying category of
sheaves of sets (see
Algebraic Spaces, Lemma
\ref{spaces-lemma-fibre-product-spaces-over-sheaf-with-representable-diagonal}).
\end{proof}






\section{Finite Hilbert stacks}
\label{section-finite-hilbert-stacks}

\noindent
In this section we prove some results concerning the finite
Hilbert stacks $\mathcal{H}_d(\mathcal{X}/\mathcal{Y})$
introduced in
Examples of Stacks, Section \ref{examples-stacks-section-hilbert-d-stack}.

\begin{lemma}
\label{lemma-map-hilbert}
Consider a $2$-commutative diagram
$$
\xymatrix{
\mathcal{X}' \ar[r]_G \ar[d]_{F'} & \mathcal{X} \ar[d]^F \\
\mathcal{Y}' \ar[r]^H & \mathcal{Y}
}
$$
of stacks in groupoids over $(\textit{Sch}/S)_{fppf}$ with a given
$2$-isomorphism $\gamma : H \circ F' \to F \circ G$. In this situation we
obtain a canonical $1$-morphism
$\mathcal{H}_d(\mathcal{X}'/\mathcal{Y}') \to
\mathcal{H}_d(\mathcal{X}/\mathcal{Y})$.
This morphism is compatible with the forgetful $1$-morphisms of
Examples of Stacks,
Equation (\ref{examples-stacks-equation-diagram-hilbert-d-stack}).
\end{lemma}

\begin{proof}
We map the object $(U, Z, y', x', \alpha')$ to the object
$(U, Z, H(y'), G(x'), \gamma \star \text{id}_H \star \alpha')$
where $\star$ denotes horizontal composition of $2$-morphisms, see
Categories, Definition \ref{categories-definition-horizontal-composition}.
To a morphism
$(f, g, b, a) :
(U_1, Z_1, y_1', x_1', \alpha_1') \to (U_2, Z_2, y_2', x_2', \alpha_2')$
we assign
$(f, g, H(b), G(a))$.
We omit the verification that this defines a functor between categories over
$(\textit{Sch}/S)_{fppf}$.
\end{proof}

\begin{lemma}
\label{lemma-cartesian-map-hilbert}
In the situation of
Lemma \ref{lemma-map-hilbert}
assume that the given square is $2$-cartesian. Then the diagram
$$
\xymatrix{
\mathcal{H}_d(\mathcal{X}'/\mathcal{Y}') \ar[r] \ar[d] &
\mathcal{H}_d(\mathcal{X}/\mathcal{Y}) \ar[d] \\
\mathcal{Y}' \ar[r] &
\mathcal{Y}
}
$$
is $2$-cartesian.
\end{lemma}

\begin{proof}
We get a $2$-commutative diagram by
Lemma \ref{lemma-map-hilbert}
and hence we get a $1$-morphism (i.e., a functor)
$$
\mathcal{H}_d(\mathcal{X}'/\mathcal{Y}')
\longrightarrow
\mathcal{Y}' \times_{\mathcal{Y}} \mathcal{H}_d(\mathcal{X}/\mathcal{Y})
$$
We indicate why this functor is essentially surjective. Namely, an object
of the category on the right hand side is given by a scheme $U$ over $S$,
an object $y'$ of $\mathcal{Y}'_U$, an object $(U, Z, y, x, \alpha)$
of $\mathcal{H}_d(\mathcal{X}/\mathcal{Y})$ over $U$ and an isomorphism
$H(y') \to y$ in $\mathcal{Y}_U$. The assumption means exactly that
there exists an object $x'$ of $\mathcal{X}'_Z$ such that there exist
isomorphisms $G(x') \cong x$ and $\alpha' : y'|_Z \to F'(x')$ compatible
with $\alpha$. Then we see that $(U, Z, y', x', \alpha')$ is an
object of $\mathcal{H}_d(\mathcal{X}'/\mathcal{Y}')$ over $U$.
Details omitted.
\end{proof}

\begin{lemma}
\label{lemma-etale-covering-hilbert}
In the situation of
Lemma \ref{lemma-map-hilbert}
assume
\begin{enumerate}
\item $\mathcal{Y}' = \mathcal{Y}$ and $H = \text{id}_{\mathcal{Y}}$,
\item $G$ is representable by algebraic spaces and \'etale.
\end{enumerate}
Then $\mathcal{H}_d(\mathcal{X}'/\mathcal{Y}) \to
\mathcal{H}_d(\mathcal{X}/\mathcal{Y})$ is representable by
algebraic spaces and \'etale.
If $G$ is also surjective, then
$\mathcal{H}_d(\mathcal{X}'/\mathcal{Y}) \to
\mathcal{H}_d(\mathcal{X}/\mathcal{Y})$ is surjective.
\end{lemma}

\begin{proof}
Let $U$ be a scheme and let $\xi = (U, Z, y, x, \alpha)$ be an object of
$\mathcal{H}_d(\mathcal{X}/\mathcal{Y})$ over $U$.
We have to prove that the $2$-fibre product
\begin{equation}
\label{equation-to-show}
(\textit{Sch}/U)_{fppf}
\times_{\xi, \mathcal{H}_d(\mathcal{X}/\mathcal{Y})}
\mathcal{H}_d(\mathcal{X}'/\mathcal{Y})
\end{equation}
is representable by an algebraic space \'etale over $U$.
An object of this over $U'$ corresponds to an object
$x'$ in the fibre category of $\mathcal{X}'$ over $Z_{U'}$
such that $G(x') \cong x|_{Z_{U'}}$. 
By assumption the $2$-fibre product
$$
(\textit{Sch}/Z)_{fppf} \times_{x, \mathcal{X}} \mathcal{X}'
$$
is representable by an algebraic space $W$ such that the projection
$W \to Z$ is \'etale. Then (\ref{equation-to-show})
is representable by the algebraic space $F$ parametrizing sections of
$W \to Z$ over $U$ introduced in
Lemma \ref{lemma-space-of-sections}.
Since $F \to U$ is \'etale we conclude that
$\mathcal{H}_d(\mathcal{X}'/\mathcal{Y}) \to
\mathcal{H}_d(\mathcal{X}/\mathcal{Y})$ is representable by
algebraic spaces and \'etale.
Finally, if $\mathcal{X}' \to \mathcal{X}$ is surjective also,
then $W \to Z$ is surjective, and hence $F \to U$ is surjective by
Lemma \ref{lemma-surjection-space-of-sections}.
Thus in this case
$\mathcal{H}_d(\mathcal{X}'/\mathcal{Y}) \to
\mathcal{H}_d(\mathcal{X}/\mathcal{Y})$ is also surjective.
\end{proof}

\begin{lemma}
\label{lemma-etale-map-hilbert}
In the situation of
Lemma \ref{lemma-map-hilbert}.
Assume that $G$, $H$ are representable by algebraic spaces and \'etale.
Then $\mathcal{H}_d(\mathcal{X}'/\mathcal{Y}') \to
\mathcal{H}_d(\mathcal{X}/\mathcal{Y})$ is representable by
algebraic spaces and \'etale.
If also $H$ is surjective and the induced functor
$\mathcal{X}' \to \mathcal{Y}' \times_{\mathcal{Y}} \mathcal{X}$
is surjective, then
$\mathcal{H}_d(\mathcal{X}'/\mathcal{Y}') \to
\mathcal{H}_d(\mathcal{X}/\mathcal{Y})$ is surjective.
\end{lemma}

\begin{proof}
Set $\mathcal{X}'' = \mathcal{Y}' \times_{\mathcal{Y}} \mathcal{X}$. By
Lemma \ref{lemma-etale-permanence}
the $1$-morphism $\mathcal{X}' \to \mathcal{X}''$ is representable by
algebraic spaces and \'etale (in particular the condition in the second
statement of the lemma that $\mathcal{X}' \to \mathcal{X}''$ be surjective
makes sense). We obtain a $2$-commutative diagram
$$
\xymatrix{
\mathcal{X}' \ar[r] \ar[d] &
\mathcal{X}'' \ar[r] \ar[d] &
\mathcal{X} \ar[d] \\
\mathcal{Y}' \ar[r] &
\mathcal{Y}' \ar[r] &
\mathcal{Y}
}
$$
It follows from
Lemma \ref{lemma-cartesian-map-hilbert}
that $\mathcal{H}_d(\mathcal{X}''/\mathcal{Y}')$ is the base change
of $\mathcal{H}_d(\mathcal{X}/\mathcal{Y})$ by $\mathcal{Y}' \to \mathcal{Y}$.
In particular we see that
$\mathcal{H}_d(\mathcal{X}''/\mathcal{Y}') \to
\mathcal{H}_d(\mathcal{X}/\mathcal{Y})$ is
representable by algebraic spaces and \'etale, see
Algebraic Stacks, Lemma
\ref{algebraic-lemma-base-change-representable-transformations-property}.
Moreover, it is also surjective if $H$ is.
 Hence if we can show that
the result holds for the left square in the diagram, then we're done.
In this way we reduce to the case where $\mathcal{Y}' = \mathcal{Y}$
which is the content of
Lemma \ref{lemma-etale-covering-hilbert}.
\end{proof}

\begin{lemma}
\label{lemma-relative-hilbert}
Let $F : \mathcal{X} \to \mathcal{Y}$ be a $1$-morphism of stacks in groupoids
over $(\textit{Sch}/S)_{fppf}$. Assume that
$\Delta : \mathcal{Y} \to \mathcal{Y} \times \mathcal{Y}$
is representable by algebraic spaces. Then
$$
\mathcal{H}_d(\mathcal{X}/\mathcal{Y})
\longrightarrow
\mathcal{H}_d(\mathcal{X}) \times \mathcal{Y}
$$
see
Examples of Stacks, Equation
(\ref{examples-stacks-equation-diagram-hilbert-d-stack})
is representably by algebraic spaces.
\end{lemma}

\begin{proof}
Let $U$ be a scheme and let $\xi = (U, Z, p, x, 1)$ be an object of
$\mathcal{H}_d(\mathcal{X}) = \mathcal{H}_d(\mathcal{X}/S)$ over $U$.
Here $p$ is just the structure morphism of $U$.
The fifth component $1$ exists and is unique
since everything is over $S$.
Also, let $y$ be an object of $\mathcal{Y}$ over $U$.
We have to show the $2$-fibre product
\begin{equation}
\label{equation-res-isom}
(\textit{Sch}/U)_{fppf}
\times_{\xi \times y, \mathcal{H}_d(\mathcal{X}) \times \mathcal{Y}}
\mathcal{H}_d(\mathcal{X}/\mathcal{Y})
\end{equation}
is representable by an algebraic space. To explain why this is so
we introduce
$$
I = \mathit{Isom}_{\mathcal{Y}}(y|_Z, F(x))
$$
which is an algebraic space over $Z$ by assumption. Let $a : U' \to U$
be a scheme over $U$. What does it mean to give an object of the fibre
category of (\ref{equation-res-isom}) over $U'$? Well, it means that we
have an object $\xi' = (U', Z', y', x', \alpha')$ of
$\mathcal{H}_d(\mathcal{X}/\mathcal{Y})$ over $U'$ and isomorphisms
$(U', Z', p', x', 1) \cong (U, Z, p, x, 1)|_{U'}$ and
$y' \cong y|_{U'}$. Thus $\xi'$ is isomorphic to
$(U', U' \times_{a, U} Z, a^*y, x|_{U' \times_{a, U} Z}, \alpha)$
for some morphism
$$
\alpha :
a^*y|_{U' \times_{a, U} Z}
\longrightarrow
F(x|_{U' \times_{a, U} Z})
$$
in the fibre category of $\mathcal{Y}$ over $U' \times_{a, U} Z$. Hence
we can view $\alpha$ as a morphism $b : U' \times_{a, U} Z \to I$.
In this way we see that (\ref{equation-res-isom})
is representable by $\text{Res}_{Z/U}(I)$ which is an algebraic space by
Proposition \ref{proposition-restriction-of-scalars-algebraic-space}.
\end{proof}

\noindent
The following lemma is a (partial) generalization of
Lemma \ref{lemma-etale-covering-hilbert}.

\begin{lemma}
\label{lemma-representable-on-top}
Let $F : \mathcal{X} \to \mathcal{Y}$ and $G : \mathcal{X}' \to \mathcal{X}$
be $1$-morphisms of stacks in groupoids over $(\textit{Sch}/S)_{fppf}$.
If $G$ is representable by algebraic spaces, then the $1$-morphism
$$
\mathcal{H}_d(\mathcal{X}'/\mathcal{Y})
\longrightarrow
\mathcal{H}_d(\mathcal{X}/\mathcal{Y})
$$
is representable by algebraic spaces.
\end{lemma}

\begin{proof}
Let $U$ be a scheme and let $\xi = (U, Z, y, x, \alpha)$ be an object of
$\mathcal{H}_d(\mathcal{X}/\mathcal{Y})$ over $U$.
We have to prove that the $2$-fibre product
\begin{equation}
\label{equation-to-show-again}
(\textit{Sch}/U)_{fppf}
\times_{\xi, \mathcal{H}_d(\mathcal{X}/\mathcal{Y})}
\mathcal{H}_d(\mathcal{X}'/\mathcal{Y})
\end{equation}
is representable by an algebraic space \'etale over $U$.
An object of this over $a : U' \to U$ corresponds to an object
$x'$ of $\mathcal{X}'$ over $U' \times_{a, U} Z$ such that
$G(x') \cong x|_{U' \times_{a, U} Z}$. By assumption the $2$-fibre product
$$
(\textit{Sch}/Z)_{fppf} \times_{x, \mathcal{X}} \mathcal{X}'
$$
is representable by an algebraic space $X$ over $Z$. It follows that
(\ref{equation-to-show-again}) is representable by $\text{Res}_{Z/U}(X)$,
which is an algebraic space by
Proposition \ref{proposition-restriction-of-scalars-algebraic-space}.
\end{proof}

\begin{lemma}
\label{lemma-limit-preserving}
Let $F : \mathcal{X} \to \mathcal{Y}$ be a $1$-morphism of stacks in groupoids
over $(\textit{Sch}/S)_{fppf}$. Assume $F$ is representable by algebraic
spaces and locally of finite presentation. Then
$$
p : \mathcal{H}_d(\mathcal{X}/\mathcal{Y}) \to \mathcal{Y}
$$
is limit preserving in the following sense: Given
\begin{enumerate}
\item an affine scheme $U = \text{lim}_i\ U_i$ which is written as the
directed limit of affine schemes $U_i$ over $S$,
\item an object $y_i$ of $\mathcal{Y}$ over $U_i$ for some $i$, and
\item an object $\Xi$ of $\mathcal{H}_d(\mathcal{X}/\mathcal{Y})$
over $U$ such that $p(\Xi) = y_i|_U$,
\end{enumerate}
then there exists an $i' \geq i$ and an object $\Xi_{i'}$ of
$\mathcal{H}_d(\mathcal{X}/\mathcal{Y})$ over $U_{i'}$ with
$\Xi_{i'}|_U = \Xi$ and $p(\Xi_{i'}) = y_i|_{U_{i'}}$.
\end{lemma}

\begin{proof}
Let $X_{y_i} \to U_i$ be an algebraic space representing the $2$-fibre product
$$
(\textit{Sch}/U_i)_{fppf} \times_{y_i, \mathcal{Y}, F} \mathcal{X}.
$$
Note that $X_{y_i} \to U_i$ is locally of finite presentation by our
assumption on $F$. Write $\Xi = (U, Z, y, x, \alpha)$. It is clear that
$\xi = (Z, Z \to U_i, x, \alpha)$ is an object of the $2$-fibre product
displayed above, hence $\xi$ gives rise to a morphism
$f_\xi : Z \to X_{y_i}$ of algebraic spaces over $U_i$
(since $X_{y_i}$ is the functor of isomorphisms classes of objects of
$(\textit{Sch}/U_i)_{fppf} \times_{y, \mathcal{Y}, F} \mathcal{X}$, see
Algebraic Stacks,
Lemma \ref{algebraic-lemma-characterize-representable-by-space}).
By
Limits, Lemmas \ref{limits-lemma-descend-finite-presentation} and
\ref{limits-lemma-descend-finite-locally-free}
there exists an $i' \geq i$ and a finite locally free morphism
$Z_{i'} \to U_{i'}$ of degree $d$ whose base change to $U$ is $Z$. By
More on Morphisms of Spaces, Proposition
\ref{spaces-more-morphisms-proposition-characterize-locally-finite-presentation}
we may, after replacing $i'$ by a bigger index, assume there exists a
morphism $f_{i'} : Z_{i'} \to X_{y_i}$ such that
$$
\xymatrix{
Z \ar[d] \ar[r] \ar@/^3ex/[rr]^{f_\xi} &
Z_{i'} \ar[d] \ar[r]_{f_{i'}} & X_{y_i} \ar[d] \\
U \ar[r] & U_{i'} \ar[r] & U_i
}
$$
is commutative. Set $\Xi_{i'} = (U_{i'}, Z_{i'}, y_{i'}, x_{i'}, \alpha_{i'})$
where
\begin{enumerate}
\item $y_{i'}$ is the object of $\mathcal{Y}$ over $U_{i'}$
which is the pullback of $y_i$ to $U_{i'}$,
\item $x_{i'}$ is the object of $\mathcal{X}$ over $Z_{i'}$ corresponding
via the $2$-Yoneda lemma to the $1$-morphism
$$
(\textit{Sch}/Z_{i'})_{fppf} \to
\mathcal{S}_{X_{y_i}} \to
(\textit{Sch}/U_i)_{fppf} \times_{y_i, \mathcal{Y}, F} \mathcal{X} \to
\mathcal{X}
$$
where the middle arrow is the equivalence which defines $X_{y_i}$
(notation as in
Algebraic Stacks, Sections
\ref{algebraic-section-representable-by-algebraic-spaces} and
\ref{algebraic-section-split}).
\item $\alpha_{i'} : y_{i'}|_{Z_{i'}} \to F(x_{i'})$ is the isomorphism
coming from the $2$-commutativity of the diagram
$$
\xymatrix{
(\textit{Sch}/Z_{i'})_{fppf} \ar[r] \ar[rd] &
(\textit{Sch}/U_i)_{fppf} \times_{y_i, \mathcal{Y}, F} \mathcal{X}
\ar[r] \ar[d] &
\mathcal{X} \ar[d]^F \\
& (\textit{Sch}/U_{i'})_{fppf} \ar[r] & \mathcal{Y}
}
$$
\end{enumerate}
Recall that $f_\xi : Z \to X_{y_i}$ was the morphism corresponding to
the object $\xi = (Z, Z \to U_i, x, \alpha)$ of
$(\textit{Sch}/U_i)_{fppf} \times_{y_i, \mathcal{Y}, F} \mathcal{X}$
over $Z$. By construction $f_{i'}$ is the morphism corresponding to
the object $\xi_{i'} = (Z_{i'}, Z_{i'} \to U_i, x_{i'}, \alpha_{i'})$.
As $f_\xi = f_{i'} \circ (Z \to Z_{i'})$ we see that
the object $\xi_{i'} = (Z_{i'}, Z_{i'} \to U_i, x_{i'}, \alpha_{i'})$ pulls
back to $\xi$ over $Z$. Thus $x_{i'}$ pulls back to $x$ and $\alpha_{i'}$
pulls back to $\alpha$. This means that $\Xi_{i'}$ pulls back
to $\Xi$ over $U$ and we win.
\end{proof}










\section{The finite Hilbert stack of a point}
\label{section-hilbert-point}

\noindent
Let $d \geq 1$ be an integer. In
Examples of Stacks, Definition \ref{examples-stacks-definition-hilbert-d-stack}
we defined a stack in groupoids $\mathcal{H}_d$.
In this section we prove that $\mathcal{H}_d$ is an
algebraic stack. We will throughout assume that
$S = \text{Spec}(\mathbf{Z})$.
The general case will follow from this by base change.
Recall that the fibre category of $\mathcal{H}_d$ over a scheme $T$
is the category of finite locally free morphisms $\pi : Z \to T$ of
degree $d$. Instead of classifying these directly we first
study the quasi-coherent sheaves of algebras $\pi_*\mathcal{O}_Z$.

\medskip\noindent
Let $R$ be a ring. Let us temporarily make the following definition:
A {\it free $d$-dimensional algebra over $R$}
is given by a commutative $R$-algebra structure $m$ on $R^{\oplus d}$
such that $e_1 = (1, 0, \ldots, 0)$ is a unit\footnote{It may be better
to think of this as a pair consisting of a multiplication map
$m : R^{\oplus d} \otimes_R R^{\oplus d} \to R^{\oplus d}$ and
a ring map $\psi : R \to R^{\oplus d}$ satisfying a bunch of axioms.}.
We think of $m$ as an $R$-linear map
$$
m : R^{\oplus d} \otimes_R R^{\oplus d} \longrightarrow R^{\oplus d}
$$
such that $m(e_1, x) = m(x, e_1) = x$ and such that $m$ defines a
commutative and associative ring structure. If we write
$m(e_i, e_j) = \sum a_{ij}^ke_k$ then we see this boils down
to the conditions
$$
\left\{
\begin{matrix}
\sum_l a_{ij}^la_{lk}^m = \sum_l a_{il}^ma_{jk}^l & \forall i, j, k, m \\
a_{ij}^k = a_{ji}^k & \forall i,j,k \\
a_{i1}^j = \delta_{ij} & \forall i, j
\end{matrix}
\right.
$$
where $\delta_{ij}$ is the Kronecker $\delta$-function. OK, so let's define
$$
R_{univ} = \mathbf{Z}[a_{ij}^k]/J
$$
where the ideal $J$ is the ideal generated by the relations displayed above.
Denote
$$
m_{univ} :
R_{univ}^{\oplus d} \otimes_{R_{univ}} R_{univ}^{\oplus d}
\longrightarrow
R_{univ}^{\oplus d}
$$
the free $d$-dimensional algebra $m$ over $R_{univ}$ whose structure
constants are the classes of $a_{ij}^k$ modulo $J$.
Then it is clear that given any free $d$-dimensional algebra $m$ over a ring
$R$ there exists a unique $\mathbf{Z}$-algebra homomorphism
$\psi : R_{univ} \to R$ such that $\psi_*m_{univ} = m$ (this means that
$m$ is what you get by applying the base change functor
$- \otimes_{R_{univ}} R$ to $m_{univ}$). In other words, setting
$X = \text{Spec}(R_{univ})$ we obtain a canonical identification
$$
X(T) = \{\text{free }d\text{-dimensional algebras }m\text{ over }R\}
$$
for varying $T = \text{Spec}(R)$. By Zariski localization we obtain
the following seemingly more general identification
\begin{equation}
\label{equation-objects}
X(T) = \{\text{free }d\text{-dimensional algebras }
m\text{ over }\Gamma(T, \mathcal{O}_T)\}
\end{equation}
for any scheme $T$.

\medskip\noindent
Next we talk a little bit about {\it isomorphisms of free $d$-dimensional
$R$-algebras}. Namely, suppose that $m$, $m'$ are two free $d$-dimensional
algebras over a ring $R$. An {\it isomorphism from $m$ to $m'$} is given by
an invertible $R$-linear map
$$
\varphi : R^{\oplus d} \longrightarrow R^{\oplus d}
$$
such that $\varphi(e_1) = e_1$ and such that
$$
m \circ \varphi \otimes \varphi = \varphi \circ m'.
$$
Note that we can compose these so that the collection of
free $d$-dimensional algebras over $R$ becomes a category.
In this way we optain a functor
\begin{equation}
\label{equation-FAd}
FA_d : \textit{Sch}_{fppf}^{opp} \longrightarrow \textit{Groupoids}
\end{equation}
from the category of schemes to groupoids: to a scheme $T$ we associate the
set of free $d$-dimensional algebras over $\Gamma(T, \mathcal{O}_T)$
endowed with the structure
of a category using the notion of isomorphisms just defined.

\medskip\noindent
The above suggests we consider the functor $G$ in groups
which associates to any scheme $T$ the group
$$
G(T) = \{g \in \text{GL}_d(\Gamma(T, \mathcal{O}_T)) \mid g(e_1) = e_1\}
$$
It is clear that $G \subset \text{GL}_d$ (see
Groupoids, Example \ref{groupoids-example-general-linear-group})
is the closed subgroup scheme cut out by the equations
$x_{11} = 1$ and $x_{i1} = 0$ for $i > 1$. Hence $G$ is a smooth
affine group scheme over $\text{Spec}(\mathbf{Z})$. Consider the
action
$$
a : G \times_{\text{Spec}(\mathbf{Z})} X \longrightarrow X
$$
which associates to a $T$-valued point $(g, m)$ with $T = \text{Spec}(R)$
on the left hand side the free $d$-dimensional algebra over $R$
given by
$$
a(g, m) = g^{-1} \circ m \circ g \otimes g.
$$
Note that this means that $g$ defines an isomorphism $m \to a(g, m)$
of $d$-dimensional free $R$-algebras. We omit the verification that
$a$ indeed defines an action of the group scheme $G$ on the scheme $X$.

\begin{lemma}
\label{lemma-represent-FAd}
The functor in groupoids $FA_d$ defined in (\ref{equation-FAd})
is isomorphic (!) to the functor in groupouids which associates
to a scheme $T$ the category with
\begin{enumerate}
\item set of objects is $X(T)$,
\item set of morphhisms is $G(T) \times X(T)$,
\item $s : G(T) \times X(T) \to X(T)$ is the projection map,
\item $t : G(T) \times X(T) \to X(T)$ is $a(T)$, and
\item composition $G(T) \times X(T) \times_{s, X(T), t} G(T) \times X(T)
\to G(T) \times X(T)$ is given by $((g, m), (g', m')) \mapsto (gg', m')$.
\end{enumerate}
\end{lemma}

\begin{proof}
We have seen the rule on objects in (\ref{equation-objects}).
We have also seen above that $g \in G(T)$ can be viewed as
a morphism from $m$ to $a(g, m)$ for any free $d$-dimensional algebra $m$.
Conversely, any morphism $m \to m'$ is given by an invertible linear
map $\varphi$ which corresponds to an element $g \in G(T)$ such
that $m' = a(g, m)$.
\end{proof}

\noindent
In fact the groupoid $(X, G \times X, s, t, c)$ described in the
lemma above is the groupoid associated to the action $a : G \times X \to X$
as defined in
Groupoids, Lemma \ref{groupoids-lemma-groupoid-from-action}.
Since $G$ is smooth over $\text{Spec}(\mathbf{Z})$
we see that the two morphisms $s, t : G \times X \to X$ are
smooth: by symmetry it suffices to prove that one of them is, and
$s$ is the base change of $G \to \text{Spec}(\mathbf{Z})$.
Hence $(G \times X, X, s, t, c)$ is a smooth groupoid scheme,
and the quotient stack $[X/G]$ is an algebraic stack by
Algebraic Stacks, 
Theorem \ref{algebraic-theorem-smooth-groupoid-gives-algebraic-stack}.

\begin{proposition}
\label{proposition-finite-hilbert-point}
The stack $\mathcal{H}_d$ is equivalent to the quotient stack
$[X/G]$ described above. In particular $\mathcal{H}_d$ is an
algebraic stack.
\end{proposition}

\begin{proof}
Note that by
Groupoids in Algebraic Spaces,
Definition \ref{spaces-groupoids-definition-quotient-stack}
the quotient stack $[X/G]$ is the stackification of the
category fibred in groupoids associated to the ``presheaf in groupoids''
which associates to a scheme $T$ the groupoid
$$
(X(T), G(T) \times X(T), s, t, c).
$$
Since this ``presheaf in groupoids'' is isomorphic to $FA_d$ by
Lemma \ref{lemma-represent-FAd}
it suffices to prove that the $\mathcal{H}_d$ is the stackification
of (the category fibred in groupoids associated to the
``presheaf in groupoids'') $FA_d$. To do this we first define a
functor
$$
\text{Spec} : FA_d \longrightarrow \mathcal{H}_d
$$
Recall that the fibre category of $\mathcal{H}_d$ over a scheme $T$
is the category of finite locally free morphisms $Z \to T$ of degree $d$.
Thus given a scheme $T$ and a free $d$-dimensional
$\Gamma(T, \mathcal{O}_T)$-algebra $m$ we may assign to this the object
$$
Z = \underline{\text{Spec}}_T(\mathcal{A})
$$
of $\mathcal{H}_{d, T}$
where $\mathcal{A} = \mathcal{O}_T^{\oplus d}$ endowed with a
$\mathcal{O}_T$-algebra structure via $m$. Moreover, if $m'$ is
a second such free $d$-dimensional $\Gamma(T, \mathcal{O}_T)$-algebra
and if $\varphi : m \to m'$ is an isomorphism of these, then
the induced $\mathcal{O}_T$-linear map
$\varphi : \mathcal{O}_T^{\oplus d} \to \mathcal{O}_T^{\oplus d}$
induces an isomorphism
$$
\varphi : \mathcal{A}' \longrightarrow \mathcal{A}
$$
of quasi-coherent $\mathcal{O}_T$-algebras. Hence
$$
\underline{\text{Spec}}_T(\varphi) :
\underline{\text{Spec}}_T(\mathcal{A})
\longrightarrow
\underline{\text{Spec}}_T(\mathcal{A}')
$$
is a morphism in the fibre category $\mathcal{H}_{d, T}$. We omit the
verification that this construction is compatible with base change so
we get indeed a functor $\text{Spec} : FA_d \to \mathcal{H}_d$
as claimed above.

\medskip\noindent
To show that $\text{Spec} : FA_d \to \mathcal{H}_d$ induces an equivalence
between the stackification of $FA_d$ and $\mathcal{H}_d$ it suffices to
check that
\begin{enumerate}
\item $\mathit{Isom}(m, m') = \mathit{Isom}(\text{Spec}(m), \text{Spec}(m'))$
for any $m, m' \in FA_d(T)$.
\item for any scheme $T$ and any object $Z \to T$ of $\mathcal{H}_{d, T}$
there exists a covering $\{T_i \to T\}$ such that $Z|_{T_i}$ is
isomorphic to $\text{Spec}(m)$ for some $m \in FA_d(T_i)$, and
\end{enumerate}
see
Stacks, Lemma \ref{stacks-lemma-stackify-groupoids}.
The first statement follows from the observation that any isomorphism
$$
\underline{\text{Spec}}_T(\mathcal{A})
\longrightarrow
\underline{\text{Spec}}_T(\mathcal{A}')
$$
is necessarily given by a global invertible matrix $g$ when
$\mathcal{A} = \mathcal{A}' = \mathcal{O}_T^{\oplus d}$ as modules.
To prove the second statement let $\pi : Z \to T$ be a finite
locally free morphism of degree $d$. Then $\mathcal{A}$ is a locally
free sheaf $\mathcal{O}_T$-modules of rank $d$.
Consider the element $1 \in \Gamma(T, \mathcal{A})$. This element is
nonzero in $\mathcal{A} \otimes_{\mathcal{O}_{T, t}} \kappa(t)$
for every $t \in T$ since the scheme
$Z_t = \text{Spec}(\mathcal{A} \otimes_{\mathcal{O}_{T, t}} \kappa(t))$
is nonempty being of degree $d > 0$ over $\kappa(t)$. Thus
$1 : \mathcal{O}_T \to \mathcal{A}$ can locally be used as the first
basis element (for example you can use
Algebra, Lemma \ref{algebra-lemma-cokernel-flat} parts (1) and (2)
to see this). Thus, after localizing on
$T$ we may assume that there exists an isomorphism
$\varphi : \mathcal{A} \to \mathcal{O}_T^{\oplus d}$
such that $1 \in \Gamma(\mathcal{A})$ corresponds to the first basis element.
In this situation the multiplication map
$\mathcal{A} \otimes_{\mathcal{O}_T} \mathcal{A} \to \mathcal{A}$
translates via $\varphi$ into a free $d$-dimensional algebra $m$ over
$\Gamma(T, \mathcal{O}_T)$. This finishes the proof.
\end{proof}




\section{Finite Hilbert stacks of spaces}
\label{section-spaces-hilbert}

\noindent
The finite Hilbert stack of an algebraic space is an algebraic stack.

\begin{lemma}
\label{lemma-hilbert-stack-of-space}
Let $S$ be a scheme.
Let $X$ be an algebraic space over $S$.
Then $\mathcal{H}_d(X)$ is an algebraic stack.
\end{lemma}

\begin{proof}
The $1$-morphism
$$
\mathcal{H}_d(X) \longrightarrow \mathcal{H}_d
$$
is representably by algebraic spaces according to
Lemma \ref{lemma-representable-on-top}.
The stack $\mathcal{H}_d$ is an algebraic stack according to
Proposition \ref{proposition-finite-hilbert-point}.
Hence $\mathcal{H}_d(X)$ is an algebraic stack by
Algebraic Stacks,
Lemma \ref{algebraic-lemma-representable-morphism-to-algebraic}.
\end{proof}

\noindent
This lemma allows us to bootstrap.

\begin{lemma}
\label{lemma-hilbert-stack-relative-space}
Let $S$ be a scheme. Let $F : \mathcal{X} \to \mathcal{Y}$ be a $1$-morphism
of stacks in groupoids over $(\textit{Sch}/S)_{fppf}$ such that
\begin{enumerate}
\item $\mathcal{X}$ is representable by an algebraic space, and
\item $F$ is representable by algebraic spaces, surjective, flat, and
locally of finite presentation.
\end{enumerate}
Then $\mathcal{H}_d(\mathcal{X}/\mathcal{Y})$ is an algebraic stack.
\end{lemma}

\begin{proof}
Choose a representable stack in groupoids $\mathcal{U}$ over $S$ and a
$1$-morphism $f : \mathcal{U} \to \mathcal{H}_d(\mathcal{X})$
which is representable by algebraic spaces, smooth, and surjective.
This is possible because $\mathcal{H}_d(\mathcal{X})$ is an algebraic stack by
Lemma \ref{lemma-hilbert-stack-of-space}.
Consider the $2$-fibre product
$$
\mathcal{W} =
\mathcal{H}_d(\mathcal{X}/\mathcal{Y})
\times_{\mathcal{H}_d(\mathcal{X}), f}
\mathcal{U}.
$$
Since $\mathcal{U}$ is representable (in particular a stack in setoids)
it follows from
Examples of Stacks, Lemma \ref{examples-stacks-lemma-faithful-hilbert}
and
Stacks, Lemma \ref{stacks-lemma-2-fibre-product-gives-stack-in-setoids}
that $\mathcal{W}$ is a stack in setoids. The $1$-morphism
$\mathcal{W} \to \mathcal{H}_d(\mathcal{X}/\mathcal{Y})$ is
representable by algebraic spaces, smooth, and surjective as a base
change of the morphism $f$ (see
Algebraic Stacks,
Lemmas \ref{algebraic-lemma-base-change-representable-by-spaces} and
\ref{algebraic-lemma-base-change-representable-transformations-property}).
Thus, if we can show that $\mathcal{W}$ is representable by an algebraic space,
then the lemma follows from
Algebraic Stacks,
Lemma \ref{algebraic-lemma-smooth-surjective-morphism-implies-algebraic}.

\medskip\noindent
The diagonal of $\mathcal{Y}$ is representable by algebraic spaces according to
Lemma \ref{lemma-flat-finite-presentation-surjective-diagonal}.
We may apply
Lemma \ref{lemma-relative-hilbert}
to see that the $1$-morphism
$$
\mathcal{H}_d(\mathcal{X}/\mathcal{Y})
\longrightarrow
\mathcal{H}_d(\mathcal{X}) \times \mathcal{Y}
$$
is representable by algebraic spaces. Consider the $2$-fibre product
$$
\mathcal{V} =
\mathcal{H}_d(\mathcal{X}/\mathcal{Y})
\times_{(\mathcal{H}_d(\mathcal{X}) \times \mathcal{Y}), f \times F}
(\mathcal{U} \times \mathcal{X}).
$$
The projection morphism $\mathcal{V} \to \mathcal{U} \times \mathcal{X}$
is representable by algebraic spaces as a base change of the last
displayed morphism. Hence $\mathcal{V}$ is an algebraic space (see
Bootstrap, Lemma \ref{bootstrap-lemma-representable-by-spaces-over-space}
or
Algebraic Stacks,
Lemma \ref{algebraic-lemma-base-change-by-space-representable-by-space}).
The $1$-morphism $\mathcal{V} \to \mathcal{U}$ fits into the following
$2$-cartesian diagram
$$
\xymatrix{
\mathcal{V} \ar[d] \ar[r] & \mathcal{X} \ar[d]^F \\
\mathcal{W} \ar[r] & \mathcal{Y}
}
$$
because
$$
\mathcal{H}_d(\mathcal{X}/\mathcal{Y})
\times_{(\mathcal{H}_d(\mathcal{X}) \times \mathcal{Y}), f \times F}
(\mathcal{U} \times \mathcal{X})
=
(\mathcal{H}_d(\mathcal{X}/\mathcal{Y})
\times_{\mathcal{H}_d(\mathcal{X}), f}
\mathcal{U}) \times_{\mathcal{Y}, F} \mathcal{X}.
$$
Hence $\mathcal{V} \to \mathcal{W}$ is representable by algebraic spaces,
surjective, flat, and locally of finite presentation as a base change
of $F$. It follows that the same thing is true for the corresponding
sheaves of sets associated to $\mathcal{V}$ and $\mathcal{W}$, see
Algebraic Stacks, Lemma \ref{algebraic-lemma-map-fibred-setoids-property}.
Thus we conclude that the sheaf associated to $\mathcal{W}$ is an
algebraic space by
Bootstrap, Theorem \ref{bootstrap-theorem-final-bootstrap}.
\end{proof}




\section{LCI locus in the Hilbert stack}
\label{section-lci}

\noindent
Please consult
Examples of Stacks, Section \ref{examples-stacks-section-hilbert-d-stack}
for notation. Fix a $1$-morphism $F : \mathcal{X} \longrightarrow \mathcal{Y}$
of stacks in groupoids over $(\textit{Sch}/S)_{fppf}$. Assume that
$F$ is representable by algebraic spaces. Fix $d \geq 1$. Consider an
object $(U, Z, y, x, \alpha)$ of $\mathcal{H}_d$. There is an
induced $1$-morphism
$$
(\textit{Sch}/Z)_{fppf}
\longrightarrow
(\textit{Sch}/U)_{fppf} \times_{y, \mathcal{Y}, F} \mathcal{X}
$$
(by the universal property of $2$-fibre products) which is representable by
a morphism of algebraic spaces over $U$.
Namely, since $F$ is representable by algebraic spaces, we may choose
an algebraic space $X_y$ over $U$ which represents the $2$-fibre product
$(\textit{Sch}/U)_{fppf} \times_{y, \mathcal{Y}, F} \mathcal{X}$.
Since $\alpha : y|_Z \to F(x)$ is an isomorphism we see that
$\xi = (Z, Z \to U, x, \alpha)$ is an object of the $2$-fibre product
$(\textit{Sch}/U)_{fppf} \times_{y, \mathcal{Y}, F} \mathcal{X}$ over $Z$.
Hence $\xi$ gives rise to a morphism $x_\alpha : Z \to X_y$ of algebraic spaces
over $U$ as $X_y$ is the functor of isomorphisms classes of objects of
$(\textit{Sch}/U)_{fppf} \times_{y, \mathcal{Y}, F} \mathcal{X}$, see
Algebraic Stacks,
Lemma \ref{algebraic-lemma-characterize-representable-by-space}.
Here is a picture
\begin{equation}
\label{equation-relative-map}
\vcenter{
\xymatrix{
Z \ar[r]_{x_\alpha} \ar[rd] & X_y \ar[d] \\
& U
}
}
\quad\quad
\vcenter{
\xymatrix{
(\textit{Sch}/Z)_{fppf} \ar[rd] \ar[r]_-{x, \alpha} &
(\textit{Sch}/U)_{fppf} \times_{y, \mathcal{Y}, F} \mathcal{X} \ar[r] \ar[d] &
\mathcal{X} \ar[d]^F \\
& (\textit{Sch}/U)_{fppf} \ar[r]^y & \mathcal{Y}
}
}
\end{equation}
We remark that if
$(f, g, b, a) : (U, Z, y, x, \alpha) \to (U', Z', y', x', \alpha')$
is a morphism between objects of $\mathcal{H}_d$, then the morphism
$x'_{\alpha'} : Z' \to X'_{y'}$ is the base change of the morphism
$x_\alpha$ by the morphism $g : U' \to U$ (details omitted).

\medskip\noindent
Now assume moreover that $F$ is flat and locally of finite presentation.
In this situation we define a full subcategory
$$
\mathcal{H}_{d, lci}(\mathcal{X}/\mathcal{Y}) \subset
\mathcal{H}_d(\mathcal{X}/\mathcal{Y})
$$
consisting of those objects $(U, Z, y, x, \alpha)$ of $\mathcal{H}_d$ such
that the corresponding morphism $x_\alpha : Z \to X_y$ is unramified
and a local complete intersection morphism (see
Morphisms of Spaces, Definition \ref{spaces-morphisms-definition-unramified}
and
More on Morphisms of Spaces,
Definition \ref{spaces-more-morphisms-definition-lci}
for definitions).

\begin{lemma}
\label{lemma-lci-locus-stack-in-groupoids}
Let $S$ be a scheme. Fix a $1$-morphism
$F : \mathcal{X} \longrightarrow \mathcal{Y}$
of stacks in groupoids over $(\textit{Sch}/S)_{fppf}$. 
Assume $F$ is representable by algebraic spaces, flat, and locally
of finite presentation. Then $\mathcal{H}_{d, lci}(\mathcal{X}/\mathcal{Y})$
is a stack in groupoids and the inclusion functor
$$
\mathcal{H}_{d, lci}(\mathcal{X}/\mathcal{Y})
\longrightarrow
\mathcal{H}_d(\mathcal{X}/\mathcal{Y})
$$
is representable and an open immersion.
\end{lemma}

\begin{proof}
Let $\Xi = (U, Z, y, x, \alpha)$ be an object of $\mathcal{H}_d$. It follows
from the remark following
(\ref{equation-relative-map})
that the pullback of $\Xi$ by $U' \to U$ belongs to
$\mathcal{H}_{d, lci}(\mathcal{X}/\mathcal{Y})$ if and only if the base
change of $x_\alpha$ is unramfied and a local complete intersection morphism.
Note that $Z \to U$ is finite locally free (hence flat, locally of
finite presentation and universally closed) and that $X_y \to U$ is
flat and locally of finite presentation by our assumption on $F$. Then
Quot and Hilbert Spaces, Lemmas \ref{quot-lemma-where-unramified} and
\ref{quot-lemma-where-lci}
imply exists an open subscheme $W \subset U$ such that a morphism
$U' \to U$ factors through $W$ if and only if the base change of
$x_\alpha$ via $U' \to U$ is unramified and a local complete intersection
morphism. This implies that
$$
(\textit{Sch}/U)_{fppf}
\times_{\Xi, \mathcal{H}_d(\mathcal{X}/\mathcal{Y})}
\mathcal{H}_{d, lci}(\mathcal{X}/\mathcal{Y})
$$
is representable by $W$. Hence the final statement of the lemma
holds. The first statement (that
$\mathcal{H}_{d, lci}(\mathcal{X}/\mathcal{Y})$ is a stack in groupoids)
follows from this an
Algebraic Stacks,
Lemma \ref{algebraic-lemma-open-fibred-category-is-algebraic}.
\end{proof}








\input{chapters}

\bibliography{my}
\bibliographystyle{amsalpha}

\end{document}
