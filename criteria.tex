\input{preamble}

% OK, start here.
%
\begin{document}

\title{Criteria for Representability}

\maketitle

\phantomsection
\label{section-phantom}

\tableofcontents




\section{Introduction}
\label{section-introduction}

\noindent
The purpose of this chapter is to find criteria guaranteeing that a
a stack in groupoids over the category of schemes with the fppf topology
is an algebraic stack. Historically, this often involved proving that
certain functors were representable, see Grothendieck's lectures
\cite{Gr-I},
\cite{Gr-II},
\cite{Gr-III},
\cite{Gr-IV},
\cite{Gr-V}, and
\cite{Gr-VI}.
This explains the title of this chapter. Another important source
of this material comes from the work of Artin, see
\cite{ArtinI},
\cite{ArtinII},
\cite{Artin-Theorem-Representability},
\cite{Artin-Construction-Techniques},
\cite{Artin-Algebraic-Spaces},
\cite{Artin-Algebraic-Approximation},
\cite{Artin-Implicit-Function}, and
\cite{ArtinVersal}.



\section{Conventions}
\label{section-conventions}

\noindent
The conventions we use in this chapter are the same as those in the
chapter on algebraic stacks, see
Algebraic Stacks, Section \ref{algebraic-section-conventions}.




\section{What we already know}
\label{section-done-so-far}

\noindent
The analogue of this chapter for algebraic spaces is the chapter entitled
``Bootstrap'', see
Bootstrap, Section \ref{bootstrap-section-introduction}.
That chapter already contains some representability results.
Moreover, some of the preliminary material treated there we already
have worked out in the chapter on algebraic stacks.
Here is a list:
\begin{enumerate}
\item We discuss morphisms of presheaves representable by algebraic spaces in
Bootstrap, Section
\ref{bootstrap-section-morphism-representable-by-spaces}.
In
Algebraic Stacks, Section
\ref{algebraic-section-morphisms-representable-by-algebraic-spaces}
we discuss the notion of a $1$-morphism of categories fibred in groupoids
being representable by algebraic spaces.
\item We discuss properties of morphisms of presheaves representable by
algebraic spaces in
Bootstrap, Section
\ref{bootstrap-section-representable-by-spaces-properties}.
In
Algebraic Stacks, Section
\ref{algebraic-section-representable-properties}
we discuss the notion of a $1$-morphism of categories fibred in groupoids
being representable by algebraic spaces.
\item We proved that if $F$ is a sheaf whose diagonal is representable
by algebraic spaces and which has an \'etale covering by an algebraic
space, then $F$ is an algebraic space, see
Bootstrap, Theorem \ref{bootstrap-theorem-bootstrap}.
(This is a weak version of the result in the next item on the list.)
\item
\label{item-bootstrap-final}
We proved that if $F$ is a sheaf and if there exists an algebraic
space $U$ and a morphism $U \to F$ which is representable by algebraic
spaces, surjective, flat, and locally of finite presentation, then
$F$ is an algebraic space, see
Bootstrap, Theorem \ref{bootstrap-theorem-final-bootstrap}.
\item We have also proved the ``smooth'' analogue of
(\ref{item-bootstrap-final}) for algebraic
stacks: If $\mathcal{X}$ is a stack in groupoids over
$(\textit{Sch}/S)_{fppf}$ and if there exists a stack in groupoids
$\mathcal{U}$ over $(\textit{Sch}/S)_{fppf}$ which is representably
by an algebraic space and a $1$-morphism $u : \mathcal{U} \to \mathcal{X}$
which is representable by algebraic spaces, surjective, and smooth
then $\mathcal{X}$ is an algebraic stack, see
Algebraic Stacks, Lemma
\ref{algebraic-lemma-smooth-surjective-morphism-implies-algebraic}.
\end{enumerate}
Our first task now is to prove the analogue of
(\ref{item-bootstrap-final}) for algebraic
stacks in general.



\section{Morphisms of stacks in groupoids}
\label{section-1-morphisms}

\noindent
This section is preliminary and should be skipped on a first reading.

\begin{lemma}
\label{lemma-etale-permanence}
Let $\mathcal{X} \to \mathcal{Y} \to \mathcal{Z}$
be $1$-morphisms of categories fibred in groupoids over
$(\textit{Sch}/S)_{fppf}$.
If $\mathcal{X} \to \mathcal{Z}$ and $\mathcal{Y} \to \mathcal{Z}$ are
representable by algebraic spaces and \'etale so is
$\mathcal{X} \to \mathcal{Y}$.
\end{lemma}

\begin{proof}
Let $\mathcal{U}$ be a representable category fibred in groupoids over $S$.
Let $f : \mathcal{U} \to \mathcal{Y}$ be a $1$-morphism. We have to show that
$\mathcal{X} \times_{\mathcal{Y}} \mathcal{U}$ is representable by an
algebraic space and \'etale over $\mathcal{U}$.
Consider the composition $h : \mathcal{U} \to \mathcal{Z}$. Then
$$
\mathcal{X} \times_{\mathcal{Z}} \mathcal{U}
\longrightarrow
\mathcal{Y} \times_{\mathcal{Z}} \mathcal{U}
$$
is a $1$-morphism between categories fibres in groupoids which are both
representable by algebraic spaces and both \'etale over $\mathcal{U}$.
Hence by
Properties of Spaces, Lemma \ref{spaces-properties-lemma-etale-permanence}
this is represented by an \'etale morphism of algebraic spaces.
Finally, we obtain the result we want as the morphism $f$ induces
a morphism $\mathcal{U} \to \mathcal{Y} \times_{\mathcal{Z}} \mathcal{U}$
and we have
$$
\mathcal{X} \times_{\mathcal{Y}} \mathcal{U} =
(\mathcal{X} \times_{\mathcal{Z}} \mathcal{U})
\times_{(\mathcal{Y} \times_{\mathcal{Z}} \mathcal{U})}
\mathcal{U}.
$$
\end{proof}

\begin{lemma}
\label{lemma-stack-in-setoids-descent}
Let $\mathcal{X}, \mathcal{Y}, \mathcal{Z}$ be stacks in groupoids
over $(\textit{Sch}/S)_{fppf}$. Suppose that $\mathcal{X} \to \mathcal{Y}$
and $\mathcal{Z} \to \mathcal{Y}$ are $1$-morphisms.
If
\begin{enumerate}
\item $\mathcal{Y}$, $\mathcal{Z}$ are representable by algebraic spaces
$Y$, $Z$ over $S$,
\item the associated morphism of algebraic spaces $Y \to Z$ is surjective,
flat and locally of finite presentation, and
\item $\mathcal{Y} \times_{\mathcal{Z}} \mathcal{X}$ is a stack in
setoids,
\end{enumerate}
then $\mathcal{X}$ is a stack in setoids.
\end{lemma}

\begin{proof}
This is a special case of
Stacks, Lemma \ref{stacks-lemma-stack-in-setoids-descent}.
\end{proof}






\section{Spaces of sections}
\label{section-spaces-sections}



\begin{lemma}
\label{lemma-surjection-space-of-sections}
Let $Z \to U$ be a finite morphism of schemes.
Let $W$ be an algebraic space and let $W \to Z$ be a
surjective \'etale morphism. Then there exists a surjective
\'etale morphism $U' \to U$ and a section
$$
\sigma : Z_{U'} \to W_{U'}
$$
of the morphism $W_{U'} \to Z_{U'}$.
\end{lemma}

\begin{proof}
We may choose a separated scheme $W'$ and a surjective \'etale morphism
$W' \to W$. Hence after replacing $W$ by $W'$ we may assume that $W$
is a separated scheme. Write $f : W \to Z$ and $\pi : Z \to U$.
Note that $f \circ \pi : W \to U$ is separated as
$W$ is separated. Let $u \in U$ be a point. Clearly it suffices
to find an \'etale neighbourhood $(U', u')$ of $(U, u)$ such that
a section $\sigma$ exists over $U'$. Let $z_1, \ldots, z_r$
be the points of $Z$ lying above $u$. For each $i$ choose a point
$w_i \in W$ which maps to $z_i$. We may pick an \'etale neighbourhood
$(U', u') \to (U, u)$ such that the conclusions of
More on Morphisms, Lemma
\ref{more-morphisms-lemma-etale-splits-off-quasi-finite-part-technical-variant}
hold for both $Z \to U$ and the points $z_1, \ldots, z_r$
and $W \to U$ and the points $w_1, \ldots, w_r$. Hence, after
replacing $(U, u)$ by $(U', u')$ and relabeling, we may assume that
all the field extensions $\kappa(u) \subset \kappa(z_i)$ and
$\kappa(u) \subset \kappa(w_i)$ are purely inseparable, and moreover
that there exist disjoint sum decompositions
$$
Z = V_1 \amalg \ldots \amalg V_r \amalg Rest, \quad
W = W_1 \amalg \ldots \amalg W_r \amalg Rest
$$
with $z_i \in V_i$, $w_i \in W_i$ and $V_i \to U$, $W_i \to U$ finite.
After shrinking $U$ we may assume that $Z = V_1 \amalg \ldots \amalg V_r$.
After replacing $W_i$ by $W_i \cap f^{-1}(V_i)$ we may assume that
$f$ maps $W_i$ into $V_i$. Then $f_i = f|_{W_i} : W_i \to V_i$
is a morphism of schemes finite over $U$, hence finite. It is also \'etale,
$f_i^{-1}(\{z_i\}) = w_i$, and induces an isomorphism of residue
fields $\kappa(z_i) = \kappa(w_i)$ (because both are purely inseparable
over $\kappa(u)$ and the extension is separable as $f$ is \'etale).
Hence by
\'Etale Morphisms of Schemes, Lemma \ref{etale-lemma-finite-etale-one-point}
we see that $f_i$ is an isomorphism in a neighbourhood $V_i'$ of
$z_i$. Since $\pi : Z \to U$ is closed, after shrinking $U$, we may assume
that $W_i \to V_i$ is an isomorphism. This proves the lemma.
\end{proof}

\begin{lemma}
\label{lemma-space-of-sections}
Let $Z \to U$ be a finite locally free morphism of schemes.
Let $W$ be an algebraic space and let $W \to Z$ be an \'etale morphism.
Then the functor
$$
F : (\textit{Sch}/U)_{fppf}^{opp} \longrightarrow \textit{Sets},
$$
defined by the rule
$$
U' \longmapsto
F(U') =
\{\sigma : Z_{U'} \to W_{U'}\text{ section of }W_{U'} \to Z_{U'}\}
$$
is an algebraic space and the morphism $F \to U$ is \'etale.
\end{lemma}

\begin{proof}
Assume first that $W \to Z$ is also separated.
Let $U'$ be a scheme over $U$ and let $\sigma \in F(U')$. By
Morphisms of Spaces, Lemma \ref{spaces-morphisms-lemma-section-immersion}
the morphism $\sigma$ is a closed immersion.
Moreover, $\sigma$ is \'etale by
Properties of Spaces, Lemma \ref{spaces-properties-lemma-etale-permanence}.
Hence $\sigma$ is also an open immersion, see
Morphisms of Spaces,
Lemma \ref{spaces-morphisms-lemma-etale-universally-injective-open}.
In other words, $Z_\sigma = \sigma(Z_{U'}) \subset W_{U'}$ is
an open subspace such that the morphism $Z_\sigma \to Z_{U'}$
is an isomorphism. In particular, the morphism $Z_\sigma \to U'$
is finite. Hence we obtain a transformation of functors
$$
F \longrightarrow (W/U)_{fin},\quad
\sigma \longmapsto (U' \to U, Z_\sigma)
$$
where $(W/U)_{fin}$ is the finite part of the morphism $W \to U$
introduced in
More on Groupoid Spaces, Section \ref{spaces-more-groupoids-section-finite}.
It is clear that this transformation of functors is injective (since we can
recover $\sigma$ from $Z_\sigma$ as the inverse of the isomorphism
$Z_\sigma \to Z_{U'}$). By
More on Groupoids in Space, Proposition
\ref{spaces-more-groupoids-proposition-finite-algebraic-space}
we know that $(W/U)_{fin}$ is an algebraic space \'etale over $U$.
Hence to finish the proof in this case it suffices to show that
$F \to (W/U)_{fin}$ is representable and an open immersion.
To see this suppose that we are given a morphism of schemes $U' \to U$
and an open subspace $Z' \subset W_{U'}$ such that $Z' \to U'$
is finite. Then it suffices to show that there exists an
open subscheme $U'' \subset U'$ such that a morphism
$T \to U'$ factors through $U''$ if and only if $Z' \times_{U'} T$
maps isomorphically to $Z \times_{U'} T$. This follows from
Quot and Hilbert Spaces, Lemma \ref{quot-lemma-where-isomorphism}
(here we use that $Z \to B$ is flat and locally of finite presentation
as well as finite).
Hence we have proved the lemma in case $W \to Z$ is separated
as well as \'etale.

\medskip\noindent
In the general case we choose a separated scheme $W'$ and a surjective
\'etale morphism $W' \to W$. Note that the morphisms $W' \to W$ and
$W \to Z$ are separated as their source is separated. Denote $F'$ the
functor associated to $W' \to Z \to U$ as in the lemma. In the first
paragraph of the proof we showed that $F'$ is representable by an
algebraic space \'etale over $U$. By
Lemma \ref{lemma-surjection-space-of-sections}
the map of functors $F' \to F$ is surjective for the \'etale topology
on $\textit{Sch}/U$. Moreover, if $U'$ and $\sigma : Z_{U'} \to W_{U'}$
define a point $\xi \in F(U')$, then the fibre product
$$
F'' = F' \times_{F, \xi} U'
$$
is the functor on $\textit{Sch}/U'$ associated to the morphisms
$$
W'_{U'} \times_{W_{U'}, \sigma} Z_{U'} \to Z_{U'} \to U'.
$$
Since the first morphism is separated as a base change of a separated
morphism, we see that $F''$ is an algebraic space \'etale over $U'$
by the result of the first paragraph. It follows that $F' \to F$ is a
surjective \'etale transformation of functors, which is representable
by algebraic spaces. Hence $F$ is an algebraic space by
Bootstrap, Theorem \ref{bootstrap-theorem-final-bootstrap}.
Since $F' \to F$ is an \'etale surjective morphism of algebraic spaces
it follows that $F \to U$ is \'etale because $F' \to U$ is \'etale.
\end{proof}









\section{Relative morphisms}
\label{section-relative-morphisms}

\noindent
Let $S$ be a scheme. Let $Z \to B$ and $X \to B$ be morphisms of
algebraic spaces over $S$. Given a scheme $T$ we can consider pairs
$(a, b)$ where $a : T \to B$
is a morphism and $b : T \times_{a, B} Z \to T \times_{a, B} X$
is a morphism over $T$. Picture
\begin{equation}
\label{equation-hom}
\vcenter{
\xymatrix{
T \times_{a, B} Z \ar[rd] \ar[rr]_b & &
T \times_{a, B} X \ar[ld] & Z \ar[rd] & & X \ar[ld] \\
& T \ar[rrr]^a & & & B
}
}
\end{equation}
Of course, we can also think of $b$ as a morphism
$b : T \times_{a, B} Z \to X$ such that
$$
\xymatrix{
T \times_{a, B} Z \ar[r] \ar[d] \ar@/^1pc/[rrr]_-b &
Z \ar[rd] & & X \ar[ld] \\
T \ar[rr]^a & & B
}
$$
commutes. In this situation we can define a functor
\begin{equation}
\label{equation-hom-functor}
\mathit{Mor}_{B}(Z, X) : (\text{Sch}/S)^{opp} \longrightarrow \textit{Sets},
\quad
T \longmapsto \{(a, b)\text{ as above}\}
\end{equation}
Sometimes we think of this as a functor defined on the category
of schemes over $B$, in which case we drop $a$ from the notation.

\begin{lemma}
\label{lemma-hom-functor-sheaf}
Let $S$ be a scheme. Let $Z \to B$ and $X \to B$ be morphisms of
algebraic spaces over $S$. Then
\begin{enumerate}
\item $\mathit{Mor}_B(Z, X)$ is a sheaf on
$(\text{Sch}/S)_{fppf}$.
\item If $T$ is an algebraic space over $S$, then there is a
canonical bijection
$$
\text{Mor}_{\textit{Sh}((\textit{Sch}/S)_{fppf})}(T, \mathit{Mor}_B(Z, X))
=
\{(a, b)\text{ as in }(\ref{equation-hom})\}
$$
\end{enumerate}
\end{lemma}

\begin{proof}
Let $T$ be an algebraic space over $S$. Let $\{T_i \to T\}$ be an fppf
covering of $T$ (as in
Topologies on Spaces, Section \ref{spaces-topologies-section-fppf}).
Suppose that $(a_i, b_i) \in \mathit{Mor}_B(Z, X)(T_i)$ such
that $(a_i, b_i)|_{T_i \times_T T_j} = (a_j, b_j)|_{T_i \times_T T_j}$
for all $i, j$. Then by
Descent on Spaces,
Lemma \ref{spaces-descent-lemma-fppf-universal-effective-epimorphisms}
there exists a unique morphism $a : T \to B$ such that $a_i$ is the
composition of $T_i \to T$ and $a$. Then
$\{T_i \times_{a_i, B} Z \to T \times_{a, B} Z\}$ is an fppf covering
too and the same lemma implies there exists a unique morphism
$b : T \times_{a, B} Z \to T \times_{a, B} X$ such that $b_i$ is the
composition of $T_i \times_{a_i, B} Z \to T \times_{a, B} Z$ and $b$. Hence
$(a, b) \in \mathit{Mor}_B(Z, X)(T)$ restricts to $(a_i, b_i)$
over $T_i$ for all $i$.

\medskip\noindent
Note that the result of the preceding paragraph in particular implies (1).

\medskip\noindent
Let $T$ be an algebraic space over $S$. In order to prove (2) we will
construct mutually inverse maps between the displayed sets. In the
following when we say ``pair'' we mean a pair $(a, b)$ fitting
into (\ref{equation-hom}).

\medskip\noindent
Let $v : T \to \mathit{Mor}_B(Z, X)$ be a natural transformation.
Choose a scheme $U$ and a surjective \'etale morphism $p : U \to T$.
Then $v(p) \in \mathit{Mor}_B(Z, X)(U)$ corresponds to a pair $(a_U, b_U)$
over $U$. Let $R = U \times_T U$ with projections $t, s : R \to U$.
As $v$ is a transformation of functors we see that the pullbacks of
$(a_U, b_U)$ by $s$ and $t$ agree. Hence, since $\{U \to T\}$ is an
fppf covering, we may apply the result of the first paragraph that
deduce that there exists a unique pair $(a, b)$ over $T$.

\medskip\noindent
Conversely, let $(a, b)$ be a pair over $T$. 
Let $U \to T$, $R = U \times_T U$, and $t, s : R \to U$ be as
above. Then the restriction $(a, b)|_U$ gives rise to a
tranformation of functors $v : h_U \to \mathit{Mor}_B(Z, X)$ by the
Yoneda lemma
(Categories, Lemma \ref{categories-lemma-yoneda}).
As the two pullbacks $s^*(a, b)|_U$ and $t^*(a, b)|_U$
are equal, we see that $v$ coequalizes the two maps
$h_t, h_s : h_R \to h_U$. Since $T = U/R$ is the fppf quotient sheaf by
Spaces, Lemma \ref{spaces-lemma-space-presentation}
and since $\mathit{Mor}_B(Z, X)$ is an fppf sheaf by (1) we conclude
that $v$ factors through a map $T \to \mathit{Mor}_B(Z, X)$.

\medskip\noindent
We omit the verification that the two constructions above are mutually
inverse.
\end{proof}

\begin{lemma}
\label{lemma-hom-from-finite-free-into-affine}
Let $Z \to B$ and $X \to B$ be morphisms of affine schemes.
Assume $\Gamma(Z, \mathcal{O}_Z)$ is a finite free
$\Gamma(B, \mathcal{O}_B)$-module. Then $\mathit{Mor}_B(Z, X)$
is representable by an affine scheme over $B$.
\end{lemma}

\begin{proof}
Write $B = \text{Spec}(R)$. Choose a basis $\{e_1, \ldots, e_m\}$
for $\Gamma(Z, \mathcal{O}_Z)$. Finally, choose a presentation
$$
\Gamma(X, \mathcal{O}_X) = R[\{x_i\}_{i \in I}]/(\{f_k\}_{k \in K}).
$$
We will denote $\overline{x}_i$ the image of $x_i$ in this quotient.
Write
$$
P = R[\{a_{ij}\}_{i \in I, 1 \leq j \geq m}].
$$
Consider the $R$-algebra map
$$
\Psi :
R[\{x_i\}_{i \in I}]
\longrightarrow
P \otimes_R \Gamma(Z, \mathcal{O}_Z),\quad
x_i \longmapsto \sum\nolimits_j a_{ij} \otimes e_j.
$$
Write $\Psi(f_k) = \sum c_{kj} \otimes e_j$ with $c_{kj} \in P$.
Finally, denote $J \subset P$ the ideal generated by the elements
$c_{kj}$, $k \in K$, $1 \leq j \leq m$. We claim that
$W = \text{Spec}(P/J)$ represents the functor $\mathit{Mor}_B(Z, X)$.

\medskip\noindent
First, note that by construction $P/J$ is an $R$-algebra, hence
a morphism $a_{univ} : W \to B$. Second, by construction the map
$\Psi$ factors through $\Gamma(X, \mathcal{O}_X)$, hence we obtain
an $P/J$-algebra homomorphism
$$
P/J \otimes_R \Gamma(X, \mathcal{O}_X)
\longrightarrow
P/J \otimes_R \Gamma(Z, \mathcal{O}_Z)
$$
which determines a morphism
$b_{univ} : W \times_{a_{univ}, B} Z \to W \times_{a_{univ}, B} X$.
By the Yoneda lemma the pair $(a_{univ}, b_{univ})$ determines a
transformation of functors $W \to \mathit{Mor}_B(Z, X)$ which we
claim is an isomorphism.

\medskip\noindent
The reason is that if $T = \text{Spec}(R')$ is an affine scheme
and $(a, b) \in \mathit{Mor}_B(Z, X)(T)$, then $a$ defines an
$R$-algebra structure on $R'$ and $b$ defines an $R'$-algebra map
$$
b^\sharp :
R' \otimes_R \Gamma(X, \mathcal{O}_X)
\longrightarrow
R' \otimes_R \Gamma(Z, \mathcal{O}_Z).
$$
In particular we can write
$b^\sharp(1 \otimes \overline{x}_i) = \sum \alpha_{ij} \otimes e_j$
for some $\alpha_{ij} \in R'$. This corresponds to an $R$-algebra map
$P/J \to R'$ determined by the rule $a_{ij} \mapsto \alpha_{ij}$.
In turn this corresponds to a morphism $T \to W$ such that
$(a, b)$ is the pullback of $(a_{univ}, b_{univ})$. Details omitted.
\end{proof}

\begin{lemma}
\label{lemma-etale-covering-hom-functor}
Let $S$ be a scheme. Let $Z \to B$ and $X' \to X \to B$ be morphisms of
algebraic spaces over $S$. Assume
\begin{enumerate}
\item $X' \to X$ is \'etale, and
\item $Z \to B$ is finite locally free.
\end{enumerate}
Then $\mathit{Mor}_B(Z, X') \to \mathit{Mor}_B(Z, X)$ is representable
by algebraic spaces and \'etale. If $X' \to X$ is also surjective,
then $\mathit{Mor}_B(Z, X') \to \mathit{Mor}_B(Z, X)$ is surjective.
\end{lemma}

\begin{proof}
Let $U$ be a scheme and let $\xi = (a, b)$ be an element of
$\mathit{Mor}_B(Z, X)(U)$. We have to prove that the functor
$$
h_U \times_{\xi, \mathit{Mor}_B(Z, X)} \mathit{Mor}_B(Z, X')
$$
is representable by an algebaic space \'etale over $U$. Set
$Z_U = U \times_{a, B} Z$ and $W = Z_U \times_{b, X} X'$.
Then $W \to Z_U \to U$ is as in
Lemma \ref{lemma-space-of-sections}
and the sheaf $F$ defined there is identified with the fibre product
displayed above. Hence the first assertion of the lemma.
The second assertion follows from this and
Lemma \ref{lemma-surjection-space-of-sections}
which guarantees that $F \to U$ is surjective in the situation above.
\end{proof}

\begin{lemma}
\label{lemma-etale-base-change-hom-functor}
Let $S$ be a scheme. Let $Z \to B$, $X \to B$, and $B' \to B$
be morphisms of algebraic spaces over $S$. Set $Z' = B' \times_B Z$
and $X' = B' \times_B X$. Then
$$
\mathit{Mor}_{B'}(Z', X')
=
B' \times_B \mathit{Mor}_B(Z, X)
$$
in $\textit{Sh}((\textit{Sch}/S)_{fppf})$.
\end{lemma}

\begin{proof}
Follows immediately from the definitions.
\end{proof}

\begin{proposition}
\label{proposition-hom-functor-algebraic-space}
Let $S$ be a scheme. Let $Z \to B$ and $X \to B$ be morphisms of
algebraic spaces over $S$. If $Z \to B$ is finite locally free
then $\mathit{Mor}_B(Z, X)$ is an algebraic space.
\end{proposition}

\begin{proof}
Choose a scheme $B' = \coprod B'_i$ which is a disjoint union of
affine schemes $B'_i$ and an \'etale surjective morphism $B' \to B$. 
We may also assume that $B'_i \times_B Z$ is the spectrum of a ring
which is finite free as a $\Gamma(B'_i, \mathcal{O}_{B'_i})$-module.
By
Lemma \ref{lemma-etale-base-change-hom-functor}
and
Algebraic Spaces, Lemma
\ref{spaces-lemma-base-change-representable-transformations-property}
the morphism $\mathit{Mor}_{B'}(Z', X') \to \mathit{Mor}_B(Z, X)$
is surjective \'etale. Hence by
Bootstrap, Theorem \ref{bootstrap-theorem-final-bootstrap}
it suffices to prove the proposition when $B = B'$ is a disjoint union of
affine schemes $B'_i$ so that each $B'_i \times_B Z$ is finite free
over $B'_i$. Then it actually suffices to prove the result for the restriction
to each $B'_i$. Thus we may assume that $B$ is affine and that
$\Gamma(Z, \mathcal{O}_Z)$ is a finite free $\Gamma(B, \mathcal{O}_B)$-module.

\medskip\noindent
Choose a scheme $X'$ which is a disjoint union of affine schemes and
a surjective \'etale morphism $X' \to X$. By
Lemma \ref{lemma-etale-covering-hom-functor}
the morphism $\mathit{Mor}_B(Z, X') \to \mathit{Mor}_B(Z, X)$
is representable by algebraic spaces, \'etale, and surjective.
Hence by
Bootstrap, Theorem \ref{bootstrap-theorem-final-bootstrap}
it suffices to prove the proposition when $X$ is a disjoint union
of affine schemes. This reduces us to the case discussed in the next
paragraph.

\medskip\noindent
Assume $X = \coprod_{i \in I} X_i$ is a disjoint union of affine
schemes, $B$ is affine, and that $\Gamma(Z, \mathcal{O}_Z)$ is a finite
free $\Gamma(B, \mathcal{O}_B)$-module. For any finite subset
$E \subset I$ set
$$
F_E = \mathit{Mor}_B(Z, \coprod\nolimits_{i \in E} X_i).
$$
By
Lemma \ref{lemma-hom-from-finite-free-into-affine}
we see that $F_E$ is an algebraic space. Consider the morphism
$$
\coprod\nolimits_{E \subset I\text{ finite}} F_E
\longrightarrow
\mathit{Mor}_B(Z, X)
$$
Each of the morphisms
$F_E \to \mathit{Mor}_B(Z, X)$ is an open immersion, because it is
simply the locus parametrizing pairs $(a, b)$ where $b$ maps into
the open subscheme $\coprod\nolimits_{i \in E} X_i$ of $X$. Moreover,
if $T$ is quasi-compact, then for any pair $(a, b)$ the image
of $b$ is contained in $\coprod\nolimits_{i \in E} X_i$ for some
$E \subset I$ finite. Hence the displayed arrow is in fact an
open covering and we win\footnote{Modulo
some set theoretic arguments. Namely, we have to show that
$\coprod F_E$ is an algebraic space. This follows because
$|I| \leq \text{size}(X)$ and $\text{size}(F_E) \leq \text{size}(X)$
as follows from the explicit description of $F_E$ in the proof of
Lemma \ref{lemma-hom-from-finite-free-into-affine}.
Some details omitted.} by
Algebraic Spaces, Lemma \ref{spaces-lemma-glueing-algebraic-spaces}.
\end{proof}










\section{Restriction of scalars}
\label{section-restriction-of-scalars}

\noindent
Suppose $X \to Z \to B$ are morphisms of algebraic spaces over $S$.
Given a scheme $T$ we can consider pairs $(a, b)$ where $a : T \to B$
is a morphism and $b : T \times_{a, B} Z \to X$ is a morphism over $Z$.
Picture
\begin{equation}
\label{equation-pairs}
\vcenter{
\xymatrix{
& X \ar[d] \\
T \times_{a, B} Z \ar[d] \ar[ru]^b \ar[r] & Z \ar[d] \\
T \ar[r]^a & B
}
}
\end{equation}
In this situation we can define a
functor
\begin{equation}
\label{equation-restriction-of-scalars}
\text{Res}_{Z/B}(X) : (\text{Sch}/S)^{opp} \longrightarrow \textit{Sets},
\quad
T \longmapsto \{(a, b)\text{ as above}\}
\end{equation}
Sometimes we think of this as a functor defined on the category
of schemes over $B$, in which case we drop $a$ from the notation.

\begin{lemma}
\label{lemma-restriction-of-scalars-sheaf}
Let $S$ be a scheme. Let $X \to Z \to B$ be morphisms of
algebraic spaces over $S$. Then
\begin{enumerate}
\item $\text{Res}_{Z/B}(X)$ is a sheaf on
$(\text{Sch}/S)_{fppf}$.
\item If $T$ is an algebraic space over $S$, then there is a
canonical bijection
$$
\text{Mor}_{\textit{Sh}((\textit{Sch}/S)_{fppf})}(T, \text{Res}_{Z/B}(X))
=
\{(a, b)\text{ as in }(\ref{equation-pairs})\}
$$
\end{enumerate}
\end{lemma}

\begin{proof}
Let $T$ be an algebraic space over $S$. Let $\{T_i \to T\}$ be an fppf
covering of $T$ (as in
Topologies on Spaces, Section \ref{spaces-topologies-section-fppf}).
Suppose that $(a_i, b_i) \in \text{Res}_{Z/B}(X)(T_i)$ such
that $(a_i, b_i)|_{T_i \times_T T_j} = (a_j, b_j)|_{T_i \times_T T_j}$
for all $i, j$. Then by
Descent on Spaces,
Lemma \ref{spaces-descent-lemma-fppf-universal-effective-epimorphisms}
there exists a unique morphism $a : T \to B$ such that $a_i$ is the
composition of $T_i \to T$ and $a$. Then
$\{T_i \times_{a_i, B} Z \to T \times_{a, B} Z\}$ is an fppf covering
too and the same lemma implies there exists a unique morphism
$b : T \times_{a, B} Z \to X$ such that $b_i$ is the composition
of $T_i \times_{a_i, B} Z \to T \times_{a, B} Z$ and $b$. Hence
$(a, b) \in \text{Res}_{Z/B}(X)(T)$ restricts to $(a_i, b_i)$ 
over $T_i$ for all $i$.

\medskip\noindent
Note that the result of the preceding paragraph in particular implies (1).

\medskip\noindent
Let $T$ be an algebraic space over $S$. In order to prove (2) we will
construct mutually inverse maps between the displayed sets. In the
following when we say ``pair'' we mean a pair $(a, b)$ fitting
into (\ref{equation-pairs}).

\medskip\noindent
Let $v : T \to \text{Res}_{Z/B}(X)$ be a natural transformation.
Choose a scheme $U$ and a surjective \'etale morphism $p : U \to T$.
Then $v(p) \in \text{Res}_{Z/B}(X)(U)$ corresponds to a pair $(a_U, b_U)$
over $U$. Let $R = U \times_T U$ with projections $t, s : R \to U$.
As $v$ is a transformation of functors we see that the pullbacks of
$(a_U, b_U)$ by $s$ and $t$ agree. Hence, since $\{U \to T\}$ is an
fppf covering, we may apply the result of the first paragraph that
deduce that there exists a unique pair $(a, b)$ over $T$.

\medskip\noindent
Conversely, let $(a, b)$ be a pair over $T$. 
Let $U \to T$, $R = U \times_T U$, and $t, s : R \to U$ be as
above. Then the restriction $(a, b)|_U$ gives rise to a
tranformation of functors $v : h_U \to \text{Res}_{Z/B}(X)$ by the
Yoneda lemma
(Categories, Lemma \ref{categories-lemma-yoneda}).
As the two pullbacks $s^*(a, b)|_U$ and $t^*(a, b)|_U$
are equal, we see that $v$ coequalizes the two maps
$h_t, h_s : h_R \to h_U$. Since $T = U/R$ is the fppf quotient sheaf by
Spaces, Lemma \ref{spaces-lemma-space-presentation}
and since $\text{Res}_{Z/B}(X)$ is an fppf sheaf by (1) we conclude
that $v$ factors through a map $T \to \text{Res}_{Z/B}(X)$.

\medskip\noindent
We omit the verification that the two constructions above are mutually
inverse.
\end{proof}

\noindent
Of course the sheaf $\text{Res}_{Z/B}(X)$ comes with a natural transformation
of functors $\text{Res}_{Z/B}(X) \to B$. We will use this without further
mention in the following.






\section{Finite Hilbert stacks}
\label{section-finite-hilbert-stacks}

\noindent
In this section we prove some results concerning the finite
Hilbert stacks $\mathcal{H}_d(\mathcal{X}/\mathcal{Y})$
introduced in
Examples of Stacks, Section \ref{examples-stacks-section-hilbert-d-stack}.

\begin{lemma}
\label{lemma-map-hilbert}
Consider a $2$-commutative diagram
$$
\xymatrix{
\mathcal{X}' \ar[r]_G \ar[d]_{F'} & \mathcal{X} \ar[d]^F \\
\mathcal{Y}' \ar[r]^H & \mathcal{Y}
}
$$
of stacks in groupoids over $(\textit{Sch}/S)_{fppf}$ with a given
$2$-isomorphism $\gamma : H \circ F' \to F \circ G$. In this situation we
obtain a canonical $1$-morphism
$\mathcal{H}_d(\mathcal{X}'/\mathcal{Y}') \to
\mathcal{H}_d(\mathcal{X}/\mathcal{Y})$.
This morphism is compatible with the forgetful $1$-morphisms of
Examples of Stacks,
Equation (\ref{examples-stacks-equation-diagram-hilbert-d-stack}).
\end{lemma}

\begin{proof}
We map the object $(U, Z, y', x', \alpha')$ to the object
$(U, Z, H(y'), G(x'), \gamma \star \text{id}_H \star \alpha')$
where $\star$ denotes horizontal composition of $2$-morphisms, see
Categories, Definition \ref{categories-definition-horizontal-composition}.
To a morphism
$(f, g, b, a) :
(U_1, Z_1, y_1', x_1', \alpha_1') \to (U_2, Z_2, y_2', x_2', \alpha_2')$
we assign
$(f, g, H(b), G(a))$.
We omit the verification that this defines a functor between categories over
$(\textit{Sch}/S)_{fppf}$.
\end{proof}

\begin{lemma}
\label{lemma-cartesian-map-hilbert}
In the situation of
Lemma \ref{lemma-map-hilbert}
assume that the given square is $2$-cartesian. Then the diagram
$$
\xymatrix{
\mathcal{H}_d(\mathcal{X}'/\mathcal{Y}') \ar[r] \ar[d] &
\mathcal{H}_d(\mathcal{X}/\mathcal{Y}) \ar[d] \\
\mathcal{Y}' \ar[r] &
\mathcal{Y}
}
$$
is $2$-cartesian.
\end{lemma}

\begin{proof}
We get a $2$-commutative diagram by
Lemma \ref{lemma-map-hilbert}
and hence we get a $1$-morphism (i.e., a functor)
$$
\mathcal{H}_d(\mathcal{X}'/\mathcal{Y}')
\longrightarrow
\mathcal{Y}' \times_{\mathcal{Y}} \mathcal{H}_d(\mathcal{X}/\mathcal{Y})
$$
We indicate why this functor is essentially surjective. Namely, an object
of the category on the right hand side is given by a scheme $U$ over $S$,
an object $y'$ of $\mathcal{Y}'_U$, an object $(U, Z, y, x, \alpha)$
of $\mathcal{H}_d(\mathcal{X}/\mathcal{Y})$ over $U$ and an isomorphism
$H(y') \to y$ in $\mathcal{Y}_U$. The assumption means exactly that
there exists an object $x'$ of $\mathcal{X}'_Z$ such that there exist
isomorphisms $G(x') \cong x$ and $\alpha' : y'|_Z \to F'(x')$ compatible
with $\alpha$. Then we see that $(U, Z, y', x', \alpha')$ is an
object of $\mathcal{H}_d(\mathcal{X}'/\mathcal{Y}')$ over $U$.
Details omitted.
\end{proof}



\begin{lemma}
\label{lemma-etale-map-hilbert}
In the situation of
Lemma \ref{lemma-map-hilbert}.
Assume that $G$, $H$ are representable by algebraic spaces and \'etale.
Then $\mathcal{H}_d(\mathcal{X}'/\mathcal{Y}') \to
\mathcal{H}_d(\mathcal{X}/\mathcal{Y})$ is representable by
algebraic spaces and \'etale.
If, in addition, $H$ is surjective and the induced functor
$\mathcal{X}' \to \mathcal{Y}' \times_{\mathcal{Y}} \mathcal{X}$
(which is representable by algebraic spaces and \'etale by
Lemma \ref{lemma-etale-permanence})
is surjective, then $\mathcal{H}_d(\mathcal{X}'/\mathcal{Y}') \to
\mathcal{H}_d(\mathcal{X}/\mathcal{Y})$ is also surjective.
\end{lemma}

\begin{proof}
Set $\mathcal{X}'' = \mathcal{Y}' \times_{\mathcal{Y}} \mathcal{X}$
so that we obtain a $2$-commutative diagram
$$
\xymatrix{
\mathcal{X}' \ar[r] \ar[d] &
\mathcal{X}'' \ar[r] \ar[d] &
\mathcal{X} \ar[d] \\
\mathcal{Y}' \ar[r] &
\mathcal{Y}' \ar[r] &
\mathcal{Y}
}
$$
It follows from
Lemma \ref{lemma-cartesian-map-hilbert}
that $\mathcal{H}_d(\mathcal{X}''/\mathcal{Y}')$ is the base change
of $\mathcal{H}_d(\mathcal{X}/\mathcal{Y})$ by $\mathcal{Y}' \to \mathcal{Y}$.
In particular we see that
$\mathcal{H}_d(\mathcal{X}''/\mathcal{Y}') \to
\mathcal{H}_d(\mathcal{X}/\mathcal{Y})$ is
representable by algebraic spaces and \'etale, see
Algebraic Stacks, Lemma
\ref{algebraic-lemma-base-change-representable-transformations-property}.
Moreover, it is also surjective if $H$ is.
By
Lemma \ref{lemma-etale-permanence}
the $1$-morphism $\mathcal{X}' \to \mathcal{X}''$ is representable by
algebraic spaces and \'etale. Hence if we can show that
the result holds for the left square in the diagram, then we're done.
In this way we reduce to the case where $\mathcal{Y}' = \mathcal{Y}$.

\medskip\noindent
Assume $\mathcal{Y}' = \mathcal{Y}$.
Let $U$ be a scheme and let $\xi = (U, Z, y, x, \alpha)$ be an object of
$\mathcal{H}_d(\mathcal{X}/\mathcal{Y})$ over $U$.
We have to prove that the $2$-fibre product
\begin{equation}
\label{equation-to-show}
(\textit{Sch}/U)_{fppf}
\times_{\xi, \mathcal{H}_d(\mathcal{X}/\mathcal{Y})}
\mathcal{H}_d(\mathcal{X}'/\mathcal{Y})
\end{equation}
is representably by an algebraic space \'etale over $U$.
By assumption the $2$-fibre product
$$
(\textit{Sch}/Z)_{fppf} \times_{x, \mathcal{X}} \mathcal{X}'
$$
is representable by an algebraic space $W$ such that the projection
$W \to Z$ is \'etale. Then (\ref{equation-to-show})
is representable by the algebraic space $F$ parametrizing sections of
$W \to Z$ over $U$ introduced in
Lemma \ref{lemma-space-of-sections}.
Since $F \to U$ is \'etale we conclude that
$\mathcal{H}_d(\mathcal{X}'/\mathcal{Y}') \to
\mathcal{H}_d(\mathcal{X}/\mathcal{Y})$ is representable by
algebraic spaces and \'etale.
Finally, if $\mathcal{X}' \to \mathcal{X}$ is surjective also,
then $W \to Z$ is surjective, and hence $F \to U$ is surjective by
Lemma \ref{lemma-surjection-space-of-sections}.
Thus in this case
$\mathcal{H}_d(\mathcal{X}'/\mathcal{Y}') \to
\mathcal{H}_d(\mathcal{X}/\mathcal{Y})$ is also surjective.
\end{proof}

















\input{chapters}

\bibliography{my}
\bibliographystyle{amsalpha}

\end{document}
