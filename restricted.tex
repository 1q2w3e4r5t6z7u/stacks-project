\input{preamble}

% OK, start here.
%
\begin{document}

\title{Restricted Power Series}


\maketitle

\phantomsection
\label{section-phantom}

\tableofcontents

\section{Introduction}
\label{section-introduction}

\noindent
In this chapter we discuss algebras topologically of finite type
over pre-adic topological rings and their homomorphisms. Many of
the results discussed here can be found in the paper \cite{Elkik}.
Other general references for this chapter are \cite{EGA}, \cite{Abbes},
and \cite{Fujiwara-Kato}.




\section{Restricted power series}
\label{section-restricted-power-series}

\noindent
Let $A$ be a topological ring complete with respect to a linear
topology (More on Algebra, Definition
\ref{more-algebra-definition-topological-ring}).
Let $I_\lambda$ be a fundamental system of open ideals.
Let $r \geq 0$ be an integer. In this setting one often
denotes
$$
A\{x_1, \ldots, x_r\} =
\lim_\lambda A/I_\lambda[x_1, \ldots, x_r] =
\lim_\lambda (A[x_1, \ldots, x_r]/I_\lambda A[x_1, \ldots, x_r])
$$
the completion of the polynomial ring with respect to the
ideals $I_\lambda$. We can think of elements of $A\{x_1, \ldots, x_r\}$ as
power series
$$
f = \sum\nolimits_{E = (e_1, \ldots, e_r)} a_E x_1^{e_1} \ldots x_r^{e_r}
$$
in $x_1, \ldots, x_r$ with coefficients $a_E \in A$ which tend
to zero in the topology of $A$. In other words, for any $\lambda$
all but a finite number of $a_E$ are in $I_\lambda$.
For this reason elements of $A\{x_1, \ldots, x_r\}$ are sometimes
called {\it restricted power series}.
Sometimes this ring is denoted $A\langle x_1, \ldots, x_r\rangle$;
we will refrain from using this notation.

\begin{remark}[Universal property restricted power series]
\label{remark-universal-property}
\begin{reference}
\cite[Chapter 0, 7.5.3]{EGA}
\end{reference}
Let $A \to C$ be a continuous map of complete linearly topologized rings.
Then any $A$-algebra map $A[x_1, \ldots x_r] \to C$ extends uniquely to a
continuous map $A\{x_1, \ldots, x_r\} \to C$ on restricted power series.
\end{remark}

\begin{remark}
\label{remark-I-adic-completion-and-restricted-power-series}
Let $A$ be a ring and let $I \subset A$ be an ideal.
If $A$ is $I$-adically complete, then the $I$-adic completion
$A[x_1, \ldots, x_r]^\wedge$ of $A[x_1, \ldots, x_r]$ is the
restricted power series ring over $A$ as a ring. However, it is not clear
that $A[x_1, \ldots, x_r]^\wedge$ is $I$-adically complete
unless $I$ is finitely generated. One way to think about this, is
to think of the topology on $A\{x_1, \ldots, x_r\}$ as the limit
topology (which is always complete) and the topology on
$A[x_1, \ldots, x_r]^\wedge$ as the $I$-adic topology (not always complete).
\end{remark}

\noindent
Let $A$ be a topological ring complete with respect to a linear
topology. Let $I_\lambda$ be a fundamental system of open ideals.
Let $\mathcal{C}$ be the category of systems $(B_\lambda)$ where
\begin{enumerate}
\item $B_\lambda$ is a finite type $A/I_\lambda$-algebra, and
\item $B_\mu \to B_\lambda$ is an $A/I_\mu$-algebra homomorphism
which induces an isomorphism $B_\mu/I_\lambda B_\mu \to B_\lambda$.
\end{enumerate}
Morphisms in $\mathcal{C}$ are given by systems of homomorphisms.

\begin{lemma}
\label{lemma-category-affine-over}
Let $S$ be a scheme. Let $X$ be an affine formal scheme over $S$.
Assume $X$ is McQuillan and let $A$ be the weakly admissible topological
ring associated to $X$. Then there is an anti-equivalence of categories
between
\begin{enumerate}
\item the category $\mathcal{C}$ introduced above, and
\item the category of maps $Y \to X$ of finite type of
affine formal algebraic spaces.
\end{enumerate}
\end{lemma}

\begin{proof}
Let $I_\lambda$ be a fundamental system of weakly admissible ideals
of definition in $A$. Then $Y \times_X \Spec(A/I_\lambda)$ is
affine (Formal Spaces, Definition \ref{formal-spaces-definition-finite-type}
and Lemma \ref{formal-spaces-lemma-affine-representable-by-algebraic-spaces}).
Say $Y \times_X \Spec(A/I_\lambda) = \Spec(B_\lambda)$.
Then $(B_\lambda)$ is an object of $\mathcal{C}$.
Conversely, given a system $(B_\lambda)$ we can set
$Y = \colim \Spec(B_\lambda)$. Some details omitted.
\end{proof}

\begin{remark}
\label{remark-finite-type}
Let $f : Y \to X$ be a morphism of affine formal algebraic spaces.
Suppose that $A$ is a weakly admissible topological ring and
$X = \text{Spf}(A)$, in other words, $X$ is McQuillan. Let $I_\lambda$ be a
fundamental system of weak ideals of definition, so that
$A = \lim A/I_\lambda$. Then a natural condition to consider is:
\begin{itemize}
\item[$(*)$] $Y = \text{Spf}(B)$ where $B$ is a weakly admissible
topological ring which is a quotient of the restricted power series ring
$A\{x_1, \ldots, x_n\}$ by a closed ideal.
\end{itemize}
On the other hand, if we only assume that $f$ is of finite type
then we get $Y = \colim \Spec(B_\lambda)$ where
$(B_\lambda)$ is an object of $\mathcal{C}$ by
Lemma \ref{lemma-category-affine-over}.
In this case it is true that there exists a fixed integer $r$ such
that $B_\lambda$ is generated by $r$ elements over $A/I_\lambda$ for
all $\lambda$ (hint: use
Algebra, Lemma \ref{algebra-lemma-surjective-mod-locally-nilpotent}).
However, it is not clear (and we think not true in general) that we can recover
$B_\lambda$ as the quotient of $B = \lim B_\lambda$ by $I_\lambda$
nor is it clear that $B$ is a quotient of $A\{x_1, \ldots, x_r\}$.
In particular, it is not clear that $Y$ is a McQuillan affine
formal algebraic space.
\end{remark}





\section{Algebras topologically of finite type}
\label{section-tft}

\noindent
Let $A$ be a pre-adic topological ring (see More on Algebra, Definition
\ref{more-algebra-definition-topological-ring}).
In the following sections we develop a bit of theory dealing with
algebras topologically of finite type over $A$.
Loosely speaking $B$ is topologically of finite type over $A$
if $A \to B$ is a continuous map of topological rings,
$B$ is $I$-adically complete where $I \subset A$ defines the topology
on $A$, and $B$ is a quotient of the restricted power series
ring $A\{x_1, \ldots, x_r\}$ (except that this only makes sense if
$A$ is complete by our conventions in the previous section).
We find the terminology ``topologically of finite type'' too awkward to use.
On the other hand, there does not seem to be
a good alternative name, so for the moment we will not give a name to
this property. If the ideal $I$ is finitely generated, then
algebras topologically of finite type over $A$ are the objects
of the category (\ref{equation-C-prime}) defined below.




\section{Two categories}
\label{section-two-categories}

\noindent
Let $A$ be a ring and let $I \subset A$ be an ideal.
In this section ${}^\wedge$ will mean $I$-adic completion.
Set $A_n = A/I^n$ so that the $I$-adic completion of $A$ is
$A^\wedge = \lim A_n$. Let $\mathcal{C}$ be the
category
\begin{equation}
\label{equation-C}
\mathcal{C} =
\left\{
\begin{matrix}
\text{systems }(B_n, B_{n + 1} \to B_n)_{n \in \mathbf{N}}\text{ where }\\
B_n\text{ is a finite type }A_n\text{-algebra,}\\
B_{n + 1} \to B_n\text{ is an }A_{n + 1}\text{-algebra map}\\
\text{which induces }B_{n + 1}/I^nB_{n + 1} \cong B_n
\end{matrix}
\right\}
\end{equation}
Morphisms in $\mathcal{C}$ are given by systems of homomorphisms.
Let $\mathcal{C}'$ be the category
\begin{equation}
\label{equation-C-prime}
\mathcal{C}' =
\left\{
\begin{matrix}
A\text{-algebras }B\text{ which are }I\text{-adically complete}\\
\text{such that }B/IB\text{ is of finite type over }A/I
\end{matrix}
\right\}
\end{equation}
Morphisms in $\mathcal{C}'$ are $A$-algebra maps. There is a functor
\begin{equation}
\label{equation-from-complete-to-systems}
\mathcal{C}' \longrightarrow \mathcal{C},\quad
B \longmapsto (B/I^nB)
\end{equation}
Indeed, since $B/IB$ is of finite type over $A/I$ the ring maps
$A_n = A/I^n \to B/I^nB$ are of finite type
(apply Algebra, Lemma \ref{algebra-lemma-NAK}
to a ring map $A/I^n[x_1, \ldots, x_r] \to B/I^nB$
such that the images of $x_1, \ldots, x_r$ generate $B/IB$
over $A/I$).

\begin{lemma}
\label{lemma-topologically-finite-type}
Let $A$ be a ring and let $I \subset A$ be a finitely generated ideal.
The functor
$$
\mathcal{C} \longrightarrow \mathcal{C}',\quad
(B_n) \longmapsto B = \lim B_n
$$
is a quasi-inverse to (\ref{equation-from-complete-to-systems}).
The completions $A[x_1, \ldots, x_r]^\wedge$ are in $\mathcal{C}'$ and
any object of $\mathcal{C}'$ is of the form
$$
B = A[x_1, \ldots, x_r]^\wedge / J
$$
for some ideal $J \subset A[x_1, \ldots, x_r]^\wedge$.
\end{lemma}

\begin{proof}
Let $(B_n)$ be an object of $\mathcal{C}$. By
Algebra, Lemma \ref{algebra-lemma-limit-complete}
we see that $B = \lim B_n$ is $I$-adically complete
and $B/I^nB = B_n$. Hence we see that $B$ is an object of
$\mathcal{C}'$ and that we can recover the object $(B_n)$ 
by taking the quotients.
Conversely, if $B$ is an object of $\mathcal{C}'$, then
$B = \lim B/I^nB$ by assumption. Thus $B \mapsto (B/I^nB)$ is a quasi-inverse
to the functor of the lemma.

\medskip\noindent
Since $A[x_1, \ldots, x_r]^\wedge = \lim A_n[x_1, \ldots, x_r]$
it is an object of $\mathcal{C}'$ by the first statement of the lemma.
Finally, let $B$ be an object of $\mathcal{C}'$. Choose
$b_1, \ldots, b_r \in B$ whose images in $B/IB$ generate
$B/IB$ as an algebra over $A/I$. Since $B$ is $I$-adically
complete, the $A$-algebra map $A[x_1, \ldots, x_r] \to B$, $x_i \mapsto b_i$
extends to an $A$-algebra map $A[x_1, \ldots, x_r]^\wedge \to B$.
To finish the proof we have to show this map is surjective
which follows from Algebra, Lemma \ref{algebra-lemma-completion-generalities}
as our map $A[x_1, \ldots, x_r] \to B$ is surjective modulo $I$
and as $B = B^\wedge$.
\end{proof}

\noindent
We warn the reader that, in case $A$ is not Noetherian, the
quotient of an object of $\mathcal{C}'$ may not be an object
of $\mathcal{C}'$. See Examples, Lemma
\ref{examples-lemma-noncomplete-quotient}.
Next we show this does not happen when $A$ is Noetherian.

\begin{lemma}
\label{lemma-topologically-finite-type-Noetherian}
\begin{reference}
\cite[Proposition 7.5.5]{EGA1}
\end{reference}
Let $A$ be a Noetherian ring and let $I \subset A$ be an ideal. Then
\begin{enumerate}
\item every object of the category $\mathcal{C}'$, in particular the
completion $A[x_1, \ldots, x_r]^\wedge$, is Noetherian,
\item if $B$ is an object of $\mathcal{C}'$ and $J \subset B$ is an
ideal, then $B/J$ is an object of $\mathcal{C}'$.
\end{enumerate}
\end{lemma}

\begin{proof}
To see (1) by Lemma \ref{lemma-topologically-finite-type}
we reduce to the case of the completion of the polynomial ring.
This case follows from
Algebra, Lemma \ref{algebra-lemma-completion-Noetherian-Noetherian}
as $A[x_1, \ldots, x_r]$ is Noetherian
(Algebra, Lemma \ref{algebra-lemma-Noetherian-permanence}).
Part (2) follows from Algebra, Lemma \ref{algebra-lemma-completion-tensor}
which tells us that ever finite $B$-module is
$IB$-adically complete.
\end{proof}

\begin{remark}[Base change]
\label{remark-base-change}
Let $\varphi : A_1 \to A_2$ be a ring map and let
$I_i \subset A_i$ be ideals such that $\varphi(I_1^c) \subset I_2$
for some $c \geq 1$. This induces ring maps
$A_{1, cn} = A_1/I_1^{cn} \to A_2/I_2^n = A_{2, n}$ for all $n \geq 1$.
Let $\mathcal{C}_i$ be the category (\ref{equation-C}) for $(A_i, I_i)$.
There is a base change functor
\begin{equation}
\label{equation-base-change-systems}
\mathcal{C}_1 \longrightarrow \mathcal{C}_2,\quad
(B_n) \longmapsto (B_{cn} \otimes_{A_{1, cn}} A_{2, n})
\end{equation}
Let $\mathcal{C}_i'$ be the category (\ref{equation-C-prime}) for $(A_i, I_i)$.
If $I_2$ is finitely generated, then there is a base change functor
\begin{equation}
\label{equation-base-change-complete}
\mathcal{C}_1' \longrightarrow \mathcal{C}_2',\quad
B \longmapsto (B \otimes_{A_1} A_2)^\wedge
\end{equation}
because in this case the completion is complete
(Algebra, Lemma \ref{algebra-lemma-hathat-finitely-generated}).
If both $I_1$ and $I_2$ are finitely generated, then
the two base change functors agree via the functors
(\ref{equation-from-complete-to-systems})
which are equivalences by Lemma \ref{lemma-topologically-finite-type}.
\end{remark}

\begin{remark}[Base change by closed immersion]
\label{remark-take-bar}
Let $A$ be a Noetherian ring and $I \subset A$ an ideal.
Let $\mathfrak a \subset A$ be an ideal. Denote $\bar A = A/\mathfrak a$.
Let $\bar I \subset \bar A$ be an ideal such that
$I^c \bar A \subset \bar I$ and $\bar I^d \subset I\bar A$
for some $c, d \geq 1$. In this case the base change functor
(\ref{equation-base-change-complete}) for $(A, I)$ to $(\bar A, \bar I)$
is given by $B \mapsto \bar B = B/\mathfrak aB$. Namely, we have
\begin{equation}
\label{equation-base-change-to-closed}
\bar B = (B \otimes_A \bar A)^\wedge = (B/\mathfrak a B)^\wedge =
B/\mathfrak a B
\end{equation}
the last equality because any finite $B$-module is $I$-adically complete by
Algebra, Lemma \ref{algebra-lemma-completion-tensor}
and if annihilated by $\mathfrak a$ also $\bar I$-adically complete by
Algebra, Lemma \ref{algebra-lemma-change-ideal-completion}.
\end{remark}







\section{A naive cotangent complex}
\label{section-naive-cotangent-complex}

\noindent
Let $A$ be a Noetherian ring and let $I \subset A$ be a ideal.
Let $B$ be an $A$-algebra which is $I$-adically complete such
that $A/I \to B/IB$ is of finite type, i.e., an object of
(\ref{equation-C-prime}).
By Lemma \ref{lemma-topologically-finite-type-Noetherian} we can write
$$
B = A[x_1, \ldots, x_r]^\wedge / J
$$
for some finitely generated ideal $J$. For a choice of presentation as
above we define the naive cotangent complex in this setting by the formula
\begin{equation}
\label{equation-NL}
\NL^\wedge_{B/A} = (J/J^2 \longrightarrow \bigoplus B\text{d}x_i)
\end{equation}
with terms sitting in degrees $-1$ and $0$
where the map sends the residue class of $g \in J$ to the differential
$\text{d}g = \sum (\partial g/\partial x_i) \text{d}x_i$. Here
the partial derivative is taken by thinking of $g$ as a power series.
The following lemma shows that $\NL^\wedge_{B/A}$ is well defined
in $D(B)$, i.e., independent of the chosen presentation, although this
could be shown directly by comparing presentations as in
Algebra, Section \ref{algebra-section-netherlander}.

\begin{lemma}
\label{lemma-NL-is-limit}
Let $A$ be a Noetherian ring and let $I \subset A$ be a ideal.
Let $B$ be an object of (\ref{equation-C-prime}). Then
$\NL^\wedge_{B/A} = R\lim \NL_{B_n/A_n}$ in $D(B)$.
\end{lemma}

\begin{proof}
In fact, the presentation $B = A[x_1, \ldots, x_r]^\wedge / J$
defines presentations
$$
B_n = B/I^nB = A_n[x_1, \ldots, x_r]/J_n
$$
where
$$
J_n = JA_n[x_1, \ldots, x_r] =
J/(J \cap I^nA[x_1, \ldots, x_r]^\wedge)
$$
By Artin-Rees (Algebra, Lemma \ref{algebra-lemma-Artin-Rees})
in the Noetherian ring $A[x_1, \ldots, x_r]^\wedge$
(Lemma \ref{lemma-topologically-finite-type-Noetherian})
we see that we have canonical surjections
$$
J/I^nJ \to J_n \to J/I^{n - c}J,\quad n \geq c
$$
for some $c \geq 0$.
It follows that $\lim J_n/J_n^2 = J/J^2$ as any finite
$A[x_1, \ldots, x_r]^\wedge$-module is $I$-adically complete
(Algebra, Lemma \ref{algebra-lemma-completion-tensor}).
Thus
$$
\NL^\wedge_{B/A} =
\lim (J_n/J_n^2 \longrightarrow \bigoplus B_n \text{d}x_i)
$$
(termwise limit)
and the transition maps in the system are termwise surjective.
The two term complex $J_n/J_n^2 \longrightarrow \bigoplus B_n \text{d}x_i$
represents $\NL_{B_n/A_n}$ by
Algebra, Section \ref{algebra-section-netherlander}.
It follows that $\NL^\wedge_{B/A}$ represents
$R\lim \NL_{B_n/A_n}$ in the derived category by
More on Algebra, Lemma \ref{more-algebra-lemma-compute-Rlim-modules}.
\end{proof}

\begin{lemma}
\label{lemma-exact-sequence-NL}
Let $A$ be a Noetherian ring and let $I \subset A$ be a ideal.
Let $B \to C$ be morphism of (\ref{equation-C-prime}). Then
there is an exact sequence
$$
\xymatrix{
C \otimes_B H^0(\NL^\wedge_{B/A}) \ar[r] &
H^0(\NL^\wedge_{C/A}) \ar[r] &
H^0(\NL^\wedge_{C/B}) \ar[r] & 0 \\
H^{-1}(\NL^\wedge_{B/A} \otimes_B C) \ar[r] &
H^{-1}(\NL^\wedge_{C/A}) \ar[r] &
H^{-1}(\NL^\wedge_{C/B}) \ar[llu]
}
$$
\end{lemma}

\begin{proof}
Choose a presentation $B = A[x_1, \ldots, x_r]^\wedge/J$.
Note that $(B, IB)$ is a pair consisting of a Noetherian ring
and an ideal, and $C$ is in the corresponding category (\ref{equation-C-prime})
for this pair. Hence we can choose a presentation
$C = B[y_1, \ldots, y_s]^\wedge/J'$. Combinging these presentations
gives a presentation
$$
C = A[x_1, \ldots, x_r, y_1, \ldots, y_s]^\wedge/K
$$
Then the reader verifies that we obtain a commutative diagram
$$
\xymatrix{
0 \ar[r] &
\bigoplus C \text{d}x_i \ar[r] &
\bigoplus C \text{d}x_i \oplus \bigoplus C \text{d}y_j \ar[r] &
\bigoplus C \text{d}y_j \ar[r] &
0 \\
&
J/J^2 \otimes_B C \ar[r] \ar[u] &
K/K^2 \ar[r] \ar[u] &
J'/(J')^2 \ar[r] \ar[u] &
0
}
$$
with exact rows. Note that the vertical arrow on the left hand side
is the tensor product of the arrow defining $\NL^\wedge_{B/A}$ with
$\text{id}_C$. The lemma follows by applying the snake lemma
(Algebra, Lemma \ref{algebra-lemma-snake}).
\end{proof}

\noindent
Maps in the derived category out of a complex such as (\ref{equation-NL})
are easy to understand by the result of the following lemma.

\begin{lemma}
\label{lemma-map-out-of-almost-free}
Let $R$ be a ring. Let $M^\bullet$ be a complex of modules over $R$
with $M^i = 0$ for $i > 0$ and $M^0$ a projective $R$-module.
Let $K^\bullet$ be a second complex.
\begin{enumerate}
\item If $K^i = 0$ for $i \leq -2$, then
$\Hom_{D(R)}(M^\bullet, K^\bullet) = \Hom_{K(R)}(M^\bullet, K^\bullet)$,
\item If $K^i = 0$ for $i \leq -3$ and
$\alpha \in \Hom_{D(R)}(M^\bullet, K^\bullet)$ composed with
$K^\bullet \to K^{-2}[2]$ comes from an $R$-module map
$a : M^{-2} \to K^{-2}$ with $a \circ d_M^{-3} = 0$, then
$\alpha$ can be represented by a map of complexes
$a^\bullet : M^\bullet \to K^\bullet$ with $a^{-2} = a$.
\item In (2) for any second map of complexes
$(a')^\bullet : M^\bullet \to K^\bullet$
representing $\alpha$ with $a = (a')^{-2}$
there exist $h' : M^0 \to K^{-1}$ and
$h : M^{-1} \to K^{-2}$ such that
$$
h \circ d_M^{-2} = 0, \quad
(a')^{-1} = a^{-1} + d_K^{-2} \circ h + h' \circ d_M^{-1},\quad
(a')^0 = a^0 + d_K^{-1} \circ h'
$$
\end{enumerate}
\end{lemma}

\begin{proof}
Set $F^0 = M^0$.
Choose a free $R$-module $F^{-1}$ and a surjection $F^{-1} \to M^{-1}$.
Choose a free $R$-module $F^{-2}$ and a surjection
$F^{-2} \to M^{-2} \times_{M^{-1}} F^{-1}$. Continuing in this
way we obtain a quasi-isomorphism $p^\bullet : F^\bullet \to M^\bullet$
which is termwise surjective and with $F^i$ free for all $i$.

\medskip\noindent
Proof of (1). By
Derived Categories, Lemma \ref{derived-lemma-morphisms-from-projective-complex}
we have
$$
\Hom_{D(R)}(M^\bullet, K^\bullet) = \Hom_{K(R)}(F^\bullet, K^\bullet)
$$
If $K^i = 0$ for $i \leq -2$, then any morphism of complexes
$F^\bullet \to K^\bullet$ factors through $p^\bullet$. Similarly, any
homotopy $\{h^i : F^i \to K^{i - 1}\}$ factors through $p^\bullet$.
Thus (1) holds.

\medskip\noindent
Proof of (2). Choose $b^\bullet : F^\bullet \to K^\bullet$ representing
$\alpha$. The composition of $\alpha$ with $K^\bullet \to K^{-2}[2]$ is
represented by $b^{-2} : F^{-2} \to K^{-2}$. As this is homotopic to
$a \circ p^{-2} : F^{-2} \to M^{-2} \to K^{-2}$, there is a map
$h : F^{-1} \to K^{-2}$ such that $b^{-2} = a \circ p^{-2} + h \circ d_F^{-2}$.
Adjusting $b^\bullet$ by $h$ viewed as a homotopy from $F^\bullet$
to $K^\bullet$, we find that $b^{-2} = a \circ p^{-2}$. Hence $b^{-2}$
factors through $p^{-2}$. Since $F^0 = M^0$ the kernel of $p^{-2}$
surjects onto the kernel of $p^{-1}$ (for example because the kernel
of $p^\bullet$ is an acyclic complex or by a diagram chase). Hence $b^{-1}$
necessarily factors through $p^{-1}$ as well and we see that (2)
holds for these factorizations and $a^0 = b^0$.

\medskip\noindent
Proof of (3) is omitted. Hint: There is a homotopy between
$a^\bullet \circ p^\bullet$ and $(a')^\bullet \circ p^\bullet$
and we argue as before that this homotopy factors through $p^\bullet$.
\end{proof}

\begin{lemma}
\label{lemma-zero-in-derived}
Let $R$ be a ring. Let $M^\bullet$ be a two term complex $M^{-1} \to M^0$
over $R$. If $\varphi, \psi \in \text{End}_{D(R)}(M^\bullet)$
are zero on $H^i(M^\bullet)$, then $\varphi \circ \psi = 0$.
\end{lemma}

\begin{proof}
Apply
Derived Categories, Lemma \ref{derived-lemma-trick-vanishing-composition}
to see that $\varphi \circ \psi$ factors through $\tau_{\leq -2}M^\bullet = 0$.
\end{proof}



\section{Rig-\'etale maps}
\label{section-rig-etale}

\noindent
In this and the following few sections we will study ring maps as
in Lemma \ref{lemma-equivalent-with-artin}. Condition
(\ref{item-condition-artin}) is one of the conditions used in
\cite{ArtinII} to define modifications. Ring maps like this are sometimes
called rig-\'etale ring maps in the literature. These and
the analogously defined rig-smooth ring maps were studied
in \cite{Elkik}. A detailed exposition can also be found in
\cite{Abbes}. Our main goal will be to show that rig-\'etale
ring maps are completions of finite type algebras, a result
very similar to results found in Elkik's paper \cite{Elkik}.

\begin{lemma}
\label{lemma-equivalent-with-artin}
Let $A$ be a Noetherian ring and let $I \subset A$ be an ideal.
Let $B$ be an object of (\ref{equation-C-prime}). The following are equivalent
\begin{enumerate}
\item
\label{item-zero-on-NL}
there exists a $c \geq 0$ such that multiplication by $a$
on $\NL^\wedge_{B/A}$ is zero in $D(B)$ for all $a \in I^c$,
\item
\label{item-zero-on-cohomology-NL}
there exits a $c \geq 0$ such that $H^i(\NL^\wedge_{B/A})$, $i = -1, 0$ is
annihilated by $I^c$,
\item
\label{item-zero-on-cohomology-NL-truncations}
there exists a $c \geq 0$ such that $H^i(\NL_{B_n/A_n})$, $i = -1, 0$ is
annihlated by $I^c$ for all $n \geq 1$,
\item
\label{item-condition-artin}
$B = A[x_1, \ldots, x_r]^\wedge/J$ and
for every $a \in I$ there exists a $c \geq 0$ such that
\begin{enumerate}
\item $a^c$ annihilates $H^0(\NL^\wedge_{B/A})$, and
\item there exist $f_1, \ldots, f_r \in J$ such that
$a^c J \subset (f_1, \ldots, f_r) + J^2$.
\end{enumerate}
\end{enumerate}
\end{lemma}

\begin{proof}
The equivalence of (1) and (2) follows from
Lemma \ref{lemma-zero-in-derived}.
The equivalence of (1) $+$ (2) and (3) follows from
Lemma \ref{lemma-NL-is-limit}. Some details omitted.

\medskip\noindent
Assume the equivalent conditions (1), (2), (3) holds and let
$B = A[x_1, \ldots, x_r]^\wedge/J$ be a presentation
(see Lemma \ref{lemma-topologically-finite-type}). Let $a \in I$.
Let $c$ be such that multplication by $a^c$ is zero on $\NL^\wedge_{B/A}$
which exists by (1). By Lemma \ref{lemma-map-out-of-almost-free}
there exists a map $\alpha : \bigoplus B\text{d}x_i \to J/J^2$ such that
$\text{d} \circ \alpha$ and $\alpha \circ \text{d}$ are both
multiplication by $a^c$. Let $f_i \in J$ be an element whose
class modulo $J^2$ is equal to $\alpha(\text{d}x_i)$.
Then we see that (\ref{item-condition-artin})(a), (b) hold.

\medskip\noindent
Assume (\ref{item-condition-artin}) holds. Say $I = (a_1, \ldots, a_t)$.
Let $c_i \geq 0$ be the integer such that (\ref{item-condition-artin})(a), (b)
hold for $a_i^{c_i}$. Then we see that $I^{\sum c_i}$ annihilates
$H^0(\NL^\wedge_{B/A})$. Let $f_{i, 1}, \ldots, f_{i, r} \in J$
be as in (\ref{item-condition-artin})(b) for $a_i$.
Consider the composition
$$
B^{\oplus r} \to J/J^2 \to \bigoplus B\text{d}x_i
$$
where the $j$th basis vector is mapped to the class of $f_{i, j}$ in $J/J^2$.
By (\ref{item-condition-artin})(a) and (b) the cokernel of the composition
is annihilated by $a_i^{2c_i}$. Thus this map is surjective after inverting
$a_i^{c_i}$, and hence an isomorphism (Algebra, Lemma \ref{algebra-lemma-fun}).
Thus the kernel of $B^{\oplus r} \to \bigoplus B\text{d}x_i$ is
$a_i$-power torsion, and hence
$H^{-1}(\NL^\wedge_{B/A}) = \Ker(J/J^2 \to \bigoplus B\text{d}x_i)$
is $a_i$-power torsion. Since $B$ is Noetherian
(Lemma \ref{lemma-topologically-finite-type-Noetherian}),
all modules including $H^{-1}(\NL^\wedge_{B/A})$ are finite.
Thus $a_i^{d_i}$ annihilates $H^{-1}(\NL^\wedge_{B/A})$ for some $d_i \geq 0$.
It follows that $I^{\sum d_i}$ annihilates $H^{-1}(\NL^\wedge_{B/A})$
and we see that (2) holds.
\end{proof}

\begin{lemma}
\label{lemma-rig-etale}
Let $A$ be a Noetherian ring and let $I$ be an ideal.
Let $B$ be a finite type $A$-algebra.
\begin{enumerate}
\item If $\Spec(B) \to \Spec(A)$ is \'etale over $\Spec(A) \setminus V(I)$,
then $B^\wedge$ satisfies the equivalent conditions of
Lemma \ref{lemma-equivalent-with-artin}.
\item If $B^\wedge$ satisfies the equivalent conditions of
Lemma \ref{lemma-equivalent-with-artin},
then there exists $g \in 1 + IB$ such that $\Spec(B_g)$ is \'etale
over $\Spec(A) \setminus V(I)$.
\end{enumerate}
\end{lemma}

\begin{proof}
Assume $B^\wedge$ satisfies the equivalent conditions of
Lemma \ref{lemma-equivalent-with-artin}.
The naive cotangent complex $\NL_{B/A}$ is a complex of finite type
$B$-modules and hence $H^{-1}$ and $H^0$ are finite $B$-modules.
Completion is an exact functor on finite $B$-modules (Algebra,
Lemma \ref{algebra-lemma-completion-flat}) and $\NL^\wedge_{B^\wedge/A}$
is the completion of the complex $\NL_{B/A}$ (this is easy to see
by choosing presentations).
Hence the assumption implies there exists a $c \geq 0$ such that
$H^{-1}/I^nH^{-1}$ and $H^0/I^nH^0$ are annihilated by $I^c$
for all $n$. By Nakayama's lemma (Algebra, Lemma \ref{algebra-lemma-NAK})
this means that $I^cH^{-1}$ and $I^cH^0$ are annihilated by an element
of the form $g = 1 + x$ with $x \in IB$. After inverting $g$
(which does not change the quotients $B/I^nB$)
we see that $\NL_{B/A}$ has cohomology annihilated by $I^c$. Thus
$A \to B$ is \'etale at any prime of $B$ not lying over $V(I)$
by the definition of \'etale ring maps, see
Algebra, Definition \ref{algebra-definition-etale}.

\medskip\noindent
Conversely, assume that $\Spec(B) \to \Spec(A)$ is \'etale over
$\Spec(A) \setminus V(I)$. Then for every $a \in I$ there exists
a $c \geq 0$ such that multiplication by $a^c$ is zero $\NL_{B/A}$.
Since $\NL^\wedge_{B^\wedge/A}$ is the derived completion of
$\NL_{B/A}$ (see Lemma \ref{lemma-NL-is-limit}) it follows that
$B^\wedge$ satisfies the equivalent conditions of
Lemma \ref{lemma-equivalent-with-artin}.
\end{proof}

\begin{lemma}
\label{lemma-zero-after-modding-out}
Assume the map $(A_1, I_1) \to (A_2, I_2)$ is as in
Remark \ref{remark-base-change} with $A_1$ and $A_2$ Noetherian.
Let $B_1$ be in (\ref{equation-C-prime}) for $(A_1, I_1)$.
Let $B_2$ be the base change of $B_1$.
If multiplication by $f_1 \in B_1$ on $\NL^\wedge_{B_1/A_1}$
is zero in $D(B_1)$, then multiplication by
the image $f_2 \in B_2$ on $\NL^\wedge_{B_2/A_2}$ is zero
in $D(B_2)$.
\end{lemma}

\begin{proof}
Choose a presentation $B_1 = A_1[x_1, \ldots, x_r]^\wedge/J_1$.
Since
$A_2/I_2^n[x_1, \ldots, x_r] =
A_1/I_1^{cn}[x_1, \ldots, x_r] \otimes_{A_1/I_1^{cn}} A_2/I_2^n$
we have
$$
A_2[x_1, \ldots, x_r]^\wedge =
(A_1[x_1, \ldots, x_r]^\wedge \otimes_{A_1} A_2)^\wedge
$$
where we use $I_2$-adic completion on both sides (but of course
$I_1$-adic completion for $A_1[x_1, \ldots, x_r]^\wedge$).
Set $J_2 = J_1 A_2[x_1, \ldots, x_r]^\wedge$. Arguing similarly
we get the presentation
\begin{align*}
B_2
& =
(B_1 \otimes_{A_1} A_2)^\wedge \\
& =
\lim \frac{A_1/I_1^{cn}[x_1, \ldots, x_r]}{J_1(A_1/I_1^{cn}[x_1, \ldots, x_r])}
\otimes_{A_1/I_1^{cn}} A_2/I_2^n \\
& =
\lim \frac{A_2/I_2^n[x_1, \ldots, x_r]}{J_2(A_2/I_2^n[x_1, \ldots, x_r])} \\
& =
A_2[x_1, \ldots, x_r]^\wedge/J_2
\end{align*}
for $B_2$ over $A_2$. Consider the commutative diagram
$$
\xymatrix{
\NL^\wedge_{B_1/A_1} : \ar[d] &
J_1/J_1^2 \ar[r]_-{\text{d}} \ar[d] & \bigoplus B_1\text{d}x_i \ar[d] \\
\NL^\wedge_{B_2/A_2} : &
J_2/J_2^2 \ar[r] & \bigoplus B_2\text{d}x_i
}
$$
The induced arrow $J_1/J_1^2 \otimes_{B_1} B_2 \to J_2/J_2^2$
is surjective because $J_2$ is generated by the image of $J_1$.
By Lemma \ref{lemma-map-out-of-almost-free}
there is a map $\alpha_1 : \bigoplus B\text{d}x_i \to J_1/J_1^2$
such that $f_1 \text{id}_{\bigoplus B_1\text{d}x_i} = \text{d} \circ \alpha_1$
and $f_1 \text{id}_{J_1/J_1^2} = \alpha_1 \circ \text{d}$. We define
$\alpha_2 : \bigoplus B_1\text{d}x_i \to J_2/J_2^2$
by mapping $\text{d}x_i$ to the image of $\alpha_1(\text{d}x_i)$
in $J_2/J_2^2$. Because the image of the vertical arrows
contains generators of the modules $J_2/J_2^2$ and $\bigoplus B_2 \text{d}x_i$
it follows that $\alpha_2$ also defines a homotopy between
multiplication by $f_2$ and the zero map.
\end{proof}

\begin{lemma}
\label{lemma-quotient-by-idempotent}
Let $A$ be a Noetherian ring and $I$ an ideal. Let $B$
be a finite type $A$-algebra. Let $B^\wedge \to C$ be a surjective
ring map with kernel $J$. If $J/J^2$ is annihilated by $I^c$
for some $c \geq 0$, then $C$ is isomorphic to the completion
of a finite type $A$-algebra.
\end{lemma}

\begin{proof}
Since $B^\wedge$ is Noetherian (Lemma
\ref{lemma-topologically-finite-type-Noetherian}),
we see that $J$ is a finitely generated
ideal. Hence we conclude from
Algebra, Lemma \ref{algebra-lemma-ideal-is-squared-union-connected}
that
$$
\Spec(C) \setminus V(IC) \longrightarrow \Spec(B^\wedge) \setminus V(IB^\wedge)
$$
is an open and closed immersion. Let
$V \subset \Spec(B^\wedge) \setminus V(IB^\wedge)$ be the complement
of the image viewed as an open and closed subscheme.
Let $Z \subset \Spec(B^\wedge)$ be the scheme
theoretic closure of $V$. Write $Z = \Spec(C')$. Then
$$
\Spec(C \times C') = \Spec(C) \amalg Z \longrightarrow \Spec(B^\wedge)
$$
is a finite morphism of schemes which is an isomorphism away from
$V(IB^\wedge)$. Hence the corresponding ring map $B^\wedge \to C \times C'$
is finite and becomes an isomorphism on inverting any element of $I$. By
More on Algebra, Proposition \ref{more-algebra-proposition-equivalence}
and Remark \ref{more-algebra-remark-formal-glueing-algebras}
applied to $B \to B^\wedge$ and the finitely generated ideal $IB$, we
conclude that $C \times C'$ is isomorphic to $D \otimes_B B^\wedge$
for some finite $B$-algebra $D$. (The reader can also prove this using
Pushouts of Spaces, Lemma \ref{spaces-pushouts-lemma-equivalence-on-affine}.)
Then $D/ID \cong C/IC \times C'/IC'$. Let $\overline{e} \in D/ID$
be the idempotent corresponding to the factor $C/IC$.
By More on Algebra, Lemma
\ref{more-algebra-lemma-lift-idempotent-upstairs} there exists an
\'etale ring map $B \to B'$ which induces an isomorphism
$B/IB \to B'/IB'$ such that $D' = D \otimes_B B'$ contains an
idempotent $e$ lifting $\overline{e}$. Since $C \times C'$
is $I$-adically complete the pair $(C \times C', IC \times IC')$
is henselian
(More on Algebra, Lemma \ref{more-algebra-lemma-complete-henselian}).
Thus we can factor the map $B \to C \times C'$ through $B'$.
DOing so we may replace $B$ by $B'$ and $D$ by $D'$. Then
we find that $D = D_e \times D_{1 - e} = D/(1 - e) \times D/(e)$
is a product of finite type $A$-algebras and the completion of the
first part is $C$ and the completion of the second part is $C'$.
\end{proof}

\begin{lemma}
\label{lemma-fully-faithful-etale-over-complement}
Let $A$ be a Noetherian ring. Let $I \subset A$ be an ideal.
Let $C, B$ be finite type $A$-algebras. Assume $\Spec(B) \to \Spec(A)$ is
\'etale over $\Spec(A) \setminus V(I)$. Then any $A$-algebra
map $B^\wedge \to C^\wedge$ of $I$-adic completions
comes from a unique $A$-algebra map
$$
B \longrightarrow C^h
$$
where $C^h$ is the henselization of the pair $(C, IC)$ as
in More on Algebra, Lemma \ref{more-algebra-lemma-henselization}.
Moreover, any $A$-algebra homomorphism $B \to C^h$ factors through
some \'etale $C$-algebra $C'$ such that $C/IC \to C'/IC'$ is an isomorphism.
\end{lemma}

\begin{proof}
Uniqueness follows from the fact that $C^h$ is a subring of
$C^\wedge$, see for example
More on Algebra, Lemma \ref{more-algebra-lemma-henselization-Noetherian-pair}.
The final assertion follows from the fact that $C^h$ is the filtered colimit
of these $C$-algebras $C'$, see proof of
More on Algebra, Lemma \ref{more-algebra-lemma-henselization}.
Having said this we now turn to the proof of existence.

\medskip\noindent
Let $\varphi : B^\wedge \to C^\wedge$ be the given map.
This defines a section
$$
\sigma : (B \otimes_A C)^\wedge \longrightarrow C^\wedge
$$
of the completion of the map $C \to B \otimes_A C$. We may
replace $(A, I, B, C, \varphi)$ by $(C, IC, B \otimes_A C, C, \sigma)$.
In this way we see that we may assume that $A = C$.

\medskip\noindent
Proof of existence in the case $A = C$. In this case the map
$\varphi : B^\wedge \to A^\wedge$ is necessarily surjective.
By Lemmas \ref{lemma-rig-etale} and \ref{lemma-exact-sequence-NL}
we see that the cohomology groups of
$\NL^\wedge_{A^\wedge/\!_\varphi B^\wedge}$
are annihilated by a power of $I$. Since $\varphi$ is surjective,
this implies that $\Ker(\varphi)/\Ker(\varphi)^2$ is annihilated
by a power of $I$. Hence $\varphi : B^\wedge \to A^\wedge$
is the completion of a finite type $B$-algebra $B \to D$, see
Lemma \ref{lemma-quotient-by-idempotent}. Hence $A \to D$ is
a finite type algebra map which induces an isomorphism
$A^\wedge \to D^\wedge$. By
Lemma \ref{lemma-rig-etale} we may replace $D$ by a localization
and assume that $A \to D$ is \'etale away from $V(I)$.
Since $A^\wedge \to D^\wedge$ is an isomorphism, we see that
$\Spec(D) \to \Spec(A)$ is also \'etale in a neighbourhood of $V(ID)$
(for example by
More on Morphisms, Lemma
\ref{more-morphisms-lemma-check-smoothness-on-infinitesimal-nbhds}).
Thus $\Spec(D) \to \Spec(A)$ is \'etale. Therefore $D$ maps to
$A^h$ and the lemma is proved.
\end{proof}










\section{Glueing rings along a principal ideal}
\label{section-approximation-principal}

\noindent
In this situation we prove some results about the categories
$\mathcal{C}$ and $\mathcal{C}'$ of
Section \ref{section-two-categories}
in case $A$ is a Noetherian ring and $I = (a)$ is a principal
ideal.

\begin{remark}[Linear approximation]
\label{remark-linear-approximation}
Let $A$ be a ring and $I \subset A$ be a finitely generated ideal.
Let $C$ be an $I$-adically complete $A$-algebra.
Let $\psi : A[x_1, \ldots, x_r]^\wedge \to C$ be a continuous
$A$-algebra map. Suppose given $\delta_i \in C$, $i = 1, \ldots, r$.
Then we can consider
$$
\psi' : A[x_1, \ldots, x_r]^\wedge \to C,\quad
x_i \longmapsto \psi(x_i) + \delta_i
$$
see Remark \ref{remark-universal-property}. Then we have
$$
\psi'(g) = \psi(g) + \sum \psi(\partial g/\partial x_i)\delta_i + \xi
$$
with error term $\xi \in (\delta_i\delta_j)$. This follows by
writing $g$ as a power series and working term by term. Convergence
is automatic as the coefficients of $g$ tend to zero.
Details omitted.
\end{remark}

\begin{lemma}
\label{lemma-get-morphism-nonzerodivisor}
Let $A$ be a Noetherian ring and $I = (a)$ a principal ideal.
Let $B$, $C$ be objects of (\ref{equation-C-prime}).
Let $c \geq 0$ be an integer such that
multiplication by $a^c$ on $\NL^\wedge_{B/A}$ is zero in $D(B)$.
Assume $a$ is a nonzerodivisor on $C$.
Let $n > 2c$. For any $A_n$-algebra map $\psi_n : B_n \to C_n$
there exists a morphism $\varphi : B \to C$ such
that $\psi_n \bmod a^{n - c} = \varphi \bmod a^{n - c}$.
\end{lemma}

\begin{proof}
Choose a presentation $B = A[x_1, \ldots, x_r]^\wedge/J$. Choose
a lift
$$
\psi : A[x_1, \ldots, x_r]^\wedge \to C
$$
of $\psi_n$. Then $\psi(J) \subset a^nC$ and $\psi(J^2) \subset a^{2n}C$
which determines a linear map
$$
J/J^2 \longrightarrow a^nC/a^{2n}C,\quad g \longmapsto \psi(g)
$$
By assumption and Lemma \ref{lemma-map-out-of-almost-free}
there is a $B$-module map
$\bigoplus B\text{d}x_i \to a^nC/a^{2n}C$,
$\text{d}x_i \mapsto \delta_i$ such that
$a^c \psi(g) = \sum \psi(\partial g/\partial x_i) \delta_i$
for all $g \in J$. Write $\delta_i = - a^c \delta'_i$ for some
$\delta'_i \in a^{n - c}C$. Since $a$ is a nonzerodivisor
on $C$ we see that $\psi(g) = - \sum \psi(\partial g/\partial x_i) \delta'_i$
in $C/a^{2n - c}C$.
Then we look at the map
$$
\psi' : A[x_1, \ldots, x_r]^\wedge \to C,\quad
x_i \longmapsto \psi(x_i) + \delta'_i
$$
A computation with power series (see Remark \ref{remark-linear-approximation})
shows that $\psi'(J) \subset a^{2n - 2c}C$. Since $n > 2c$
we see that $n' = 2n - 2c = n + (n - 2c) > n$. Thus we obtain a morphism
$\psi_{n'} : B_{n'} \to C_{n'}$ agreeing with $\psi_n$ modulo
$a^{n - c}$. Continuing in this fashion and taking a limit we
obtain the lemma.
\end{proof}

\begin{lemma}
\label{lemma-get-morphism-principal}
Let $A$ be a Noetherian ring and $I = (a)$ a principal ideal.
Let $B$, $C$ be objects of (\ref{equation-C-prime}).
Let $c \geq 0$ be an integer such that
multiplication by $a^c$ on $\NL^\wedge_{B/A}$ is zero in $D(B)$.
Let $d \geq 0$ be an integer such that
$C[a^\infty] \cap a^dC = 0$; such an integer always exists.
Let $n > \max(2c, c + d)$. For any $A_n$-algebra map $\psi_n : B_n \to C_n$
there exists a morphism $\varphi : B \to C$ of $\mathcal{C}'$ such
that $\psi_n \bmod a^{n - c} = \varphi \bmod a^{n - c}$.
\end{lemma}

\begin{proof}
Because $C$ is Noetherian we have $C[a^\infty] = C[a^e]$ for some
$e \geq 0$. By Artin-Rees there exists an integer $f$ such that
$a^nC \cap C[a^\infty] \subset a^{n - f}C[a^\infty]$ for all $n \geq f$.
Thus $d = e + f$ works.

\medskip\noindent
Let $C \to C'$ be the quotient of $C$ by $C[a^\infty]$. For $m > d$ the
diagram
$$
\xymatrix{
0 \ar[r] &
C[a^\infty] \ar[r] \ar[d] &
C \ar[r] \ar[d] & C' \ar[r] \ar[d] & 0 \\
0 \ar[r] &
C[a^\infty] \ar[r] &
C/a^m C \ar[r] & C'/a^m C' \ar[r] & 0
}
$$
has exact rows. Thus $C$ is the fibre product of $C'$ and
$C_m$ over $C'_m$. Thus the lemma now follows formally from
the lifting result of Lemma \ref{lemma-get-morphism-nonzerodivisor}.
\end{proof}

\begin{lemma}
\label{lemma-approximate-principal}
\begin{reference}
The rig-\'etale case of \cite[III Theorem 7]{Elkik}
which handles the rig-smooth case.
\end{reference}
Let $A$ be a Noetherian ring and $I = (a)$ a principal ideal.
Let $B$ be an object of (\ref{equation-C-prime}).
Let $c \geq 0$ be an integer such that
multiplication by $a^c$ on $\NL^\wedge_{B/A}$ is zero in $D(B)$.
Then there exists a finite type $A$-algebra $C$ and an
isomorphism $B \cong C^\wedge$.
\end{lemma}

\begin{proof}
Choose a presentation $B = A[x_1, \ldots, x_r]^\wedge/J$.
By Lemma \ref{lemma-map-out-of-almost-free} we can find a map
$\alpha : \bigoplus B\text{d}x_i \to J/J^2$ such that
$\text{d} \circ \alpha$ and $\alpha \circ \text{d}$ are both
multiplication by $a^c$. Pick an element $f_i \in J$ whose
class modulo $J^2$ is equal to $\alpha(\text{d}x_i)$.
Then we see that $\text{d}f_i = a^c \text{d}x_i$ in $\bigoplus \text{d}x_i$.
In particular we have a ring map
$$
A[x_1, \ldots, x_r]^\wedge/
(f_1, \ldots, f_r, \Delta(f_1, \ldots, f_r) - a^{rc})
\longrightarrow B
$$
where $\Delta(f_1, \ldots, f_r) \in A[x_1, \ldots, x_r]^\wedge$
is the determinant of the matrix of partial derivatives of the $f_i$.

\medskip\noindent
Pick a large integer $N$. Pick $F_1, \ldots, F_r \in A[x_1, \ldots, x_r]$
such that $F_i - f_i \in I^NA[x_1, \ldots, x_r]^\wedge$. Set
$$
C = A[x_1, \ldots, x_r, z]/
(F_1, \ldots, F_r, z\Delta(F_1, \ldots, F_r) - a^{rc})
$$
We claim that multplication by $a^{2rc}$ is zero on $\NL_{C/A}$ in $D(C)$.
Namely, the determinant of the matrix of the partial derivatives
of the $r + 1$ generators of the ideal of $C$ with respect to the variables
$x_1, \ldots, x_{r + 1}, z$ is $\Delta(F_1, \ldots, F_r)^2$. Since
$\Delta(F_1, \ldots, F_r)$ divides $a^{rc}$ we in $C$ the
claim follows for example from
Algebra, Lemma \ref{algebra-lemma-matrix-left-inverse}.
Let $C^\wedge$ be the $I$-adic completion of $C$. Since
$\NL^\wedge_{C^\wedge/A}$ is the $I$-adic completion of $\NL_{C/A}$
we conclude that multiplication by $a^{2rc}$ is zero on
$\NL^\wedge_{C^\wedge/A}$ as well.

\medskip\noindent
By construction there is a (surjective) map $\psi_N : C/I^NC \to B/I^NB$
sending $x_i$ to $x_i$ and $z$ to $1$. By
Lemma \ref{lemma-get-morphism-principal} (with the roles of $B$ and $C$
reversed) for $N$ large enough we get a map $\varphi : C^\wedge \to B$ which
agrees with $\psi_N$ modulo $I^{N - 2rc}$.

\medskip\noindent
Since $\varphi : C^\wedge \to B$ is surjective modulo $I$ we see that it is
surjective (for example use
Algebra, Lemma \ref{algebra-lemma-completion-generalities}).
By construction and assumption the naive cotangent complexes
$\NL^\wedge_{C^\wedge/A}$ and $\NL^\wedge_{B/A}$
have cohomology annihilated by a fixed power of $a$. Thus the same thing
is true for $\NL^\wedge_{B/C^\wedge}$ by Lemma \ref{lemma-exact-sequence-NL}.
Since $\varphi$ is surjective we conclude that
$\Ker(\varphi)/\Ker(\varphi)^2$ is annihilated by a power of $a$.
The result of the lemma now follows from
Lemma \ref{lemma-quotient-by-idempotent}.
\end{proof}









\section{Glueing rings along an ideal}
\label{section-approximation}

\noindent
Let $A$ be a Noetherian ring. Let $I \subset A$ be an ideal.
In this section we study $I$-adically complete $A$-algebras
which are, in some vague sense, \'etale over the complement of
$V(I)$ in $\Spec(A)$.

\begin{lemma}
\label{lemma-get-morphism-general}
Let $A$ be a Noetherian ring. Let $I \subset A$ be an ideal.
Let $t$ be the minimal number of generators for $I$.
Let $C$ be an object of (\ref{equation-C-prime}).
There exists an integer $d \geq 0$ depending only on
$I \subset A \to C$ with the following property: given
\begin{enumerate}
\item $c \geq 0$ and $B$ in (\ref{equation-C-prime}) such that for $a \in I^c$
multiplication by $a$ on $\NL^\wedge_{B/A}$ is zero in $D(B)$,
\item an integer $n > 2t\max(c, d)$,
\item an $A_n$-algebra map $\psi_n : B_n \to C_n$,
\end{enumerate}
there exists a morphism $\varphi : B \to C$ of (\ref{equation-C-prime}) such
that $\psi_n \bmod I^{m - c} = \varphi \bmod I^{m - c}$
with $m = \lfloor \frac{n}{t} \rfloor$.
\end{lemma}

\begin{proof}
We prove this lemma by induction on the number of generators of $I$.
Say $I = (a_1, \ldots, a_t)$. If $t = 0$, then $I = 0$ and there
is nothing to prove. If $t = 1$, then the lemma follows from
Lemma \ref{lemma-get-morphism-principal} because
$2\max(c, d) \geq \max(2c, c + d)$. Assume $t > 1$.

\medskip\noindent
Set $m = \lfloor \frac{n}{t} \rfloor$ as in the lemma.
Set $\bar A = A/(a_t^m)$. Consider the ideal
$\bar I = (\bar a_1, \ldots, \bar a_{t - 1})$ in $\bar A$.
Let $\bar C = C/(a_t^m)$ be the base change of $C$ for the
map $(A, I) \to (\bar A, \bar I)$, see (\ref{equation-base-change-to-closed}).
Let $\bar d$ be the integer for $\bar I \subset \bar A \to \bar C$
which exists by induction hypothesis.

\medskip\noindent
Let $d_1 \geq 0$ be the integer found in
Lemma \ref{lemma-get-morphism-principal} for the ring $B$
and the element $a_t \in A$.

\medskip\noindent
We claim the lemma holds with $d = \max(\bar d, d_1)$.
To see this, let $c, B, n, \psi_n$ be as in the lemma.

\medskip\noindent
Note that $\bar I \subset I\bar A$. Hence by
Lemma \ref{lemma-zero-after-modding-out}
multiplication by an element of $\bar I^c$
on the cotangent complex of $\bar B = B/(a_t^m)$
is zero in $D(\bar B)$. Also, we have
$$
\bar I^{n - m + 1} \supset I^n \bar A
$$
Thus $\psi_n$ gives rise to a map
$$
\bar \psi_{n - m + 1} : \bar B_{n - m + 1} \to \bar C_{n - m + 1}
$$
Since $n > 2t\max(c, d)$ and $d \geq \bar d$ we see that
$$
n - m + 1 \geq (t - 1)n/t > 2(t - 1)\max(c, d) \geq 2(t - 1)\max(c, \bar d)
$$
Hence we can find a morphism $\varphi_m : \bar B \to \bar C$
agreeing with $\bar \psi_{n - m + 1}$ modulo the ideal
$\bar I^{m' - c}$ where $m' = \lfloor \frac{n - m + 1}{t - 1} \rfloor$.

\medskip\noindent
Since $m \geq n/t > 2\max(c, d) \geq 2\max(c, d_1) \geq \max(2c, c+ d_1)$,
we can apply Lemma \ref{lemma-get-morphism-principal} for
the ring map $A \to B$ and the ideal $(a_t)$ to
find a morphism $\varphi : B \to C$ agreeing modulo
$a_t^{m - c}$ with $\varphi_m$.

\medskip\noindent
All in all we find $\varphi : B \to C$ which agrees with
$\psi_n$ modulo
$$
(a_t^{m - c}) + (a_1, \ldots, a_{t - 1})^{m' - c}
\subset I^{\min(m - c, m' - c)}
$$
We leave it to the reader to see that
$\min(m - c, m' - c) = m - c$. This concludes the proof.
\end{proof}

\begin{lemma}
\label{lemma-lift-approximation}
Let $A$ be a Noetherian ring and $I \subset A$ an ideal.
Let $J \subset A$ be a nilpotent ideal. Consider a diagram
$$
\xymatrix{
C \ar[r] & C/JC \\
& B_0 \ar[u] \\
A \ar[r] \ar[uu] & A/J \ar[u]
}
$$
whose vertical arrows are of finite type such that
\begin{enumerate}
\item $\Spec(C) \to \Spec(A)$ is \'etale over $\Spec(A) \setminus V(I)$,
\item $\Spec(B_0) \to \Spec(A/J)$ is \'etale over
$\Spec(A/J) \setminus V((I + J)/J)$, and
\item $B_0 \to C/JC$ is \'etale and induces an isomorphism
$B_0/IB_0 = C/(I + J)C$.
\end{enumerate}
Then we can fill in the diagram
$$
\xymatrix{
C \ar[r] & C/JC \\
B \ar[u] \ar[r] & B_0 \ar[u] \\
A \ar[r] \ar[u] & A/J \ar[u]
}
$$
with $A \to B$ of finite type, $B/JB = B_0$, $B \to C$ \'etale, and
$\Spec(B) \to \Spec(A)$ \'etale over $\Spec(A) \setminus V(I)$.
\end{lemma}

\begin{proof}
By induction on the smallest $n$ such that $J^n = 0$ we reduce
to the case $J^2 = 0$. Denote by a subscript zero the base change
of objects to $A_0 = A/J$. Since $J^2 = 0$ we see that $JC$
is a $C_0$-module.

\medskip\noindent
Consider the canonical map
$$
\gamma : J \otimes_{A_0} C_0 \longrightarrow JC
$$
Since $\Spec(C) \to \Spec(A)$ is \'etale over the complement
of $V(I)$ (and hence flat) we see that $\gamma$ is an isomorphism
away from $V(IC_0)$, see
More on Morphisms, Lemma \ref{more-morphisms-lemma-deform}.
In particular, the kernel and cokernel of $\gamma$ are annihilated by
a power of $I$ (use that $C_0$ is Noetherian and that the modules in
question are finite). Observe that $J \otimes_{A_0} C_0 =
(J \otimes_{A_0} B_0) \otimes_{B_0} C_0$. Hence by
More on Algebra, Lemma \ref{more-algebra-lemma-application-formal-glueing}
there exists a unique $B_0$-module homomorphism
$$
c : J \otimes_{A_0} B_0 \to N
$$
with $c \otimes \text{id}_{C_0} = \gamma$ and $\Ker(\gamma) = \Ker(c)$
and $\Coker(\gamma) = \Coker(c)$. Moreover, $N$ is a finite $B_0$-module, see
More on Algebra, Remark \ref{more-algebra-remark-formal-glueing-algebras}.

\medskip\noindent
Choose a presentation $B_0 = A[x_1, \ldots, x_r]/K$. To construct $B$
we try to find the dotted arrow $m$ fitting into the following
pushout diagram
$$
\xymatrix{
0 \ar[r] & N \ar@{..>}[r] & B \ar@{..>}[r] & B_0 \ar[r] & 0 \\
0 \ar[r] & K/K^2 \ar[r] \ar@{..>}[u]_m &
A[x_1, \ldots, x_r]/K^2 \ar[r] \ar@{..>}[u] &
A[x_1, \ldots, x_r]/K \ar@{=}[u] \ar[r] & 0 \\
& J \otimes_{A_0} B_0 \ar[u] \ar@/^2pc/[uu] |!{[lu];[u]}\hole
}
$$
where the curved arrow is the map $c$ constructed above and the
map $J \otimes_{A_0} B_0 \to K/K^2$ is the obvious one.

\medskip\noindent
As $B_0 \to C_0$ is \'etale we can write
$C_0 = B_0[y_1, \ldots, y_r]/(g_{0, 1}, \ldots, g_{0, r})$
such that the determinant of the partial derivatives of the $g_{0, j}$
is invertible in $C_0$, see
Algebra, Lemma \ref{algebra-lemma-etale-standard-smooth}.
We combine this with the chosen presentation of $B_0$ to
get a presentation $C_0 = A[x_1, \ldots, x_r, y_1, \ldots, y_s]/L$.
Choose a lift $\psi : A[x_i, y_j] \to C$
of the map to $C_0$. Then it is the case that $C$ fits into the diagram
$$
\xymatrix{
0 \ar[r] & JC \ar[r] & C \ar[r] & C_0 \ar[r] & 0 \\
0 \ar[r] & L/L^2 \ar[r] \ar[u]_\mu &
A[x_i, y_j]/L^2 \ar[r] \ar[u] &
A[x_i, y_j]/L \ar@{=}[u] \ar[r] & 0 \\
& J \otimes_{A_0} C_0 \ar[u] \ar@/^2pc/[uu] |!{[lu];[u]}\hole
}
$$
where the curved arrow is the map $\gamma$ constructed above and the
map $J \otimes_{A_0} C_0 \to L/L^2$ is the obvious one.
By our choice of presentations and the fact that $C_0$ is
a complete intersection over $B_0$ we have
$$
L/L^2 = K/K^2 \otimes_{B_0} C_0 \oplus \bigoplus C_0 g_j
$$
where $g_j \in L$ is any lift of $g_{0, j}$, see
More on Algebra, Lemma \ref{more-algebra-lemma-transitive-lci-at-end}.

\medskip\noindent
Consider the three term complex
$$
K^\bullet : J \otimes_{A_0} B_0 \to K/K^2 \to \bigoplus B_0 \text{d}x_i
$$
where the second arrow is the differential in the naive cotangent
complex of $B_0$ over $A$ for the given presentation and the last
term is placed in degree $0$. Since
$\Spec(B_0) \to \Spec(A_0)$ is \'etale away from $V(I)$
the cohomology modules of this complex are supported on
$V(IB_0)$. Namely, for $a \in I$ after inverting $a$
we can apply 
More on Algebra, Lemma \ref{more-algebra-lemma-transitive-lci-at-end}
for the ring maps $A_a \to A_{0, a} \to B_{0, a}$
and use that $\NL_{A_{0, a}/A_a} = J_a$ and
$\NL_{B_{0, a}/A_{0, a}} = 0$ (some details omitted).
Hence these cohomology groups are annihilated by a power of $I$.

\medskip\noindent
Similarly, consider the three term complex
$$
L^\bullet : J \otimes_{A_0} C_0 \to L/L^2 \to
\bigoplus C_0 \text{d}x_i \oplus \bigoplus C_0 \text{d}y_j
$$
By our direct sum decomposition of $L/L^2$ above and the fact
that the the determinant of the partial derivatives of the $g_{0, j}$
is invertible in $C_0$ we see that the natural map
$K^\bullet \to L^\bullet$ induces a quasi-isomorphism
$$
K^\bullet \otimes_{B_0} C_0 \longrightarrow L^\bullet
$$
Applying
Dualizing Complexes, Lemma \ref{dualizing-lemma-neighbourhood-extensions}
we find that
\begin{equation}
\label{equation-go-down}
\Hom_{D(B_0)}(K^\bullet, E) =
\Hom_{D(C_0)}(L^\bullet, E \otimes_{B_0} C_0)
\end{equation}
for any object $E \in D(B_0)$.

\medskip\noindent
The maps $\text{id}_{J \otimes_{A_0} C_0}$ and $\mu$ define
an element in
$$
\Hom_{D(C_0)}(L^\bullet, (J \otimes_{A_0} C_0 \to  JC))
$$
(the target two term complex is placed in degree $-2$ and $-1$)
such that the composition with the map to $J \otimes_{A_0} C_0[2]$
is the element in $\Hom_{D(C_0)}(L^\bullet, J \otimes_{A_0} C_0[2])$
corresponding to $\text{id}_{J \otimes_{A_0} C_0}$. Picture
$$
\xymatrix{
J \otimes_{A_0} C_0 \ar[r] \ar[d]_{\text{id}_{J \otimes_{A_0} C_0}} &
L/L^2 \ar[r] \ar[d]^\mu &
\bigoplus C_0 \text{d}x_i \oplus \bigoplus C_0 \text{d}y_j \\
J \otimes_{A_0} C_0 \ar[r]^-\gamma &
JC
}
$$
Applying (\ref{equation-go-down}) we obtain a unique element
$$
\xi \in \Hom_{D(B_0)}(K^\bullet, (J \otimes_{A_0} B_0 \to N))
$$
Its composition with the map to $J \otimes_{A_0} B_0[2]$
is the element in $\Hom_{D(C_0)}(K^\bullet, J \otimes_{A_0} B_0[2])$
corresponding to $\text{id}_{J \otimes_{A_0} B_0}$. By
Lemma \ref{lemma-map-out-of-almost-free}
we can find a map of complexes $K^\bullet \to (J \otimes_{A_0} B_0 \to N)$
representing $\xi$ and equal to $\text{id}_{J \otimes_{A_0} B_0}$
in degree $-2$. Denote $m : K/K^2 \to N$ the degree $-1$ part
of this map. Picture
$$
\xymatrix{
J \otimes_{A_0} B_0 \ar[r] \ar[d]_{\text{id}_{J \otimes_{A_0} B_0}} &
K/K^2 \ar[r] \ar[d]^m &
\bigoplus B_0 \text{d}x_i \\
J \otimes_{A_0} B_0 \ar[r]^-c &
N
}
$$
Thus we can use $m$ to create an algebra $B$ by push out as
explained above. However, we may still have to change $m$ a bit to
make sure that $B$ maps to $C$ in the correct manner.

\medskip\noindent
Denote $m \otimes \text{id}_{C_0} \oplus 0 : L/L^2 \to JC$
the map coming from the direct sum decomposition of $L/L^2$
(see above), using that $N \otimes_{B_0} C_0 = JC$, and using $0$
on the second factor. By our choice of $m$ above the maps of complexes
$(\text{id}_{J \otimes_{A_0} C_0}, \mu, 0)$ and
$(\text{id}_{J \otimes_{A_0} C_0}, m \otimes \text{id}_{C_0} \oplus 0, 0)$
define the same element of
$\Hom_{D(C_0)}(L^\bullet, (J \otimes_{A_0} C_0 \to  JC))$.
By Lemma \ref{lemma-map-out-of-almost-free} there exist maps
$h : L^{-1} \to J \otimes_{A_0} C_0$ and $h' : L^0 \to JC$
which define a homotopy between
$(\text{id}_{J \otimes_{A_0} C_0}, \mu, 0)$ and
$(\text{id}_{J \otimes_{A_0} C_0}, m \otimes \text{id}_{C_0} \oplus 0, 0)$.
Picture
$$
\xymatrix{
J \otimes_{A_0} C_0 \ar[r] \ar[d]_{\text{id}_{J \otimes_{A_0} C_0}} &
K/K^2 \otimes_{B_0} C_0 \oplus \bigoplus C_0 g_j \ar@{..>}[ld]_h
\ar[r] \ar@<-1ex>[d]_\mu \ar[d]^{m \otimes \text{id}_{C_0} \oplus 0} &
\bigoplus C_0 \text{d}x_i \oplus \bigoplus C_0 \text{d}y_j \ar@{..>}[ld]_{h'}\\
J \otimes_{A_0} C_0 \ar[r]^-\gamma &
JC
}
$$
Since $h$ precomposed with $d_L^{-2}$ is zero it defines
an element in $\Hom_{D(C_0)}(L^\bullet, J \otimes_{A_0} C_0[1])$
which comes from a unique element $\chi$ of
$\Hom_{D(B_0)}(K^\bullet, J \otimes_{A_0} B_0[1])$
by (\ref{equation-go-down}).
Applying Lemma \ref{lemma-map-out-of-almost-free} again we represent $\chi$
by a map $g : K/K^2 \to J \otimes_{A_0} B_0$.
Then the base change $g \otimes \text{id}_{C_0}$ and $h$ differ
by a homotopy $h'' : L^0 \to J \otimes_{A_0} C$.
Hence if we modify $m$ into $m + c \circ g$, then
we find that $m \otimes \text{id}_{C_0} \oplus 0$ and $\mu$ just differ by
a map $h' : L^0 \to JC$.

\medskip\noindent
Changing our choice of the map $\psi : A[x_i, y_j] \to C$
by sending $x_i$ to $\psi(x_i) + h'(\text{d}x_i)$ and sending
$y_j$ to $\psi(y_j) + h'(\text{d}y_j)$, we find a commutative
diagram
$$
\xymatrix{
N \ar[r] & JC \\
K/K^2 \ar[r] \ar[u]_m & L/L^2 \ar[u]_\mu \\
J \otimes_{A_0} B_0 \ar[u] \ar@/^2pc/[uu]^c \ar[r] &
J \otimes_{A_0} C_0 \ar[u] \ar@/_2pc/[uu]_\gamma
}
$$
At this point we can define $B$ as the pushout in the first
commutative diagram of the proof. The commutativity of the
diagram just displayed, shows that there is an $A$-algebra
map $B \to C$ compatible with the given map $N = JB \to JC$.
As $N \otimes_{B_0} C_0 = JC$ it follows from
More on Morphisms, Lemma \ref{more-morphisms-lemma-deform}
that $B \to C$ is flat.
From this it easily follows that it is \'etale.
We omit the proof of the other properties as they are mostly
self evident at this point.
\end{proof}

\begin{lemma}
\label{lemma-approximate}
Let $A$ be a Noetherian ring. Let $I \subset A$ be an ideal.
Let $B$ be an object of (\ref{equation-C-prime}).
Assume there is an integer $c \geq 0$ such that for $a \in I^c$
multiplication by $a$ on $\NL^\wedge_{B/A}$ is zero in $D(B)$.
Then there exists a finite type $A$-algebra $C$ and an
isomorphism $B \cong C^\wedge$.
\end{lemma}

\noindent
In Section \ref{section-over-G-ring} we will give a simpler
proof of this result in case $A$ is a G-ring.

\begin{proof}
We prove this lemma by induction on the number of generators of $I$.
Say $I = (a_1, \ldots, a_t)$. If $t = 0$, then $I = 0$ and there
is nothing to prove. If $t = 1$, then the lemma follows from
Lemma \ref{lemma-approximate-principal}. Assume $t > 1$.

\medskip\noindent
For any $m \geq 1$ set $\bar A_m = A/(a_t^m)$. Consider the ideal
$\bar I_m = (\bar a_1, \ldots, \bar a_{t - 1})$ in $\bar A_m$.
Let $B_m = B/(a_t^m)$ be the base change of $B$ for the
map $(A, I) \to (\bar A_m, \bar I_m)$, see
(\ref{equation-base-change-to-closed}).
By Lemma \ref{lemma-zero-after-modding-out}
the assumption of the lemma holds for
$\bar I_m \subset \bar A_m \to B_m$.

\medskip\noindent
By induction hypothesis (on $t$) we can find a finite type
$\bar A_m$-algebra $C_m$ and a map $C_m \to B_m$ which induces an
isomorphism $C_m^\wedge \cong B_m$
where the completion is with respect to $\bar I_m$.
By Lemma \ref{lemma-rig-etale} we may assume that
$\Spec(C_m) \to \Spec(\bar A_m)$ is \'etale
over $\Spec(\bar A_m) \setminus V(\bar I_m)$.

\medskip\noindent
We claim that we may choose $A_m \to C_m \to B_m$ as in the previous
paragraph such that moreover there are isomorphisms
$C_m/(a_t^{m - 1}) \to C_{m - 1}$ compatible with the given
$A$-algebra structure and the maps to $B_{m - 1} = B_m/(a_t^{m - 1})$.
Namely, first fix a choice of $A_1 \to C_1 \to B_1$.
Suppose we have found $C_{m - 1} \to C_{m - 2} \to \ldots \to C_1$
with the desired properties.
Note that $C_m/(a_t^{m - 1})$ is \'etale over
$\Spec(\bar A_{m - 1}) \setminus V(\bar I_{m - 1})$.
Hence by Lemma \ref{lemma-fully-faithful-etale-over-complement}
there exists an \'etale extension $C_{m - 1} \to C'_{m - 1}$
which induces an isomorphism modulo $\bar I_{m - 1}$ and an
$\bar A_{m - 1}$-algebra map $C_m/(a_t^{m - 1}) \to C'_{m - 1}$
inducing the isomorphism $B_m/(a_t^{m - 1}) \to B_{m - 1}$ on completions.
Note that $C_m/(a_t^{m - 1}) \to C'_{m - 1}$ is \'etale over the complement
of $V(\bar I_{m - 1})$ by
Morphisms, Lemma \ref{morphisms-lemma-etale-permanence}
and over $V(\bar I_{m - 1})$ induces an isomorphism on completions
hence is \'etale there too (for example by More on Morphisms, Lemma
\ref{more-morphisms-lemma-check-smoothness-on-infinitesimal-nbhds}).
Thus $C_m/(a_t^{m - 1}) \to C'_{m - 1}$ is \'etale. By the
topological invariance of \'etale morphisms
(\'Etale Morphisms, Theorem \ref{etale-theorem-remarkable-equivalence})
there exists an \'etale ring map $C_m \to C'_m$ such that
$C_m/(a_t^{m - 1}) \to C'_{m - 1}$ is isomorphic to
$C_m/(a_t^{m - 1}) \to C'_m/(a_t^{m - 1})$. Observe that the
$\bar I_m$-adic completion of $C'_m$ is equal to the $\bar I_m$-adic
completion of $C_m$, i.e., to $B_m$ (details omitted).
We apply Lemma \ref{lemma-lift-approximation} to the diagram
$$
\xymatrix{
 & C'_m \ar[r] & C'_m/(a_t^{m - 1}) \\
C''_m \ar@{..>}[ru] \ar@{..>}[rr] & & C_{m - 1} \ar[u] \\
 & \bar A_m \ar[r] \ar[uu] \ar@{..>}[lu] & \bar A_{m - 1} \ar[u]
}
$$
to see that there exists a ``lift'' of $C''_m$ of $C_{m - 1}$
to an algebra over $\bar A_m$ with all the desired properties.

\medskip\noindent
By construction $(C_m)$ is an object of the category
(\ref{equation-C}) for the principal ideal $(a_t)$.
Thus the inverse limit $B' = \lim C_m$ is an $(a_t)$-adically
complete $A$-algebra such that $B'/a_t B'$ is of finite type
over $A/(a_t)$, see Lemma \ref{lemma-topologically-finite-type}.
By construction the $I$-adic completion of $B'$ is isomorphic to $B$
(details omitted). Consider the complex $\NL^\wedge_{B'/A}$ constructed
using the $(a_t)$-adic topology. Choosing a presentation for $B'$
(which induces a similar presentation for $B$) the reader immediately
sees that $\NL^\wedge_{B'/A} \otimes_{B'} B = \NL^\wedge_{B/A}$.
Since $a_t \in I$ and since the cohomology modules of
$\NL^\wedge_{B'/A}$ are finite $B'$-modules (hence complete for the
$a_t$-adic topology), we conclude that $a_t^c$ acts as zero on
these cohomologies as the same thing is true by assumption for
$\NL^\wedge_{B/A}$. Thus multiplication by $a_t^{2c}$ is zero
on $\NL^\wedge_{B'/A}$ by Lemma \ref{lemma-zero-in-derived}.
Hence finally, we may apply Lemma \ref{lemma-approximate-principal}
to $(a_t) \subset A \to B'$ to finish the proof.
\end{proof}

\begin{lemma}
\label{lemma-approximate-by-etale-over-complement}
Let $A$ be a Noetherian ring. Let $I \subset A$ be an ideal.
Let $B$ be an $I$-adically complete $A$-algebra with $A/I \to B/IB$
of finite type. The equivalent conditions of
Lemma \ref{lemma-equivalent-with-artin} are also equivalent to
\begin{enumerate}
\item[(5)]
\label{item-algebraize}
there exists a finite type $A$-algebra $C$ with
$\Spec(C) \to \Spec(A)$ is \'etale over $\Spec(A) \setminus V(I)$
such that $B \cong C^\wedge$.
\end{enumerate}
\end{lemma}

\begin{proof}
First, assume conditions (1) -- (4) hold. Then there exists
a finite type $A$-algebra $C$ with such that $B \cong C^\wedge$
by Lemma \ref{lemma-approximate}. In other words, $B_n = C/I^nC$.
The naive cotangent complex $\NL_{C/A}$ is a complex of finite type
$C$-modules and hence $H^{-1}$ and $H^0$ are finite $C$-modules.
By assumption there exists a $c \geq 0$ such that
$H^{-1}/I^nH^{-1}$ and $H^0/I^nH^0$ are annihilated by $I^c$
for some $n$. By Nakayama's lemma this means that
$I^cH^{-1}$ and $I^cH^0$ are annihilated by an element of the
form $f = 1 + x$ with $x \in IC$. After inverting $f$
(which does not change the quotients $B_n = C/I^nC$)
we see that $\NL_{C/A}$ has cohomology annihilated by $I^c$. Thus
$A \to C$ is \'etale at any prime of $C$ not lying over $V(I)$
by the definition of \'etale ring maps, see
Algebra, Definition \ref{algebra-definition-etale}.

\medskip\noindent
Conversely, assume that $A \to C$ of finite type is given such that
$\Spec(C) \to \Spec(A)$ is \'etale over $\Spec(A) \setminus V(I)$.
Then for every $a \in I$ there exists an $c \geq 0$ such that
multiplication by $a^c$ is zero $\NL_{C/A}$.
Since $\NL^\wedge_{C^\wedge/A}$ is the derived completion of
$\NL_{C/A}$ (see Lemma \ref{lemma-NL-is-limit}) it follows that
$B = C^\wedge$ satisfies the equivalent conditions of
Lemma \ref{lemma-equivalent-with-artin}.
\end{proof}








\section{In case the base ring is a G-ring}
\label{section-over-G-ring}

\noindent
If the base ring $A$ is a Noetherian G-ring, then some of the material
above simplifies somewhat and we obtain some additional results.

\begin{proof}[Proof of Lemma \ref{lemma-approximate} in case $A$ is a G-ring]
This proof is easier in that it does not depend on the somewhat
delicate deformation theory argument given in the proof of
Lemma \ref{lemma-lift-approximation}, but of course it requires
a very strong assumption on the Noetherian ring $A$.

\medskip\noindent
Choose a presentation $B = A[x_1, \ldots, x_r]^\wedge/J$.
Choose generators $g_1, \ldots, g_m \in J$.
Choose generators $k_1, \ldots, k_t$ of the module
of relations between $g_1, \ldots, g_m$, i.e., such that
$$
(A[x_1, \ldots, x_r]^\wedge)^{\oplus t} \xrightarrow{k_1, \ldots, k_t}
(A[x_1, \ldots, x_r]^\wedge)^{\oplus m} \xrightarrow{g_1, \ldots, g_m}
A[x_1, \ldots, x_r]^\wedge
$$
is exact in the middle. Write $k_i = (k_{i1}, \ldots, k_{im})$ so that we have
\begin{equation}
\label{equation-relations-straight-up}
\sum k_{ij}g_j = 0
\end{equation}
for $i = 1, \ldots, t$.
Let $I^c = (a_1, \ldots, a_s)$. For each $l \in \{1, \ldots, s\}$
we know that multiplication by $a_l$ on $\NL^\wedge_{B/A}$ is zero
in $D(B)$. By Lemma \ref{lemma-map-out-of-almost-free} we can find a map
$\alpha_l : \bigoplus B\text{d}x_i \to J/J^2$ such that
$\text{d} \circ \alpha_l$ and $\alpha_l \circ \text{d}$ are both
multiplication by $a_l$. Pick an element $f_{l, i} \in J$ whose
class modulo $J^2$ is equal to $\alpha_l(\text{d}x_i)$.
Then we have for all $l = 1, \ldots, s$ and $i = 1, \ldots, r$ that
\begin{equation}
\label{equation-derivatives}
\sum\nolimits_{i'} (\partial f_{l, i}/ \partial x_{i'}) \text{d}x_{i'} =
a_l \text{d}x_i + \sum h_{l, i}^{j', i'} g_{j'} \text{d}x_{i'}
\end{equation}
for some $h_{l, i}^{j', i'} \in A[x_1, \ldots, x_r]^\wedge$.
We also have for $j = 1, \ldots, m$ and $l = 1, \ldots, s$ that
\begin{equation}
\label{equation-ci}
a_l g_j = \sum h_{l, j}^if_{l, i} + \sum h_{l, j}^{j', j''}g_{j'} g_{j''}
\end{equation}
for some $h_{l, j}^i$ and $h_{l, j}^{j', j''}$ in
$A[x_1, \ldots, x_r]^\wedge$. Of course, since $f_{l, i} \in J$
we can write for $l = 1, \ldots, s$ and $i = 1, \ldots, r$
\begin{equation}
\label{equation-in-ideal}
f_{l, i} = \sum h_{l, i}^jg_j
\end{equation}
for some $h_{l, i}^j$ in $A[x_1, \ldots, x_r]^\wedge$.

\medskip\noindent
Let $A[x_1, \ldots, x_r]^h$ be the henselization of the
pair $(A[x_1, \ldots, x_r], IA[x_1, \ldots, x_r])$, see
More on Algebra, Lemma \ref{more-algebra-lemma-henselization}.
Since $A$ is a Noetherian G-ring, so is $A[x_1, \ldots, x_r]$, see
More on Algebra, Proposition
\ref{more-algebra-proposition-finite-type-over-G-ring}.
Hence we have approximation for the map
$A[x_1, \ldots, x_r]^h \to A[x_1, \ldots, x_r]^\wedge$
with respect to the ideal generated by $I$, see
Smoothing Ring Maps, Lemma \ref{smoothing-lemma-henselian-pair}.
Choose a large integer $M$. Choose
$$
G_j, K_{ij}, F_{l, i}, H_{l, j}^i, H_{l, j}^{j', j''}, H_{l, i}^j
\in A[x_1, \ldots, x_r]^h
$$
such that analogues of equations (\ref{equation-relations-straight-up}),
(\ref{equation-ci}), and (\ref{equation-in-ideal})
hold for these elements in $A[x_1, \ldots, x_r]^h$, i.e.,
$$
\sum K_{ij}G_j = 0,\quad
a_l G_j = \sum H_{l, j}^iF_{l, i} +
\sum H_{l, j}^{j', j''} G_{j'} G_{j''},\quad
F_{l, i} = \sum H_{l, i}^j G_j
$$
and such that we have
$$
G_j - g_j, K_{ij} - k_{ij}, F_{l, i} - f_{l, i},
H_{l, j}^i - h_{l, j}^i, H_{l, j}^{j', j''} - h_{l, j}^{j', j''},
H_{l, i}^j - h_{l, i}^j
\in I^M A[x_1, \ldots, x_r]^h
$$
where we take liberty of thinking of $A[x_1, \ldots, x_r]^h$ as a
subring of $A[x_1, \ldots, x_r]^\wedge$.
Note that we cannot guarantee that the analogue of
(\ref{equation-derivatives}) holds
in $A[x_1, \ldots, x_r]^h$, because it is not a polynomial equation.
But since taking partial derivatives is $A$-linear, we do get
the analogue modulo $I^M$. More precisely, we see that
\begin{equation}
\label{equation-derivatives-analogue}
\sum\nolimits_{i'} (\partial F_{l, i}/ \partial x_{i'}) \text{d}x_{i'}
- a_l \text{d}x_i - \sum h_{l, i}^{j', i'} G_{j'} \text{d}x_{i'}
\in I^MA[x_1, \ldots, x_r]^\wedge
\end{equation}
for $l = 1, \ldots, s$ and $i = 1, \ldots, r$.

\medskip\noindent
With these choices, consider the ring
$$
C^h = A[x_1, \ldots, x_r]^h/(G_1, \ldots, G_r)
$$
and denote $C^\wedge$ its $I$-adic completion, namely
$$
C^\wedge = A[x_1, \ldots, x_r]^\wedge/J',\quad
J' = (G_1, \ldots, G_r)A[x_1, \ldots, x_r]^\wedge
$$
In the following paragraphs we esthablish the fact that $C^\wedge$
is isomorphic to $B$. Then in the final paragraph we deal with
show that $C^h$ comes from a finite type algebra
over $A$ as in the statement of the lemma.

\medskip\noindent
First consider the cokernel
$$
\Omega = \Coker(J'/(J')^2 \longrightarrow \bigoplus C^\wedge \text{d}x_i)
$$
This $C^\wedge$ module is generated by the images of the elements
$\text{d}x_i$. Since $F_{l, i} \in J'$ by the analogue of
(\ref{equation-in-ideal}) we see from
(\ref{equation-derivatives-analogue}) we see
that $a_l \text{d}x_i \in I^M\Omega$. As $I^c = (a_l)$ we see that
$I^c \Omega \subset I^M \Omega$. Since $M > c$ we conclude that
$I^c \Omega = 0$ by Algebra, Lemma \ref{algebra-lemma-NAK}.

\medskip\noindent
Next, consider the kernel
$$
H_1 = \Ker(J'/(J')^2 \longrightarrow \bigoplus C^\wedge \text{d}x_i)
$$
By the analogue of (\ref{equation-ci}) we see that
$a_l J' \subset (F_{l, i}) + (J')^2$. On the other hand, the
determinant $\Delta_l$ of the matrix $(\partial F_{l, i}/ \partial x_{i'})$
satisfies $\Delta_l = a_l^r \bmod I^M C^\wedge$ by
(\ref{equation-derivatives-analogue}). It follows that
$a_l^{r + 1} H_1 \subset I^M H_1$ (some details omitted; use
Algebra, Lemma \ref{algebra-lemma-matrix-left-inverse}).
Now $(a_1^{r + 1}, \ldots, a_s^{r + 1}) \supset I^{(sr + 1)c}$.
Hence $I^{(sr + 1)c}H_1 \subset I^M H_1$ and since $M > (sr + 1)c$
we conclude that $I^{(sr + 1)c}H_1 = 0$.

\medskip\noindent
By Lemma \ref{lemma-zero-in-derived}
we conclude that multiplication by an element
of $I^{2(sr + 1)c}$ on $\NL^\wedge_{C^\wedge/A}$ is zero
(note that the bound does not depend on $M$ or the choice
of the approximation, as long as $M$ is large enough).
Since $G_j - g_j$ is in the ideal generated by $I^M$
we see that there is an isomorphism
$$
\psi_M : C^\wedge/I^MC^\wedge \to B/I^MB
$$
As $M$ is large enough we can use
Lemma \ref{lemma-get-morphism-general}
with $d = d(I \subset A \to B)$,
with $C^\wedge$ playing the role of $B$,
with $2(rs + 1)c$ instead of $c$,
to find a morphism
$$
\psi : C^\wedge \longrightarrow B
$$
which agrees with $\psi_M$ modulo $I^{q - 2(rs + 1)c}$ where
$q$ is the quotent of $M$ by the number of generators of $I$.
We claim $\psi$ is an isomorphism. Since $C^\wedge$ and $B$
are $I$-adically complete the map $\psi$ is surjective
because it is surjective modulo $I$ (see
Algebra, Lemma \ref{algebra-lemma-completion-generalities}).
On the other hand, as $M$ is large enough we see that
$$
\text{Gr}_I(C^\wedge) \cong \text{Gr}_I(B)
$$
as graded $\text{Gr}_I(A[x_1, \ldots, x_r]^\wedge)$-modules
by More on Algebra, Lemma \ref{more-algebra-lemma-approximate-complex-graded}.
Since $\psi$ is compatible with this isomorphism as it
agrees with $\psi_M$ modulo $I$, this means that $\text{Gr}_I(\psi)$ is an
isomorphism. As $C^\wedge$ and $B$ are
$I$-adically complete, it follows that $\psi$ is an isomorphism.

\medskip\noindent
This paragraph serves to deal with the issue that $C^h$
is not of finite type over $A$. Namely, the ring
$A[x_1, \ldots, x_r]^h$ is a filtered colimit of
\'etale $A[x_1, \ldots, x_r]$ algebras $A'$ such that
$A/I[x_1, \ldots, x_r] \to A'/IA'$ is an isomorphism
(see proof of More on Algebra, Lemma \ref{more-algebra-lemma-henselization}).
Pick an $A'$ such that $G_1, \ldots, G_m$ are the
images of $G'_1, \ldots, G'_m \in A'$.
Setting $C = A'/(G'_1, \ldots, G'_m)$ we get the finite
type algebra we were looking for.
\end{proof}

\noindent
The following lemma isn't true in general if $A$ is not a G-ring
but just Noetherian. Namely, if $(A, \mathfrak m)$ is local
and $I = \mathfrak m$, then the lemma is equivalent to 
Artin approximation for $A^h$ (as in
Smoothing Ring Maps, Theorem \ref{smoothing-theorem-approximation-property})
which does not hold for every Noetherian local ring.

\begin{lemma}
\label{lemma-fully-faithfulness}
Let $A$ be a Noetherian G-ring. Let $I \subset A$ be an ideal.
Let $B, C$ be finite type $A$-algebras. For any $A$-algebra map
$\varphi : B^\wedge \to C^\wedge$ of $I$-adic completions and any
$N \geq 1$ there exist
\begin{enumerate}
\item an \'etale ring map $C \to C'$ which induces
an isomorphism $C/IC \to C'/IC'$,
\item an $A$-algebra map $\varphi : B \to C'$
\end{enumerate}
such that $\varphi$ and $\psi$ agree modulo $I^N$
into $C^\wedge = (C')^\wedge$.
\end{lemma}

\begin{proof}
The statement of the lemma makes sense as $C \to C'$ is flat
(Algebra, Lemma \ref{algebra-lemma-etale}) hence induces an isomorphism
$C/I^nC \to C'/I^nC'$ for all $n$
(More on Algebra, Lemma \ref{more-algebra-lemma-neighbourhood-isomorphism})
and hence an isomorphism on completions.
Let $C^h$ be the henselization of the pair $(C, IC)$, see
More on Algebra, Lemma \ref{more-algebra-lemma-henselization}.
Then $C^h$ is the filtered colimit of the algebras $C'$
and the maps
$C \to C' \to C^h$ induce isomorphism on completions (More on Algebra,
Lemma \ref{more-algebra-lemma-henselization-Noetherian-pair}).
Thus it suffices to prove there exists an $A$-algebra map
$B \to C^h$ which is congruent to $\psi$ modulo $I^N$.
Write $B = A[x_1, \ldots, x_n]/(f_1, \ldots, f_m)$.
The ring map $\psi$ corresponds to elements
$\hat c_1, \ldots, \hat c_n \in C^\wedge$ with
$f_j(\hat c_1, \ldots, \hat c_n) = 0$ for $j = 1, \ldots, m$.
Namely, as $A$ is a Noetherian G-ring, so is $C$, see
More on Algebra, Proposition
\ref{more-algebra-proposition-finite-type-over-G-ring}.
Thus Smoothing Ring Maps,
Lemma \ref{smoothing-lemma-henselian-pair}
applies to give elements $c_1, \ldots, c_n \in C^h$ such
that $f_j(c_1, \ldots, c_n) = 0$ for $j = 1, \ldots, m$
and such that $\hat c_i - c_i \in I^NC^h$.
This determines the map $B \to C^h$ as desired.
\end{proof}










\input{chapters}

\bibliography{my}
\bibliographystyle{amsalpha}

\end{document}

