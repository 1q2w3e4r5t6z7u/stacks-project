\input{preamble}

% OK, start here.
%
\begin{document}

\title{Local Cohomology}


\maketitle

\phantomsection
\label{section-phantom}

\tableofcontents

\section{Introduction}
\label{section-introduction}

\noindent
Ths chapter continues the study of local cohomology started in
Dualizing Complexes, Section \ref{dualizing-section-local-cohomology}.
A reference is \cite{SGA2}.




\section{Generalities}
\label{section-generalities}

\noindent
The following lemma tells us that the functor $R\Gamma_Z$
is related to cohomology with supports.

\begin{lemma}
\label{lemma-local-cohomology-is-local-cohomology}
Let $A$ be a ring and let $I$ be a finitely generated ideal.
Set $Z = V(I) \subset X = \Spec(A)$. For $K \in D(A)$ corresponding
to $\widetilde{K} \in D_\QCoh(\mathcal{O}_X)$ via
Derived Categories of Schemes, Lemma \ref{perfect-lemma-affine-compare-bounded}
there is a functorial isomorphism
$$
R\Gamma_Z(K) = R\Gamma_Z(X, \widetilde{K})
$$
where on the left we have
Dualizing Complexes, Equation (\ref{dualizing-equation-local-cohomology})
and on the right we have the functor of
Cohomology, Section \ref{cohomology-section-cohomology-support}.
\end{lemma}

\begin{proof}
By Cohomology, Section \ref{cohomology-section-cohomology-support}
there exists a distinguished triangle
$$
R\Gamma_Z(X, \widetilde{K})
\to R\Gamma(X, \widetilde{K})
\to R\Gamma(U, \widetilde{K})
\to R\Gamma_Z(X, \widetilde{K})[1]
$$
where $U = X \setminus Z$. We know that $R\Gamma(X, \widetilde{K}) = K$
by Derived Categories of Schemes, Lemma
\ref{perfect-lemma-affine-compare-bounded}.
Say $I = (f_1, \ldots, f_r)$. Then we obtain a finite affine
open covering $\mathcal{U} : U = D(f_1) \cup \ldots \cup D(f_r)$.
By Derived Categories of Schemes, Lemma
\ref{perfect-lemma-alternating-cech-complex-complex-computes-cohomology}
the alternating {\v C}ech complex
$\text{Tot}(\check{\mathcal{C}}_{alt}^\bullet(\mathcal{U},
\widetilde{K^\bullet}))$
computes $R\Gamma(U, \widetilde{K})$ where $K^\bullet$ is any
complex of $A$-modules representing $K$. Working through the
definitions we find
$$
R\Gamma(U, \widetilde{K}) =
\text{Tot}\left(
K^\bullet \otimes_A
(\prod\nolimits_{i_0} A_{f_{i_0}} \to
\prod\nolimits_{i_0 < i_1} A_{f_{i_0}f_{i_1}} \to
\ldots \to A_{f_1\ldots f_r})\right)
$$
It is clear that
$K^\bullet = R\Gamma(X, \widetilde{K^\bullet}) \to
R\Gamma(U, \widetilde{K}^\bullet)$
is induced by the diagonal map from $A$ into $\prod A_{f_i}$.
Hence we conclude that
$$
R\Gamma_Z(X, \mathcal{F}^\bullet) =
\text{Tot}\left(
K^\bullet \otimes_A
(A \to \prod\nolimits_{i_0} A_{f_{i_0}} \to
\prod\nolimits_{i_0 < i_1} A_{f_{i_0}f_{i_1}} \to
\ldots \to A_{f_1\ldots f_r})\right)
$$
By Dualizing Complexes, Lemma \ref{dualizing-lemma-local-cohomology-adjoint}
this complex computes $R\Gamma_Z(K)$ and we see the lemma holds.
\end{proof}

\begin{lemma}
\label{lemma-local-cohomology}
Let $A$ be a ring and let $I \subset A$ be a finitely generated ideal.
Set $X = \Spec(A)$, $Z = V(I)$, $U = X \setminus Z$, and $j : U \to X$
the inclusion morphism. Let $\mathcal{F}$ be a quasi-coherent
$\mathcal{O}_U$-module. Then
\begin{enumerate}
\item there exists an $A$-module $M$ such that $\mathcal{F}$ is the
restriction of $\widetilde{M}$ to $U$,
\item given $M$ there is an exact sequence
$$
0 \to H^0_Z(M) \to M \to H^0(U, \mathcal{F}) \to H^1_Z(M) \to 0
$$
and isomorphisms $H^p(U, \mathcal{F}) = H^{p + 1}_Z(M)$ for $p \geq 1$,
\item we may take $M = H^0(U, \mathcal{F})$ in which case
we have $H^0_Z(M) = H^1_Z(M) = 0$.
\end{enumerate}
\end{lemma}

\begin{proof}
The existence of $M$ follows from
Properties, Lemma \ref{properties-lemma-extend-trivial}
and the fact that quasi-coherent sheaves on $X$ correspond
to $A$-modules (Schemes, Lemma \ref{schemes-lemma-equivalence-quasi-coherent}).
Then we look at the distinguished triangle
$$
R\Gamma_Z(X, \widetilde{M}) \to R\Gamma(X, \widetilde{M}) \to
R\Gamma(U, \widetilde{M}|_U) \to R\Gamma_Z(X, \widetilde{M})[1]
$$
of Cohomology, Section \ref{cohomology-section-cohomology-support}.
Since $X$ is affine we have $R\Gamma(X, \widetilde{M}) = M$
by Cohomology of Schemes, Lemma
\ref{coherent-lemma-quasi-coherent-affine-cohomology-zero}.
By our choice of $M$ we have $\mathcal{F} = \widetilde{M}|_U$
and hence this produces an exact sequence
$$
0 \to H^0_Z(X, \widetilde{M}) \to M \to H^0(U, \mathcal{F}) \to
H^1_Z(X, \widetilde{M}) \to 0
$$
and isomorphisms $H^p(U, \mathcal{F}) = H^{p + 1}_Z(X, \widetilde{M})$
for $p \geq 1$. By Lemma \ref{lemma-local-cohomology-is-local-cohomology}
we have $H^i_Z(M) = H^i_Z(X, \widetilde{M})$ for all $i$.
Thus (1) and (2) do hold.
Finally, setting $M' = H^0(U, \mathcal{F})$ we see that
the kernel and cokernel of $M \to M'$ are $I$-power torsion.
Therefore $\widetilde{M}|_U \to \widetilde{M'}|_U$ is an isomorphism
and we can indeed use $M'$ as predicted in (3). It goes without saying
that we obtain zero for both $H^0_Z(M')$ and $H^0_Z(M')$.
\end{proof}





\section{Finiteness of local cohomology, I}
\label{section-finiteness}

\noindent
We will follow Faltings approach to finiteness of local cohomology
modules, see \cite{Faltings-annulators} and \cite{Faltings-finiteness}.
Here is a lemma which shows that it suffices to prove
local cohomology modules have an annihilator in order to prove that
they are finite modules.

\begin{lemma}
\label{lemma-check-finiteness-local-cohomology-by-annihilator}
\begin{reference}
This is a special case of \cite[Lemma 3]{Faltings-annulators}.
\end{reference}
Let $A$ be a Noetherian ring, $I \subset A$ an ideal, $M$ a finite
$A$-module, and $n \geq 0$ an integer. Let $Z = V(I)$.
The following are equivalent
\begin{enumerate}
\item $H^i_Z(M)$ is finite for $i \leq n$,
\item there exists an $e \geq 0$ such that $I^e$ annihilates
$H^i_Z(M)$ for $i \leq n$, and
\item there exists an ideal $J \subset A$ with $V(J) \subset Z$
such that $J$ annihilates $H^i_Z(M)$ for $i \leq n$.
\end{enumerate}
\end{lemma}

\begin{proof}
We prove the lemma by induction on $n$. For $n = 0$ we have
$H^0_Z(M) \subset M$ is finite, hence (1), (2), and (3) are true.
Assume that $n > 0$.

\medskip\noindent
If (1) is true, then, since $H^i_Z(M) = H^i_I(M)$
(Dualizing Complexes, Lemma \ref{dualizing-lemma-local-cohomology-noetherian})
is $I$-power torsion, we see that (2) holds.
It is clear that (2) implies (3).

\medskip\noindent
Assume (3) is true. Let $N = H^0_Z(M)$ and $M' = M/N$.
By Dualizing Complexes, Lemma \ref{dualizing-lemma-divide-by-torsion}
we may replace $M$ by $M'$.
Thus we may assume that $H^0_Z(M) = 0$.
This means that $\text{depth}_I(M) > 0$
(Dualizing Complexes, Lemma \ref{dualizing-lemma-depth}).
Pick $f \in I$ a nonzerodivisor on $M$. After raising $f$ to a suitable
power, we may assume $f \in J$ as $V(J) \subset V(I)$. Then the
long exact local cohomology sequence associated to the short
exact sequence
$$
0 \to M \to M \to M/fM \to 0
$$
turns into short exact sequences
$$
0 \to H^i_Z(M) \to H^i_Z(M/fM) \to H^{i + 1}_Z(M) \to 0
$$
for $i < n$. We conclude that $J^2$ annihilates $H^i_Z(M/fM)$
for $i < n$. By induction hypothesis we see that $H^i_Z(M/fM)$
is finite for $i < n$. Using the short exact sequence once more
we see that $H^{i + 1}_Z(M)$ is finite for $i < n$ as desired.
\end{proof}

\noindent
The following result of Faltings allows us to prove finiteness
of local cohomology at the level of local rings.

\begin{lemma}
\label{lemma-check-finiteness-local-cohomology-locally}
\begin{reference}
This is a special case of \cite[Satz 1]{Faltings-finiteness}.
\end{reference}
Let $A$ be a Noetherian ring, $I \subset A$ an ideal, $M$ a finite
$A$-module, and $n \geq 0$ an integer. Let $Z = V(I)$.
The following are equivalent
\begin{enumerate}
\item the modules $H^i_Z(M)$ are finite for $i \leq n$, and
\item for all $\mathfrak p \in \Spec(A)$ the modules
$H^i_Z(M)_\mathfrak p$, $i \leq n$ are finite $A_\mathfrak p$-modules.
\end{enumerate}
\end{lemma}

\begin{proof}
The implication (1) $\Rightarrow$ (2) is immediate. We prove the converse
by induction on $n$. The case $n = 0$ is clear because both (1) and
(2) are always true in that case.

\medskip\noindent
Assume $n > 0$ and that (2) is true. Let $N = H^0_Z(M)$ and $M' = M/N$.
By Dualizing Complexes, Lemma \ref{dualizing-lemma-divide-by-torsion}
we may replace $M$ by $M'$.
Thus we may assume that $H^0_Z(M) = 0$.
This means that $\text{depth}_I(M) > 0$
(Dualizing Complexes, Lemma \ref{dualizing-lemma-depth}).
Pick $f \in I$ a nonzerodivisor on $M$ and consider the short
exact sequence
$$
0 \to M \to M \to M/fM \to 0
$$
which produces a long exact sequence
$$
0 \to H^0_Z(M/fM) \to H^1_Z(M) \to H^1_Z(M) \to H^1_Z(M/fM) \to
H^2_Z(M) \to \ldots
$$
and similarly after localization. Thus assumption (2) implies that
the modules $H^i_Z(M/fM)_\mathfrak p$ are finite for $i < n$. Hence
by induction assumption $H^i_Z(M/fM)$ are finite for $i < n$.

\medskip\noindent
Let $\mathfrak p$ be a prime of $A$ which is associated to
$H^i_Z(M)$ for some $i \leq n$. Say $\mathfrak p$ is the annihilator
of the element $x \in H^i_Z(M)$. Then $\mathfrak p \in Z$, hence
$f \in \mathfrak p$. Thus $fx = 0$ and hence $x$ comes from an
element of $H^{i - 1}_Z(M/fM)$ by the boundary map $\delta$ in the long
exact sequence above. It follows that $\mathfrak p$ is an associated
prime of the finite module $\Im(\delta)$. We conclude that
$\text{Ass}(H^i_Z(M))$ is finite for $i \leq n$, see
Algebra, Lemma \ref{algebra-lemma-finite-ass}.

\medskip\noindent
Recall that
$$
H^i_Z(M) \subset
\prod\nolimits_{\mathfrak p \in \text{Ass}(H^i_Z(M))}
H^i_Z(M)_\mathfrak p
$$
by Algebra, Lemma \ref{algebra-lemma-zero-at-ass-zero}. Since by
assumption the modules on the right hand side are finite and $I$-power
torsion, we can find integers $e_{\mathfrak p, i} \geq 0$, $i \leq n$,
$\mathfrak p \in \text{Ass}(H^i_Z(M))$ such that
$I^{e_{\mathfrak p, i}}$ annihilates $H^i_Z(M)_\mathfrak p$. We conclude
that $I^e$ with $e = \max\{e_{\mathfrak p, i}\}$ annihilates $H^i_Z(M)$
for $i \leq n$. By
Lemma \ref{lemma-check-finiteness-local-cohomology-by-annihilator}
we see that $H^i_Z(M)$ is finite for $i \leq n$.
\end{proof}

\begin{lemma}
\label{lemma-annihilate-local-cohomology}
Let $A$ be a ring and let $J \subset I \subset A$ be finitely generated ideals.
Let $i \geq 0$ be an integer. Set $Z = V(I)$. If
$H^i_Z(A)$ is annihilated by $J^n$ for some $n$, then
$H^i_Z(M)$ annihilated by $J^m$ for some $m = m(M)$
for every finitely presented $A$-module $M$ such that
$M_f$ is a finite locally free $A_f$-module for all $f \in I$.
\end{lemma}

\begin{proof}
Consider the annihilator $\mathfrak a$ of $H^i_Z(M)$.
Let $\mathfrak p \subset A$ with $\mathfrak p \not \in Z$.
By assumption there exists an $f \in I$, $f \not \in \mathfrak p$
and an isomorphism $\varphi : A_f^{\oplus r} \to M_f$
of $A_f$-modules. Clearing denominators (and using that
$M$ is of finite presentation) we find maps
$$
a : A^{\oplus r} \longrightarrow M
\quad\text{and}\quad
b : M \longrightarrow A^{\oplus r}
$$
with $a_f = f^N \varphi$ and $b_f = f^N \varphi^{-1}$ for some $N$.
Moreover we may assume that $a \circ b$ and $b \circ a$ are equal to
multiplication by $f^{2N}$. Thus we see that $H^i_Z(M)$ is annihilated by
$f^{2N}J^n$, i.e., $f^{2N}J^n \subset \mathfrak a$.

\medskip\noindent
As $U = \Spec(A) \setminus Z$ is quasi-compact we can find finitely many
$f_1, \ldots, f_t$ and $N_1, \ldots, N_t$ such that $U = \bigcup D(f_j)$ and
$f_j^{2N_j}J^n \subset \mathfrak a$. Then $V(I) = V(f_1, \ldots, f_t)$
and since $I$ is finitely generated we conclude
$I^M \subset (f_1, \ldots, f_t)$ for some $M$.
All in all we see that $J^m \subset \mathfrak a$ for
$m \gg 0$, for example $m = M (2N_1 + \ldots + 2N_t) n$ will do.
\end{proof}

\begin{lemma}
\label{lemma-local-finiteness-for-finite-locally-free}
Let $A$ be a Noetherian ring. Let $I \subset A$ be an ideal. Set $Z = V(I)$.
Let $n \geq 0$ be an integer. If $H^i_Z(A)$ is finite for $0 \leq i \leq n$,
then the same is true for $H^i_Z(M)$, $0 \leq i \leq n$ for
any finite $A$-module $M$ such that $M_f$ is a finite locally free
$A_f$-module for all $f \in I$.
\end{lemma}

\begin{proof}
The assumption that $H^i_Z(A)$ is finite for $0 \leq i \leq n$
implies there exists an $e \geq 0$ such that $I^e$ annihilates
$H^i_Z(A)$ for $0 \leq i \leq n$, see
Lemma \ref{lemma-check-finiteness-local-cohomology-by-annihilator}.
Then Lemma \ref{lemma-annihilate-local-cohomology}
implies that $H^i_Z(M)$, $0 \leq i \leq n$ is annihilated
by $I^m$ for some $m = m(M, i)$. We may take the same $m$
for all $0 \leq i \leq n$. Then
Lemma \ref{lemma-check-finiteness-local-cohomology-by-annihilator}
implies that $H^i_Z(M)$ is finite for $0 \leq i \leq n$
as desired.
\end{proof}





\section{Finiteness of pushforwards, I}
\label{section-finiteness-pushforward}

\noindent
In this section we discuss the easiest nontrivial case of the
finiteness theorem, namely, the finiteness of the first local
cohomology or what is equivalent, finiteness of $j_*\mathcal{F}$
where $j : U \to X$ is an open immersion, $X$ is locally Noetherian, and
$\mathcal{F}$ is a coherent sheaf on $U$. Following a method of Koll\'ar
we find a necessary and sufficient condition, see
Proposition \ref{proposition-kollar}. The reader who is interested
in higher direct images or higher local cohomology groups should skip
ahead to Section \ref{section-finiteness-pushforward-II} or
Section \ref{section-finiteness-II} (which are developed
independently of the rest of this section).

\begin{lemma}
\label{lemma-check-finiteness-pushforward-on-associated-points}
Let $X$ be a locally Noetherian scheme. Let $j : U \to X$ be the inclusion
of an open subscheme with complement $Z$. For $x \in U$ let
$i_x : W_x \to U$ be the integral closed subscheme with generic point $x$.
Let $\mathcal{F}$ be a coherent $\mathcal{O}_U$-module.
The following are equivalent
\begin{enumerate}
\item for all $x \in \text{Ass}(\mathcal{F})$ the
$\mathcal{O}_X$-module $j_*i_{x, *}\mathcal{O}_{W_x}$ is coherent,
\item $j_*\mathcal{F}$ is coherent.
\end{enumerate}
\end{lemma}

\begin{proof}
We first prove that (1) implies (2). Assume (1) holds.
The statement is local on $X$, hence we may assume $X$ is affine.
Then $U$ is quasi-compact, hence $\text{Ass}(\mathcal{F})$ is finite
(Divisors, Lemma \ref{divisors-lemma-finite-ass}). Thus we may argue by
induction on the number of associated points. Let $x \in U$ be a generic
point of an irreducible component of the support of $\mathcal{F}$.
By Divisors, Lemma \ref{divisors-lemma-finite-ass} we have
$x \in \text{Ass}(\mathcal{F})$. By our choice of $x$ we have
$\dim(\mathcal{F}_x) = 0$ as $\mathcal{O}_{X, x}$-module.
Hence $\mathcal{F}_x$ has finite length as an $\mathcal{O}_{X, x}$-module
(Algebra, Lemma \ref{algebra-lemma-support-point}).
Thus we may use induction on this length.

\medskip\noindent
Set $\mathcal{G} = j_*i_{x, *}\mathcal{O}_{W_x}$. This is a coherent
$\mathcal{O}_X$-module by assumption. We have $\mathcal{G}_x = \kappa(x)$.
Choose a nonzero map
$\varphi_x : \mathcal{F}_x \to \kappa(x) = \mathcal{G}_x$.
By Cohomology of Schemes, Lemma \ref{coherent-lemma-map-stalks-local-map}
there is an open $x \in V \subset U$ and a map
$\varphi_V : \mathcal{F}|_V \to \mathcal{G}|_V$ whose stalk
at $x$ is $\varphi_x$. Choose $f \in \Gamma(X, \mathcal{O}_X)$
which does not vanish at $x$ such that $D(f) \subset V$. By
Cohomology of Schemes, Lemma \ref{coherent-lemma-homs-over-open}
(for example) we see that $\varphi_V$ extends to
$f^n\mathcal{F} \to \mathcal{G}|_U$ for some $n$.
Precomposing with multiplication by $f^n$ we obtain a map
$\mathcal{F} \to \mathcal{G}|_U$ whose stalk at $x$ is nonzero.
Let $\mathcal{F}' \subset \mathcal{F}$ be the kernel.
Note that $\text{Ass}(\mathcal{F}') \subset \text{Ass}(\mathcal{F})$, see
Divisors, Lemma \ref{divisors-lemma-ses-ass}.
Since
$\text{length}_{\mathcal{O}_{X, x}}(\mathcal{F}') = 
\text{length}_{\mathcal{O}_{X, x}}(\mathcal{F}) - 1$
we may apply the
induction hypothesis to conclude $j_*\mathcal{F}'$ is coherent.
Since $\mathcal{G} = j_*(\mathcal{G}|_U) = j_*i_{x, *}\mathcal{O}_{W_x}$
is coherent, we can consider the exact sequence
$$
0 \to j_*\mathcal{F}' \to j_*\mathcal{F} \to \mathcal{G}
$$
By Schemes, Lemma \ref{schemes-lemma-push-forward-quasi-coherent}
the sheaf $j_*\mathcal{F}$ is quasi-coherent.
Hence the image of $j_*\mathcal{F}$ in $j_*(\mathcal{G}|_U)$
is coherent by Cohomology of Schemes, Lemma
\ref{coherent-lemma-coherent-Noetherian-quasi-coherent-sub-quotient}.
Finally, $j_*\mathcal{F}$ is coherent by
Cohomology of Schemes, Lemma \ref{coherent-lemma-coherent-abelian-Noetherian}.

\medskip\noindent
Assume (2) holds. Exactly in the same manner as above we reduce
to the case $X$ affine. We pick $x \in \text{Ass}(\mathcal{F})$
and we set $\mathcal{G} = j_*i_{x, *}\mathcal{O}_{W_x}$.
Then we choose a nonzero map
$\varphi_x : \mathcal{G}_x = \kappa(x) \to \mathcal{F}_x$
which exists exactly because $x$ is an associated point of $\mathcal{F}$.
Arguing exactly as above we may assume $\varphi_x$
extends to an $\mathcal{O}_U$-module map
$\varphi : \mathcal{G}|_U \to \mathcal{F}$.
Then $\varphi$ is injective (for example by
Divisors, Lemma \ref{divisors-lemma-check-injective-on-ass})
and we find and injective map
$\mathcal{G} = j_*(\mathcal{G}|_V \to j_*\mathcal{F}$.
Thus (1) holds.
\end{proof}

\begin{lemma}
\label{lemma-finiteness-pushforwards-and-H1-local}
Let $A$ be a Noetherian ring and let $I \subset A$ be an ideal.
Set $X = \Spec(A)$, $Z = V(I)$, $U = X \setminus Z$, and $j : U \to X$
the inclusion morphism. Let $\mathcal{F}$ be a coherent $\mathcal{O}_U$-module.
Then
\begin{enumerate}
\item there exists a finite $A$-module $M$ such that $\mathcal{F}$ is the
restriction of $\widetilde{M}$ to $U$,
\item given $M$ there is an exact sequence
$$
0 \to H^0_Z(M) \to M \to H^0(U, \mathcal{F}) \to H^1_Z(M) \to 0
$$
and isomorphisms $H^p(U, \mathcal{F}) = H^{p + 1}_Z(M)$ for $p \geq 1$,
\item given $M$ and $p \geq 0$ the following are equivalent
\begin{enumerate}
\item $R^pj_*\mathcal{F}$ is coherent,
\item $H^p(U, \mathcal{F})$ is a finite $A$-module,
\item $H^{p + 1}_Z(M)$ is a finite $A$-module,
\end{enumerate}
\item if the equivalent conditions in (3) hold for $p = 0$, we may take
$M = \Gamma(U, \mathcal{F})$ in which case we have $H^0_Z(M) = H^1_Z(M) = 0$.
\end{enumerate}
\end{lemma}

\begin{proof}
By Properties, Lemma \ref{properties-lemma-extend-finite-presentation}
there exists a coherent $\mathcal{O}_X$-module $\mathcal{F}'$
whose restriction to $U$ is isomorphic to $\mathcal{F}$.
Say $\mathcal{F}'$ corresponds to the finite $A$-module $M$
as in (1).
Note that $R^pj_*\mathcal{F}$ is quasi-coherent
(Cohomology of Schemes, Lemma
\ref{coherent-lemma-quasi-coherence-higher-direct-images})
and corresponds to the $A$-module $H^p(U, \mathcal{F})$.
By Lemma \ref{lemma-local-cohomology-is-local-cohomology}
and the general facts in
Cohomology, Section \ref{cohomology-section-cohomology-support}
we obtain an exact sequence
$$
0 \to H^0_Z(M) \to M \to H^0(U, \mathcal{F}) \to H^1_Z(M) \to 0
$$
and isomorphisms $H^p(U, \mathcal{F}) = H^{p + 1}_Z(M)$ for $p \geq 1$.
Here we use that $H^j(X, \mathcal{F}') = 0$ for $j > 0$ as $X$ is affine
and $\mathcal{F}'$ is quasi-coherent (Cohomology of Schemes,
Lemma \ref{coherent-lemma-quasi-coherent-affine-cohomology-zero}).
This proves (2).
Parts (3) and (4) are straightforward from (2); see also
Lemma \ref{lemma-local-cohomology}.
\end{proof}

\begin{lemma}
\label{lemma-finiteness-pushforward}
Let $X$ be a locally Noetherian scheme.
Let $j : U \to X$ be the inclusion of an
open subscheme with complement $Z$. Let $\mathcal{F}$ be a coherent
$\mathcal{O}_U$-module. Assume
\begin{enumerate}
\item $X$ is Nagata,
\item $X$ is universally catenary, and
\item for $x \in \text{Ass}(\mathcal{F})$ and
$z \in Z \cap \overline{\{x\}}$ we have
$\dim(\mathcal{O}_{\overline{\{x\}}, z}) \geq 2$.
\end{enumerate}
Then $j_*\mathcal{F}$ is coherent.
\end{lemma}

\begin{proof}
By Lemma \ref{lemma-check-finiteness-pushforward-on-associated-points}
it suffices to prove $j_*i_{x, *}\mathcal{O}_{W_x}$ is coherent
for $x \in \text{Ass}(\mathcal{F})$.
Let $\pi : Y \to X$ be the normalization of $X$ in $\Spec(\kappa(x))$, see
Morphisms, Section \ref{morphisms-section-normalization}. By
Morphisms, Lemma \ref{morphisms-lemma-nagata-normalization-finite-general}
the morphism $\pi$ is finite. Since $\pi$ is finite
$\mathcal{G} = \pi_*\mathcal{O}_Y$ is a coherent $\mathcal{O}_X$-module by
Cohomology of Schemes, Lemma \ref{coherent-lemma-finite-pushforward-coherent}.
Observe that $W_x = U \cap \pi(Y)$. Thus
$\pi|_{\pi^{-1}(U)} : \pi^{-1}(U) \to U$ factors through $i_x : W_x \to U$
and we obtain a canonical map
$$
i_{x, *}\mathcal{O}_{W_x}
\longrightarrow
(\pi|_{\pi^{-1}(U)})_*(\mathcal{O}_{\pi^{-1}(U)}) =
(\pi_*\mathcal{O}_Y)|_U = \mathcal{G}|_U
$$
This map is injective (for example by Divisors, Lemma
\ref{divisors-lemma-check-injective-on-ass}). Hence
$j_*i_{x, *}\mathcal{O}_{W_x} \subset j_*\mathcal{G}|_U$
and it suffices to show that $j_*\mathcal{G}|_U$ is coherent.

\medskip\noindent
It remains to prove that $j_*(\mathcal{G}|_U)$ is coherent. We claim
Divisors, Lemma \ref{divisors-lemma-check-isomorphism-via-depth-and-ass}
applies to
$$
\mathcal{G} \longrightarrow j_*(\mathcal{G}|_U)
$$
which finishes the proof.
Let $z \in X$. If $z \in U$, then the map is an isomorphism
on stalks as $j_*(\mathcal{G}|_U)|_U = \mathcal{G}|_U$.
If $z \in Z$, then $z \not \in \text{Ass}(j_*(\mathcal{G}|_U))$
(Divisors, Lemmas \ref{divisors-lemma-weakass-pushforward} and
\ref{divisors-lemma-weakly-ass-support}).
Thus it suffices to show that $\text{depth}(\mathcal{G}_z) \geq 2$.
Let $y_1, \ldots, y_n \in Y$ be the points mapping to $z$.
By Algebra, Lemma \ref{algebra-lemma-depth-goes-down-finite}
it suffices to show that
$\text{depth}(\mathcal{O}_{Y, y_i}) \geq 2$ for $i = 1, \ldots, n$.
If not, then by Properties, Lemma \ref{properties-lemma-criterion-normal}
we see that $\dim(\mathcal{O}_{Y, y_i}) = 1$ for some $i$.
This is impossible by the dimension formula
(Morphisms, Lemma \ref{morphisms-lemma-dimension-formula})
for $\pi : Y \to \overline{\{x\}}$ and assumption (3).
\end{proof}

\begin{lemma}
\label{lemma-sharp-finiteness-pushforward}
Let $X$ be an integral locally Noetherian scheme. Let $j : U \to X$
be the inclusion of a nonempty open subscheme with complement $Z$. Assume
that for all $z \in Z$ and any associated prime $\mathfrak p$ of
the completion $\mathcal{O}_{X, z}^\wedge$
we have $\dim(\mathcal{O}_{X, z}^\wedge/\mathfrak p) \geq 2$.
Then $j_*\mathcal{O}_U$ is coherent.
\end{lemma}

\begin{proof}
We may assume $X$ is affine.
Using Lemmas \ref{lemma-check-finiteness-local-cohomology-locally} and
\ref{lemma-finiteness-pushforwards-and-H1-local} we reduce to
$X = \Spec(A)$ where $(A, \mathfrak m)$ is a Noetherian local domain
and $\mathfrak m \in Z$.
Then we can use induction on $d = \dim(A)$.
(The base case is $d = 0, 1$ which do not happen by
our assumption on the local rings.)
Set $V = \Spec(A) \setminus \{\mathfrak m\}$.
Observe that the local rings of $V$ have dimension strictly smaller than $d$.
Repeating the arguments for $j' : U \to V$ we
and using induction we conclude that $j'_*\mathcal{O}_U$ is
a coherent $\mathcal{O}_V$-module.
Pick a nonzero $f \in A$ which vanishes on $Z$.
Since $D(f) \cap V \subset U$ we find an $n$ such that
multiplication by $f^n$ on $U$ extends to a map
$f^n : j'_*\mathcal{O}_U \to \mathcal{O}_V$ over $V$
(for example by Cohomology of Schemes, Lemma
\ref{coherent-lemma-homs-over-open}). This map is injective
hence there is an injective map
$$
j_*\mathcal{O}_U = j''_* j'_* \mathcal{O}_U \to j''_*\mathcal{O}_V
$$
on $X$ where $j'' : V \to X$ is the inclusion morphism.
Hence it suffices to show that $j''_*\mathcal{O}_V$ is coherent.
In other words, we may assume that $X$ is the spectrum
of a local Noetherian domain and that $Z$
consists of the closed point.

\medskip\noindent
Assume $X = \Spec(A)$ with $(A, \mathfrak m)$ local and $Z = \{\mathfrak m\}$.
Let $A^\wedge$ be the completion of $A$.
Set $X^\wedge = \Spec(A^\wedge)$, $Z^\wedge = \{\mathfrak m^\wedge\}$,
$U^\wedge = X^\wedge \setminus Z^\wedge$, and
$\mathcal{F}^\wedge = \mathcal{O}_{U^\wedge}$.
The ring $A^\wedge$ is universally catenary and Nagata (Algebra, Remark
\ref{algebra-remark-Noetherian-complete-local-ring-universally-catenary} and
Lemma \ref{algebra-lemma-Noetherian-complete-local-Nagata}).
Moreover, condition (3) of Lemma \ref{lemma-finiteness-pushforward}
for $X^\wedge, Z^\wedge, U^\wedge, \mathcal{F}^\wedge$
holds by assumption! Thus we see that
$(U^\wedge \to X^\wedge)_*\mathcal{O}_{U^\wedge}$
is coherent. Since the morphism $c : X^\wedge \to X$
is flat we conclude that the pullback of $j_*\mathcal{O}_U$ is
$(U^\wedge \to X^\wedge)_*\mathcal{O}_{U^\wedge}$
(Cohomology of Schemes, Lemma
\ref{coherent-lemma-flat-base-change-cohomology}).
Finally, since $c$ is faithfully flat we conclude that
$j_*\mathcal{O}_U$ is coherent by
Descent, Lemma \ref{descent-lemma-finite-type-descends}.
\end{proof}

\begin{remark}
\label{remark-closure}
Let $j : U \to X$ be an open immersion of locally Noetherian schemes.
Let $x \in U$. Let $i_x : W_x \to U$ be the integral closed subscheme
with generic point $x$ and let $\overline{\{x\}}$ be the closure in $X$.
Then we have a commutative diagram
$$
\xymatrix{
W_x \ar[d]_{i_x} \ar[r]_{j'} & \overline{\{x\}} \ar[d]^i \\
U \ar[r]^j & X
}
$$
We have $j_*i_{x, *}\mathcal{O}_{W_x} = i_*j'_*\mathcal{O}_{W_x}$.
As the left vertical arrow is a closed immersion we see that
$j_*i_{x, *}\mathcal{O}_{W_x}$ is coherent if and only of
$j'_*\mathcal{O}_{W_x}$ is coherent.
\end{remark}

\begin{remark}
\label{remark-no-finiteness-pushforward}
Let $X$ be a locally Noetherian scheme. Let $j : U \to X$ be the inclusion of
an open subscheme with complement $Z$. Let $\mathcal{F}$ be a coherent
$\mathcal{O}_U$-module. If there exists an $x \in \text{Ass}(\mathcal{F})$ and
$z \in Z \cap \overline{\{x\}}$ such that
$\dim(\mathcal{O}_{\overline{\{x\}}, z}) \leq 1$, then $j_*\mathcal{F}$ is not
coherent. To prove this we can do a flat base change to the spectrum
of $\mathcal{O}_{X, z}$. Let $X' = \overline{\{x\}}$.
The assumption implies $\mathcal{O}_{X' \cap U} \subset \mathcal{F}$.
Thus it suffices to see that $j_*\mathcal{O}_{X' \cap U}$ is not
coherent. This is clear because $X' = \{x, z\}$, hence
$j_*\mathcal{O}_{X' \cap U}$ corresponds to $\kappa(x)$ as an
$\mathcal{O}_{X, z}$-module which cannot be finite as $x$ is not
a closed point.

\medskip\noindent
In fact, the converse of Lemma \ref{lemma-sharp-finiteness-pushforward}
holds true: given an open immersion $j : U \to X$ of integral Noetherian
schemes and there exists a $z \in X \setminus U$ and an associated prime
$\mathfrak p$ of the completion $\mathcal{O}_{X, z}^\wedge$
with $\dim(\mathcal{O}_{X, z}^\wedge/\mathfrak p) = 1$,
then $j_*\mathcal{O}_U$ is not coherent. Namely, you can pass to
the local ring, you can enlarge $U$ to the punctured spectrum,
you can pass to the completion, and then the argument above gives
the nonfiniteness.
\end{remark}

\begin{proposition}[Koll\'ar]
\label{proposition-kollar}
\begin{reference}
Theorem of Koll\'ar stated in an email dated Wed, 1 Jul 2015.
\end{reference}
Let $j : U \to X$ be an open immersion of locally Noetherian schemes
with complement $Z$. Let $\mathcal{F}$ be a coherent $\mathcal{O}_U$-module.
The following are equivalent
\begin{enumerate}
\item $j_*\mathcal{F}$ is coherent,
\item for $x \in \text{Ass}(\mathcal{F})$ and
$z \in Z \cap \overline{\{x\}}$ and any associated prime
$\mathfrak p$ of the completion $\mathcal{O}_{\overline{\{x\}}, z}^\wedge$
we have $\dim(\mathcal{O}_{\overline{\{x\}}, z}^\wedge/\mathfrak p) \geq 2$.
\end{enumerate}
\end{proposition}

\begin{proof}
If (2) holds we get (1) by a combination of
Lemmas \ref{lemma-check-finiteness-pushforward-on-associated-points},
Remark \ref{remark-closure}, and
Lemma \ref{lemma-sharp-finiteness-pushforward}.
If (2) does not hold, then $j_*i_{x, *}\mathcal{O}_{W_x}$ is not finite
for some $x \in \text{Ass}(\mathcal{F})$ by the discussion in
Remark \ref{remark-no-finiteness-pushforward}
(and Remark \ref{remark-closure}).
Thus $j_*\mathcal{F}$ is not coherent by
Lemma \ref{lemma-check-finiteness-pushforward-on-associated-points}.
\end{proof}

\begin{lemma}
\label{lemma-kollar-finiteness-H1-local}
Let $A$ be a Noetherian ring and let $I \subset A$ be an ideal.
Set $Z = V(I)$. Let $M$ be a finite $A$-module. The following
are equivalent
\begin{enumerate}
\item $H^1_Z(M)$ is a finite $A$-module, and
\item for all $\mathfrak p \in \text{Ass}(M)$, $\mathfrak p \not \in Z$
and all $\mathfrak q \in V(\mathfrak p + I)$ the completion of
$(A/\mathfrak p)_\mathfrak q$ does not have associated primes
of dimension $1$.
\end{enumerate}
\end{lemma}

\begin{proof}
Follows immediately from Proposition \ref{proposition-kollar}
via Lemma \ref{lemma-finiteness-pushforwards-and-H1-local}.
\end{proof}

\noindent
The formulation in the following lemma has the advantage that conditions
(1) and (2) are inherited by schemes of finite type over $X$.
Moreover, this is the form of finiteness which we will generalize
to higher direct images in Section \ref{section-finiteness-pushforward-II}.

\begin{lemma}
\label{lemma-finiteness-pushforward-general}
Let $X$ be a locally Noetherian scheme.
Let $j : U \to X$ be the inclusion of an
open subscheme with complement $Z$. Let $\mathcal{F}$ be a coherent
$\mathcal{O}_U$-module. Assume
\begin{enumerate}
\item $X$ is universally catenary,
\item for every $z \in Z$ the formal fibres of $\mathcal{O}_{X, z}$
are $(S_1)$.
\end{enumerate}
In this situation the following are equivalent
\begin{enumerate}
\item[(a)] for $x \in \text{Ass}(\mathcal{F})$ and
$z \in Z \cap \overline{\{x\}}$ we have
$\dim(\mathcal{O}_{\overline{\{x\}}, z}) \geq 2$, and
\item[(b)] $j_*\mathcal{F}$ is coherent.
\end{enumerate}
\end{lemma}

\begin{proof}
Let $x \in \text{Ass}(\mathcal{F})$. By Proposition \ref{proposition-kollar}
it suffices to check that $A = \mathcal{O}_{\overline{\{x\}}, z}$ satisfies
the condition of the proposition on associated primes of its completion
if and only if $\dim(A) \geq 2$.
Observe that $A$ is universally catenary (this is clear)
and that its formal fibres are $(S_1)$ as follows from
More on Algebra, Lemma \ref{more-algebra-lemma-formal-fibres-normal} and
Proposition \ref{more-algebra-proposition-finite-type-over-P-ring}.
Let $\mathfrak p' \subset A^\wedge$ be an associated prime.
As $A \to A^\wedge$ is flat,
by Algebra, Lemma \ref{algebra-lemma-bourbaki},
we find that $\mathfrak p'$ lies over $(0) \subset A$.
Since the formal fibre $A^\wedge \otimes_A f.f.(A)$
is $(S_1)$ we see that $\mathfrak p'$ is a minimal prime, see
Algebra, Lemma \ref{algebra-lemma-criterion-no-embedded-primes}.
Since $A$ is universally catenary it is formally catenary
by More on Algebra, Proposition \ref{more-algebra-proposition-ratliff}.
Hence $\dim(A^\wedge/\mathfrak p') = \dim(A)$ which
proves the equivalence.
\end{proof}






\section{Depth and dimension}
\label{section-dept-dimension}

\noindent
Some helper lemmas.

\begin{lemma}
\label{lemma-ideal-depth-function}
Let $A$ be a Noetherian ring. Let $I \subset A$ be an ideal.
Let $M$ be a finite $A$-module. Let $\mathfrak p \in V(I)$
be a prime ideal. Assume
$e = \text{depth}_{IA_\mathfrak p}(M_\mathfrak p) < \infty$.
Then there exists a nonempty open $U \subset V(\mathfrak p)$
such that $\text{depth}_{IA_\mathfrak q}(M_\mathfrak q) \geq e$
for all $\mathfrak q \in U$.
\end{lemma}

\begin{proof}
By definition of depth we have $IM_\mathfrak p \not = M_\mathfrak p$
and there exists an $M_\mathfrak p$-regular sequence
$f_1, \ldots, f_e \in IA_\mathfrak p$. After replacing $A$ by
a principal localization we may assume $f_1, \ldots, f_e \in I$
form an $M$-regular sequence, see
Algebra, Lemma \ref{algebra-lemma-regular-sequence-in-neighbourhood}.
Consider the module $M' = M/IM$. Since $\mathfrak p \in \text{Supp}(M')$
and since the support of a finite module is closed, we find
$V(\mathfrak p) \subset \text{Supp}(M')$. Thus
for $\mathfrak q \in V(\mathfrak p)$ we get
$IM_\mathfrak q \not = M_\mathfrak q$. Hence, using that
localization is exact, we see that
$\text{depth}_{IA_\mathfrak q}(M_\mathfrak q) \geq e$
for any $\mathfrak q \in V(I)$ by definition of depth.
\end{proof}

\begin{lemma}
\label{lemma-depth-function}
Let $A$ be a Noetherian ring. Let $M$ be a finite $A$-module.
Let $\mathfrak p$ be a prime ideal. Assume
$e = \text{depth}_{A_\mathfrak p}(M_\mathfrak p) < \infty$.
Then there exists a nonempty open $U \subset V(\mathfrak p)$
such that $\text{depth}_{A_\mathfrak q}(M_\mathfrak q) \geq e$
for all $\mathfrak q \in U$ and
for all but finitely many $\mathfrak q \in U$ we have
$\text{depth}_{A_\mathfrak q}(M_\mathfrak q) > e$.
\end{lemma}

\begin{proof}
By definition of depth we have $\mathfrak p M_\mathfrak p \not = M_\mathfrak p$
and there exists an $M_\mathfrak p$-regular sequence
$f_1, \ldots, f_e \in \mathfrak p A_\mathfrak p$. After replacing $A$ by
a principal localization we may assume $f_1, \ldots, f_e \in \mathfrak p$
form an $M$-regular sequence, see
Algebra, Lemma \ref{algebra-lemma-regular-sequence-in-neighbourhood}.
Consider the module $M' = M/(f_1, \ldots, f_e)M$.
Since $\mathfrak p \in \text{Supp}(M')$
and since the support of a finite module is closed, we find
$V(\mathfrak p) \subset \text{Supp}(M')$. Thus
for $\mathfrak q \in V(\mathfrak p)$ we get
$\mathfrak q M_\mathfrak q \not = M_\mathfrak q$. Hence, using that
localization is exact, we see that
$\text{depth}_{A_\mathfrak q}(M_\mathfrak q) \geq e$
for any $\mathfrak q \in V(I)$ by definition of depth.
Moreover, as soon as $\mathfrak q$ is not an associated
prime of the module $M'$, then the depth goes up.
Thus we see that the final statement holds by
Algebra, Lemma \ref{algebra-lemma-finite-ass}.
\end{proof}

\begin{lemma}
\label{lemma-sitting-in-degrees}
Let $(A, \mathfrak m)$ be a Noetherian local ring with
normalized dualizing complex $\omega_A^\bullet$.
Let $M$ be a finite $A$-module.
Set $E^i = \text{Ext}_A^{-i}(M, \omega_A^\bullet)$.
Then
\begin{enumerate}
\item $E^i$ is a finite $A$-module nonzero only for
$0 \leq i \leq \dim(\text{Supp}(M))$,
\item $\dim(\text{Supp}(E^i)) \leq i$,
\item $\text{depth}(M)$ is the smallest integer $\delta \geq 0$ such that
$E^\delta \not = 0$,
\item $\mathfrak p \in \text{Supp}(E^0 \oplus \ldots \oplus E^i)
\Leftrightarrow
\text{depth}_{A_\mathfrak p}(M_\mathfrak p) + \dim(A/\mathfrak p) \leq i$,
\item the annihilator of $E^i$ is equal to the annihilator
of $H^i_\mathfrak m(M)$.
\end{enumerate}
\end{lemma}

\begin{proof}
Parts (1), (2), and (3) are copies of the statements in
Dualizing Complexes, Lemma \ref{dualizing-lemma-sitting-in-degrees}.
For a prime $\mathfrak p$ of $A$ we have that
$(\omega_A^\bullet)_\mathfrak p[-\dim(A/\mathfrak p)]$
is a normalized dualzing complex for $A_\mathfrak p$.
See Dualizing Complexes, Lemma \ref{dualizing-lemma-dimension-function}.
Thus
$$
E^i_\mathfrak p =
\text{Ext}^{-i}_A(M, \omega_A^\bullet)_\mathfrak p =
\text{Ext}^{-i + \dim(A/\mathfrak p)}_{A_\mathfrak p}
(M_\mathfrak p, (\omega_A^\bullet)_\mathfrak p[-\dim(A/\mathfrak p)])
$$
is zero for
$i - \dim(A/\mathfrak p) < \text{depth}_{A_\mathfrak p}(M_\mathfrak p)$
and nonzero for
$i = \dim(A/\mathfrak p) + \text{depth}_{A_\mathfrak p}(M_\mathfrak p)$
by part (3) over $A_\mathfrak p$.
This proves part (4).
If $E$ is an injective hull of the residue field of $A$, then we have
$$
\Hom_A(H^i_\mathfrak m(M), E) =
\text{Ext}^{-i}_A(M, \omega_A^\bullet)^\wedge =
(E^i)^\wedge =
E^i \otimes_A A^\wedge
$$
by the local duality theorem (in the form of
Dualizing Complexes, Lemma \ref{dualizing-lemma-special-case-local-duality}).
Since $A \to A^\wedge$ is faithfully flat, we find (5) is true by
Matlis duality
(Dualizing Complexes, Proposition \ref{dualizing-proposition-matlis}).
\end{proof}

\begin{lemma}
\label{lemma-descending-chain}
Let $(A, \mathfrak m)$ be a Noetherian local ring.
\begin{enumerate}
\item Let $M$ be a finite $A$-module. Then the $A$-module
$H^i_\mathfrak m(M)$ satisfies the descending chain condition
for any $i$.
\item Let $U = \Spec(A) \setminus \{\mathfrak m\}$ be the
punctured spectrum of $A$.
Let $\mathcal{F}$ be a coherent $\mathcal{O}_U$-module.
Then the $A$-module $H^i(U, \mathcal{F})$
satisfies the descending chain condition for $i > 0$.
\end{enumerate}
\end{lemma}

\begin{proof}
Proof of (1). Let $A^\wedge$ be the completion of $A$. Observe that
$H^i_\mathfrak m(M) \otimes_A A^\wedge =
H^i_{\mathfrak mA^\wedge}(M \otimes_A A^\wedge)$ by
Dualizing Complexes, Lemma \ref{dualizing-lemma-torsion-change-rings}.
Thus we may assume $A$ is complete; some details omitted.
If $A$ is complete, then $A$ has a normalized dualizing complex
$\omega_A^\bullet$ and we find that $H^i_\mathfrak m(M)$ is
Matlis dual to the finite $A$-module $\text{Ext}^{-i}_A(M, \omega_A^\bullet)$
by the local duality theorem (Dualizing Complexes, Lemma
\ref{dualizing-lemma-special-case-local-duality}).
We find (1) is true by Matlis duality
(Dualizing Complexes, Proposition \ref{dualizing-proposition-matlis}).
Part (2) follows from (1) via
Lemma \ref{lemma-finiteness-pushforwards-and-H1-local}.
\end{proof}

\begin{lemma}
\label{lemma-ML-local}
Let $(A, \mathfrak m)$ be a Noetherian local ring.
\begin{enumerate}
\item Let $(M_n)$ be an inverse system of finite $A$-modules. Then the
inverse system $H^i_\mathfrak m(M_n)$ satisfies the Mittag-Leffler
condition for any $i$.
\item Let $U = \Spec(A) \setminus \{\mathfrak m\}$ be the
punctured spectrum of $A$.
Let $\mathcal{F}_n$ be an inverse system of
coherent $\mathcal{O}_U$-modules.
Then the inverse system $H^i(U, \mathcal{F}_n)$
satisfies the Mittag-Leffler condition for $i > 0$.
\end{enumerate}
\end{lemma}

\begin{proof}
Follows immediately from Lemma \ref{lemma-descending-chain}.
\end{proof}






\section{Finiteness of local cohomology, II}
\label{section-finiteness-II}

\noindent
We continue the discussion of finiteness of local cohomology
started in Section \ref{section-finiteness}.
Let $A$ be a Noetherian ring and let $I \subset A$ be an ideal.
Set $X = \Spec(A)$ and $Z = V(I) \subset X$. Let $M$ be a finite $A$-module.
We define
\begin{equation}
\label{equation-cutoff}
s_{A, I}(M) =
\min \{
\text{depth}_{A_\mathfrak p}(M_\mathfrak p) + \dim((A/\mathfrak p)_\mathfrak q)
\mid
\mathfrak p \in X \setminus Z, \mathfrak q \in Z,
\mathfrak p \subset \mathfrak q
\}
\end{equation}
Our conventions on depth are that the depth of $0$ is $\infty$
thus we only need to consider primes $\mathfrak p$ in the support
of $M$. It will turn out that $s_{A, I}(M)$ is an important invariant of
the situation.

\begin{lemma}
\label{lemma-cutoff}
Let $A \to B$ be a finite homomorphism of Noetherian rings.
Let $I \subset A$ be an ideal and set $J = IB$. Let $M$ be
a finite $B$-module. If $A$ is universally catenary, then
$s_{B, J}(M) = s_{A, I}(M)$.
\end{lemma}

\begin{proof}
Let $\mathfrak p \subset \mathfrak q \subset A$ be primes with
$I \subset \mathfrak q$ and $I \not \subset \mathfrak p$.
Since $A \to B$ is finite there are finitely many primes
$\mathfrak p_i$ lying over $\mathfrak p$. By
Algebra, Lemma \ref{algebra-lemma-depth-goes-down-finite}
we have
$$
\text{depth}(M_\mathfrak p) = \min \text{depth}(M_{\mathfrak p_i})
$$
Let $\mathfrak p_i \subset \mathfrak q_{ij}$ be primes lying
over $\mathfrak q$. By going up for $A \to B$
(Algebra, Lemma \ref{algebra-lemma-integral-going-up})
there is at least one $\mathfrak q_{ij}$ for each $i$.
Then we see that
$$
\dim((B/\mathfrak p_i)_{\mathfrak q_{ij}}) =
\dim((A/\mathfrak p)_\mathfrak q)
$$
by the dimension formula, see
Algebra, Lemma \ref{algebra-lemma-dimension-formula}.
This implies that the minimum of the quantities
used to define $s_{B, J}(M)$
for the pairs $(\mathfrak p_i, \mathfrak q_{ij})$
is equal to the quantity for the pair $(\mathfrak p, \mathfrak q)$.
This proves the lemma.
\end{proof}

\begin{lemma}
\label{lemma-cutoff-completion}
Let $A$ be a universally catenary Noetherian local ring.
Let $I \subset A$ be an ideal. Let $M$ be
a finite $A$-module. Then
$$
s_{A, I}(M) \geq s_{A^\wedge, I^\wedge}(M^\wedge)
$$
If the formal fibres of $A$ are $(S_n)$, then
$\min(n + 1, s_{A, I}(M)) \leq s_{A^\wedge, I^\wedge}(M^\wedge)$.
\end{lemma}

\begin{proof}
Write $X = \Spec(A)$, $X^\wedge = \Spec(A^\wedge)$, $Z = V(I) \subset X$, and
$Z^\wedge = V(I^\wedge)$.
Let $\mathfrak p' \subset \mathfrak q' \subset A^\wedge$
be primes with $\mathfrak p' \not \in Z^\wedge$ and
$\mathfrak q' \in Z^\wedge$. Let $\mathfrak p \subset \mathfrak q$
be the corresponding primes of $A$. Then $\mathfrak p \not \in Z$
and $\mathfrak q \in Z$. Picture
$$
\xymatrix{
\mathfrak p' \ar[r] & \mathfrak q' \ar[r] & A^\wedge \\
\mathfrak p \ar[r] \ar@{-}[u] &
\mathfrak q \ar[r] \ar@{-}[u] & A \ar[u]
}
$$
Let us write
\begin{align*}
a & = \dim(A/\mathfrak p) = \dim(A^\wedge/\mathfrak pA^\wedge),\\
b & = \dim(A/\mathfrak q) = \dim(A^\wedge/\mathfrak qA^\wedge),\\
a' & = \dim(A^\wedge/\mathfrak p'),\\
b' & = \dim(A^\wedge/\mathfrak q')
\end{align*}
Equalities by
More on Algebra, Lemma \ref{more-algebra-lemma-completion-dimension}.
We also write
\begin{align*}
p & = \dim(A^\wedge_{\mathfrak p'}/\mathfrak p A^\wedge_{\mathfrak p'}) =
\dim((A^\wedge/\mathfrak p A^\wedge)_{\mathfrak p'}) \\
q & = \dim(A^\wedge_{\mathfrak q'}/\mathfrak p A^\wedge_{\mathfrak q'}) =
\dim((A^\wedge/\mathfrak q A^\wedge)_{\mathfrak q'})
\end{align*}
Since $A$ is universally catenary we see that
$A^\wedge/\mathfrak pA^\wedge = (A/\mathfrak p)^\wedge$
is equidimensional of dimension $a$
(More on Algebra, Proposition \ref{more-algebra-proposition-ratliff}).
Hence $a = a' + p$. Similarly $b = b' + q$.
By Algebra, Lemma \ref{algebra-lemma-apply-grothendieck-module}
applied to the flat local ring map
$A_\mathfrak p \to A^\wedge_{\mathfrak p'}$
we have
$$
\text{depth}(M^\wedge_{\mathfrak p'})
=
\text{depth}(M_\mathfrak p) +
\text{depth}(A^\wedge_{\mathfrak p'} / \mathfrak p A^\wedge_{\mathfrak p'})
$$
The quantity we are minimizing for $s_{A, I}(M)$ is
$$
s(\mathfrak p, \mathfrak q) =
\text{depth}(M_\mathfrak p) + \dim((A/\mathfrak p)_\mathfrak q) =
\text{depth}(M_\mathfrak p) + a - b
$$
(last equality as $A$ is catenary). The quantity we are minimizing
for $s_{A^\wedge, I^\wedge}(M^\wedge)$
is
$$
s(\mathfrak p', \mathfrak q') =
\text{depth}(M^\wedge_{\mathfrak p'}) +
\dim((A^\wedge/\mathfrak p')_{\mathfrak q'}) =
\text{depth}(M^\wedge_{\mathfrak p'}) + a' - b'
$$
(last equality as $A^\wedge$ is catenary).
Now we have enough notation in place to start the proof.

\medskip\noindent
Let $\mathfrak p \subset \mathfrak q \subset A$ be primes
with $\mathfrak p \not \in Z$ and $\mathfrak q \in Z$ such that
$s_{A, I}(M) = s(\mathfrak p, \mathfrak q)$.
Then we can pick $\mathfrak q'$ minimal over $\mathfrak q A^\wedge$
and $\mathfrak p' \subset \mathfrak q'$ minimal over
$\mathfrak p A^\wedge$ (using going down for $A \to A^\wedge$).
Then we have four primes as above with $p = 0$ and $q = 0$.
Moreover, we have
$\text{depth}(A^\wedge_{\mathfrak p'} / \mathfrak p A^\wedge_{\mathfrak p'})=0$
also because $p = 0$. This means that
$s(\mathfrak p', \mathfrak q') = s(\mathfrak p, \mathfrak q)$.
Thus we get the first inequality.

\medskip\noindent
Assume that the formal fibres of $A$ are $(S_n)$. Then
$\text{depth}(A^\wedge_{\mathfrak p'} / \mathfrak p A^\wedge_{\mathfrak p'})
\geq \min(n, p)$.
Hence
$$
s(\mathfrak p', \mathfrak q') \geq
s(\mathfrak p, \mathfrak q) + q + \min(n, p) - p \geq
s_{A, I}(M) + q + \min(n, p) - p
$$
Thus the only way we can get in trouble is if $p > n$. If this happens
then
\begin{align*}
s(\mathfrak p', \mathfrak q')
& =
\text{depth}(M^\wedge_{\mathfrak p'}) +
\dim((A^\wedge/\mathfrak p')_{\mathfrak q'}) \\
& =
\text{depth}(M_\mathfrak p) +
\text{depth}(A^\wedge_{\mathfrak p'} / \mathfrak p A^\wedge_{\mathfrak p'}) +
\dim((A^\wedge/\mathfrak p')_{\mathfrak q'}) \\
& \geq
0 + n + 1
\end{align*}
because $(A^\wedge/\mathfrak p')_{\mathfrak q'}$ has at least two primes.
This proves the second inequality.
\end{proof}

\noindent
The method of proof of the following lemma works more generally,
but the stronger results one gets will be subsumed in
Theorem \ref{theorem-finiteness} below.

\begin{lemma}
\label{lemma-local-annihilator}
\begin{reference}
This is a special case of
\cite[Satz 1]{Faltings-annulators}.
\end{reference}
Let $A$ be a Gorenstein Noetherian local ring. Let $I \subset A$
be an ideal and set $Z = V(I) \subset \Spec(A)$.
Let $M$ be a finite $A$-module. Let $s = s_{A, I}(M)$ as in
(\ref{equation-cutoff}). Then $H^i_Z(M)$ is finite for $i < s$,
but $H^s_Z(M)$ is not finite.
\end{lemma}

\begin{proof}
An important role will be played by the finite $A$-modules
$$
E^i = \Ext_A^i(M, A)
$$
For $\mathfrak p \subset A$ we will write $H^i_\mathfrak p$ to denote the
local cohomology of a $A_\mathfrak p$-module. Then we see that
the $\mathfrak pA_\mathfrak p$-adic completion of
$$
(E^i)_\mathfrak p = \Ext^i_{A_\mathfrak p}(M_\mathfrak p, A_\mathfrak p)
$$
is Matlis dual to
$$
H^{\dim(A_\mathfrak p) - i}_{\mathfrak p}(M_\mathfrak p)
$$
by Dualizing Complexes, Lemma \ref{dualizing-lemma-special-case-local-duality}
and the fact that
$A_\mathfrak p$ is Gorenstein. In particular we deduce from this the
following fact: an ideal $J \subset A$ annihilates
$(E^i)_\mathfrak p$ if and only if $J$ annihilates
$H^{\dim(A_\mathfrak p) - i}_{\mathfrak p}(M_\mathfrak p)$.
Set $Z_n = \{\mathfrak p \in Z \mid \dim(A/\mathfrak p) \leq n\}$.
Observe that $Z_{-1} = \emptyset$ and $Z_n = Z$ for $n = \dim(Z)$.

\medskip\noindent
Proof of finiteness for $i < s$. We will use a double induction to
do this. For $i < s$ consider the induction hypothesis $IH_i$:
$H^a_Z(M)$ is finite for $0 \leq a \leq i$. The case $IH_0$ is trivial
because $H^0_Z(M)$ is a submodule of $M$ and hence finite.

\medskip\noindent
Induction step. Assume $IH_{i - 1}$ holds for some $0 < i < s$.
For $0 \leq a \leq i - 1$ let $J_a$ be the annihilator of
$H^a_Z(M)$. Observe that $V(J_a) \subset Z$ as the support
of the finite $A$-module $H^a_Z(M)$ is contained in $Z$.
We will show by descending induction on $n$ that there
exists an ideal $J$ with $V(J) \subset Z$ such that the
associated primes of $J H^i_Z(M)$ are in $Z_n$.
For $n = -1$ this implies $JH^i_Z(M) = 0$ 
(Algebra, Lemma \ref{algebra-lemma-ass-zero})
and hence the finiteness of $H^i_Z(M)$ by
Lemma \ref{lemma-check-finiteness-local-cohomology-by-annihilator}.
The base case $n = \dim(Z)$ is trivial.

\medskip\noindent
Thus we assume given $J$ with the property for $n$. Let $\mathfrak q \in Z_n$.
With $Z_\mathfrak q = V(IA_\mathfrak q)$ we have
$H^j_Z(M)_\mathfrak q = H^j_{Z_\mathfrak q}(M_\mathfrak q)$
by Dualizing Complexes, Lemma \ref{dualizing-lemma-torsion-change-rings}.
Consider the spectral sequence
$$
H_\mathfrak q^p(H^q_Z(M)_\mathfrak q) \Rightarrow
H^{p + q}_\mathfrak q(M_\mathfrak q)
$$
of Dualizing Complexes, Lemma \ref{dualizing-lemma-local-cohomology-ss}
for the ideals
$IA_\mathfrak q \subset \mathfrak qA_\mathfrak q \subset A_\mathfrak q$.
Below we will find an ideal $J' \subset A$ with $V(J') \subset Z$
such that $H^i_\mathfrak q(M_\mathfrak q)$ is annihilated by $J'$ for all
$\mathfrak q \in Z_n \setminus Z_{n - 1}$.
Claim: $JJ'J_0 \ldots J_{i - 1}$ will work for $n - 1$.
Namely, let $\mathfrak q \in Z_n \setminus Z_{n - 1}$.
The spectral sequence above defines a filtration
$$
E_\infty^{0, i} = E_{i + 2}^{0, i} \subset \ldots \subset E_3^{0, i} \subset
E_2^{0, i} = H^0_\mathfrak q(H^i_Z(M)_\mathfrak q)
$$
The module $E_\infty^{0, i}$ is annihilated by $J'$. The subquotients
$E_j^{0, i}/E_{j + 1}^{0, i}$ are annihilated by $J_{i - j + 1}$
because the target of $d_j^{0, i}$ is a subquotient of
$H^j_\mathfrak q(H^{i - j + 1}_Z(M))$.
Finally, by our choice of $J$ we have
$J H^i_Z(M)_\mathfrak q \subset H^0_\mathfrak q(H^i_Z(M)_\mathfrak q)$.
Thus $\mathfrak q$ cannot be an associated prime of
$JJ'J_0 \ldots J_{i - 1}H^i_Z(M)$ as desired.

\medskip\noindent
By our initial remarks we see that $J'$ should annihilate
$$
(E^{\dim(A_\mathfrak q) - i})_\mathfrak q =
(E^{\dim(A) - n - i})_\mathfrak q
$$
for all $\mathfrak q \in Z_n \setminus Z_{n - 1}$.
But if $J'$ works for one $\mathfrak q$, then it works for all
$\mathfrak q$ in an open neighbourhood of $\mathfrak q$
as the modules $E^{\dim(A) - n - i}$ are finite.
Since every subset of $X$ is Noetherian with the induced
topology (Topology, Lemma \ref{topology-lemma-Noetherian}),
we conclude that it suffices
to prove the existence of $J'$ for one $\mathfrak q$.

\medskip\noindent
Since the ext modules are finite the existence of $J'$ is
equivalent to
$$
\text{Supp}(E^{\dim(A) - n - i}) \cap \Spec(A_\mathfrak q) \subset Z.
$$
This is equivalent to showing the localization at every
$\mathfrak p \subset \mathfrak q$, $\mathfrak p \not \in Z$
is zero. Using local duality over $A_\mathfrak p$ we find that we need
to prove that
$$
H^{\dim(A_\mathfrak p) - \dim(A) + n + i}_\mathfrak p(M_\mathfrak p) =
H^{i - \dim((A/\mathfrak p)_\mathfrak q)}_\mathfrak p(M_\mathfrak p)
$$
is zero (this uses that $A$ is catenary). This vanishes exactly by
our definition of $s(M)$ and
Dualizing Complexes, Lemma \ref{dualizing-lemma-depth}.
This finishes the proof of finiteness for $i < s$.

\medskip\noindent
To prove $H^s_Z(M)$ is not finite we work
backwards through the arguments above. First, we pick a
$\mathfrak q \in Z$, $\mathfrak p \subset \mathfrak q$
with $\mathfrak p \not \in Z$ such that
$s = \text{depth}_{A_\mathfrak p}(M_\mathfrak p) +
\dim((A/\mathfrak p)_\mathfrak q)$. Then
$H^{i - \dim((A/\mathfrak p)_\mathfrak q)}_\mathfrak p(M_\mathfrak p)$
is nonzero by the nonvanishing in
Dualizing Complexes, Lemma \ref{dualizing-lemma-depth}.
Set $n = \dim(A/\mathfrak q)$. Then
there does not exist an ideal $J \subset A$ with $V(J) \subset Z$
such that $J(E^{\dim(A) - n - s})_\mathfrak q = 0$.
Thus $H^s_\mathfrak q(M_\mathfrak q)$ is not
annihilated by an ideal $J \subset A$ with $V(J) \subset Z$.
It follows from the spectral sequence displayed above
that at least one of the modules $H^i_Z(M)_\mathfrak q$,
$0 \leq i \leq s$ is not annihilated by an ideal $J \subset A$
with $V(J) \subset Z$. Since $H^i_Z(M)$ is finite for $i < s$
and hence are annihilated by such ideals,
we conclude that $H^s_Z(M)$ is not finite.
\end{proof}

\noindent
Observe that the hypotheses of the following theorem are satisfied
by excellent Noetherian rings (by definition),
by Noetherian rings which have a dualizing complex
(Dualizing Complexes, Lemma \ref{dualizing-lemma-universally-catenary} and
Dualizing Complexes, Lemma
\ref{dualizing-lemma-dualizing-gorenstein-formal-fibres}), and
by quotients of regular Noetherian rings.

\begin{theorem}
\label{theorem-finiteness}
\begin{reference}
This is a special case of \cite[Satz 2]{Faltings-finiteness}.
\end{reference}
Let $A$ be a Noetherian ring and let $I \subset A$ be an ideal.
Set $Z = V(I) \subset \Spec(A)$. Let $M$ be a finite $A$-module.
Set $s = s_{A, I}(M)$ as in (\ref{equation-cutoff}).
Assume that
\begin{enumerate}
\item $A$ is universally catenary,
\item the formal fibres of the local rings of $A$ are Cohen-Macaulay.
\end{enumerate}
Then $H^i_Z(M)$ is finite for $0 \leq i < s$ and
$H^s_Z(M)$ is not finite.
\end{theorem}

\begin{proof}
By Lemma \ref{lemma-check-finiteness-local-cohomology-locally}
we may assume that $A$ is a local ring.

\medskip\noindent
If $A$ is a Noetherian complete local ring, then we can write $A$
as the quotient of a regular complete local ring $B$ by
Cohen's structure theorem
(Algebra, Theorem \ref{algebra-theorem-cohen-structure-theorem}).
Using Lemma \ref{lemma-cutoff} and
Dualizing Complexes, Lemma
\ref{dualizing-lemma-local-cohomology-and-restriction}
we reduce to the case
of a regular local ring which is a consequence of
Lemma \ref{lemma-local-annihilator}
because a regular local ring is Gorenstein
(Dualizing Complexes, Lemma \ref{dualizing-lemma-regular-gorenstein}).

\medskip\noindent
Let $A$ be a Noetherian local ring. Let $\mathfrak m$ be the maximal ideal.
We may assume $I \subset \mathfrak m$, otherwise the lemma is trivial.
Let $A^\wedge$ be the completion of $A$, let $Z^\wedge = V(IA^\wedge)$, and
let $M^\wedge = M \otimes_A A^\wedge$ be the completion of $M$
(Algebra, Lemma \ref{algebra-lemma-completion-tensor}).
Then $H^i_Z(M) \otimes_A A^\wedge = H^i_{Z^\wedge}(M^\wedge)$ by
Dualizing Complexes, Lemma \ref{dualizing-lemma-torsion-change-rings}
and flatness of $A \to A^\wedge$
(Algebra, Lemma \ref{algebra-lemma-completion-flat}).
Hence it suffices to show that $H^i_{Z^\wedge}(M^\wedge)$ is
finite for $i < s$ and not finite for $i = s$, see
Algebra, Lemma \ref{algebra-lemma-descend-properties-modules}.
Since we know the result is true for $A^\wedge$ it suffices
to show that $s_{A, I}(M) = s_{A^\wedge, I^\wedge}(M^\wedge)$.
This follows from Lemma \ref{lemma-cutoff-completion}.
\end{proof}

\begin{remark}
\label{remark-astute-reader}
The astute reader will have realized that we can get away with a
slightly weaker condition on the formal fibres of the local rings
of $A$. Namely, in the situation of Theorem \ref{theorem-finiteness}
assume $A$ is universally catenary but make no assumptions on
the formal fibres. Suppose we have an $n$ and we want to prove that
$H^i_Z(M)$ are finite for $i \leq n$. Then the exact same proof
shows that it suffices that $s_{A, I}(M) > n$ and that
the formal fibres of local rings of $A$ are $(S_n)$.
On the other hand, if we want to show that $H^s_Z(M)$
is not finite where $s = s_{A, I}(M)$, then our arguments prove
this if the formal fibres are $(S_{s - 1})$.
\end{remark}







\section{Finiteness of pushforwards, II}
\label{section-finiteness-pushforward-II}

\noindent
This section is the continuation of
Section \ref{section-finiteness-pushforward}.
In this section we reap the fruits of the labor done in
Section \ref{section-finiteness-II}.

\begin{lemma}
\label{lemma-finiteness-Rjstar}
Let $X$ be a locally Noetherian scheme. Let $j : U \to X$ be the inclusion
of an open subscheme with complement $Z$. Let $\mathcal{F}$ be a coherent
$\mathcal{O}_U$-module. Let $n \geq 0$ be an integer. Assume
\begin{enumerate}
\item $X$ is universally catenary,
\item for every $z \in Z$ the formal fibres of
$\mathcal{O}_{X, z}$ are $(S_n)$.
\end{enumerate}
In this situation the following are equivalent
\begin{enumerate}
\item[(a)] for $x \in \text{Supp}(\mathcal{F})$ and
$z \in Z \cap \overline{\{x\}}$ we have
$\text{depth}_{\mathcal{O}_{X, x}}(\mathcal{F}_x) +
\dim(\mathcal{O}_{\overline{\{x\}}, z}) > n$,
\item[(b)] $R^pj_*\mathcal{F}$ is coherent for $0 \leq p < n$.
\end{enumerate}
\end{lemma}

\begin{proof}
The statement is local on $X$, hence we may assume $X$ is affine.
Say $X = \Spec(A)$ and $Z = V(I)$. Let $M$ be a finite $A$-module
whose associated coherent $\mathcal{O}_X$-module restricts
to $\mathcal{F}$ over $U$, see
Lemma \ref{lemma-finiteness-pushforwards-and-H1-local}.
This lemma also tells us that $R^pj_*\mathcal{F}$ is coherent
if and only if $H^{p + 1}_Z(M)$ is a finite $A$-module.
Observe that the minimum of the expressions
$\text{depth}_{\mathcal{O}_{X, x}}(\mathcal{F}_x) +
\dim(\mathcal{O}_{\overline{\{x\}}, z})$
is the number $s_{A, I}(M)$ of (\ref{equation-cutoff}).
Having said this the lemma follows from
Theorem \ref{theorem-finiteness}
as elucidated by Remark \ref{remark-astute-reader}.
\end{proof}

\begin{lemma}
\label{lemma-finiteness-for-finite-locally-free}
Let $X$ be a locally Noetherian scheme. Let $j : U \to X$ be the inclusion
of an open subscheme with complement $Z$. Let $n \geq 0$ be an integer.
If $R^pj_*\mathcal{O}_U$ is coherent for $0 \leq p < n$, then
the same is true for $R^pj_*\mathcal{F}$, $0 \leq p < n$
for any finite locally free $\mathcal{O}_U$-module $\mathcal{F}$.
\end{lemma}

\begin{proof}
The question is local on $X$, hence we may assume $X$ is affine.
Say $X = \Spec(A)$ and $Z = V(I)$. Via
Lemma \ref{lemma-finiteness-pushforwards-and-H1-local}
our lemma follows from
Lemma \ref{lemma-local-finiteness-for-finite-locally-free}.
\end{proof}

\begin{lemma}
\label{lemma-annihilate-Hp}
\begin{reference}
\cite[Lemma 1.9]{Bhatt-local}
\end{reference}
Let $A$ be a ring and let $J \subset I \subset A$ be finitely generated ideals.
Let $p \geq 0$ be an integer. Set $U = \Spec(A) \setminus V(I)$. If
$H^p(U, \mathcal{O}_U)$ is annihilated by $J^n$ for some $n$, then
$H^p(U, \mathcal{F})$ annihilated by $J^m$ for some $m = m(\mathcal{F})$
for every finite locally free $\mathcal{O}_U$-module $\mathcal{F}$.
\end{lemma}

\begin{proof}
Consider the annihilator $\mathfrak a$ of $H^p(U, \mathcal{F})$.
Let $u \in U$. There exists an open neighbourhood $u \in U' \subset U$
and an isomorphism
$\varphi : \mathcal{O}_{U'}^{\oplus r} \to \mathcal{F}|_{U'}$.
Pick $f \in A$ such that $u \in D(f) \subset U'$.
There exist maps
$$
a : \mathcal{O}_U^{\oplus r} \longrightarrow \mathcal{F}
\quad\text{and}\quad
b : \mathcal{F} \longrightarrow \mathcal{O}_U^{\oplus r}
$$
whose restriction to $D(f)$ are equal to $f^N \varphi$
and $f^N \varphi^{-1}$ for some $N$. Moreover we may assume that
$a \circ b$ and $b \circ a$ are equal to multiplication by $f^{2N}$.
This follows from Properties, Lemma
\ref{properties-lemma-section-maps-backwards}
since $U$ is quasi-compact ($I$ is finitely generated), separated, and
$\mathcal{F}$ and $\mathcal{O}_U^{\oplus r}$ are finitely presented.
Thus we see that $H^p(U, \mathcal{F})$ is annihilated by
$f^{2N}J^n$, i.e., $f^{2N}J^n \subset \mathfrak a$.

\medskip\noindent
As $U$ is quasi-compact we can find finitely many $f_1, \ldots, f_t$
and $N_1, \ldots, N_t$ such that $U = \bigcup D(f_i)$ and
$f_i^{2N_i}J^n \subset \mathfrak a$. Then $V(I) = V(f_1, \ldots, f_t)$
and since $I$ is finitely generated we conclude
$I^M \subset (f_1, \ldots, f_t)$ for some $M$.
All in all we see that $J^m \subset \mathfrak a$ for
$m \gg 0$, for example $m = M (2N_1 + \ldots + 2N_t) n$  will do.
\end{proof}




\section{Cohomological dimension}
\label{section-cd}

\noindent
A quick section about cohomological dimension.

\begin{lemma}
\label{lemma-cd}
Let $I \subset A$ be a finitely generated ideal of a ring $A$.
Set $Y = V(I) \subset X = \Spec(A)$. Let $d \geq -1$ be an integer.
The following are equivalent
\begin{enumerate}
\item $H^i_Y(A) = 0$ for $i > d$,
\item $H^i_Y(M) = 0$ for $i > d$ for every $A$-module $M$, and
\item if $d = -1$, then $Y = \emptyset$, if $d = 0$, then
$Y$ is open and closed in $X$, and if $d > 0$ then
$H^i(X \setminus Y, \mathcal{F}) = 0$ for $i \geq d$
for every quasi-coherent $\mathcal{O}_{X \setminus Y}$-module $\mathcal{F}$.
\end{enumerate}
\end{lemma}

\begin{proof}
Observe that $R\Gamma_Y(-)$ has finite cohomological dimension by
Dualizing Complexes, Lemma \ref{dualizing-lemma-local-cohomology-adjoint}
for example. Hence we can choose a large integer $N$ such that
$H^i_Y(M) = 0$ for all $A$-modules $M$.

\medskip\noindent
Let us prove that (1) and (2) are equivalent. It is immediate that
(2) implies (1). Assume (1). Choose any $A$-module $M$ and fit it into
a short exact sequence $0 \to N \to F \to M \to 0$ where $F$ is a
free $A$-module. Since $R\Gamma_Y$ is a right adjoint, we see that
$H^i_Y(-)$ commutes with direct sums. Hence $H^i_Y(F) = 0$
for $i > d$ by assumption (1). Then we see that
$H^i_Y(M) = H^{i + 1}_Y(N)$ for all $i > d$.
Thus if we've shown the vanishing of $H^j_Y(N)$ for some
$j > d + 1$ and all $A$-modules $N$, then we obtain the
vanishing of $H^{j - 1}_Y(M)$ for all $A$-modules $M$.
By induction we find that (2) is true.

\medskip\noindent
Assume $d = -1$ and (2) holds. Then $0 = H^0_Y(A/I) = A/I \Rightarrow A = I
\Rightarrow Y = \emptyset$. Thus (3) holds. We omit the proof of the converse.

\medskip\noindent
Assume $d = 0$ and (2) holds. Set
$J = H^0_I(A) = \{x \in A \mid I^nx = 0 \text{ for some }n > 0\}$.
Then
$$
H^1_Y(A) = \Coker(A \to \Gamma(X \setminus Y, \mathcal{O}_{X \setminus Y}))
\quad\text{and}\quad
H^1_Y(I) = \Coker(I \to \Gamma(X \setminus Y, \mathcal{O}_{X \setminus Y}))
$$
and the kernel of the first map is equal to $J$. See
Lemma \ref{lemma-local-cohomology}.
We conclude from (2) that $I(A/J) = A/J$.
Thus we may pick $f \in I$
mapping to $1$ in $A/J$. Then $1 - f \in J$ so $I^n(1 - f) = 0$ for some
$n > 0$. Hence $f^n = f^{n + 1}$. Then $e = f^n \in I$ is an idempotent.
Consider the complementary idempotent $e' = 1 - f^n \in J$.
For any element $g \in I$ we have $g^m e' = 0$ for some $m > 0$.
Thus $I$ is contained in the radical of ideal $(e) \subset I$.
This means $Y = V(I) = V(e)$ is open and closed in $X$ as predicted in (3).
Conversely, if $Y = V(I)$ is open and closed, then the functor
$H^0_Y(-)$ is exact and has vanshing higher derived functors.

\medskip\noindent
If $d > 0$, then we see immediately from
Lemma \ref{lemma-local-cohomology} that (2) is equivalent to (3).
\end{proof}

\begin{definition}
\label{definition-cd}
Let $I \subset A$ be a finitely generated ideal of a ring $A$.
The smallest integer $d \geq -1$ satisfying the equivalent conditions
of Lemma \ref{lemma-cd} is called the
{\it cohomological dimension of $I$ in $A$} and is
denoted $\text{cd}(A, I)$.
\end{definition}

\noindent
Thus we have $\text{cd}(A, I) = -1$ if
$I = A$ and $\text{cd}(A, I) = 0$ if $I$ is locally nilpotent
or generated by an idempotent.
Observe that $\text{cd}(A, I)$ exists by the following lemma.

\begin{lemma}
\label{lemma-bound-cd}
Let $I \subset A$ be a finitely generated ideal of a ring $A$.
Then
\begin{enumerate}
\item $\text{cd}(A, I)$ is at most equal to the number of
generators of $I$,
\item $\text{cd}(A, I) \leq r$ if there exist $f_1, \ldots, f_r \in A$
such that $V(f_1, \ldots, f_r) = V(I)$,
\item $\text{cd}(A, I) \leq c$ if $\Spec(A) \setminus V(I)$
can be covered by $c$ affine opens.
\end{enumerate}
\end{lemma}

\begin{proof}
The explicit description for $R\Gamma_Y(-)$ given in
Dualizing Complexes, Lemma \ref{dualizing-lemma-local-cohomology-adjoint}
shows that (1) is true. We can deduce (2) from (1) using the
fact that $R\Gamma_Z$ depends only on the closed subset
$Z$ and not on the choice of the finitely generated ideal
$I \subset A$ with $V(I) = Z$. This follows either from the
construction of local cohomology in
Dualizing Complexes, Section \ref{dualizing-section-local-cohomology}
combined with
More on Algebra, Lemma \ref{more-algebra-lemma-local-cohomology-closed}.
or it follows from Lemma \ref{lemma-local-cohomology-is-local-cohomology}.
To see (3) we use Lemma \ref{lemma-cd}
and the vanishing result of Cohomology of Schemes, Lemma
\ref{coherent-lemma-vanishing-nr-affines}.
\end{proof}

\begin{lemma}
\label{lemma-cd-change-rings}
Let $A \to B$ be a ring map. Let $I \subset A$ be a finitely generated ideal.
Then $\text{cd}(B, IB) \leq \text{cd}(A, I)$. If $A \to B$ is faithfully
flat, then equality holds.
\end{lemma}

\begin{proof}
Use the definition and
Dualizing Complexes, Lemma \ref{dualizing-lemma-torsion-change-rings}.
\end{proof}

\begin{lemma}
\label{lemma-cd-local}
Let $I \subset A$ be a finitely generated ideal of a ring $A$.
Then $\text{cd}(A, I) = \max \text{cd}(A_\mathfrak p, I_\mathfrak p)$.
\end{lemma}

\begin{proof}
Let $Y = V(I)$ and $Y' = V(I_\mathfrak p) \subset \Spec(A_\mathfrak p)$.
Recall that
$R\Gamma_Y(A) \otimes_A A_\mathfrak p = R\Gamma_{Y'}(A_\mathfrak p)$
by Dualizing Complexes, Lemma \ref{dualizing-lemma-torsion-change-rings}.
Thus we conclude by Algebra, Lemma \ref{algebra-lemma-characterize-zero-local}.
\end{proof}

\begin{lemma}
\label{lemma-cd-dimension}
Let $I \subset A$ be a finitely generated ideal of a ring $A$.
Then $\text{cd}(A, I) \leq \dim(A)$.
\end{lemma}

\begin{proof}
Recall that $\dim(A)$ denotes the Krull dimension. By
Lemma \ref{lemma-cd-local} we may assume $A$ is local.
If $V(I) = \emptyset$, then the result is true.
If $V(I) \not = \emptyset$, then
$\dim(\Spec(A) \setminus V(I)) < \dim(A)$ because
the closed point is missing. Observe that
$U = \Spec(A) \setminus V(I)$ is a quasi-compact
open of the spectral space $\Spec(A)$, hence a spectral space itself.
See Algebra, Lemma \ref{algebra-lemma-spec-spectral} and
Topology, Lemma \ref{topology-lemma-spectral-sub}.
Thus Cohomology, Proposition
\ref{cohomology-proposition-cohomological-dimension-spectral}
implies $H^i(U, \mathcal{F}) = 0$ for $i \geq \dim(A)$
which implies what we want by Lemma \ref{lemma-cd}.
In the Noetherian case we can use Grothendieck's Cohomology, Proposition
\ref{cohomology-proposition-vanishing-Noetherian}.
\end{proof}

\begin{lemma}
\label{lemma-cd-is-one}
Let $I \subset A$ be a finitely generated ideal of a ring $A$. If
$\text{cd}(A, I) = 1$ then $\Spec(A) \setminus V(I)$ is nonempty affine.
\end{lemma}

\begin{proof}
This follows from Lemma \ref{lemma-cd} and
Cohomology of Schemes, Lemma
\ref{coherent-lemma-quasi-compact-h1-zero-covering}.
\end{proof}

\begin{lemma}
\label{lemma-cd-maximal}
Let $(A, \mathfrak m)$ be a Noetherian local ring of dimension $d$.
Then $H^d_\mathfrak m(A)$ is nonzero and $\text{cd}(A, \mathfrak m) = d$.
\end{lemma}

\begin{proof}
By one of the characterizations of dimension, there exists
an ideal of definition for $A$ generated by $d$ elements, see
Algebra, Proposition \ref{algebra-proposition-dimension}.
Hence $\text{cd}(A, \mathfrak m) \leq d$ by
Lemma \ref{lemma-bound-cd}. Thus $H^d_\mathfrak m(A)$ is
nonzero if and only if $\text{cd}(A, I) = d$ if and only if
$\text{cd}(A, I) \geq d$.

\medskip\noindent
Let $A \to A^\wedge$ be the map from $A$ to its completion.
Observe that $A^\wedge$ is a Noetherian local ring of the
same dimension as $A$ with maximal ideal $\mathfrak m A^\wedge$.
See Algebra, Lemmas
\ref{algebra-lemma-completion-Noetherian-Noetherian},
\ref{algebra-lemma-completion-complete}, and
\ref{algebra-lemma-completion-faithfully-flat} and
More on Algebra, Lemma \ref{more-algebra-lemma-completion-dimension}.
By Lemma \ref{lemma-cd-change-rings}
it suffices to prove the lemma for $A^\wedge$.

\medskip\noindent
By the previous paragraph we may assume that $A$ is
a complete local ring. Then $A$ has a normalized dualizing complex
$\omega_A^\bullet$ (Dualizing Complexes, Lemma
\ref{dualizing-lemma-ubiquity-dualizing}).
The local duality theorem (in the form of
Dualizing Complexes, Lemma \ref{dualizing-lemma-special-case-local-duality})
tells us $H^d_\mathfrak m(A)$ is Matlis dual to
$\text{Ext}^{-d}(A, \omega_A^\bullet) = H^{-d}(\omega_A^\bullet)$
which is nonzero for example by
Dualizing Complexes, Lemma
\ref{dualizing-lemma-nonvanishing-generically-local}.
\end{proof}

\begin{lemma}
\label{lemma-cd-bound-dim-local}
Let $(A, \mathfrak m)$ be a Noetherian local ring.
Let $I \subset A$ be a proper ideal.
Let $\mathfrak p \subset A$ be a prime ideal
such that $V(\mathfrak p) \cap V(I) = \{\mathfrak m\}$.
Then $\dim(A/\mathfrak p) \leq \text{cd}(A, I)$.
\end{lemma}

\begin{proof}
By Lemma \ref{lemma-cd-change-rings} we have
$\text{cd}(A, I) \geq \text{cd}(A/\mathfrak p, I(A/\mathfrak p))$.
Since $V(I) \cap V(\mathfrak p) = \{\mathfrak m\}$ we have
$\text{cd}(A/\mathfrak p, I(A/\mathfrak p)) =
\text{cd}(A/\mathfrak p, \mathfrak m/\mathfrak p)$.
By Lemma \ref{lemma-cd-maximal} this is equal to $\dim(A/\mathfrak p)$.
\end{proof}








\section{Formal functions for a principal ideal}
\label{section-formal-functions-principal}

\noindent
In this section we ask if completion and taking cohomology commute
for sheaves of modules on schemes over an affine base $A$ when completion
is with respect to a principal ideal in $A$. Of course, we have already
discussed the theorem on formal functions in
Cohomology of Schemes, Section \ref{coherent-section-theorem-formal-functions}.
Moreover, we will see in
Pro-\'etale Cohomology, Section \ref{proetale-section-formal-functions}
that derived completion commutes with derived cohomology in great generality.
In this section we just collect a few simple special cases of this material
that will help us with future developments.

\begin{lemma}
\label{lemma-limit-finite}
Let $A$ be a Noetherian ring complete with respect to a principal ideal $(f)$.
Let $X$ be a scheme over $\Spec(A)$. Let
$$
\ldots \to \mathcal{F}_2 \to \mathcal{F}_1 \to \mathcal{F}_0
$$
be an inverse system of $\mathcal{O}_X$-modules. Assume
\begin{enumerate}
\item $\Gamma(X, \mathcal{F}_0)$ is a finite $A$-module,
\item multiplication by $f$ on $\mathcal{F}_{n + 1}$ factors
through $\mathcal{F}_{n + 1} \to \mathcal{F}_n$ to give a
short exact sequence
$0 \to \mathcal{F}_n \to \mathcal{F}_{n + 1} \to \mathcal{F}_0 \to 0$
\end{enumerate}
Then
$$
M = \lim \Gamma(X, \mathcal{F}_n)
$$
is a finite $A$-module, $f$ is a nonzerodivisor on $M$, and
$M/fM$ is the image of $M$ in $\Gamma(X, \mathcal{F}_0)$.
\end{lemma}

\begin{proof}
Assumption (2) implies that $\mathcal{F}_0$ is annihilated by $f$
and then by induction that $\mathcal{F}_n$ is annihilated by $f^{n + 1}$.
Set $M_n = \Gamma(X, \mathcal{F}_n)$. Since $f^{n + 1}$ annihilates
$M_n$ we see that $\bigcap f^nM = 0$. Since the kernel of
$f : M_{n + 1} \to M_{n + 1}$ dies in $M_n$ by (2) we see that
$f : M \to M$ is injective. The cokernel of $f : M \to M$
is the image of $M \to M_0$. Namely, if $m = (m_n)$ is an element
of $M$ with $m_0 = 0$, then each $m_{n + 1}$ is in the image of
$M_n \to M_{n + 1}$ by assumption (2).
If $m'_n \in M_n$ maps to $m_{n + 1}$ then $f(m'_n) = (m_n)$ in $M$.
Since $A$ is Noetherian and $M_0$ is finite, we see that
$M/fM \subset M_0$ is a finite module. By
Algebra, Lemma \ref{algebra-lemma-finite-over-complete-ring}
we conclude that $M$ is finite over $A$.
\end{proof}

\begin{lemma}
\label{lemma-ML}
Let $A$ be a ring. Let $f \in A$. Let $X$ be a scheme over $\Spec(A)$. Let
$$
\ldots \to \mathcal{F}_2 \to \mathcal{F}_1 \to \mathcal{F}_0
$$
be an inverse system of $\mathcal{O}_X$-modules. Assume
\begin{enumerate}
\item $H^1(X, \mathcal{F}_0)$ is an $A$-module of finite length,
\item multiplication by $f$ on $\mathcal{F}_{n + 1}$ factors
through $\mathcal{F}_{n + 1} \to \mathcal{F}_n$ to give a
short exact sequence
$0 \to \mathcal{F}_n \to \mathcal{F}_{n + 1} \to \mathcal{F}_0 \to 0$,
\end{enumerate}
Then the system $M_n = \Gamma(X, \mathcal{F}_n)$ satisfies the
Mittag-Leffler condition.
\end{lemma}

\begin{proof}
By the short exact sequences and induction we see that
$H^1_n = H^1(X, \mathcal{F}_n)$ is an $A$-module of finite
length for all $n$. Fix $n$. Our goal is to show that
$$
Q_m = \Coker(M_m \to M_n),\quad m \geq n
$$
stabilizes for $m \gg n$. Note that $Q_m \subset H^1_{m - n}$ has finite length
and that we have surjective maps $Q_{m + 1} \to Q_m$ for all $m \geq n$.
Applying cohomology to the short exact sequence
$$
0 \to \mathcal{F}_{m - n} \to \mathcal{F}_m \to \mathcal{F}_n \to 0
$$
we get an exact sequence
$$
0 \to Q_m \to H^1_{m - n} \to H^1_m \to H^1_n
$$
of finite length modules.
Set $q_m = \text{length}_A(Q_m)$ and $l_m = \text{length}_A(H^1_m)$.
Then we conclude that
$$
l_m \leq l_{m - n} - q_m + l_n
$$
Above we have seen that $q_{m + 1} \geq q_m$ for all $n$. If the sequence
does not stabilize then for some $m_0$ we have $q_m > l_n$ for all
$m \geq m_0$. Then we would get
$$
l_m \leq l_{m - n} - q_m + l_n \leq l_{m - n} - 1
$$
provided $m \geq m_0$. This would imply that the sequence
$l_{m_0}, l_{m_0 + n}, l_{m_0 + 2n}, \ldots$ is strictly decreasing
contradicting the fact that $l_m > q_m$ and the sequence $q_m$
is nondecreasing. Thus the sequence stabilizes.
\end{proof}

\begin{lemma}
\label{lemma-formal-functions-principal}
\begin{reference}
\cite[Lemma 1.6]{Bhatt-local}
\end{reference}
Let $A$ be a ring and $f \in A$. Let $X$ be a scheme over $A$.
Let $\mathcal{F}$ be a quasi-coherent $\mathcal{O}_X$-module.
Assume that $\mathcal{F}[f^n] = \Ker(f^n : \mathcal{F} \to \mathcal{F})$
stabilizes. Then
$$
R\Gamma(X, \lim \mathcal{F}/f^n\mathcal{F}) =
R\Gamma(X, \mathcal{F})^\wedge
$$
where the right hand side indicates the derived completion
with respect to the ideal $(f) \subset A$. Let $H^p$ be the
$p$th cohomology group of this complex. Then there are short
exact sequences
$$
0 \to R^1\lim H^{p - 1}(X, \mathcal{F}/f^n\mathcal{F})
\to H^p \to \lim H^p(X, \mathcal{F}/f^n\mathcal{F}) \to 0
$$
and
$$
0 \to H^0(H^p(X, \mathcal{F})^\wedge) \to H^p \to
T_f(H^{p + 1}(X, \mathcal{F})) \to 0
$$
where $T_f(-)$ denote the $f$-adic Tate module as in
More on Algebra, Example
\ref{more-algebra-example-spectral-sequence-principal}.
\end{lemma}

\begin{proof}
We start with the canonical identifications
\begin{align*}
R\Gamma(X, \mathcal{F})^\wedge
& =
R\lim R\Gamma(X, \mathcal{F}) \otimes_A^\mathbf{L} (A \xrightarrow{f^n} A) \\
& =
R\lim R\Gamma(X, \mathcal{F} \xrightarrow{f^n} \mathcal{F}) \\
& =
R\Gamma(X, R\lim (\mathcal{F} \xrightarrow{f^n} \mathcal{F}))
\end{align*}
The first equality holds by
More on Algebra, Lemma \ref{more-algebra-lemma-derived-completion-koszul}.
The second by the projection formula, see 
Cohomology, Lemma \ref{cohomology-lemma-projection-formula-perfect}.
The third by Cohomology, Lemma
\ref{cohomology-lemma-Rf-commutes-with-Rlim}.
Note that by
Derived Categories of Schemes, Lemma \ref{perfect-lemma-Rlim-quasi-coherent}
we have
$\lim \mathcal{F}/f^n\mathcal{F} = R\lim \mathcal{F}/f^n \mathcal{F}$.
Thus to finish the proof of the first statement of the lemma it suffices to
show that the pro-objects $(f^n : \mathcal{F} \to \mathcal{F})$
and $(\mathcal{F}/f^n \mathcal{F})$ are isomorphic. There is clearly
a map from the first system to the second. Suppose that
$\mathcal{F}[f^c] = \mathcal{F}[f^{c + 1}] = \mathcal{F}[f^{c + 2}] = \ldots$.
Then we can define an arrow of systems in $D(\mathcal{O}_X)$
in the other direction by the diagrams
$$
\xymatrix{
\mathcal{F}/\mathcal{F}[f^c] \ar[r]_-{f^{n + c}} \ar[d]_{f^c} &
\mathcal{F} \ar[d]^1 \\
\mathcal{F} \ar[r]^{f^n} & \mathcal{F}
}
$$
Since the top horizontal arrow is injective the complex
in the top row is quasi-isomorphic to $\mathcal{F}/f^{n + c}\mathcal{F}$.
Some details omitted.

\medskip\noindent
Since $R\Gamma(X, -)$ commutes with derived limits
(Injectives, Lemma \ref{injectives-lemma-RF-commutes-with-Rlim})
we see that
$$
R\Gamma(X, \lim \mathcal{F}/f^n\mathcal{F}) =
R\Gamma(X, R\lim \mathcal{F}/f^n\mathcal{F}) =
R\lim R\Gamma(X, \mathcal{F}/f^n\mathcal{F})
$$
(for first equality see first paragraph of proof).
By More on Algebra, Remark \ref{more-algebra-remark-compare-derived-limit}
we obtain exact sequences
$$
0 \to
R^1\lim H^{p - 1}(X, \mathcal{F}/f^n\mathcal{F}) \to
H^p(X, \lim \mathcal{F}/I^n\mathcal{F}) \to
\lim H^p(X, \mathcal{F}/I^n\mathcal{F}) \to 0
$$
of $A$-modules. The second set of short exact sequences follow immediately
from the discussion in More on Algebra, Example
\ref{more-algebra-example-spectral-sequence-principal}.
\end{proof}













\input{chapters}

\bibliography{my}
\bibliographystyle{amsalpha}

\end{document}
