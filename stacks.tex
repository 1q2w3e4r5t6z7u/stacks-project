\input{preamble}

% OK, start here.
%
\begin{document}

\title{Stacks}


\maketitle

\phantomsection
\label{section-phantom}

\tableofcontents

\section{Introduction}
\label{section-introduction}

\noindent
In this very short chapter we introduce stacks, and
stacks in groupoids. See \cite{DM}, and \cite{Vis2}.


\section{Presheaves of morphisms associated to fibred categories}
\label{section-morphisms}

\noindent
Let $\mathcal{C}$ be a category.
Let $p : \mathcal{S} \to \mathcal{C}$ be a fibred category,
see Categories, Section \ref{categories-section-fibred-categories}.
Suppose that $x, y\in \text{Ob}(\mathcal{S}_U)$ are
objects in the fibre category over $U$. We are going to define
a functor
$$
\mathit{Mor}(x, y) : (\mathcal{C}/U)^{opp} \longrightarrow \textit{Sets}.
$$
In other words this will be a presheaf on $\mathcal{C}/U$, see
Sites, Definition \ref{sites-definition-presheaf}.
Make a choice of pullbacks as in
Categories,
Definition \ref{categories-definition-pullback-functor-fibred-category}.
Then, for $f : V \to U$ we set
$$
\mathit{Mor}(x, y)(f : V \to U) =
\text{Mor}_{\mathcal{S}_V}(f^\ast x, f^\ast y).
$$
Let $f' : V' \to U$ be a second object of $\mathcal{C}/U$.
We also have to define the restriction map corresponding to a
morphism $g : V'/U  \to V/U$ in $\mathcal{C}/U$,
in other words $g : V' \to V$ and $f' = f \circ g$.
This will be a map
$$
\text{Mor}_{\mathcal{S}_V}(f^\ast x, f^\ast y)
\longrightarrow
\text{Mor}_{\mathcal{S}_{V'}}({f'}^\ast x, {f'}^\ast y),\quad
\phi \longmapsto \phi|_{V'}
$$
This map will basically be $g^\ast$, except that this transforms
an element $\phi$ of the left hand side into an element
$g^\ast \phi$
of $\text{Mor}_{\mathcal{S}_{V'}}(g^\ast f^\ast x, g^\ast f^\ast y)$.
At this point we use the transformation $\alpha_{g, f}$ of
Categories, Lemma \ref{categories-lemma-fibred}.
In a formula, the restriction map is described by
$$
\phi|_{V'} =
(\alpha_{g, f})_y^{-1} \circ
g^\ast \phi \circ
(\alpha_{g, f})_x.
$$
Of course, nobody thinks of this restriction map in this way.
We will only do this once in order to verify the following
lemma.

\begin{lemma}
\label{lemma-painfull}
This actually does give a presheaf.
\end{lemma}

\begin{proof}
Let $g : V'/U \to V/U$ be as above and similarly
$g' : V''/U \to V'/U$ be morphisms in $\mathcal{C}/U$.
So $f' = f \circ g$ and $f'' = f' \circ g' = f \circ g \circ g'$.
Let $\phi \in {Mor}_{\mathcal{S}_V}(f^\ast x, f^\ast y)$.
Then we have
\begin{eqnarray*}
& &
(\alpha_{g \circ g', f})_y^{-1} \circ
(g \circ g')^\ast \phi \circ
(\alpha_{g \circ g', f})_x
\\
& = &
(\alpha_{g \circ g', f})_y^{-1} \circ
(\alpha_{g', g})_{f^*y}^{-1} \circ
(g')^*g^\ast \phi \circ
(\alpha_{g', g})_{f^*x} \circ
(\alpha_{g \circ g', f})_x
\\
& = &
(\alpha_{g', f'})_y^{-1} \circ
(g')^*(\alpha_{g, f})_y^{-1} \circ
(g')^* g^\ast \phi \circ
(g')^*(\alpha_{g, f})_x
\circ
(\alpha_{g', f'})_x
\\
& = &
(\alpha_{g', f'})_y^{-1} \circ
(g')^*\Big(
(\alpha_{g, f})_y^{-1} \circ
g^\ast \phi \circ
(\alpha_{g, f})_x
\Big) \circ
(\alpha_{g', f'})_x
\end{eqnarray*}
which is what we want. The first equality holds because
$\alpha_{g', g}$ is a transformation of functors, and hence
$$
\xymatrix{
(g \circ g')^*f^*x
\ar[rr]_{(g \circ g')^\ast \phi}
\ar[d]_{(\alpha_{g', g})_{f^*x}} & &
(g \circ g')^*f^*y
\ar[d]^{(\alpha_{g', g})_{f^*y}} \\
(g')^*g^*f^*x
\ar[rr]^{(g')^*g^\ast \phi} & &
(g')^*g^*f^*x
}
$$
commutes. The second equality holds because of property (d) of
a pseudo functor since $f' = f \circ g$ (see
Categories, Definition \ref{categories-definition-functor-into-2-category}).
The last equality follows from the fact that $(g')^*$ is a functor.
\end{proof}

\noindent
From now on we often omit mentioning the transformations
$\alpha_{g, f}$ and we simply identify the functors
$g^* \circ f^*$ and $(f \circ g)^*$. In particular,
given $g : V'/U \to V/U$ the restriction
mappings for the presheaf $\mathit{Mor}(x, y)$
will sometimes be denoted $\phi \mapsto g^*\phi$.
We formalize the construction in a definition.

\begin{definition}
\label{definition-mor-presheaf}
Let $\mathcal{C}$ be a category.
Let $p : \mathcal{S} \to \mathcal{C}$ be a fibred category,
see Categories, Section \ref{categories-section-fibred-categories}.
Given an object $U$ of $\mathcal{C}$ and objects
$x$, $y$ of the fibre category, the {\it presheaf
of morphisms from $x$ to $y$} is the presheaf
$$
(f : V \to U) \longmapsto \text{Mor}_{\mathcal{S}_V}(f^*x, f^*y)
$$
described above. It is denoted $\mathit{Mor}(x, y)$.
The sub-presheaf $\mathit{Isom}(x, y)$ whose values
over $V$ is the set of isomorphisms
$f^*x \to f^*y$ in the fibre category $\mathcal{S}_V$
is called the {\it presheaf of isomorphisms from $x$ to $y$}.
\end{definition}

\noindent
If $\mathcal{S}$ is fibred in groupoids then of course
$\mathit{Isom}(x, y) = \mathit{Mor}(x, y)$, and it is
customary to use the $\mathit{Isom}$ notation.

\begin{lemma}
\label{lemma-presheaf-mor-map-fibred-categories}
Let $F : \mathcal{S}_1 \to \mathcal{S}_2$ be a $1$-morphism of fibred
categories over the category $\mathcal{C}$. Let $U \in \text{Ob}(\mathcal{C})$
and $x, y\in \text{Ob}(\mathcal{S}_U)$. Then $F$ defines a canonical
morphism of presheaves
$$
\mathit{Mor}_{\mathcal{S}_1}(x, y)
\longrightarrow
\mathit{Mor}_{\mathcal{S}_2}(F(x), F(y))
$$
on $\mathcal{C}/U$.
\end{lemma}

\begin{proof}
By
Categories, Definition \ref{categories-definition-fibred-categories-over-C}
the functor $F$ maps strongly cartesian morphisms to strongly cartesian
morphisms. Hence if $f : V \to U$ is a morphism in $\mathcal{C}$, then
there are canonical isomorphisms $\alpha_V : f^*F(x) \to F(f^*x)$,
$\beta_V : f^*F(y) \to F(f^*y)$ such that $f^*F(x) \to F(f^*x) \to F(x)$
is the canonical morphism $f^*F(x) \to F(x)$, and similarly for $\beta$.
Thus we may define
$$
\xymatrix{
\mathit{Mor}_{\mathcal{S}_1}(x, y)(f : V \to U) \ar@{=}[r] &
\text{Mor}_{\mathcal{S}_{1, V}}(f^\ast x, f^\ast y) \ar[d] \\
\mathit{Mor}_{\mathcal{S}_2}(F(x), F(y))(f : V \to U) \ar@{=}[r] &
\text{Mor}_{\mathcal{S}_{2, V}}(f^\ast F(x), f^\ast F(y))
}
$$
by $\phi \mapsto \beta_V^{-1} \circ F(\phi) \circ \alpha_V$.
We omit the verification that this is compatible with the restriction
mappings.
\end{proof}

\begin{remark}
\label{remark-alternative}
Suppose that $p : \mathcal{S} \to \mathcal{C}$ is fibred in groupoids.
In this case we can prove
Lemma \ref{lemma-painfull}
using
Categories, Lemma \ref{categories-lemma-fibred-strict}
which says that $\mathcal{S} \to \mathcal{C}$ is equivalent to the
category associated to a contravariant function
$F : \mathcal{C} \to \text{Groupoids}$.
In the case of the fibred category associated to $F$
we have $g^* \circ f^* = (f \circ g)^*$ on the nose
and there is no need to use the maps $\alpha_{g, f}$.
In this case the lemma is (even more) trivial. Of course then
one uses that the $\mathit{Hom}(x, y)$ presheaf is
unchanged when passing to an equivalent fibred category which follows from
Lemma \ref{lemma-presheaf-mor-map-fibred-categories}.
\end{remark}

\begin{lemma}
\label{lemma-isom-as-2-fibre-product}
Let $\mathcal{C}$ be a category.
Let $p : \mathcal{S} \to \mathcal{C}$ be a fibred category,
see Categories, Section \ref{categories-section-fibred-categories}.
Let $U \in \text{Ob}(\mathcal{C})$ and let $x, y \in \text{Ob}(\mathcal{S}_U)$.
Denote $x, y : \mathcal{C}/U \to \mathcal{S}$ also the corresponding
$1$-morphisms, see
Categories, Lemma \ref{categories-lemma-yoneda-2category}.
Then
\begin{enumerate}
\item the $2$-fibre product
$\mathcal{S} \times_{\mathcal{S} \times \mathcal{S}, (x, y)} \mathcal{C}/U$
is fibred in setoids over $\mathcal{C}/U$, and
\item $\mathit{Isom}(x, y)$ is the presheaf of sets corresponding
to this category fibred in setoids, see
Categories, Lemma \ref{categories-lemma-2-category-fibred-setoids}.
\end{enumerate}
\end{lemma}

\begin{proof}
Omitted. Hint: Objects of the $2$-fibre product are
$(a : V \to U, z, a : V \to U, (\alpha, \beta))$ where
$\alpha : z \to a^*x$ and $\beta : z \to a^*y$ are isomorphisms
in $\mathcal{S}_V$. Thus the relationship with $\text{Isom}(x, y)$
comes by assigning to such an object the isomorphism
$\beta \circ \alpha^{-1}$.
\end{proof}







\section{Descent data in fibred categories}
\label{section-descent-data}

\noindent
In this section we define the notion of a descent datum
in the abstract setting of a fibred category. Before we
do so we point out that this is completely analogous to
descent data for quasi-coherent sheaves
(Descent, Section \ref{descent-section-equivalence})
and descent data for schemes over schemes
(Descent, Section \ref{descent-section-descent-datum}).

\medskip\noindent
We will use the convention where the projection maps
$\text{pr}_i : X \times \ldots \times X \to X$
are labeled starting with $i = 0$. Hence we have
$\text{pr}_0, \text{pr}_1 : X \times X  \to X$,
$\text{pr}_0, \text{pr}_1, \text{pr}_2 : X \times X \times X  \to X$,
etc.

\begin{definition}
\label{definition-descent-data}
Let $\mathcal{C}$ be a category.
Let $p : \mathcal{S} \to \mathcal{C}$ be a fibred category.
Make a choice of pullbacks as in Categories,
Definition \ref{categories-definition-pullback-functor-fibred-category}.
Let $\mathcal{U} = \{f_i : U_i \to U\}_{i \in I}$
be a family of morphisms of $\mathcal{C}$. Assume all the fibre products
$U_i \times_U U_j$, and $U_i \times_U U_j \times_U U_k$ exist.
\begin{enumerate}
\item A {\it descent datum $(X_i, \varphi_{ij})$ in $\mathcal{S}$
relative to the family $\{f_i : U_i \to U\}$} is given by an object $X_i$
of $\mathcal{S}_{U_i}$ for each $i \in I$, an isomorphism
$\varphi_{ij} : \text{pr}_0^*X_i \to \text{pr}_1^*X_j$
in $\mathcal{S}_{U_i \times_U U_j}$ for each pair $(i, j) \in I^2$
such that for every triple of indices $(i, j, k) \in I^3$ the
diagram
$$
\xymatrix{
\text{pr}_0^*X_i \ar[rd]_{\text{pr}_{01}^*\varphi_{ij}}
\ar[rr]_{\text{pr}_{02}^*\varphi_{ik}} & &
\text{pr}_2^*X_k \\
& \text{pr}_1^*X_j \ar[ru]_{\text{pr}_{12}^*\varphi_{jk}} &
}
$$
in the category $\mathcal{S}_{U_i \times_U U_j \times_U U_k}$
commutes. This is called the {\it cocycle condition}.
\item A {\it morphism $\psi : (X_i, \varphi_{ij}) \to
(X'_i, \varphi'_{ij})$ of descent data} is given
by a family $\psi = (\psi_i)_{i\in I}$ of morphisms
$\psi_i : \mathcal{F}_i \to \mathcal{F}'_i$ in $\mathcal{S}_{U_i}$
such that all the diagrams
$$
\xymatrix{
\text{pr}_0^*X_i \ar[r]_{\varphi_{ij}} \ar[d]_{\text{pr}_0^*\psi_i}
& \text{pr}_1^*X_j \ar[d]^{\text{pr}_1^*\psi_j} \\
\text{pr}_0^*X'_i \ar[r]^{\varphi'_{ij}} &
\text{pr}_1^*X'_j \\
}
$$
in the categories $\mathcal{S}_{U_i \times_U U_j}$ commute.
\item The category of descent data relative to
$\mathcal{U}$ is denoted $DD(\mathcal{U})$.
\end{enumerate}
\end{definition}

\noindent
The fibre products $U_i \times_U U_j$ and $U_i \times_U U_j \times_U U_k$
will exist if each of the morphisms $f_i : U_i \to U$ is {\it representable},
see Categories, Definition \ref{categories-definition-representable-morphism}.
Recall that in a site one of the conditions for a covering $\{U_i \to U\}$ is
that each of the morphisms is representable, see
Sites, Definition \ref{sites-definition-site} part (3).
In fact the main interest in the definition above is where $\mathcal{C}$
is a site and $\{U_i \to U\}$ is a covering of $\mathcal{C}$. However,
a descent datum is just an abstract gadget that can be defined as above.
This is useful: for example, given a fibred category over $\mathcal{C}$
one can look at the collection of families with respect to which descent data
are effective, and try to use these as the family of coverings for a site.

\begin{remarks}
\label{remarks-definition-descent-datum}
Two remarks on Definition \ref{definition-descent-data} are in order.
Let $p : \mathcal{S} \to \mathcal{C}$ be a fibred category.
Let $\{f_i : U_i \to U\}_{i \in I}$, and $(X_i, \varphi_{ij})$
be as in Definition \ref{definition-descent-data}.
\begin{enumerate}
\item There is a diagonal morphism $\Delta : U_i \to U_i \times_U U_i$.
We can pull back $\varphi_{ii}$ via this morphism to get an automorphism
$\Delta^\ast \varphi_{ii} \in \text{Aut}_{U_i}(x_i)$.
On pulling back the cocycle condition for the triple $(i, i, i)$
by $\Delta_{123} : U_i \to U_i\times_U U_i \times_U U_i$ we deduce that
$\Delta^\ast \varphi_{ii} \circ \Delta^\ast \varphi_{ii} =
\Delta^\ast \varphi_{ii}$; thus $\Delta^\ast \varphi_{ii} =
\text{id}_{x_i}$.
\item There is a morphism
$\Delta_{13}: U_i \times_U U_j \to U_i \times_U U_j \times_U U_i$
and we can pull back the
cocycle condition for the triple $(i, j, i)$ to get the
identity $(\sigma^\ast \varphi_{ji}) \circ \varphi_{ij} =
\text{id}_{\text{pr}_0^\ast x_i}$, where
$\sigma: U_i \times_U U_j \to U_j \times_U U_i$ is the switching morphism.
\end{enumerate}
\end{remarks}

\begin{lemma}
\label{lemma-pullback}
(Pullback of descent data.)
Let $\mathcal{C}$ be a category.
Let $p : \mathcal{S} \to \mathcal{C}$ be a fibred category.
Make a choice pullbacks as in Categories,
Definition \ref{categories-definition-pullback-functor-fibred-category}.
Let $\mathcal{U} = \{f_i : U_i \to U\}_{i \in I}$, and
$\mathcal{V} = \{V_j \to V\}_{j \in J}$ 
be a families of morphisms of $\mathcal{C}$ with fixed target.
Assume all the fibre products
$U_i \times_U U_{i'}$, $U_i \times_U U_{i'} \times_U U_{i''}$,
$V_j \times_V V_{j'}$, and $V_j \times_V V_{j'} \times_V V_{j''}$ exist.
Let $\alpha : I \to J$, $h : U \to V$ and
$g_i : U_i \to V_{\alpha(i)}$ be a morphism of families
of maps with fixed target, see
Sites, Definition \ref{sites-definition-morphism-coverings}.
\begin{enumerate}
\item Let $(Y_j, \varphi_{jj'})$ be a descent datum relative to the
family $\{V_j \to V\}$. The system
$$
\left(
g_i^*Y_{\alpha(i)},
(g_i \times g_{i'})^*\varphi_{\alpha(i)\alpha(i')}
\right)
$$
is a descent datum relative to $\mathcal{U}$.
\item This construction defines a functor between descent data relative
to $\mathcal{V}$ and descent data relative to $\mathcal{U}$.
\item Given a second $\alpha' : I \to J$, $h' : U \to V$ and
$g'_i : U_i \to V_{\alpha'(i)}$ morphism of families
of maps with fixed target, then if $h = h'$ the two resulting functors
between descent data are canonically isomorphic.
\end{enumerate}
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{definition}
\label{definition-pullback-functor}
With $\mathcal{U} = \{U_i \to U\}_{i \in I}$,
$\mathcal{V} = \{V_j \to V\}_{j \in J}$,
$\alpha : I \to J$, $h : U \to V$,
and $g_i : U_i \to V_{\alpha(i)}$ as in Lemma \ref{lemma-pullback}
the functor
$$
(Y_j, \varphi_{jj'}) \longmapsto
(g_i^*Y_{\alpha(i)}, (g_i \times g_{i'})^*\varphi_{\alpha(i)\alpha(i')})
$$
constructed in that lemma
is called the {\it pullback functor} on descent data.
\end{definition}

\noindent
Given $h : U \to V$, if there exists a morphism
$\tilde h : \mathcal{U} \to \mathcal{V}$ covering $h$
then $\tilde h^*$ is independent of the choice of
$\tilde h$ as we saw in Lemma \ref{lemma-pullback}.
Hence we will sometimes simply write $h^*$ to indicate
the pullback functor.

\begin{definition}
\label{definition-effective-descent-datum}
Let $\mathcal{C}$ be a category.
Let $p : \mathcal{S} \to \mathcal{C}$ be a fibred category.
Make a choice of pullbacks as in Categories,
Definition \ref{categories-definition-pullback-functor-fibred-category}.
Let $\mathcal{U} = \{f_i : U_i \to U\}_{i \in I}$ be a family of morphisms
with target $U$. Assume all the fibre products
$U_i \times_U U_j$ and $U_i \times_U U_j \times_U U_k$ exist.
\begin{enumerate}
\item Given an object $X$ of $\mathcal{S}_U$ the {\it trivial descent datum}
is the descent datum $(X, \text{id}_X)$ with respect to the family
$\{\text{id}_U : U \to U\}$.
\item Given an object $X$ of $\mathcal{S}_U$
we have a {\it canonical descent datum} on the family of
objects $f_i^*X$ by pulling back the trivial
descent datum $(X, \text{id}_X)$ via the
obvious map $\{f_i : U_i \to U\} \to \{\text{id}_U : U \to U\}$.
We denote this descent datum $(f_i^*X, can)$.
\item A descent datum $(X_i, \varphi_{ij})$
relative to $\{f_i : U_i \to U\}$ is called {\it effective}
if there exists an object $X$ of $\mathcal{S}_U$ such that
$(X_i, \varphi_{ij})$ is isomorphic to $(f_i^*X, can)$.
\end{enumerate}
\end{definition}

\noindent
Note that the rule that associates to $X \in \mathcal{S}_U$ its
canonical descent datum relative to $\mathcal{U}$ defines a
functor
$$
\mathcal{S}_U \longrightarrow DD(\mathcal{U}).
$$
A descent datum is effective if and only if it is in the essential
image of this functor.
Let us make explicit the canonical descent datum as follows.

\begin{lemma}
\label{lemma-trivial-cocycle}
In the situation of
Definition \ref{definition-effective-descent-datum} part (2) the maps
$can_{ij} : \text{pr}_0^*f_i^*X \to \text{pr}_1^*f_j^*X$ are equal to
$(\alpha_{\text{pr}_1, f_j})_X \circ (\alpha_{\text{pr}_0, f_i})_X^{-1}$
where $\alpha_{\cdot, \cdot}$ is as in
Categories, Lemma \ref{categories-lemma-fibred}
and where we
use the equality $f_i \circ \text{pr}_0 = f_j \circ \text{pr}_1$
as maps $U_i \times_U U_j \to U$.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}












\section{Definition of stacks}
\label{section-definition}

\noindent
Here is the definition of a stack. It mixes the notion of a fibred
category with the notion of descent.

\begin{definition}
\label{definition-stack}
Let $\mathcal{C}$ be a site. A {\it stack} over $\mathcal{C}$
is a category $p : \mathcal{S} \to \mathcal{C}$ over $\mathcal{C}$ which
satisfies the following conditions:
\begin{enumerate}
\item $p : \mathcal{S} \to \mathcal{C}$ is a fibred category, see
Categories, Definition \ref{categories-definition-fibred-category},
\item for any $U \in \text{Ob}(\mathcal{C})$ and any $x, y \in \mathcal{S}_U$
the presheaf $\mathit{Mor}(x, y)$ (see
Definition \ref{definition-mor-presheaf}) is a sheaf on
the site $\mathcal{C}/U$, and
\item for any covering $\mathcal{U} = \{f_i : U_i \to U\}_{i \in I}$
of the site $\mathcal{C}$, any descent datum in $\mathcal{S}$
relative to $\mathcal{U}$ is effective.
\end{enumerate}
\end{definition}

\noindent
We find the formulation above the most convenient way to think about
a stack. Namely, given a category over $\mathcal{C}$ in order to verify
that it is a stack you proceed to check properties (1), (2) and
(3) in that order. Certainly properties (2) and (3) do not make sense
if the category isn't fibred, and property (3) scarcely makes any sense
if the morphisms presheaves aren't sheaves.

\medskip\noindent
The following lemma provides an alternative definition.

\begin{lemma}
\label{lemma-stack-equivalences}
Let $\mathcal{C}$ be a site.
Let $p : \mathcal{S} \to \mathcal{C}$ be a fibred category
over $\mathcal{C}$. The following are equivalent
\begin{enumerate}
\item $\mathcal{S}$ is a stack over $\mathcal{C}$, and
\item for any covering $\mathcal{U} = \{f_i : U_i \to U\}_{i \in I}$
of the site $\mathcal{C}$ the functor
$$
\mathcal{S}_U \longrightarrow DD(\mathcal{U})
$$
which associates to an
object its canonical descent datum is an equivalence.
\end{enumerate}
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-substack}
Let $p : \mathcal{S} \to \mathcal{C}$ be a stack over the site $\mathcal{C}$.
Let $\mathcal{S}'$ be a subcategory of $\mathcal{S}$.
Assume
\begin{enumerate}
\item if $\varphi : y \to x$ is a strongly cartesian
morphism of $\mathcal{S}$ and
$x$ is an object of $\mathcal{S}'$, then $y$ is isomorphic to an
object of $\mathcal{S}'$,
\item $\mathcal{S}'$ is a full subcategory of $\mathcal{S}$, and
\item if $\{f_i : U_i \to U\}$ is a covering of $\mathcal{C}$,
and $x$ an object of $\mathcal{S}$ over $U$ such that $f_i^*x$
is isomorphic to an object of $\mathcal{S}'$ for each $i$,
then $x$ is isomorphic to an object of $\mathcal{S}'$.
\end{enumerate}
Then $\mathcal{S}' \to \mathcal{C}$ is a stack.
\end{lemma}

\begin{proof}
Omitted. Hints:
The first condition garantees that $\mathcal{S}'$ is a fibred category.
The second condition garantees that the $\mathit{Isom}$-presheaves
of $\mathcal{S}'$ are sheaves (as they are identical to their counter parts
in $\mathcal{S}$). The third condition garantees that the descent condition
holds in $\mathcal{S}'$ as we can first descend in $\mathcal{S}$ and
then (3) implies the resulting object is isomorphic to an object of
$\mathcal{S}'$.
\end{proof}

\begin{lemma}
\label{lemma-stack-equivalent}
Let $\mathcal{C}$ be a site.
Let $\mathcal{S}_1$, $\mathcal{S}_2$ be categories over $\mathcal{C}$.
Suppose that $\mathcal{S}_1$ and $\mathcal{S}_2$ are equivalent
as categories over $\mathcal{C}$.
Then $\mathcal{S}_1$ is a stack over $\mathcal{C}$ if and only if
$\mathcal{S}_2$ is a stack over $\mathcal{C}$.
\end{lemma}

\begin{proof}
Let $F : \mathcal{S}_1 \to \mathcal{S}_2$,
$G : \mathcal{S}_2 \to \mathcal{S}_1$ be functors over $\mathcal{C}$, and let
$i : F \circ G \to \text{id}_{\mathcal{S}_2}$,
$j : G \circ F \to \text{id}_{\mathcal{S}_1}$ be isomorphisms of
functors over $\mathcal{C}$. By
Categories, Lemma \ref{categories-lemma-fibred-equivalent}
we see that $\mathcal{S}_1$ is fibred if and only if $\mathcal{S}_2$
is fibred over $\mathcal{C}$. Hence we may assume that both
$\mathcal{S}_1$ and $\mathcal{S}_2$ are fibred. Moreover, the proof of
Categories, Lemma \ref{categories-lemma-fibred-equivalent}
shows that $F$ and $G$ map strongly cartesian morphisms to strongly
cartesian morphisms, i.e., $F$ and $G$ are $1$-morphisms of fibred
cateogires over $\mathcal{C}$. This means that given
$U \in \text{Ob}(\mathcal{C})$, and $x, y \in \mathcal{S}_{1, U}$ then
the presheaves
$$
\mathit{Mor}_{\mathcal{S}_1}(x, y),
\mathit{Mor}_{\mathcal{S}_1}(F(x), F(y)) :
(\mathcal{C}/U)^{opp} \longrightarrow \textit{Sets}.
$$
are identified, see
Lemma \ref{lemma-presheaf-mor-map-fibred-categories}. Hence
the first is a sheaf if and only if the second is a sheaf.
Finally, we have to show that if every descent datum in $\mathcal{S}_1$
is effective, then so is every descent datum in $\mathcal{S}_2$.
To do this, let $(X_i, \varphi_{ii'})$ be a descent datum
in $\mathcal{S}_2$ relative the covering $\{U_i \to U\}$ of the site
$\mathcal{C}$. Then $(G(X_i), G(\varphi_{ii'}))$ is a descent datum
in $\mathcal{S}_1$ relative the covering $\{U_i \to U\}$.
Let $X$ be an object of $\mathcal{S}_{1, U}$ such that the
descent datum $(f_i^*X, can)$ is isomorphic to
$(G(X_i), G(\varphi_{ii'}))$. Then $F(X)$ is an object of $\mathcal{S}_{2, U}$
such that the descent datum $(f_i^*F(X), can)$ is isomorphic to
$(F(G(X_i)), F(G(\varphi_{ii'})))$ which in turn is isomorphic to
the original descent datum $(X_i, \varphi_{ii'})$ using $i$.
\end{proof}

\noindent
The $2$-category of stacks over $\mathcal{C}$
is defined as follows.

\begin{definition}
\label{definition-stacks-over-C}
Let $\mathcal{C}$ be a site.
The {\it $2$-category of stacks over $\mathcal{C}$}
is the sub $2$-category of the $2$-category of fibred categories
over $\mathcal{C}$ (see
Categories, Definition \ref{categories-definition-fibred-categories-over-C})
defined as follows:
\begin{enumerate}
\item Its objects will be stacks $p : \mathcal{S} \to \mathcal{C}$.
\item Its $1$-morphisms $(\mathcal{S}, p) \to (\mathcal{S}', p')$
will be functors $G : \mathcal{S} \to \mathcal{S}'$ such that
$p' \circ G = p$ and such that $G$ maps strongly cartesian
morphisms to strongly cartesian morphisms.
\item Its $2$-morphisms $t : G \to H$ for
$G, H : (\mathcal{S}, p) \to (\mathcal{S}', p')$
will be morphisms of functors
such that $p'(t_x) = \text{id}_{p(x)}$
for all $x \in \text{Ob}(\mathcal{S})$.
\end{enumerate}
\end{definition}

\begin{lemma}
\label{lemma-2-product-stacks}
Let $\mathcal{C}$ be a site.
The $(2, 1)$-category of stacks over $\mathcal{C}$
has 2-fibre products, and they are described as in
Categories, Lemma \ref{categories-lemma-2-product-categories-over-C}.
\end{lemma}

\begin{proof}
Let $f : \mathcal{X} \to \mathcal{S}$ and
$g : \mathcal{Y} \to \mathcal{S}$ be
$1$-morphisms of stacks over $\mathcal{C}$
as defined above. The category
$\mathcal{X} \times_{\mathcal{S}} \mathcal{Y}$
described in
Categories, Lemma \ref{categories-lemma-2-product-categories-over-C} is a
fibred category according to
Categories, Lemma \ref{categories-lemma-2-product-fibred-categories-over-C}.
(This is where we use that $f$ and $g$ preserve strongly cartesian
morphisms.) It remains to show that the morphism presheaves are sheaves
and that descent relative to coverings of $\mathcal{C}$ is effective.

\medskip\noindent
Recall that an object of $\mathcal{X} \times_{\mathcal{S}} \mathcal{Y}$
is given by a quadruple $(U, x, y, \phi)$.
It lies over the object
$U$ of $\mathcal{C}$. Next, let $(U, x', y', \phi')$ be second
object lying over $U$.
Recall that $\phi : f(x) \to g(y)$, and $\phi' : f(x') \to g(y')$
are isomorphisms in the category $\mathcal{S}_U$. Let us
use these isomorphisms to identify $z = f(x) = g(y)$ and
$z' = f(x') = g(y')$. With this identifications
it is clear that
$$
\mathit{Mor}((U, x, y, \phi), (U, x, y, \phi))
=
\mathit{Mor}(x, x')
\times_{\mathit{Mor}(z, z')}
\mathit{Mor}(y, y')
$$
as presheaves. However, as the fibred product in the category of
presheaves preserves sheaves (Sites, Lemma \ref{sites-lemma-limit-sheaf})
we see that this is a sheaf.

\medskip\noindent
Let $\mathcal{U} = \{f_i : U_i \to U\}_{i \in I}$ be a covering of the site
$\mathcal{C}$. Let $(X_i, \chi_{ij})$ be a descent datum
in $\mathcal{X} \times_{\mathcal{S}} \mathcal{Y}$ relative to $\mathcal{U}$.
Write $X_i = (U_i, x_i, y_i, \phi_i)$ as above. Write
$\chi_{ij} = (\varphi_{ij}, \psi_{ij})$ as in the definition of
the category $\mathcal{X} \times_{\mathcal{S}} \mathcal{Y}$ (see
Categories, Lemma \ref{categories-lemma-2-product-categories-over-C}).
It is clear that $(x_i, \varphi_{ij})$ is a descent datum in
$\mathcal{X}$ and that $(y_i, \psi_{ij})$ is a descent datum in 
$\mathcal{Y}$. Since $\mathcal{X}$ and $\mathcal{Y}$ are stacks these
descent data are effective. Thus we get
$x \in \text{Ob}(\mathcal{X}_U)$, and $y \in \text{Ob}(\mathcal{Y}_U)$
with $x_i = x|_{U_i}$, and $y_i = y|_{U_i}$ compatibly with descent data.
Set $z = f(x)$ and $z' = g(y)$ which are both objects of $\mathcal{S}_U$.
The morphisms $\phi_i$ are elements of
$\mathit{Isom}(z, z')(U_i)$ with the property that
$\phi_i|_{U_i \times_U U_j} = \phi_j|_{U_i \times_U U_j}$.
Hence by the sheaf property of $\mathit{Isom}(z, z')$
we obtain an isomorphism $\phi : z = f(x) \to z' = g(y)$.
We omit the verification that the canonical descent datum associated to
the object $(U, x, y, \phi)$ of
$(\mathcal{X} \times_{\mathcal{S}} \mathcal{Y})_U$ is isomorphic
to the descent datum we started with.
\end{proof}

\begin{lemma}
\label{lemma-characterize-essentially-surjective-when-ff}
Let $\mathcal{C}$ be a site.
Let $\mathcal{S}_1$, $\mathcal{S}_2$ be stacks over $\mathcal{C}$.
Let $F : \mathcal{S}_1 \to \mathcal{S}_2$ be a $1$-morphism which is
fully faithful. Then the following are equivalent
\begin{enumerate}
\item $F$ is an equivalence,
\item for every $U \in \text{Ob}(\mathcal{C})$ and for every
$x \in \text{Ob}(\mathcal{S}_{2, U})$ there exists a covering
$\{f_i : U_i \to U\}$ such that $f_i^*x$ is in the essential image
of the functor $F : \mathcal{S}_{1, U_i} \to \mathcal{S}_{2, U_i}$.
\end{enumerate}
\end{lemma}

\begin{proof}
The implication (1) $\Rightarrow$ (2) is immediate.
To see that (2) implies (1) we have to show that every
$x$ as in (2) is in the essential image of the functor $F$.
To do this choose a covering as in (2),
$x_i \in \text{Ob}(\mathcal{S}_{1, U_i})$, and
isomorphisms $\varphi_i : F(x_i) \to f_i^*x$. Then we get a descent
datum for $\mathcal{S}_1$ relative to $\{f_i : U_i \to U\}$
by taking
$$
\varphi_{ij} :
x_i|_{U_i \times_U U_j}
\longrightarrow
x_j|_{U_i \times_U U_j}
$$
the arrow such that $F(\varphi_{ij}) = \varphi_j^{-1} \circ \varphi_i$.
This descent datum is effective by the axioms of a stack, and hence
we obtain an object $x_1$ of $\mathcal{S}_1$ over $U$. We omit the
verification that $F(x_1)$ is isomorphic to $x$ over $U$.
\end{proof}

\begin{remark}
\label{remark-stack-make-small}
(Cutting down a ``big'' stack to get a stack.)
Let $\mathcal{C}$ be a site. Suppose that $p : \mathcal{S} \to \mathcal{C}$
is functor from a ``big'' category to $\mathcal{C}$, i.e., suppose
that the collection of objects of $\mathcal{S}$ forms a proper class.
Finally, suppose that $p : \mathcal{S} \to \mathcal{C}$ satisfies
conditions (1), (2), (3) of
Definition \ref{definition-stack}.
In general there is no way to replace $p : \mathcal{S} \to \mathcal{C}$
by a equivalent category such that we obtain a stack. The reason is that
it can happen that a fibre categories $\mathcal{S}_U$ may have a proper
class of isomorphism classes of objects.
On the other hand, suppose that 
\begin{enumerate}
\item[(4)] for every $U \in \text{Ob}(\mathcal{C})$ there exists a set
$S_U \subset \text{Ob}(\mathcal{S}_U)$ such that every object of
$\mathcal{S}_U$ is isomorphic in $\mathcal{S}_U$ to an element of $S_U$.
\end{enumerate}
In this case we can find a full subcategory $\mathcal{S}_{small}$
of $\mathcal{S}$ such that, setting $p_{small} = p|_{\mathcal{S}_{small}}$,
we have
\begin{enumerate}
\item[(a)] the functor $p_{small} : \mathcal{S}_{small} \to \mathcal{C}$
defines a stack, and
\item[(b)] the inclusion $\mathcal{S}_{small} \to \mathcal{S}$
is fully faithful and essentially surjective.
\end{enumerate}
(Hint: For every $U \in \text{Ob}(\mathcal{C})$
let $\alpha(U)$ denote the smallest ordinal such that
$\text{Ob}(\mathcal{S}_U) \cap V_{\alpha(U)}$ surjects onto the set
of isomorphism classes of $\mathcal{S}_U$, and set
$\alpha = \sup_{U \in \text{Ob}(\mathcal{C})} \alpha(U)$.
Then take
$\text{Ob}(\mathcal{S}_{small}) = \text{Ob}(\mathcal{S}) \cap V_\alpha$.
For notation used see Sets, Section \ref{sets-section-sets-hierarchy}.)
\end{remark}







\section{Stacks in groupoids}
\label{section-stacks-in-groupoids}

\noindent
Among stacks those which are fibred in groupoids are somewhat easier
to comprehend. We redefine them as follows.

\begin{definition}
\label{definition-stack-in-groupoids}
A {\it stack in groupoids} over a site $\mathcal{C}$ is a
category $p : \mathcal{S} \to \mathcal{C}$ over $\mathcal{C}$
such that
\begin{enumerate}
\item $p : \mathcal{S} \to \mathcal{C}$ is fibred
in groupoids over $\mathcal{C}$ (see
Categories, Definition \ref{categories-definition-fibred-groupoids}),
\item for all $U \in \text{Ob}(\mathcal{C})$,
for all $x, y\in \text{Ob}(\mathcal{S}_U)$ the presheaf
$\mathit{Isom}(x, y)$ is a sheaf on the site $\mathcal{C}/U$, and
\item for all coverings $\mathcal{U} = \{U_i \to U\}$ in $\mathcal{C}$,
all descent data $(x_i, \phi_{ij})$ for $\mathcal{U}$ are effective.
\end{enumerate}
\end{definition}

\noindent
Usually the hardest part to check is the third condition.
Here is the lemma comparing this with the notion of a stack.

\begin{lemma}
\label{lemma-stack-in-groupoids-stack}
Let $\mathcal{C}$ be a site.
Let $p : \mathcal{S} \to \mathcal{C}$ be a category over $\mathcal{C}$.
The following are equivalent
\begin{enumerate}
\item $\mathcal{S}$ is a stack in groupoids over $\mathcal{C}$,
\item $\mathcal{S}$ is a stack over $\mathcal{C}$ and all
fibre categories are groupoids, and
\item $\mathcal{S}$ is fibred in groupoids over $\mathcal{C}$
and is a stack over $\mathcal{C}$.
\end{enumerate}
\end{lemma}

\begin{proof}
Omitted, but see Categories, Lemma \ref{categories-lemma-fibred-groupoids}.
\end{proof}

\begin{lemma}
\label{lemma-stack-gives-stack-groupoids}
Let $\mathcal{C}$ be a site.
Let $p : \mathcal{S} \to \mathcal{C}$ be a stack.
Let $p' : \mathcal{S}' \to \mathcal{C}$
be the category fibred in groupoids associated to $\mathcal{S}$
constructed in
Categories, Lemma \ref{categories-lemma-fibred-gives-fibred-groupoids}.
Then $p' : \mathcal{S}' \to \mathcal{C}$ is a stack in groupoids.
\end{lemma}

\begin{proof}
Recall that the morphisms in $\mathcal{S}'$ are exactly the
strongly cartesian morphisms of $\mathcal{S}$, and that any isomorphism of
$\mathcal{S}$ is such a morphism. Hence descent data in $\mathcal{S}'$
are exactly the same thing as descent data in $\mathcal{S}$. Now apply
Lemma \ref{lemma-stack-equivalences}. Some details omitted.
\end{proof}

\begin{lemma}
\label{lemma-stack-in-groupoids-equivalent}
Let $\mathcal{C}$ be a site.
Let $\mathcal{S}_1$, $\mathcal{S}_2$ be categories over $\mathcal{C}$.
Suppose that $\mathcal{S}_1$ and $\mathcal{S}_2$ are equivalent
as categories over $\mathcal{C}$.
Then $\mathcal{S}_1$ is a stack in groupoids over $\mathcal{C}$ if and only if
$\mathcal{S}_2$ is a stack in groupoids over $\mathcal{C}$.
\end{lemma}

\begin{proof}
Follows by combining
Lemmas \ref{lemma-stack-in-groupoids-stack} and \ref{lemma-stack-equivalent}.
\end{proof}

\noindent
The $2$-category of stacks in groupoids over $\mathcal{C}$
is defined as follows.

\begin{definition}
\label{definition-stacks-in-groupoids-over-C}
Let $\mathcal{C}$ be a site.
The {\it $2$-category of stacks in groupoids over $\mathcal{C}$}
is the sub $2$-category of the $2$-category of stacks
over $\mathcal{C}$ (see Definition \ref{definition-stacks-over-C})
defined as follows:
\begin{enumerate}
\item Its objects will be stacks in groupoids
$p : \mathcal{S} \to \mathcal{C}$.
\item Its $1$-morphisms $(\mathcal{S}, p) \to (\mathcal{S}', p')$
will be functors $G : \mathcal{S} \to \mathcal{S}'$ such that
$p' \circ G = p$. (Since every morphism is strongly cartesian
every functor preserves them.)
\item Its $2$-morphisms $t : G \to H$ for
$G, H : (\mathcal{S}, p) \to (\mathcal{S}', p')$
will be morphisms of functors
such that $p'(t_x) = \text{id}_{p(x)}$
for all $x \in \text{Ob}(\mathcal{S})$.
\end{enumerate}
\end{definition}

\noindent
Note that any $2$-morphism is automatically an isomorphism, so
that in fact the $2$-category of stacks in groupoids over $\mathcal{C}$
is a (strict) $(2,1)$-category.

\begin{lemma}
\label{lemma-2-product-stacks-in-groupoids}
Let $\mathcal{C}$ be a category.
The $2$-category of stacks in groupoids over $\mathcal{C}$
has 2-fibre products, and they are described as in
Categories, Lemma \ref{categories-lemma-2-product-categories-over-C}.
\end{lemma}

\begin{proof}
This is clear from
Categories, Lemma \ref{categories-lemma-2-product-fibred-categories}
and Lemmas \ref{lemma-stack-in-groupoids-stack}
and \ref{lemma-2-product-stacks}.
\end{proof}








\section{Stacks in setoids}
\label{section-stacks-in-setoids}

\noindent
This is just a brief section saying that a stack in sets
is the same thing as a sheaf of sets. Please consult
Categories, Section \ref{categories-section-fibred-in-setoids}
for notation.

\begin{definition}
\label{definition-stack-in-sets}
Let $\mathcal{C}$ be a site.
\begin{enumerate}
\item A {\it stack in setoids} over $\mathcal{C}$
is a stack over $\mathcal{C}$ all of whose fibre categories are
setoids.
\item A {\it stack in sets}, or a {\it stack in discrete categories}
is a stack over $\mathcal{C}$ all of whose fibre categories are discrete.
\end{enumerate}
\end{definition}

\noindent
From the discussion in
Section \ref{section-stacks-in-groupoids}
this is the same thing as a stack in groupoids whose fibre categories
are setoids (resp.\ discrete). Moreover, it is also the same thing
as a category fibred in setoids (resp.\ sets) which is a stack.

\begin{lemma}
\label{lemma-when-stack-in-sets}
Let $\mathcal{C}$ be a site. Under the equivalence
$$
\left\{
\begin{matrix}
\text{the category of presheaves}\\
\text{of sets over }\mathcal{C}
\end{matrix}
\right\}
\leftrightarrow
\left\{
\begin{matrix}
\text{the category of categories}\\
\text{fibred in sets over }\mathcal{C}
\end{matrix}
\right\}
$$
of
Categories, Lemma \ref{categories-lemma-2-category-fibred-sets}
the stacks in sets correspond precisely to the sheaves.
\end{lemma}

\begin{proof}
Omitted. Hint: Show that effectivity of descent corresponds exactly to
the sheaf condition.
\end{proof}

\begin{lemma}
\label{lemma-stack-in-setoids-characterize}
Let $\mathcal{C}$ be a site.
Let $\mathcal{S}$ be a category fibred in setoids over $\mathcal{C}$.
Then $\mathcal{S}$ is a stack in setoids if and only if the unique
equivalent category $\mathcal{S}'$ fibred in sets (see
Categories, Lemma \ref{categories-lemma-setoid-fibres})
is a stack in sets. In other words, if and only if the presheaf
$$
U \longmapsto \text{Ob}(\mathcal{S}_U)/\!\!\cong
$$
is a sheaf.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-stack-in-setoids-equivalent}
Let $\mathcal{C}$ be a site.
Let $\mathcal{S}_1$, $\mathcal{S}_2$ be categories over $\mathcal{C}$.
Suppose that $\mathcal{S}_1$ and $\mathcal{S}_2$ are equivalent
as categories over $\mathcal{C}$.
Then $\mathcal{S}_1$ is a stack in setoids over $\mathcal{C}$ if and only if
$\mathcal{S}_2$ is a stack in setoids over $\mathcal{C}$.
\end{lemma}

\begin{proof}
By
Categories, Lemma \ref{categories-lemma-setoid-fibres}
we see that a category $\mathcal{S}$ over $\mathcal{C}$ is fibred in setoids
over $\mathcal{C}$ if and only if it is equivalent over $\mathcal{C}$
to a category fibred in sets.
Hence we see that $\mathcal{S}_1$ is fibred in setoids over $\mathcal{C}$
if and only if $\mathcal{S}_2$ is fibred in setoids over $\mathcal{C}$.
Hence now the lemma follows from
Lemma \ref{lemma-stack-in-setoids-characterize}.
\end{proof}

\noindent
The $2$-category of stacks in setoids over $\mathcal{C}$
is defined as follows.

\begin{definition}
\label{definition-stacks-in-setoids-over-C}
Let $\mathcal{C}$ be a site.
The {\it $2$-category of stacks in setoids over $\mathcal{C}$}
is the sub $2$-category of the $2$-category of stacks
over $\mathcal{C}$ (see Definition \ref{definition-stacks-over-C})
defined as follows:
\begin{enumerate}
\item Its objects will be stacks in setoids
$p : \mathcal{S} \to \mathcal{C}$.
\item Its $1$-morphisms $(\mathcal{S}, p) \to (\mathcal{S}', p')$
will be functors $G : \mathcal{S} \to \mathcal{S}'$ such that
$p' \circ G = p$. (Since every morphism is strongly cartesian
every functor preserves them.)
\item Its $2$-morphisms $t : G \to H$ for
$G, H : (\mathcal{S}, p) \to (\mathcal{S}', p')$
will be morphisms of functors
such that $p'(t_x) = \text{id}_{p(x)}$
for all $x \in \text{Ob}(\mathcal{S})$.
\end{enumerate}
\end{definition}

\noindent
Note that any $2$-morphism is automatically an isomorphism, so
that in fact the $2$-category of stacks in setoids over $\mathcal{C}$
is a (strict) $(2,1)$-category.

\begin{lemma}
\label{lemma-2-product-stacks-in-setoids}
Let $\mathcal{C}$ be a category.
The $2$-category of stacks in setoids over $\mathcal{C}$
has 2-fibre products, and they are described as in
Categories, Lemma \ref{categories-lemma-2-product-categories-over-C}.
\end{lemma}

\begin{proof}
This is clear from
Categories, Lemmas \ref{categories-lemma-2-product-fibred-categories} and
\ref{categories-lemma-2-product-categories-fibred-setoids}
and
Lemmas \ref{lemma-stack-in-groupoids-stack} and
\ref{lemma-2-product-stacks}.
\end{proof}






\section{The inertia stack}
\label{section-the-inertia-stack}

\noindent
Let $p : \mathcal{S} \to \mathcal{C}$ be a stack over the site $\mathcal{C}$.
Recall that we have defined in
Categories, Definition \ref{categories-definition-inertia-fibred-category}
an {\it inertia fibred category} $I_\mathcal{S} \to \mathcal{C}$ as the
category whose objects are pairs $(x ,\alpha)$ where
$x \in \text{Ob}(\mathcal{S})$ and $\alpha : x \to x$ with
$p(\alpha) = \text{id}_{p(x)}$. This inertia category is actually
a stack over $\mathcal{C}$.

\begin{lemma}
\label{lemma-inertia}
Let $\mathcal{C}$ be a site.
\begin{enumerate}
\item If $\mathcal{S}$ is a stack over $S$,
then so is $I_\mathcal{S}$.
\item If $\mathcal{S}$ is a stack in groupoids over $\mathcal{S}$,
then so is $I_\mathcal{S}$.
\item If $\mathcal{S}$ is a stack in setoids over $\mathcal{S}$,
then so is $I_\mathcal{S}$.
\item If $\mathcal{S}$ is a stack in groupoids, then the
canonical $1$-morphism $\mathcal{I}_\mathcal{S} \to \mathcal{S}$
is an equivalence if and only if $\mathcal{S}$ is a stack in setoids.
\end{enumerate}
\end{lemma}

\begin{proof}
The first three assertions follow from
Lemmas \ref{lemma-2-product-stacks},
\ref{lemma-2-product-stacks-in-groupoids}, and
\ref{lemma-2-product-stacks-in-setoids}
and the equivalence in
Categories, Lemma \ref{categories-lemma-intertia-fibred-category} part (1).
The last assertion follows from
Categories, Lemma \ref{categories-lemma-characterize-fibred-setoids-inertia}.
\end{proof}







\section{Stackification of fibred categories}
\label{section-stackify}

\noindent
Here is the result.

\begin{lemma}
\label{lemma-stackify}
Let $\mathcal{C}$ be a site.
Let $p : \mathcal{S} \to \mathcal{C}$ be a fibred category over $\mathcal{C}$.
There exists a stack $p' : \mathcal{S}' \to \mathcal{C}$ and a
$1$-morphism $G : \mathcal{S} \to \mathcal{S}'$
of fibred categories over $\mathcal{C}$ (see
Categories, Definition \ref{categories-definition-fibred-categories-over-C})
such that
\begin{enumerate}
\item for every $U \in \text{Ob}(\mathcal{C})$, and any
$x, y \in \text{Ob}(\mathcal{S}_U)$ the map
$$
\mathit{Mor}(x, y) \longrightarrow \mathit{Mor}(G(x), G(y))
$$
induced by $G$ identifies the right hand side with the sheafification
of the left hand side, and
\item for every $U \in \text{Ob}(\mathcal{C})$, and any
$x' \in \text{Ob}(\mathcal{S}'_U)$ there exists a covering
$\{U_i \to U\}_{i \in I}$ such that for every $i \in I$ the
object $x'|_{U_i}$ is in the essential image of the
functor $G : \mathcal{S}_U \to \mathcal{S}'_U$.
\end{enumerate}
Moreover the stack $\mathcal{S}'$ is determined up to unique
$2$-isomorphism by these conditions.
\end{lemma}

\begin{proof}[Less naive proof]
Here is a less naive proof.
By Categories, Lemma \ref{categories-lemma-fibred-strict}
there exists an equivalence of
fibred categories $\mathcal{S} \to \mathcal{S}'$ where $\mathcal{S}'$
is a split fibred category, i.e., one in which the pullback
functors compose on the nose. Obviously the lemma for $\mathcal{S}'$
implies the lemma for $\mathcal{S}$. Hence we may think of $\mathcal{S}$
as a presheaf in categories.

\medskip\noindent
Consider the $2$-category $\textit{Cat}$ temporarily as a
category by forgetting about $2$-morphisms.
Let us think of a category as a quintuple
$(\text{Ob}, \text{Arrows}, s, t, \circ)$ as in
Categories, Section \ref{categories-section-definition-categories}.
Consider the forgetful functor
$$
forget : \textit{Cat} \to \textit{Sets}, \quad
(\text{Ob}, \text{Arrows}, s, t, \circ)
\mapsto
\text{Ob} \coprod \text{Arrows}.
$$
Then $forget$ is faithful, $\textit{Cat}$ has limits and
$forget$ commutes with them, $\textit{Cat}$ has directed colimits and
$forget$ commutes with them, and $forget$ reflects isomorphisms.
Hence, according to the first part of
Sites, Section \ref{sites-section-sheaves-algebraic-structures}
we can sheafify presheaves with values in $\textit{Cat}$, and
the result commutes with $forget$. Applying this to
$\mathcal{S}$ we obtain a sheafification $\mathcal{S}^\#$
which has a sheaf of objects and a sheaf of morphisms
both of which are the sheafifications of the corresponding
presheaves for $\mathcal{S}$. In this case it is quite
easy to see that the map $\mathcal{S} \to \mathcal{S}^\#$
has the properties (1) and (2) of the lemma.

\medskip\noindent
However, the category $\mathcal{S}^\#$ may not yet be a
stack since, allthough the presheaf of objects is a sheaf,
the descent condition may not yet be satisfied.
To remedy this we have to add more objects. But the argument
above does reduce us to the case where $\mathcal{S} = \mathcal{S}_F$
for some sheaf(!) $F : \mathcal{C}^{opp} \to \textit{Cat}$ of
categories. In this case consider the functor
$F' : \mathcal{C}^{opp} \to \textit{Cat}$ defined by
\begin{enumerate}
\item The set $\text{Ob}(F'(U))$ is the set of pairs
$(\mathcal{U}, \xi)$ where $\mathcal{U} = \{U_i \to U\}$
is a covering of $U$ and $\xi = (x_i, \varphi_{ii'})$ is
a descent datum relative to $\mathcal{U}$.
\item A morphism in $F'(U)$ from
$(\mathcal{U}, \xi)$ to $(\mathcal{V}, \eta)$
is an element of
$$
\text{colim}\ \text{Mor}_{DD(\mathcal{W})}(a^*\xi, b^*\eta)
$$
where the colimit is over all common refinements
$a : \mathcal{W} \to \mathcal{U}$, $b : \mathcal{W} \to \mathcal{V}$.
This colimit is filtered (verification omitted).
Hence composition of morphisms in $F(U)$ is defined by
finding a common refinement and composing in $DD(\mathcal{W})$.
\item Given $h : V \to U$ and an object
$(\mathcal{U}, \xi)$ of $F'(U)$ we set $F'(h)(\mathcal{U}, \xi)$
equal to $(V \times_U \mathcal{U}, \text{pr}_1^*\xi)$.
More precisely, if $\mathcal{U} = \{U_i \to U\}$
and $\xi = (x_i, \varphi_{ii'})$, then
$V \times_U \mathcal{U} = \{V \times_U U_i \to V\}$
which comes with a canonical morphism
$\text{pr}_1 : V \times_U \mathcal{U} \to \mathcal{U}$ and
$\text{pr}_1^*\xi$ is the pullback of $\xi$ with respect to
this morphism (see Definition \ref{definition-pullback-functor}).
\item Given $h : V \to U$, objects $(\mathcal{U}, \xi)$ 
and $(\mathcal{V}, \eta)$ and a morphism between them, represented by
$a : \mathcal{W} \to \mathcal{U}$, $b : \mathcal{W} \to \mathcal{V}$,
and $\alpha : a^*\xi \to b^*\eta$, then $F'(h)(\alpha)$ is
represented by
$a' : V\times_U\mathcal{W} \to V\times_U\mathcal{U}$,
$b' : V\times_U\mathcal{W} \to V\times_U\mathcal{V}$,
and the pullback $\alpha'$ of the morphism $\alpha$ via
the map $V \times_U \mathcal{W} \to \mathcal{W}$. This works
since pullbacks in $\mathcal{S}_F$ commute on the nose.
\end{enumerate}
There is a map $F \to F'$ given by associating to
an object $x$ of $F(U)$ the object $(\{U \to U\}, (x, triv))$ of
$F'(U)$. At this point you have to check that the corresponding
functor $\mathcal{S}_F \to \mathcal{S}_{F'}$ has properties (1)
and (2) of the lemma, and finally that $\mathcal{S}_{F'}$ is
a stack. Details omitted.
\end{proof}

\begin{proof}[Proof by naive method]
In this proof method we proceed in stages:

\medskip\noindent
First, given $x$ lying over $U$ and any object $y$ of
$\mathcal{S}$, we say that two morphisms
$a, b : x \to y$ of $\mathcal{S}$
lying over the same arrow of $\mathcal{C}$
are {\it locally equal}
if there exists a covering $\{f_i : U_i \to U\}$ of $\mathcal{C}$
such that the compositions
$$
f_i^*x \to x \xrightarrow{a} y,
\quad
f_i^*x \to x \xrightarrow{b} y
$$
are equal. This gives an equivalence relation $\sim$
on arrows of $\mathcal{S}$. If $b \sim b'$ then
$a \circ b \circ c \sim a \circ b' \circ c$ (verification omitted).
Hence we can quotient out by this equivalence relation to
obtain a new category $\mathcal{S}^1$ over $\mathcal{C}$
to gether with a morphism $G^1 : \mathcal{S} \to \mathcal{S}^1$.

\medskip\noindent
One checks that $G^1$ preserves strongly cartesian morphisms
and that $\mathcal{S}^1$ is a fibred category over $\mathcal{C}$.
Checks omitted. Thus we reduce to the case where locally equal
morphisms are equal.

\medskip\noindent
Next, we add morphisms as follows. Given
$x$ lying over $U$ and any object $y$ of lying over $V$
a {\it locally defined morphism from $x$ to $y$} is given by
\begin{enumerate}
\item a morphism $f : U \to V$,
\item a covering $\{f_i : U_i \to U\}$ of $U$, and
\item morphisms $a_i : f_i^*x \to Y$ with $p(a_i) = h \circ f_i$
\end{enumerate}
with the property that the compositions
$$
(f_i \times f_j)^*x \to f_i^*x \xrightarrow{a_i} y,
\quad
(f_i \times f_j)^*x \to f_j^*x \xrightarrow{a_j} y
$$
are equal. Note that a usual morphism $a : x \to y$ gives a locally
defined morphism $(p(a) : U \to V, \{\text{id}_U\}, a)$.
We say two locally defined morphisms
$(f, \{f_i : U_i \to U\}, a_i)$ and $(g, \{g_j : U_i \to U\}, b_j)$
are {\it equal} if $f = g$ and the compositions
$$
(f_i \times g_j)^*x \to f_i^*x \xrightarrow{a_i} y,
\quad
(f_i \times g_j)^*x \to g_j^*x \xrightarrow{b_j} y
$$
are equal (this is the right condition since we are in the
situation where locally equal morphisms are equal).
To compose locally defined morphisms
$(f, \{f_i : U_i \to U\}, a_i)$ from $x$ to $y$ and
$(g, \{g_j : V_j \to V\}, b_j)$ from $y$ to $z$ lying over $W$,
just take $g \circ f : U \to W$, the covering
$\{U_i \times_V V_j \to U\}$, and as maps the compositions
$$
x|_{U_i \times_V V_j}
\xrightarrow{\text{pr}_0^*a_i}
y|_{V_j}
\xrightarrow{b_j}
z
$$
We omit the verification that this is a locally defined morphism.

\medskip\noindent
One checks that $\mathcal{S}^2$ with the same objects as
$\mathcal{S}$ and with locally defined morphisms as morphisms
is a category over $\mathcal{C}$, that there is a functor
$G^2 : \mathcal{S} \to \mathcal{S}^2$ over $\mathcal{C}$,
that this functor preserves strongly cartesian objects,
and that $\mathcal{S}^2$ is a fibred category over $\mathcal{C}$.
Checks omitted. This reduces one to the case where the
morphism presheaves of $\mathcal{S}$ are all sheaves, by
checking that the effect of using locally defined morphisms
is to take the sheafification of the (separated) morphisms
presheaves.

\medskip\noindent
Finally, in the case where the morphism presheaves are all sheaves
we have to add objects in order to make sure descent conditions are
effective in the end result. The simplest way to do this is to
consider the category $\mathcal{S}'$ whose objects are
pairs $(\mathcal{U}, \xi)$ where
$\mathcal{U} = \{U_i \to U\}$ is a covering of $\mathcal{C}$ and
$\xi = (X_i, \varphi_{ii'})$ is a descent datum relative $\mathcal{U}$.
Suppose given two such data
$(\mathcal{U}, \xi) = (\{f_i : U_i \to U\},  x_i, \varphi_{ii'})$ and
$(\mathcal{V}, \eta) = (\{g_j : V_j \to V\},  y_j, \psi_{jj'})$.
We define
$$
\text{Mor}_{\mathcal{S}'}((\mathcal{U}, \xi), (\mathcal{V}, \eta))
$$
as the set of $(f, a_{ij})$, where $f : U \to V$ and
$$
a_{ij} :
x_i|_{U_i \times_V V_j}
\longrightarrow 
y_j
$$
are morphisms of $\mathcal{S}$ lying over $U_i \times_V V_j \to V_j$.
These have to satisfy the following condition: for any
$i, i' \in I$ and $j, j' \in J$ set 
$W = (U_i \times_U U_{i'}) \times_V (V_j \times_V V_{j'})$. Then
$$
\xymatrix{
x_i|_W \ar[r]_{a_{ij}|_W} \ar[d]_{\varphi_{ii'}|_W} &
y_j|_W \ar[d]^{\psi_{jj'}|_W} \\
x_{i'}|_W \ar[r]^{a_{i'j'}|_W} &
y_{j'}|_W
}
$$
commutes. At this point you have to verify the following things:
\begin{enumerate}
\item there is a well defined composition on morphisms as above,
\item this turns $\mathcal{S}'$ into a category over $\mathcal{C}$,
\item there is a functor $G : \mathcal{S} \to \mathcal{S}'$ over $\mathcal{C}$,
\item for $x, y$ objects of $\mathcal{S}$ we have
$\text{Mor}_{\mathcal{S}}(x, y) = \text{Mor}_{\mathcal{S}'}(G(x), G(y))$,
\item any object of $\mathcal{S}'$ locally comes from an object of
$\mathcal{S}$, i.e., part (2) of the lemma holds,
\item $G$ preserves strongly cartesian morphisms,
\item $\mathcal{S}'$ is a fibred category over $\mathcal{C}$, and
\item $\mathcal{S}'$ is a stack over $\mathcal{C}$.
\end{enumerate}
This is all not hard but there is a lot of it. Details omitted.
\end{proof}

\begin{lemma}
\label{lemma-stackify-universal-property}
Let $\mathcal{C}$ be a site.
Let $p : \mathcal{S} \to \mathcal{C}$ be a fibred category over $\mathcal{C}$.
Let $p' : \mathcal{S}' \to \mathcal{C}$ and $G : \mathcal{S} \to \mathcal{S}'$
the the stack and $1$-morphism constructed in Lemma \ref{lemma-stackify}.
This construction has the following universal property: Given a stack
$q : \mathcal{X} \to \mathcal{C}$ and a $1$-morphism
$F : \mathcal{S} \to \mathcal{S}'$ of fibred categories over $\mathcal{C}$
there exists a $1$-morphism $H : \mathcal{S}' \to \mathcal{X}$
such that the diagram
$$
\xymatrix{
\mathcal{S} \ar[rr]_F \ar[rd]_G & & \mathcal{X} \\
& \mathcal{S}' \ar[ru]_H
}
$$
is $2$-commutative.
\end{lemma}

\begin{proof}
Omitted. Hint: Suppose that $x' \in \text{Ob}(\mathcal{S}'_U)$.
By the result of Lemma \ref{lemma-stackify}
there exists a covering $\{U_i \to U\}_{i \in I}$
such that $x'|_{U_i} = G(x_i)$ for some $x_i \in \text{Ob}(\mathcal{S}_{U_i})$.
Moreover, there exist coverings $\{U_{ijk} \to U_i \times_U U_j\}$
and isomorphisms $\alpha_{ijk} : x_i|_{U_{ijk}} \to x_j|_{U_{ijk}}$
with $G(\alpha_{ijk}) = \text{id}_{x'|_{U_{ijk}}}$. Set $y_i = F(x_i)$.
Then you can check that
$$
F(\alpha_{ijk}) : y_i|_{U_{ijk}} \to y_j|_{U_{ijk}}
$$
agree on overlaps and therefore (as $\mathcal{X}$ is a stack) define
a morphism $\beta_{ij} : y_i|_{U_i \times_U U_j} \to y_j|_{U_i \times_U U_j}$.
Next, you check that the $\beta_{ij}$ define a descent datum. Since
$\mathcal{X}$ is a stack these descent data are effective and we find
an object $y$ of $\mathcal{X}_U$ agreeing with $G(x_i)$ over $U_i$.
The hint is to set $H(x') = y$.
\end{proof}








\section{Stackification of categories fibred in groupoids}
\label{section-stackify-groupoids}

\noindent
Here is the result.

\begin{lemma}
\label{lemma-stackify-groupoids}
Let $\mathcal{C}$ be a site.
Let $p : \mathcal{S} \to \mathcal{C}$ be a category
fibred in groupoids over $\mathcal{C}$.
There exists a stack in groupoids
$p' : \mathcal{S}' \to \mathcal{C}$ and a
$1$-morphism $G : \mathcal{S} \to \mathcal{S}'$
of categories fibred in groupoids over $\mathcal{C}$ (see
Categories, Definition
\ref{categories-definition-categories-fibred-in-groupoids-over-C})
such that
\begin{enumerate}
\item for every $U \in \text{Ob}(\mathcal{C})$, and any
$x, y \in \text{Ob}(\mathcal{S}_U)$ the map
$$
\mathit{Mor}(x, y) \longrightarrow \mathit{Mor}(G(x), G(y))
$$
induced by $G$ identifies the right hand side with the sheafification
of the left hand side, and
\item for every $U \in \text{Ob}(\mathcal{C})$, and any
$x' \in \text{Ob}(\mathcal{S}'_U)$ there exists a covering
$\{U_i \to U\}_{i \in I}$ such that for every $i \in I$ the
object $x'|_{U_i}$ is in the essential image of the
functor $G : \mathcal{S}_U \to \mathcal{S}'_U$.
\end{enumerate}
Moreover the stack in groupoids $\mathcal{S}'$ is determined up to unique
$2$-isomorphism by these conditions.
\end{lemma}

\begin{proof}
Apply Lemma \ref{lemma-stackify}. The result will be a
stack in groupoids by applying Lemma \ref{lemma-stack-in-groupoids-stack}.
\end{proof}

\begin{lemma}
\label{lemma-stackify-groupoids-universal-property}
Let $\mathcal{C}$ be a site.
Let $p : \mathcal{S} \to \mathcal{C}$ be a category fibred in groupoids
over $\mathcal{C}$. Let $p' : \mathcal{S}' \to \mathcal{C}$ and
$G : \mathcal{S} \to \mathcal{S}'$
the the stack in groupoids and $1$-morphism constructed in
Lemma \ref{lemma-stackify-groupoids}.
This construction has the following universal property: Given a stack
in groupoids $q : \mathcal{X} \to \mathcal{C}$ and a $1$-morphism
$F : \mathcal{S} \to \mathcal{S}'$ of categories over $\mathcal{C}$
there exists a $1$-morphism $H : \mathcal{S}' \to \mathcal{X}$
such that the diagram
$$
\xymatrix{
\mathcal{S} \ar[rr]_F \ar[rd]_G & & \mathcal{X} \\
& \mathcal{S}' \ar[ru]_H
}
$$
is $2$-commutative.
\end{lemma}

\begin{proof}
This is a special case of
Lemma \ref{lemma-stackify-universal-property}.
\end{proof}




\input{chapters}


\bibliography{my}
\bibliographystyle{amsalpha}

\end{document}
