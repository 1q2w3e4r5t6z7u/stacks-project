\input{preamble}

% OK, start here.
%
\begin{document}

\title{Pro-\'etale Cohomology}


\maketitle

\phantomsection
\label{section-phantom}

\tableofcontents

\section{Introduction}
\label{section-introduction}

\noindent
The material in this chapter and more can be found in the preprint \cite{BS}.

\medskip\noindent
The goal of this chapter is to introduce the pro-\'etale topology and
show how it simplifies the introduction of $\ell$-adic cohomology in
algebraic geometry.





\section{Some topology}
\label{section-topology}

\noindent
Some preliminaries. We have defined {\it spectral spaces} and
{\it spectral maps} of spectral spaces in
Toplogy, Section \ref{topology-section-spectral}.
The spectrum of a ring is a spectral space, see
Algebra, Lemma \ref{algebra-lemma-spec-spectral}.

\begin{lemma}
\label{lemma-spectral-split}
Let $X$ be a spectral space. Let $X_0 \subset X$ be the set of closed points.
The following are equivalent
\begin{enumerate}
\item Every open covering of $X$ can be refined by a finite
disjoint union decomposition $X = \coprod U_i$ with $U_i$
open and closed in $X$.
\item The composition $X_0 \to X \to \pi_0(X)$ is bijective.
\end{enumerate}
Moreover, if $X_0$ is closed in $X$ and every point of $X$ specializes
to a unique point of $X_0$, then these conditions are satisfied.
\end{lemma}

\begin{proof}
We will use without further mention that
$X_0$ is quasi-compact
(Topology, Lemma \ref{topology-lemma-closed-points-quasi-compact})
and $\pi_0(X)$ is profinite
(Topology, Lemma \ref{topology-lemma-spectral-pi0}).
Picture
$$
\xymatrix{
X_0 \ar[rd]_f \ar[r] & X \ar[d]^\pi \\
& \pi_0(X)
}
$$
If (2) holds, the continuous bijective map $f : X_0 \to \pi_0(X)$ is
a homeomorphism by
Topology, Lemma \ref{topology-lemma-bijective-map}.
Given an open covering $X = \bigcup U_i$, we get an open covering
$\pi_0(X) = \bigcup f(X_0 \cap U_i)$. By
Topology, Lemma \ref{topology-lemma-profinite-refine-open-covering}
we can find a finite open covering of the form $\pi_0(X) = \coprod V_j$
which refines this covering.
Since $X_0 \to \pi_0(X)$ is bijective each connected component of
$X$ has a unique closed point, whence is equal to the set of points
specializing to this closed point. Hence $\pi^{-1}(V_j)$ is the
set of points specializing to the points of $f^{-1}(V_j)$.
Now, if $f^{-1}(V_j) \subset X_0 \cap U_i \subset U_i$, then
it follows that $\pi^{-1}(V_j) \subset U_i$ (because the open set
$U_i$ is closed under generalizations). In this way we see
that the open covering $X = \coprod \pi^{-1}(V_j)$ refines
the covering we started out with. In this way we see that
(2) implies (1).

\medskip\noindent
Assume (1). Let $x, y \in X$ be closed points. Then we have the open covering
$X = (X \setminus \{x\}) \cup (X \setminus \{y\})$.
It follows from (1) that there exists a disjoint union decomposition
$X = U \amalg V$ with $U$ and $V$ open (and closed) and $x \in U$ and
$y \in V$. In particular we see that every connected component of $X$
has at most one closed point. By
Topology, Lemma \ref{topology-lemma-quasi-compact-closed-point}
every connected component (being closed) also does have a closed point.
Thus $X_0 \to \pi_0(X)$ is bijective. In this way we see that (1) implies (2).

\medskip\noindent
Assume $X_0$ is closed in $X$ and every point specializes to a unique
point of $X_0$. Then $X_0$ is a spectral space
(Topology, Lemma \ref{topology-lemma-spectral-sub})
consisting of closed points, hence profinite
(Topology, Lemma \ref{topology-lemma-characterize-profinite-spectral}).
Let $x, y \in X_0$ be distinct. By
Topology, Lemma \ref{topology-lemma-profinite-refine-open-covering}
we can find a disjoint union decomposition
$X_0 = U_0 \amalg V_0$ with $U_0$ and $V_0$ open and closed.
Let $\{U_i\}$ be the set of quasi-compact open subsets of $X$
such that $U_0 = X_0 \cap U_i$. Similarly, let $\{V_j\}$ be the
set of quasi-compact open subsets of $X$ such that
and $V_0 = X_0 \cap V_j$. If $U_i \cap V_j$ is nonempty for all $i, j$,
then there exists a point $\xi$ contained in all of them
(use the $U_i \cap V_j$ is constructible, hence closed in the
constructible topology, and use
Topology, Lemmas \ref{topology-lemma-constructible-hausdorff-quasi-compact} and
\ref{topology-lemma-intersection-closed-in-quasi-compact}).
However, since $X$ is sober and $V_0$ is closed in $X$,
the intersection $\bigcap U_i$ is the set of points specializing to $U_0$.
Similarly, $\bigcap V_j$ is the set of points specializing to $V_0$.
Since $U_0 \cap V_0$ is empty this is a contradiction.
Thus we find disjoint quasi-compact opens $U, V \subset X$
such that $U_0 = X_0 \cap U$ and $V_0 = X_0 \cap V$.
Observe that $X = U \cup V = U \amalg V$ as
$X_0 \subset U \cup V$ (use
Topology, Lemma \ref{topology-lemma-quasi-compact-closed-point}).
This proves that $x, y$ are not in the same connected component of $X$.
In other words, $X_0 \to \pi_0(X)$ is injective. The map is also
surjective by
Topology, Lemma \ref{topology-lemma-quasi-compact-closed-point}
and the fact that connected components are closed.
In this way we see that the final condition implies (1).
\end{proof}

\begin{example}
\label{example-not-w-local}
Let $T$ be a profinite space. Let $t \in T$ be a point and assume
that $T \setminus \{t\}$ is not quasi-compact.
Let $X = T \times \{0, 1\}$. Consider the topology on $X$
with a subbase given by the sets
$U \times \{0, 1\}$ for $U \subset T$ open, $X \setminus \{(t, 0)\}$,
and $U \times \{1\}$ for $U \subset T$ open with $t \not \in U$.
The set of closed points of $X$ is $X_0 = T \times \{0\}$ and
$(t, 1)$ is in the closure of $X_0$.
Moreover, $X_0 \to \pi_0(X)$ is a bijection.
This example shows that conditions (1) and (2) of
Lemma \ref{lemma-spectral-split} do no imply the set of closed points
is closed.
\end{example}

\noindent
It turns out it is more convenient to work with spectral
spaces which have the slightly stronger property mentioned in
the final statement of Lemma \ref{lemma-spectral-split}.
We give this property a name.

\begin{definition}
\label{definition-w-local}
A spectral space $X$ is {\it w-local} if the set of closed points $X_0$
is closed and every point of $X$ specializes to a unique closed point.
A continuous map $f : X \to Y$ of w-local spaces is {\it w-local}
if it is spectral and maps any closed point of $X$ to a closed point of $Y$.
\end{definition}

\noindent
We have seen in the proof of Lemma \ref{lemma-spectral-split}
that in this case $X_0 \to \pi_0(X)$ is a homeomorphism and that
$X_0 \cong \pi_0(X)$ is a profinite space. Moreover, a connected
component of $X$ is exactly the set of points specializing to
a given $x \in X_0$.

\begin{lemma}
\label{lemma-silly}
Let $X$ be a spectral space. Let
$$
\xymatrix{
Y \ar[r] \ar[d] & T \ar[d] \\
X \ar[r] & \pi_0(X)
}
$$
be a cartesian diagram in the category of topological spaces
with $T$ profinite. Then $Y$ is spectral and $T = \pi_0(Y)$.
If moreover $X$ is w-local, then $Y$ is w-local, $Y \to X$ is w-local,
and the set of closed points of $Y$ is the inverse image of the
set of closed points of $X$.
\end{lemma}

\begin{proof}
Note that $Y$ is a closed subspace of $X \times T$ as $\pi_0(X)$
is a profinite space hence Hausdorff
(use Topology, Lemmas \ref{topology-lemma-spectral-pi0} and
\ref{topology-lemma-fibre-product-closed}).
Since $X \times T$ is spectral
(Topology, Lemma \ref{topology-lemma-product-spectral-spaces})
it follows that $Y$ is spectral
(Topology, Lemma \ref{topology-lemma-spectral-sub}).
Let $Y \to \pi_0(Y) \to T$ be the canonical factorization
(Topology, Lemma \ref{topology-lemma-space-connected-components}).
It is clear that $\pi_0(Y) \to T$ is surjective.
The fibres of $Y \to T$ are homeomorphic to the fibres of
$X \to \pi_0(X)$. Hence these fibres are connected. It follows
that $\pi_0(Y) \to T$ is injective. We conclude that $\pi_0(Y) \to T$
is a homeomorphism by
Topology, Lemma \ref{topology-lemma-bijective-map}.

\medskip\noindent
Next, assume that $X$ is w-local and let $X_0 \subset X$ be the
set of closed points. The inverse image $Y_0 \subset Y$ of $X_0$ in
$Y$ maps bijectively onto $T$ as $X_0 \to \pi_0(X)$ is a bijection
by Lemma \ref{lemma-spectral-split}. Moreover, $Y_0$ is quasi-compact
as a closed subset of the spectral space $Y$. Hence
$Y_0 \to \pi_0(Y) = T$ is a homeomorphism by
Topology, Lemma \ref{topology-lemma-bijective-map}.
It follows that all points of $Y_0$ are closed in $Y$.
Conversely, if $y \in Y$ is a closed point, then
it is closed in the fibre of $Y \to \pi_0(Y) = T$
and hence its image $x$ in $X$ is closed in the (homeomorphic) fibre of
$X \to \pi_0(X)$. This implies $x \in X_0$ and hence $y \in Y_0$.
Thus $Y_0$ is the collection of closed points of $Y$
and for each $y \in Y_0$ the set of generalizations of $y$ is
the fibre of $Y \to \pi_0(Y)$. The lemma follows.
\end{proof}




\section{Local isomorphisms}
\label{section-local-isomorphism}

\noindent
We start with a defintion.

\begin{definition}
\label{definition-local-isomorphism}
Let $\varphi : A \to B$ be a ring map.
\begin{enumerate}
\item We say $A \to B$ is a {\it local isomorphism} if for every prime
$\mathfrak q \subset B$ there exists a $g \in B$, $g \not \in \mathfrak q$
such that $A \to B_g$ induces an open immersion $\Spec(B_g) \to \Spec(A)$.
\item We say $A \to B$ {\it identifies local rings} if for every prime
$\mathfrak q \subset B$ the canonical map
$A_{\varphi^{-1}(\mathfrak q)} \to B_\mathfrak q$ is an isomorphism.
\end{enumerate}
\end{definition}

\noindent
We list some elementary properties.

\begin{lemma}
\label{lemma-local-isomorphism}
Properties of local isomorphisms.
\begin{enumerate}
\item The composition of two local isomorphisms is a local isomorphism.
\item The base change of a local isomorphism is a local isomorphism.
\item If $A \to B$ and $A \to C$ are local isomorphisms, then any $A$-algebra
map $B \to C$ is a local isomorphism.
\item A local isomorphism is \'etale.
\item A local isomorphism is quasi-finite.
\end{enumerate}
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-structure-local-isomorphism}
Let $A \to B$ be a local isomorphism. Then there exist $n \geq 0$,
$g_1, \ldots, g_n \in B$, $f_1, \ldots, f_n \in A$ such that
$(g_1, \ldots, g_n) = B$ and $A_{f_i} \cong B_{g_i}$.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-fully-faithful-spaces-over-X}
Let $(X, \mathcal{O}_X)$ be a locally ringed space.
Let $\mathcal{C}$ be the full
subcategory of the category of locally ringed spaces
$(Y, \mathcal{O}_Y)$ over $(X, \mathcal{O}_X)$ such that
$\mathcal{O}_Y = p^{-1}\mathcal{O}_X$ where $p : Y \to X$
is the structure morphism. The functor
$$
\mathcal{C} \longrightarrow \textit{Top}/X,\quad
(Y, \mathcal{O}_Y) \longmapsto Y
$$
is fully faithful.
\end{lemma}

\begin{proof}
This is immediate from the definitions.
\end{proof}

\begin{lemma}
\label{lemma-local-isomorphism-fully-faithful}
Let $A$ be a ring. Set $X = \Spec(A)$. The functor
$$
B \longmapsto \Spec(B)
$$
from the category of $A$-algebras $B$ such that $A \to B$ identifies
local rings to the category of
topological spaces over $X$ is fully faithful.
\end{lemma}

\begin{proof}
This follows from Lemma \ref{lemma-fully-faithful-spaces-over-X}
and the fact that if $A \to B$ identifies local rings, then the pullback
of the structure sheaf of $\Spec(A)$ via $p : \Spec(B) \to \Spec(A)$
is equal to the structure sheaf of $\Spec(B)$.
\end{proof}




\section{Ind-Zariski algebra}
\label{section-ind-zariski}

\noindent
We start with a defintion.

\begin{definition}
\label{definition-ind-zariski}
A ring map $A \to B$ is said to be {\it ind-Zariski} if $B$ can be written
as a filtered colimit $B = \colim B_i$ with each $A \to B_i$ a local
isomorphism.
\end{definition}

\noindent
An example of an Ind-Zariski map is a localization $A \to S^{-1}A$, see
Algebra, Lemma \ref{algebra-lemma-localization-colimit}.
The category of ind-Zariski algebras is closed under several natural
operations.

\begin{lemma}
\label{lemma-ind-zariski}
Properties of ind-Zariski maps.
\begin{enumerate}
\item The composition of two ind-Zariski maps is ind-Zariski.
\item The base change of an ind-Zariski map is another.
\item If $A \to B$ and $A \to C$ are ind-Zariski, then $A \to B \times C$
is ind-Zariski.
\item An ind-Zariski ring maps identifies local rings.
\end{enumerate}
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-ind-ind-zariski}
A filtered colimit of ind-Zariski $A$-algebras is ind-Zariski over $A$.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-ind-permanence-zariski}
Let $A$ be a ring. Let $B \to C$ be an $A$-algebra map of ind-Zariski
$A$-algebras. Then $C$ is an ind-Zariski $B$-algebra.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-localization}
Let $A$ be a ring. Set $X = \Spec(A)$. Let $Z \subset X$ be a locally closed
subscheme which of the form $D(f) \cap V(I)$ for some $f \in A$ and
ideal $I \subset A$. Then
\begin{enumerate}
\item there exists a multiplicative subset $S \subset A$ such that
$\Spec(S^{-1}A)$ maps isomorphically to the set of points of $X$
specializing to $Z$,
\item the $A$-algebra $A_Z^\sim = S^{-1}A$ depends only on
the underlying locally closed subset $Z \subset X$,
\item $Z$ is a closed subscheme of $\Spec(A_Z^\sim)$,
\end{enumerate}
If $A \to A'$ is a ring map and $Z' \subset X' = \Spec(A')$ is a
locally closed subscheme of the same form which maps into $Z$,
then there is a unique $A$-algebra map
$A_Z^\sim \to (A')_{Z'}^\sim$.
\end{lemma}

\begin{proof}
Let $S \subset A$ be the multiplicative set of elements which map
to invertible elements of $\Gamma(Z, \mathcal{O}_Z) = (A/I)_f$.
If $\mathfrak p$ is a prime of $A$ which does not specialize to $Z$,
then $\mathfrak p$ generates the unit ideal in $(A/I)_f$. Hence
we can write $f^n =  g + h$ for some $n \geq 0$, $g \in \mathfrak p$,
$h \in I$. Then $g \in S$ and we see that $\mathfrak p$ is not in
the spectrum of $S^{-1}A$. Conversely, if $\mathfrak p$ does specialize
to $Z$, say $\mathfrak p \subset \mathfrak q \supset I$ with
$f \not \in \mathfrak q$, then we see that $S^{-1}A$ maps to
$A_\mathfrak q$ and hence $\mathfrak p$ is in the spectrum of $S^{-1}A$.
This proves (1).

\medskip\noindent
The isomorphism class of the localization $S^{-1}A$ depends only
on the corresponding subset $\Spec(S^{-1}A) \subset \Spec(A)$, whence
(2) holds. By construction $S^{-1}A$ maps surjectively onto
$(A/I)_f$, hence (3). The final statement follows as the multiplicative subset
$S' \subset A'$ corresponding to $Z'$ contains the image of the
multiplicative subset $S$.
\end{proof}

\noindent
Let $A$ be a ring. Let $E \subset A$ be a finite subset. We get a
stratification of $X = \Spec(A)$ into locally closed subschemes by
looking at the vanishing behaviour of the elements of $E$. More precisely,
given a disjoint union decomposition $E = E' \amalg E''$ we set
\begin{equation}
\label{equation-stratum}
Z(E', E'') =
\bigcap\nolimits_{f \in E'} D(f) \cap \bigcap\nolimits_{f \in E''} V(f) =
D(\prod\nolimits_{f \in E'} f) \cap V( \sum\nolimits_{f \in E''} fA)
\end{equation}
The points of $Z(E', E'')$ are exactly those $x \in X$ such that
$f \in E'$ maps to a nonzero element in $\kappa(x)$ and $f \in E''$
maps to zero in $\kappa(x)$. Thus it is clear that
\begin{equation}
\label{equation-stratify}
X = \coprod\nolimits_{E = E' \amalg E''} Z(E', E'')
\end{equation}
set theoretically. Observe that each stratum is constructible.

\begin{lemma}
\label{lemma-refine}
Let $X = \Spec(A)$ as above. Given any finite stratification
$X = \coprod T_i$ by constructible subsets, there exists a finite
subset $E \subset A$ such that the stratification (\ref{equation-stratify})
refines $X = \coprod T_i$.
\end{lemma}

\begin{proof}
We may write $T_i = \bigcup_j U_{i, j} \cap V_{i, j}^c$ as a finite union
for some $U_{i, j}$ and $V_{i, j}$ quasi-compact open in $X$.
Then we may write $U_{i, j} = \bigcup D(f_{i, j, k})$ and
$V_{i, j} = \bigcup D(g_{i, j, l})$. Then we set
$E = \{f_{i, j, k}\} \cup \{g_{i, j, l}\}$. This does the job, because
the stratification (\ref{equation-stratify}) is the one whose strata are
labeled by the vanishing pattern of the elements of $E$ which
clearly refines the given stratification.
\end{proof}

\noindent
We continue the discussion.
Given a finite subset $E \subset A$ we set
\begin{equation}
\label{equation-ring}
B_E = \prod\nolimits_{E = E' \amalg E''} A_{Z(E', E'')}^\sim
\end{equation}
with notation as in Lemma \ref{lemma-localization}. This makes sense because
(\ref{equation-stratum}) shows that each $Z(E', E'')$ has the correct shape.
We take the spectrum of this ring and denote it
\begin{equation}
\label{equation-spectrum}
X_E = \Spec(B_E) = \coprod\nolimits_{E = E' \amalg E''} X_{E', E''}
\end{equation}
with $X_{E', E''} = \Spec(A_{Z(E', E'')}^\sim)$. Note that
\begin{equation}
\label{equation-closed}
Z_E = \coprod\nolimits_{E = E' \amalg E''} Z(E', E'')
\longrightarrow
X_E
\end{equation}
is a closed subscheme. By construction the closed subscheme $Z_E$
contains all the closed points of the affine scheme $X_E$ as every point
of $X_{E', E''}$ specializes to a point of $Z(E', E'')$.

\medskip\noindent
Let $I(A)$ be the partially ordered set of all finite subsets of $A$.
This is a directed partially ordered set. For $E_1 \subset E_2$ there
is a canonical transition map $B_{E_1} \to B_{E_2}$ of $A$-algebras.
Namely, given a decomposition $E_2 = E'_2 \amalg E''_2$ we set
$E'_1 = E_1 \cap E'_2$ and $E''_1 = E_1 \cap E''_2$. Then observe that
$Z(E'_1, E''_1) \subset Z(E'_2, E''_2)$ hence a unique $A$-algebra map
$A_{Z(E'_1, E''_1)}^\sim \to A_{Z(E'_2, E''_2)}^\sim$ by
Lemma \ref{lemma-localization}. Using these maps collectively we obtain
the desired ring map $B_{E_1} \to B_{E_2}$. Observe that the corresponding
map of affine schemes
\begin{equation}
\label{equation-transition}
X_{E_2} \longrightarrow X_{E_1}
\end{equation}
maps $Z_{E_2}$ into $Z_{E_1}$. By uniqueness we obtain a system of
$A$-algebras over $I(A)$ and we set
\begin{equation}
\label{equation-colimit-ring}
B = \colim_{E \in I(A)} B_E
\end{equation}
This $A$-algebra is ind-Zariski and faithfully flat over $A$.
Finally, we set $Y = \Spec(B)$ and endow it with the closed subscheme
$Z = \lim_{E \in I(A)} Z_E$. In a formula
\begin{equation}
\label{equation-final}
Y = \lim_{E \in I(A)} X_E \supset Z = \lim_{E \in I(A)} Z_E
\end{equation}

\begin{lemma}
\label{lemma-make-w-local}
Let $X = \Spec(A)$ be an affine scheme. With $A \to B$, $Y = \Spec(B)$,
and $Z \subset Y$ as above.
\begin{enumerate}
\item $A \to B$ is ind-Zariski and faithfully flat,
\item $Y \to X$ induces a bijection $Z \to X$,
\item $Z$ is the set of closed points of $Y$,
\item $Z$ is a reduced scheme, and
\item every point of $Y$ specializes to a unique point of $Z$.
\end{enumerate}
In other words, $Y$ is a w-local space (Definition \ref{definition-w-local}).
\end{lemma}

\begin{proof}
The map $A \to B$ is ind-Zariski by construction. Each ring map
$A \to B_E$ is faithfully flat as it is flat and surjective on spectra
(Algebra, Lemma \ref{algebra-lemma-ff-rings}). Hence $B = \colim B_E$ is
faithfully flat by
Algebra, Lemma \ref{algebra-lemma-colimit-faithfully-flat}.
For every $E$ the morphism $Z_E \to X$ is a bijection, hence (2).

\medskip\noindent
Suppose that $y \in Y$, $y \not \in Z$. Then there
exists an $E$ such that the image of $y$ in $X_E$ is not contained in
$Z_E$. Then for all $E \subset E'$ also $y$ maps to an element of $X_{E'}$
not contained in $Z_{E'}$. Let $T_{E'} \subset X_{E'}$ be the reduced
closed subscheme which is the closure of the image of $y$. It is
clear that $T = \lim_{E \subset E'} T_{E'}$ is the closure of $y$ in $Y$.
For every $E \subset E'$ the scheme $T_{E'} \cap Z_{E'}$ is nonempty
by construction of $X_{E'}$. Hence $\lim T_{E'} \cap Z_{E'}$ is nonempty
and we conclude that $T \cap Z$ is nonempty. Thus $y$ is not a closed point.
It follows that every closed point of $Y$ is in $Z$.

\medskip\noindent
Suppose that $y \in Y$ specializes to $z, z' \in Z$. We will show that
$z = z'$ which will finish the proof of (3) and will imply (5).
Let $x, x' \in X$ be the images of $z$ and $z'$. Since $Z \to X$ is
bijective it suffices to show that $x = x'$. If $x \not = x'$, then
there exists an $f \in A$ such that $x \in D(f)$ and $x' \in V(f)$
(or vice versa). Set $E = \{f\}$ so that
$$
X_E = \Spec(A_f) \amalg \Spec(A_{V(f)}^\sim)
$$
Then we see that $z$ and $z'$ map $x_E$ and $x'_E$ which are in different
parts of the given decomposition of $X_E$ above. But then it impossible
for $x_E$ and $x'_E$ to be specializations of a common point.
This is the desired contradition.

\medskip\noindent
Recall that given a finite subset $E \subset A$ we have $Z_E$
is a disjoint union of the locally closed subschemes $Z(E', E'')$
each isomorphic to the spectrum of $(A/I)_f$ where $I$ is the ideal
generated by $E''$ and $f$ the product of the elements of $E'$.
Any nilpotent element $b$ of $(A/I)_f$ is the class of $g/f^n$
for some $g \in A$. Then setting $E' = E \cup \{g\}$ the reader
verifies that $b$ is pulls back to zero under the transition map
$Z_{E'} \to Z_E$ of the system. This proves (4).
\end{proof}

\begin{remark}
\label{remark-zariski-construction-functorial}
The construction $A \mapsto B$ described above is functorial.
Namely, let $\varphi : A \to A'$ be a ring map and denote $f : X' \to X$
the corresponding map of spectra. For $F \subset A'$ finite, we will write
$B'_F$ the product of the algebras $(A')_{Z(F', F'')}^\sim$ over decompositions
$F = F' \amalg F''$ as in (\ref{equation-ring}).
We will set $B' = \colim_{F \in I(A')} B'_F$ as in
(\ref{equation-colimit-ring}).
Moreover, we set $Y' = \Spec(B')$ and we denote $Z' \subset Y'$
the corresponding closed subscheme as in (\ref{equation-final}).
We will construct a canonical $A$-algebra map $B \to B'$
which induces a morphism of schemes $Y' \to Y$ mapping $Z'$ into $Z$.

\medskip\noindent
For $E \subset A$ finite, we obtain a finite subset $\varphi(E) \subset A'$.
Given a disjoint union decomposition $\varphi(E) = F' \amalg F''$
we get $E = \varphi^{-1}(F') \amalg \varphi^{-1}(F'')$ and it is clear that
$f(Z(F', F'')) \subset Z(\varphi^{-1}(F'), \varphi^{-1}(F''))$.
Hence by Lemma \ref{lemma-localization}
we obtain a unique $A$-algebra homomorphism
$A_{Z(\varphi^{-1}(F'), \varphi^{-1}(F''))}^\sim \to (A')_{Z(F', F'')}^\sim$.
For $F \subset A'$ finite, denote $B'_F$ the product of the
algebras $(A')_{Z(F', F'')}^\sim$ over decompositions
$F = F' \amalg F''$ as in (\ref{equation-ring}).
The $A$-algebra map
$$
\varphi_E : B_E \longrightarrow B'_{\varphi(E)}
$$
is the product of the maps
$A_{Z(\varphi^{-1}(F'), \varphi^{-1}(F''))}^\sim \to (A')_{Z(F', F'')}^\sim$
with the $0$ map on the factors $A_{Z(E', E'')}^\sim$ of $B_E$
such that $\varphi(E') \cap \varphi(E'') \not = \emptyset$. This makse
sense, as these correspond to strata $Z(E', E'')$ such that
$f^{-1}(Z(E', E'')) = \emptyset$. More precisely, we obtain
a commutative diagram
$$
\xymatrix{
X' \ar[d] & X'_{\varphi(E)} \ar[l] \ar[d]^{f_E} \\
X & X'_E \ar[l]
}
$$
of affine schemes. By construction $f_E(Z_{\varphi(E)}) \subset Z_E$
scheme theoretically. This construction is compatible with increasing
the finite subset $E \subset A$. Thus according to
Categories, Lemma \ref{categories-lemma-functorial-colimit}
we obtain an $A$-algebra map $\colim \varphi_E : B \longrightarrow B'$.
Applying the $\Spec(-)$ we obtain a commutative diagram
$$
\xymatrix{
X' \ar[d] & Y' \ar[d] \ar[l] & Z' \ar[l] \ar[d] \\
X & Y \ar[l] & Z \ar[l]
}
$$
Since $Z'$ maps into $Z$ (as indicated) we find that the canonical morphism
$Y' \to Y$ is w-local.
\end{remark}






\section{Connected components}
\label{section-connected-components}

\noindent
Let $A$ be a ring. Let $X = \Spec(A)$. The space of connected
components $\pi_0(X)$ is a profinite space by
Topology, Lemma \ref{topology-lemma-spectral-pi0}
(and Algebra, Lemma \ref{algebra-lemma-spec-spectral}).

\begin{lemma}
\label{lemma-construct}
Let $A$ be a ring. Let $X = \Spec(A)$. Let $T \subset \pi_0(X)$ be a
closed subset. There exists a surjective ind-Zariski ring map $A \to B$
such that $\Spec(B) \to \Spec(A)$ induces a homeomorphism of $\Spec(B)$
with the inverse image of $T$ in $X$.
\end{lemma}

\begin{proof}
Let $Z \subset X$ be the inverse image of $T$. Then $Z$ is the intersection
$Z = \bigcap Z_\alpha$ of the open and closed subsets of $X$ containing $Z$,
see Topology, Lemma \ref{topology-lemma-closed-union-connected-components}.
For each $\alpha$ we have $Z_\alpha = \Spec(A_\alpha)$ where
$A \to A_\alpha$ is a local isomorphism (a localization at an idempotent).
Setting $B = \colim A_\alpha$ proves the lemma.
\end{proof}

\begin{lemma}
\label{lemma-construct-profinite}
Let $A$ be a ring and let $X = \Spec(A)$. Let $T$ be a profinite space and
let $T \to \pi_0(X)$ be a continuous map. There exists an
ind-Zariski ring map $A \to B$ such that with $Y = \Spec(B)$ the diagram
$$
\xymatrix{
Y \ar[r] \ar[d] & \pi_0(Y) \ar[d] \\
X \ar[r] & \pi_0(X)
}
$$
is cartesian in the category of topological spaces and such that
$\pi_0(Y) = T$ as spaces over $\pi_0(X)$.
\end{lemma}

\begin{proof}
Namely, write $T = \lim T_i$ as the limit of an inverse system finite
discrete spaces over a directed partially ordered set (see
Topology, Lemma \ref{topology-lemma-profinite}). For each $i$ let
$Z_i = \text{Im}(T \to \pi_0(X) \times T_i)$. This is a closed subset.
Observe that $X \times T_i$ is the spectrum of $A_i = \prod_{t \in T_i} A$
and that $A \to A_i$ is a local isomorphism. By Lemma \ref{lemma-construct}
we see that $Z_i \subset \pi_0(X \times T_i) = \pi_0(X) \times T_i$
corresponds to a surjection $A_i \to B_i$ which is ind-Zariski
such that $\Spec(B_i) = X \times_{\pi_0(X)} Z_i$ as subsets of
$X \times T_i$. The transition maps $T_i \to T_{i'}$ induce maps
$Z_i \to Z_{i'}$ and $X \times_{\pi_0(X)} Z_i \to X \times_{\pi_0(X)} Z_{i'}$.
Hence ring maps $B_{i'} \to B_i$
(Lemmas \ref{lemma-local-isomorphism-fully-faithful} and
\ref{lemma-ind-zariski}).
Set $B = \colim B_i$. Because $T = \lim Z_i$ we have
$X \times_{\pi_0(X)} T = \lim  X \times_{\pi_0(X)} Z_i$
and hence $Y = \Spec(B) = \lim \Spec(B_i)$
fits into the cartesian diagram
$$
\xymatrix{
Y \ar[r] \ar[d] & T \ar[d] \\
X \ar[r] & \pi_0(X)
}
$$
of topological spaces. By Lemma \ref{lemma-silly}
we conclude that $T = \pi_0(Y)$.
\end{proof}

\noindent
Recall that the spectrum of a ring is profinite if and only if
every point is closed. There are in fact a whole slew of equivalent
conditions that imply this. See
Algebra, Lemma \ref{algebra-lemma-ring-with-only-minimal-primes} or
Topology, Lemma \ref{topology-lemma-characterize-profinite-spectral}.

\begin{lemma}
\label{lemma-profinite-goes-up}
Let $A$ be a ring such that $\Spec(A)$ is profinite. Let $A \to B$ be a
ring map. Then $\Spec(B)$ is profinite in each of the following cases:
\begin{enumerate}
\item there are no nontrivial specializations between points of the
fibres of $\Spec(B) \to \Spec(A)$,
\item $A \to B$ is quasi-finite,
\item $B$ is a filtered colimit of quasi-finite $A$-algebras.
\item $B$ is ind-Zariski,
\item $B$ is ind-\'etale (i.e., a filtered colimit of \'etale $A$-algebras),
\item etc.
\end{enumerate}
\end{lemma}

\begin{proof}
By the references mentioned above
(Algebra, Lemma \ref{algebra-lemma-ring-with-only-minimal-primes} or
Topology, Lemma \ref{topology-lemma-characterize-profinite-spectral})
there are no specializations between distinct points of $\Spec(A)$ and
$\Spec(B)$ is profinite if and only if there are no specializations
between distinct points of $\Spec(B)$. These specializations can only
happen in the fibres of $\Spec(B) \to \Spec(A)$. In this way we see
that (1) is true.

\medskip\noindent
If $A \to B$ is quasi-finite, then the fibres are finite discrete
topological spaces. Hence (2) follows from (1). If $B$ is a filtered
colimit of quasi-finite $A$-algebras, then the fibres of
$\Spec(B) \to \Spec(A)$ are limits of finite discrete spaces (i.e.,
profinite). Hence (3) follows from (1). The other cases follow
follow from this as an \'etale ring map is quasi-finite
(Algebra, Lemma \ref{algebra-lemma-etale-quasi-finite}) and
a local isomorphism is \'etale.
\end{proof}

\begin{lemma}
\label{lemma-w-local-morphism-equal-points-stalks-is-iso}
Let $A \to B$ be ring map such that
\begin{enumerate}
\item $A \to B$ identifies local rings,
\item the topological spaces $\Spec(B)$, $\Spec(A)$ are w-local,
\item $\Spec(B) \to \Spec(A)$ is w-local, and
\item $\pi_0(\Spec(B)) \to \pi_0(\Spec(A))$ is bijective.
\end{enumerate}
Then $A \to B$ is an isomorphism
\end{lemma}

\begin{proof}
Let $X_0 \subset X = \Spec(A)$ and $Y_0 \subset Y = \Spec(B)$ be the
sets of closed points. By assumption $Y_0$ maps into $X_0$ and
the induced map $Y_0 \to X_0$ is a bijection.
As a space $\Spec(A)$ is the disjoint union of the spectra
of the local rings of $A$ at closed points.
Similarly for $B$. Hence $X \to Y$ is a bijection.
Since $A \to B$ is flat we have going down
(Algebra, Lemma \ref{algebra-lemma-flat-going-down}).
Thus Algebra, Lemma \ref{algebra-lemma-unique-prime-over-localize-below}
shows for any prime $\mathfrak q \subset B$ lying over
$\mathfrak p \subset A$ we have $B_\mathfrak q = B_\mathfrak p$.
Since $B_\mathfrak q = A_\mathfrak p$ by assumption, we
see that $A_\mathfrak p = B_\mathfrak p$ for all primes $\mathfrak p$
of $A$. Thus $A = B$ by
Algebra, Lemma \ref{algebra-lemma-characterize-zero-local}.
\end{proof}

\begin{lemma}
\label{lemma-w-local-morphism-equal-stalks-is-ind-zariski}
Let $A \to B$ be ring map such that
\begin{enumerate}
\item $A \to B$ identifies local rings,
\item the topological spaces $\Spec(B)$, $\Spec(A)$ are w-local, and
\item $\Spec(B) \to \Spec(A)$ is w-local.
\end{enumerate}
Then $A \to B$ is ind-Zariski.
\end{lemma}

\begin{proof}
Set $X = \Spec(A)$ and $Y = \Spec(B)$. Let $X_0 \subset X$ and
$Y_0 \subset Y$ be the set of closed points. Let $A \to A'$ be the ind-Zariski
morphism of affine schemes such that with $X' = \Spec(A')$ the diagram
$$
\xymatrix{
X' \ar[r] \ar[d] & \pi_0(X') \ar[d] \\
X \ar[r] & \pi_0(X)
}
$$
is cartesian in the category of topological spaces and such that
$\pi_0(X') = \pi_0(Y)$ as spaces over $\pi_0(X)$, see
Lemma \ref{lemma-construct-profinite}. By
Lemma \ref{lemma-silly} we see that $X'$ is w-local and
the set of closed points $X'_0 \subset X'$ is the inverse image of $X_0$.

\medskip\noindent
We obtain a continuous map $Y \to X'$ of underlying topological spaces
over $X$ identifying $\pi_0(Y)$ with $\pi_0(X')$. By
Lemma \ref{lemma-local-isomorphism-fully-faithful}
(and Lemma \ref{lemma-ind-zariski})
this is corresponds to a morphism of affine schemes $Y \to X'$
over $X$. Since $Y \to X$ maps $Y_0$ into $X_0$ we see that
$Y \to X'$ maps $Y_0$ into $X'_0$, i.e., $Y \to X'$ is w-local.
By Lemma \ref{lemma-w-local-morphism-equal-points-stalks-is-iso}
we see that $Y \cong X'$ and we win.
\end{proof}

\noindent
The following proposition is a warm up for the type of result
we will prove later.

\begin{proposition}
\label{proposition-maps-wich-identify-local-rings}
Let $A \to A'$ be a ring map which identifies local rings.
Then there exists a faithfully flat, ind-Zariski ring map
$A' \to B'$ such that $A \to B'$ is ind-Zariski.
\end{proposition}

\begin{proof}
Set $X = \Spec(A)$, $X' = \Spec(A')$. Choose a diagram
$$
\xymatrix{
X' \ar[d] & Y' \ar[d] \ar[l] \\
X & Y \ar[l]
}
$$
of affine schemes as in Remark \ref{remark-zariski-construction-functorial}.
Then $Y' \to Y$ is w-local and identifies local rings.
By Lemma \ref{lemma-w-local-morphism-equal-stalks-is-ind-zariski}
this means $Y' \to Y$ corresponds to a
ind-Zariski ring map $B \to B'$. Since $A' \to B'$ is
faithfully flat, ind-Zariski (Lemma \ref{lemma-make-w-local})
and the composition $A \to B \to B'$ is ind-Zariski
(Lemma \ref{lemma-ind-zariski})
the proposition is proved.
\end{proof}





\section{Ind-\'etale algebra}
\label{section-ind-etale}

\noindent
We start with a definition.

\begin{definition}
\label{definition-ind-etale}
A ring map $A \to B$ is said to be {\it ind-\'etale} if $B$ can be written
as a filtered colimit of \'etale $A$-algebras.
\end{definition}

\noindent
The category of ind-\'etale algebras is closed under taking filtered colimits.

\begin{lemma}
\label{lemma-ind-ind}
A filtered colimit of ind-\'etale $A$-algebras is ind-\'etale over $A$.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-ind-permanence}
Let $A$ be a ring. Let $B \to C$ be an $A$-algebra map of ind-\'etale
$A$-algebras. Then $C$ is an ind-\'etale $B$-algebra.
\end{lemma}

\begin{proof}
Write $B = \colim B_i$ and $C = \colim C_j$ as filtered colimits
of \'etale $A$-algebras. Then
$$
C = B \otimes_B C = \colim_{(i, j)} B \otimes_{B_i} C_j
$$
where the colimit is over the partially ordered set of pairs $(i, j)$
such that $B_i \to B \to C$ factors through $C_j \to C$. Note that
the factorization $B_i \to C_j$ is \'etale by
Algebra, Lemma \ref{algebra-lemma-map-between-etale}.
Some details omitted.
\end{proof}

\noindent
Let $A$ be a ring. Recall that any \'etale ring map $A \to B$ is isomorphic
to a standard smooth ring map of relative dimension $0$. Such a ring map
is of the form
$$
A \longrightarrow A[x_1, \ldots, x_n]/(f_1, \ldots, f_n)
$$
where the determinant of the $n \times n$-matrix with entries
$\partial f_i/\partial x_j$ is invertible in the quotient ring. See
Algebra, Lemma \ref{algebra-lemma-etale-standard-smooth}.

\medskip\noindent
Let $S(A)$ be the set of all {\it faithfully flat}\footnote{In the presence
of flatness, e.g., for smooth or \'etale ring maps,
this just means that the induced map on spectra is surjective. See
Algebra, Lemma \ref{algebra-lemma-ff-rings}.}
standard smooth $A$-algebras of relative dimension $0$.
Let $I(A)$ be the partially ordered (by inclusion) set of finite
subsets $E$ of $S(A)$. Note that $I(A)$ is a directed partially
ordered set. For $E = \{A \to B_1, \ldots, A \to B_n\}$ set
$$
B_E = B_1 \otimes_A \ldots \otimes_A B_n
$$
Observe that $B_E$ is a faithfully flat \'etale $A$-algebra.
For $E \subset E'$, there is a canonical transition map $B_E \to B_{E'}$
of \'etale $A$-algebras. Namely, say $E = \{A \to B_1, \ldots, A \to B_n\}$
and $E' = \{A \to B_1, \ldots, A \to B_{n + m}\}$ then
$B_E \to B_{E'}$ sends $b_1 \otimes \ldots \otimes b_n$ to the
element $b_1 \otimes \ldots \otimes b_n \otimes 1 \otimes \ldots \otimes 1$
of $B_{E'}$. This construction defines a system of faithfully flat
\'etale $A$-algebras over $I(A)$ and we set
$$
T(A) = \colim_{E \in I(A)} B_E
$$
Observe that $T(A)$ is a faitfully flat ind-\'etale $A$-algebra
(Algebra, Lemma \ref{algebra-lemma-colimit-faithfully-flat}). By construction
given any faithfully flat \'etale $A$-algebra $B$ there is a (non-unique)
$A$-algebra map $B \to T(A)$. Namely, pick some $(A \to B_0) \in S(A)$ such
and an isomorphism $B \cong B_0$. Then the canonical coprojection
$$
B \to B_0 \to 
T(A) = \colim_{E \in I(A)} B_E
$$
is the desired map.

\begin{lemma}
\label{lemma-first-construction}
Given a ring $A$ there exists a faithfully flat ind-\'etale $A$-algebra $C$
such that every faithfully flat \'etale ring map $C \to B$ has a section.
\end{lemma}

\begin{proof}
Set $T^1(A) = T(A)$ and $T^{n + 1}(A) = T(T^n(A))$. Let
$$
C = \colim T^n(A)
$$
This algebra is faithfully flat over each $T^n(A)$ and in particular
over $A$, see
Algebra, Lemma \ref{algebra-lemma-colimit-faithfully-flat}.
Moreover, $C$ is ind-\'etale over $A$ by Lemma \ref{lemma-ind-ind}.
If $C \to B$ is \'etale, then there exists an $n$ and an \'etale
ring map $T^n(A) \to B'$ such that $B = C \otimes_{T^n(A)} B'$, see
Algebra, Lemma \ref{algebra-lemma-etale}.
If $C \to B$ is faithfully flat, then $\Spec(B) \to \Spec(C) \to \Spec(T^n(A))$
is surjective, hence $\Spec(B') \to \Spec(T^n(A))$ is surjective.
In other words, $T^n(A) \to B'$ is faithfully flat.
By our construction, there is a $T^n(A)$-algebra map
$B' \to T^{n + 1}(A)$. This induces a $C$-algebra map $B \to C$
which finishes the proof.
\end{proof}

\begin{remark}
\label{remark-size-T}
Let $A$ be a ring. Let $\kappa$ be an infinite cardinal bigger or
equal than the cardinality of $A$. Then the cardinality of $T(A)$
is at most $\kappa$. Namely, each $B_E$ has cardinality at most
$\kappa$ and the index set $I(A)$ has cardinality at most $\kappa$
as well. Thus the result follows as $\kappa \otimes \kappa = \kappa$, see
Sets, Section \ref{sets-section-cardinals}. It follows that the
ring constructed in the proof of Lemma \ref{lemma-first-construction}
has cardinality at most $\kappa$ as well.
\end{remark}

\begin{remark}
\label{remark-first-construction-functorial}
The construction $A \mapsto T(A)$ is functorial in the following sense:
If $A \to A'$ is a ring map, then we can construct a commutative diagram
$$
\xymatrix{
A \ar[r] \ar[d] & T(A) \ar[d] \\
A' \ar[r] & T(A')
}
$$
Namely, given $(A \to A[x_1, \ldots, x_n]/(f_1, \ldots, f_n))$ in
$S(A)$ we can use the ring map $\varphi : A \to A'$ to obtain a corresponding
element $(A' \to A'[x_1, \ldots, x_n]/(f^\varphi_1, \ldots, f^\varphi_n))$
of $S(A')$ where $f^\varphi$ means the polynomial obtained by applying
$\varphi$ to the coefficients of the polynomial $f$.
Moreover, there is a commutative diagram
$$
\xymatrix{
A \ar[r] \ar[d] & A[x_1, \ldots, x_n]/(f_1, \ldots, f_n) \ar[d] \\
A' \ar[r] & A'[x_1, \ldots, x_n]/(f^\varphi_1, \ldots, f^\varphi_n)
}
$$
which is a in the category of rings. For $E \subset S(A)$ finite, set
$E' = \varphi(E)$ and define $B_E \to B_{E'}$ in the obvious manner.
Taking the colimit gives the desired map $T(A) \to T(A')$, see
Categories, Lemma \ref{categories-lemma-functorial-colimit}.
\end{remark}

\begin{lemma}
\label{lemma-have-sections-quotient}
Let $A$ be a ring such that every faithfully flat \'etale ring map
$A \to B$ has a section. Then the same is true for every quotient ring
$A/I$.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-have-sections-strictly-henselian}
Let $A$ be a ring such that every faithfully flat \'etale ring map
$A \to B$ has a section. Then every local ring of $A$ is strictly
henselian.
\end{lemma}

\begin{proof}
Let $\mathfrak p$ be a prime of $A$. Let $A \to B$ be an
\'etale ring map and let $\mathfrak q \subset B$ be a prime
lying over $\mathfrak p$. By the description of the strict henselization
$A_\mathfrak p^{sh}$ in
Algebra, Lemma \ref{algebra-lemma-strict-henselization-different}
it suffices to show that $A_\mathfrak p = B_\mathfrak q$.
After replacing $B$ by a principal localization we may assume
that $\mathfrak q$ is the only prime of $B$ lying over $\mathfrak p$
(as the fibre over $\mathfrak p$ is finite since an \'etale
ring map is quasi-finite).
The image $U \subset \Spec(A)$ of $\Spec(B) \to \Spec(A)$ is
open. Thus the complement $\Spec(A) \setminus U$ is closed
and we can find $f \in A$, $f \not \in \mathfrak p$ such that
$\Spec(A) = U \cup D(f)$. The ring map $A \to B \times A_f$
is faithfully flat and \'etale, hence has a section
$\sigma : B \times A_f \to A$ by assumption on $A$.
Observe that $\sigma$ is \'etale, hence flat as a map between \'etale
$A$-algebras. Since $\mathfrak q$ is the only prime of $B \times A_f$ lying
over $A$ we find that $A_\mathfrak p \to B_\mathfrak q$ has
a section which is also flat. Thus
$A_\mathfrak p \to B_\mathfrak q \to A_\mathfrak p$
are flat local ring maps whose composition is the identity. Since
a flat local homomorphism of local rings is injective we conclude these
maps are isomorphisms as desired.
\end{proof}







\input{chapters}

\bibliography{my}
\bibliographystyle{amsalpha}

\end{document}
