\input{preamble}

% OK, start here.
%
\begin{document}

\title{Semistable Reduction}


\maketitle

\phantomsection
\label{section-phantom}

\tableofcontents

\section{Introduction}
\label{section-introduction}

\noindent
In this chapter we prove the semistable reduction theorem for curves.
We will use the method of Artin and Winters from their paper
\cite{Artin-Winters}.

\medskip\noindent
It turns out that one can prove the semistable reduction theorem
for curves without any results on desingularization. Namely, there
is a way to esthablish the existence and projectivity of moduli
of semistable curves using Geometric Invariant Theory (GIT)
as developped by Mumford, see \cite{GIT}. This method was
championed by Gieseker who proved the full result in his
lecture notes \cite{Gieseker}. This is quite an amazing
feat: it seems somewhat counter intuitive that one can
prove such a result without ever truly studying families curves over
a positive dimensional base.

\medskip\noindent
Historically the first proof of the semistable reduction theorem
for curves can be found in the paper \cite{DM} by Deligne and Mumford.
It proves the theorem by reducing the problem to the case of
Abelian varieties which was already known at the time thanks
to Grothendieck and others, see \cite{SGA7-I} and \cite{SGA7-II}).
In hindsight the semistable reduction theorem for abelian varieties seems
a lot harder, {\it especially} if one is to prove it without access
to the semistable reduction theorem for curves.

\medskip\noindent
The method in the paper by Artin and Winters consists in analyzing the
possibilities for the special fibre and concluding using an inequality
for torsion in the Picard group of a $1$-dimensional scheme over a field.
A similar argument can be found in a paper \cite{Saito} of Saito who uses
\'etale cohomology directly and who obtains a stronger result in that
he can characterize semistable reduction in terms of the action of
the inertia on $\ell$-adic \'etale cohomology.

\medskip\noindent
A different approach one can use to prove the theorem is to use
rigid analytic geometry techniques. Here we refer the reader to
\cite{vanderPut} and \cite{Arzdorf-Wewers}.

\medskip\noindent
The paper \cite{Temkin} by Temkin uses valuation theoretic techniques
(and proves a lot more besides); also Appendix A of this paper gives
a nice overview of the different proofs and the relationship with
desingularizations of $2$ dimensional schemes.

\medskip\noindent
Another overview paper that the reader may wish to consult is
\cite{Abbes-ssr} written by Ahmed Abbes.






\section{Linear algebra}
\label{section-linear-algebra}

\noindent
A couple of lemmas we will use later on.

\begin{lemma}
\label{lemma-recurring}
\begin{reference}
\cite[Theorem I]{Taussky}
\end{reference}
Let $A = (a_{ij})$ be a complex $n \times n$ matrix.
\begin{enumerate}
\item If $|a_{ii}| > \sum_{j \not = i} |a_{ij}|$ for each $i$, then
$\det(A)$ is nonzero.
\item If there exists a real vector $m = (m_1, \ldots, m_n)$
with $m_i > 0$ such that $|a_{ii} m_i| > \sum_{j \not = i} |a_{ij}m_j|$
for each $i$, then $\det(A)$ is nonzero.
\end{enumerate}
\end{lemma}

\begin{proof}
If $A$ is as in (1) and $\det(A) = 0$, then there is a nonzero vector
$z$ with $Az = 0$. Choose $r$ with $|z_r|$ maximal. Then
$$
|a_{rr} z_r| = |\sum\nolimits_{k \not = r} a_{rk}z_k| \leq
\sum\nolimits_{k \not = r} |a_{rk}||z_k| \leq
|z_r| \sum\nolimits_{k \not = r} |a_{rk}| < |a_{rr}||z_r|
$$
which is a contradiction. To prove (2) apply (1) to the matrix
$(a_{ij}m_j)$ whose determinant is $m_1 \ldots m_n \det(A)$.
\end{proof}

\begin{lemma}
\label{lemma-recurring-real}
Let $A = (a_{ij})$ be a real $n \times n$ matrix with
$a_{ij} \geq 0$ for $i \not = j$. Let $m = (m_1, \ldots, m_n)$ be a real
vector with $m_i > 0$. For $I \subset \{1, \ldots, n\}$ let
$x_I \in \mathbf{R}^n$
be the vector whose $i$th coordinate is $m_i$ if $i \in I$
and $0$ otherwise. If
\begin{equation}
\label{equation-ineq}
-a_{ii}m_i \geq \sum\nolimits_{j \not = i} a_{ij}m_j
\end{equation}
for each $i$, then $\Ker(A)$ is the vector space
spanned by the vectors $x_I$ such that
\begin{enumerate}
\item $a_{ij} = 0$ for $i \in I$, $j \not \in I$, and
\item equality holds in (\ref{equation-ineq}) for $i \in I$.
\end{enumerate}
\end{lemma}

\begin{proof}
After replacing $a_{ij}$ by $a_{ij}m_j$ we may assume $m_i = 1$ for all $i$.
If $I \subset \{1, \ldots, n\}$ such that (1) and (2) are true,
then a simple computation shows that $x_I$ is in the kernel of $A$.
Conversely, let $x = (x_1, \ldots, x_n) \in \mathbf{R}^n$ be a
nonzero vector in the kernel of $A$. We will show by induction
on the number of nonzero coordinates of $x$ that $x$ is in the
span of the vectors $x_I$ satisfying (1) and (2). Let
$I \subset \{1, \ldots, n\}$ be the set of indices $r$ with $|x_r|$ maximal.
For $r \in I$ we have
$$
|a_{rr} x_r| = |\sum\nolimits_{k \not = r} a_{rk}x_k| \leq
\sum\nolimits_{k \not = r} a_{rk}|x_k| \leq
|x_r| \sum\nolimits_{k \not = r} a_{rk} \leq |a_{rr}||x_r|
$$
Thus equality holds everywhere. In particular, we see that
$a_{rk} = 0$ if $r \in I$, $k \not \in I$ and equality holds
in (\ref{equation-ineq}) for $r \in I$. Then we see that we
can substract a suitable multiple of $x_I$ from $x$ to decrease
the number of nonzero coordinates.
\end{proof}

\begin{lemma}
\label{lemma-recurring-symmetric-real}
Let $A = (a_{ij})$ be a symmetric real $n \times n$ matrix with
$a_{ij} \geq 0$ for $i \not = j$.
Let $m = (m_1, \ldots, m_n)$ be a real vector with $m_i > 0$.
Assume
\begin{enumerate}
\item $Am = 0$,
\item there is no proper nonempty subset $I \subset \{1, \ldots, n\}$
such that $a_{ij} = 0$ for $i \in I$ and $j \not \in I$.
\end{enumerate}
Then $x^t A x \leq 0$ with equality if and only if $x = qm$
for some $q \in \mathbf{R}$.
\end{lemma}

\begin{proof}[First proof]
After replacing $a_{ij}$ by $a_{ij}m_im_j$ we may assume $m_i = 1$
for all $i$. Condition (1) means $-a_{ii} = \sum_{j \not = i} a_{ij}$
for all $i$. Recall that $x^tAx = \sum_{i, j} x_ia_{ij}x_j$.
Then
\begin{align*}
\sum\nolimits_{i \not = j} -a_{ij}(x_j - x_i)^2 & =
\sum\nolimits_{i \not = j} -a_{ij}x_j^2 + 2a_{ij}x_ix_i - a_{ij}x_i^2 \\
& =
\sum\nolimits_j a_{jj} x_j^2 +
\sum\nolimits_{i \not = j} 2a_{ij}x_ix_i +
\sum\nolimits_j a_{jj} x_i^2 \\
& = 2x^tAx
\end{align*}
This is clearly $\leq 0$. If equality holds, then let $I$ be the set
of indices $i$ with $x_i \not = x_1$. Then $a_{ij} = 0$ for $i \in I$
and $j \not \in I$. Thus $I = \{1, \ldots, n\}$ by condition (2) and
$x$ is a multiple of $m = (1, \ldots, 1)$.
\end{proof}

\begin{proof}[Second proof]
The matrix $A$ has real eigenvalues by the spectral theorem.
We claim all the eigenvalues are $\leq 0$.
Namely, since property (1) means
$-a_{ii}m_i = \sum_{j \not = i} a_{ij}m_j$ for all $i$,
we find that the matrix $A' = A - \lambda I$ for $\lambda > 0$
satisfies $|a'_{ii}m_i| > \sum a'_{ij}m_j = \sum |a'_{ij}m_j|$ for all $i$.
Hence $A'$ is invertible by Lemma \ref{lemma-recurring}.
This implies that the symmetric bilinear form $x^tAy$
is semi-negative definite, i.e., $x^tAx \leq 0$ for all $x$.
It follows that the kernel of $A$ is equal
to the set of vectors $x$ with $x^tAx = 0$.
The description of the kernel in Lemma \ref{lemma-recurring-real}
gives the final statement of the lemma.
\end{proof}











\section{Models}
\label{section-models}

\noindent
In this chapter $R$ will be a discrete valuation ring and $K$ will
be its fraction field. If needed we will denote $\pi \in R$ a
uniformizer and $k = R/(\pi)$ its residue field.

\medskip\noindent
Let $V$ be an algebraic $K$-scheme
(Varieties, Definition \ref{varieties-definition-algebraic-scheme}).
A {\it model} for $V$ will
mean a flat finite type\footnote{Occasionally it is useful to
allow models to be locally of finite type over $R$, but we'll
cross that bridge when we come to it.}
morphism $X \to \Spec(R)$ endowed with
an isomorphism $V \to X_K = X \times_{\Spec(R)} \Spec(K)$. We often
will identify $V$ and the generic fibre $X_K$ of $X$ and
just write $V = X_K$.
The special fibre is $X_k = X \times_{\Spec(R)} \Spec(k)$.
A {\it morphism of models $X \to X'$ for $V$} is
is a morphism $X \to X'$ of schemes over $R$ which induces
the indentity on $V$.

\medskip\noindent
We will say {\it $X$ is a proper model of $V$} if $X$ is a model
of $V$ and the structure morphism $X \to \Spec(R)$ is proper.
Similarly for separated models, smooth models, and add more here.
We will say {\it $X$ is a regular model of $V$} if $X$ is a model
of $V$ and $X$ is a regular scheme.
Similarly for normal models, reduced models, and add more here.

\medskip\noindent
Let $R \subset R'$ be an extension of discrete valuation rings
(More on Algebra, Definition
\ref{more-algebra-definition-extension-discrete-valuation-rings}).
This induces an extension $K \subset K'$ of fraction fields.
Given an algebraic scheme $V$ over $K$, denote $V'$ the
base change $V \times_{\Spec(K)} \Spec(K')$. Then there is
a functor
$$
\text{models for }V\text{ over }R
\longrightarrow
\text{models for }V'\text{ over }R'
$$
sending $X$ to $X \times_{\Spec(R)} \Spec(R')$.

\begin{lemma}
\label{lemma-closure-is-model}
Let $V_1 \to V_2$ be a closed immersion of algebraic schemes over $K$.
If $X_2$ is a model for $V_2$, then the scheme theoretic image
of $V_1 \to X_2$ is a model for $V_1$.
\end{lemma}

\begin{proof}
Using
Morphisms, Lemma \ref{morphisms-lemma-quasi-compact-scheme-theoretic-image} and
Example \ref{morphisms-example-scheme-theoretic-image}
this boils down to the following algebra statement.
Let $A_1$ be a finite type $R$-algebra flat over $R$.
Let $A_1 \otimes_R K \to B_2$ be a surjection. Then
$A_2 = A_1 / \Ker(A_1 \to B_2)$ is a finite type $R$-algebra
flat over $R$ such that $B_2 = A_2 \otimes_R K$.
We omit the detailed proof; use
More on Algebra, Lemma \ref{more-algebra-lemma-dedekind-torsion-free-flat}
to prove that $A_2$ is flat.
\end{proof}

\begin{lemma}
\label{lemma-normalization}
Let $X$ be a model of a geometrically normal variety $V$ over $K$.
Then the normalization $\nu : X^\nu \to X$ is finite and
the base change of $X^\nu$ to the completion $R^\wedge$
is the normalization of the base change of $X$. Moreover, for
each $x \in X^\nu$ the completion of $\mathcal{O}_{X^\nu, x}$
is normal.
\end{lemma}

\begin{proof}
Observe that $R^\wedge$ is a discrete valuation ring
(More on Algebra, Lemma \ref{more-algebra-lemma-completion-dvr}).
Set $Y = X \times_{\Spec(R)} \Spec(R^\wedge)$.
Since $R^\wedge$ is a discrete valuation ring, we see that
$$
Y \setminus Y_k =
Y \times_{\Spec(R^\wedge)} \Spec(K^\wedge) =
V \times_{\Spec(K)} \Spec(K^\wedge)
$$
where $K^\wedge$ is the fraction field of $R^\wedge$.
Since $V$ is geometrically normal, we find that this is
a normal scheme. Hence the first part of the lemma follows from
Resolution of Surfaces, Lemma \ref{resolve-lemma-normalization-completion}.

\medskip\noindent
To prove the second part we may assume $X$ and $Y$ are normal
(by the first part). If $x$ is in the generic fibre, then
$\mathcal{O}_{X, x} = \mathcal{O}_{V, x}$ is a normal local
ring essentially of finite type over a field. Such a ring is
excellent (More on Algebra, Proposition
\ref{more-algebra-proposition-ubiquity-excellent}).
If $x$ is a point of the special fibre with image $y \in Y$, then
$\mathcal{O}_{X, x}^\wedge = \mathcal{O}_{Y, y}^\wedge$
by Resolution of Surfaces, Lemma \ref{resolve-lemma-iso-completions}.
In this case $\mathcal{O}_{Y, y}$ is a excellent normal local domain
by the same reference as before as $R^\wedge$ is excellent.
If $B$ is a excellent local normal domain, then the completion
$B^\wedge$ is normal (as $B \to B^\wedge$ is regular and
More on Algebra, Lemma \ref{more-algebra-lemma-normal-goes-up} applies).
This finishes the proof.
\end{proof}

\begin{lemma}
\label{lemma-regular}
Let $X$ be a model of a smooth curve $C$ over $K$. Then
there exists a resolution of singularities of $X$
and any resolution is a model of $C$.
\end{lemma}

\begin{proof}
We check condition (4) of Lipman's theorem
(Resolution of Surfaces, Theorem \ref{resolve-theorem-resolve}) hold.
This is clear from Lemma \ref{lemma-normalization}
except for the statement that $X^\nu$ has finitely many
singular points. To see this we can use that $R$ is J-2 by
More on Algebra, Proposition \ref{more-algebra-proposition-ubiquity-J-2}
and hence the nonsingular locus is open in $X^\nu$.
Since $X^\nu$ is normal of dimension $\leq 2$, the singular points
are closed, hence closedness of the singular locus
means there are finitely many of them (as $X$ is quasi-compact).
Observe that any resolution of $X$ is a modification of $X$
(Resolution of Surfaces, Definition \ref{resolve-definition-resolution}).
This will be an isomorphism over the normal locus of $X$ by Varieties, Lemma
\ref{varieties-lemma-modification-normal-iso-over-codimension-1}.
Since the set of normal points includes
$C = X_K$ we conclude any resolution is a model of $C$.
\end{proof}

\begin{definition}
\label{definition-minimal-model}
Let $C$ be a smooth projective curve over $K$ with
$H^0(C, \mathcal{O}_C) = K$. A {\it minimal model}
will be a regular, proper model $X$ for $C$ such that
$X$ does not contain an exceptional curve of the first kind.
\end{definition}

\noindent
Really such a thing should be called a minimal regular proper model
or even a relatively minimal regular projective model. But as long
as we stick to models over discrete valuation rings (as we will
in this chapter), no confusion should arise.

\begin{proposition}
\label{proposition-exists-minimal-model}
Let $C$ be a smooth projective curve over $K$ with
$H^0(C, \mathcal{O}_C) = K$. A minimal model exists.
\end{proposition}

\begin{proof}
Choose a closed immersion $C \to \mathbf{P}^n_K$. Let
$X$ be the scheme theoretic image of $C \to \mathbf{P}^n_R$.
Then $X \to \Spec(R)$ is a projective model of $C$ by
Lemma \ref{lemma-closure-is-model}.
By Lemma \ref{lemma-regular} we may assume that $X$
is regular.

\medskip\noindent
Let $E \subset X$ be an exceptional curve of the first kind.
See Resolution of Surfaces, Section \ref{resolve-section-minus-one}.
Since $\Spec(R)$ is affine and $E \subset X$ is closed and
$X \to \Spec(R)$ is closed, we see that $E \to \Spec(R)$
maps to the closed point. Hence $E \subset X_k$. By
Resolution of Surfaces, Lemma \ref{resolve-lemma-contract-ample}
we can contract $E$ by a morphism $X \to X'$ such that $X'$ is
regular and is projective over $R$. Clearly, the number of
irreducible components of $X'_k$ is exactly one less than the
number of irreducible components of $X_k$. Thus we can only
perform a finite number of these contractions untill we
obtain a minimal model.
\end{proof}





\section{The geometry of a regular model}
\label{section-special-fibre}

\noindent
In this section we describe the geometry of a proper regular model $X$ of a
smooth projective curve $C$ over $K$ with $H^0(C, \mathcal{O}_C) = K$.

\begin{lemma}
\label{lemma-divisor-special-fiber}
Let $X$ be a regular model of a smooth curve $C$ over $K$.
\begin{enumerate}
\item the special fibre $X_k$ is an effective Cartier divisor on $X$,
\item each irreducible component $C_i$ of $X_k$ is an effective
Cartier divisor on $X$,
\item $X_k = \sum m_i C_i$ (sum of effective Cartier divisors)
where $m_i$ is the multiplicity of $C_i$ in $X_k$,
\item $\mathcal{O}_X(X_k) \cong \mathcal{O}_X$.
\end{enumerate}
\end{lemma}

\begin{proof}
Recall that $R$ is a discrete valuation ring with uniformizer $\pi$
and residue field $k = R/(\pi)$. Because $X \to \Spec(R)$ is flat,
the element $\pi$ is a nonzerodivisor affine locally on $X$
(see More on Algebra, Lemma
\ref{more-algebra-lemma-dedekind-torsion-free-flat}). Thus
if $U = \Spec(A) \subset X$ is an affine open, then
$$
X_K \cap U = U_k = \Spec(A \otimes_R k) = \Spec(A/\pi A)
$$
and $\pi$ is a nonzerodivisor in $A$.
Hence $X_k = V(\pi)$ is an effective Cartier divisor by
Divisors, Lemma \ref{divisors-lemma-characterize-effective-Cartier-divisor}.
Hence (1) is true.

\medskip\noindent
The discussion above shows that the pair $(\mathcal{O}_X(X_k), 1)$
is isomorphic to the pair $(\mathcal{O}_X, \pi)$ which proves (4).

\medskip\noindent
By Divisors, Lemma \ref{divisors-lemma-effective-Cartier-divisor-is-a-sum}
there exist pairwise distinct integral effective Cartier divisors
$D_i \subset X$ and integers $a_i \geq 0$ such that $X_k = \sum a_i D_i$.
We can throw out those divisors $D_i$ such that $a_i = 0$. Then it is
clear (from the definition of addition of effective Cartier
divisors) that $X_k = \bigcup D_i$ set theoretically. Thus $C_i = D_i$
are the irreducible components of $X_k$ which proves (2).
Let $\xi_i$ be the generic point of $C_i$.
Then $\mathcal{O}_{X, \xi_i}$ is a discrete valuation ring
(Divisors, Lemma \ref{divisors-lemma-integral-effective-Cartier-divisor-dvr}).
The uniformizer $\pi_i \in \mathcal{O}_{X, \xi_i}$ is a local equation
for $C_i$ and the image of $\pi$ is a local equation for $X_k$.
Since $X_k = \sum a_i C_i$ we see that $\pi$ and $\pi_i^{a_i}$
generate the same ideal in $\mathcal{O}_{X, \xi_i}$.
On the other hand, the multiplicity of $C_i$ in $X_k$ is
$$
m_i = \text{length}_{\mathcal{O}_{C_i, \xi_i}} \mathcal{O}_{X_k, \xi_i} =
\text{length}_{\mathcal{O}_{C_i, \xi_i}} \mathcal{O}_{X, \xi_i}/(\pi) =
\text{length}_{\mathcal{O}_{C_i, \xi_i}} \mathcal{O}_{X, \xi_i}/(\pi_i^{a_i}) =
a_i
$$
See Chow Homology, Definition
\ref{chow-definition-cycle-associated-to-closed-subscheme}.
Thus $a_i = m_i$ and (3) is proved.
\end{proof}

\begin{lemma}
\label{lemma-gorenstein}
Let $X$ be a regular model of a smooth curve $C$ over $K$. Then
\begin{enumerate}
\item $X \to \Spec(R)$ is a Gorenstein morphism of relative dimension $1$,
\item each of the irreducible components $C_i$ of $X_k$ is Gorenstein.
\end{enumerate}
\end{lemma}

\begin{proof}
Since $X \to \Spec(R)$ is flat, to prove (1)
it suffices to show that the fibres
are Gorenstein (Dualizing, Lemma \ref{dualizing-lemma-gorenstein-morphism}).
The generic fibre is a smooth curve, which is regular and hence
Gorenstein (Dualizing, Lemma \ref{dualizing-lemma-regular-gorenstein}).
For the special fibre $X_k$ we use that it is an effective
Cartier divisor on a regular (hence Gorenstein) scheme and hence
Gorenstein for example by
Dualizing, Lemma \ref{dualizing-lemma-gorenstein-divide-by-nonzerodivisor}.
The curves $C_i$ are Gorenstein by the same argument.
\end{proof}

\begin{situation}
\label{situation-regular-model}
Let $R$ be a discrete valuation ring with fraction field $K$,
residue field $k$, and uniformizer $\pi$.
Let $C$ be a smooth projective curve over $K$ with $H^0(C, \mathcal{O}_C) = K$.
Let $X$ be a regular proper model of $C$.
Let $C_1, \ldots, C_n$ be the irreducible components of the special
fibre $X_k$. Write $X_k = \sum m_i C_i$ as in
Lemma \ref{lemma-divisor-special-fiber}.
\end{situation}

\begin{lemma}
\label{lemma-regular-model-pic}
In Situation \ref{situation-regular-model} there is an exact sequence
$$
0 \to \mathbf{Z} \to \mathbf{Z}^{\oplus n} \to
\text{Pic}(X) \to \text{Pic}(C) \to 0
$$
where the first map sends $1$ to $(m_1, \ldots, m_n)$ and the second
maps sends the $i$th basis vector to $\mathcal{O}_X(C_i)$.
\end{lemma}

\begin{proof}
Observe that $C \subset X$ is an open subscheme. The restriction
map $\text{Pic}(X) \to \text{Pic}(C)$ is surjective by
Divisors, Lemma \ref{divisors-lemma-extend-invertible-module}.
Let $\mathcal{L}$ be an invertible $\mathcal{O}_X$-module
such that there is an isomorphism $s : \mathcal{O}_C \to \mathcal{L}|_C$.
Then $s$ is a regular meromorphic section of $\mathcal{L}$
and we see that $\text{div}_\mathcal{L}(s) = \sum a_i C_i$
for some $a_i \in \mathbf{Z}$
(Divisors, Definition \ref{divisors-definition-divisor-invertible-sheaf}).
By Divisors, Lemma \ref{divisors-lemma-normal-c1-injective}
(and the fact that $X$ is normal)
we conclude that $\mathcal{L} = \mathcal{O}_X(\sum a_iC_i)$.
Finally, suppose that $\mathcal{O}_X(\sum a_i C_i) \cong \mathcal{O}_X$.
Then there exists an element $g$ of the function field of $X$
with $\text{div}_X(g) = \sum a_i C_i$. In particular the rational
function $g$ has no zeros or poles on the generic fibre $C$ of $X$.
Since $C$ is a normal scheme this implies $g \in H^0(C, \mathcal{O}_C) = K$.
Thus $g = \pi^a u$ for some $a \in \mathbf{Z}$ and $u \in R^*$.
We conclude that $\text{div}_X(g) = a \sum m_i C_i$ and the proof
is complete.
\end{proof}

\begin{remark}
\label{remark-dualizing}
In Situation \ref{situation-regular-model} we let
$\omega_{X/R}^\bullet = f^!\mathcal{O}_{\Spec(R)}$
be the relative dualizing complex of $f : X \to \Spec(R)$
as introduced in
Dualizing Complexes, Remark \ref{dualizing-remark-relative-dualizing-complex}.
Since $f$ is Gorenstein of relative dimension $1$
by Lemma \ref{lemma-gorenstein} we can use
Dualizing Complexes, Lemmas
\ref{dualizing-lemma-affine-flat-Noetherian-gorenstein},
\ref{dualizing-lemma-CM-shriek}, and
\ref{dualizing-lemma-gorenstein-CM-morphism}
to see that
$$
\omega_{X/R}^\bullet = \omega_X[1]
$$
for some invertible $\mathcal{O}_X$-module $\omega_X$.
This invertible module is often called the
{\it relative dualizing module of $X$ over $R$}.
Since $R$ is regular (hence Gorenstein) of dimension $1$
we see that $\omega_R^\bullet = R[1]$ is a
normalized dualizing complex for $R$. Hence
$\omega_X = H^{-2}(f^!\omega_R^\bullet)$ and we
see that $\omega_X$ is not just a relative dualizing module
but also a dualizing module, see
Dualizing Complexes, Example \ref{dualizing-example-proper-over-local}.
Thus $\omega_X$ represents the functor
$$
\textit{Coh}(\mathcal{O}_X) \to \textit{Sets},\quad
\mathcal{F} \mapsto \Hom_R(H^1(X, \mathcal{F}), R)
$$
by Dualizing Complexes, Lemma
\ref{dualizing-lemma-dualizing-module-proper-over-A}.
This gives an alternative definition of the relative
dualizing module in Situation \ref{situation-regular-model}.
The formation of $\omega_X$ commutes with arbitrary base change
(for any proper Gorenstein morphism of given relative dimension);
this follows from the corresponding fact for the relative dualizing
complex discussed in
Dualizing Complexes, Remark \ref{dualizing-remark-relative-dualizing-complex}
which goes back to
Dualizing Complexes, Lemma \ref{dualizing-lemma-proper-flat-base-change}.
Thus $\omega_X$ pulls back to the dualizing module $\omega_C$ of $C$ over $K$
discussed in Curves, Lemma \ref{curves-lemma-duality-dim-1-CM}.
Note that $\omega_C$ is isomorphic to $\Omega_{C/K}$ by
Curves, Lemma \ref{curves-lemma-duality-dim-1}.
Similarly $\omega_X|_{X_k}$ is the dualizing module $\omega_{X_k}$
of $X_k$ over $k$.
\end{remark}

\begin{lemma}
\label{lemma-dualizing-components}
In Situation \ref{situation-regular-model} the dualizing module of
$C_i$ over $k$ is
$$
\omega_{C_i} = \omega_X(C_i)|_{C_i}
$$
where $\omega_X$ is as in Remark \ref{remark-dualizing}.
\end{lemma}

\begin{proof}
Let $t : C_i \to X$ be the closed immersion. Since $t$ is
the inclusion of an effective Cartier divisor we conclude from
Dualizing Complexes, Lemmas
\ref{dualizing-lemma-twisted-inverse-image-closed} and
\ref{dualizing-lemma-sheaf-with-exact-support-effective-Cartier}
that we have $t^!(\mathcal{L}) = \mathcal{L}(C_i)|_{C_i}$
for every invertible $\mathcal{O}_X$-module $\mathcal{L}$.
Consider the commutative diagram
$$
\xymatrix{
C_i \ar[r]_t \ar[d]_g & X \ar[d]^f \\
\Spec(k) \ar[r]^s & \Spec(R)
}
$$
Observe that $C_i$ is a Gorenstein curve
(Lemma \ref{lemma-gorenstein}) with invertible
dualizing module $\omega_{C_i}$ characterized by the property
$\omega_{C_i}[0] = g^!\mathcal{O}_{\Spec(k)}$. See
Curves, Lemma \ref{curves-lemma-duality-dim-1}, its proof, and
Curves, Lemmas \ref{curves-lemma-duality-dim-1-CM} and \ref{curves-lemma-rr}.
On the other hand, $s^!(R[1]) = k$ and hence
$$
\omega_{C_i}[0] =
g^! s^!(R[1]) = t^!f^!(R[1]) = t^!\omega_X
$$
Combining the above we obtain the statement of the lemma.
\end{proof}

\noindent
In Situation \ref{situation-regular-model} for every invertible
$\mathcal{O}_X$-module $\mathcal{L}$ and every $i$ we get an integer
$$
\deg(\mathcal{L}|_{C_i}) =
\chi(C_i, \mathcal{L}|_{C_i}) - \chi(C_i, \mathcal{O}_{C_i})
$$
by taking the degree of the restriction of $\mathcal{L}$ to $C_i$
relative to the ground field $k$\footnote{Observe that it may happen
that the field $k_i = H^0(C_i, \mathcal{O}_{C_i})$ is strictly bigger
than $k$. In this case every invertible module on $C_i$ has
degree (as defined above) divisible by $[k_i : k]$.}
as in Varieties, Section \ref{varieties-section-divisors-curves}.

\begin{lemma}
\label{lemma-intersection-pairing}
In Situation \ref{situation-regular-model} given $\mathcal{L}$ an invertible
$\mathcal{O}_X$-module and
$a = (a_1, \ldots, a_n) \in \mathbf{Z}^{\oplus n}$ we define
$$
\langle a, \mathcal{L} \rangle = \sum a_i\deg(\mathcal{L}|_{C_i})
$$
Then $\langle , \rangle$ is bilinear and for
$b = (b_1, \ldots, b_n) \in \mathbf{Z}^{\oplus n}$ we have
$$
\left\langle a, \mathcal{O}_X(\sum b_i C_i) \right\rangle =
\left\langle b, \mathcal{O}_X(\sum a_i C_i) \right\rangle
$$
\end{lemma}

\begin{proof}
Bilinearity is immediate from the definition and
Varieties, Lemma \ref{varieties-lemma-degree-tensor-product}.
To prove symmetry it suffices to assume $a$ and $b$ are
standard basis vectors in $\mathbf{Z}^{\oplus n}$.
Hence it suffices to prove that
$$
\deg(\mathcal{O}_X(C_j)|_{C_i}) = \deg(\mathcal{O}_X(C_i)|_{C_j})
$$
for all $1 \leq i, j \leq n$. If $i = j$ there is nothing to prove.
If $i \not = j$, then the canonical section $1$ of $\mathcal{O}_X(C_j)$
restricts to a nonzero (hence regular) section of $\mathcal{O}_X(C_j)|_{C_i}$
whose zero scheme is exactly $C_i \cap C_j$ (scheme theoretic intersection).
In other words, $C_i \cap C_j$ is an effective Cartier divisor on $C_i$
and
$$
\deg(\mathcal{O}_X(C_j)|_{C_i}) = \deg(C_i \cap C_j)
$$
by Varieties, Lemma \ref{varieties-lemma-degree-effective-Cartier-divisor}.
By symmetry we obtain the same (!) formula for the other side
and the proof is complete.
\end{proof}

\noindent
In Situation \ref{situation-regular-model} it is often convenient to think
of $\mathbf{Z}^{\oplus n}$ as the free abelian group on the set
$\{C_1, \ldots, C_n\}$. We will indicate an element of this group
as $\sum a_i C_i$; here we think of this as a formal sum although
equivalently we may (and we sometimes do)
think of such a sum as a Weil divisor on $X$
supported on the special fibre $X_k$. Now
Lemma \ref{lemma-intersection-pairing}
allows us to define a symmetric bilinear form $(\ \cdot\ )$
on this free abelian group by the rule
\begin{equation}
\label{equation-form}
\left(\sum a_i C_i \cdot \sum b_j C_j\right) =
\left\langle a, \mathcal{O}_X(\sum b_j C_j) \right\rangle =
\left\langle b, \mathcal{O}_X(\sum a_i C_i) \right\rangle
\end{equation}
We will prove some properties of this bilinear form.

\begin{lemma}
\label{lemma-properties-form}
In Situation \ref{situation-regular-model} the symmetric bilinear form
(\ref{equation-form}) has the following properties
\begin{enumerate}
\item $(C_i \cdot C_j) \geq 0$ if $i \not = j$,
\item $(\sum m_i C_i \cdot C_j) = 0$,
\item there is no nonempty proper subset $I \subset \{1, \ldots, n\}$
such that $(C_i \cdot C_j) = 0$ for $i \in I$, $j \not \in I$.
\item $(\sum a_i C_i \cdot \sum a_i C_i) \leq 0$ with equality if and
only if there exists a $q \in \mathbf{Q}$ such that $a_i = qm_i$
for $i = 1, \ldots, n$,
\end{enumerate}
\end{lemma}

\begin{proof}
In the proof of Lemma \ref{lemma-intersection-pairing} we saw that
$(C_i \cdot C_j) = \deg(C_i \cap C_j)$ if $i \not = j$. This is
$\geq 0$ and $> 0 $ if and only if $C_i \cap C_j \not = \emptyset$.
This proves (1).

\medskip\noindent
Proof of (2). This is true because by Lemma \ref{lemma-divisor-special-fiber}
the invertible sheaf associated to $\sum m_i C_i$
is trivial and the trivial sheaf has degree zero.

\medskip\noindent
Proof of (3). This is expressing the fact that $X_k$ is connected
via the description of the intersection products given in the proof of (1).
Connectedness of the special fibre follows for example from
More on Morphisms, Lemma
\ref{more-morphisms-lemma-geometrically-connected-fibres-towards-normal}.

\medskip\noindent
Part (4) follows from (1), (2), and (3) by
Lemma \ref{lemma-recurring-symmetric-real}.
\end{proof}




\input{chapters}

\bibliography{my}
\bibliographystyle{amsalpha}

\end{document}
