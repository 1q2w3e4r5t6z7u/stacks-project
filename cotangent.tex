\input{preamble}

% OK, start here.
%
\begin{document}

\title{The Cotangent Complex}


\maketitle

\phantomsection
\label{section-phantom}

\tableofcontents

\section{Introduction}
\label{section-introduction}

\noindent
The goal of this chapter is to construct the cotangent complex of a
morphism of schemes and of a morphism of algebraic spaces.
Some references are the notes \cite{quillenhomology}, the paper
\cite{quillencohomology}, and the books
\cite{Andre} and \cite{cotangent}.





\section{Calculating derived lower shriek}
\label{section-calculate}

\noindent
In this section we work out some special cases of the situation
discussed in Cohomology on Sites, Section
\ref{sites-cohomology-section-derived-lower-shriek}.


\begin{lemma}
\label{lemma-situation-when-object}
Let $\mathcal{D}$ be a site. Let $p : \mathcal{C} \to \mathcal{D}$ be a
fibred category. Endow $\mathcal{C}$ with the topology inherited from
$\mathcal{D}$ (Stacks, Section \ref{stacks-section-topology}).
For $U \in \Ob(\mathcal{C})$ consider the induced morphism
of topoi
$$
\pi_U : \Sh(\mathcal{C}/U) \longrightarrow \Sh(\mathcal{D}/p(U))
$$
Then there exists a morphism of topoi
$$
\sigma : \Sh(\mathcal{D}/p(U)) \to \Sh(\mathcal{C}/U)
$$
such that $\pi_U \circ \sigma = \text{id}$ and $\sigma^{-1} = \pi_{U, *}$.
\end{lemma}

\begin{proof}
Observe that $p$ defines a morphism of topoi $\pi$ and that $\pi_U$
is the restriction of $\pi$ to the localizations, see
Stacks, Lemma \ref{stacks-lemma-topology-inherited-functorial}
and
Sites, Lemma \ref{sites-lemma-localize-cocontinuous}.
For an object $V \to p(U)$ of $\mathcal{D}/p(U)$ denote
$V \times_{p(U)} U \to U$ the strongly cartesian morphism of $\mathcal{C}$
over $\mathcal{D}$ which exists as $p$ is a fibred category.
The functor
$$
v : \mathcal{D}/p(U) \to \mathcal{C}/U,\quad
V/p(U) \mapsto V \times_{p(U)} U/U
$$
is continuous by the definition of the topology on $\mathcal{C}$.
Moreover, it is a right adjoint to $p$ by the definition of strongly
cartesian morphisms. Hence we are in the situation discussed in
Sites, Section \ref{sites-section-cocontinuous-adjoint}
and we see that the sheaf $\pi_{U, *}\mathcal{F}$
is equal to $V \mapsto \mathcal{F}(V \times_{p(U)} U)$
(see especially Sites, Lemma
\ref{sites-lemma-have-functor-other-way-morphism}).

\medskip\noindent
But here we have more. Namely, the functor $v$
is also cocontinuous (as all morphisms in coverings of $\mathcal{C}$ 
are strongly cartesian). Hence $v$ defines a morphism $\sigma$ as
indicated in the lemma. The equality $\sigma^{-1} = \pi_{U, *}$
is immediate from the definition. Since $\pi_U^{-1}\mathcal{G}$
is given by the rule $U'/U \mapsto \mathcal{G}(p(U')/p(U))$
it follows that $\sigma^{-1} \circ \pi_U^{-1} = \text{id}$
which proves the equality
$\pi_U \circ \sigma = \text{id}$.
\end{proof}

\begin{lemma}
\label{lemma-properties-lower-shriek-fibred-category}
Let $\mathcal{D}$ be a site. Let $p : \mathcal{C} \to \mathcal{D}$ be a
fibred category. Endow $\mathcal{C}$ with the topology inherited from
$\mathcal{D}$ (Stacks, Section \ref{stacks-section-topology}).
Denote $\pi : \Sh(\mathcal{C}) \to \Sh(\mathcal{D})$
the corresponding morphism of topoi.
Let $\mathcal{O}_\mathcal{D}$ be a sheaf of rings on $\mathcal{D}$ and set
$\mathcal{O}_\mathcal{C} = \pi^{-1}\mathcal{O}_\mathcal{D}$. Then
\begin{enumerate}
\item There are left adjoints
$\pi_! : \textit{Mod}(\mathcal{O}_\mathcal{C}) \to
\textit{Mod}(\mathcal{O}_\mathcal{D})$ and
$\pi_!^{\textit{Ab}} : \textit{Ab}(\mathcal{C}) \to \textit{Ab}(\mathcal{D})$
to $\pi^* = \pi^{-1}$ on modules and on abelian sheaves.
\item The diagram
$$
\xymatrix{
\textit{Mod}(\mathcal{O}_\mathcal{C}) \ar[d] \ar[r]_{\pi_!} &
\textit{Mod}(\mathcal{O}_\mathcal{D}) \ar[d] \\
\textit{Ab}(\mathcal{C}) \ar[r]^{\pi_!^{\textit{Ab}}} &
\textit{Ab}(\mathcal{D})
}
$$
commutes.
\item There are left adjoints
$L\pi_! : D(\mathcal{O}_\mathcal{C}) \to D(\mathcal{O}_\mathcal{D})$
and
$L\pi_!^{\textit{Ab}} : D(\mathcal{C}) \to D(\mathcal{D})$
to $\pi^* = \pi^{-1}$ on derived categories of modules and abelian sheaves.
\item The diagram
$$
\xymatrix{
D(\mathcal{O}_\mathcal{C}) \ar[d] \ar[r]_{L\pi_!} &
D(\mathcal{O}_\mathcal{D}) \ar[d] \\
D(\mathcal{C}) \ar[r]^{L\pi_!^{\textit{Ab}}} &
D(\mathcal{D})
}
$$
commutes.
\end{enumerate}
\end{lemma}

\begin{proof}
The functor $p$ is continuous and cocontinuous
Stacks, Lemma \ref{stacks-lemma-topology-inherited-functorial}.
Hence the existence of the functors $\pi_!$, $\pi_!^{\textit{Ab}}$,
$L\pi_!$, and $\pi_!^{\textit{Ab}}$ is discussed in
Modules on Sites, Sections
\ref{sites-modules-section-exactness-lower-shriek} and
\ref{sites-modules-section-lower-shriek-modules}
and
Cohomology on Sites, Section
\ref{sites-cohomology-section-derived-lower-shriek}.

\medskip\noindent
To prove (2) it suffices to show that the canonical map
$$
\pi_!^{\textit{Ab}}j_{U!}\mathcal{O}_U \to j_{p(U)!}\mathcal{O}_{p(U)}
$$
is an isomorphism for all objects $U$ of $\mathcal{C}$, see
Modules on Sites, Remark \ref{sites-modules-remark-when-shriek-equal}.
Because $j_{U!} = j_{U!}^{\textit{Ab}}$ (see
Modules on Sites, Remark \ref{sites-modules-remark-localize-shriek-equal})
we see that $\pi_!^{\textit{Ab}}j_{U!} = g_!^{\textit{Ab}}$ where
$g$ is the morphism of topoi associated to the continuous and
cocontinuous functor $\mathcal{C}/U \to \mathcal{D}$.
Hence the left hand side of the equation is $g_!\mathcal{O}_U$
which by definition is the sheaf associated to the presheaf
which associated to $V$ in $\mathcal{D}$ the value
\begin{align*}
\colim_{U'/U, V \to p(U')} \mathcal{O}_\mathcal{C}(U')
& =
\colim_{V \to p(U)} \mathcal{O}_\mathcal{D}(V)
\end{align*}
The equality holds because:
\begin{enumerate}
\item In the category of pairs $(U'/U, V \to p(U'))$ there is an
initial subcategory of pairs $(U'/U, V \to p(U'))$ where $V \to p(U')$
is an isomorphism. This holds as $p$ is a fibred category.
\item If $V \to p(U')$ is an isomorphism, then
$\mathcal{O}_\mathcal{D}(V) = \mathcal{O}_\mathcal{C}(U')$.
This holds as $\mathcal{O}_\mathcal{C} = \pi^{-1}\mathcal{O}_\mathcal{D}$
and for a sheaf $\mathcal{G}$ on $\mathcal{D}$ the assignement
$U \mapsto \mathcal{G}(p(U))$ is equal to $\pi^{-1}\mathcal{G}$.
\end{enumerate}
Since by definition the sheaf $j_{p(U)!}\mathcal{O}_{p(U)}$ is the sheaf
associated to $\colim_{V \to p(U)} \mathcal{O}_\mathcal{D}(U)$ we obtain the
equality in the first displayed formula.

\medskip\noindent
The construction of the functor $L\pi_!$ in
Modules on Sites, Lemma
\ref{sites-cohomology-lemma-existence-derived-lower-shriek}
shows that $L\pi_!\mathcal{O}_U = j_{p(U)!}\mathcal{O}_{p(U)}$.
We have seen above that this is equal to
$\pi_!^{\textit{Ab}}j_{U!}\mathcal{O}_U$.
Hence it suffices to show that $L\pi_!^{\textit{Ab}}j_{U!}\mathcal{O}_U$
is equal to $\pi_!^{\textit{Ab}}j_{U!}\mathcal{O}_U$.
To do this it suffices to show that
$g_!^{\textit{Ab}}\mathcal{O}_U = j_{p(U)!}\mathcal{O}_{p(U)}$,
where $g$ is the morphism of topoi associated to the continuous and
cocontinuous functor $\mathcal{C}/U \to \mathcal{D}$ (as above).
Note that $g$ factors as
$$
\Sh(\mathcal{C}/U) \xrightarrow{\pi_U} \Sh(\mathcal{D}/p(U))
\xrightarrow{j_{p(U)}} \Sh(\mathcal{D})
$$
and that $j_{p(U)!} = j_{p(U)}^{\textit{Ab}}$ is exact. Hence it suffices
to show that $L\pi_{U!}^{\textit{Ab}}\mathcal{O}_U = \mathcal{O}_{p(U)}$.
We have $\mathcal{O}_U = \pi_U^{-1}\mathcal{O}_{p(U)}$. Hence
for any object $E$ of $D(\mathcal{D}/p(U))$ we have
\begin{align*}
\Hom_{D(\mathcal{D}/p(U))}(L\pi_{U!}\mathcal{O}_U, E)
& =
\Hom_{D(\mathcal{C}/U)}(\mathcal{O}_U, \pi^{-1}E) \\
& =
\Hom_{D(\mathcal{C}/U)}(\pi^{-1}\mathcal{O}_{p(U)}, \pi^{-1}E) \\
& =
\Hom_{D(\mathcal{D}/p(U))}(\mathcal{O}_{p(U)}, R\pi_*\pi^{-1}E) \\
& =
\Hom_{D(\mathcal{D}/p(U))}(\mathcal{O}_{p(U)}, \sigma^{-1}\pi^{-1}E) \\
& =
\Hom_{D(\mathcal{D}/p(U))}(\mathcal{O}_{p(U)}, E)
\end{align*}
where we have used Lemma \ref{lemma-situation-when-object}.
By Yoneda's lemma we conclude.
\end{proof}

\begin{lemma}
\label{lemma-compute-pi-shriek}
Assumptions and notation as in
Lemma \ref{lemma-properties-lower-shriek-fibred-category}.
For $\mathcal{F}$ in $\textit{Ab}(\mathcal{C})$
the sheaf $\pi_!\mathcal{F}$ is the
sheaf associated the presheaf
$$
V \longmapsto \colim_{U \in \mathcal{C}_V} \mathcal{F}(U)
$$
with restriction maps as indicated in the proof.
\end{lemma}

\begin{proof}
Denote $\mathcal{H}$ be the rule of the lemma.
For a morphism $h : V \to V'$ of $\mathcal{D}$ there is a
``base change'' functor
$h^* : \mathcal{C}_{V'} \to \mathcal{C}_V$ of fibre categories.
Moreover for $U' \in \Ob(\mathcal{C}_{V'})$ there is a
strongly cartesian morphism $h^*U' \to U'$ covering $h$.
Restriction along these morphisms defines a transformation
of functors between $\mathcal{F}|_{\mathcal{C}_{V'}}$ and
$\mathcal{F}|_{\mathcal{C}_V}$. Hence a map between colimits, see
Categories, Lemma \ref{categories-lemma-functorial-colimit}.

\medskip\noindent
To prove the lemma we show that
$$
\Mor_{\textit{PSh}(\mathcal{D})}(\mathcal{H}, \mathcal{G}) =
\Mor_{\textit{Sh}(\mathcal{C})}(\mathcal{F}, \pi^{-1}\mathcal{G})
$$
for every sheaf $\mathcal{G}$ on $\mathcal{C}$. An element of the
left hand side is a compatible system of maps
$\mathcal{F}(U) \to \mathcal{G}(p(U))$ for all $U$ in $\mathcal{C}$.
Since $\pi^{-1}\mathcal{G}(U) = \mathcal{G}(p(U))$ by our choice
of topology on $\mathcal{C}$ we see the same thing is true for the
right hand side and we win.
\end{proof}



\section{The cotangent complex of a ring map}
\label{section-cotangent-ring-map}

\noindent
Let $A$ be a ring. Consider the pair of adjoint functors
$(F, i)$ where $i : \textit{Alg}_A \to \textit{Sets}$
is the forgetful functor and $F : \textit{Sets} \to \textit{Alg}_A$
assigns to a set $E$ the polynomial algebra $A[E]$ on $E$ over $A$.
Let $X_\bullet$ be the simplicial object of
$\text{Fun}(\textit{Alg}_A, \textit{Alg}_A)$ constructed in
Simplicial, Section \ref{simplicial-section-standard}.

\medskip\noindent
Consider an $A$-algebra $B$. Denote $P_\bullet = X_\bullet(B)$ the resulting
simplicial $A$-algebra. Recall that $P_0 = A[B]$, $P_1 = A[A[B]]$, and so on.
In particular each term $P_n$ is a polynomial $A$-algebra.
Recall also that there is an augmentation
$$
\epsilon : P_\bullet \longrightarrow B
$$
where we view $B$ as a constant simplicial $A$-algebra.
This map is a homotopy equivalence when viewed as a map of simplicial sets.

\begin{definition}
\label{definition-cotangent-complex-ring-map}
The cotangent complex $L_{B/A}$ of a ring map $A \to B$ is the complex of
$B$-modules associated to the simplicial $B$-module
$$
\Omega_{P_\bullet/A} \otimes_\epsilon B
$$
where $P_\bullet = X_\bullet(B)$ as above.
\end{definition}

\noindent
In Simplicial, Section \ref{simplicial-section-complexes} we associate a
chain complex to a simplicial module, but here we work with cochain complexes.
Thus the term $L_{B/A}^{-n}$ in degree $-n$ is the $B$-module
$\Omega_{P_n/A} \otimes_{P_n, \epsilon_n} B$ and $L_{B/A}^m = 0$
for $m > 0$. In order to prove some results about this complex
we give an alternative construction.

\begin{remark}
\label{remark-variant-cotangent-complex}
Let $A \to B$ be a ring map. Let $\mathcal{A}$ be the category of
arrows $\psi : C \to B$ of $A$-algebras and let $\mathcal{S}$ be
the category of maps $E \to B$ where $E$ is a set. There are adjoint
functors $i : \mathcal{A} \to \mathcal{S}$ (the forgetful functor)
and $F : \mathcal{S} \to \mathcal{A}$ which sends $E \to B$ to
$A[E] \to B$. Let $X_\bullet$ be the simplicial object of
$\text{Fun}(\textit{Alg}_A, \textit{Alg}_A)$ constructed in
Simplicial, Section \ref{simplicial-section-standard}.
Then it is immediately clear that $X_\bullet(\text{id}_B : B \to B)$
is equal to the simplicial polynomial algebra $P_\bullet$
endowed with its augmentation $\epsilon$ towards $B$
used in Definition \ref{definition-cotangent-complex-ring-map}.
\end{remark}

\begin{remark}
\label{remark-category-presentations}
Let $A \to B$ be a ring map. Recall that a {\it presentation of $B$ over $A$}
is a surjection $\alpha : P \to B$ of $A$-algebras where $P$ is a polynomial
algebra (in some set\footnote{It suffices to consider sets of cardinality
at most the cardinality of $B$.} of variables), see
Algebra, Section \ref{algebra-section-netherlander}.
Let $\mathcal{C} = \mathcal{C}_{B/A}$ denote the {\bf opposite}
of the category of presentations of $B$ over $A$. The reason for
taking the opposite is that we want to think of objects
$(P, \alpha)$ as corresponding to the diagram of affine schemes
$$
\xymatrix{
\Spec(B) \ar[d] \ar[r] & \Spec(P) \ar[ld] \\
\Spec(A)
}
$$
We endow $\mathcal{C}$ with the chaotic topology
(Sites, Section \ref{sites-example-indiscrete}), i.e., we endow
$\mathcal{C}$ with the structure of a site where coverings are given by
identities so that all presheaves are sheaves.
Moreover, we endow $\mathcal{C}$ with two sheaves of rings. The first
is the sheaf $\mathcal{O}$ which sends to object $(P, \alpha)$ to $P$.
Then second is the constant sheaf $B$, which we will denote
$\underline{B}$. We obtain the following diagram of morphisms of
ringed topoi
$$
\xymatrix{
(\Sh(\mathcal{C}), \underline{B}) \ar[r]_i \ar[d]_\pi &
(\Sh(\mathcal{C}), \mathcal{O}) \\
(\Sh(*), B)
}
$$
The morphism $i$ is the idenity on underlying topoi and
$i^\sharp : \mathcal{O} \to \underline{B}$ is the obvious surjective map.
The map $\pi$ is given by the continuous and cocontinuous functor
$\mathcal{C} \to *$ where $*$ denotes the category with one
object and one morphism. Note that $\pi^{-1}B = \underline{B}$
which provides us also with $\pi^\sharp$. Thus
Cohomology on Sites, Lemma
\ref{sites-cohomology-lemma-existence-derived-lower-shriek}
applies to $\pi$, and there is a derived functor
$$
L\pi_! : D(\underline{B}) \longrightarrow D(B)
$$
left adjoint to $\pi^* = \pi^{-1} : D(B) \to D(\underline{B})$.
\end{remark}

\begin{lemma}
\label{lemma-identify-pi-shriek}
With notation as in Remark \ref{remark-category-presentations}
and $\epsilon : P_\bullet \to B$ as in
Definition \ref{definition-cotangent-complex-ring-map}.
For any $\mathcal{F}$ in $\textit{Ab}(\mathcal{C})$ we have
$$
L\pi_!\mathcal{F} = \mathcal{F}(P_\bullet, \epsilon)
$$
\end{lemma}

\begin{proof}
Given any object $U = (Q, \beta)$ of $\mathcal{C}$ the rule
$$
(P, \alpha) \longmapsto
\text{free }B\text{-module on }\Mor_\mathcal{C}((Q, \beta), (P, \alpha))
$$
defines a $\underline{B}$-module $\mathcal{G}$. In the notation of
Modules on Sites, Definition
\ref{sites-modules-definition-localize-ringed-site}
$\mathcal{G} = j_{U!}\mathcal{O}_U$. Hence we have
$$
\Hom_{\underline{B}}(\mathcal{G}, \mathcal{F}) = \mathcal{F}(Q, \beta)
$$
for any object $\mathcal{F}$ of $\textit{Mod}(\underline{B})$.
Since the topology on $\mathcal{C}$ is chaotic, the section functors on
$\textit{Mod}(\underline{B})$ are exact. Hence $\mathcal{G}$
is projective. Every $\underline{B}$-module is a quotient of a
direct sum of $j_{U!}\mathcal{O}_U$
(Modules on Sites, Lemma \ref{sites-modules-lemma-module-quotient-flat}).
We conclude the category
$\textit{Mod}(\underline{B})$ has enough projectives.

\medskip\noindent
In particular we can compute $L\pi_!\mathcal{F}$ by choosing a resolution
$$
\ldots \to \mathcal{G}^{-1} \to \mathcal{G}^0 \to \mathcal{F} \to 0
$$
whose terms are direct sums of sheaves of the form above and taking
$L\pi_!\mathcal{F} = \pi_!\mathcal{G}^\bullet$. Consider the
double complex
$$
A^{\bullet, \bullet} = \mathcal{G}^\bullet(P_\bullet, \epsilon).
$$
The map $\mathcal{G}^0 \to \mathcal{F}$ gives a map of complexes
$A^{0, \bullet} \to \mathcal{F}(P_\bullet, \epsilon)$.
Since $\pi_!$ is computed by taking the colimit over the category
of presentations (Lemma \ref{lemma-compute-pi-shriek})
we see that the two compositions
$$
\mathcal{G}^m(P_1, \epsilon_1) \to \mathcal{G}^m(P_0, \epsilon_0)
\to \pi_!\mathcal{G}^m
$$
are equal. Thus we obtain a canonical map of complexes
$$
\text{Tot}(A^{\bullet, \bullet})
\longrightarrow
\pi_!\mathcal{G}^\bullet = L\pi_!\mathcal{F}
$$
To prove the lemma it suffices to show that the complexes
$$
\ldots \to \mathcal{G}^m(P_1, \epsilon_1) \to
\mathcal{G}^m(P_0, \epsilon_0) \to \pi_!\mathcal{G}^m \to 0
$$
are exact, see Homology, Lemma
\ref{homology-lemma-double-complex-gives-resolution}.
Since the sheaves $\mathcal{G}^m$ are direct sums of the sheaves
$j_{U!}\mathcal{O}_U$ with $U = (Q, \beta)$ we reduce to
$\mathcal{G} = j_{U!}\mathcal{O}_U$. The complex above is then
the complex associated to the free $B$-module on the simplicial set
$$
\Mor_\mathcal{C}((Q, \beta), (P_\bullet, \epsilon))
$$
We have to show that this complex is acyclic in nonzero degree
and has cohomology module equal to $B$ in degree $0$.
Namely, we have seen that $\pi_!j_{U!}\mathcal{O}_U = B$ in the proof of
Lemma \ref{lemma-properties-lower-shriek-fibred-category}
(this is also clear from the description of $\pi_!$
in Lemma \ref{lemma-compute-pi-shriek}).

\medskip\noindent
Write $Q = A[E]$ for some set $E$ (this is possible by our choice of
the category $\mathcal{C}$). By the alternative construction of
$(P_\bullet, \epsilon)$
in Remark \ref{remark-variant-cotangent-complex}, and using the notation
$\mathcal{A}$, $\mathcal{S}$, $F$, $i$, $X_\bullet$ from that remark,
we see that
$$
\Mor_\mathcal{C}((Q, \beta), (P_\bullet, \epsilon)) =
\Mor_{\mathcal{A}}((Q, \beta), (P_\bullet, \epsilon)) = 
\Mor_{\mathcal{S}}((E \to B), i(X_\bullet(B)))
$$
By Simplicial, Lemma \ref{simplicial-lemma-standard-simplicial-homotopy}
this simplicial set is homotopy equivalent to the constant simplicial set on
$\Mor_\mathcal{S}((E \to B), (B \to B))$, i.e., on a singleton.
Because ``taking the free $B$-module on'' is a functor, we
see that the simplicial module above is homotopy equivalent
to the constant simplicial module $B$
(Simplicial, Remark \ref{simplicial-remark-homotopy-better}).
This finishes the proof as taking the associated complex transforms
homotopy equivalent simplicial modules into homotopy equivalent
complexes of modules by Simplicial, Lemma \ref{simplicial-lemma-homotopy-s-N}.
\end{proof}










\input{chapters}

\bibliography{my}
\bibliographystyle{amsalpha}

\end{document}
