\input{preamble}

% OK, start here
%
\begin{document}

\title{de Rham Cohomology; under construction}


\maketitle

\phantomsection
\label{section-phantom}

\tableofcontents

\section{Introduction}
\label{section-introduction}

\noindent
In this chapter we start with a discussion of the de Rham complex
of a morphism of schemes and we end with a proof that de Rham cohomology
defines a Weil cohomology theory when the base field has characteristic zero.




\section{The de Rham complex}
\label{section-de-rham-complex}

\noindent
Let $p : X \to S$ be a morphism of schemes. There is a complex
$$
\Omega^\bullet_{X/S} =
\mathcal{O}_{X/S} \to \Omega^1_{X/S} \to \Omega^2_{X/S} \to \ldots
$$
of $p^{-1}\mathcal{O}_S$-modules with
$\Omega^i_{X/S} = \wedge^i(\Omega_{X/S})$
placed in degree $i$ and differential determined by the rule
$\text{d}(g_0 \text{d}g_1 \wedge \ldots \wedge \text{d}g_p) =
\text{d}g_0 \wedge \text{d}g_1 \wedge \ldots \wedge \text{d}g_p$
on local sections.
See Modules, Section \ref{modules-section-de-rham-complex}.

\medskip\noindent
Given a commutative diagram
$$
\xymatrix{
X' \ar[r]_f \ar[d] & X \ar[d] \\
S' \ar[r] & S
}
$$
of schemes, there are canonical maps of complexes
$f^{-1}\Omega_{X/S}^\bullet \to \Omega^\bullet_{X'/S'}$ and
$\Omega_{X/S}^\bullet \to f_*\Omega^\bullet_{X'/S'}$.
See Modules, Section \ref{modules-section-de-rham-complex}.
Linearizing, for every $p$ we obtain a linear map
$f^*\Omega^p_{X/S} \to \Omega^p_{X'/S'}$.

\medskip\noindent
In particular, if $f : Y \to X$ be a morphism of schemes over
a base scheme $S$, then there is a map of complexes
$$
\Omega^\bullet_{X/S} \longrightarrow f_*\Omega^\bullet_{Y/S}
$$
Linearizing, we see that for every $p \geq 0$ we obtain a canonical map
$$
\Omega^p_{X/S} \otimes_{\mathcal{O}_X} f_*\mathcal{O}_Y
\longrightarrow
f_*\Omega^p_{Y/S}
$$

\begin{lemma}
\label{lemma-base-change-de-rham}
Let
$$
\xymatrix{
X' \ar[r]_f \ar[d] & X \ar[d] \\
S' \ar[r] & S
}
$$
be a cartesian diagram of schemes. Then the maps discussed
above induce isomorphisms
$f^*\Omega^p_{X/S} \to \Omega^p_{X'/S'}$.
\end{lemma}

\begin{proof}
Combine Morphisms, Lemma \ref{morphisms-lemma-base-change-differentials}
with the fact that formation of exterior power commutes with base change.
\end{proof}

\begin{lemma}
\label{lemma-etale}
Consider a commutative diagram of schemss
$$
\xymatrix{
X' \ar[r]_f \ar[d] & X \ar[d] \\
S' \ar[r] & S
}
$$
If $X' \to X$ and $S' \to S$ are \'etale, then the maps discussed
above induce isomorphisms
$f^*\Omega^p_{X/S} \to \Omega^p_{X'/S'}$.
\end{lemma}

\begin{proof}
We have $\Omega_{S'/S} = 0$ and $\Omega_{X'/X} = 0$, see for example
Morphisms, Lemma \ref{morphisms-lemma-etale-at-point}. Then by
the short exact sequences of Morphisms, Lemmas
\ref{morphisms-lemma-triangle-differentials} and
\ref{morphisms-lemma-triangle-differentials-smooth}
we see that $\Omega_{X'/S'} = \Omega_{X'/S} = f^*\Omega_{X/S}$.
Taking exterior powers we conclude.
\end{proof}






\section{de Rham cohomology}
\label{section-de-rham-cohomology}

\noindent
Let $p : X \to S$ be a morphism of schemes. We define the
{\it de Rham cohomology of $X$ over $S$} to be the cohomology
groups
$$
H^i_{dR}(X/S) = H^i(R\Gamma(X, \Omega^\bullet_{X/S}))
$$
Since $\Omega^\bullet_{X/S}$ is a complex of $p^{-1}\mathcal{O}_S$-modules,
these cohomology groups are naturally modules over $H^0(S, \mathcal{O}_S)$.

\medskip\noindent
Given a commutative diagram
$$
\xymatrix{
X' \ar[r]_f \ar[d] & X \ar[d] \\
S' \ar[r] & S
}
$$
of schemes, using the canonical maps of Section \ref{section-de-rham-complex}
we obtain pullback maps
$$
f^* :
R\Gamma(X, \Omega^\bullet_{X/S})
\longrightarrow
R\Gamma(X', \Omega^\bullet_{X'/S'})
$$
and
$$
f^* : H^i_{dR}(X/S) \longrightarrow H^i_{dR}(X'/S')
$$
These pullbacks satisfy an obvious composition law.
In particular, if we work over a fixed base scheme $S$, then de Rham
cohomology is a contravariant functor on the category of schemes over $S$.

\begin{lemma}
\label{lemma-de-rham-affine}
Let $X \to S$ be a morphism of affine schemes given by the ring map
$R \to A$. Then $R\Gamma(X, \Omega^\bullet_{X/S}) = \Omega^\bullet_{A/R}$
in $D(R)$ and $H^i_{dR}(X/S) = H^i(\Omega^\bullet_{A/R})$.
\end{lemma}

\begin{proof}
This follows from Cohomology of Schemes, Lemma
\ref{coherent-lemma-quasi-coherent-affine-cohomology-zero}
and Leray's acyclicity lemma
(Derived Categories, Lemma \ref{derived-lemma-leray-acyclicity}).
\end{proof}

\begin{lemma}
\label{lemma-quasi-coherence-relative}
Let $p : X \to S$ be a morphism of schemes. If $p$ is quasi-compact
and quasi-separated, then $Rp_*\Omega^\bullet_{X/S}$ is an object
of $D_\QCoh(\mathcal{O}_S)$.
\end{lemma}

\begin{proof}
There is a spectral sequence with first page
$E_1^{a, b} = R^ap_*\Omega^q_{X/S}$ converging to $Rp_*\Omega^\bullet_{X/S}$
(see Derived Categories, Lemma \ref{derived-lemma-two-ss-complex-functor}).
Hence by Homology, Lemma \ref{homology-lemma-first-quadrant-ss}
it suffices to show that $R^ap_*\Omega^q_{X/S}$ is quasi-coherent.
This follows from Cohomology of Schemes, Lemma
\ref{coherent-lemma-quasi-coherence-higher-direct-images}.
\end{proof}

\begin{lemma}
\label{lemma-coherence-relative}
Let $p : X \to S$ be a proper morphism of schemes with $S$ locally
Noetherian. Then $Rp_*\Omega^\bullet_{X/S}$ is an object
of $D_{\textit{Coh}}(\mathcal{O}_S)$.
\end{lemma}

\begin{proof}
In this case by Morphisms, Lemma \ref{morphisms-lemma-finite-type-differentials}
the modules $\Omega^i_{X/S}$ are coherent. Hence we can use exactly the
same argument as in the proof of Lemma \ref{lemma-quasi-coherence-relative}
using Cohomology of Schemes, Proposition
\ref{coherent-proposition-proper-pushforward-coherent}.
\end{proof}

\begin{lemma}
\label{lemma-finite-de-Rham}
Let $A$ be a Noetherian ring. Let $X$ be a proper scheme over $S = \Spec(A)$.
Then $H^i_{dR}(X/S)$ is a finite $A$-module for all $i$.
\end{lemma}

\begin{proof}
This is a special case of Lemma \ref{lemma-coherence-relative}.
\end{proof}

\begin{lemma}
\label{lemma-proper-smooth-de-Rham}
Let $f : X \to S$ be a proper smooth morphism of schemes. Then
$Rf_*\Omega^p_{X/S}$, $p \geq 0$ and $Rf_*\Omega^\bullet_{X/S}$ are
perfect objects of $D(\mathcal{O}_S)$ whose formation commutes
with arbitrary change of base.
\end{lemma}

\begin{proof}
Since $f$ is smooth the modules $\Omega^p_{X/S}$ are finite locally
free $\mathcal{O}_X$-modules, see Morphisms, Lemma
\ref{morphisms-lemma-smooth-omega-finite-locally-free}. Their
formation commutes with arbitrary change of base by
Lemma \ref{lemma-base-change-de-rham}. Hence
$Rf_*\Omega^p_{X/S}$ is a perfect object of $D(\mathcal{O}_S)$
whose formation commutes with abitrary base change, see
Derived Categories of Schemes, Lemma
\ref{perfect-lemma-flat-proper-perfect-direct-image-general}.
This proves the first assertion of the lemma.

\medskip\noindent
To prove that $Rf_*\Omega^\bullet_{X/S}$ is perfect on $S$ we may work
locally on $S$. Thus we may assume $S$ is quasi-compact. This means
we may assume that $\Omega^n_{X/S}$ is zero for $n$ large enough.
For every $p \geq 0$ we claim that
$Rf_*\sigma_{\geq p}\Omega^\bullet_{X/S}$ is a
perfect object of $D(\mathcal{O}_S)$ whose formation commutes
with arbitrary change of base. By the above we see that
this is true for $p \gg 0$. Suppose the claim holds for $p$
and consider the distinguished triangle
$$
\sigma_{\geq p}\Omega^\bullet_{X/S} \to
\sigma_{\geq p - 1}\Omega^\bullet_{X/S} \to
\Omega^{p - 1}_{X/S}[-(p - 1)] \to
(\sigma_{\geq p}\Omega^\bullet_{X/S})[1]
$$
in $D(f^{-1}\mathcal{O}_S)$.
Applying the exact functor $Rf_*$ we obtain a distinguished triangle
in $D(\mathcal{O}_S)$.
Since we have the 2-out-of-3 property for being perfect
(Cohomology, Lemma \ref{cohomology-lemma-two-out-of-three-perfect})
we conclude $Rf_*\sigma_{\geq p - 1}\Omega^\bullet_{X/S}$ is a
perfect object of $D(\mathcal{O}_S)$. Similarly for the
commutation with arbitrary base change.
\end{proof}





\section{Cup product}
\label{section-cup-product}

\noindent
Consider the maps
$\Omega^p_{X/S} \times \Omega^q_{X/S} \to \Omega^{p + q}_{X/S}$
given by $(\omega , \eta) \longmapsto \omega \wedge \eta$.
Using the formula for $\text{d}$ given in Section \ref{section-de-rham-complex}
and the Leibniz rule for $\text{d} : \mathcal{O}_X \to \Omega_{X/S}$
we see that $\text{d}(\omega \wedge \eta) = \text{d}(\omega) \wedge \eta +
(-1)^{\deg(\omega)} \omega \wedge \text{d}(\eta)$. This means that
$\wedge$ defines a morphism
\begin{equation}
\label{equation-wedge}
\wedge :
\text{Tot}(
\Omega^\bullet_{X/S} \otimes_{p^{-1}\mathcal{O}_S} \Omega^\bullet_{X/S})
\longrightarrow
\Omega^\bullet_{X/S}
\end{equation}
of complexes of $p^{-1}\mathcal{O}_S$-modules.

\medskip\noindent
Combining the cup product of
Cohomology, Section \ref{cohomology-section-cup-product}
with (\ref{equation-wedge}) we find a
$H^0(S, \mathcal{O}_S)$-bilinear cup product map
$$
\cup : H^i_{dR}(X/S) \times H^j_{dR}(X/S) \longrightarrow H^{i + j}_{dR}(X/S)
$$
For example, if $\omega \in \Gamma(X, \Omega^i_{X/S})$ and
$\eta \in \Gamma(X, \Omega^j_{X/S})$ are closed, then
the cup product of the de Rham cohomology classes of
$\omega$ and $\eta$ is the de Rham cohomology class of $\omega \wedge \eta$,
see discussion in Cohomology, Section \ref{cohomology-section-cup-product}.

\medskip\noindent
Given a commutative diagram
$$
\xymatrix{
X' \ar[r]_f \ar[d] & X \ar[d] \\
S' \ar[r] & S
}
$$
of schemes, the pullback maps
$f^* : R\Gamma(X, \Omega^\bullet_{X/S}) \to R\Gamma(X', \Omega^\bullet_{X'/S'})$
and
$f^* : H^i_{dR}(X/S) \longrightarrow H^i_{dR}(X'/S')$
are compatible with the cup product defined above.

\begin{lemma}
\label{lemma-cup-product-graded-commutative}
Let $p : X \to S$ be a morphism of schemes.
The cup product on $H^*_{dR}(X/S)$ is associative and
graded commutative.
\end{lemma}

\begin{proof}
This follows from
Cohomology, Lemmas \ref{cohomology-lemma-cup-product-associative} and
\ref{cohomology-lemma-cup-product-commutative}
and the fact that $\wedge$ is associative and graded commutative.
\end{proof}

\begin{remark}
\label{remark-relative-cup-product}
Let $p : X \to S$ be a morphism of schemes. Then we can think of
$\Omega^\bullet_{X/S}$ as a sheaf of differential graded
$p^{-1}\mathcal{O}_S$-algebras, see
Differential Graded Sheaves, Definition \ref{sdga-definition-dga}.
In particular, the discussion in
Differential Graded Sheaves, Section \ref{sdga-section-misc}
applies. For example, this means that for any commutative diagram
$$
\xymatrix{
X \ar[d]_p \ar[r]_f & Y \ar[d]^q \\
S \ar[r]^h & T
}
$$
of schemes there is a canonical relative cup product
$$
\mu :
Rf_*\Omega^\bullet_{X/S}
\otimes_{q^{-1}\mathcal{O}_T}^\mathbf{L}
Rf_*\Omega^\bullet_{X/S}
\longrightarrow
Rf_*\Omega^\bullet_{X/S}
$$
in $D(Y, q^{-1}\mathcal{O}_T)$ which is associative and
which on cohomology reproduces the cup product discussed above.
\end{remark}

\begin{remark}
\label{remark-cup-product-as-a-map}
Let $f : X \to S$ be a morphism of schemes. Let $\xi \in H_{dR}^n(X/S)$.
According to the discussion
Differential Graded Sheaves, Section \ref{sdga-section-misc}
there exists a canonical morphism
$$
\xi' : \Omega^\bullet_{X/S} \to \Omega^\bullet_{X/S}[n]
$$
in $D(f^{-1}\mathcal{O}_S)$ uniquely characterized by
(1) and (2) of the following list of properties:
\begin{enumerate}
\item $\xi'$ can be lifted to a map in the derived category of right
differential graded $\Omega^\bullet_{X/S}$-modules, and
\item $\xi'(1) = \xi$ in
$H^0(X, \Omega^\bullet_{X/S}[n]) = H^n_{dR}(X/S)$,
\item the map $\xi'$ sends $\eta \in H^m_{dR}(X/S)$
to $\xi \cup \eta$ in $H^{n + m}_{dR}(X/S)$,
\item the construction of $\xi'$ commutes with restrictions to
opens: for $U \subset X$ open the restriction $\xi'|_U$ is
the map corresponding to the image $\xi|_U \in H^n_{dR}(U/S)$,
\item for any diagram as in Remark \ref{remark-relative-cup-product}
we obtain a commutative diagram
$$
\xymatrix{
Rf_*\Omega^\bullet_{X/S}
\otimes_{q^{-1}\mathcal{O}_T}^\mathbf{L}
Rf_*\Omega^\bullet_{X/S} \ar[d]_{\xi' \otimes \text{id}}
\ar[r]_-\mu &
Rf_*\Omega^\bullet_{X/S} \ar[d]^{\xi'} \\
Rf_*\Omega^\bullet_{X/S}[n]
\otimes_{q^{-1}\mathcal{O}_T}^\mathbf{L}
Rf_*\Omega^\bullet_{X/S}
\ar[r]^-\mu &
Rf_*\Omega^\bullet_{X/S}[n]
}
$$
in $D(Y, q^{-1}\mathcal{O}_T)$.
\end{enumerate}
\end{remark}




\section{Hodge cohomology}
\label{section-hodge-cohomology}

\noindent
Let $p : X \to S$ be a morphism of schemes. We define the
{\it de Hodge cohomology of $X$ over $S$} to be the cohomology groups
$$
H^n_{Hodge}(X/S) = \bigoplus\nolimits_{n = p + q} H^q(X, \Omega^p_{X/S})
$$
viewed as a graded $H^0(X, \mathcal{O}_X)$-module. The wedge product
of forms combined with the cup product of
Cohomology, Section \ref{cohomology-section-cup-product}
defines a $H^0(X, \mathcal{O}_X)$-bilinear cup product
$$
\cup :
H^i_{Hodge}(X/S) \times H^j_{Hodge}(X/S)
\longrightarrow
H^{i + j}_{Hodge}(X/S)
$$
Of course if  $\xi \in H^q(X, \Omega^p_{X/S})$ and
$\xi' \in H^{q'}(X, \Omega^{p'}_{X/S})$ then $\xi \cup \xi' \in
H^{q + q'}(X, \Omega^{p + p'}_{X/S})$.

\begin{lemma}
\label{lemma-cup-product-hodge-graded-commutative}
Let $p : X \to S$ be a morphism of schemes.
The cup product on $H^*_{Hodge}(X/S)$ is associative and graded commutative.
\end{lemma}

\begin{proof}
The proof is identical to the proof of
Lemma \ref{lemma-cup-product-graded-commutative}.
\end{proof}

\noindent
Given a commutative diagram
$$
\xymatrix{
X' \ar[r]_f \ar[d] & X \ar[d] \\
S' \ar[r] & S
}
$$
of schemes, there are pullback maps
$f^* : H^i_{Hodge}(X/S) \longrightarrow H^i_{Hodge}(X'/S')$
compatible with gradings and with the cup product defined above.







\section{Two spectral sequences}
\label{section-hdoge-to-de-rham}

\noindent
Let $p : X \to S$ be a morphism of schemes. Since the category
of $p^{-1}\mathcal{O}_S$-modules on $X$ has enough injectives
there exist a Cartan-Eilenberg resolution for $\Omega^\bullet_{X/S}$.
See Derived Categories, Lemma \ref{derived-lemma-cartan-eilenberg}.
Hence we can apply Derived Categories, Lemma
\ref{derived-lemma-two-ss-complex-functor} to get two spectral sequences
both converging to the de Rham cohomology of $X$ over $S$.

\medskip\noindent
The first is customarily called {\it the Hodge-to-de Rham spectral sequence}.
The first page of this spectral sequence has
$$
E_1^{p, q} = H^q(X, \Omega^p_{X/S})
$$
which are the Hodge cohomology groups of $X/S$ (whence the name). The
differential $d_1$ on this page is given by the maps
$d_1^{p, q} : H^q(X, \Omega^p_{X/S}) \to H^q(X. \Omega^{p + 1}_{X/S})$
induced by the differential
$\text{d} : \Omega^p_{X/S} \to \Omega^{p + 1}_{X/S}$.
Here is a picture
$$
\xymatrix{
H^2(X, \mathcal{O}_X) \ar[r] \ar@{-->}[rrd] \ar@{..>}[rrrdd] &
H^2(X, \Omega^1_{X/S}) \ar[r] \ar@{-->}[rrd] &
H^2(X, \Omega^2_{X/S}) \ar[r] &
H^2(X, \Omega^3_{X/S}) \\
H^1(X, \mathcal{O}_X) \ar[r] \ar@{-->}[rrd] &
H^1(X, \Omega^1_{X/S}) \ar[r] \ar@{-->}[rrd] &
H^1(X, \Omega^2_{X/S}) \ar[r] &
H^1(X, \Omega^3_{X/S}) \\
H^0(X, \mathcal{O}_X) \ar[r] &
H^0(X, \Omega^1_{X/S}) \ar[r] &
H^0(X, \Omega^2_{X/S}) \ar[r] &
H^0(X, \Omega^3_{X/S})
}
$$
where we have drawn striped arrows to indicate the source and target of
the differentials on the $E_2$ page and a dotted arrow for a differential
on the $E_3$ page. Looking in degree $0$ we conclude that
$$
H^0_{dR}(X/S) =
\Ker(\text{d} : H^0(X, \mathcal{O}_X) \to H^0(X, \Omega^1_{X/S}))
$$
Of course, this is also immediately clear from the fact that the
de Rham complex starts in degree $0$ with $\mathcal{O}_X \to \Omega^1_{X/S}$.

\medskip\noindent
The second spectral sequence is usually called
{\it the conjugate spectral sequence}. The second page of this
spectral sequence has
$$
E_2^{p, q} = H^p(X, H^q(\Omega^\bullet_{X/S})) = H^p(X, \mathcal{H}^q)
$$
where $\mathcal{H}^q = H^q(\Omega^\bullet_{X/S})$ is the $q$th
cohomology sheaf of the de Rham complex of $X/S$. The differentials
on this page are given by $E_2^{p, q} \to E_2^{p + 2, q - 1}$.
Here is a picture
$$
\xymatrix{
H^0(X, \mathcal{H}^2) \ar[rrd] \ar@{..>}[rrrdd] &
H^1(X, \mathcal{H}^2) \ar[rrd] &
H^2(X, \mathcal{H}^2) &
H^3(X, \mathcal{H}^2) \\
H^0(X, \mathcal{H}^1) \ar[rrd] &
H^1(X, \mathcal{H}^1) \ar[rrd] &
H^2(X, \mathcal{H}^1) &
H^3(X, \mathcal{H}^1) \\
H^0(X, \mathcal{H}^0) &
H^1(X, \mathcal{H}^0) &
H^2(X, \mathcal{H}^0) &
H^3(X, \mathcal{H}^0)
}
$$
Looking in degree $0$ we conclude that
$$
H^0_{dR}(X/S) = H^0(X, \mathcal{H}^0)
$$
which is obvious if you think about it. In degree $1$ we get an exact sequence
$$
0 \to H^1(X, \mathcal{H}^0) \to H^1_{dR}(X/S) \to
H^0(X, \mathcal{H}^1) \to H^2(X, \mathcal{H}^0) \to H^2_{dR}(X/S)
$$
It turns out that if $X \to S$ is smooth and $S$ lives in characteristic $p$,
then the sheaves $\mathcal{H}^q$ are computable (in terms of a certain
sheaves of differentials) and the conjugate spectral sequence is a valuable
tool (insert future reference here).



\section{The Hodge filtration}
\label{section-hodge-filtration}

\noindent
Let $X \to S$ be a morphism of schemes. The Hodge filtration on $H^n_{dR}(X/S)$
is the filtration induced by the Hodge-to-de Rham spectral sequence
(Homology, Definition
\ref{homology-definition-filtration-cohomology-filtered-complex}).
To avoid misunderstanding, we explicitly define it as follows.

\begin{definition}
\label{definition-hodge-filtration}
Let $X \to S$ be a morphism of schemes. The {\it Hodge filtration}
on $H^n_{dR}(X/S)$ is the filtration with terms
$$
F^pH^n_{dR}(X/S) = \Im\left(H^n(X, \sigma_{\geq p}\Omega^\bullet_{X/S})
\longrightarrow H^n_{dR}(X/S)\right)
$$
where $\sigma_{\geq p}\Omega^\bullet_{X/S}$ is as in
Homology, Section \ref{homology-section-truncations}.
\end{definition}

\noindent
Of course $\sigma_{\geq p}\Omega^\bullet_{X/S}$ is a subcomplex of
the relative de Rham complex and we obtain a filtration
$$
\Omega^\bullet_{X/S} = \sigma_{\geq 0}\Omega^\bullet_{X/S} \supset
\sigma_{\geq 1}\Omega^\bullet_{X/S} \supset
\sigma_{\geq 2}\Omega^\bullet_{X/S} \supset
\sigma_{\geq 3}\Omega^\bullet_{X/S} \supset \ldots
$$
of the relative de Rham complex with
$\text{gr}^p(\Omega^\bullet_{X/S}) = \Omega^p_{X/S}[-p]$.
The spectral sequence constructed in
Cohomology, Lemma \ref{cohomology-lemma-spectral-sequence-filtered-object}
for $\Omega^\bullet_{X/S}$ viewed as a filtered complex of sheaves
is the same as the Hodge-to-de Rham spectral sequence constructed in
Section \ref{section-hdoge-to-de-rham} by
Cohomology, Example \ref{cohomology-example-spectral-sequence-bis}. Further the
wedge product (\ref{equation-wedge}) sends
$\text{Tot}(\sigma_{\geq i}\Omega^\bullet_{X/S} \otimes_{p^{-1}\mathcal{O}_S}
\sigma_{\geq j}\Omega^\bullet_{X/S})$ into
$\sigma_{\geq i + j}\Omega^\bullet_{X/S}$. Hence we get
commutative diagrams
$$
\xymatrix{
H^n(X, \sigma_{\geq j}\Omega^\bullet_{X/S}))
\times 
H^m(X, \sigma_{\geq j}\Omega^\bullet_{X/S}))
\ar[r] \ar[d] &
H^{n + m}(X, \sigma_{\geq i + j}\Omega^\bullet_{X/S})) \ar[d] \\
H^n_{dR}(X/S) \times
H^m_{dR}(X/S)
\ar[r]^\cup &
H^{n + m}_{dR}(X/S)
}
$$
In particular we find that
$$
F^iH^n_{dR}(X/S) \cup F^jH^m_{dR}(X/S) \subset F^{i + j}H^{n + m}_{dR}(X/S)
$$






\section{K\"unneth formula}
\label{section-kunneth}

\noindent
An important feature of de Rham cohomology is that there is a
K\"unneth formula.

\medskip\noindent
Let $a : X \to S$ and $b : Y \to S$ be morphisms of schemes with the same
target. Let $p : X \times_S Y \to X$ and $q : X \times_S Y \to Y$ be the
projection morphisms and $f = a \circ p = b \circ q$. Here is a picture
$$
\xymatrix{
& X \times_S Y \ar[ld]^p \ar[rd]_q \ar[dd]^f \\
X \ar[rd]_a & & Y \ar[ld]^b \\
& S
}
$$

\begin{lemma}
\label{lemma-de-rham-complex-product}
In the situation above there is a canonical isomorphism
$$
\text{Tot}(p^{-1}\Omega^\bullet_{X/S}
\otimes_{f^{-1}\mathcal{O}_S} q^{-1}\Omega^\bullet_{Y/S})
\longrightarrow
\Omega^\bullet_{X \times_S Y/S}
$$
of complexes of $f^{-1}\mathcal{O}_S$-modules.
\end{lemma}

\begin{proof}
By Derived Categories of Schemes, Remark \ref{perfect-remark-silly}
we have
$$
p^{-1}\Omega^i_{X/S} \otimes_{f^{-1}\mathcal{O}_S} q^{-1}\Omega^j_{Y/S} =
p^*\Omega^i_{X/S} \otimes_{\mathcal{O}_{X \times_S Y}} q^*\Omega^j_{Y/S}
$$
for all $i, j$. On the other hand, we know that
$
\Omega_{X \times_S Y/S} = p^*\Omega_{X/S} \oplus q^*\Omega_{Y/S}
$
by Morphisms, Lemma \ref{morphisms-lemma-differential-product}.
Taking exterior powers we obtain
$$
\Omega^n_{X \times_S Y/S} =
\bigoplus\nolimits_{i + j = n}
p^*\Omega^i_{X/S} \otimes_{\mathcal{O}_{X \times_S Y}} q^*\Omega^j_{Y/S} =
\bigoplus\nolimits_{i + j = n}
p^{-1}\Omega^i_{X/S} \otimes_{f^{-1}\mathcal{O}_S} q^{-1}\Omega^j_{Y/S}
$$
by elementary properties of exterior powers. This finishes the proof.
\end{proof}

\noindent
If $S = \Spec(A)$ is affine, then combining the result of
Lemma \ref{lemma-de-rham-complex-product} with the cup product map of
Derived Categories of Schemes, Equation (\ref{perfect-equation-de-rham-kunneth})
we obtain a cup product
$$
R\Gamma(X, \Omega^\bullet_{X/S})
\otimes_A^\mathbf{L}
R\Gamma(Y, \Omega^\bullet_{Y/S})
\longrightarrow
R\Gamma(X \times_S Y, \Omega^\bullet_{X \times_S Y/S})
$$
On the level of cohomology, using the discussion in
More on Algebra, Section \ref{more-algebra-section-products-tor},
we obtain a canonical map
$$
H^i_{dR}(X/S) \otimes_A H^j_{dR}(Y/S)
\longrightarrow
H^{i + j}_{dR}(X \times_S Y/S),\quad
(\xi, \zeta) \longmapsto p^*\xi \cup q^*\zeta
$$
We note that the construction above indeed proceeds by
first pulling back and then taking the cup product.

\begin{lemma}
\label{lemma-kunneth-de-rham}
Assume $X$ and $Y$ are smooth, quasi-compact, and quasi-separated over
$S = \Spec(A)$. Then the map
$$
R\Gamma(X, \Omega^\bullet_{X/S})
\otimes_A^\mathbf{L}
R\Gamma(Y, \Omega^\bullet_{Y/S})
\longrightarrow
R\Gamma(X \times_S Y, \Omega^\bullet_{X \times_S Y/S})
$$
is an isomorphism in $D(A)$.
\end{lemma}

\begin{proof}
By Morphisms, Lemma \ref{morphisms-lemma-smooth-omega-finite-locally-free}
the sheaves $\Omega^n_{X/S}$ and $\Omega^m_{Y/S}$ are finite locally free
$\mathcal{O}_X$ and $\mathcal{O}_Y$-modules. On the other hand, $X$ and $Y$
are flat over $S$ (Morphisms, Lemma \ref{morphisms-lemma-smooth-flat})
and hence we find that $\Omega^n_{X/S}$ and $\Omega^m_{Y/S}$ are flat over $S$.
Also, observe that $\Omega^\bullet_{X/S}$ is a locally bounded. Thus
the result by Lemma \ref{lemma-de-rham-complex-product} and
Derived Categories of Schemes, Lemma \ref{perfect-lemma-kunneth-special}.
\end{proof}

\noindent
Given a possibly non-affine base scheme $S$ we can do this
construction over all affine opens and upon sheafification
we obtain a relative cup product
$$
Ra_*\Omega^\bullet_{X/S}
\otimes_{\mathcal{O}_S}^\mathbf{L}
Rb_*\Omega^\bullet_{Y/S}
\longrightarrow
Rf_*\Omega^\bullet_{X \times_S Y/S}
$$
in $D(\mathcal{O}_S)$. We can also define this as the composition
of the maps
$$
\xymatrix{
Ra_*\Omega^\bullet_{X/S}
\otimes_{\mathcal{O}_S}^\mathbf{L}
Rb_*\Omega^\bullet_{Y/S}
\ar[d]^{\text{units of adjunction}}  \\
Rf_*(p^{-1}\Omega^\bullet_{X/S})
\otimes_{\mathcal{O}_S}^\mathbf{L}
Rf_*(q^{-1}\Omega^\bullet_{Y/S}) \ar[r] \ar[d]^{\text{relative cup product}} &
Rf_*(\Omega^\bullet_{X \times_S Y/S})
\otimes_{\mathcal{O}_S}^\mathbf{L}
Rf_*(\Omega^\bullet_{X \times_S Y/S}) \ar[d]^{\text{relative cup product}} \\
Rf_*(p^{-1}\Omega^\bullet_{X/S}
\otimes_{f^{-1}\mathcal{O}_S}^\mathbf{L}
q^{-1}\Omega^\bullet_{Y/S})
\ar[d]^{\text{from derived to usual}} \ar[r] &
Rf_*(\Omega^\bullet_{X \times_S Y/S}
\otimes_{f^{-1}\mathcal{O}_S}^\mathbf{L}
\Omega^\bullet_{X \times_S Y/S})
\ar[d]^{\text{from derived to usual}} \\
Rf_*\text{Tot}(p^{-1}\Omega^\bullet_{X/S}
\otimes_{f^{-1}\mathcal{O}_S}
q^{-1}\Omega^\bullet_{Y/S}) \ar@{=}[rd] \ar[r] &
Rf_*\text{Tot}(\Omega^\bullet_{X \times_S Y/S}
\otimes_{f^{-1}\mathcal{O}_S}
\Omega^\bullet_{X \times_S Y/S}) \ar[d] \\
&
Rf_*\Omega^\bullet_{X \times_S Y/S}
}
$$
Here the first arrow uses the units $\text{id} \to Rp_* p^{-1}$
and $\text{id} \to Rq_* q^{-1}$ of adjunction as well as the
identifications $Rf_* p^{-1} = Ra_* Rp_* p^{-1}$ and
$Rf_* q^{-1} = Rb_* Rq_* q^{-1}$.
The second arrow is the relative cup product of
Cohomology, Remark \ref{cohomology-remark-cup-product}.
The third arrow is the map sending a derived tensor product
of complexes to the totalization of the tensor product of complexes.
The final equality is Lemma \ref{lemma-de-rham-complex-product}.
Using the identifications
$R\Gamma(X, \Omega^\bullet_{X/S}) = R\Gamma(S, Ra_*\Omega^\bullet_{X/S})$
and
$R\Gamma(Y, \Omega^\bullet_{Y/S}) = R\Gamma(S, Rb_*\Omega^\bullet_{Y/S})$
we obtain a map
$$
R\Gamma(X, \Omega^\bullet_{X/S}) \otimes_{H^0(S, \mathcal{O}_S)}^\mathbf{L}
R\Gamma(Y, \Omega^\bullet_{Y/S}) \to
R\Gamma(S, Ra_*\Omega^\bullet_{X/S}
\otimes_{\mathcal{O}_S}^\mathbf{L}
Rb_*\Omega^\bullet_{Y/S})
$$
by using the cup product of
Cohomology, Section \ref{cohomology-section-cup-product} on $S$.
Using the relative cup product for de Rham cohomology constructed
by the large diagram above and taking $R\Gamma(S, -)$ this produces
a cup product
$$
H^i_{dR}(X/S) \otimes_{H^0(S, \mathcal{O}_S)} H^j_{dR}(Y/S)
\longrightarrow
H^{i + j}_{dR}(X \times_S Y/S),\quad
(\xi, \zeta) \longmapsto p^*\xi \cup q^*\zeta
$$
which as indicated is given by pulling back and then cupping.
The reader can deduce this from the commutativity of the diagram
and the compatibility of relative cup product with composition of
morphisms given in Cohomology, Lemma
\ref{cohomology-lemma-compose-cup-product} (take the second morphism
equal to the morphism to a point).

\begin{lemma}
\label{lemma-kunneth-de-rham-relative}
Assume $X$ and $Y$ are smooth, quasi-compact, and quasi-separated over
$S$. Then the relative cup product
$$
Ra_*\Omega^\bullet_{X/S}
\otimes_{\mathcal{O}_S}^\mathbf{L}
Rb_*\Omega^\bullet_{Y/S}
\longrightarrow
Rf_*\Omega^\bullet_{X \times_S Y/S}
$$
is an isomorphism in $D(\mathcal{O}_S)$.
\end{lemma}

\begin{proof}
Immediate consequence of Lemma \ref{lemma-kunneth-de-rham}.
\end{proof}







\section{First chern class in de Rham cohomology}
\label{section-first-chern-class}

\noindent
Let $X \to S$ be a morphism of schemes. There is a map of complexes
$$
\text{d}\log : \mathcal{O}_X^*[-1] \longrightarrow \Omega^\bullet_{X/S}
$$
which sends the section $g \in \mathcal{O}_X^*(U)$ to the section
$\text{d}\log(g) = g^{-1}\text{d}g$ of $\Omega^1_{X/S}(U)$.
Thus we can consider the map
$$
\Pic(X) = H^1(X, \mathcal{O}_X^*) =
H^2(X, \mathcal{O}_X^*[-1]) \longrightarrow H^2_{dR}(X/S)
$$
where the first equality is
Cohomology, Lemma \ref{cohomology-lemma-h1-invertible}.
The image of the isomorphism class of the invertible module
$\mathcal{L}$ is denoted $c^{dR}_1(\mathcal{L}) \in H^2_{dR}(X/S)$.

\medskip\noindent
We can also use the map $\text{d}\log : \mathcal{O}_X^* \to \Omega^1_{X/S}$
to define a chern class in Hodge cohomology
$$
c_1^{Hodge} : \Pic(X) \longrightarrow H^1(X, \Omega^1_{X/S})
\subset H^2_{Hodge}(X/S)
$$
These constructions are compatible with pullbacks.

\begin{lemma}
\label{lemma-pullback-c1}
Given a commutative diagram
$$
\xymatrix{
X' \ar[r]_f \ar[d] & X \ar[d] \\
S' \ar[r] & S
}
$$
of schemes the diagrams
$$
\xymatrix{
\Pic(X') \ar[d]_{c_1^{dR}} &
\Pic(X) \ar[d]^{c_1^{dR}} \ar[l]^{f^*} \\
H^2_{dR}(X'/S') &
H^2_{dR}(X/S) \ar[l]_{f^*}
}
\quad
\xymatrix{
\Pic(X') \ar[d]_{c_1^{Hodge}} &
\Pic(X) \ar[d]^{c_1^{Hodge}} \ar[l]^{f^*} \\
H^1(X', \Omega^1_{X'/S'}) &
H^1(X, \Omega^1_{X/S}) \ar[l]_{f^*}
}
$$
commute.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\noindent
Let us ``compute'' the element $c^{dR}_1(\mathcal{L})$ in {\v C}ech
cohomology (with sign rules for {\v C}ech differentials
as in Cohomology, Section
\ref{cohomology-section-cech-cohomology-of-complexes}).
Namely, choose an open covering
$\mathcal{U} : X = \bigcup_{i \in I} U_i$ such that
we have a trivializing section $s_i$ of $\mathcal{L}|_{U_i}$ for all $i$.
On the overlaps $U_{i_0i_1} = U_{i_0} \cap U_{i_1}$
we have an invertible function $f_{i_0i_1}$ such that
$f_{i_0i_1} = s_{i_1}|_{U_{i_0i_1}} s_{i_0}|_{U_{i_0i_1}}^{-1}$\footnote{The
{\v C}ech differential of a $0$-cycle $\{a_{i_0}\}$ has
$a_{i_1} - a_{i_0}$ over $U_{i_0i_1}$.}.
Of course we have
$$
f_{i_1i_2}|_{U_{i_0i_1i_2}}
f_{i_0i_2}^{-1}|_{U_{i_0i_1i_2}}
f_{i_0i_1}|_{U_{i_0i_1i_2}} = 1
$$
The cohomology class of $\mathcal{L}$ in $H^1(X, \mathcal{O}_X^*)$ is
the image of the {\v C}ech cohomology class of the cocycle $\{f_{i_0i_1}\}$ in
$\check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{O}_X^*)$.
Therefore we see that $c_1^{dR}(\mathcal{L})$ is the image
of the cohomology class associated to the {\v C}ech cocycle
$\{\alpha_{i_0 \ldots i_p}\}$ in
$\text{Tot}(\check{\mathcal{C}}^\bullet(\mathcal{U}, \Omega_{X/S}^\bullet))$
of degree $2$ given by
\begin{enumerate}
\item $\alpha_{i_0} = 0$ in $\Omega^2_{X/S}(U_{i_0})$,
\item $\alpha_{i_0i_1} = f_{i_0i_1}^{-1}\text{d}f_{i_0i_1}$ in
$\Omega^1_{X/S}(U_{i_0i_1})$, and
\item $\alpha_{i_0i_1i_2} = 0$ in $\mathcal{O}_{X/S}(U_{i_0i_1i_2})$.
\end{enumerate}
Suppose we have invertible modules $\mathcal{L}_k$, $k = 1, \ldots, a$
each trivialized over $U_i$ for all $i \in I$ giving rise to cocycles
$f_{k, i_0i_1}$ and $\alpha_k = \{\alpha_{k, i_0 \ldots i_p}\}$ as above.
Using the rule in
Cohomology, Section \ref{cohomology-section-cech-cohomology-of-complexes}
we can compute
$$
\beta = \alpha_1 \cup \alpha_2 \cup \ldots \cup \alpha_a
$$
to be given by the cocycle $\beta = \{\beta_{i_0 \ldots i_p}\}$
described as follows
\begin{enumerate}
\item $\beta_{i_0 \ldots i_p} = 0$ in
$\Omega^{2a - p}_{X/S}(U_{i_0 \ldots i_p})$ unless $p = a$, and
\item $\beta_{i_0 \ldots i_a} = (-1)^{a(a - 1)/2}
\alpha_{1, i_0i_1} \wedge \alpha_{2, i_1 i_2} \wedge \ldots \wedge
\alpha_{a, i_{a - 1}i_a}$ in
$\Omega^a_{X/S}(U_{i_0 \ldots i_a})$.
\end{enumerate}
Thus this is a cocycle representing
$c_1^{dR}(\mathcal{L}_1) \cup \ldots \cup c_1^{dR}(\mathcal{L}_a)$
Of course, the same computation shows that the cocycle
$\{\beta_{i_0 \ldots i_a}\}$ in
$\check{\mathcal{C}}^a(\mathcal{U}, \Omega_{X/S}^a))$
represents the cohomology class
$c_1^{Hodge}(\mathcal{L}_1) \cup \ldots \cup c_1^{Hodge}(\mathcal{L}_a)$

\begin{remark}
\label{remark-truncations}
Here is a reformulation of the calculations above in more abstract terms.
Let $p : X \to S$ be a morphism of schemes. Let $\mathcal{L}$ be an
invertible $\mathcal{O}_X$-module. If we view $\text{d}\log$ as a map
$$
\mathcal{O}_X^*[-1] \to \sigma_{\geq 1}\Omega^\bullet_{X/S}
$$
then using $\Pic(X) = H^1(X, \mathcal{O}_X^*)$ as above we find a
cohomology class
$$
\gamma_1(\mathcal{L}) \in H^2(X, \sigma_{\geq 1}\Omega^\bullet_{X/S})
$$
The image of $\gamma_1(\mathcal{L})$ under the map
$\sigma_{\geq 1}\Omega^\bullet_{X/S} \to \Omega^\bullet_{X/S}$
recovers $c_1^{dR}(\mathcal{L})$. In particular we see that
$c_1^{dR}(\mathcal{L}) \in F^1H^2_{dR}(X/S)$, see
Section \ref{section-hodge-filtration}. The image of $\gamma_1(\mathcal{L})$
under the map $\sigma_{\geq 1}\Omega^\bullet_{X/S} \to \Omega^1_{X/S}[-1]$
recovers $c_1^{Hodge}(\mathcal{L})$. Taking the cup product
(see Section \ref{section-hodge-filtration}) we obtain
$$
\xi = \gamma_1(\mathcal{L}_1) \cup \ldots \cup \gamma_1(\mathcal{L}_a) \in
H^{2a}(X, \sigma_{\geq a}\Omega^\bullet_{X/S})
$$
The commutative diagrams in Section \ref{section-hodge-filtration}
show that $\xi$ is mapped to
$c_1^{dR}(\mathcal{L}_1) \cup \ldots \cup c_1^{dR}(\mathcal{L}_a)$
in $H^{2a}_{dR}(X/S)$ by the map
$\sigma_{\geq a}\Omega^\bullet_{X/S} \to \Omega^\bullet_{X/S}$.
Also, it follows
$c_1^{dR}(\mathcal{L}_1) \cup \ldots \cup c_1^{dR}(\mathcal{L}_a)$
is contained in $F^a H^{2a}_{dR}(X/S)$. Similarly, the map
$\sigma_{\geq a}\Omega^\bullet_{X/S} \to \Omega^a_{X/S}[-a]$
sends $\xi$ to
$c_1^{Hodge}(\mathcal{L}_1) \cup \ldots \cup c_1^{Hodge}(\mathcal{L}_a)$
in $H^a(X, \Omega^a_{X/S})$.
\end{remark}

\begin{remark}
\label{remark-log-forms}
Let $p : X \to S$ be a morphism of schemes. For $i > 0$
denote $\Omega^i_{X/S, log} \subset \Omega^i_{X/S}$ the abelian subsheaf
generated by local sections of the form
$$
\text{d}\log(u_1) \wedge \ldots \wedge \text{d}\log(u_i)
$$
where $u_1, \ldots, u_n$ are invertible local sections of $\mathcal{O}_X$.
For $i = 0$ the subsheaf $\Omega^0_{X/S, log} \subset \mathcal{O}_X$
is the image of $\mathbf{Z} \to \mathcal{O}_X$. For every $i \geq 0$ we
have a map of complexes
$$
\Omega^i_{X/S, log}[-i] \longrightarrow \Omega^\bullet_{X/S}
$$
because the derivative of a logarithmic form is zero. Moreover, wedging
logarithmic forms gives another, hence we find bilinear maps
$$
\wedge :  \Omega^i_{X/S, log} \times
\Omega^j_{X/S, log} \longrightarrow \Omega^{i + j}_{X/S, log}
$$
compatible with (\ref{equation-wedge}) and the maps above.
Let $\mathcal{L}$ be an invertible $\mathcal{O}_X$-module.
Using the map of abelian sheaves
$\text{d}\log : \mathcal{O}_X^* \to \Omega^1_{X/S, log}$
and the identification $\Pic(X) = H^1(X, \mathcal{O}_X^*)$
we find a canonical cohomology class
$$
\tilde \gamma_1(\mathcal{L}) \in H^1(X, \Omega^1_{X/S, log})
$$
These classes have the following properties
\begin{enumerate}
\item the image of $\tilde \gamma_1(\mathcal{L})$ under the canonical
map $\Omega^1_{X/S, log}[-1] \to \sigma_{\geq 1}\Omega^\bullet_{X/S}$
sends $\tilde \gamma_1(\mathcal{L})$ to the class
$\gamma_1(\mathcal{L}) \in 
H^2(X, \sigma_{\geq 1}\Omega^\bullet_{X/S})$
of Remark \ref{remark-truncations},
\item the image of $\tilde \gamma_1(\mathcal{L})$ under the canonical
map $\Omega^1_{X/S, log}[-1] \to \Omega^\bullet_{X/S}$
sends $\tilde \gamma_1(\mathcal{L})$ to $c_1^{dR}(\mathcal{L})$ in
$H^2_{dR}(X/S)$,
\item the image of $\tilde \gamma_1(\mathcal{L})$ under the canonical
map $\Omega^1_{X/S, log} \to \Omega^1_{X/S}$
sends $\tilde \gamma_1(\mathcal{L})$ to $c_1^{Hodge}(\mathcal{L})$ in
$H^1(X, \Omega^1_{X/S})$,
\item the construction of these classes is compatible with pullbacks,
\item add more here.
\end{enumerate}
\end{remark}





\section{de Rham cohomology of a line bundle}
\label{section-line-bundle}

\noindent
A line bundle is a special case of a vector bundle, which in turn is a
cone endowed with some extra structure. To intelligently talk about
the de Rham complex of these, it makes sense to discuss the de Rham
complex of a graded ring.

\begin{remark}[de Rham complex of a graded ring]
\label{remark-de-rham-complex-graded}
Let $G$ be an abelian monoid written additively with neutral element $0$.
Let $R \to A$ be a ring map and assume $A$ comes with a grading
$A = \bigoplus_{g \in G} A_g$ by $R$-modules such that $R$ maps into $A_0$
and $A_g \cdot A_{g'} \subset A_{g + g'}$. Then the module of differentials
comes with a grading
$$
\Omega_{A/R} = \bigoplus\nolimits_{g \in G} \Omega_{A/R, g}
$$
where $\Omega_{A/R, g}$ is the $R$-submodule of $\Omega_{A/R}$
generated by $a_0 \text{d}a_1$ with $a_i \in A_{g_i}$ such that
$g = g_0 + g_1$. Similarly, we obtain
$$
\Omega^p_{A/R} = \bigoplus\nolimits_{g \in G} \Omega^p_{A/R, g}
$$
where $\Omega^p_{A/R, g}$ is the $R$-submodule of $\Omega^p_{A/R}$
generated by $a_0 \text{d}a_1 \wedge \ldots \wedge \text{d}a_p$
with $a_i \in A_{g_i}$ such that $g = g_0 + g_1 + \ldots + g_p$.
Of course the differentials preserve the grading and the wedge
product is compatible with the gradings in the obvious manner.
\end{remark}

\noindent
Let $f : X \to S$ be a morphism of schemes. Let $\pi : C \to X$ be a cone, see
Constructions, Definition \ref{constructions-definition-abstract-cone}.
Recall that this means $\pi$ is affine and we have a grading
$\pi_*\mathcal{O}_C = \bigoplus_{n \geq 0} \mathcal{A}_n$ with
$\mathcal{A}_0 = \mathcal{O}_X$.
Using the discussion in Remark \ref{remark-de-rham-complex-graded}
over affine opens we find that\footnote{With excuses for the notation!}
$$
\pi_*(\Omega^\bullet_{C/S}) =
\bigoplus\nolimits_{n \geq 0} \Omega^\bullet_{C/S, n}
$$
is canonically a direct sum of subcomplexes. Moreover, we have a factorization
$$
\Omega^\bullet_{X/S} \to \Omega^\bullet_{C/S, 0} \to
\pi_*(\Omega^\bullet_{C/S})
$$
and we know that $\omega \wedge \eta \in \Omega^{p + q}_{C/S, n + m}$
if $\omega \in \Omega^p_{C/S, n}$ and $\eta \in \Omega^q_{C/S, m}$.

\medskip\noindent
Let $f : X \to S$ be a morphism of schemes. Let $\pi : L \to X$ be the
line bundle associated to the invertible $\mathcal{O}_X$-module $\mathcal{L}$.
This means that $\pi$ is the unique affine morphism such that
$$
\pi_*\mathcal{O}_L = 
\bigoplus\nolimits_{n \geq 0} \mathcal{L}^{\otimes n}
$$
as $\mathcal{O}_X$-algebras. Thus $L$ is a cone over $X$.
By the discussion above we find a
canonical direct sum decomposition
$$
\pi_*(\Omega^\bullet_{L/S}) =
\bigoplus\nolimits_{n \geq 0} \Omega^\bullet_{L/S, n}
$$
compatible with wedge product, compatible with the decomposition
of $\pi_*\mathcal{O}_L$ above, and such that $\Omega_{X/S}$
maps into the part $\Omega_{L/S, 0}$ of degree $0$.

\medskip\noindent
There is another case which will be useful to us. Namely, consider the
complement\footnote{The scheme $L^\star$ is the $\mathbf{G}_m$-torsor
over $X$ associated to $L$. This is why the grading we get below is
a $\mathbf{Z}$-grading, compare with Groupoids,
Example \ref{groupoids-example-Gm-on-affine} and
Lemmas \ref{groupoids-lemma-complete-reducibility-Gm} and
\ref{groupoids-lemma-Gm-equivariant-module}.}
$L^\star \subset L$ of the zero section $o : X \to L$ in our line
bundle $L$. A local computation shows we have a canonical isomorphism
$$
(L^\star \to X)_*\mathcal{O}_{L^\star} =
\bigoplus\nolimits_{n \in \mathbf{Z}} \mathcal{L}^{\otimes n}
$$
of $\mathcal{O}_X$-algebras. The right hand side is a $\mathbf{Z}$-graded
quasi-coherent $\mathcal{O}_X$-algebra. Using the discussion in
Remark \ref{remark-de-rham-complex-graded} over affine opens we find that
$$
(L^\star \to X)_*(\Omega^\bullet_{L^\star/S}) =
\bigoplus\nolimits_{n \in \mathbf{Z}} \Omega^\bullet_{L^\star/S, n}
$$
compatible with wedge product, compatible with the decomposition
of $(L^\star \to X)_*\mathcal{O}_{L^\star}$ above, and such that
$\Omega_{X/S}$ maps into the part $\Omega_{L^\star/S, 0}$ of degree $0$.
The complex $\Omega^\bullet_{L^\star/S, 0}$ will be
of particular interest to us.

\begin{lemma}
\label{lemma-the-complex-for-L-star}
With notation as above, there is a short exact sequence of complexes
$$
0 \to \Omega^\bullet_{X/S} \to
\Omega^\bullet_{L^\star/S, 0} \to
\Omega^\bullet_{X/S}[-1] \to 0
$$
\end{lemma}

\begin{proof}
We have constructed the map
$\Omega^\bullet_{X/S} \to \Omega^\bullet_{L^\star/S, 0}$ above.

\medskip\noindent
Construction of
$\text{Res} : \Omega^\bullet_{L^\star/S, 0} \to \Omega^\bullet_{X/S}[-1]$.
Let $U \subset X$ be an open and let $s \in \mathcal{L}(U)$
and $s' \in \mathcal{L}^{\otimes -1}(U)$ be sections such that
$s' s = 1$. Then $s$ gives an invertible section of the sheaf of
algebras $(L^\star \to X)_*\mathcal{O}_{L^\star}$ over $U$
with inverse $s' = s^{-1}$. Then we can consider the $1$-form
$\text{d}\log(s) = s' \text{d}(s)$ which is an element of
$\Omega^1_{L^\star/S, 0}(U)$ by our construction of the grading on
$\Omega^1_{L^\star/S}$. Our computations on affines given below
will show that $1$ and $\text{d}\log(s)$ freely generate
$\Omega^\bullet_{L^\star/S, 0}|_U$ as a right module over
$\Omega^\bullet_{X/S}|_U$.
Thus we can define $\text{Res}$ over $U$ by the rule
$$
\text{Res}(\omega' + \text{d}\log(s) \wedge \omega) = \omega
$$
for all $\omega', \omega \in \Omega^\bullet_{X/S}(U)$. This
map is independent of the choice of local generator $s$ and hence
glues to give a global map. Namely, another choice of $s$
would be of the form $gs$ for some invertible $g \in \mathcal{O}_X(U)$
and we would get $\text{d}\log(gs) = g^{-1}\text{d}(g) + \text{d}\log(s)$
from which the independence easily follows.
Finally, observe that our rule for $\text{Res}$
is compatible with differentials
as $\text{d}(\omega' + \text{d}\log(s) \wedge \omega) =
\text{d}(\omega') - \text{d}\log(s) \wedge \text{d}(\omega)$
and because the differential on $\Omega^\bullet_{X/S}[-1]$
sends $\omega'$ to $-\text{d}(\omega')$ by our sign convention in
Homology, Definition \ref{homology-definition-shift-cochain}.

\medskip\noindent
Local computation. We can cover $X$ by affine opens $U \subset X$
such that $\mathcal{L}|_U \cong \mathcal{O}_U$ which moreover map
into an affine open $V \subset S$. Write $U = \Spec(A)$, $V = \Spec(R)$
and choose a generator $s$ of $\mathcal{L}$. We find that we have
$$
L^\star \times_X U = \Spec(A[s, s^{-1}])
$$
Computing differentials we see that
$$
\Omega^1_{A[s, s^{-1}]/R} =
A[s, s^{-1}] \otimes_A \Omega^1_{A/R} \oplus A[s, s^{-1}] \text{d}\log(s)
$$
and therefore taking exterior powers we obtain
$$
\Omega^p_{A[s, s^{-1}]/R} =
A[s, s^{-1}] \otimes_A \Omega^p_{A/R}
\oplus
A[s, s^{-1}] \text{d}\log(s) \otimes_A \Omega^{p - 1}_{A/R}
$$
Taking degree $0$ parts we find
$$
\Omega^p_{A[s, s^{-1}]/R, 0} =
\Omega^p_{A/R} \oplus \text{d}\log(s) \otimes_A \Omega^{p - 1}_{A/R}
$$
and the proof of the lemma is complete.
\end{proof}

\begin{lemma}
\label{lemma-the-complex-for-L-star-gives-chern-class}
The ``boundary'' map
$\delta : \Omega^\bullet_{X/S} \to \Omega^\bullet_{X/S}[2]$
in $D(X, f^{-1}\mathcal{O}_S)$ coming from
the short exact sequence in Lemma \ref{lemma-the-complex-for-L-star}
is the map of Remark \ref{remark-cup-product-as-a-map}
for $\xi = c_1^{dR}(\mathcal{L})$.
\end{lemma}

\begin{proof}
To be precise we consider the shift
$$
0 \to \Omega^\bullet_{X/S}[1] \to
\Omega^\bullet_{L^\star/S, 0}[1] \to
\Omega^\bullet_{X/S} \to 0
$$
of the short exact sequence of Lemma \ref{lemma-the-complex-for-L-star}.
As the degree zero part of a grading on
$(L^\star \to X)_*\Omega^\bullet_{L^\star/S}$
we see that $\Omega^\bullet_{L^\star/S, 0}$ is a differential
graded $\mathcal{O}_X$-algebra and that the map
$\Omega^\bullet_{X/S} \to \Omega^\bullet_{L^\star/S, 0}$
is a homomorphism of differential graded $\mathcal{O}_X$-algebras.
Hence we may view $\Omega^\bullet_{X/S}[1] \to
\Omega^\bullet_{L^\star/S, 0}[1]$ as a map of right differential graded
$\Omega^\bullet_{X/S}$-modules on $X$. The map
$\text{Res} : \Omega^\bullet_{L^\star/S, 0}[1] \to \Omega^\bullet_{X/S}$
is a map of right differential graded $\Omega^\bullet_{X/S}$-modules
since it is locally defined by the rule
$\text{Res}(\omega' + \text{d}\log(s) \wedge \omega) = \omega$, see
proof of Lemma \ref{lemma-the-complex-for-L-star}.
Thus by the discussion in
Differential Graded Sheaves, Section \ref{sdga-section-misc}
we see that $\delta$ comes from a map
$\delta' : \Omega^\bullet_{X/S} \to \Omega^\bullet_{X/S}[2]$
in the derived category $D(\Omega^\bullet_{X/S}, \text{d})$
of right differential graded modules over the de Rham complex.
The uniqueness averted in Remark \ref{remark-cup-product-as-a-map}
shows it suffices to prove that $\delta(1) = c_1^{dR}(\mathcal{L})$.

\medskip\noindent
We claim that there is a commutative diagram
$$
\xymatrix{
0 \ar[r] &
\mathcal{O}_X^* \ar[r] \ar[d]_{\text{d}\log} &
E \ar[r] \ar[d] &
\underline{\mathbf{Z}} \ar[d] \ar[r] &
0 \\
0 \ar[r] &
\Omega^\bullet_{X/S}[1] \ar[r] &
\Omega^\bullet_{L^\star/S, 0}[1] \ar[r] &
\Omega^\bullet_{X/S} \ar[r] &
0
}
$$
where the top row is a short exact sequence of abelian sheaves whose
boundary map sends $1$ to the class of $\mathcal{L}$ in
$H^1(X, \mathcal{O}_X^*)$. It suffices to prove the claim
by the compatibility of boundary maps with maps between short
exact sequences. We define $E$ as the sheafification of the rule
$$
U \longmapsto \{(s, n) \mid
n \in \mathbf{Z},\ s \in \mathcal{L}^{\otimes n}(U)\text{ generator}\}
$$
with group structure given by $(s, n) \cdot (t, m) = (s \otimes t, n + m)$.
The middle vertical map sends $(s, n)$ to $\text{d}\log(s)$. This produces
a map of short exact sequences
because the map $Res : \Omega^1_{L^\star/S, 0} \to \mathcal{O}_X$
constructed in the proof of Lemma \ref{lemma-the-complex-for-L-star} sends
$\text{d}\log(s)$ to $1$ if $s$ is a local generator of $\mathcal{L}$.
To calculate the boundary of $1$ in the top row, choose local trivializations
$s_i$ of $\mathcal{L}$ over opens $U_i$ as in
Section \ref{section-first-chern-class}. On the overlaps
$U_{i_0i_1} = U_{i_0} \cap U_{i_1}$
we have an invertible function $f_{i_0i_1}$ such that
$f_{i_0i_1} = s_{i_1}|_{U_{i_0i_1}} s_{i_0}|_{U_{i_0i_1}}^{-1}$
and the cohomology class of $\mathcal{L}$ is given by the {\v C}ech cocycle
$\{f_{i_0i_1}\}$. Then of course we have
$$
(f_{i_0i_1}, 0) = (s_{i_1}, 1)|_{U_{i_0i_1}} \cdot
(s_{i_0}, 1)|_{U_{i_0i_1}}^{-1}
$$
as sections of $E$ which finishes the proof.
\end{proof}

\begin{lemma}
\label{lemma-push-omega-a}
With notation as above we have
\begin{enumerate}
\item $\Omega^p_{L^\star/S, n} =
\Omega^p_{L^\star/S, 0} \otimes_{\mathcal{O}_X} \mathcal{L}^{\otimes n}$
for all $n \in \mathbf{Z}$ as quasi-coherent $\mathcal{O}_X$-modules,
\item $\Omega^\bullet_{X/S} = \Omega^\bullet_{L/X, 0}$
as complexes, and
\item for $n > 0$ and $p \geq 0$ we have
$\Omega^p_{L/X, n} = \Omega^p_{L^\star/S, n}$.
\end{enumerate}
\end{lemma}

\begin{proof}
In each case there is a globally defined canonical map which
is an isomorphism by local calculations which we omit.
\end{proof}

\begin{lemma}
\label{lemma-line-bundle-characteristic-zero}
In the situation above, assume there is a morphism $S \to \Spec(\mathbf{Q})$.
Then $\Omega^\bullet_{X/S} \to \pi_*\Omega^\bullet_{L/S}$ is a
quasi-isomorphism and $H_{dR}^*(X/S) = H_{dR}^*(L/S)$.
\end{lemma}

\begin{proof}
Let $R$ be a $\mathbf{Q}$-algebra. Let $A$ be an $R$-algebra.
The affine local statement is that the map
$$
\Omega^\bullet_{A/R} \longrightarrow \Omega^\bullet_{A[t]/R}
$$
is a quasi-isomorphism of complexes of $R$-modules. In fact it is a
homotopy equivalence with homotopy inverse given by the map sending
$g \omega + g' \text{d}t \wedge \omega'$ to $g(0)\omega$ for
$g, g' \in A[t]$ and $\omega, \omega' \in \Omega^\bullet_{A/R}$.
The homotopy sends $g \omega + g' \text{d}t \wedge \omega'$
to $(\int g') \omega'$ were $\int g' \in A[t]$ is the polynomial
with vanishing constant term whose derivative with respect to $t$
is $g'$. Of course, here we use that $R$ contains $\mathbf{Q}$
as $\int t^n = (1/n)t^{n + 1}$.
\end{proof}

\begin{example}
\label{example-affine-line}
Lemma \ref{lemma-line-bundle-characteristic-zero} is
false in positive characteristic. The de Rham complex of
$\mathbf{A}^1_k = \Spec(k[x])$ over a field $k$ looks like a direct sum
$$
k \oplus
\bigoplus\nolimits_{n \geq 1}
(k \cdot t^n \xrightarrow{n}
k \cdot t^{n - 1} \text{d}t)
$$
Hence if the characteristic of $k$ is $p > 0$, then
we see that both $H^0_{dR}(\mathbf{A}^1_k/k)$ and
$H^1_{dR}(\mathbf{A}^1_k/k)$
are infinite dimensional over $k$.
\end{example}








\section{de Rham cohomology of projective space}
\label{section-projective-space}

\noindent
Let $A$ be a ring. Let $n \geq 1$. The structure morphism
$\mathbf{P}^n_A \to \Spec(A)$ is a proper smooth of relative
dimension $n$. It is smooth of relative dimension $n$ and of finite type
as $\mathbf{P}^n_A$ has a finite affine open covering by schemes each
isomorphic to $\mathbf{A}^n_A$, see Constructions, Lemma
\ref{constructions-lemma-standard-covering-projective-space}.
It is proper because it is also separated and universally closed
by Constructions, Lemma \ref{constructions-lemma-projective-space-separated}.
Let us denote $\mathcal{O}$ and $\mathcal{O}(d)$ the structure sheaf
$\mathcal{O}_{\mathbf{P}^n_A}$ and the Serre twists
$\mathcal{O}_{\mathbf{P}^n_A}(d)$.
Let us denote $\Omega = \Omega_{\mathbf{P}^n_A/A}$ the sheaf
of relative differentials and $\Omega^p$ its exterior powers.

\begin{lemma}
\label{lemma-euler-sequence}
There exists a short exact sequence
$$
0 \to \Omega \to \mathcal{O}(-1)^{\oplus n + 1} \to \mathcal{O} \to 0
$$
\end{lemma}

\begin{proof}
To explain this, we recall that
$\mathbf{P}^n_A = \text{Proj}(A[T_0, \ldots, T_n])$,
and we write symbolically
$$
\mathcal{O}(-1)^{\oplus n + 1} =
\bigoplus\nolimits_{j = 0, \ldots, n} \mathcal{O}(-1) \text{d}T_j
$$
The first arrow
$$
\Omega \to
\bigoplus\nolimits_{j = 0, \ldots, n} \mathcal{O}(-1) \text{d}T_j
$$
in the short exact sequence above
is given on each of the standard opens
$D_+(T_i) = \Spec(A[T_0/T_i, \ldots, T_n/T_i])$
mentioned above by the rule
$$
\sum\nolimits_{j \not = i} g_j \text{d}(T_j/T_i)
\longmapsto
\sum\nolimits_{j \not = i} g_j/T_i \text{d}T_j
- (\sum\nolimits_{j \not = i} g_jT_j/T_i^2) \text{d}T_i
$$
This makes sense because $1/T_i$ is a section of $\mathcal{O}(-1)$
over $D_+(T_i)$. The map
$$
\bigoplus\nolimits_{j = 0, \ldots, n} \mathcal{O}(-1) \text{d}T_j
\to
\mathcal{O}
$$
is given by sending $\text{d}T_j$ to $T_j$, more precisely, on
$D_+(T_i)$ we send the section $\sum g_j \text{d}T_j$ to
$\sum T_jg_j$. We omit the verification that this produces
a short exact sequence.
\end{proof}

\noindent
Given an integer $k \in \mathbf{Z}$ and a quasi-coherent
$\mathcal{O}_{\mathbf{P}^n_A}$-module $\mathcal{F}$
denote as usual $\mathcal{F}(k)$ the $k$th Serre twist of $\mathcal{F}$.
See Constructions, Definition \ref{constructions-definition-twist}.

\begin{lemma}
\label{lemma-twisted-hodge-cohomology-projective-space}
In the situation above we have the following cohomology groups
\begin{enumerate}
\item $H^q(\mathbf{P}^n_A, \Omega^p) = 0$
unless $0 \leq p = q \leq n$,
\item for $0 \leq p \leq n$ the $A$-module
$H^p(\mathbf{P}^n_A, \Omega^p)$ free of rank $1$.
\item for $q > 0$, $k > 0$, and $p$ arbitrary we have
$H^q(\mathbf{P}^n_A, \Omega^p(k)) = 0$, and
\item add more here.
\end{enumerate}
\end{lemma}

\begin{proof}
We are going to use the results of Cohomology of Schemes, Lemma
\ref{coherent-lemma-cohomology-projective-space-over-ring}
without further mention. In particular, the statements are true
for $H^q(\mathbf{P}^n_A, \mathcal{O}(k))$.

\medskip\noindent
Proof for $p = 1$. Consider the short exact sequence
$$
0 \to \Omega \to \mathcal{O}(-1)^{\oplus n + 1} \to \mathcal{O} \to 0
$$
of Lemma \ref{lemma-euler-sequence}. Since $\mathcal{O}(-1)$ has
vanishing cohomology in all degrees, this gives that
$H^q(\mathbf{P}^n_A, \Omega)$ is zero except in degree $1$
where it is freely generated by the boundary of $1$ in
$H^0(\mathbf{P}^n_A, \mathcal{O})$.

\medskip\noindent
Assume $p > 1$. Let us think of the short exact sequence
above as defining a $2$ step filtration on $\mathcal{O}(-1)^{\oplus n + 1}$.
The induced filtration on $\wedge^p\mathcal{O}(-1)^{\oplus n + 1}$ looks
like this
$$
0 \to \Omega^p \to \wedge^p\left(\mathcal{O}(-1)^{\oplus n + 1}\right)
\to \Omega^{p - 1} \to 0
$$
Observe that $\wedge^p\mathcal{O}(-1)^{\oplus n + 1}$ is isomorphic
to a direct sum of $n + 1$ choose $p$ copies of $\mathcal{O}(-p)$
and hence has vanishing cohomology in all degrees.
By induction hypothesis, this shows that $H^q(\mathbf{P}^n_A, \Omega^p)$
is zero unless $q = p$ and $H^p(\mathbf{P}^n_A, \Omega^p)$ is free
of rank $1$ with generator the boundary of the generator in
$H^{p - 1}(\mathbf{P}^n_A, \Omega^{p - 1})$.

\medskip\noindent
Let $k > 0$. Observe that $\Omega^n = \mathcal{O}(-n - 1)$ for example
by the short exact sequence above for $p = n + 1$.
Hence $\Omega^n(k)$ has vanishing cohomology in positive degrees.
Using the short exact sequences
$$
0 \to \Omega^p(k) \to \wedge^p\left(\mathcal{O}(-1)^{\oplus n + 1}\right)(k)
\to \Omega^{p - 1}(k) \to 0
$$
and {\it descending} induction on $p$ we get the vanishing of
cohomology of $\Omega^p(k)$ in positive degrees for all $p$.
\end{proof}

\begin{lemma}
\label{lemma-hodge-cohomology-projective-space}
We have $H^q(\mathbf{P}^n_A, \Omega^p) = 0$
unless $0 \leq p = q \leq n$. For $0 \leq p \leq n$ the $A$-module
$H^p(\mathbf{P}^n_A, \Omega^p)$ free of rank $1$ with basis element
$c_1^{Hodge}(\mathcal{O}(1))^p$.
\end{lemma}

\begin{proof}
We have the vanishing and and freeness by
Lemma \ref{lemma-twisted-hodge-cohomology-projective-space}.
For $p = 0$ it is certainly true that
$1 \in H^0(\mathbf{P}^n_A, \mathcal{O})$ is a generator.

\medskip\noindent
Proof for $p = 1$. Consider the short exact sequence
$$
0 \to \Omega \to \mathcal{O}(-1)^{\oplus n + 1} \to \mathcal{O} \to 0
$$
of Lemma \ref{lemma-euler-sequence}. In the proof of
Lemma \ref{lemma-twisted-hodge-cohomology-projective-space}
we have seen that the generator of $H^1(\mathbf{P}^n_A, \Omega)$
is the boundary $\xi$ of $1 \in H^0(\mathbf{P}^n_A, \mathcal{O})$.
As in the proof of Lemma \ref{lemma-euler-sequence} we will identify
$\mathcal{O}(-1)^{\oplus n + 1}$ with
$\bigoplus_{j = 0, \ldots, n} \mathcal{O}(-1)\text{d}T_j$.
Consider the open covering
$$
\mathcal{U} : 
\mathbf{P}^n_A =
\bigcup\nolimits_{i = 0, \ldots, n} D_{+}(T_i)
$$
We can lift the restriction of the global section $1$ of $\mathcal{O}$
to $U_i = D_+(T_i)$ by the section $T_i^{-1} \text{d}T_i$ of
$\bigoplus \mathcal{O}(-1)\text{d}T_j$ over $U_i$. Thus the cocyle
representing $\xi$ is given by
$$
T_{i_1}^{-1} \text{d}T_{i_1} - T_{i_0}^{-1} \text{d}T_{i_0} =
\text{d}\log(T_{i_1}/T_{i_0}) \in \Omega(U_{i_0i_1})
$$
On the other hand, for each $i$ the section $T_i$ is a trivializing
section of $\mathcal{O}(1)$ over $U_i$. Hence we see that
$f_{i_0i_1} = T_{i_1}/T_{i_0} \in \mathcal{O}^*(U_{i_0i_1})$
is the cocycle representing $\mathcal{O}(1)$ in $\Pic(\mathbf{P}^n_A)$,
see Section \ref{section-first-chern-class}.
Hence $c_1^{Hodge}(\mathcal{O}(1))$
is given by the cocycle $\text{d}\log(T_{i_1}/T_{i_0})$
which agrees with what we got for $\xi$ above.

\medskip\noindent
Proof for general $p$ by induction. The base cases $p = 0, 1$ were handled
above. Assume $p > 1$. In the proof of
Lemma \ref{lemma-twisted-hodge-cohomology-projective-space}
we have seen that the generator of $H^p(\mathbf{P}^n_A, \Omega^p)$
is the boundary of $c_1^{Hodge}(\mathcal{O}(1))^{p - 1}$
in the long exact cohomology sequence associated to
$$
0 \to \Omega^p \to \wedge^p\left(\mathcal{O}(-1)^{\oplus n + 1}\right)
\to \Omega^{p - 1} \to 0
$$
By the calculation in Section \ref{section-first-chern-class}
the cohomology class $c_1^{Hodge}(\mathcal{O}(1))^{p - 1}$
is, up to a sign, represented by the cocycle with terms
$$
\beta_{i_0 \ldots i_{p - 1}} =
\text{d}\log(T_{i_1}/T_{i_0}) \wedge
\text{d}\log(T_{i_2}/T_{i_1}) \wedge \ldots \wedge
\text{d}\log(T_{i_{p - 1}}/T_{i_{p - 2}})
$$
in $\Omega^{p - 1}(U_{i_0 \ldots i_{p - 1}})$. These
$\beta_{i_0 \ldots i_{p - 1}}$ can be lifted to the sections
$\tilde \beta_{i_0 \ldots i_{p -1}} =
T_{i_0}^{-1}\text{d}T_{i_0} \wedge \beta_{i_0 \ldots i_{p - 1}}$
of $\wedge^p(\bigoplus \mathcal{O}(-1) \text{d}T_j)$ over
$U_{i_0 \ldots i_{p - 1}}$. We conclude that the generator of
$H^p(\mathbf{P}^n_A, \Omega^p)$ is given by the cocycle whose
components are
\begin{align*}
\sum\nolimits_{a = 0}^p (-1)^a
\tilde \beta_{i_0 \ldots \hat{i_a} \ldots i_p}
& =
T_{i_1}^{-1}\text{d}T_{i_1} \wedge \beta_{i_1 \ldots i_p}
+ \sum\nolimits_{a = 1}^p (-1)^a
T_{i_0}^{-1}\text{d}T_{i_0} \wedge
\beta_{i_0 \ldots \hat{i_a} \ldots i_p} \\
& =
(T_{i_1}^{-1}\text{d}T_{i_1} - T_{i_0}^{-1}\text{d}T_{i_0}) \wedge
\beta_{i_1 \ldots i_p} +
T_{i_0}^{-1}\text{d}T_{i_0} \wedge \text{d}(\beta)_{i_0 \ldots i_p} \\
& =
\text{d}\log(T_{i_1}/T_{i_0}) \wedge \beta_{i_1 \ldots i_p}
\end{align*}
viewed as a section of $\Omega^p$ over $U_{i_0 \ldots i_p}$.
This is up to sign the same as the cocycle representing
$c_1^{Hodge}(\mathcal{O}(1))^p$ and the proof is complete.
\end{proof}

\begin{lemma}
\label{lemma-de-rham-cohomology-projective-space}
For $0 \leq i \leq n$ the de Rham cohomology
$H^{2i}_{dR}(\mathbf{P}^n_A/A)$ is a free $A$-module of rank $1$
with basis element $c_1^{dR}(\mathcal{O}(1))^i$.
In all other degrees the de Rham cohomology of $\mathbf{P}^n_A$
over $A$ is zero.
\end{lemma}

\begin{proof}
Consider the Hodge-to-de Rham spectral sequence of
Section \ref{section-hdoge-to-de-rham}.
By the computation of the Hodge cohomology of $\mathbf{P}^n_A$ over $A$
done in Lemma \ref{lemma-hodge-cohomology-projective-space}
we see that the spectral sequence degenerates on the $E_1$ page.
In this way we see that $H^i_{dR}(\mathbf{P}^n_A/A)$ is a free
$A$-module of rank $1$ for $0 \leq i \leq n$ and zero else.
Observe that $c_1^{dR}(\mathcal{O}(1))^i \in H^{2i}_{dR}(\mathbf{P}^n_A/A)$
for $i = 0, \ldots, n$ and that for $i = n$ this element is the
image of $c_1^{Hodge}(\mathcal{L})^n$ by the map of complexes
$$
\Omega^n_{\mathbf{P}^n_A/A}[-n]
\longrightarrow
\Omega^\bullet_{\mathbf{P}^n_A/A}
$$
This follows for example from the discussion in Remark \ref{remark-truncations}
or from the explicit description of cocycles representing these classes in
Section \ref{section-first-chern-class}.
The spectral sequence shows that the induced map
$$
H^n(\mathbf{P}^n_A, \Omega^n_{\mathbf{P}^n_A/A}) \longrightarrow
H^{2n}_{dR}(\mathbf{P}^n_A/A)
$$
is an isomorphism and since $c_1^{Hodge}(\mathcal{L})^n$ is a generator of
of the source (Lemma \ref{lemma-hodge-cohomology-projective-space}),
we conclude that $c_1^{dR}(\mathcal{L})^n$ is a generator
of the target. By the $A$-bilinearity of the cup products,
it follows that also $c_1^{dR}(\mathcal{L})^i$
is a generator of $H^{2i}_{dR}(\mathbf{P}^n_A/A)$ for
$0 \leq i \leq n$.
\end{proof}









\section{The spectral sequence for a smooth morphism}
\label{section-relative-spectral-sequence}

\noindent
Consider a commutative diagram of schemes
$$
\xymatrix{
X \ar[rr]_f \ar[rd]_p & & Y \ar[ld]^q \\
& S
}
$$
where $f$ is a smooth morphism. Then we obtain a locally split short
exact sequence
$$
0 \to f^*\Omega_{Y/S} \to \Omega_{X/S} \to \Omega_{X/Y} \to 0
$$
by Morphisms, Lemma \ref{morphisms-lemma-triangle-differentials-smooth}.
Let us think of this as a descending filtration $F$ on $\Omega_{X/S}$
with $F^0\Omega_{X/S} = \Omega_{X/S}$, $F^1\Omega_{X/S} = f^*\Omega_{Y/S}$, and
$F^2\Omega_{X/S} = 0$. Applying the functor $\wedge^p$ we obtain
for every $p$ an induced filtration
$$
\Omega^p_{X/S} = F^0\Omega^p_{X/S} \supset
F^1\Omega^p_{X/S} \supset
F^2\Omega^p_{X/S} \supset \ldots \supset F^{p + 1}\Omega^p_{X/S} = 0
$$
whose succesive quotients are
$$
\text{gr}^k\Omega^p_{X/S} =
F^k\Omega^p_{X/S}/F^{k + 1}\Omega^p_{X/S} =
f^*\Omega^k_{Y/S} \otimes_{\mathcal{O}_X} \Omega^{p - k}_{X/Y} =
f^{-1}\Omega^k_{Y/S} \otimes_{f^{-1}\mathcal{O}_Y} \Omega^{p - k}_{X/Y}
$$
for $k = 0, \ldots, p$. In fact, the reader can check using the
Leibniz rule that $F^k\Omega^\bullet_{X/S}$ is a subcomplex of
$\Omega^\bullet_{X/S}$. In this way $\Omega^\bullet_{X/S}$ has
the structure of a filtered complex. We can also see this by observing
that
$$
F^k\Omega^\bullet_{X/S} =
\Im\left(\wedge :
\text{Tot}(
f^{-1}\sigma_{\geq k}\Omega^\bullet_{Y/S} \otimes_{p^{-1}\mathcal{O}_S}
\Omega^\bullet_{X/S})
\longrightarrow
\Omega^\bullet_{X/S}\right)
$$
is the image of a map of complexes on $X$. The filtered complex
$$
\Omega^\bullet_{X/S} = F^0\Omega^\bullet_{X/S} \supset
F^1\Omega^\bullet_{X/S} \supset F^2\Omega^\bullet_{X/S} \supset \ldots
$$
has the following associated graded parts
$$
\text{gr}^k\Omega^\bullet_{X/S} = 
f^{-1}\Omega^k_{Y/S}[-k] \otimes_{f^{-1}\mathcal{O}_Y} \Omega^\bullet_{X/Y}
$$
by what was said above.

\begin{lemma}
\label{lemma-spectral-sequence-smooth}
Let $f : X \to Y$ be a quasi-compact, quasi-separated, and smooth
morphism of schemes over a base scheme $S$. There is a bounded spectral
sequence with first page
$$
E_1^{p, q} =
H^q(\Omega^p_{Y/S} \otimes_{\mathcal{O}_Y}^\mathbf{L} Rf_*\Omega^\bullet_{X/Y})
$$
converging to $R^{p + q}f_*\Omega^\bullet_{X/S}$.
\end{lemma}

\begin{proof}
Consider $\Omega^\bullet_{X/S}$ as a filtered complex with the
filtration introduced above. The spectral sequence is the
spectral sequence of Cohomology, Lemma
\ref{cohomology-lemma-relative-spectral-sequence-filtered-object}.
By Derived Categories of Schemes, Lemma
\ref{perfect-lemma-cohomology-de-rham-base-change} we have
$$
Rf_*\text{gr}^k\Omega^\bullet_{X/S} =
\Omega^k_{Y/S}[-k] \otimes_{\mathcal{O}_Y}^\mathbf{L} Rf_*\Omega^\bullet_{X/Y}
$$
and thus we conclude.
\end{proof}

\begin{remark}
\label{remark-gauss-manin}
In Lemma \ref{lemma-spectral-sequence-smooth} consider the cohomology sheaves
$$
\mathcal{H}^q_{dR}(X/Y) = H^q(Rf_*\Omega^\bullet_{X/Y}))
$$
If $f$ is proper in addition to being smooth and $S$ is a scheme over
$\mathbf{Q}$ then $\mathcal{H}^q_{dR}(X/Y)$ is finite locally free (insert
future reference here). If we only assume $\mathcal{H}^q_{dR}(X/Y)$
are flat $\mathcal{O}_Y$-modules, then we obtain (tiny argument omitted)
$$
E_1^{p, q} =
\Omega^p_{Y/S} \otimes_{\mathcal{O}_Y} \mathcal{H}^q_{dR}(X/Y)
$$
and the differentials in the spectral sequence are maps
$$
d_1^{p, q} :
\Omega^p_{Y/S} \otimes_{\mathcal{O}_Y} \mathcal{H}^q_{dR}(X/Y)
\longrightarrow
\Omega^{p + 1}_{Y/S} \otimes_{\mathcal{O}_Y} \mathcal{H}^q_{dR}(X/Y)
$$
In particular, for $p = 0$ we obtain a map
$d_1^{0, q} : \mathcal{H}^q_{dR}(X/Y) \to
\Omega^1_{Y/S} \otimes_{\mathcal{O}_Y} \mathcal{H}^q_{dR}(X/Y)$
which turns out to be an integrable connection
$\nabla$ (insert future reference here)
and the complex
$$
\mathcal{H}^q_{dR}(X/Y) \to
\Omega^1_{Y/S} \otimes_{\mathcal{O}_Y} \mathcal{H}^q_{dR}(X/Y) \to
\Omega^2_{Y/S} \otimes_{\mathcal{O}_Y} \mathcal{H}^q_{dR}(X/Y) \to \ldots
$$
with differentials given by $d_1^{\bullet, q}$
is the de Rham complex of $\nabla$.
The connection $\nabla$ is known as the {\it Gauss-Manin connection}.
\end{remark}

\begin{lemma}
\label{lemma-relative-global-generation-on-fibres}
Let $f : X \to Y$ be a smooth proper morphism of schemes.
Let $N$ and $n_1, \ldots, n_N \geq 0$ be integers and let
$\xi_i \in H^{n_i}_{dR}(X/Y)$, $1 \leq i \leq N$.
Assume for all points $y \in Y$ the images of $\xi_1, \ldots, \xi_N$
in $H^*_{dR}(X_y/y)$ form a basis over $\kappa(y)$. Then the map
$$
\bigoplus\nolimits_{i = 1}^N \mathcal{O}_Y[-n_i]
\longrightarrow
Rf_*\Omega^\bullet_{X/Y}
$$
associated to $\xi_1, \ldots, \xi_N$ is an isomorphism.
\end{lemma}

\begin{proof}
By Lemma \ref{lemma-proper-smooth-de-Rham}
$Rf_*\Omega^\bullet_{X/Y}$ is a perfect object of $D(\mathcal{O}_Y)$
whose formation commutes with arbitrary base change.
Thus the map of the lemma is a map $a : K \to L$
between perfect objects of $D(\mathcal{O}_Y)$
whose derived restriction to any point is an isomorphism
by our assumption on fibres. Then the cone $C$ on $a$ is a perfect
object of $D(\mathcal{O}_Y)$ (Cohomology, Lemma
\ref{cohomology-lemma-two-out-of-three-perfect}) whose
derived restriction to any point is zero. It follows that $C$
is zero by More on Algebra, Lemma
\ref{more-algebra-lemma-lift-perfect-from-residue-field}
and $a$ is an isomorphism. (This also uses Derived Categories of Schemes,
Lemmas \ref{perfect-lemma-affine-compare-bounded} and
\ref{perfect-lemma-perfect-affine} to translate into algebra.)
\end{proof}

\begin{proposition}
\label{proposition-global-generation-on-fibres}
Let $f : X \to Y$ be a smooth proper morphism of schemes over a base $S$.
Let $N$ and $n_1, \ldots, n_N \geq 0$ be integers and let
$\xi_i \in H^{n_i}_{dR}(X/S)$, $1 \leq i \leq N$.
Assume for all points $y \in Y$ the images of $\xi_1, \ldots, \xi_N$
in $H^*_{dR}(X_y/y)$ form a basis over $\kappa(y)$. Then the map
$$
\bigoplus\nolimits_{i = 1}^N H^*_{dR}(Y/S) \longrightarrow
H^*_{dR}(X/S), \quad
(a_1, \ldots, a_N) \longmapsto  \sum \xi_i \cup f^*a_i
$$
is an isomorphism.
\end{proposition}

\begin{proof}
Denote $p : X \to S$ and $q : Y \to S$ be the structure morphisms.
Let $\xi'_i : \Omega^\bullet_{X/S} \to \Omega^\bullet_{X/S}[n_i]$
be the map of Remark \ref{remark-cup-product-as-a-map} corresponding
to $\xi_i$. Denote
$$
\tilde \xi_i :
\Omega^\bullet_{Y/S} \to Rf_*\Omega^\bullet_{X/S}[n_i]
$$
the composition of $\xi'_i$ with the canonical map
$\Omega^\bullet_{Y/S} \to Rf_*\Omega^\bullet_{X/S}$.
Using
$$
R\Gamma(Y, Rf_*\Omega^\bullet_{X/S}) = R\Gamma(X, \Omega^\bullet_{X/S})
$$
on cohomology $\tilde \xi_i$ is the map $\eta \mapsto \xi_i \cup f^*\eta$
from $H^m_{dR}(Y/S)$ to $H^{m + n}_{dR}(X/S)$.
Further, since the formation of $\xi'_i$ commutes with
restrictions to opens, so does the formation of $\tilde \xi_i$
commute with restriction to opens.

\medskip\noindent
Thus we can consider the map
$$
\tilde \xi = \bigoplus \tilde \xi_i[-n_i] :
\bigoplus \Omega^\bullet_{Y/S}[-n_i]
\longrightarrow
Rf_*\Omega^\bullet_{X/S}
$$
To prove the lemma it suffices to show that this is an isomorphism in
$D(Y, q^{-1}\mathcal{O}_S)$. If we could show $\tilde \xi$
comes from a map of filtered complexes (with suitable filtrations),
then we could appeal to the spectral sequence of
Lemma \ref{lemma-spectral-sequence-smooth} to finish the proof.
Our approach will be to reduce to the affine case and then make
this argument work.

\medskip\noindent
Indeed, if $Y' \subset Y$ is is any open with inverse image
$X' \subset X$, then $\tilde \xi|_{X'}$ induces the map
$$
\bigoplus\nolimits_{i = 1}^N H^*_{dR}(Y'/S) \longrightarrow
H^*_{dR}(X'/S), \quad
(a_1, \ldots, a_N) \longmapsto  \sum \xi_i|_{X'} \cup f^*a_i
$$
on cohomology over $Y'$, see discussion above.
Thus it suffices to find a basis for the topology
on $Y$ such that the proposition holds for the members of the basis
(in particular we can forget about the map $\tilde \xi$ when
we do this). This reduces us to the case discussed in the next paragraph.

\medskip\noindent
Assume $Y$ and $S$ are affine. Say $Y = \Spec(A)$ and $S = \Spec(R)$.
In this case $\Omega^\bullet_{A/R}$ computes
$R\Gamma(Y, \Omega^\bullet_{Y/S})$ by Lemma \ref{lemma-de-rham-affine}.
Choose a finite affine open covering $\mathcal{U} : X = \bigcup_{i \in I} U_i$.
Consider the complex
$$
K^\bullet =
\text{Tot}(\check{\mathcal{C}}^\bullet(\mathcal{U}, \Omega_{X/S}^\bullet))
$$
as in
Cohomology, Section \ref{cohomology-section-cech-cohomology-of-complexes}.
Let us collect some facts about this complex most of which
can be found in the reference just given:
\begin{enumerate}
\item $K^\bullet$ is a complex of $R$-modules whose terms are
$A$-modules,
\item $K^\bullet$ represents $R\Gamma(X, \Omega^\bullet_{X/S})$ in $D(R)$
(Cohomology of Schemes, Lemma
\ref{coherent-lemma-quasi-coherent-affine-cohomology-zero} and
Cohomology, Lemma \ref{cohomology-lemma-cech-complex-complex-computes}),
\item there is a natural map $\Omega^\bullet_{A/R} \to K^\bullet$
of complexes of $R$-modules which is $A$-linear on terms and
induces the pullback map $H^*_{dR}(Y/S) \to H^*_{dR}(X/S)$
on cohomology,
\item $K^\bullet$ has a multiplication denoted $\wedge$
which turns it into a differential graded $R$-algebra,
\item the multiplication on $K^\bullet$
induces the cup product on $H^*_{dR}(X/S)$
(Cohomology, Section \ref{cohomology-section-cup-product}),
\item the filtration $F$ on $\Omega^*_{X/S}$ induces a filtration
$$
K^\bullet =
F^0K^\bullet \supset F^1K^\bullet \supset F^2K^\bullet \supset \ldots
$$
by subcomplexes on $K^\bullet$ such that
\begin{enumerate}
\item $F^kK^n \subset K^n$ is an $A$-submmodule,
\item $F^kK^\bullet \wedge F^lK^\bullet \subset F^{k + l}K^\bullet$,
\item $\text{gr}^kK^\bullet$ is a complex of $A$-modules,
\item $\text{gr}^0K^\bullet =
\text{Tot}(\check{\mathcal{C}}^\bullet(\mathcal{U}, \Omega_{X/Y}^\bullet))$
and represents $R\Gamma(X, \Omega^\bullet_{X/Y})$ in $D(A)$,
\item multiplication induces an isomorphism
$\Omega^k_{A/R}[-k] \otimes_A \text{gr}^0K^\bullet \to \text{gr}^kK^\bullet$
\end{enumerate}
\end{enumerate}
We omit the detailed proofs of these statements; please see discussion
leading up to the construction of the spectral sequence in
Lemma \ref{lemma-spectral-sequence-smooth}.

\medskip\noindent
For every $i = 1, \ldots, N$ we choose a cocycle $x_i \in K^{n_i}$
representing $\xi_i$. Next, we look at the map of complexes
$$
\tilde x :
M^\bullet = \bigoplus\nolimits_{i = 1, \ldots, N}
\Omega^\bullet_{A/R}[-n_i]
\longrightarrow
K^\bullet
$$
which sends $\omega$ in the $i$th summand to $x_i \wedge \omega$.
All that remains is to show that this map is a quasi-isomorphism.
We endow $M^\bullet$ with the structure of a filtered complex
by the rule
$$
F^kM^\bullet =
\bigoplus\nolimits_{i = 1, \ldots, N}
(\sigma_{\geq k}\Omega^\bullet_{A/R})[-n_i]
$$
With this choice the map $\tilde x$ is a morphism of filtered complexes.
Observe that $\text{gr}^0M^\bullet = \bigoplus A[-n_i]$
and multiplication induces an isomorphism
$\Omega^k_{A/R}[-k] \otimes_A \text{gr}^0M^\bullet \to \text{gr}^kM^\bullet$.
By construction and Lemma \ref{lemma-relative-global-generation-on-fibres}
we see that
$$
\text{gr}^0\tilde x :
\text{gr}^0M^\bullet \longrightarrow
\text{gr}^0K^\bullet
$$
is an isomorphism in $D(A)$. It follows that for all $k \geq 0$
we obtain isomorphisms
$$
\text{gr}^k \tilde x :
\text{gr}^kM^\bullet = \Omega^k_{A/R}[-k] \otimes_A \text{gr}^0M^\bullet
\longrightarrow
\Omega^k_{A/R}[-k] \otimes_A \text{gr}^0K^\bullet =
\text{gr}^kK^\bullet
$$
in $D(A)$. Namely, the complex
$\text{gr}^0K^\bullet =
\text{Tot}(\check{\mathcal{C}}^\bullet(\mathcal{U}, \Omega_{X/Y}^\bullet))$
is K-flat as a complex of $A$-modules by Derived Categories of Schemes,
Lemma \ref{perfect-lemma-K-flat}.
Hence the tensor product on the right hand side is the
derived tensor product as is true by inspection on the left hand side.
Finally, taking the derived tensor product
$\Omega^k_{A/R}[-k] \otimes_A^\mathbf{L} -$ is a functor on $D(A)$
and therefore sends isomorphisms to isomorphisms.
Arguing by induction on $k$ we deduce that
$$
\tilde x : M^\bullet/F^kM^\bullet \to K^\bullet/F^kK^\bullet
$$
is an isomorphism in $D(R)$ since we have the short exact sequences
$$
0 \to F^kM^\bullet/F^{k + 1}M^\bullet \to
M^\bullet/F^{k + 1}M^\bullet \to
\text{gr}^kM^\bullet \to 0
$$
and similarly for $K^\bullet$. This proves that $\tilde x$ is a
quasi-isomorphism as the filtrations are finite in any given degree.
\end{proof}






\section{Projective space bundle formula}
\label{section-projective-space-bundle-formula}

\noindent
The title says it all.

\begin{proposition}
\label{proposition-projective-space-bundle-formula}
Let $X \to S$ be a morphism of schemes. Let $\mathcal{E}$ be a locally
free $\mathcal{O}_X$-module of constant rank $r$. Consider the morphism
$p : P = \mathbf{P}(\mathcal{E}) \to X$.
Then the map
$$
\bigoplus\nolimits_{i = 0, \ldots, r - 1} H^*_{dR}(X/S)
\longrightarrow
H^*_{dR}(P/S)
$$
given by the rule
$$
(a_0, \ldots, a_{r - 1}) \longmapsto
\sum\nolimits_{i = 0, \ldots, r - 1} c_1^{dR}(\mathcal{O}_P(1))^i \cup p^*(a_i)
$$
is an isomorphism.
\end{proposition}

\begin{proof}
Choose an affine open $\Spec(A) \subset X$ such that $\mathcal{E}$ restricts
to the trivial locally free module $\mathcal{O}_{\Spec(A)}^{\oplus r}$.
Then $P \times_X \Spec(A) = \mathbf{P}^{r - 1}_A$. Thus we see that
$p$ is proper and smooth, see Section \ref{section-projective-space}.
Moreover, the classes $c_1^{dR}(\mathcal{O}_P(1))^i$, $i = 0, 1, \ldots, r - 1$
restricted to a fibre $X_y = \mathbf{P}^{r - 1}_y$ freely generate the
de Rham cohomology $H^*_{dR}(X_y/y)$ over $\kappa(y)$, see
Lemma \ref{lemma-de-rham-cohomology-projective-space}. Thus we've verified the
conditions of Proposition \ref{proposition-global-generation-on-fibres}
and we win.
\end{proof}








\section{Log poles along a divisor}
\label{section-divisor}

\noindent
Let $X \to S$ be a morphism of schemes. Let $Y \subset X$ be an
effective Cartier divisor. If $X$ \'etale locally along $Y$ looks
like $Y \times \mathbf{A}^1$, then there is a canonical short exact sequence
of complexes
$$
0 \to \Omega^\bullet_{X/S} \to
\Omega^\bullet_{X/S}(\log Y) \to
\Omega^\bullet_{Y/S}[-1] \to 0
$$
having many good properties we will discuss in this section.

\begin{definition}
\label{definition-local-product}
Let $X \to S$ be a morphism of schemes. Let $Y \subset X$ be an
effective Cartier divisor. We say the
{\it de Rham complex of log poles is defined for $Y \subset X$ over $S$}
if for all $y \in Y$ and local equation $f \in \mathcal{O}_{X, y}$
of $Y$ we have
\begin{enumerate}
\item $\mathcal{O}_{X, y} \to \Omega_{X/S, y}$, $g \mapsto g \text{d}f$
is a split injection, and
\item $\Omega^p_{X/S, y}$ is $f$-torsion free for all $p$.
\end{enumerate}
\end{definition}

\noindent
An easy local calculation shows that it suffices for every $y \in Y$
to find one local equation $f$ for which conditions (1) and (2) hold.

\begin{lemma}
\label{lemma-log-complex}
Let $X \to S$ be a morphism of schemes. Let $Y \subset X$ be an
effective Cartier divisor.
Assume the de Rham complex of log poles is defined for $Y \subset X$ over $S$.
There is a canonical short exact sequence
of complexes
$$
0 \to \Omega^\bullet_{X/S} \to
\Omega^\bullet_{X/S}(\log Y) \to
\Omega^\bullet_{Y/S}[-1] \to 0
$$
\end{lemma}

\begin{proof}
Our assumption is that for every $y \in Y$ and local equation
$f \in \mathcal{O}_{X, y}$ of $Y$ we have
$$
\Omega_{X/S, y} = \mathcal{O}_{X, y}\text{d}f \oplus M
\quad\text{and}\quad
\Omega^p_{X/S, y} = \wedge^{p - 1}(M)\text{d}f \oplus \wedge^p(M)
$$
for some module $M$ with $f$-torsion free exterior powers $\wedge^p(M)$.
It follows that
$$
\Omega^p_{Y/S, y} = \wedge^p(M/fM) = \wedge^p(M)/f\wedge^p(M)
$$
Below we will tacitly use these facts.
In particular the sheaves $\Omega^p_{X/S}$ have no nonzero local
sections supported on $Y$ and we have a canonical inclusion
$$
\Omega^p_{X/S} \subset \Omega^p_{X/S}(Y)
$$
see More on Flatness, Section \ref{flat-section-eta}. Let $U = \Spec(A)$
be an affine open subscheme such that $Y \cap U = V(f)$ for some
nonzerodivisor $f \in A$. Let us consider the $\mathcal{O}_U$-submodule
of $\Omega^p_{X/S}(Y)|_U$ generated by
$\Omega^p_{X/S}|_U$ and $\text{d}\log(f) \wedge \Omega^{p - 1}_{X/S}$
where $\text{d}\log(f) = f^{-1}\text{d}(f)$.
This is independent of the choice of $f$ as another generator of the
ideal of $Y$ on $U$ is equal to $uf$ for a unit $u \in A$ and we get
$$
\text{d}\log(uf) - \text{d}\log(f) = \text{d}\log(u) = u^{-1}\text{d}u
$$
which is a section of $\Omega_{X/S}$ over $U$. These local
sheaves glue to give a quasi-coherent submodule
$$
\Omega^p_{X/S} \subset \Omega^p_{X/S}(\log Y) \subset \Omega^p_{X/S}(Y)
$$
Let us agree to think of $\Omega^p_{Y/S}$ as a quasi-coherent
$\mathcal{O}_X$-module. There is a unique surjective
$\mathcal{O}_X$-linear map
$$
\text{Res} : \Omega^p_{X/S}(\log Y) \to \Omega^{p - 1}_Y
$$
defined by the rule
$$
\text{Res}(\eta' + \text{d}\log(f) \wedge \eta) = \eta|_{Y \cap U}
$$
for all opens $U$ as above and all
$\eta' \in \Omega^p_{X/S}(U)$ and $\eta \in \Omega^{p - 1}_{X/S}(U)$.
If a form $\eta$ over $U$ restricts to zero on $Y \cap U$, then
$\eta = \text{d}f \wedge \eta' + f\eta''$ for some forms $\eta'$ and $\eta''$
over $U$. We conclude that
we have a short exact sequence
$$
0 \to \Omega^p_{X/S} \to \Omega^p_{X/S}(\log Y) \to \Omega^{p - 1}_{Y/S} \to 0
$$
for all $p$. We still have to define the differentials
$\Omega^p_{X/S}(\log Y) \to \Omega^{p + 1}_{X/S}(\log Y)$.
On the subsheaf $\Omega^p_{X/S}$ we use the differential of
the de Rham complex of $X$ over $S$. Finally, we define
$\text{d}(\text{d}\log(f) \wedge \eta) = -\text{d}\log(f) \wedge \text{d}\eta$.
The sign is forced on us by the Leibniz rule (on $\Omega^\bullet_{X/S}$)
and it is compatible with the differential on $\Omega^\bullet_{Y/S}[-1]$
which is after all $-\text{d}_{Y/S}$ by our sign convention in
Homology, Definition \ref{homology-definition-shift-cochain}.
In this way we obtain a short exact
sequence of complexes as stated in the lemma.
\end{proof}

\begin{definition}
\label{definition-log-complex}
Let $X \to S$ be a morphism of schemes. Let $Y \subset X$ be an
effective Cartier divisor. Assume the de Rham complex of log poles
is defined for $Y \subset X$ over $S$. Then the complex
$$
\Omega^\bullet_{X/S}(\log Y)
$$
constructed in Lemma \ref{lemma-log-complex} is the
{\it de Rham complex of log poles for $Y \subset X$ over $S$}.
\end{definition}

\noindent
This complex has many good properties.

\begin{lemma}
\label{lemma-multiplication-log}
Let $p : X \to S$ be a morphism of schemes. Let $Y \subset X$ be an
effective Cartier divisor. Assume the de Rham complex of log poles
is defined for $Y \subset X$ over $S$.
\begin{enumerate}
\item The maps
$\wedge : \Omega^p_{X/S} \times \Omega^q_{X/S} \to \Omega^{p + q}_{X/S}$
extend uniquely to $\mathcal{O}_X$-bilinear maps
$$
\wedge : \Omega^p_{X/S}(\log Y) \times \Omega^q_{X/S}(\log Y)
\to \Omega^{p + q}_{X/S}(\log Y)
$$
satisfying the Leibniz rule
$
\text{d}(\omega \wedge \eta) = \text{d}(\omega) \wedge \eta +
(-1)^{\deg(\omega)} \omega \wedge \text{d}(\eta)$,
\item with multiplication as in (1) the map
$\Omega^\bullet_{X/S} \to \Omega^\bullet_{X/S}(\log(Y)$
is a homomorphism of differential graded $\mathcal{O}_S$-algebras,
\item via the maps in (1) we have $\Omega^p_{X/S}(\log Y) =
\wedge^p(\Omega^1_{X/S}(\log Y))$, and
\item the map
$\text{Res} : \Omega^\bullet_{X/S}(\log Y) \to \Omega^\bullet_{Y/S}[-1]$
satisfies
$$
\text{Res}(\omega \wedge \eta) =
\text{Res}(\omega) \wedge \eta|_Y +
(-1)^{\deg(\omega)} \omega|_Y \wedge \text{Res}(\eta)
$$
\end{enumerate}
\end{lemma}

\begin{proof}
This follows by direct calcuation from the local construction
of the complex in the proof of Lemma \ref{lemma-log-complex}.
Details omitted.
\end{proof}

\noindent
Consider a commutative diagram
$$
\xymatrix{
X' \ar[r]_f \ar[d] & X \ar[d] \\
S' \ar[r] & S
}
$$
of schemes. Let $Y \subset X$ be an effective Cartier divisor
whose pullback $Y' = f^*Y$ is defined
(Divisors, Definition
\ref{divisors-definition-pullback-effective-Cartier-divisor}).
Assume
the de Rham complex of log poles is defined for $Y \subset X$ over $S$
and
the de Rham complex of log poles is defined for $Y' \subset X'$ over $S'$.
In this case we obtain a map of short exact sequences of complexes
$$
\xymatrix{
0 \ar[r] &
f^{-1}\Omega^\bullet_{X/S} \ar[r] \ar[d] &
f^{-1}\Omega^\bullet_{X/S}(\log Y) \ar[r] \ar[d] &
f^{-1}\Omega^\bullet_{Y/S}[-1] \ar[r] \ar[d] &
0 \\
0 \ar[r] &
\Omega^\bullet_{X'/S'} \ar[r] &
\Omega^\bullet_{X'/S'}(\log Y') \ar[r] &
\Omega^\bullet_{Y'/S'}[-1] \ar[r] &
0
}
$$
Linearizing, for every $p$ we obtain a linear map
$f^*\Omega^p_{X/S}(\log Y) \to \Omega^p_{X'/S'}(\log Y')$.

\begin{lemma}
\label{lemma-gysin-via-log-complex}
Let $f : X \to S$ be a morphism of schemes. Let $Y \subset X$ be an effective
Cartier divisor. Assume the de Rham complex of log poles is defined for
$Y \subset X$ over $S$. Denote
$$
\delta : \Omega^\bullet_{Y/S} \to \Omega^\bullet_{X/S}[2]
$$
in $D(X, f^{-1}\mathcal{O}_S)$ the ``boundary'' map coming from the
short exact sequence in Lemma \ref{lemma-log-complex}. Denote
$$
\xi' : \Omega^\bullet_{X/S} \to \Omega^\bullet_{X/S}[2]
$$
in $D(X, f^{-1}\mathcal{O}_S)$ the map of
Remark \ref{remark-cup-product-as-a-map}
corresponding to $\xi = c_1^{dR}(\mathcal{O}_X(-Y))$. Denote
$$
\zeta' : \Omega^\bullet_{Y/S} \to \Omega^\bullet_{Y/S}[2]
$$
in $D(Y, f|_Y^{-1}\mathcal{O}_S)$ the map of
Remark \ref{remark-cup-product-as-a-map} corresponding to
$\zeta = c_1^{dR}(\mathcal{O}_X(-Y)|_Y)$. Then the diagram
$$
\xymatrix{
\Omega^\bullet_{X/S} \ar[d]_{\xi'} \ar[r] &
\Omega^\bullet_{Y/S} \ar[d]^{\zeta'} \ar[ld]_\delta \\
\Omega^\bullet_{X/S}[2] \ar[r] &
\Omega^\bullet_{Y/S}[2]
}
$$
is commutative in $D(X, f^{-1}\mathcal{O}_S)$.
\end{lemma}

\begin{proof}
More precisely, we define $\delta$ as the boundary map corresponding to the
shifted short exact sequence
$$
0 \to \Omega^\bullet_{X/S}[1] \to
\Omega^\bullet_{X/S}(\log Y)[1] \to
\Omega^\bullet_{Y/S} \to 0
$$
It suffices to prove each triangle commutes. Set
$\mathcal{L} = \mathcal{O}_X(-Y)$. Denote $\pi : L \to X$ the line bundle
with $\pi_*\mathcal{O}_L = \bigoplus_{n \geq 0} \mathcal{L}^{\otimes n}$.

\medskip\noindent
Commutativity of the upper left triangle.
By Lemma \ref{lemma-the-complex-for-L-star-gives-chern-class}
the map $\xi'$ is the boundary map of the triangle given in
Lemma \ref{lemma-the-complex-for-L-star}.
By functoriality it suffices to prove there exists a morphism of
short exact sequences
$$
\xymatrix{
0 \ar[r] &
\Omega^\bullet_{X/S}[1] \ar[r] \ar[d] &
\Omega^\bullet_{L^\star/S, 0}[1] \ar[r] \ar[d] &
\Omega^\bullet_{X/S} \ar[r] \ar[d] &
0 \\
0 \ar[r] &
\Omega^\bullet_{X/S}[1] \ar[r] &
\Omega^\bullet_{X/S}(\log Y)[1] \ar[r] &
\Omega^\bullet_{Y/S} \ar[r] &
0
}
$$
where the left and right vertical arrows are the obvious ones.
We can define the middle vertical arrow by the rule
$$
\omega' + \text{d}\log(s) \wedge \omega \longmapsto
\omega' + \text{d}\log(f) \wedge \omega
$$
where $\omega', \omega$ are local sections of $\Omega^\bullet_{X/S}$
and where $s$ is a local generator of $\mathcal{L}$ and
$f \in \mathcal{O}_X(-Y)$ is the corresponding section of the ideal
sheaf of $Y$ in $X$. Since the constructions of the maps in
Lemmas \ref{lemma-the-complex-for-L-star} and \ref{lemma-log-complex}
match exactly, this works.

\medskip\noindent
Commutativity of the lower right triangle. Denote
$\overline{L}$ the restriction of $L$ to $Y$.
By Lemma \ref{lemma-the-complex-for-L-star-gives-chern-class}
the map $\zeta'$ is the boundary map of the triangle given in
Lemma \ref{lemma-the-complex-for-L-star} using the line bundle
$\overline{L}$ on $Y$.
By functoriality it suffices to prove there exists a morphism of
short exact sequences
$$
\xymatrix{
0 \ar[r] &
\Omega^\bullet_{X/S}[1] \ar[r] \ar[d] &
\Omega^\bullet_{X/S}(\log Y)[1] \ar[r] \ar[d] &
\Omega^\bullet_{Y/S} \ar[r] \ar[d] &
0 \\
0 \ar[r] &
\Omega^\bullet_{Y/S}[1] \ar[r] &
\Omega^\bullet_{\overline{L}^\star/S, 0}[1] \ar[r] &
\Omega^\bullet_{Y/S} \ar[r] &
0 \\
}
$$
where the left and right vertical arrows are the obvious ones.
We can define the middle vertical arrow by the rule
$$
\omega' + \text{d}\log(f) \wedge \omega \longmapsto
\omega'|_Y + \text{d}\log(\overline{s}) \wedge \omega|_Y
$$
where $\omega', \omega$ are local sections of $\Omega^\bullet_{X/S}$
and where $f$ is a local generator of $\mathcal{O}_X(-Y)$ viewed as
a function on $X$ and where $\overline{s}$ is $f|_Y$ viewed as a
section of $\mathcal{L}|_Y = \mathcal{O}_X(-Y)|_Y$.
Since the constructions of the maps in
Lemmas \ref{lemma-the-complex-for-L-star} and \ref{lemma-log-complex}
match exactly, this works.
\end{proof}

\begin{lemma}
\label{lemma-log-complex-consequence}
Let $X \to S$ be a morphism of schemes. Let $Y \subset X$ be an effective
Cartier divisor. Assume the de Rham complex of log poles is defined for
$Y \subset X$ over $S$. Let $b \in H^m_{dR}(X/S)$ be a de Rham cohomology
class whose restriction to $Y$ is zero. Then
$c_1^{dR}(\mathcal{O}_X(Y)) \cup b = 0$ in $H^{m + 2}_{dR}(X/S)$.
\end{lemma}

\begin{proof}
This follows immediately from Lemma \ref{lemma-gysin-via-log-complex}.
Namely, we have
$$
c_1^{dR}(\mathcal{O}_X(Y)) \cup b =
-c_1^{dR}(\mathcal{O}_X(-Y)) \cup b = -\xi'(b) = -\delta(b|_Y) = 0
$$
as desired. For the second equality, see
Remark \ref{remark-cup-product-as-a-map}.
\end{proof}

\begin{lemma}
\label{lemma-check-log-smooth}
Let $X \to S$ be a morphism of schemes. Let $Y \subset X$ be an effective
Cartier divisor. If both $X \to S$ and $Y \to S$ are smooth, then
the de Rham complex of log poles is defined for $Y \subset X$ over $S$.
\end{lemma}

\begin{proof}
In this case the modules $\Omega^p_{X/S}$ are locally free, see
Morphisms, Lemma \ref{morphisms-lemma-smooth-at-point}, and hence the second
condition of Definition \ref{definition-local-product} holds.
On the other hand, for $s \in S$ the fibre $Y_s \subset X_s$ is
an effective Cartier divisor
(Divisors, Lemma \ref{divisors-lemma-relative-Cartier}).
Hence if $y \in Y$ maps to $s \in S$ we have
$\dim \mathcal{O}_{Y_s, y} = \dim \mathcal{O}_{X_s, y} - 1$
for example by Algebra, Lemma \ref{algebra-lemma-one-equation}.
Thus $\dim_y(Y_s) = \dim_y(X_s) - 1$ by
Morphisms, Lemma \ref{morphisms-lemma-dimension-fibre-at-a-point}.
Now $\Omega_{X/S, x}$ is free of rank $\dim_y(X_s)$
and $\Omega_{Y/S, y}$ is free of rank $\dim_y(Y_s) = \dim_y(X_s) - 1$ by
the already used Morphisms, Lemma \ref{morphisms-lemma-smooth-at-point}.
Since $\Omega_{Y/S, y}$ is the quotient of
$\Omega_{X/S, x}$ by the submodule $f\Omega_{X/S, x}$ and
$\mathcal{O}_{X, x}\text{d}f$ we conclude that $\text{d}f$
must map to a nonzero element of $\Omega_{X/S, x} \otimes \kappa(y)$.
Hence $\text{d}f$ generates a direct summand and the proof is complete.
\end{proof}

\begin{remark}
\label{remark-check-log-completion-1}
Let $S$ be a locally Noetherian scheme. Let $X$ be locally of finite
type over $S$. Let $Y \subset X$ be an effective Cartier divisor.
If the map
$$
\mathcal{O}_{X, y}^\wedge \longrightarrow \mathcal{O}_{Y, y}^\wedge
$$
has a section for all $y \in Y$, then
the de Rham complex of log poles is defined for $Y \subset X$ over $S$.
If we ever need this result we will formulate a precise statement and
add a proof here.
\end{remark}

\begin{remark}
\label{remark-check-log-completion-2}
Let $S$ be a locally Noetherian scheme. Let $X$ be locally of finite
type over $S$. Let $Y \subset X$ be an effective Cartier divisor.
If for every $y \in Y$ we can find a diagram of schemes over $S$
$$
X \xleftarrow{\varphi} U \xrightarrow{\psi} V
$$
with $\varphi$ \'etale and $\psi|_{\varphi^{-1}(Y)} : \varphi^{-1}(Y) \to V$
\'etale, then the de Rham complex of log poles is defined for
$Y \subset X$ over $S$. A special case is when the pair $(X, Y)$
\'etale locally looks like $(V \times \mathbf{A}^1, V \times \{0\})$.
If we ever need this result we will formulate
a precise statement and add a proof here.
\end{remark}

















\section{Calculations}
\label{section-calculations}

\noindent
In this section we calculate some Hodge and de Rham cohomology
groups for a standard blowing up.

\medskip\noindent
We fix a base ring $R$. In this section all schemes are schemes
over $\Spec(R)$ and all products of schemes are products over $\Spec(R)$.
For $s \geq 0$ we denote $\mathbf{A}^s$ and $\mathbf{P}^s$ the affine
and projective space over $\Spec(R)$.

\medskip\noindent
Fix integers $0 \leq m$ and $1 \leq n$. Consider the closed immersion
$\mathbf{A}^m \subset \mathbf{A}^{m + n}$,
$(a_1, \ldots, a_m) \mapsto (a_1, \ldots, a_m, 0, \ldots 0)$.
We are going to consider the blowing up $L$ of $\mathbf{A}^{m + n}$
along the closed subscheme $\mathbf{A}^m$. Write
$$
\mathbf{A}^{m + n} = \Spec(R[x_1, \ldots, x_m, y_1, \ldots, y_n])
$$
We will consider $A = R[x_1, \ldots, x_m, y_1, \ldots, y_n]$ as a
graded $R$-algebra by setting $\deg(x_i) = 0$ and $\deg(y_j) = 1$.
With this grading we have
$$
P = \text{Proj}(A) = \mathbf{A}^m \times \mathbf{P}^{n - 1}
$$
Observe that the ideal cutting out $\mathbf{A}^m$ in
$\mathbf{A}^{m + n} = \Spec(A)$ is the ideal $A_+$.
Hence $L$ is the Proj of the Rees algebra
$$
A \oplus A_+ \oplus (A_+)^2 \oplus \ldots =
\bigoplus\nolimits_{d \geq 0} A_{\geq d}
$$
Hence $L$ is an example of the phenomenon studied in
more generality in More on Morphisms, Section
\ref{more-morphisms-section-proj-spec};
we will use the observations we made there without further mention.
In particular, we can consider the diagram
$$
\xymatrix{
P \ar[r]_0 \ar[d]_p &
L \ar[r]_-\pi \ar[d]^b &
P \ar[d] \\
\mathbf{A}^m \ar[r]^i &
\mathbf{A}^{m + n} \ar[r] &
\mathbf{A}^m
}
$$
Thus we see that $L$ is a line bundle over
$P = \mathbf{A}^m \times \mathbf{P}^{n - 1}$
whose zero section is the exceptional divisor of the blowup $b$.

\begin{lemma}
\label{lemma-comparison}
Taking differentials over $\Spec(R)$ for $a \geq 0$ we have
\begin{enumerate}
\item the map
$\Omega^a_{\mathbf{A}^{m + n}} \to b_*\Omega^a_L$ is an isomorphism,
\item the map $\Omega^a_{\mathbf{A}^m} \to p_*\Omega^a_P$ is an isomorphism,
and
\item the map $Rb_*\Omega^a_L \to i_*Rp_*\Omega^a_P$ is an isomorphism
on cohomology sheaves in degree $\geq 1$.
\end{enumerate}
\end{lemma}

\begin{proof}
Let us first prove part (2). Since $P = \mathbf{A}^m \times \mathbf{P}^{n - 1}$
we see that
$$
\Omega^a_P = \bigoplus\nolimits_{a = r + s}
\text{pr}_1^*\Omega^r_{\mathbf{A}^m} \otimes
\text{pr}_2^*\Omega^s_{\mathbf{P}^{n - 1}}
$$
Recalling that $p = \text{pr}_1$ by the projection formula
(Cohomology, Lemma \ref{cohomology-lemma-projection-formula})
we obtain
$$
p_*\Omega^a_P = \bigoplus\nolimits_{a = r + s}
\Omega^r_{\mathbf{A}^m} \otimes
\text{pr}_{1, *}\text{pr}_2^*\Omega^s_{\mathbf{P}^{n - 1}}
$$
By the calculations in Section \ref{section-projective-space}
and in particular in
the proof of Lemma \ref{lemma-hodge-cohomology-projective-space}
we have $\text{pr}_{1, *}\text{pr}_2^*\Omega^s_{\mathbf{P}^{n - 1}} = 0$
except if $s = 0$ in which case we get
$\text{pr}_{1, *}\mathcal{O}_P = \mathcal{O}_{\mathbf{A}^m}$.
This proves (2).

\medskip\noindent
By the material in Section \ref{section-line-bundle} and in particular
\ref{lemma-push-omega-a} we have
$\pi_*\Omega^a_L = \Omega^a_P \oplus \bigoplus_{k \geq 1} \Omega^a_{L, k}$
Since the composition $\pi \circ 0$ in the diagram above
is the identity morphism on $P$ to prove part (3) it suffices to show that
$\Omega^a_{L, k}$ has vanishing higher cohomology for $k > 0$.
By Lemmas \ref{lemma-the-complex-for-L-star} and \ref{lemma-push-omega-a}
there are short exact sequences
$$
0 \to \Omega^a_P \otimes \mathcal{O}_P(k)
\to \Omega^a_{L, k} \to
\Omega^{a - 1}_P \otimes \mathcal{O}_P(k) \to 0
$$
where $\Omega^{a - 1} = 0$ if $a = 0$. By
Lemma \ref{lemma-twisted-hodge-cohomology-projective-space}
we obtain the desired vanishing of higher cohomology.

\medskip\noindent
We still have to prove (1). If $n = 1$, then we are blowing
up an effective Cartier divisor and $b$ is an isomorphism
and we have (1). If $n > 1$, then the composition
$$
\Gamma(\mathbf{A}^{n + m}, \Omega^a_{\mathbf{A}^{n + m}})
\to
\Gamma(L, \Omega^a_L)
\to
\Gamma(L \setminus 0(P), \Omega^a_L)
=
\Gamma(\mathbf{A}^{n + m} \setminus \mathbf{A}^m,
\Omega^a_{\mathbf{A}^{n + m}})
$$
is an isomorphism as $\Omega^a_{\mathbf{A}^{m + n}}$ is finite free
(small detail omitted). Thus the only way (1) can fail is if
there are nonzero elements of $\Gamma(L, \Omega^a_L)$ which vanish
outside of $0(P)$. Since $L$ is a line bundle over $P$
with zero section $0 : P \to L$, it suffices to show that
on a line bundle there are no nonzero sections of a sheaf
of differentials which vanish outside the zero section.
The reader sees this is true either (preferably) by a local caculation
or by using that
$\Omega_{L, k} \subset \Omega_{L^\star, k}$
(see references above).
\end{proof}























\section{Blowing up and de Rham cohomology}
\label{section-blowing-up}

\noindent
Fix a base scheme $S$, a smooth morphism $X \to S$, and a closed subscheme
$Z \subset X$ which is also smooth over $S$. Denote $b : X' \to X$
the blowing up of $X$ along $Z$. Denote $E \subset X'$ the exceptional
divisor. Picture
\begin{equation}
\label{equation-blowup}
\xymatrix{
E \ar[r]_j \ar[d]_p & X' \ar[d]^b \\
Z \ar[r]^i & X
}
\end{equation}
Our goal in this section is to prove that the map
$b^* : H_{dR}^*(X/S) \longrightarrow H_{dR}^*(X'/S)$
is injective (although a lot more can be said).

\begin{lemma}
\label{lemma-etale-local-structure}
Let $S$ be a scheme. Let $Y \to X$ be a closed immersion of schemes
smooth over $S$. For every $y \in Y$ there exist integers
$0 \leq m \leq n$ and a commutative diagram
$$
\xymatrix{
Y \ar[d] &
V \ar[l] \ar[d] \ar[r] &
\mathbf{A}^m_S
\ar[d]^{(a_1, \ldots, a_m) \mapsto (a_1, \ldots, a_m, 0 \ldots, 0)} \\
X &
U \ar[l] \ar[r]^\pi &
\mathbf{A}^n_S
}
$$
where $U \subset X$ is open, $V = Y \cap U$,
$\pi$ is \'etale, and $V = \pi^{-1}(\mathbf{A}^m_S)$.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-blowup}
Let $S$ be a scheme. Let $Y \to X$ be a closed immersion of schemes
smooth over $S$. Let $b' : X' \to X$ be the blowing up of $Y$ with
exceptional divisor $E \subset X'$. Then $X'$ and $E$ are smooth
over $S$ and $p : E \to Z$ is a projective space bundle whose relative
$\mathcal{O}_E(1)$ is isomorphic to the restriction of
$\mathcal{O}_{X'}(-E)$.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-comparison-general}
With notation as in Lemma \ref{lemma-blowup} for $a \geq 0$ we have
\begin{enumerate}
\item the map
$\Omega^a_{X/S} \to b_*\Omega^a_{X'/S}$ is an isomorphism,
\item the map $\Omega^a_{Z/S} \to p_*\Omega^a_{E/S}$ is an isomorphism,
\item the map $Rb_*\Omega^a_{X'/S} \to i_*Rp_*\Omega^a_{E/S}$ is an isomorphism
on cohomology sheaves in degree $\geq 1$.
\end{enumerate}
\end{lemma}

\begin{proof}
Working \'etale locally, by Lemma \ref{lemma-etale-local-structure},
we may assume we are in the situation discussed in
Section \ref{section-calculations}. In this case the lemma
is the same as Lemma \ref{lemma-comparison}.
\end{proof}

\begin{lemma}
\label{lemma-distinguished-triangle-blowup}
With notation as in Lemma \ref{lemma-blowup} there is a canonical
distinguished triangle
$$
\Omega^\bullet_{X/S} \to
Rb_*(\Omega^\bullet_{X'/S}) \oplus i_*\Omega^\bullet_{Z/S} \to
i_*Rp_*(\Omega^\bullet_{E/S}) \to
\Omega^\bullet_{X/S}[1]
$$
in $D(X, (X \to S)^{-1}\mathcal{O}_S)$ where the four maps
$\Omega^\bullet_{X/S} \to Rb_*(\Omega^\bullet_{X'/S})$,
$\Omega^\bullet_{X/S} \to i_*\Omega^\bullet_{Z/S}$,
$Rb_*(\Omega^\bullet_{X'/S}) \to i_*Rp_*(\Omega^\bullet_{E/S})$, and
$i_*\Omega^\bullet_{Z/S} \to i_*Rp_*(\Omega^\bullet_{E/S})$
are the canonical ones (Section \ref{section-de-rham-complex}),
except with sign reversed for one of them.
\end{lemma}

\begin{proof}
Choose a distinguished triangle
$$
C \to Rb_*\Omega^\bullet_{X'/S} \oplus i_*\Omega^\bullet_{Z/S}
\to i_*Rp_*\Omega^\bullet_{E/S} \to C[1]
$$
in $D(X, (X \to S)^{-1}\mathcal{O}_S)$. It suffices to show that
$\Omega^\bullet_{X/S}$ is isomorphic to $C$ in a manner compatible
with the canonical maps. Consider the map of distinguished
triangles
$$
\xymatrix{
C' \ar[r] \ar[d] &
b_*\Omega^\bullet_{X'/S} \oplus i_*\Omega^\bullet_{Z/S} \ar[r] \ar[d] &
i_*p_*\Omega^\bullet_{E/S} \ar[r] \ar[d] &
C'[1] \ar[d] \\
C \ar[r] &
Rb_*\Omega^\bullet_{X'/S} \oplus i_*\Omega^\bullet_{Z/S} \ar[r] &
i_*Rp_*\Omega^\bullet_{E/S} \ar[r] &
C[1]
}
$$
By Lemma \ref{lemma-comparison-general} part (3) and
Derived Categories, Proposition \ref{derived-proposition-9} we conclude that
$C' \to C$ is an isomorphism. By Lemma \ref{lemma-comparison-general} part (2)
the map $i_*\Omega^\bullet_{Z/S} \to i_*p_*\Omega^\bullet_{E/S}$
is an isomorphism. Thus $C' = b_*\Omega^\bullet_{X'/S}$
in the derived category. Finally we Lemma \ref{lemma-comparison-general}
part (1) tells us this is equal to $\Omega^\bullet_{X/S}$.
We omit the verification this is compatible with the canonical maps.
\end{proof}

\begin{proposition}
\label{proposition-blowup-split}
With notation as in Lemma \ref{lemma-blowup} the map
$\Omega^\bullet_{X/S} \to Rb_*\Omega^\bullet_{X'/S}$
has a splitting in $D(X, (X \to S)^{-1}\mathcal{O}_S)$.
\end{proposition}

\begin{proof}
Consider the triangle constructed in
Lemma \ref{lemma-distinguished-triangle-blowup}.
We will show that the map
$$
Rb_*(\Omega^\bullet_{X'/S}) \oplus i_*\Omega^\bullet_{Z/S} \to
i_*Rp_*(\Omega^\bullet_{E/S})
$$
has a splitting whose image contains the summand $i_*\Omega^\bullet_{Z/S}$.
By Derived Categories, Lemma \ref{derived-lemma-split} this will show that
the first arrow of the triangle has a splitting which vanishes on
the summand $i_*\Omega^\bullet_{Z/S}$ which proves the lemma.
We may decompose $X$ into open and closed subschemes
having fixed relative dimension to $S$. Thus we may assume $X$ has
fixed relative dimension $N$ over $S$. We may decompose
$Z = \coprod Z_m$ into open and closed subschemes of relative
dimension $m$ over $S$. By FIXME we have an isomorphism
$$
Rp_*(\Omega^\bullet_{E/S}) =
\bigoplus\nolimits_m
\bigoplus\nolimits_{t = 0, \ldots, N - m - 1}
\Omega^\bullet_{Z_m/S}[-2t]
$$
The summand $i_*\Omega^\bullet_{Z/S}$ maps isomorphically to
the direct summands with $t = 0$ above. For $t > 0$ we consider
the map
$$
\gamma : j_*\Omega^\bullet_{E/S}[-2] \longrightarrow \Omega^\bullet_{X'/S}
$$
of Lemma \ref{lemma-gysin-via-log-complex}. This produces maps
$$
i_*Rp_*\Omega^\bullet_{E/S}[-2] \to
Rb_*\Omega^\bullet_{X'/S} \to
i_*Rp_*\Omega^\bullet_{E/S}
$$
which split off the other summands of the decomposition
of $Rp_*\Omega^\bullet_{E/S}$ given above. FIXME.
\end{proof}















\section{Comparing sheaves of differential forms}
\label{section-quasi-finite-syntomic}

\noindent
The goal of this section is to compare the sheaves
$\Omega^p_{X/\mathbf{Z}}$ and $\Omega^p_{Y/\mathbf{Z}}$
when given a locally quasi-finite syntomic morphism of schemes $f : Y \to X$.
The result will be applied in Section \ref{section-trace}
to the construction of the trace map on de Rham complexes if $f$ is finite.

\begin{lemma}
\label{lemma-funny-map}
Let $R$ be a ring and consider a commutative diagram
$$
\xymatrix{
0 \ar[r] &
K^0 \ar[r] &
L^0 \ar[r] &
M^0 \ar[r] & 0 \\
& & L^{-1} \ar[u]_\partial \ar@{=}[r] &
M^{-1} \ar[u]
}
$$
of $R$-modules with exact top row and $M^0$ and $M^{-1}$
finite free of the same rank. Then there are canonical maps
$$
\wedge^i(H^0(L^\bullet)) \longrightarrow \wedge^i(K^0) \otimes_R \det(M^\bullet)
$$
whose composition with $\wedge^i(K^0) \to \wedge^i(H^0(L^\bullet))$
is equal to multiplication with $\delta(M^\bullet)$.
\end{lemma}

\begin{proof}
Say $M^0$ and $M^{-1}$ are free of rank $n$. For every $i \geq 0$
there is a canonical surjection
$$
\pi_i :
\wedge^{n + i}(L^0)
\longrightarrow
\wedge^i(K^0) \otimes \wedge^n(M^0)
$$
whose kernel is the submodule generated by wedges
$l_1 \wedge \ldots \wedge l_{n + i}$ such that $> i$ of the
$l_j$ are in $K^0$. On the other hand, the exact sequence
$$
L^{-1} \to L^0 \to H^0(L^\bullet) \to 0
$$
similarly produces canonical maps
$$
\wedge^i(H^0(L^\bullet)) \otimes \wedge^n(L^{-1})
\longrightarrow
\wedge^{n + i}(L^0)
$$
by sending $\eta \otimes \theta$ to $\tilde \eta \wedge \partial(\theta)$
where $\tilde \eta \in \wedge^i(L^0)$ is a lift of $\eta$.
The composition of these two maps, combined with the identification
$\wedge^n(L^{-1}) = \wedge^n(M^{-1})$ gives a map
$$
\wedge^i(H^0(L^\bullet)) \otimes \wedge^n(M^{-1})
\longrightarrow
\wedge^i(K^0) \otimes \wedge^n(M^0)
$$
Since $\det(M^\bullet) = \wedge^n(M^0) \otimes
(\wedge^n(M^{-1}))^{\otimes -1}$ this produces a map as
in the statement of the lemma.
If $\eta$ is the image of $\omega \in \wedge^i(K^0)$, then we see
that $\theta \otimes \eta$ is mapped to
$\pi_i(\omega \wedge \partial(\theta)) = \omega \otimes \overline{\theta}$ in
$\wedge^i(K^0) \otimes \wedge^n(M^0)$ where $\overline{\theta}$
is the image of $\theta$ in $\wedge^n(M^0)$. Since
$\delta(M^\bullet)$ is simply the determinant of the map
$M^{-1} \to M^0$ this proves the last statement.
\end{proof}

\begin{remark}
\label{remark-local-description}
Let $A$ be a ring. Let $P = A[x_1, \ldots, x_n]$. Let
$f_1, \ldots, f_n \in P$ and set $B = P/(f_1, \ldots, f_n)$.
Assume $A \to B$ is quasi-finite. Then
$B$ is a relative global complete intersection over $A$ (Algebra, Definition
\ref{algebra-definition-relative-global-complete-intersection}) and
$(f_1, \ldots, f_n)/(f_1, \ldots, f_n)^2$ is free with generators
the classes $\overline{f}_i$ by Algebra, Lemma
\ref{algebra-lemma-relative-global-complete-intersection-conormal}.
Consider the following diagram
$$
\xymatrix{
\Omega_{A/\mathbf{Z}} \otimes_A B \ar[r] &
\Omega_{P/\mathbf{Z}} \otimes_P B \ar[r] &
\Omega_{P/A} \otimes_P B \\
&
(f_1, \ldots, f_n)/(f_1, \ldots, f_n)^2 \ar[u] \ar@{=}[r] &
(f_1, \ldots, f_n)/(f_1, \ldots, f_n)^2 \ar[u]
}
$$
The right column represents $\NL_{B/A}$ in $D(B)$ hence has cohomology
$\Omega_{B/A}$ in degree $0$. The top row is the split short exact sequence
$0 \to \Omega_{A/\mathbf{Z}} \otimes_A B \to
\Omega_{P/\mathbf{Z}} \otimes_P B \to \Omega_{P/A} \otimes_P B \to 0$.
The middle column has cohomology $\Omega_{B/\mathbf{Z}}$ in degree $0$
by Algebra, Lemma \ref{algebra-lemma-differential-seq}.
Thus by Lemma \ref{lemma-funny-map} we obtain canonical $B$-module maps
$$
\Omega^p_{B/\mathbf{Z}} \longrightarrow
\Omega^p_{A/\mathbf{Z}} \otimes_A \det(\NL_{B/A})
$$
whose composition with
$\Omega^p_{A/\mathbf{Z}} \to \Omega^p_{B/\mathbf{Z}}$
is multiplication by $\delta(\NL_{B/A})$.
\end{remark}

\begin{lemma}
\label{lemma-Garel-upstairs}
There exists a unique rule that to every locally quasi-finite syntomic
morphism of schemes $f : Y \to X$ assigns $\mathcal{O}_Y$-module maps
$$
c^p_{Y/X} :
\Omega^p_{Y/\mathbf{Z}}
\longrightarrow
f^*\Omega^p_{X/\mathbf{Z}} \otimes_{\mathcal{O}_Y} \det(\NL_{Y/X})
$$
satisfying the following two properties
\begin{enumerate}
\item the composition with
$f^*\Omega^p_{X/\mathbf{Z}} \to \Omega^p_{Y/\mathbf{Z}}$
is multiplication by $\delta(\NL_{Y/X})$, and
\item the rule is compatible with restriction to opens and with
base change.
\end{enumerate}
\end{lemma}

\begin{proof}
This proof is very similar to the proof of
Discriminants, Proposition \ref{discriminant-proposition-tate-map}
and we suggest the reader look at that proof first.
We fix $p \geq 0$ throughout the proof.

\medskip\noindent
Let us reformulate the statement. Consider the category
$\mathcal{C}$ whose objects, denoted $Y/X$, are locally quasi-finite syntomic
morphism $f : Y \to X$ of schemes and whose morphisms
$b/a : Y'/X' \to Y/X$ are commutative diagrams
$$
\xymatrix{
Y' \ar[d]_{f'} \ar[r]_b & Y \ar[d]^f \\
X' \ar[r]^a & X
}
$$
which induce an isomorphism of $Y'$ with an open subscheme of
$X' \times_X Y$. The lemma means that for every object
$Y/X$ of $\mathcal{C}$ we have maps $c^p_{Y/X}$ with property (1)
and for every morphism $b/a : Y'/X' \to Y/X$ of $\mathcal{C}$ we have
$b^*c^p_{Y/X} = c^p_{Y'/X'}$ via the identifications
$b^*\det(\NL_{Y/X}) = \det(\NL_{Y'/X'})$
(Discriminants, Section \ref{discriminant-section-tate-map})
and $b^*\Omega^p_{Y/X} = \Omega^p_{Y'/X'}$
(Lemma \ref{lemma-base-change-de-rham}).

\medskip\noindent
Given $Y/X$ in $\mathcal{C}$ and $y \in Y$ we can find
an affine open $V \subset Y$ and $U \subset X$ with $f(V) \subset U$
such that there exists some maps
$$
\Omega^p_{Y/\mathbf{Z}}|_V
\longrightarrow
\left(
f^*\Omega^p_{X/\mathbf{Z}} \otimes_{\mathcal{O}_Y} \det(\NL_{Y/X})
\right)|_V
$$
with property (1). This follows
from picking affine opens as in
Discriminants, Lemma \ref{discriminant-lemma-syntomic-quasi-finite} part (5)
and Remark \ref{remark-local-description}.
If $\Omega^p_{X/\mathbf{Z}}$ is finite locally free and
annihilator of the section $\delta(\NL_{Y/X})$ is zero, then
these local maps are unique and automatically glue!

\medskip\noindent
Let $\mathcal{C}_{nice} \subset \mathcal{C}$ denote the full subcategory
of $Y/X$ such that
\begin{enumerate}
\item $X$ is of finite type over $\mathbf{Z}$,
\item $\Omega_{X/\mathbf{Z}}$ is locally free, and
\item  the annihilator of $\delta(\NL_{Y/X})$ is zero.
\end{enumerate}
By the remarks in the previous paragraph, we see that for any
object $Y/X$ of $\mathcal{C}_{nice}$ we have a unique map
$c^p_{Y/X}$ satisfying condition (1). If $b/a : Y'/X' \to Y/X$
is a morphism of $\mathcal{C}_{nice}$, then
$b^*c^p_{Y/X}$ is equal to $c^p_{Y'/X'}$ because
$b^*\delta(\NL_{Y/X}) = \delta(\NL_{Y'/X'})$ (see
Discriminants, Section \ref{discriminant-section-tate-map}).
In other words, we have solved the problem
on the full subcategory $\mathcal{C}_{nice}$. For $Y/X$ in $\mathcal{C}_{nice}$
we continue to denote $c^p_{Y/X}$ the solution we've just found.

\medskip\noindent
Consider morphisms
$$
Y_1/X_1 \xleftarrow{b_1/a_1} Y/X \xrightarrow{b_2/a_2} Y_2/X_2
$$
in $\mathcal{C}$ such that $Y_1/X_1$ and $Y_2/X_2$ are objects
of $\mathcal{C}_{nice}$.
{\bf Claim.} $b_1^*c^p_{Y_1/X_1} = b_2^*c^p_{Y_2/X_2}$.
We will first show that the claim implies the lemma
and then we will prove the claim.

\medskip\noindent
Let $d, n \geq 1$ and consider the locally
quasi-finite syntomic morphism $Y_{n, d} \to X_{n, d}$
constructed in Discriminants, Example
\ref{discriminant-example-universal-quasi-finite-syntomic}.
Then $Y_{n, d}$ and $Y_{n, d}$ are irreducible schemes of finite type and
smooth over $\mathbf{Z}$. Namely, $X_{n, d}$ is a spectrum of a
polynomial ring over $\mathbf{Z}$ and $Y_{n, d}$ is an open subscheme
of such. The morphism $Y_{n, d} \to X_{n, d}$ is locally quasi-finite syntomic
and \'etale over a dense open, see Discriminants, Lemma
\ref{discriminant-lemma-universal-quasi-finite-syntomic-etale}.
Thus $\delta(\NL_{Y_{n, d}/X_{n, d}})$ is nonzero: for example we have
the local description of $\delta(\NL_{Y/X})$ in
Discriminants, Remark \ref{discriminant-remark-local-description-delta}
and we have the local description of \'etale morphisms in
Morphisms, Lemma \ref{morphisms-lemma-etale-at-point} part (8).
Now a nonzero section of an invertible module over an irreducible
regular scheme has vanishing annihilator. Thus
$Y_{n, d}/X_{n, d}$ is an object of $\mathcal{C}_{nice}$.

\medskip\noindent
Let $Y/X$ be an arbitrary object of $\mathcal{C}$. Let $y \in Y$.
By Discriminants, Lemma \ref{discriminant-lemma-locally-comes-from-universal}
we can find $n, d \geq 1$ and morphisms
$$
Y/X \leftarrow V/U \xrightarrow{b/a} Y_{n, d}/X_{n, d}
$$
of $\mathcal{C}$ such that $V \subset Y$ and $U \subset X$ are open.
Thus we can pullback the canonical morphism $c^p_{Y_{n, d}/X_{n, d}}$
constructed above by $b$ to $V$. The claim guarantees these local
isomorphisms glue! Thus we get a well defined global maps
$c^p_{Y/X}$ with property (1).
If $b/a : Y'/X' \to Y/X$ is a morphism of $\mathcal{C}$, then
the claim also implies that the similarly constructed map
$c^p_{Y'/X'}$ is the pullback by $b$ of the locally constructed
map $c^p_{Y/X}$. Thus it remains to prove the claim.

\medskip\noindent
In the rest of the proof we prove the claim. We may pick a point
$y \in Y$ and prove the maps agree in an open neighbourhood of $y$.
Thus we may replace $Y_1$, $Y_2$ by open neighbourhoods of the
image of $y$ in $Y_1$ and $Y_2$. Thus we may assume
$Y, X, Y_1, X_1, Y_2, X_2$ are affine.
We may write $X = \lim X_\lambda$ as a cofiltered limit of affine
schemes of finite type over $X_1 \times X_2$. For each $\lambda$
we get
$$
Y_1 \times_{X_1} X_\lambda
\quad\text{and}\quad
X_\lambda \times_{X_2} Y_2
$$
If we take limits we obtain
$$
\lim Y_1 \times_{X_1} X_\lambda =
Y_1 \times_{X_1} X \supset Y \subset
X \times_{X_2} Y_2 = \lim X_\lambda \times_{X_2} Y_2
$$
By Limits, Lemma \ref{limits-lemma-descend-opens}
we can find a $\lambda$ and opens
$V_{1, \lambda} \subset Y_1 \times_{X_1} X_\lambda$ and
$V_{2, \lambda} \subset X_\lambda \times_{X_2} Y_2$
whose base change to $X$ recovers $Y$ (on both sides).
After increasing $\lambda$ we may assume
there is an isomorphism
$V_{1, \lambda} \to V_{2, \lambda}$ whose base change to $X$ is the
identity on $Y$, see
Limits, Lemma \ref{limits-lemma-descend-finite-presentation}.
Then we have the commutative diagram
$$
\xymatrix{
& Y/X \ar[d] \ar[ld]_{b_1/a_1} \ar[rd]^{b_2/a_2} \\
Y_1/X_1 & V_{1, \lambda}/X_\lambda \ar[l] \ar[r] & Y_2/X_2
}
$$
Thus it suffices to prove the claim for the lower row
of the diagram and we reduce to the case discussed in the
next paragraph.

\medskip\noindent
Assume $Y, X, Y_1, X_1, Y_2, X_2$ are affine of finite type over $\mathbf{Z}$.
Write $X = \Spec(A)$, $X_i = \Spec(A_i)$. The ring map $A_1 \to A$ corresponding
to $X \to X_1$ is of finite type and hence we may choose a surjection
$A_1[x_1, \ldots, x_n] \to A$. Similarly, we may choose a surjection
$A_2[y_1, \ldots, y_m] \to A$. Set $X'_1 = \Spec(A_1[x_1, \ldots, x_n])$
and $X'_2 = \Spec(A_2[y_1, \ldots, y_m])$. Observe that
$\Omega_{X'_1/\mathbf{Z}}$ is the direct sum of the pullback of
$\Omega_{X_1/\mathbf{Z}}$ and a finite free module.
Similarly for $X'_2$. Set $Y'_1 = Y_1 \times_{X_1} X'_1$ and
$Y'_2 = Y_2 \times_{X_2} X'_2$. We get the following diagram
$$
Y_1/X_1 \leftarrow
Y'_1/X'_1 \leftarrow
Y/X
\rightarrow Y'_2/X'_2
\rightarrow Y_2/X_2
$$
Since $X'_1 \to X_1$ and $X'_2 \to X_2$ are flat, the same is true
for $Y'_1 \to Y_1$ and $Y'_2 \to Y_2$. It follows easily that the
annihilators of $\delta(\NL_{Y'_1/X'_1})$ and $\delta(\NL_{Y'_2/X'_2})$
are zero.
Hence $Y'_1/X'_1$ and $Y'_2/X'_2$ are in $\mathcal{C}_{nice}$.
Thus the outer morphisms in the displayed diagram are morphisms
of $\mathcal{C}_{nice}$ for which we know the desired compatibilities.
Thus it suffices to prove the claim for
$Y'_1/X'_1 \leftarrow Y/X \rightarrow Y'_2/X'_2$. This reduces us
to the case discussed in the next paragraph.

\medskip\noindent
Assume $Y, X, Y_1, X_1, Y_2, X_2$ are affine of finite type over
$\mathbf{Z}$ and $X \to X_1$ and $X \to X_2$ are closed immersions.
Consider the open embeddings
$Y_1 \times_{X_1} X \supset Y \subset X \times_{X_2} Y_2$.
There is an open neighbourhood $V \subset Y$ of $y$ which is a
standard open of both $Y_1 \times_{X_1} X$ and $X \times_{X_2} Y_2$.
This follows from Schemes, Lemma \ref{schemes-lemma-standard-open-two-affines}
applied to the scheme obtained by glueing $Y_1 \times_{X_1} X$ and
$X \times_{X_2} Y_2$ along $Y$; details omitted.
Since $X \times_{X_2} Y_2$ is a closed subscheme of $Y_2$
we can find a standard open $V_2 \subset Y_2$ such that
$V_2 \times_{X_2} X = V$. Similarly, we can find a standard open
$V_1 \subset Y_1$ such that $V_1 \times_{X_1} X = V$.
After replacing $Y, Y_1, Y_2$ by $V, V_1, V_2$ we reduce to the
case discussed in the next paragraph.

\medskip\noindent
Assume $Y, X, Y_1, X_1, Y_2, X_2$ are affine of finite type over
$\mathbf{Z}$ and $X \to X_1$ and $X \to X_2$ are closed immersions
and $Y_1 \times_{X_1} X = Y = X \times_{X_2} Y_2$.
Write $X = \Spec(A)$, $X_i = \Spec(A_i)$, $Y = \Spec(B)$,
$Y_i = \Spec(B_i)$. Then we can consider the affine schemes
$$
X' = \Spec(A_1 \times_A A_2) = \Spec(A')
\quad\text{and}\quad
Y' = \Spec(B_1 \times_B B_2) = \Spec(B')
$$
Observe that $X' = X_1 \amalg_X X_2$ and $Y' = Y_1 \amalg_Y Y_2$, see
More on Morphisms, Lemma \ref{more-morphisms-lemma-basic-example-pushout}.
By More on Algebra, Lemma \ref{more-algebra-lemma-fibre-product-finite-type}
the rings $A'$ and $B'$ are of finite type over $\mathbf{Z}$. By
More on Algebra, Lemma \ref{more-algebra-lemma-module-over-fibre-product}
we have $B' \otimes_A A_1 = B_1$ and $B' \times_A A_2 = B_2$.
In particular a fibre of $Y' \to X'$ over a point of
$X' = X_1 \amalg_X X_2$ is always equal to either a fibre of $Y_1 \to X_1$
or a fibre of $Y_2 \to X_2$. By More on Algebra, Lemma
\ref{more-algebra-lemma-flat-module-over-fibre-product}
the ring map $A' \to B'$ is flat. Thus by Discriminants, Lemma
\ref{discriminant-lemma-syntomic-quasi-finite} part (3)
we conclude that $Y'/X'$ is an object of $\mathcal{C}$.
Consider now the commutative diagram
$$
\xymatrix{
& Y/X \ar[ld]_{b_1/a_1} \ar[rd]^{b_2/a_2} \\
Y_1/X_1 \ar[rd] & & Y_2/X_2 \ar[ld] \\
& Y'/X'
}
$$
Now we would be done if $Y'/X'$ is an object of $\mathcal{C}_{nice}$,
but this is almost never the case. Namely, then pulling back $c^p_{Y'/X'}$
around the two sides of the square, we would obtain the desired conclusion.
To get around the problem that $Y'/X'$ is not in $\mathcal{C}_{nice}$
we note the arguments above show that, after possibly shrinking all
of the schemes $X, Y, X_1, Y_1, X_2, Y_2, X', Y'$ we can find some
$n, d \geq 1$, and extend the diagram like so:
$$
\xymatrix{
& Y/X \ar[ld]_{b_1/a_1} \ar[rd]^{b_2/a_2} \\
Y_1/X_1 \ar[rd] & & Y_2/X_2 \ar[ld] \\
& Y'/X' \ar[d] \\
& Y_{n, d}/X_{n, d}
}
$$
and then we can use the already given argument by pulling
back from $c^p_{Y_{n, d}/X_{n, d}}$. This finishes the proof.
\end{proof}








\section{Trace maps on de Rham complexes}
\label{section-trace}

\noindent
A reference for some of the material in this section is \cite{Garel}.
Let $S$ be a scheme. Let $f : Y \to X$ be a finite locally free morphism
of schemes over $S$. Then there is a trace map
$\text{Trace}_f : f_*\mathcal{O}_Y \to \mathcal{O}_X$, see
Discriminants, Section \ref{discriminant-section-discriminant}.
In this situation a trace map on de Rham complexes is a map
of complexes
$$
\Theta_{Y/X} : f_*\Omega^\bullet_{Y/S} \longrightarrow \Omega^\bullet_{X/S}
$$
such that $\Theta_{Y/X}$ is equal to $\text{Trace}_f$ in degree $0$
and satisfies
$$
\Theta_{Y/X}(\omega \wedge \eta) = \omega \wedge \Theta_{Y/X}(\eta)
$$
for local sections $\omega$ of $\Omega^\bullet_{X/S}$ and $\eta$
of $f_*\Omega^\bullet_{Y/S}$. It is not clear to us whether such a trace map
$\Theta_{Y/X}$ exists for every finite locally free morphism $Y \to X$;
please email
\href{mailto:stacks.project@gmail.com}{stacks.project@gmail.com}
if you have a counterexample or a proof.

\begin{example}
\label{example-no-trace}
Here is an example where we do not have a trace map on de Rham complexes.
For example, consider the $\mathbf{C}$-algebra $B = \mathbf{C}[x, y]$ with
action of $G = \{\pm 1\}$ given by $x \mapsto -x$ and $y \mapsto -y$.
The invariants $A = B^G$ form a normal domain of finite type over $\mathbf{C}$
generated by $x^2, xy, y^2$. We claim that for the inclusion $A \subset B$
there is no reasonable trace map
$\Omega_{B/\mathbf{C}} \to \Omega_{A/\mathbf{C}}$
on $1$-forms. Namely, consider the element
$\omega = x \text{d} y \in \Omega_{B/\mathbf{C}}$.
Since $\omega$ is invariant under the action of $G$ if a ``reasonable''
trace map exists, then $2\omega$ should be in the image of
$\Omega_{A/\mathbf{C}} \to \Omega_{B/\mathbf{C}}$. This is
not the case: there is no way to write $2\omega$ as a linear
combination of $\text{d}(x^2)$, $\text{d}(xy)$, and $\text{d}(y^2)$
even with coefficients in $B$.
This example contradicts the main theorem in
\cite{Zannier}.
\end{example}

\begin{lemma}
\label{lemma-Garel}
There exists a unique rule that to every finite syntomic
morphism of schemes $f : Y \to X$ assigns $\mathcal{O}_X$-module maps
$$
\Theta^p_{Y/X} :
f_*\Omega^p_{Y/\mathbf{Z}}
\longrightarrow
\Omega^p_{X/\mathbf{Z}}
$$
satisfying the following properties
\begin{enumerate}
\item the composition with
$\Omega^p_{X/\mathbf{Z}} \otimes_{\mathcal{O}_X} f_*\mathcal{O}_Y
\to f_*\Omega^p_{Y/\mathbf{Z}}$ is equal to
$\text{id} \otimes \text{Trace}_f$
where $\text{Trace}_f : f_*\mathcal{O}_Y \to \mathcal{O}_X$
is the map from
Discriminants, Section \ref{discriminant-section-discriminant},
\item the rule is compatible with base change.
\end{enumerate}
\end{lemma}

\begin{proof}
First, assume that $X$ is locally Noetherian. By
Lemma \ref{lemma-Garel-upstairs} we have a canonical map
$$
c^p_{Y/X} : \Omega_{Y/S}^p
\longrightarrow
f^*\Omega_{X/S}^p \otimes_{\mathcal{O}_Y} \det(\NL_{Y/X})
$$
By Discriminants, Proposition \ref{discriminant-proposition-tate-map}
we have a canonical isomorphism
$$
c_{Y/X} : \det(\NL_{Y/X}) \to \omega_{Y/X}
$$
mapping $\delta(\NL_{Y/X})$ to $\tau_{Y/X}$. Combined these maps give
$$
c^p_{Y/X} \otimes c_{Y/X} :
\Omega_{Y/S}^p
\longrightarrow
f^*\Omega_{X/S}^p \otimes_{\mathcal{O}_Y} \omega_{Y/X}
$$
By Discriminants, Section \ref{discriminant-section-finite-morphisms}
this is the same thing as a map
$$
\Theta_{Y/X}^p :
f_*\Omega_{Y/S}^p
\longrightarrow
\Omega_{X/S}^p
$$
Recall that the relationship between $c^p_{Y/X} \otimes c_{Y/X}$
and $\Theta_{Y/X}^p$ uses the evaluation map
$f_*\omega_{Y/X} \to \mathcal{O}_X$
which sends $\tau_{Y/X}$ to $\text{Trace}_f(1)$, see
Discriminants, Section \ref{discriminant-section-finite-morphisms}.
Hence property (1) holds. Property (2) holds for base changes by
$X' \to X$ with $X'$ locally Noetherian because both $c^p_{Y/X}$ and
$c_{Y/X}$ are compatible with such base changes. For $f : Y \to X$
finite syntomic and $X$ locally Noetherian,
we will continue to denote $\Theta^p_{Y/X}$ the solution we've just found.

\medskip\noindent
Uniqueness. Suppose that we have a finite syntomic morphism
$f: Y \to X$ such that $X$ is smooth over $\Spec(\mathbf{Z})$
and $f$ is \'etale over a dense open of $X$. We claim that
in this case $\Theta^p_{Y/X}$ is uniquely determined by property (1).
Namely, consider the maps
$$
\Omega^p_{X/\mathbf{Z}} \otimes_{\mathcal{O}_X} f_*\mathcal{O}_Y \to
f_*\Omega^p_{Y/\mathbf{Z}} \to
\Omega^p_{X/\mathbf{Z}}
$$
The sheaf $\Omega^p_{X/\mathbf{Z}}$ is torsion free (by the assumed
smoothness), hence it suffices to check that the restriction of
$\Theta^p_{Y/X}$ is uniquely determined over the dense open over
which $f$ is \'etale, i.e., we may assume $f$ is \'etale.
However, if $f$ is \'etale, then
$f^*\Omega_{X/\mathbf{Z}} = \Omega_{Y/\mathbf{Z}}$
hence the first arrow in the displayed equation is an isomorphism.
Since we've pinned down the composition, this guarantees uniqueness.

\medskip\noindent
Let $f : Y \to X$ be a finite syntomic morphism of locally Noetherian schemes.
Let $x \in X$. By Discriminants, Lemma
\ref{discriminant-lemma-locally-comes-from-universal-finite}
we can find $d \geq 1$ and a commutative diagram
$$
\xymatrix{
Y \ar[d] &
V \ar[d] \ar[l] \ar[r] &
V_d \ar[d] \\
X &
U \ar[l] \ar[r] &
U_d
}
$$
such that $x \in U \subset X$ is open, $V = f^{-1}(U)$
and $V = U \times_{U_d} V_d$. Thus $\Theta^p_{Y/X}|_V$
is the pullback of the map $\Theta^p_{V_d/U_d}$.
However, by the discussion on uniqueness above and
Discriminants, Lemmas
\ref{discriminant-lemma-universal-finite-syntomic-smooth} and
\ref{discriminant-lemma-universal-finite-syntomic-etale}
the map $\Theta^p_{V_d/U_d}$ is uniquely determined
by the requirement (1). Hence uniqueness holds.

\medskip\noindent
At this point we know that we have existence and uniqueness
for all finite syntomic morphisms $Y \to X$ with $X$ locally Noetherian.
We could now give an argument similar to the proof of
Lemma \ref{lemma-Garel-upstairs} to extend to general $X$.
However, instead it possible to directly use absolute Noetherian approximation
to finish the proof. Namely, to construct $\Theta^p_{Y/X}$
it suffices to do so Zariski locally on $X$ (provided we also
show the uniqueness). Hence we may assume $X$ is affine (small
detail omitted). Then we can write $X = \lim_{i \in I} X_i$
as the limit over a directed set $I$ of Noetherian affine schemes.
By Algebra, Lemma \ref{algebra-lemma-colimit-category-fp-algebras}
we can find $0 \in I$ and a finitely
presented morphism of affines $f_0 : Y_0 \to X_0$ whose base change to
$X$ is $Y \to X$. After increasing $0$ we may assume $Y_0 \to X_0$
is finite and syntomic, see
Algebra, Lemma \ref{algebra-lemma-colimit-lci} and
\ref{algebra-lemma-colimit-finite}. For $i \geq 0$ also the
base change $f_i : Y_i = Y_0 \times_{X_0} X_i \to X_i$ is finite syntomic.
Then
$$
\Gamma(X, f_*\Omega^p_{Y/\mathbf{Z}}) =
\Gamma(Y, \Omega^p_{Y/\mathbf{Z}}) =
\colim_{i \geq 0} \Gamma(Y_i, \Omega^p_{Y_i/\mathbf{Z}}) =
\colim_{i \geq 0} \Gamma(X_i, f_{i, *}\Omega^p_{Y_i/\mathbf{Z}})
$$
Hence we can (and are forced to) define $\Theta^p_{Y/X}$ as the colimit
of the maps $\Theta^p_{Y_i/X_i}$. This map is compatible with any
cartesian diagram
$$
\xymatrix{
Y' \ar[r] \ar[d] & Y \ar[d] \\
X' \ar[r] & X
}
$$
with $X'$ affine as we know this for the case of Noetherian affine schemes
by the arguments given above (small detail omitted; hint: if we also
write $X' = \lim_{j \in J} X'_j$ then for every $i \in I$ there is a $j \in J$
and a morphism $X'_j \to X_i$ compatible with the morphism $X' \to X$).
This finishes the proof.
\end{proof}

\begin{proposition}
\label{proposition-Garel}
\begin{reference}
\cite{Garel}
\end{reference}
Let $f : Y \to X$ be a finite syntomic morphism of schemes.
The maps $\Theta^p_{Y/X}$ of Lemma \ref{lemma-Garel} define a map of complexes
$$
\Theta_{Y/X} :
f_*\Omega^\bullet_{Y/\mathbf{Z}}
\longrightarrow
\Omega^\bullet_{X/\mathbf{Z}}
$$
with the following properties
\begin{enumerate}
\item in degree $0$ we get
$\text{Trace}_f : f_*\mathcal{O}_Y \to \mathcal{O}_X$, see
Discriminants, Section \ref{discriminant-section-discriminant},
\item we have
$\Theta_{Y/X}(\omega \wedge \eta) = \omega \wedge \Theta_{Y/X}(\eta)$
for $\omega$ in $\Omega^\bullet_{X/S}$ and $\eta$
in $f_*\Omega^\bullet_{Y/S}$,
\item if $f$ is a morphism over a base scheme $S$, then
$\Theta_{Y/X}$ induces a map of complexes
$f_*\Omega^\bullet_{Y/S} \to \Omega^\bullet_{X/S}$.
\end{enumerate}
\end{proposition}

\begin{proof}
By Discriminants, Lemma
\ref{discriminant-lemma-locally-comes-from-universal-finite}
for every $x \in X$ we can find $d \geq 1$ and a commutative diagram
$$
\xymatrix{
Y \ar[d] &
V \ar[d] \ar[l] \ar[r] &
V_d \ar[d] \ar[r] &
Y_d = \Spec(B_d) \ar[d] \\
X &
U \ar[l] \ar[r] &
U_d \ar[r] &
X_d = \Spec(A_d)
}
$$
such that $x \in U \subset X$ is affine open, $V = f^{-1}(U)$
and $V = U \times_{U_d} V_d$. Write $U = \Spec(A)$ and $V = \Spec(B)$
and observe that $B = A \otimes_{A_d} B_d$ and recall that
$B_d = A_d e_1 \oplus \ldots \oplus A_d e_d$. Suppose we have
$a_1, \ldots, a_r \in A$ and $b_1, \ldots, b_s \in B$.
We may write $b_j = \sum a_{j, l} e_d$ with $a_{j, l} \in A$.
Set $N = r + sd$ and consider the factorizations
$$
\xymatrix{
V \ar[r] \ar[d] &
V' = \mathbf{A}^N \times V_d \ar[r] \ar[d] &
V_d \ar[d] \\
U \ar[r]&
U' = \mathbf{A}^N \times U_d \ar[r] &
U_d
}
$$
Here the horizontal lower right arrow is given by the morphism
$U \to U_d$ (from the earlier diagram) and the morphism
$U \to \mathbf{A}^N$ given by $a_1, \ldots, a_r, a_{1, 1}, \ldots, a_{s, d}$.
Then we see that the functions $a_1, \ldots, a_r$ are in the image of
$\Gamma(U', \mathcal{O}_{U'}) \to \Gamma(U, \mathcal{O}_U)$
and the functions $b_1, \ldots, b_s$ are in the image of
$\Gamma(V', \mathcal{O}_{V'}) \to \Gamma(V, \mathcal{O}_V)$.
In this way we see that for any finite collection of elements\footnote{After
all these elements will be finite sums of elements of the form
$a_0 \text{d}a_1 \wedge \ldots \wedge \text{d}a_i$ with
$a_0, \ldots, a_i \in A$ or finite sums of elements of the form
$b_0 \text{d}b_1 \wedge \ldots \wedge \text{d}b_j$ with
$b_0, \ldots, b_j \in B$.} of the groups
$$
\Gamma(V, \Omega^i_{Y/\mathbf{Z}}),\quad i = 0, 1, 2, \ldots
\quad\text{and}\quad
\Gamma(U, \Omega^j_{X/\mathbf{Z}}),\quad j = 0, 1, 2, \ldots
$$
we can find a factorizations $V \to V' \to V_d$ and
$U \to U' \to U_d$ with $V' = \mathbf{A}^N \times V_d$ and
$U' = \mathbf{A}^N \times U_d$ as above
such that these sections are the pullbacks of sections from
$$
\Gamma(V', \Omega^i_{V'/\mathbf{Z}}),\quad i = 0, 1, 2, \ldots
\quad\text{and}\quad
\Gamma(U', \Omega^j_{U'/\mathbf{Z}}),\quad j = 0, 1, 2, \ldots
$$
The upshot of this is that to check
$\text{d} \circ \Theta_{Y/X} = \Theta_{Y/X} \circ \text{d}$
it suffices to check this is true for $\Theta_{V'/U'}$.
Similarly, for property (2) of the lemma.

\medskip\noindent
By Discriminants, Lemmas
\ref{discriminant-lemma-universal-finite-syntomic-smooth} and
\ref{discriminant-lemma-universal-finite-syntomic-etale}
the scheme $U_d$ is smooth and the morphism $V_d \to U_d$
is \'etale over a dense open of $U_d$.
Hence the same is true for the morphism
$V' \to U'$. Since $\Omega_{U'/\mathbf{Z}}$ is locally free and hence
$\Omega^p_{U'/\mathbf{Z}}$ is torsion
free, it suffices to check the desired relations
after restricting to the open over which $V'$ is finite \'etale.
Then we may check the relations after a surjective \'etale
base change. Hence we may split the finite \'etale cover
and assume we are looking at a morphism of the form
$$
\coprod\nolimits_{i = 1, \ldots, d} W \longrightarrow W
$$
with $W$ smooth over $\mathbf{Z}$.
In this case any local properties of our construction are trivial to check
(provided they are true). This finishes the proof of (1) and (2).

\medskip\noindent
Finally, we observe that (3) follows from (2) because $\Omega_{Y/S}$
is the quotient of $\Omega_{Y/\mathbf{Z}}$ by the submodule
generated by pullbacks of local sections of $\Omega_{S/\mathbf{Z}}$.
\end{proof}

\begin{example}
\label{example-Garel}
Let $A$ be a ring. Let $f = x^d + \sum_{0 \leq i < d} a_{d - i} x^i \in A[x]$.
Let $B = A[x]/(f)$. By Proposition \ref{proposition-Garel}
we have a morphism of complexes
$$
\Theta_{B/A} : \Omega^\bullet_B \longrightarrow \Omega^\bullet_A
$$
In particular, if $t \in B$ denotes the image of $x \in A[x]$
we can consider the elements
$$
\Theta_{B/A}(t^i\text{d}t) \in \Omega^1_A,\quad i = 0, \ldots, d - 1
$$
What are these elements? By the same principle as used in the proof of
Proposition \ref{proposition-Garel} it suffices to compute this
in the universal case, i.e., when $A = \mathbf{Z}[a_1, \ldots, a_d]$
or even when $A$ is replaced by the fraction field
$\mathbf{Q}(a_1, \ldots, a_d)$. Writing symbolically
$$
f = \prod\nolimits_{i = 1, \ldots, d} (x - \alpha_i)
$$
we see that over $\mathbf{Q}(\alpha_1, \ldots, \alpha_d)$
the algebra $B$ becomes split:
$$
\mathbf{Q}(a_0, \ldots, a_{d - 1})[x]/(f) 
\longrightarrow
\prod\nolimits_{i = 1, \ldots, d} \mathbf{Q}(\alpha_1, \ldots, \alpha_d),
\quad
t \longmapsto (\alpha_1, \ldots, \alpha_d)
$$
Thus for example
$$
\Theta(\text{d}t) = \sum \text{d} \alpha_i = - \text{d}a_1
$$
Next, we have
$$
\Theta(t\text{d}t) = \sum \alpha_i \text{d}\alpha_i =
a_1 \text{d} a_1 - \text{d}a_2
$$
Next, we have
$$
\Theta(t^2\text{d}t) = \sum \alpha_i^2 \text{d}\alpha_i =
- a_1^2 \text{d} a_1 + a_1 \text{d}a_2 + a_2 \text{d}a_1 - \text{d}a_3
$$
(modulo calculation error), and so on. This suggests that
if $f(x) = x^d - a$ then
$$
\Theta_{B/A}(t^i\text{d}t) =
\left\{
\begin{matrix}
0 & \text{if} & i = 0, \ldots, d - 2 \\
\text{d}a & \text{if} & i = d - 1
\end{matrix}
\right.
$$
in $\Omega_A$. This is true for in this particular case one can do
the calculation for the extension $\mathbf{Q}(a)[x]/(x^d - a)$
to verify this directly.
\end{example}











\input{chapters}

\bibliography{my}
\bibliographystyle{amsalpha}

\end{document}
