\input{preamble}

% OK, start here
%
\begin{document}

\title{de Rham Cohomology; under construction}


\maketitle

\phantomsection
\label{section-phantom}

\tableofcontents

\section{Introduction}
\label{section-introduction}

\noindent
In this chapter we start with a discussion of the de Rham complex
of a ring map and we end with a proof that de Rham cohomology
defines a Weil cohomology theory when the base field has characteristic zero.




\section{The de Rham complex}
\label{section-de-rham-complex}

\noindent
Let $p : X \to S$ be a morphism of schemes. There is a complex
$$
\Omega^\bullet_{X/S} =
\mathcal{O}_{X/S} \to \Omega^1_{X/S} \to \Omega^2_{X/S} \to \ldots
$$
of $p^{-1}\mathcal{O}_S$-modules with
$\Omega^i_{X/S} = \wedge^i(\Omega_{X/S})$
placed in degree $i$ and differential determined by the rule
$\text{d}(g_0 \text{d}g_1 \wedge \ldots \wedge \text{d}g_p) =
\text{d}g_0 \wedge \text{d}g_1 \wedge \ldots \wedge \text{d}g_p$
on local sections.
See Modules, Section \ref{modules-section-de-rham-complex}.

\medskip\noindent
Given a commutative diagram
$$
\xymatrix{
X' \ar[r]_f \ar[d] & X \ar[d] \\
S' \ar[r] & S
}
$$
of schemes, there are canonical maps of complexes
$f^{-1}\Omega_{X/S}^\bullet \to \Omega^\bullet_{X'/S'}$ and
$\Omega_{X/S}^\bullet \to f_*\Omega^\bullet_{X'/S'}$.
See Modules, Section \ref{modules-section-de-rham-complex}.
Linearizing, for every $p$ we obtain a linear map
$f^*\Omega^p_{X/S} \to \Omega^p_{X'/S'}$.

\medskip\noindent
In particular, if $f : Y \to X$ be a morphism of schemes over
a base scheme $S$, then there is a map of complexes
$$
\Omega^\bullet_{X/S} \longrightarrow f_*\Omega^\bullet_{Y/S}
$$
Linearizing, we see that for every $p \geq 0$ we obtain a canonical map
$$
\Omega^p_{X/S} \otimes_{\mathcal{O}_X} f_*\mathcal{O}_Y
\longrightarrow
f_*\Omega^p_{Y/S}
$$

\begin{lemma}
\label{lemma-base-change-de-rham}
Let
$$
\xymatrix{
X' \ar[r]_f \ar[d] & X \ar[d] \\
S' \ar[r] & S
}
$$
be a cartesian diagram of schemes. Then the maps discussed
above induce isomorphisms
$f^*\Omega^p_{Y/X} \to \Omega^p_{Y'/X'}$.
\end{lemma}

\begin{proof}
Combine Morphisms, Lemma \ref{morphisms-lemma-base-change-differentials}
with the fact that formation of exterior power commutes with base change.
\end{proof}







\section{Comparing sheaves of differential forms}
\label{section-quasi-finite-syntomic}

\noindent
The goal of this section is to compare the sheaves
$\Omega^p_{X/\mathbf{Z}}$ and $\Omega^p_{Y/\mathbf{Z}}$
when given a locally quasi-finite syntomic morphism of schemes $f : Y \to X$.
The result will be applied in Section \ref{section-trace}
to the construction of the trace map on de Rham complexes if $f$ is finite.

\begin{lemma}
\label{lemma-funny-map}
Let $R$ be a ring and consider a commutative diagram
$$
\xymatrix{
0 \ar[r] &
K^0 \ar[r] &
L^0 \ar[r] &
M^0 \ar[r] & 0 \\
& & L^{-1} \ar[u]_\partial \ar@{=}[r] &
M^{-1} \ar[u]
}
$$
of $R$-modules with exact top row and $M^0$ and $M^{-1}$
finite free of the same rank. Then there are canonical maps
$$
\wedge^i(H^0(L^\bullet)) \longrightarrow \wedge^i(K^0) \otimes_R \det(M^\bullet)
$$
whose composition with $\wedge^i(K^0) \to \wedge^i(H^0(L^\bullet))$
is equal to multiplication with $\delta(M^\bullet)$.
\end{lemma}

\begin{proof}
Say $M^0$ and $M^{-1}$ are free of rank $n$. For every $i \geq 0$
there is a canonical surjection
$$
\pi_i :
\wedge^{n + i}(L^0)
\longrightarrow
\wedge^i(K^0) \otimes \wedge^n(M^0)
$$
whose kernel is the submodule generated by wedges
$l_1 \wedge \ldots \wedge l_{n + i}$ such that $> i$ of the
$l_j$ are in $K^0$. On the other hand, the exact sequence
$$
L^{-1} \to L^0 \to H^0(L^\bullet) \to 0
$$
similarly produces canonical maps
$$
\wedge^i(H^0(L^\bullet)) \otimes \wedge^n(L^{-1})
\longrightarrow
\wedge^{n + i}(L^0)
$$
by sending $\eta \otimes \theta$ to $\tilde \eta \wedge \partial(\theta)$
where $\tilde \eta \in \wedge^i(L^0)$ is a lift of $\eta$.
The composition of these two maps, combined with the identification
$\wedge^n(L^{-1}) = \wedge^n(M^{-1})$ gives a map
$$
\wedge^i(H^0(L^\bullet)) \otimes \wedge^n(M^{-1})
\longrightarrow
\wedge^i(K^0) \otimes \wedge^n(M^0)
$$
Since $\det(M^\bullet) = \wedge^n(M^0) \otimes
(\wedge^n(M^{-1}))^{\otimes -1}$ this produces a map as
in the statement of the lemma.
If $\eta$ is the image of $\omega \in \wedge^i(K^0)$, then we see
that $\theta \otimes \eta$ is mapped to
$\pi_i(\omega \wedge \partial(\theta)) = \omega \otimes \overline{\theta}$ in
$\wedge^i(K^0) \otimes \wedge^n(M^0)$ where $\overline{\theta}$
is the image of $\theta$ in $\wedge^n(M^0)$. Since
$\delta(M^\bullet)$ is simply the determinant of the map
$M^{-1} \to M^0$ this proves the last statement.
\end{proof}

\begin{remark}
\label{remark-local-description}
Let $A$ be a ring. Let $P = A[x_1, \ldots, x_n]$. Let
$f_1, \ldots, f_n \in P$ and set $B = P/(f_1, \ldots, f_n)$.
Assume $A \to B$ is quasi-finite. Then
$B$ is a relative global complete intersection over $A$ (Algebra, Definition
\ref{algebra-definition-relative-global-complete-intersection}) and
$(f_1, \ldots, f_n)/(f_1, \ldots, f_n)^2$ is free with generators
the classes $\overline{f}_i$ by Algebra, Lemma
\ref{algebra-lemma-relative-global-complete-intersection-conormal}.
Consider the following diagram
$$
\xymatrix{
\Omega_{A/\mathbf{Z}} \otimes_A B \ar[r] &
\Omega_{P/\mathbf{Z}} \otimes_P B \ar[r] &
\Omega_{P/A} \otimes_P B \\
&
(f_1, \ldots, f_n)/(f_1, \ldots, f_n)^2 \ar[u] \ar@{=}[r] &
(f_1, \ldots, f_n)/(f_1, \ldots, f_n)^2 \ar[u]
}
$$
The left column represents $\NL_{B/A}$ in $D(B)$. The middle column represents
$\NL_{B/\mathbf{Z}}$ and hence has cohomology $\Omega_{B/\mathbf{Z}}$
in degree $0$. The top row is the split short exact sequence
$0 \to \Omega_{A/\mathbf{Z}} \otimes_A B \to
\Omega_{P/\mathbf{Z}} \otimes_P B \to \Omega_{P/A} \otimes_P B \to 0$.
Thus by Lemma \ref{lemma-funny-map} we obtain canonical $B$-module maps
$$
\Omega^p_{B/\mathbf{Z}} \longrightarrow
\Omega^p_{A/\mathbf{Z}} \otimes_A \det(\NL_{B/A})
$$
whose composition with
$\Omega^p_{A/\mathbf{Z}} \to \Omega^p_{B/\mathbf{Z}}$
is multiplication by $\delta(\NL_{B/A})$.
\end{remark}

\begin{lemma}
\label{lemma-Garel-upstairs}
There exists a unique rule that to every locally quasi-finite syntomic
morphism of schemes $f : Y \to X$ assigns $\mathcal{O}_Y$-module maps
$$
c^p_{Y/X} :
\Omega^p_{Y/\mathbf{Z}}
\longrightarrow
f^*\Omega^p_{X/\mathbf{Z}} \otimes_{\mathcal{O}_Y} \det(\NL_{Y/X})
$$
satisfying the following two properties
\begin{enumerate}
\item the composition with
$f^*\Omega^p_{X/\mathbf{Z}} \to \Omega^p_{Y/\mathbf{Z}}$
is multiplication by $\delta(\NL_{Y/X})$, and
\item the rule is compatible with restriction to opens and with
base change.
\end{enumerate}
\end{lemma}

\begin{proof}
This proof is very similar to the proof of
Discriminants, Proposition \ref{discriminant-proposition-tate-map}
and we suggest the reader look at that proof first.
We fix $p \geq 0$ throughout the proof.

\medskip\noindent
Let us reformulate the statement. Consider the category
$\mathcal{C}$ whose objects, denoted $Y/X$, are locally quasi-finite syntomic
morphism $f : Y \to X$ of schemes and whose morphisms
$b/a : Y'/X' \to Y/X$ are commutative diagrams
$$
\xymatrix{
Y' \ar[d]_{f'} \ar[r]_b & Y \ar[d]^f \\
X' \ar[r]^a & X
}
$$
which induce an isomorphism of $Y'$ with an open subscheme of
$X' \times_X Y$. The lemma means that for every object
$Y/X$ of $\mathcal{C}$ we have maps $c^p_{Y/X}$ with property (1)
and for every morphism $b/a : Y'/X' \to Y/X$ of $\mathcal{C}$ we have
$b^*c^p_{Y/X} = c^p_{Y'/X'}$ via the identifications
$b^*\det(\NL_{Y/X}) = \det(\NL_{Y'/X'})$
(Discriminants, Section \ref{discriminant-section-tate-map})
and $b^*\Omega^p_{Y/X} = \Omega^p_{Y'/X'}$
(Lemma \ref{lemma-base-change-de-rham}).

\medskip\noindent
Given $Y/X$ in $\mathcal{C}$ and $y \in Y$ we can find
an affine open $V \subset Y$ and $U \subset X$ with $f(V) \subset U$
such that there exists some maps
$$
\Omega^p_{Y/\mathbf{Z}}|_V
\longrightarrow
\left(
f^*\Omega^p_{X/\mathbf{Z}} \otimes_{\mathcal{O}_Y} \det(\NL_{Y/X})
\right)|_V
$$
with property (1). This follows
from picking affine opens as in
Discriminants, Lemma \ref{discriminant-lemma-syntomic-quasi-finite} part (5)
and Remark \ref{remark-local-description}.
If $\Omega^p_{X/\mathbf{Z}}$ is finite locally free and
annihilator of the section $\delta(\NL_{Y/X})$ is zero, then
these local maps are unique and automatically glue!

\medskip\noindent
Let $\mathcal{C}_{nice} \subset \mathcal{C}$ denote the full subcategory
of $Y/X$ such that
\begin{enumerate}
\item $X$ is of finite type over $\mathbf{Z}$,
\item $\Omega_{X/\mathbf{Z}}$ is locally free, and
\item  the annihilator of $\delta(\NL_{Y/X})$ is zero.
\end{enumerate}
By the remarks in the previous paragraph, we see that for any
object $Y/X$ of $\mathcal{C}_{nice}$ we have a unique map
$c^p_{Y/X}$ satisfying condition (1). If $b/a : Y'/X' \to Y/X$
is a morphism of $\mathcal{C}_{nice}$, then
$b^*c^p_{Y/X}$ is equal to $c^p_{Y'/X'}$ because
$b^*\delta(\NL_{Y/X}) = \delta(\NL_{Y'/X'})$ (see
Discriminants, Section \ref{discriminant-section-tate-map}).
In other words, we have solved the problem
on the full subcategory $\mathcal{C}_{nice}$. For $Y/X$ in $\mathcal{C}_{nice}$
we continue to denote $c^p_{Y/X}$ the solution we've just found.

\medskip\noindent
Consider morphisms
$$
Y_1/X_1 \xleftarrow{b_1/a_1} Y/X \xrightarrow{b_2/a_2} Y_2/X_2
$$
in $\mathcal{C}$ such that $Y_1/X_1$ and $Y_2/X_2$ are objects
of $\mathcal{C}_{nice}$.
{\bf Claim.} $b_1^*c^p_{Y_1/X_1} = b_2^*c^p_{Y_2/X_2}$.
We will first show that the claim implies the lemma
and then we will prove the claim.

\medskip\noindent
Let $d, n \geq 1$ and consider the locally
quasi-finite syntomic morphism $Y_{n, d} \to X_{n, d}$
constructed in Discriminants, Example
\ref{discriminant-example-universal-quasi-finite-syntomic}.
Then $Y_{n, d}$ and $Y_{n, d}$ are irreducible schemes of finite type and
smooth over $\mathbf{Z}$. Namely, $X_{n, d}$ is a spectrum of a
polynomial ring over $\mathbf{Z}$ and $Y_{n, d}$ is an open subscheme
of such. The morphism $Y_{n, d} \to X_{n, d}$ is locally quasi-finite syntomic
and \'etale over a dense open, see Discriminants, Lemma
\ref{discriminant-lemma-universal-quasi-finite-syntomic-etale}.
Thus $\delta(\NL_{Y_{n, d}/X_{n, d}})$ is nonzero: for example we have
the local description of $\delta(\NL_{Y/X})$ in
Discriminants, Remark \ref{discriminant-remark-local-description-delta}
and we have the local description of \'etale morphisms in
Morphisms, Lemma \ref{morphisms-lemma-etale-at-point} part (8).
Now a nonzero section of an invertible module over an irreducible
regular scheme has vanishing annihilator. Thus
$Y_{n, d}/X_{n, d}$ is an object of $\mathcal{C}_{nice}$.

\medskip\noindent
Let $Y/X$ be an arbitrary object of $\mathcal{C}$. Let $y \in Y$.
By Discriminants, Lemma \ref{discriminant-lemma-locally-comes-from-universal}
we can find $n, d \geq 1$ and morphisms
$$
Y/X \leftarrow V/U \xrightarrow{b/a} Y_{n, d}/X_{n, d}
$$
of $\mathcal{C}$ such that $V \subset Y$ and $U \subset X$ are open.
Thus we can pullback the canonical morphism $c^p_{Y_{n, d}/X_{n, d}}$
constructed above by $b$ to $V$. The claim guarantees these local
isomorphisms glue! Thus we get a well defined global maps
$c^p_{Y/X}$ with property (1).
If $b/a : Y'/X' \to Y/X$ is a morphism of $\mathcal{C}$, then
the claim also implies that the similarly constructed map
$c^p_{Y'/X'}$ is the pullback by $b$ of the locally constructed
map $c^p_{Y/X}$. Thus it remains to prove the claim.

\medskip\noindent
In the rest of the proof we prove the claim. We may pick a point
$y \in Y$ and prove the maps agree in an open neighbourhood of $y$.
Thus we may replace $Y_1$, $Y_2$ by open neighbourhoods of the
image of $y$ in $Y_1$ and $Y_2$. Thus we may assume
$Y, X, Y_1, X_1, Y_2, X_2$ are affine.
We may write $X = \lim X_\lambda$ as a cofiltered limit of affine
schemes of finite type over $X_1 \times X_2$. For each $\lambda$
we get
$$
Y_1 \times_{X_1} X_\lambda
\quad\text{and}\quad
X_\lambda \times_{X_2} Y_2
$$
If we take limits we obtain
$$
\lim Y_1 \times_{X_1} X_\lambda =
Y_1 \times_{X_1} X \supset Y \subset
X \times_{X_2} Y_2 = \lim X_\lambda \times_{X_2} Y_2
$$
By Limits, Lemma \ref{limits-lemma-descend-opens}
we can find a $\lambda$ and opens
$V_{1, \lambda} \subset Y_1 \times_{X_1} X_\lambda$ and
$V_{2, \lambda} \subset X_\lambda \times_{X_2} Y_2$
whose base change to $X$ recovers $Y$ (on both sides).
After increasing $\lambda$ we may assume
there is an isomorphism
$V_{1, \lambda} \to V_{2, \lambda}$ whose base change to $X$ is the
identity on $Y$, see
Limits, Lemma \ref{limits-lemma-descend-finite-presentation}.
Then we have the commutative diagram
$$
\xymatrix{
& Y/X \ar[d] \ar[ld]_{b_1/a_1} \ar[rd]^{b_2/a_2} \\
Y_1/X_1 & V_{1, \lambda}/X_\lambda \ar[l] \ar[r] & Y_2/X_2
}
$$
Thus it suffices to prove the claim for the lower row
of the diagram and we reduce to the case discussed in the
next paragraph.

\medskip\noindent
Assume $Y, X, Y_1, X_1, Y_2, X_2$ are affine of finite type over $\mathbf{Z}$.
Write $X = \Spec(A)$, $X_i = \Spec(A_i)$. The ring map $A_1 \to A$ corresponding
to $X \to X_1$ is of finite type and hence we may choose a surjection
$A_1[x_1, \ldots, x_n] \to A$. Similarly, we may choose a surjection
$A_2[y_1, \ldots, y_m] \to A$. Set $X'_1 = \Spec(A_1[x_1, \ldots, x_n])$
and $X'_2 = \Spec(A_2[y_1, \ldots, y_m])$. Observe that
$\Omega_{X'_1/\mathbf{Z}}$ is the direct sum of the pullback of
$\Omega_{X_1/\mathbf{Z}}$ and a finite free module.
Similarly for $X'_2$. Set $Y'_1 = Y_1 \times_{X_1} X'_1$ and
$Y'_2 = Y_2 \times_{X_2} X'_2$. We get the following diagram
$$
Y_1/X_1 \leftarrow
Y'_1/X'_1 \leftarrow
Y/X
\rightarrow Y'_2/X'_2
\rightarrow Y_2/X_2
$$
Since $X'_1 \to X_1$ and $X'_2 \to X_2$ are flat, the same is true
for $Y'_1 \to Y_1$ and $Y'_2 \to Y_2$. It follows easily that the
annihilators of $\delta(\NL_{Y'_1/X'_1})$ and $\delta(\NL_{Y'_2/X'_2})$
are zero.
Hence $Y'_1/X'_1$ and $Y'_2/X'_2$ are in $\mathcal{C}_{nice}$.
Thus the outer morphisms in the displayed diagram are morphisms
of $\mathcal{C}_{nice}$ for which we know the desired compatibilities.
Thus it suffices to prove the claim for
$Y'_1/X'_1 \leftarrow Y/X \rightarrow Y'_2/X'_2$. This reduces us
to the case discussed in the next paragraph.

\medskip\noindent
Assume $Y, X, Y_1, X_1, Y_2, X_2$ are affine of finite type over
$\mathbf{Z}$ and $X \to X_1$ and $X \to X_2$ are closed immersions.
Consider the open embeddings
$Y_1 \times_{X_1} X \supset Y \subset X \times_{X_2} Y_2$.
There is an open neighbourhood $V \subset Y$ of $y$ which is a
standard open of both $Y_1 \times_{X_1} X$ and $X \times_{X_2} Y_2$.
This follows from Schemes, Lemma \ref{schemes-lemma-standard-open-two-affines}
applied to the scheme obtained by glueing $Y_1 \times_{X_1} X$ and
$X \times_{X_2} Y_2$ along $Y$; details omitted.
Since $X \times_{X_2} Y_2$ is a closed subscheme of $Y_2$
we can find a standard open $V_2 \subset Y_2$ such that
$V_2 \times_{X_2} X = V$. Similarly, we can find a standard open
$V_1 \subset Y_1$ such that $V_1 \times_{X_1} X = V$.
After replacing $Y, Y_1, Y_2$ by $V, V_1, V_2$ we reduce to the
case discussed in the next paragraph.

\medskip\noindent
Assume $Y, X, Y_1, X_1, Y_2, X_2$ are affine of finite type over
$\mathbf{Z}$ and $X \to X_1$ and $X \to X_2$ are closed immersions
and $Y_1 \times_{X_1} X = Y = X \times_{X_2} Y_2$.
Write $X = \Spec(A)$, $X_i = \Spec(A_i)$, $Y = \Spec(B)$,
$Y_i = \Spec(B_i)$. Then we can consider the affine schemes
$$
X' = \Spec(A_1 \times_A A_2) = \Spec(A')
\quad\text{and}\quad
Y' = \Spec(B_1 \times_B B_2) = \Spec(B')
$$
Observe that $X' = X_1 \amalg_X X_2$ and $Y' = Y_1 \amalg_Y Y_2$, see
More on Morphisms, Lemma \ref{more-morphisms-lemma-basic-example-pushout}.
By More on Algebra, Lemma \ref{more-algebra-lemma-fibre-product-finite-type}
the rings $A'$ and $B'$ are of finite type over $\mathbf{Z}$. By
More on Algebra, Lemma \ref{more-algebra-lemma-module-over-fibre-product}
we have $B' \otimes_A A_1 = B_1$ and $B' \times_A A_2 = B_2$.
In particular a fibre of $Y' \to X'$ over a point of
$X' = X_1 \amalg_X X_2$ is always equal to either a fibre of $Y_1 \to X_1$
or a fibre of $Y_2 \to X_2$. By More on Algebra, Lemma
\ref{more-algebra-lemma-flat-module-over-fibre-product}
the ring map $A' \to B'$ is flat. Thus by Discriminants, Lemma
\ref{discriminant-lemma-syntomic-quasi-finite} part (3)
we conclude that $Y'/X'$ is an object of $\mathcal{C}$.
Consider now the commutative diagram
$$
\xymatrix{
& Y/X \ar[ld]_{b_1/a_1} \ar[rd]^{b_2/a_2} \\
Y_1/X_1 \ar[rd] & & Y_2/X_2 \ar[ld] \\
& Y'/X'
}
$$
Now we would be done if $Y'/X'$ is an object of $\mathcal{C}_{nice}$,
but this is almost never the case. Namely, then pulling back $c^p_{Y'/X'}$
around the two sides of the square, we would obtain the desired conclusion.
To get around the problem that $Y'/X'$ is not in $\mathcal{C}_{nice}$
we note the arguments above show that, after possibly shrinking all
of the schemes $X, Y, X_1, Y_1, X_2, Y_2, X', Y'$ we can find some
$n, d \geq 1$, and extend the diagram like so:
$$
\xymatrix{
& Y/X \ar[ld]_{b_1/a_1} \ar[rd]^{b_2/a_2} \\
Y_1/X_1 \ar[rd] & & Y_2/X_2 \ar[ld] \\
& Y'/X' \ar[d] \\
& Y_{n, d}/X_{n, d}
}
$$
and then we can use the already given argument by pulling
back from $c^p_{Y_{n, d}/X_{n, d}}$. This finishes the proof.
\end{proof}








\section{Trace maps on de Rham complexes}
\label{section-trace}

\noindent
A reference for some of the material in this section is \cite{Garel}.
Let $S$ be a scheme. Let $f : Y \to X$ be a finite locally free morphism
of schemes over $S$. Then there is a trace map
$\text{Trace}_f : f_*\mathcal{O}_Y \to \mathcal{O}_X$, see
Discriminants, Section \ref{discriminant-section-discriminant}.
In this situation a trace map on de Rham complexes is a map
of complexes
$$
\Theta_{Y/X} : f_*\Omega^\bullet_{Y/S} \longrightarrow \Omega^\bullet_{X/S}
$$
such that $\Theta_{Y/X}$ is equal to $\text{Trace}_f$ in degree $0$
and satisfies
$$
\Theta_{Y/X}(\omega \wedge \eta) = \omega \wedge \Theta_{Y/X}(\eta)
$$
for local sections $\omega$ of $\Omega^\bullet_{X/S}$ and $\eta$
of $f_*\Omega^\bullet_{Y/S}$. It is not clear to us whether such a trace map
$\Theta_{Y/X}$ exists for every finite locally free morphism $Y \to X$;
please email
\href{mailto:stacks.project@gmail.com}{stacks.project@gmail.com}
if you have a counterexample or a proof.

\begin{example}
\label{example-no-trace}
Here is an example where we do not have a trace map on de Rham complexes.
For example, consider the $\mathbf{C}$-algebra $B = \mathbf{C}[x, y]$ with
action of $G = \{\pm 1\}$ given by $x \mapsto -x$ and $y \mapsto -y$.
The invariants $A = B^G$ form a normal domain of finite type over $\mathbf{C}$
generated by $x^2, xy, y^2$. We claim that for the inclusion $A \subset B$
there is no reasonable trace map
$\Omega_{B/\mathbf{C}} \to \Omega_{A/\mathbf{C}}$
on $1$-forms. Namely, consider the element
$\omega = x \text{d} y \in \Omega_{B/\mathbf{C}}$.
Since $\omega$ is invariant under the action of $G$ if a ``reasonable''
trace map exists, then $2\omega$ should be in the image of
$\Omega_{A/\mathbf{C}} \to \Omega_{B/\mathbf{C}}$. This is
not the case: there is no way to write $2\omega$ as a linear
combination of $\text{d}(x^2)$, $\text{d}(xy)$, and $\text{d}(y^2)$
even with coefficients in $B$.
This example contradicts the main theorem in
\cite{Zannier}.
\end{example}

\begin{lemma}
\label{lemma-Garel}
There exists a unique rule that to every finite syntomic
morphism of schemes $f : Y \to X$ assigns $\mathcal{O}_X$-module maps
$$
\Theta^p_{Y/X} :
f_*\Omega^p_{Y/\mathbf{Z}}
\longrightarrow
\Omega^p_{X/\mathbf{Z}}
$$
satisfying the following properties
\begin{enumerate}
\item the composition with
$\Omega^p_{X/\mathbf{Z}} \otimes_{\mathcal{O}_X} f_*\mathcal{O}_Y
\to f_*\Omega^p_{Y/\mathbf{Z}}$ is equal to
$\text{id} \otimes \text{Trace}_f$
where $\text{Trace}_f : f_*\mathcal{O}_Y \to \mathcal{O}_X$
is the map from
Discriminants, Section \ref{discriminant-section-discriminant},
\item the rule is compatible with base change.
\end{enumerate}
\end{lemma}

\begin{proof}
First, assume that $X$ is locally Noetherian. By
Lemma \ref{lemma-Garel-upstairs} we have a canonical map
$$
c^p_{Y/X} : \Omega_{Y/S}^p
\longrightarrow
f^*\Omega_{X/S}^p \otimes_{\mathcal{O}_Y} \det(\NL_{Y/X})
$$
By Discriminants, Proposition \ref{discriminant-proposition-tate-map}
we have a canonical isomorphism
$$
c_{Y/X} : \det(\NL_{Y/X}) \to \omega_{Y/X}
$$
mapping $\delta(\NL_{Y/X})$ to $\tau_{Y/X}$. Combined these maps give
$$
c^p_{Y/X} \otimes c_{Y/X} :
\Omega_{Y/S}^p
\longrightarrow
f^*\Omega_{X/S}^p \otimes_{\mathcal{O}_Y} \omega_{Y/X}
$$
By Discriminants, Section \ref{discriminant-section-finite-morphisms}
this is the same thing as a map
$$
\Theta_{Y/X}^p :
f_*\Omega_{Y/S}^p
\longrightarrow
\Omega_{X/S}^p
$$
Recall that the relationship between $c^p_{Y/X} \otimes c_{Y/X}$
and $\Theta_{Y/X}^p$ uses the evaluation map
$f_*\omega_{Y/X} \to \mathcal{O}_X$
which sends $\tau_{Y/X}$ to $\text{Trace}_f(1)$, see
Discriminants, Section \ref{discriminant-section-finite-morphisms}.
Hence property (1) holds. Property (2) holds for base changes by
$X' \to X$ with $X'$ locally Noetherian because both $c^p_{Y/X}$ and
$c_{Y/X}$ are compatible with such base changes. For $f : Y \to X$
finite syntomic and $X$ locally Noetherian,
we will continue to denote $\Theta^p_{Y/X}$ the solution we've just found.

\medskip\noindent
Uniqueness. Suppose that we have a finite syntomic morphism
$f: Y \to X$ such that $X$ is smooth over $\Spec(\mathbf{Z})$
and $f$ is \'etale over a dense open of $X$. We claim that
in this case $\Theta^p_{Y/X}$ is uniquely determined by property (1).
Namely, consider the maps
$$
\Omega^p_{X/\mathbf{Z}} \otimes_{\mathcal{O}_X} f_*\mathcal{O}_Y \to
f_*\Omega^p_{Y/\mathbf{Z}} \to
\Omega^p_{X/\mathbf{Z}}
$$
The sheaf $\Omega^p_{X/\mathbf{Z}}$ is torsion free (by the assumed
smoothness), hence it suffices to check that the restriction of
$\Theta^p_{Y/X}$ is uniquely determined over the dense open over
which $f$ is \'etale, i.e., we may assume $f$ is \'etale.
However, if $f$ is \'etale, then
$f^*\Omega_{X/\mathbf{Z}} = \Omega_{Y/\mathbf{Z}}$
hence the first arrow in the displayed equation is an isomorphism.
Since we've pinned down the composition, this guarantees uniqueness.

\medskip\noindent
Let $f : Y \to X$ be a finite syntomic morphism of locally Noetherian schemes.
Let $x \in X$. By Discriminants, Lemma
\ref{discriminant-lemma-locally-comes-from-universal-finite}
we can find $d \geq 1$ and a commutative diagram
$$
\xymatrix{
Y \ar[d] &
V \ar[d] \ar[l] \ar[r] &
V_d \ar[d] \\
X &
U \ar[l] \ar[r] &
U_d
}
$$
such that $x \in U \subset X$ is open, $V = f^{-1}(U)$
and $V = U \times_{U_d} V_d$. Thus $\Theta^p_{Y/X}|_V$
is the pullback of the map $\Theta^p_{V_d/U_d}$.
However, by the discussion on uniqueness above and
Discriminants, Lemmas
\ref{discriminant-lemma-universal-finite-syntomic-smooth} and
\ref{discriminant-lemma-universal-finite-syntomic-etale}
the map $\Theta^p_{V_d/U_d}$ is uniquely determined
by the requirement (1). Hence uniqueness holds.

\medskip\noindent
At this point we know that we have existence and uniqueness
for all finite syntomic morphisms $Y \to X$ with $X$ locally Noetherian.
We could now give an argument similar to the proof of
Lemma \ref{lemma-Garel-upstairs} to extend to general $X$.
However, instead it possible to directly use absolute Noetherian approximation
to finish the proof. Namely, to construct $\Theta^p_{Y/X}$
it suffices to do so Zariski locally on $X$ (provided we also
show the uniqueness). Hence we may assume $X$ is affine (small
detail omitted). Then we can write $X = \lim_{i \in I} X_i$
as the limit over a directed set $I$ of Noetherian affine schemes.
By Algebra, Lemma \ref{algebra-lemma-colimit-category-fp-algebras}
we can find $0 \in I$ and a finitely
presented morphism of affines $f_0 : Y_0 \to X_0$ whose base change to
$X$ is $Y \to X$. After increasing $0$ we may assume $Y_0 \to X_0$
is finite and syntomic, see
Algebra, Lemma \ref{algebra-lemma-colimit-lci} and
\ref{algebra-lemma-colimit-finite}. For $i \geq 0$ also the
base change $f_i : Y_i = Y_0 \times_{X_0} X_i \to X_i$ is finite syntomic.
Then
$$
\Gamma(X, f_*\Omega^p_{Y/\mathbf{Z}}) =
\Gamma(Y, \Omega^p_{Y/\mathbf{Z}}) =
\colim_{i \geq 0} \Gamma(Y_i, \Omega^p_{Y_i/\mathbf{Z}}) =
\colim_{i \geq 0} \Gamma(X_i, f_{i, *}\Omega^p_{Y_i/\mathbf{Z}})
$$
Hence we can (and are forced to) define $\Theta^p_{Y/X}$ as the colimit
of the maps $\Theta^p_{Y_i/X_i}$. This map is compatible with any
cartesian diagram
$$
\xymatrix{
Y' \ar[r] \ar[d] & Y \ar[d] \\
X' \ar[r] & X
}
$$
with $X'$ affine as we know this for the case of Noetherian affine schemes
by the arguments given above (small detail omitted; hint: if we also
write $X' = \lim_{j \in J} X'_j$ then for every $i \in I$ there is a $j \in J$
and a morphism $X'_j \to X_i$ compatible with the morphism $X' \to X$).
This finishes the proof.
\end{proof}

\begin{proposition}
\label{proposition-Garel}
\begin{reference}
\cite{Garel}
\end{reference}
Let $f : Y \to X$ be a finite syntomic morphism of schemes.
The maps $\Theta^p_{Y/X}$ of Lemma \ref{lemma-Garel} define a map of complexes
$$
\Theta_{Y/X} :
f_*\Omega^\bullet_{Y/\mathbf{Z}}
\longrightarrow
\Omega^\bullet_{X/\mathbf{Z}}
$$
with the following properties
\begin{enumerate}
\item in degree $0$ we get
$\text{Trace}_f : f_*\mathcal{O}_Y \to \mathcal{O}_X$, see
Discriminants, Section \ref{discriminant-section-discriminant},
\item we have
$\Theta_{Y/X}(\omega \wedge \eta) = \omega \wedge \Theta_{Y/X}(\eta)$
for $\omega$ in $\Omega^\bullet_{X/S}$ and $\eta$
in $f_*\Omega^\bullet_{Y/S}$,
\item if $f$ is a morphism over a base scheme $S$, then
$\Theta_{Y/X}$ induces a map of complexes
$f_*\Omega^\bullet_{Y/S} \to \Omega^\bullet_{X/S}$.
\end{enumerate}
\end{proposition}

\begin{proof}
By Discriminants, Lemma
\ref{discriminant-lemma-locally-comes-from-universal-finite}
for every $x \in X$ we can find $d \geq 1$ and a commutative diagram
$$
\xymatrix{
Y \ar[d] &
V \ar[d] \ar[l] \ar[r] &
V_d \ar[d] \ar[r] &
Y_d = \Spec(B_d) \ar[d] \\
X &
U \ar[l] \ar[r] &
U_d \ar[r] &
X_d = \Spec(A_d)
}
$$
such that $x \in U \subset X$ is affine open, $V = f^{-1}(U)$
and $V = U \times_{U_d} V_d$. Write $U = \Spec(A)$ and $V = \Spec(B)$
and observe that $B = A \otimes_{A_d} B_d$ and recall that
$B_d = A_d e_1 \oplus \ldots \oplus A_d e_d$. Suppose we have
$a_1, \ldots, a_r \in A$ and $b_1, \ldots, b_s \in B$.
We may write $b_j = \sum a_{j, l} e_d$ with $a_{j, l} \in A$.
Set $N = r + sd$ and consider the factorizations
$$
\xymatrix{
V \ar[r] \ar[d] &
V' = \mathbf{A}^N \times V_d \ar[r] \ar[d] &
V_d \ar[d] \\
U \ar[r]&
U' = \mathbf{A}^N \times U_d \ar[r] &
U_d
}
$$
Here the horizontal lower right arrow is given by the morphism
$U \to U_d$ (from the earlier diagram) and the morphism
$U \to \mathbf{A}^N$ given by $a_1, \ldots, a_r, a_{1, 1}, \ldots, a_{s, d}$.
Then we see that the functions $a_1, \ldots, a_r$ are in the image of
$\Gamma(U', \mathcal{O}_{U'}) \to \Gamma(U, \mathcal{O}_U)$
and the functions $b_1, \ldots, b_s$ are in the image of
$\Gamma(V', \mathcal{O}_{V'}) \to \Gamma(V, \mathcal{O}_V)$.
In this way we see that for any finite collection of elements\footnote{After
all these elements will be finite sums of elements of the form
$a_0 \text{d}a_1 \wedge \ldots \wedge \text{d}a_i$ with
$a_0, \ldots, a_i \in A$ or finite sums of elements of the form
$b_0 \text{d}b_1 \wedge \ldots \wedge \text{d}b_j$ with
$b_0, \ldots, b_j \in B$.} of the groups
$$
\Gamma(V, \Omega^i_{Y/\mathbf{Z}}),\quad i = 0, 1, 2, \ldots
\quad\text{and}\quad
\Gamma(U, \Omega^j_{X/\mathbf{Z}}),\quad j = 0, 1, 2, \ldots
$$
we can find a factorizations $V \to V' \to V_d$ and
$U \to U' \to U_d$ with $V' = \mathbf{A}^N \times V_d$ and
$U' = \mathbf{A}^N \times U_d$ as above
such that these sections are the pullbacks of sections from
$$
\Gamma(V', \Omega^i_{V'/\mathbf{Z}}),\quad i = 0, 1, 2, \ldots
\quad\text{and}\quad
\Gamma(U', \Omega^j_{U'/\mathbf{Z}}),\quad j = 0, 1, 2, \ldots
$$
The upshot of this is that to check
$\text{d} \circ \Theta_{Y/X} = \Theta_{Y/X} \circ \text{d}$
it suffices to check this is true for $\Theta_{V'/U'}$.
Similarly, for property (2) of the lemma.

\medskip\noindent
By Discriminants, Lemmas
\ref{discriminant-lemma-universal-finite-syntomic-smooth} and
\ref{discriminant-lemma-universal-finite-syntomic-etale}
the scheme $U_d$ is smooth and the morphism $V_d \to U_d$
is \'etale over a dense open of $U_d$.
Hence the same is true for the morphism
$V' \to U'$. Since $\Omega_{U'/\mathbf{Z}}$ is locally free and hence
$\Omega^p_{U'/\mathbf{Z}}$ is torsion
free, it suffices to check the desired relations
after restricting to the open over which $V'$ is finite \'etale.
Then we may check the relations after a surjective \'etale
base change. Hence we may split the finite \'etale cover
and assume we are looking at a morphism of the form
$$
\coprod\nolimits_{i = 1, \ldots, d} W \longrightarrow W
$$
with $W$ smooth over $\mathbf{Z}$.
In this case any local properties of our construction are trivial to check
(provided they are true). This finishes the proof of (1) and (2).

\medskip\noindent
Finally, we observe that (3) follows from (2) because $\Omega_{Y/S}$
is the quotient of $\Omega_{Y/\mathbf{Z}}$ by the submodule
generated by pullbacks of local sections of $\Omega_{S/\mathbf{Z}}$.
\end{proof}

\begin{example}
\label{example-Garel}
Let $A$ be a ring. Let $f = x^d + \sum_{0 \leq i < d} a_{d - i} x^i \in A[x]$.
Let $B = A[x]/(f)$. By Proposition \ref{proposition-Garel}
we have a morphism of complexes
$$
\Theta_{B/A} : \Omega^\bullet_B \longrightarrow \Omega^\bullet_A
$$
In particular, if $t \in B$ denotes the image of $x \in A[x]$
we can consider the elements
$$
\Theta_{B/A}(t^i\text{d}t) \in \Omega^1_A,\quad i = 0, \ldots, d - 1
$$
What are these elements? By the same principle as used in the proof of
Proposition \ref{proposition-Garel} it suffices to compute this
in the universal case, i.e., when $A = \mathbf{Z}[a_1, \ldots, a_d]$
or even when $A$ is replaced by the fraction field
$\mathbf{Q}(a_1, \ldots, a_d)$. Writing symbolically
$$
f = \prod\nolimits_{i = 1, \ldots, d} (x - \alpha_i)
$$
we see that over $\mathbf{Q}(\alpha_1, \ldots, \alpha_d)$
the algebra $B$ becomes split:
$$
\mathbf{Q}(a_0, \ldots, a_{d - 1})[x]/(f) 
\longrightarrow
\prod\nolimits_{i = 1, \ldots, d} \mathbf{Q}(\alpha_1, \ldots, \alpha_d),
\quad
t \longmapsto (\alpha_1, \ldots, \alpha_d)
$$
Thus for example
$$
\Theta(\text{d}t) = \sum \text{d} \alpha_i = - \text{d}a_1
$$
Next, we have
$$
\Theta(t\text{d}t) = \sum \alpha_i \text{d}\alpha_i =
a_1 \text{d} a_1 - \text{d}a_2
$$
Next, we have
$$
\Theta(t^2\text{d}t) = \sum \alpha_i^2 \text{d}\alpha_i =
- a_1^2 \text{d} a_1 + a_1 \text{d}a_2 + a_2 \text{d}a_1 - \text{d}a_3
$$
(modulo calculation error), and so on. This suggests that
if $f(x) = x^d - a$ then
$$
\Theta_{B/A}(t^i\text{d}t) =
\left\{
\begin{matrix}
0 & \text{if} & i = 0, \ldots, d - 2 \\
\text{d}a & \text{if} & i = d - 1
\end{matrix}
\right.
$$
in $\Omega_A$. This is true for in this particular case one can do
the calculation for the extension $\mathbf{Q}(a)[x]/(x^d - a)$
to verify this directly.
\end{example}










\input{chapters}

\bibliography{my}
\bibliographystyle{amsalpha}

\end{document}
