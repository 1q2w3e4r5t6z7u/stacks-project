\input{preamble}

% OK, start here.
%
\begin{document}

\title{Coherent Cohomology}


\maketitle

\phantomsection
\label{section-phantom}

\tableofcontents

\section{Introduction}
\label{section-introduction}

\noindent
The title of this chapter is a bit of a lie because we
will first prove a number of results on the cohomology of quasi-coherent
sheaves. A fundamental reference is \cite{EGA}.
Having done this we wil elaborate on cohomology of
coherent sheaves in the Noetherian setting. See also \cite{FAC}.







\section{Cech cohomology of quasi-coherent sheaves}
\label{section-cech-quasi-coherent}

\noindent
Let $X$ be a scheme.
Let $U \subset X$ be an affine open.
Recall that a {\it standard open covering} of $U$ is a covering
of the form $\mathcal{U} : U = \bigcup_{i = 1}^n D(f_i)$
where $f_1, \ldots, f_n \in \Gamma(U, \mathcal{O}_X)$ generate
the unit ideal, see
Schemes, Definition \ref{schemes-definition-standard-covering}.

\begin{lemma}
\label{lemma-cech-cohomology-quasi-coherent-trivial}
Let $X$ be a scheme.
Let $\mathcal{F}$ be a quasi-coherent $\mathcal{O}_X$-module.
Let $\mathcal{U} : U = \bigcup_{i = 1}^n D(f_i)$ be a standard
open covering of an affine open of $X$.
Then $\check{H}^p(\mathcal{U}, \mathcal{F}) = 0$ for
all $p > 0$.
\end{lemma}

\begin{proof}
Write $U = \Spec(A)$ for some ring $A$.
In other words, $f_1, \ldots, f_n$ are elements of $A$
which generate the unit ideal of $A$.
Write $\mathcal{F}|_U = \widetilde{M}$ for some $A$-module $M$.
Clearly the Cech complex
$\check{\mathcal{C}}^\bullet(\mathcal{U}, \mathcal{F})$
is identified with the complex
$$
\prod_{i_0} M_{f_{i_0}} \to
\prod_{i_0i_1} M_{f_{i_0}f_{i_1}} \to
\prod_{i_0i_1i_2} M_{f_{i_0}f_{i_1}f_{i_2}} \to
\ldots
$$
We are asked to show that the extended complex
\begin{equation}
\label{equation-extended}
0 \to
M \to
\prod_{i_0} M_{f_{i_0}} \to
\prod_{i_0i_1} M_{f_{i_0}f_{i_1}} \to
\prod_{i_0i_1i_2} M_{f_{i_0}f_{i_1}f_{i_2}} \to
\ldots
\end{equation}
(whose truncation we have studied in
Algebra, Lemma \ref{algebra-lemma-cover-module}) is exact.
It suffices to show that (\ref{equation-extended})
is exact after localizing at a prime $\mathfrak p$, see
Algebra, Lemma \ref{algebra-lemma-characterize-zero-local}.
In fact we will show that the extended complex localized
at $\mathfrak p$ is homotopic to zero.

\medskip\noindent
There exists an index $i$ such that $f_i \not \in \mathfrak p$.
Choose and fix such an element $i_{\text{fix}}$. Note that
$M_{f_{i_{\text{fix}}}, \mathfrak p} = M_{\mathfrak p}$. Similarly
for a localization at a product $f_{i_0} \ldots f_{i_p}$ and $\mathfrak p$
we can drop any $f_{i_j}$ for which $i_j = i_{\text{fix}}$.
Let us define a homotopy
$$
h :
\prod\nolimits_{i_0 \ldots i_{p + 1}}
M_{f_{i_0} \ldots f_{i_{p + 1}}, \mathfrak p}
\longrightarrow
\prod\nolimits_{i_0 \ldots i_p}
M_{f_{i_0} \ldots f_{i_p}, \mathfrak p}
$$
by the rule
$$
h(s)_{i_0 \ldots i_p} = s_{i_{\text{fix}} i_0 \ldots i_p}
$$
(This is ``dual'' to the homotopy in the proof of
Cohomology, Lemma \ref{cohomology-lemma-homology-complex}.)
In other words, $h : \prod_{i_0} M_{f_{i_0}, \mathfrak p} \to M$
is projection onto the factor
$M_{f_{i_{\text{fix}}}, \mathfrak p} = M_{\mathfrak p}$ and in general
the map $h$ equal projection onto the factors
$M_{f_{i_{\text{fix}}} f_{i_1} \ldots f_{i_{p + 1}}, \mathfrak p}
= M_{f_{i_1} \ldots f_{i_{p + 1}}, \mathfrak p}$. We compute
\begin{align*}
(dh + hd)(s)_{i_0 \ldots i_p}
= &
\sum_{j = 0}^p
(-1)^j
h(s)_{i_0 \ldots \hat i_j \ldots i_p}
+
d(s)_{i_{\text{fix}} i_0 \ldots i_p}\\
= &
\sum_{j = 0}^p
(-1)^j
s_{i_{\text{fix}} i_0 \ldots \hat i_j \ldots i_p}
+
s_{i_0 \ldots i_p}
+
\sum_{j = 0}^p
(-1)^{j + 1}
s_{i_{\text{fix}} i_0 \ldots \hat i_j \ldots i_p} \\
= &
s_{i_0 \ldots i_p}
\end{align*}
This proves the identity map is homotopic to zero as desired.
\end{proof}

\noindent
The following lemma says in particular that for any affine scheme
$X$ and any quasi-coherent sheaf $\mathcal{F}$ on $X$ we have
$$
H^p(X, \mathcal{F}) = 0
$$
for all $p > 0$.

\begin{lemma}
\label{lemma-quasi-coherent-affine-cohomology-zero}
Let $X$ be a scheme.
Let $\mathcal{F}$ be a quasi-coherent $\mathcal{O}_X$-module.
For any affine open $U \subset X$ we have
$H^p(U, \mathcal{F}) = 0$ for all $p > 0$.
\end{lemma}

\begin{proof}
We are going to apply
Cohomology, Lemma \ref{cohomology-lemma-cech-vanish-basis}.
As our basis $\mathcal{B}$ for the topology of $X$ we are going to use
the affine opens of $X$.
As our set $\text{Cov}$ of open coverings we are going to use the standard
open coverings of affine opens of $X$.
Next we check that conditions (1), (2) and (3) of
Cohomology, Lemma \ref{cohomology-lemma-cech-vanish-basis}
hold. Note that the intersection of standard opens in an affine is
another standard open. Hence property (1) holds. 
The coverings form a cofinal system of open coverings of any element
of $\mathcal{B}$, see
Schemes, Lemma \ref{schemes-lemma-standard-open}.
Hence (2) holds.
Finally, condition (3) of the lemma follows from
Lemma \ref{lemma-cech-cohomology-quasi-coherent-trivial}.
\end{proof}

\noindent
Here is a relative version of the vanishing of cohomology of quasi-coherent
sheaves on affines.

\begin{lemma}
\label{lemma-relative-affine-vanishing}
Let $f : X \to S$ be a morphism of schemes.
Let $\mathcal{F}$ be a quasi-coherent $\mathcal{O}_X$-module.
If $f$ is affine then $R^if_*\mathcal{F} = 0$ for all $i > 0$.
\end{lemma}

\begin{proof}
According to
Cohomology, Lemma \ref{cohomology-lemma-describe-higher-direct-images}
the sheaf
$R^if_*\mathcal{F}$ is the sheaf associated to the presheaf
$V \mapsto H^i(f^{-1}(V), \mathcal{F}|_{f^{-1}(V)})$.
By assumption, whenever $V$ is affine we have that $f^{-1}(V)$ is
affine, see Morphisms, Definition \ref{morphisms-definition-affine}.
By Lemma \ref{lemma-quasi-coherent-affine-cohomology-zero} we conclude that
$H^i(f^{-1}(V), \mathcal{F}|_{f^{-1}(V)}) = 0$
whenever $V$ is affine. Since $S$ has a basis consisting of affine
opens we win.
\end{proof}

\begin{lemma}
\label{lemma-cech-cohomology-quasi-coherent}
Let $X$ be a scheme.
Let $\mathcal{U} : X = \bigcup_{i \in I} U_i$ be an open covering such that
$U_{i_0 \ldots i_p}$ is affine open for all $p \ge 0$ and all
$i_0, \ldots, i_p \in I$
In this case for any quasi-coherent sheaf $\mathcal{F}$ we have
$$
\check{H}^p(\mathcal{U}, \mathcal{F}) = H^p(X, \mathcal{F})
$$
as $\Gamma(X, \mathcal{O}_X)$-modules for all $p$.
\end{lemma}

\begin{proof}
In view of
Lemma \ref{lemma-quasi-coherent-affine-cohomology-zero}
this is a special case of
Cohomology, Lemma
\ref{cohomology-lemma-cech-spectral-sequence-application}.
\end{proof}







\section{Vanishing of cohomology}
\label{section-vanishing}

\noindent
We have seen that on an affine scheme the higher cohomology groups
of any quasi-coherent sheaf vanish
(Lemma \ref{lemma-quasi-coherent-affine-cohomology-zero}).
It turns out that this also
characterizes affine schemes. We give two versions allthough the
first covers all conceivable cases.

\begin{lemma}
\label{lemma-quasi-compact-h1-zero-covering}
Let $X$ be a scheme.
Assume that
\begin{enumerate}
\item $X$ is quasi-compact,
\item for every quasi-coherent sheaf of ideals
$\mathcal{I} \subset \mathcal{O}_X$ we have $H^1(X, \mathcal{I}) = 0$.
\end{enumerate}
Then $X$ is affine.
\end{lemma}

\begin{proof}
Let $x \in X$ be a closed point. Let $U \subset X$ be an affine open
neighbourhood of $x$. Write $U = \Spec(A)$ and let
$\mathfrak m \subset A$ be the maximal ideal corresponding to $x$.
Set $Z = X \setminus U$ and $Z' = Z \cup \{x\}$.
By Schemes, Lemma \ref{schemes-lemma-reduced-closed-subscheme} there
are quasi-coherent sheaves of ideals
$\mathcal{I}$, resp.\ $\mathcal{I}'$ cutting out
the reduced closed subschemes $Z$, resp.\ $Z'$.
Consider the short exact sequence
$$
0 \to \mathcal{I}' \to \mathcal{I} \to \mathcal{I}/\mathcal{I}' \to 0.
$$
Since $x$ is a closed point of $X$ and $x \not \in Z$ we see that
$\mathcal{I}/\mathcal{I}'$ is supported at $x$. In fact, the restriction
of $\mathcal{I}/\mathcal{I'}$ to $U$ corresponds to the $A$-module
$A/\mathfrak m$. Hence we see that $\Gamma(X, \mathcal{I}/\mathcal{I'})
= A/\mathfrak m$. Since by assumption $H^1(X, \mathcal{I}') = 0$
we see there exists a global section $f \in \Gamma(X, \mathcal{I})$
which maps to the element $1 \in A/\mathfrak m$ as a section of
$\mathcal{I}/\mathcal{I'}$. Clearly we have
$x \in X_f \subset U$. This implies that $X_f = D(f_A)$ where
$f_A$ is the image of $f$ in $A = \Gamma(U, \mathcal{O}_X)$.
In particular $X_f$ is affine.

\medskip\noindent
Consider the union $W = \bigcup X_f$ over all $f \in \Gamma(X, \mathcal{O}_X)$
such that $X_f$ is affine. Obviously $W$ is open in $X$.
By the arguments above every closed point of
$X$ is contained in $W$. The closed subset $X \setminus W$ of $X$
is also quasi-compact
(see Topology, Lemma \ref{topology-lemma-closed-in-quasi-compact}).
Hence it has a closed point if it is nonempty (see
Topology, Lemma \ref{topology-lemma-quasi-compact-closed-point}).
This is a would contradict the fact that all closed points are in
$W$. Hence we conclude $X = W$.

\medskip\noindent
Choose finitely many $f_1, \ldots, f_n \in \Gamma(X, \mathcal{O}_X)$
such that $X = X_{f_1} \cup \ldots \cup X_{f_n}$ and such that each
$X_{f_i}$ is affine. This is possible as we've seen above.
By Properties, Lemma \ref{properties-lemma-characterize-affine}
to finish the proof it suffices
to show that $f_1, \ldots, f_n$ generate the unit ideal in
$\Gamma(X, \mathcal{O}_X)$. Conisder the short exact sequence
$$
\xymatrix{
0 \ar[r] &
\mathcal{F} \ar[r] &
\mathcal{O}_X^{\oplus n} \ar[rr]^{f_1, \ldots, f_n} & &
\mathcal{O}_X \ar[r] &
0
}
$$
The arrow defined by $f_1, \ldots, f_n$ is surjective since the
opens $X_{f_i}$ cover $X$. We let $\mathcal{F}$ be the kernel
of this surjective map.
Observe that $\mathcal{F}$ has a filtration
$$
0 = \mathcal{F}_0 \subset \mathcal{F}_1 \subset
\ldots \subset \mathcal{F}_n = \mathcal{F}
$$
so that each subquotient $\mathcal{F}_i/\mathcal{F}_{i - 1}$ is
isomorphic to a quasi-coherent sheaf of ideals.
Namely we can take $\mathcal{F}_i$ to be the intersection
of the first $i$ direct summands of $\mathcal{O}_X^{\oplus n}$.
The assumption
of the lemma implies that $H^1(X, \mathcal{F}_i/\mathcal{F}_{i - 1}) = 0$
for all $i$. This implies that
$H^1(X, \mathcal{F}_2) = 0$ because it is sandwiched between
$H^1(X, \mathcal{F}_1)$ and $H^1(X, \mathcal{F}_2/\mathcal{F}_1)$.
Continuing like this we deduce that $H^1(X, \mathcal{F}) = 0$.
Therefore we conclude that the map
$$
\xymatrix{
\bigoplus\nolimits_{i = 1, \ldots, n} \Gamma(X, \mathcal{O}_X)
\ar[rr]^{f_1, \ldots, f_n} & &
\Gamma(X, \mathcal{O}_X)
}
$$
is surjective as desired.
\end{proof}

\noindent
Note that if $X$ is a Noetherian scheme then every quasi-coherent
sheaf of ideals is automatically a coherent sheaf of ideals and a
finite type quasi-coherent sheaf of ideals. Hence
the preceding lemma and the next lemma both apply in this case.

\begin{lemma}
\label{lemma-quasi-separated-h1-zero-covering}
Let $X$ be a scheme. Assume that
\begin{enumerate}
\item $X$ is quasi-compact,
\item $X$ is quasi-separated, and
\item $H^1(X, \mathcal{I}) = 0$ for every quasi-coherent sheaf
of ideals $\mathcal{I}$ of finite type.
\end{enumerate}
Then $X$ is affine.
\end{lemma}

\begin{proof}
By
Properties, Lemma \ref{properties-lemma-quasi-coherent-colimit-finite-type}
every quasi-coherent sheaf of ideals is a directed colimit of
quasi-coherent sheaves of ideals of finite type.
By Cohomology, Lemma \ref{cohomology-lemma-quasi-separated-cohomology-colimit}
taking cohomology on $X$ commutes with directed colimits.
Hence we see that $H^1(X, \mathcal{I}) = 0$
for every quasi-coherent sheaf of ideals on $X$. In other words
we see that Lemma \ref{lemma-quasi-compact-h1-zero-covering} applies.
\end{proof}









\section{Derived category of quasi-coherent modules}
\label{section-derived-quasi-coherent}

\noindent
In this section we briefly discuss the relationship between quasi-coherent
modules and all modules on a scheme $S$. (This should be elaborated
on and generalized.) A reference is
\cite[Appendix B]{TT}. By the discussion in
Schemes, Section \ref{schemes-section-quasi-coherent}
the embedding
$\textit{QCoh}(\mathcal{O}_S) \subset \textit{Mod}(\mathcal{O}_S)$
exhibits $\textit{QCoh}(\mathcal{O}_S)$ as a Serre subcategory of
the category of $\mathcal{O}_S$-modules. Denote
$D_{\textit{QCoh}}(\mathcal{O}_S) \subset D(\mathcal{O}_S)$ the
subcategory of complexes whose cohomology sheaves are quasi-coherent, see
Derived Categories, Section \ref{derived-section-triangulated-sub}.
Thus we obtain a canonical
functor
$$
D(\textit{QCoh}(\mathcal{O}_S))
\longrightarrow
D_{\textit{QCoh}}(\mathcal{O}_S)
$$
see
Derived Categories, Equation (\ref{derived-equation-compare}).
We can also consider the bounded below version
\begin{equation}
\label{equation-compare-bounded}
D^+(\textit{QCoh}(\mathcal{O}_S))
\longrightarrow
D^+_{\textit{QCoh}}(\mathcal{O}_S)
\end{equation}
Using the vanishing of cohomology proved above we can show this
functor is an equivalence for affine schemes.

\begin{lemma}
\label{lemma-affine-compare-bounded}
If $S = \Spec(A)$ is an affine scheme, then
(\ref{equation-compare-bounded}) is an equivalence.
\end{lemma}

\begin{proof}
Recall that $\textit{QCoh}(\mathcal{O}_S) = \textit{Mod}_A$
for our affine scheme $S = \Spec(A)$.
Taking right derived functor of global sections
gives a functor
\begin{equation}
\label{equation-back}
R\Gamma(S, - ) :
D^+_{\textit{QCoh}}(\mathcal{O}_S)
\longrightarrow
D^+(\textit{Mod}_A) = D^+(A).
\end{equation}
By the vanishing of cohomology of quasi-coherent sheaves, see
Lemma \ref{lemma-quasi-coherent-affine-cohomology-zero},
we see that for any $A$-module $M$ with $\mathcal{F} = \widetilde{M}$
we have $R\Gamma(S, \mathcal{F}) = M$. Hence the composition of
(\ref{equation-compare-bounded}) and (\ref{equation-back}) is isomorphic
to the identity functor (some details omitted).
\end{proof}

\noindent
Actually it is true that the comparison map
$D(\textit{QCoh}(\mathcal{O}_S)) \to D_{\textit{QCoh}}(\mathcal{O}_S)$
is an equivalence for any quasi-compact and (semi-)separated scheme
(insert future reference here).














\section{Quasi-coherence of higher direct images}
\label{section-quasi-coherence}

\begin{lemma}
\label{lemma-vanishing-nr-affines}
Let $X$ be a quasi-compact separated scheme.
Let $t \geq 1$ be the minimal number of affine opens needed to
cover $X$.
Then $H^n(X, \mathcal{F}) = 0$ for all $n \geq t$ and all
quasi-coherent sheaves $\mathcal{F}$.
\end{lemma}

\begin{proof}
First proof.
By induction on $t$.
If $t = 1$ the result follows from
Lemma \ref{lemma-quasi-coherent-affine-cohomology-zero}.
If $t > 1$ write $X = U \cup V$ with $V$ affine open and
$U = U_1 \cup \ldots \cup U_{t - 1}$ a union of $t - 1$ open affines.
Note that in this case
$U \cap V =  (U_1 \cap V) \cup \ldots (U_{t - 1} \cap V)$
is also a union of $t - 1$ affine open subschemes, see
Schemes, Lemma \ref{schemes-lemma-characterize-separated}.
We apply the Mayer-Vietoris long exact sequence
$$
0 \to
H^0(X, \mathcal{F}) \to
H^0(U, \mathcal{F}) \oplus H^0(V, \mathcal{F}) \to
H^0(U \cap V, \mathcal{F}) \to
H^1(X, \mathcal{F}) \to \ldots
$$
see Cohomology, Lemma \ref{cohomology-lemma-mayer-vietoris}.
By induction we see that the groups $H^i(U, \mathcal{F})$,
$H^i(U, \mathcal{F})$, $H^i(U, \mathcal{F})$ are zero for
$i \geq t - 1$. It follows immediately that $H^i(X, \mathcal{F})$
is zero for $i \geq t$.

\medskip\noindent
Second proof. 
Let $\mathcal{U} : X = \bigcup_{i = 1}^t U_i$ be a finite affine open
covering. Since $X$ is separated the multiple intersections
$U_{i_0 \ldots i_p}$ are all affine, see 
Schemes, Lemma \ref{schemes-lemma-characterize-separated}.
By Lemma \ref{lemma-cech-cohomology-quasi-coherent} the Cech
cohomology groups $\check{H}^p(\mathcal{U}, \mathcal{F})$
agree with the cohomology groups. By
Cohomology, Lemma \ref{cohomology-lemma-alternating-usual}
the Cech cohomology groups may be computed using the alternating
Cech complex $\check{\mathcal{C}}_{alt}^\bullet(\mathcal{U}, \mathcal{F})$.
As the covering consists of $t$ elements we see immediately
that $\check{\mathcal{C}}_{alt}^p(\mathcal{U}, \mathcal{F}) = 0$
for all $p \geq t$. Hence the result follows.
\end{proof}

\noindent
There is a result similar to Lemma \ref{lemma-vanishing-nr-affines} above
for quasi-compact and quasi-separated schemes but it is superseded
by the following more general (relative) lemma. You can turn it
into an absolute statement by mapping into $\Spec(\mathbf{Z})$.

\begin{lemma}
\label{lemma-quasi-coherence-higher-direct-images}
Let $f : X \to S$ be a morphism of schemes.
Assume that $f$ is quasi-separated and quasi-compact.
\begin{enumerate}
\item For any quasi-coherent $\mathcal{O}_X$-module $\mathcal{F}$ the
higher direct images $R^pf_*\mathcal{F}$ are quasi-coherent on $S$.
\item If $S$ is quasi-compact, there exists an integer $n = n(X, S, f)$
such that $R^pf_*\mathcal{F} = 0$ for all $p \geq n$ and any
quasi-coherent sheaf $\mathcal{F}$ on $X$.
\item In fact, if $S$ is quasi-compact we can find $n = n(X, S, f)$
such that for every
morphism of schemes $S' \to S$ we have $R^p(f')_*\mathcal{F}' = 0$
for $p \geq n$ and any quasi-coherent sheaf $\mathcal{F}'$
on $X'$. Here $f' : X' = S' \times_S X \to S'$ is the base change of $f$.
\end{enumerate}
\end{lemma}

\begin{proof}
Note that under the hypotheses of the lemma the sheaf
$R^0f_*\mathcal{F} = f_*\mathcal{F}$ is quasi-coherent by
Schemes, Lemma \ref{schemes-lemma-push-forward-quasi-coherent}.

\medskip\noindent
We will repeatedly use
Cohomology, Lemma \ref{cohomology-lemma-localize-higher-direct-images}
to see that forming higher direct images commutes with restriction
to open subschemes.
Being quasi-coherent is local on $S$ and in order to prove (1) we
may assume $S$ is affine.

\medskip\noindent
Suppose $S = \bigcup_{i = 1, \ldots m} S_i$ is a finite affine open covering.
Assume $n_i$ works in (2) for the morphism $f^{-1}(S_i) \to S_i$.
Then we see that $n = \max\{n_i\}$ works for $X \to S$ in (2).
Hence we may assume $S$ is affine in order to prove (2) as well.

\medskip\noindent
Assume $S$ is affine and $f$ quasi-compact and separated.
Let $t \geq 1$ be the minimal number of affine opens needed to cover $X$.
We will prove this case of the lemma by induction on $t$ and we will in
addition show that setting $n = t$ in (2) works.
If $t = 1$ then the morphism $f$ is affine by
Morphisms, Lemma \ref{morphisms-lemma-morphism-affines-affine}
and (1) and (2) (with $n = 1$)
both follow from Lemma \ref{lemma-relative-affine-vanishing}.
If $t > 1$ write $X = U \cup V$ with $V$ affine open and
$U = U_1 \cup \ldots \cup U_{t - 1}$ a union of $t - 1$ open affines.
Note that in this case
$U \cap V =  (U_1 \cap V) \cup \ldots (U_{t - 1} \cap V)$
is also a union of $t - 1$ affine open subschemes, see
Schemes, Lemma \ref{schemes-lemma-characterize-separated}.
We will apply the relative Mayer-Vietoris sequence
$$
0 \to
f_*\mathcal{F} \to
a_*(\mathcal{F}|_U) \oplus b_*(\mathcal{F}|_V) \to
c_*(\mathcal{F}|_{U \cap V}) \to
R^1f_*\mathcal{F} \to \ldots
$$
see Cohomology, Lemma \ref{cohomology-lemma-relative-mayer-vietoris}.
By induction we see that
$R^pa_*\mathcal{F}$, $R^pb_*\mathcal{F}$ and $R^pc_*\mathcal{F}$
are all quasi-coherent and zero when $p \geq t - 1$. This immediately
implies the desired vanishing. It also implies that each of the sheaves
$R^pf_*\mathcal{F}$ is quasi-coherent since it sits in the middle of a short
exact sequence with a cokernel of a map between quasi-coherent sheaves
on the left and a kernel of a map between quasi-coherent sheaves on the right.
Use the results on quasi-coherent sheaves in
Schemes, Section \ref{schemes-section-quasi-coherent} to see
this is sufficient to conclude.

\medskip\noindent
Assume $S$ is affine and $f$ quasi-compact and quasi-separated.
Let $t \geq 1$ be the minimal number of affine opens needed to cover $X$.
We will prove this case of lemma by induction on $t$.
In case $t = 1$ the morphism $f$ is separated and we are back
in the previous case (see previous paragraph).
If $t > 1$ write $X = U \cup V$ with $V$ affine open and
$U$ a union of $t - 1$ open affines.
Note that in this case $U \cap V$ is an open subscheme of an affine
scheme and hence separated (see
Schemes, Lemma \ref{schemes-lemma-affine-separated}).
We will apply the relative Mayer-Vietoris sequence
$$
0 \to
f_*\mathcal{F} \to
a_*(\mathcal{F}|_U) \oplus b_*(\mathcal{F}|_V) \to
c_*(\mathcal{F}|_{U \cap V}) \to
R^1f_*\mathcal{F} \to \ldots
$$
see Cohomology, Lemma \ref{cohomology-lemma-relative-mayer-vietoris}.
By induction there exist integers $n_a$, $n_b$, $n_c$ such that
$R^pa_*\mathcal{F}$, $R^pb_*\mathcal{F}$ and $R^pc_*\mathcal{F}$
are quasi-coherent and zero when $p \geq \max\{n_a, n_b, n_c\}$.
This immediately implies the vanishing in (2) with
$n = \max\{n_a, n_b, n_c\} + 1$. It also implies that each of sheaves
$R^pf_*\mathcal{F}$ is quasi-coherent since it sits in the middle of a short
exact sequence with a cokernel of a map between quasi-coherent sheaves
on the left and a kernel of a map between quasi-coherent sheaves on the right.
Use the results on quasi-coherent sheaves in
Schemes, Section \ref{schemes-section-quasi-coherent} to see
this is sufficient to conclude.

\medskip\noindent
The results (1) and (2) are all that is needed in most applications.
However, let us prove (3) as well. Let $S = \bigcup S_i$
is a finite affine open covering and suppose that $n_i$ works
in part (3) for the morphism $f^{-1}(S_i) \to S_i$.
For any morphism $S' \to S$ we can cover $S'$ by affines which
map into one of the $S_i$'s. Hence $n = \max\{n_i\}$ works
for $f : X \to S$ in (3) as well. This argument shows that we
may assume $S$ is affine and that we are doing base changes 
by $S' \to S$ with $S'$ affine as well.

\medskip\noindent
Let $S$ be an affine scheme
and let $f : X \to S$ be quasi-compact and quasi-separated.
Choose a finite open covering $X = \bigcup_{i = 1, \ldots, t} U_i$.
For each pair $i, j$ choose a finite affine open covering
$$
U_i \cap U_j = \bigcup\nolimits_{k = 1, \ldots, t(i, j)} U_{ijk}
$$
The proof above really shows that we may take 
$n(X, S, f)$ to be the maximum of the numbers
$$
1 + \sum\nolimits_{j = i + 1, \ldots, t} t(i, j),\quad i = 1, \ldots, t.
$$
Consider any base change $X' = S' \times_S X$ with $S'$ affine.
Then all the base changes $U'_i = S' \times_S U_i$ and
$U'_{ijk} = S' \times_S U_{ijk}$ are affine as well. Hence the
same integer works for $f'$.
\end{proof}

\begin{lemma}
\label{lemma-quasi-coherence-higher-direct-images-application}
Let $f : X \to S$ be a morphism of schemes.
Assume that $f$ is quasi-separated and quasi-compact.
Assume $S$ is affine.
For any quasi-coherent $\mathcal{O}_X$-module $\mathcal{F}$
we have
$$
H^q(X, \mathcal{F}) = H^0(S, R^qf_*\mathcal{F})
$$
for all $q \in \mathbf{Z}$.
\end{lemma}

\begin{proof}
Consider the Leray spectral sequence $E_2^{p, q} = H^p(S, R^qf_*\mathcal{F})$
converging to $H^{p + q}(X, \mathcal{F})$, see
Cohomology, Lemma \ref{cohomology-lemma-Leray}.
By Lemma \ref{lemma-quasi-coherence-higher-direct-images}
we see that the sheaves $R^qf_*\mathcal{F}$ are quasi-coherent.
By Lemma \ref{lemma-quasi-coherent-affine-cohomology-zero}
we see that $E_2^{p, q} = 0$ when $p > 0$.
Hence the spectral sequence degenerates at $E_2$ and we win.
See also
Cohomology, Lemma \ref{cohomology-lemma-apply-Leray} (2)
for the general principle.
\end{proof}






\section{Cohomology and base change}
\label{section-cohomology-base-change}

\noindent
We would like to prove a little more in the situation of
Lemma \ref{lemma-quasi-coherence-higher-direct-images}.
Namely, we would like to find a complex of
quasi-coherent sheaves on $S$ which computes the total derived
cohomology. This is true, at least if $S$ is quasi-compact and separated.
It can be shown in many ways. For example one can show that the
subcategory of the derived category $D^{+}(S)$ consisting of those
complexes whose cohomology sheaves are quasi-coherent is equivalent to
$D^{+}(\text{QCoh}(\mathcal{O}_S))$ (insert future reference here).

\medskip\noindent
We will use a different approach which produces a complex having
a good base change property. First of all the result is very easy
if $f$ and $S$ are separated. Since this is the case which by far
the most often used we treat it separately.

\begin{lemma}
\label{lemma-separated-case-relative-cech}
Let $f : X \to S$ be a morphism of schemes.
Let $\mathcal{F}$ be a quasi-coherent $\mathcal{O}_X$-module.
Assume $X$ and $S$ are separated and quasi-compact.
In this case we can compute $Rf_*\mathcal{F}$ as follows:
\begin{enumerate}
\item Choose a finite affine open covering
$\mathcal{U} : X = \bigcup_{i = 1, \ldots, n} U_i$.
\item For $i_0, \ldots, i_p \in \{1, \ldots, n\}$ denote
$f_{i_0 \ldots i_p} : U_{i_0 \ldots i_p} \to S$ the restriction of $f$
to the intersection $U_{i_0 \ldots i_p} = U_{i_0} \cap \ldots \cap U_{i_p}$.
\item Set $\mathcal{F}_{i_0 \ldots i_p}$ equal to the restriction
of $\mathcal{F}$ to $U_{i_0 \ldots i_p}$.
\item Set 
$$
\check{\mathcal{C}}^p(\mathcal{U}, f, \mathcal{F}) =
\bigoplus\nolimits_{i_0 \ldots i_p}
f_{i_0 \ldots i_p *} \mathcal{F}_{i_0 \ldots i_p}
$$
and define differentials
$d : \check{\mathcal{C}}^p(\mathcal{U}, f, \mathcal{F})
\to \check{\mathcal{C}}^{p + 1}(\mathcal{U}, f, \mathcal{F})$
as in Cohomology, Equation (\ref{cohomology-equation-d-cech}).
\end{enumerate}
Then the complex $\check{\mathcal{C}}^\bullet(\mathcal{U}, f, \mathcal{F})$
is a complex of quasi-coherent sheaves on $S$ which comes equipped with an
isomorphism
$$
\check{\mathcal{C}}^\bullet(\mathcal{U}, f, \mathcal{F})
\longrightarrow
Rf_*\mathcal{F}
$$
in $D^{+}(S)$. This isomorphism is functorial in the quasi-coherent
sheaf $\mathcal{F}$.
\end{lemma}

\begin{proof}
Omitted. Hint: Use the resolution
$\mathcal{F} \to {\mathfrak C}^\bullet(\mathcal{U}, \mathcal{F})$
of Cohomology, Lemma \ref{cohomology-lemma-locally-finite-covering-resolution}.
Observe that
$\check{\mathcal{C}}^\bullet(\mathcal{U}, f, \mathcal{F}) =
f_*{\mathfrak C}^\bullet(\mathcal{U}, \mathcal{F})$.
Also observe that both the inclusion morphisms
$j_{i_0 \ldots i_p} : U_{i_0 \ldots i_p} \to X$
and the morphisms $f_{i_0 \ldots i_p} : U_{i_0 \ldots i_p} \to S$
are affine because $S$ and $X$ and $f : X \to S$ are separated,
see Morphisms, Lemma \ref{morphisms-lemma-affine-permanence}.
Hence $R^q(j_{i_0 \ldots i_p})_*\mathcal{F}_{i_0 \ldots i_p}$
as well as $R^q(f_{i_0 \ldots i_p})_*\mathcal{F}_{i_0 \ldots i_p}$
are zero for $q > 0$. Finally, put all of this information together
(e.g.\ use a spectral sequence, for example by choosing a Cartan-Eilenberg
resolution of the complex ${\mathfrak C}^\bullet(\mathcal{U}, \mathcal{F})$).
\end{proof}

\noindent
Next, we are going to consider what happens if we do a base change.
Let $f : X \to S$ be a morphism of schemes.
Let $\mathcal{F}$ be a quasi-coherent sheaf on $X$.
Suppose further that $g : S' \to S$ is any morphism of schemes. Denote
$X' = X_{S'} = S' \times_S X$ the base change of $X$ and denote
$f' : X' \to S'$ the base change of $f$.
Also write $g' : X' \to X$ the projection,
and set $\mathcal{F}' = (g')^*\mathcal{F}$.
Here is a diagram representing the situation:
\begin{equation}
\label{equation-base-change-diagram}
\xymatrix{
\mathcal{F}' = (g')^*\mathcal{F} &
X' \ar[r]_{g'} \ar[d]_{f'} &
X \ar[d]^f &
\mathcal{F} \\
Rf'_*\mathcal{F}' &
S' \ar[r]^g &
S &
Rf_*\mathcal{F}
}
\end{equation}
Here is the simplest case of the base change property we have in mind.

\begin{lemma}
\label{lemma-affine-base-change}
Let $f : X \to S$ be a morphism of schemes.
Let $\mathcal{F}$ be a quasi-coherent $\mathcal{O}_X$-module.
Assume $f$ is affine.
In this case $f_*\mathcal{F} \cong Rf_*\mathcal{F}$ is
a quasi-coherent sheaf, and for every base change diagram
(\ref{equation-base-change-diagram})
we have
$$
g^*f_*\mathcal{F} = f'_*(g')^*\mathcal{F}.
$$
\end{lemma}

\begin{proof}
The vanishing of higher direct images is
Lemma \ref{lemma-relative-affine-vanishing}.
The statement is local on $S$ and $S'$. Hence we may
assume $X = \Spec(A)$, $S = \Spec(R)$,
$S' = \Spec(R')$ and $\mathcal{F} = \widetilde{M}$
for some $A$-module $M$.
We use Schemes, Lemma \ref{schemes-lemma-widetilde-pullback}
to describe pullbacks and pushforwards of $\mathcal{F}$.
Namely, $X' = \Spec(R' \otimes_R A)$ and
$\mathcal{F}'$ is the quasi-coherent sheaf associated
to $(R' \otimes_R A) \otimes_A M$.
Thus we see that the lemma boils down to the
equality
$$
(R' \otimes_R A) \otimes_A M = R' \otimes_R M
$$
as $R'$-modules.
\end{proof}

\begin{lemma}
\label{lemma-base-change-complex}
With notation as in diagram (\ref{equation-base-change-diagram}).
Assume $f : X \to S$ and $\mathcal{F}$ satisfy the hypotheses of
Lemma \ref{lemma-separated-case-relative-cech}. Choose a finite
affine open covering $\mathcal{U} : X = \bigcup U_i$ of $X$.
There is a canonical isomorphism
$$
g^*\check{\mathcal{C}}^\bullet(\mathcal{U}, f, \mathcal{F})
\longrightarrow
Rf'_*\mathcal{F}'
$$
in $D^{+}(S')$. Moreover, if $S' \to S$ is affine, then in fact
$$
g^*\check{\mathcal{C}}^\bullet(\mathcal{U}, f, \mathcal{F})
=
\check{\mathcal{C}}^\bullet(\mathcal{U}', f', \mathcal{F}')
$$
with $\mathcal{U}' : X' = \bigcup U_i'$ where
$U_i' = (g')^{-1}(U_i) = U_{i, S'}$ is also affine.
\end{lemma}

\begin{proof}
In fact we may define $U_i' = (g')^{-1}(U_i) = U_{i, S'}$ no matter
whether $S'$ is affine over $S$ or not.
Let $\mathcal{U}' : X' = \bigcup U_i'$ be the induced covering of $X'$.
In this case we claim that
$$
g^*\check{\mathcal{C}}^\bullet(\mathcal{U}, f, \mathcal{F})
=
\check{\mathcal{C}}^\bullet(\mathcal{U}', f', \mathcal{F}')
$$
with $\check{\mathcal{C}}^\bullet(\mathcal{U}', f', \mathcal{F}')$
defined in exactly the same manner as in
Lemma \ref{lemma-separated-case-relative-cech}.
This is clear from the case of affine morphisms
(Lemma \ref{lemma-affine-base-change}) by working locally on $S'$.
Moreover, exactly as in the proof of
Lemma \ref{lemma-separated-case-relative-cech}
one sees that there is an isomorphism
$$
\check{\mathcal{C}}^\bullet(\mathcal{U}', f', \mathcal{F}')
\longrightarrow
Rf'_*\mathcal{F}'
$$
in $D^{+}(S')$ since the morphisms $U_i' \to X'$ and $U_i' \to S'$
are still affine (being base changes of affine morphisms).
Details omitted.
\end{proof}

\noindent
The lemma above says that the complex
$$
\mathcal{K}^\bullet = \check{\mathcal{C}}^\bullet(\mathcal{U}, f, \mathcal{F})
$$
is a bounded below complex of quasi-coherent sheaves on $S$ which
{\it universally} computes the higher direct images of $f : X \to S$.
This is something about this particular complex and
it is not preserved by replacing
$\check{\mathcal{C}}^\bullet(\mathcal{U}, f, \mathcal{F})$ by
a quasi-isomorphic complex in general! In other words, this is
not a statement that makes sense in the derived category.
The reason is that the pullback $g^*\mathcal{K}^\bullet$ is
{\it not} equal to the derived pullback $Lg^*\mathcal{K}^\bullet$
of $\mathcal{K}^\bullet$ in general!

\medskip\noindent
Here is a more general case where we can prove this statement.
We remark that the condition of $S$ being separated is harmless
in most applications, since this is usually used to prove some
local property of the total derived image.
The proof is significantly more involved and uses hypercoverings;
it is a nice example of how you can use them sometimes.

\begin{lemma}
\label{lemma-hypercoverings}
Let $f : X \to S$ be a morphism of schemes.
Let $\mathcal{F}$ be a quasi-coherent sheaf on $X$.
Assume that $f$ is quasi-compact and quasi-separated and
that $S$ is quasi-compact and separated.
There exists a bounded below complex $\mathcal{K}^\bullet$
of quasi-coherent $\mathcal{O}_S$-modules with the
following property: For every morphism
$g : S' \to S$ the complex $g^*\mathcal{K}^\bullet$ is
a representative for $Rf'_*\mathcal{F}'$ with notation as in
diagram (\ref{equation-base-change-diagram}).
\end{lemma}

\begin{proof}
(If $f$ is separated as well, please see
Lemma \ref{lemma-base-change-complex}.)
The assumptions imply in particular that $X$
is quasi-compact and quasi-separated as a scheme.
It turns out that we can still do a construction
of a ``Cech complex'' in this situation. Namely, we can find a
Zariski hypercovering $U_\bullet \to X$ of $X$ all of whose terms
$U_n$ are finite disjoint unions of affines, see
Hypercoverings,
Lemma \ref{hypercovering-lemma-quasi-separated-quasi-compact-hypercovering}.
Denote $f_\bullet : U_\bullet \to S$ the induced morphism and
$\mathcal{F}_\bullet$ the pullback of $\mathcal{F}$ to $U_\bullet$.
The pushforward $(f_\bullet)_*\mathcal{F}_\bullet$ will be a
cosimplicial quasi-coherent sheaf on $S$ whose associated cochain
complex $\mathcal{K}^\bullet$ we claim computes $Rf_*\mathcal{F}$.
The reason is that for any open $V \subset S$ the fibre product
$$
f_\bullet^{-1}(V) = V \times_S U_\bullet \to V \times_S X = f^{-1}(V)
$$
is a Zariski hypercovering of $f^{-1}(V)$. Hence by Hypercoverings,
Lemma \ref{hypercovering-lemma-cech-spectral-sequence} there is
a spectral sequence
$$
\check{H}^p(f_\bullet^{-1}(V), \underline{H}^q(\mathcal{F}))
=>
H^{p + q}(f^{-1}(V), \mathcal{F}).
$$
If we choose $V$ affine, then since $S$ is separated, all the
terms of $f_\bullet^{-1}(V)$ will be affine schemes and the spectral
sequence degenerates to give
$$
H^p(f^{-1}(V), \mathcal{F})
=
H^p(\Gamma(V, f_{\bullet, *}\mathcal{F}_\bullet))
=
H^p(\Gamma(V, \mathcal{K}^\bullet))
$$
by the vanishing of cohomology of quasi-coherent sheaves on
affine schemes (Lemma \ref{lemma-relative-affine-vanishing}).
In other words, this is completely
analogous to the result in Lemma \ref{lemma-separated-case-relative-cech}.
Moreover, this complex satisfies a base-change property similar to the
one observed in Lemma \ref{lemma-base-change-complex} for exactly
the same reasons (namely, because we have
Lemma \ref{lemma-affine-base-change} for
affine morphisms).
\end{proof}

\noindent
Here is a useful application of cohomology and base change.

\begin{lemma}
\label{lemma-flat-base-change-cohomology}
Let $f : X \to S$ be a morphism of schemes.
Let $\mathcal{F}$ be a quasi-coherent sheaf on $X$.
Let $g : S' \to S$ be a morphism of schemes.
Assume that $g$ is flat and that $f$ is quasi-compact and
quasi-separated.
Then for any $i \geq 0$ we have
$$
R^if'_*\mathcal{F}' = g^*R^if_*\mathcal{F}
$$
with notation as in (\ref{equation-base-change-diagram}).
Moreover, the induced isomorphism is the map given by the
base change map of
Cohomology, Lemma \ref{cohomology-lemma-base-change-map-flat-case}.
\end{lemma}

\begin{proof}
The statement is local on $S$ and hence we may assume $S$ and
$S'$ are affine. In this case the statement follows immediately
from Lemma \ref{lemma-base-change-complex} in case $f$ is separated
and from Lemma \ref{lemma-hypercoverings}
in the general quasi-separated case.
\end{proof}







\section{Ample invertible sheaves and cohomology}
\label{section-ample-cohomology}

\noindent
Given a ringed space $X$, an invertible $\mathcal{O}_X$-module $\mathcal{L}$,
a section $s \in \Gamma(X, \mathcal{L})$ and an $\mathcal{O}_X$-module
$\mathcal{F}$ we get a map
$\mathcal{F} \to \mathcal{F} \otimes_{\mathcal{O}_X} \mathcal{L}$,
$t \mapsto t \otimes s$ which we call multiplication by $s$.
We usually denote it $t \mapsto st$.

\begin{lemma}
\label{lemma-section-maps-back-into}
Let $X$ be a scheme.
Let $\mathcal{L}$ be an invertible $\mathcal{O}_X$-module.
Let $s \in \Gamma(X, \mathcal{L})$ be a section.
Let $\mathcal{F}' \subset \mathcal{F}$ be quasi-coherent
$\mathcal{O}_X$-modules. Assume that
\begin{enumerate}
\item $X$ is quasi-compact,
\item $\mathcal{F}$ is of finite type, and
\item $\mathcal{F}'|_{X_s} = \mathcal{F}|_{X_s}$.
\end{enumerate}
Then there exists an $n \geq 0$ such that
multiplication by $s^n$ on $\mathcal{F}$ factors
through $\mathcal{F}'$.
\end{lemma}

\begin{proof}
In other words we claim that
$s^n\mathcal{F} \subset
\mathcal{F}' \otimes_{\mathcal{O}_X} \mathcal{L}^{\otimes n}$
for some $n \geq 0$.
If this is true for $n_0$ then it is true for all $n \geq n_0$.
Hence it suffices to show there is a finite open covering such that
the result holds for each of the members of this open covering.
Since $X$ is quasi-compact we may therefore assume that $X$ is
affine and that $\mathcal{L} \cong \mathcal{O}_X$. Thus the lemma
translates into the following algebra problem (use Properties,
Lemma \ref{properties-lemma-finite-type-module}):
Let $A$ be a ring. Let $f \in A$. Let $M' \subset M$ be $A$-modules.
Assume $M$ is a finite $A$-module, and assume that
$(M')_f = M_f$. Then there exists an $n \geq 0$ such that
$f^n M \subset M'$. The proof of this is omitted.
\end{proof}

\medskip\noindent
Let $X$ be a scheme.
Let $\mathcal{L}$ be an invertible $\mathcal{O}_X$-module.
Let $s \in \Gamma(X, \mathcal{L})$ be a section.
Assume $X$ quasi-compact and quasi-separated.
The following lemma says roughly that the category of finitely
presented $\mathcal{O}_{X_s}$-modules is the category of 
finitely presented $\mathcal{O}_X$-modules where the map
multiplication by $s$ has been inverted.

\begin{lemma}
\label{lemma-section-maps-backwards}
Let $X$ be a scheme.
Let $\mathcal{L}$ be an invertible $\mathcal{O}_X$-module.
Let $s \in \Gamma(X, \mathcal{L})$ be a section.
Let $\mathcal{F}$, $\mathcal{F}'$ be quasi-coherent
$\mathcal{O}_X$-modules.
Let $\psi : \mathcal{F}|_{X_s} \to \mathcal{F}'|_{X_s}$ be a map
of $\mathcal{O}_{X_s}$-modules.
Assume that
\begin{enumerate}
\item $X$ is quasi-compact and quasi-separated, and
\item $\mathcal{F}$ is of finitely presented.
\end{enumerate}
Then there exists an $n \geq 0$ and a morphism
$\alpha : \mathcal{F} \to
\mathcal{F}' \otimes_{\mathcal{O}_X} \mathcal{L}^{\otimes n}$
whose restriction to $X_s$ equals $\psi$ via the identification
$\mathcal{L}^{\otimes n}|_{X_s} = \mathcal{O}_{X_s}$ coming from $s$.
Moreover, given a pair of solutions $(n, \alpha)$ and 
$(n', \alpha')$ there exists an $m \geq \max(n, n')$
such that $s^{m - n}\alpha = s^{m - n'}\alpha'$.
\end{lemma}

\begin{proof}
If the lemma holds for $n_0$ with map $\alpha_0$
then it holds for all $n \geq n_0$
simply by taking $\alpha = s^{n - n_0} \alpha_0$.
Choose a finite affine open covering $X = \bigcup U_i$ such
that $\mathcal{L}|_{U_i}$ is trivial. Choose finite affine
open coverings $U_i \cap U_{i'} = \bigcup U_{ii'j}$.
Suppose we can prove the lemma when $X$ is affine and
$\mathcal{L}$ is trivial. Then we can find $n_i \geq 0$
$\alpha_i : \mathcal{F}|_{U_i} \to
\mathcal{F}'|_{U_i} \otimes_{\mathcal{O}_{U_i}}
\mathcal{L}^{\otimes n_i}|_{U_i}$ satisfying the relation over $U_i$.
By the uniqueness assertion of the lemma, and the finiteness of
the number of affines $U_{ii'j}$ we can find a single large\
integer $m$ such that the maps $s^{m - n_i}\alpha_i$
and $s^{m - n_{i'}}\alpha_{i'}$
agree over $U_{ii'j}$ and hence over $U_i \cap U_{i'}$.
Thus the morphisms $s^{m - n_i}\alpha_i$ glue to give our global
map $\alpha$. Proof of the uniqueness statement is omitted.

\medskip\noindent
Assume $X$ affine and that $\mathcal{L} \cong \mathcal{O}_X$. Then the lemma
translates into the following algebra problem (use Properties,
Lemma \ref{properties-lemma-finite-presentation-module}):
Let $A$ be a ring. Let $f \in A$. Let $\psi : M_f \to (M')_f$ be
a map of $A_f$-modules. Assume $M$ is a finitely presented $A$-module.
Then there exists an $n \geq 0$ and an $A$-module map
$\alpha : M \to M'$ such that $\alpha \otimes 1_{A_f} = f^n\psi$.
Moreover, given any second solution $(n', \alpha')$
there exists an $m \geq \max(n, n')$
such that $f^{m - n}\alpha = f^{m - n'}\alpha'$.
The proof of this algebraic fact is omitted.
\end{proof}

\noindent
Cohomology is functorial. In particular, given a ringed space $X$,
an invertible $\mathcal{O}_X$-module $\mathcal{L}$, a section
$s \in \Gamma(X, \mathcal{L})$ we get maps
$$
H^p(X, \mathcal{F})
\longrightarrow
H^p(X, \mathcal{F} \otimes_{\mathcal{O}_X} \mathcal{L}), \quad
\xi \longmapsto s\xi
$$
induced by the map
$\mathcal{F} \to \mathcal{F} \otimes_{\mathcal{O}_X} \mathcal{L}$
which is multiplication by $s$.

\begin{lemma}
\label{lemma-section-affine-open-kills-classes}
Let $X$ be a scheme.
Let $\mathcal{L}$ be an invertible $\mathcal{O}_X$-module.
Let $s \in \Gamma(X, \mathcal{L})$ be a section.
Assume that
\begin{enumerate}
\item $X$ is quasi-compact and quasi-separated, and
\item $X_s$ is affine.
\end{enumerate}
Then for every quasi-coherent $\mathcal{O}_X$-module $\mathcal{F}$ and
every $p > 0$ and all $\xi \in H^p(X, \mathcal{F})$ there exists
an $n \geq 0$ such that $s^n\xi = 0$ in
$H^p(X, \mathcal{F} \otimes_{\mathcal{O}_X} \mathcal{L}^{\otimes n})$.
\end{lemma}

\begin{proof}
You can prove this lemma using a Mayer-Vietoris type argument and induction
on the number of affines needed to cover $X$
similar to the proof of Lemma \ref{lemma-quasi-coherence-higher-direct-images}.
This may be preferable to the proof that follows.

\medskip\noindent
Let $\mathcal{F}$ be a quasi-coherent $\mathcal{O}_X$-module.
Cohomology on $X$ commutes with directed colimits of sheaves of
$\mathcal{O}_X$-modules, see 
Cohomology, Lemma \ref{cohomology-lemma-quasi-separated-cohomology-colimit}.
By
Properties, Lemma \ref{properties-lemma-directed-colimit-finite-presentation}
we can write $\mathcal{F}$ as a directed colimit of
$\mathcal{O}_X$-submodules of finite presentation.
Hence every $\xi \in H^p(X, \mathcal{F})$ is the image of
$\xi' \in H^p(X, \mathcal{F}')$ for some
$\mathcal{O}_X$-submodule of finite presentation.
Thus we may replace $\mathcal{F}$
by $\mathcal{F}'$ and assume $\mathcal{F}$ is of finite presentation.

\medskip\noindent
Let $j : X_s \to X$ be the inclusion morphism.
Morphisms, Lemma \ref{morphisms-lemma-affine-s-open}
says that $j$ is an affine morphism.
Hence $R^qj_*(j^*\mathcal{F}) = 0$ for all $q > 0$,
see Lemma \ref{lemma-relative-affine-vanishing}.
Since also $H^p(X_s, j^*\mathcal{F}) = 0$ by
Lemma \ref{lemma-quasi-coherent-affine-cohomology-zero},
we conclude that $H^p(X, j_*j^*\mathcal{F}) = 0$ for all $p > 0$
for example by the Leray spectral sequence (
Cohomology, Lemma \ref{cohomology-lemma-Leray}).
Write
$$
j_*j^*\mathcal{F} = \colim_{\lambda \in \Lambda} \mathcal{F}_\lambda
$$
as a directed colimit of $\mathcal{O}_X$-modules
$\mathcal{F}_\lambda$ of finite presentation
(Properties, Lemma \ref{properties-lemma-directed-colimit-finite-presentation}
again). By
Modules, Lemma \ref{modules-lemma-finite-presentation-quasi-compact-colimit}
there exists a $\lambda \in \Lambda$ such that
$\mathcal{F} \to j_*j^*\mathcal{F}$ factors through $\mathcal{F}_\lambda$.
After shrinking $\Lambda$ we may assume that we have a compatible
collection of morphisms
$\chi_\lambda : \mathcal{F} \to \mathcal{F}_\lambda$
for all $\lambda \in \Lambda$
which when taking the colimit gives the canonical map
$\mathcal{F} \to j_*j^*\mathcal{F}$.

\medskip\noindent
With these preparations the proof goes as follows.
Take $\xi \in H^p(X, \mathcal{F})$ for some $p > 0$.
It maps to zero in $H^p(X, j_*j^*\mathcal{F})$ because we saw above this
group is zero. By
Cohomology, Lemma \ref{cohomology-lemma-quasi-separated-cohomology-colimit}
again it follows that $\xi$ maps to zero in $H^p(X, \mathcal{F}_\lambda)$
via the map $\chi_\lambda$ for
some $\lambda$. Note that since $\mathcal{F} \to j_*j^*\mathcal{F}$
is an isomorphism over $X_s$ we see that there is an $\mathcal{O}_{X_s}$-module
map $\psi : \mathcal{F}_\lambda|_{X_s} \to \mathcal{F}|_{X_s}$ which
is a left inverse to $\chi_\lambda : \mathcal{F} \to \mathcal{F}_\lambda$.
By Lemma \ref{lemma-section-maps-backwards}
there exists an $n$ and a map
$\alpha : \mathcal{F}_\lambda \to
\mathcal{F} \otimes_{\mathcal{O}_X} \mathcal{L}^{\otimes n}$
such that $\alpha$ restricts to $\psi$ on $X_s$ (via
$\mathcal{L}^{\otimes n}|_{X_s} \cong \mathcal{O}_{X_s}$).
By the uniqueness part of Lemma \ref{lemma-section-maps-backwards}
applied to $\alpha \circ \chi_\lambda$ which restricts to
multiplication by $s^n$ on $X_s$
we may assume (after increasing $n$) that the composition
$$
\xymatrix{
\mathcal{F}
\ar[r]_-{\chi_\lambda} &
\mathcal{F}_\lambda
\ar[r]_-{\alpha} &
\mathcal{F} \otimes_{\mathcal{O}_X} \mathcal{L}^{\otimes n}
}
$$
is equal to multiplication by $s^n$ on $\mathcal{F}$.
Hence we see that $s^n\xi = 0$.
\end{proof}











\section{Cohomology of projective space}
\label{section-cohomology-projective-space}

\noindent
In this section we compute the cohomology of the twists of the
structure sheaf on $\mathbf{P}^n_S$ over a scheme $S$.
Recall that $\mathbf{P}^n_S$ was defined as the fibre product
$
\mathbf{P}^n_S = S \times_{\Spec(\mathbf{Z})} \mathbf{P}^n_{\mathbf{Z}}
$
in Constructions, Definition \ref{constructions-definition-projective-space}.
It was shown to be equal to
$$
\mathbf{P}^n_S = \underline{\text{Proj}}_S(\mathcal{O}_S[T_0, \ldots, T_n])
$$
in Constructions, Lemma \ref{constructions-lemma-projective-space-bundle}.
In particular, projective space is a particular case of a projective bundle.
If $S = \Spec(R)$ is affine then we have
$$
\mathbf{P}^n_S = \mathbf{P}^n_R = \text{Proj}(R[T_0, \ldots, T_n]).
$$
All these identifications are compatible and compatible with the constructions
of the twisted structure sheaves $\mathcal{O}_{\mathbf{P}^n_S}(d)$.

\medskip\noindent
Before we state the result we need some notation.
Let $R$ be a ring.
Recall that $R[T_0, \ldots, T_n]$ is a graded
$R$-algebra where each $T_i$ is homogenous of degree $1$.
Denote $(R[T_0, \ldots, T_n])_d$ the degree $d$ summand.
It is a finite free $R$-module of rank $\binom{n + d}{d}$
when $d \geq 0$ and zero else.
It has a basis consisting of monomials $T_0^{e_0} \ldots T_n^{e_n}$
with $\sum e_i = d$. We will also use the following notation:
$R[\frac{1}{T_0}, \ldots, \frac{1}{T_n}]$ denotes the $\mathbf{Z}$-graded
ring with $\frac{1}{T_i}$ in degree $-1$. In particular the
$\mathbf{Z}$-graded $R[\frac{1}{T_0}, \ldots, \frac{1}{T_n}]$ module
$$
\frac{1}{T_0 \ldots T_n} R[\frac{1}{T_0}, \ldots, \frac{1}{T_n}]
$$
which shows up in the statement below is zero in degrees
$\geq -n$, is free on the generator $\frac{1}{T_0 \ldots T_n}$
in degree $-n - 1$ and is free of rank $(-1)^n\binom{n + d}{d}$ for
$d \leq -n - 1$.

\begin{lemma}
\label{lemma-cohomology-projective-space-over-ring}
Let $R$ be a ring.
Let $n \geq 0$ be an integer.
We have
$$
H^q(\mathbf{P}^n, \mathcal{O}_{\mathbf{P}^n_R}(d)) =
\left\{
\begin{matrix}
(R[T_0, \ldots, T_n])_d & \text{if} & q = 0 \\
0 & \text{if} & q \not = 0, n \\
\left(\frac{1}{T_0 \ldots T_n} R[\frac{1}{T_0}, \ldots, \frac{1}{T_n}]\right)_d
& \text{if} & q = n
\end{matrix}
\right.
$$
as $R$-modules.
\end{lemma}

\begin{proof}
We will use the standard affine open convering
$$
\mathcal{U} : \mathbf{P}^n_R = \bigcup\nolimits_{i = 0}^n D_{+}(T_i)
$$
to compute the cohomology using the Cech complex.
This is permissible by Lemma \ref{lemma-cech-cohomology-quasi-coherent}
since any intersection of finitely many affine $D_{+}(T_i)$ is also a
standard affine open (see
Constructions, Section \ref{constructions-section-proj}).
In fact, we can use the alternating or ordered Cech complex according to
Cohomology, Lemmas \ref{cohomology-lemma-ordered-alternating} and
\ref{cohomology-lemma-alternating-usual}.

\medskip\noindent
The ordering we will use on $\{0, \ldots, n\}$ is the usual one.
Hence the complex we are looking at has terms
$$
\check{\mathcal{C}}_{ord}^p(\mathcal{U}, \mathcal{O}_{\mathbf{P}_R}(d))
=
\bigoplus\nolimits_{i_0 < \ldots < i_p}
(R[T_0, \ldots, T_n, \frac{1}{T_{i_0} \ldots T_{i_p}}])_d
$$
Moreover, the maps are given by the usual formula
$$
d(s)_{i_0 \ldots i_{p + 1}} =
\sum\nolimits_{j = 0}^{p + 1} (-1)^j s_{i_0 \ldots \hat i_j \ldots i_{p + 1}}
$$
see Cohomology, Section \ref{cohomology-section-alternating-cech}.
Note that each term of this complex has a natural
$\mathbf{Z}^{n + 1}$-grading. Namely, we get this by declaring a monomial
$T_0^{e_0} \ldots T_n^{e_n}$ to be homogeneous with weight
$(e_0, \ldots, e_n) \in \mathbf{Z}^{n + 1}$. It is clear that the differential
given above respects the grading. In a formula we have
$$
\check{\mathcal{C}}_{ord}^\bullet(\mathcal{U}, \mathcal{O}_{\mathbf{P}_R}(d))
=
\bigoplus\nolimits_{\vec{e} \in \mathbf{Z}^{n + 1}}
\check{\mathcal{C}}^\bullet(\vec{e})
$$
where not all summand on the right hand side occur (see below).
Hence in order to compute the cohomology
modules of the complex it suffices to compute the cohomology of the graded
pieces and take the direct sum at the end.

\medskip\noindent
Fix $\vec{e} = (e_0, \ldots, e_n) \in \mathbf{Z}^{n + 1}$. In order for this
weight to occur in the complex above we need to assume
$e_0 + \ldots + e_n = d$ (if not then it occurs for a different twist of
the structure sheaf of course). Assuming this set
$$
NEG(\vec{e}) = \{i \in \{0, \ldots, n\} \mid e_i < 0\}.
$$
With this notation the weight $\vec{e}$ summand
$\check{\mathcal{C}}^\bullet(\vec{e})$ of the Cech complex above has
the following terms
$$
\check{\mathcal{C}}^p(\vec{e})
=
\bigoplus\nolimits_{i_0 < \ldots < i_p,
\ NEG(\vec{e}) \subset \{i_0, \ldots, i_p\}}
R \cdot T_0^{e_0} \ldots T_n^{e_n}
$$
In other words, the terms corresponding to $i_0 < \ldots < i_p$ such
that $NEG(\vec{e})$ is not contained in $\{i_0 \ldots i_p\}$ are zero.
The differential of the complex $\check{\mathcal{C}}^\bullet(\vec{e})$
is still given by the exact same formula as above.

\medskip\noindent
Suppose that $NEG(\vec{e}) = \{0, \ldots, n\}$, i.e., that all
exponents $e_i$ are negative.
In this case the complex $\check{\mathcal{C}}^\bullet(\vec{e})$ has
only one term, namely $\check{\mathcal{C}}^n(\vec{e}) = 
R \cdot \frac{1}{T^{-e_0} \ldots T^{-e_n}}$. Hence in this
case
$$
H^q(\check{\mathcal{C}}^\bullet(\vec{e})) =
\left\{
\begin{matrix}
R \cdot \frac{1}{T^{-e_0} \ldots T^{-e_n}} & \text{if} & q = n \\
0 & \text{if} & \text{else}
\end{matrix}
\right.
$$
The direct sum of all of these terms clearly gives the value
$$
\left(\frac{1}{T_0 \ldots T_n} R[\frac{1}{T_0}, \ldots, \frac{1}{T_n}]\right)_d
$$
in degree $n$ as stated in the lemma. Moreover these terms do not contribute
to cohomology in other degrees (also in accordance with the statement of the
lemma).

\medskip\noindent
Assume $NEG(\vec{e}) = \emptyset$. In this case the complex
$\check{\mathcal{C}}^\bullet(\vec{e})$ has a summand $R$ corresponding
to all $i_0 < \ldots < i_p$.
Let us compare the complex $\check{\mathcal{C}}^\bullet(\vec{e})$
to another complex. Namely, consider the affine open open covering
$$
\mathcal{V} : \Spec(R) = \bigcup\nolimits_{i \in \{0, \ldots, n\}} V_i
$$
where $V_i = \Spec(R)$ for all $i$. Consider the alternating
Cech complex
$$
\check{\mathcal{C}}_{ord}^\bullet(\mathcal{V}, \mathcal{O}_{\Spec(R)})
$$
By the same reasoning as above this computes the cohomology of the
structure sheaf on $\Spec(R)$. Hence we see that
$H^p(
\check{\mathcal{C}}_{ord}^\bullet(\mathcal{V}, \mathcal{O}_{\Spec(R)})
) = R$ if $p = 0$ and is $0$ whenever $p > 0$.
For these facts, see
Lemma \ref{lemma-cech-cohomology-quasi-coherent-trivial} and its proof.
Note that also
$\check{\mathcal{C}}_{ord}^\bullet(\mathcal{V}, \mathcal{O}_{\Spec(R)})$
has a summand $R$ for every $i_0 < \ldots < i_p$ and has exactly the same
differential as $\check{\mathcal{C}}^\bullet(\vec{e})$. In other words
these complexes are isomorphic complexes and hence have the same cohomology.
We conclude that
$$
H^q(\check{\mathcal{C}}^\bullet(\vec{e})) =
\left\{
\begin{matrix}
R \cdot T^{e_0} \ldots T^{e_n} & \text{if} & q = 0 \\
0 & \text{if} & \text{else}
\end{matrix}
\right.
$$
in the case that $NEG(\vec{e}) = \emptyset$.
The direct sum of all of these terms clearly gives the value
$$
(R[T_0, \ldots, T_n])_d
$$
in degree $0$ as stated in the lemma. Moreover these terms do not contribute
to cohomology in other degrees (also in accordance with the statement of the
lemma).

\medskip\noindent
To finish the proof of the lemma we have to show that the complexes
$\check{\mathcal{C}}^\bullet(\vec{e})$ are acyclic when
$NEG(\vec{e})$ is neither empty nor equal to $\{0, \ldots, n\}$.
Pick an index $i_{\text{fix}} \not \in NEG(\vec{e})$ (such an index exists).
Consider the map
$$
h :
\check{\mathcal{C}}^{p + 1}(\vec{e})
\to
\check{\mathcal{C}}^p(\vec{e})
$$
given by the rule
$$
h(s)_{i_0 \ldots i_p} = s_{i_{\text{fix}} i_0 \ldots i_p}
$$
(compare with the proof of
Lemma \ref{lemma-cech-cohomology-quasi-coherent-trivial}).
It is clear that this is well defined since
$$
NEG(\vec{e}) \subset \{i_0, \ldots, i_p\}
\Leftrightarrow
NEG(\vec{e}) \subset \{i_{\text{fix}}, i_0, \ldots, i_p\}
$$
Also $\check{\mathcal{C}}^0(\vec{e}) = 0$ so that this
formula does work for all $p$ including $p = - 1$.
The exact same (combinatorial) computation as in the
proof of Lemma \ref{lemma-cech-cohomology-quasi-coherent-trivial}
shows that
$$
(hd + dh)(s)_{i_0 \ldots i_p}
=
s_{i_0 \ldots i_p}
$$
Hence we see that the identity map of the complex
$\check{\mathcal{C}}^\bullet(\vec{e})$ is homotopic to zero
which implies that it is acyclic.
\end{proof}

\noindent
In the following lemma we are going to use the pairing of free
$R$-modules
$$
R[T_0, \ldots, T_n]
\times
\frac{1}{T_0 \ldots T_n} R[\frac{1}{T_0}, \ldots, \frac{1}{T_n}]
\longrightarrow
R
$$
which is defined by the rule
$$
(f, g)
\longmapsto
\text{coefficient of }
\frac{1}{T_0 \ldots T_n}
\text{ in }fg.
$$
In other words, the basis element $T_0^{e_0} \ldots T_n^{e_n}$ pairs
with the basis element $T_0^{d_0} \ldots T_n^{d_n}$ to give $1$ if and only
if $e_i + d_i = -1$ for all $i$, and pairs to zero in all other cases.
Using this pairing we get an identification
$$
\left(\frac{1}{T_0 \ldots T_n} R[\frac{1}{T_0}, \ldots, \frac{1}{T_n}]\right)_d
=
\text{Hom}_R((R[T_0, \ldots, T_n])_{-n - 1 - d}, R)
$$
Thus we can reformulate the result of
Lemma \ref{lemma-cohomology-projective-space-over-ring} as saying that
\begin{equation}
\label{equation-identify}
H^q(\mathbf{P}^n, \mathcal{O}_{\mathbf{P}^n_R}(d)) =
\left\{
\begin{matrix}
(R[T_0, \ldots, T_n])_d & \text{if} & q = 0 \\
0 & \text{if} & q \not = 0, n \\
\text{Hom}_R((R[T_0, \ldots, T_n])_{-n - 1 - d}, R)
& \text{if} & q = n
\end{matrix}
\right.
\end{equation}

\begin{lemma}
\label{lemma-identify-functorially}
The identifications of Equation (\ref{equation-identify}) are
compatible with base change w.r.t.\ ring maps $R \to R'$.
Moreover, for any $f \in R[T_0, \ldots, T_n]$ homogeneous
of degree $m$ the map multiplication by $f$
$$
\mathcal{O}_{\mathbf{P}^n_R}(d)
\longrightarrow
\mathcal{O}_{\mathbf{P}^n_R}(d + m)
$$
induces the map on the cohomology group via the identifications
of Equation (\ref{equation-identify}) which is multiplication by
$f$ for $H^0$ and the contragredient of multiplication by $f$
$$
(R[T_0, \ldots, T_n])_{-n - 1 - (d + m)}
\longrightarrow
(R[T_0, \ldots, T_n])_{-n - 1 - d}
$$
on $H^n$.
\end{lemma}

\begin{proof}
Suppose that $R \to R'$ is a ring map.
Let $\mathcal{U}$ be the standard affine open convering of $\mathbf{P}^n_R$,
and let $\mathcal{U}'$ be the standard affine open convering of
$\mathbf{P}^n_{R'}$. Note that $\mathcal{U}'$ is the pullback of the covering
$\mathcal{U}$ under the canonical morphism
$\mathbf{P}^n_{R'} \to \mathbf{P}^n_R$. Hence there
is a map of Cech complexes
$$
\gamma :
\check{\mathcal{C}}_{ord}^\bullet(\mathcal{U},
\mathcal{O}_{\mathbf{P}_R}(d))
\longrightarrow
\check{\mathcal{C}}_{ord}^\bullet(\mathcal{U}',
\mathcal{O}_{\mathbf{P}_{R'}}(d))
$$
which is compatible with the map on cohomology by
Cohomology, Lemma \ref{cohomology-lemma-functoriality-cech}.
It is clear from the computations in the proof of
Lemma \ref{lemma-cohomology-projective-space-over-ring}
that this map of Cech complexes is compatible with the identifications
of the cohomology groups in question. (Namely the basis elements for
the Cech complex over $R$ simply map to the corresponding basis elements
for the Cech complex over $R'$.) Whence the first statement of the lemma.

\medskip\noindent
Now fix the ring $R$ and consider two homogeneous polynomials
$f, g \in R[T_0, \ldots, T_n]$ both of the same degree $m$.
Since cohomology is an additive functor, it is clear that the
map induced by multiplication by $f + g$ is the same as the sum
of the maps induced by multiplication by $f$ and the map induced
by multiplication by $g$. Moreover, since cohomology is a functor
a similar result holds for multiplication by a product $fg$ where
$f, g$ are both homogeneous (but not necessarily of the same degree).
Hence to verify the second statement of the lemma it suffices to
prove this when $f = x \in R$ or when $f = T_i$.
In the case of multiplication by an element $x \in R$ the result
follows since every cohomology groups or complex in sight has the
structuce or an $R$-module or complex of $R$-modules.
Finally, we consider the case of multiplication by $T_i$
as a $\mathcal{O}_{\mathbf{P}^n_R}$-linear map 
$$
\mathcal{O}_{\mathbf{P}^n_R}(d)
\longrightarrow
\mathcal{O}_{\mathbf{P}^n_R}(d + 1)
$$
The statement on $H^0$ is clear. For the statement on $H^n$ 
consider multiplication by $T_i$ as a map on Cech complexes
$$
\check{\mathcal{C}}_{ord}^\bullet(\mathcal{U},
\mathcal{O}_{\mathbf{P}_R}(d))
\longrightarrow
\check{\mathcal{C}}_{ord}^\bullet(\mathcal{U},
\mathcal{O}_{\mathbf{P}_{R}}(d + 1))
$$
We are going to use the notation introduced in the proof of
Lemma \ref{lemma-cohomology-projective-space-over-ring}.
We consider the effect of multiplication by $T_i$
in terms of the decompositions
$$
\check{\mathcal{C}}_{ord}^\bullet(\mathcal{U}, \mathcal{O}_{\mathbf{P}_R}(d))
=
\bigoplus\nolimits_{\vec{e} \in \mathbf{Z}^{n + 1},\ \sum e_i = d}
\check{\mathcal{C}}^\bullet(\vec{e})
$$
and
$$
\check{\mathcal{C}}_{ord}^\bullet(\mathcal{U},
\mathcal{O}_{\mathbf{P}_R}(d + 1))
=
\bigoplus\nolimits_{\vec{e} \in \mathbf{Z}^{n + 1},\ \sum e_i = d + 1}
\check{\mathcal{C}}^\bullet(\vec{e})
$$
It is clear that it maps the subcomplex
$\check{\mathcal{C}}^\bullet(\vec{e})$ to the subcomplex
$\check{\mathcal{C}}^\bullet(\vec{e} + \vec{b}_i)$ where
$\vec{b}_i = (0, \ldots, 0, 1, 0, \ldots, 0))$ the $i$th basis vector.
In other words, it maps the summand of $H^n$ corresponding to
$\vec{e}$ with $e_i < 0$ and $\sum e_i = d$
to the summand of $H^n$ corresponding to
$\vec{e} + \vec{b}_i$ (which is zero if $e_i + b_i \geq 0$).
It is easy to see that this corresponds exactly to the action
of the contragredient of multiplication by $T_i$ as a map
$$
(R[T_0, \ldots, T_n])_{-n - 1 - (d + 1)}
\longrightarrow
(R[T_0, \ldots, T_n])_{-n - 1 - d}
$$
This proves the lemma.
\end{proof}

\noindent
Before we state the relative version we need some notation.
Namely, recall that $\mathcal{O}_S[T_0, \ldots, T_n]$ is a graded
$\mathcal{O}_S$-module where each $T_i$ is homogenous of degree $1$.
Denote $(\mathcal{O}_S[T_0, \ldots, T_n])_d$ the degree $d$ summand.
It is a finite locally free sheaf of rank $\binom{n + d}{d}$ on $S$.

\begin{lemma}
\label{lemma-cohomology-projective-space-over-base}
Let $S$ be a scheme.
Let $n \geq 0$ be an integer.
Consider the structure morphism
$$
f : \mathbf{P}^n_S \longrightarrow S.
$$
We have
$$
R^qf_*(\mathcal{O}_{\mathbf{P}^n_S}(d)) =
\left\{
\begin{matrix}
(\mathcal{O}_S[T_0, \ldots, T_n])_d & \text{if} & q = 0 \\
0 & \text{if} & q \not = 0, n \\
\textit{Hom}_{\mathcal{O}_S}(
(\mathcal{O}_S[T_0, \ldots, T_n])_{- n - 1 - d}, \mathcal{O}_S)
& \text{if} & q = n
\end{matrix}
\right.
$$
\end{lemma}

\begin{proof}
Omitted. Hint: This follows since the identifications in
(\ref{equation-identify}) are compatible with affine base change
by Lemma \ref{lemma-identify-functorially}.
\end{proof}

\noindent
Next we state the version for projective bundles associated to finite locally
free sheaves. Let $S$ be a scheme. Let $\mathcal{E}$ be a finite locally
free $\mathcal{O}_S$-module of constant rank $n + 1$, see
Modules, Section \ref{modules-section-locally-free}.
In this case we think of $\text{Sym}(\mathcal{E})$ as a graded
$\mathcal{O}_S$-module where $\mathcal{E}$ is the graded part of degree $1$.
And $\text{Sym}^d(\mathcal{E})$ is the degree $d$ summand.
It is a finite locally free sheaf of rank $\binom{n + d}{d}$ on $S$.
Recall that our normalization is that
$$
\pi :
\mathbf{P}(\mathcal{E})
=
\underline{\text{Proj}}_S(\text{Sym}(\mathcal{E}))
\longrightarrow
S
$$
and that there are natural maps
$\text{Sym}^d(\mathcal{E}) \to \pi_*\mathcal{O}_{\mathbf{P}(\mathcal{E})}(d)$.

\begin{lemma}
\label{lemma-cohomology-projective-bundle}
Let $S$ be a scheme. Let $n \geq 1$.
Let $\mathcal{E}$ be a finite locally
free $\mathcal{O}_S$-module of constant rank $n + 1$.
Consider the structure morphism
$$
\pi : \mathbf{P}(\mathcal{E}) \longrightarrow S.
$$
We have
$$
R^q\pi_*(\mathcal{O}_{\mathbf{P}(\mathcal{E})}(d)) =
\left\{
\begin{matrix}
\text{Sym}^d(\mathcal{E}) & \text{if} & q = 0 \\
0 & \text{if} & q \not = 0, n \\
\textit{Hom}_{\mathcal{O}_S}(
\text{Sym}^{- n - 1 - d}(\mathcal{E})
\otimes_{\mathcal{O}_S}
\wedge^{n + 1}\mathcal{E},
\mathcal{O}_S)
& \text{if} & q = n
\end{matrix}
\right.
$$
These identifications are compatible with base change and
isomorphism between locally free sheaves.
\end{lemma}

\begin{proof}
Consider the canonical map
$$
\pi^*\mathcal{E} \longrightarrow \mathcal{O}_{\mathbf{P}(\mathcal{E})}(1)
$$
and twist down by $1$ to get
$$
\pi^*(\mathcal{E})(-1) \longrightarrow \mathcal{O}_{\mathbf{P}(\mathcal{E})}
$$
This is a surjective map from a locally free rank $n + 1$ sheaf onto
the structure sheaf. Hence the corresponding Koszul complex is
exact (insert future reference here). In other words there is an
exact complex
$$
0 \to
\pi^*(\wedge^{n + 1}\mathcal{E})(-n - 1) \to
\ldots \to
\pi^*(\wedge^i\mathcal{E})(-i) \to
\ldots \to
\mathcal{E}(-1) \to
\mathcal{O}_{\mathbf{P}(\mathcal{E})} \to 0
$$
We will think of the term $\pi^*(\wedge^i\mathcal{E})(-i)$ as being
in degree $-i$.
We are going to compute the higher direct images
of this acyclic complex using the first spectral sequence of
Derived Categories, Lemma \ref{derived-lemma-two-ss-complex-functor}.
Namely, we see that there is a spectral sequence with terms
$$
E_2^{p, q} = H^p(L^{\bullet, q})
\quad
\text{with}
\quad
L^{-i, q} = R^q\pi_*\left(\pi^*(\wedge^i\mathcal{E})(-i)\right)
$$
converging to zero!
By the projection formula (
Cohomology, Lemma \ref{cohomology-lemma-projection-formula})
we have
$$
L^{-i, q} = \wedge^i\mathcal{E} \otimes_{\mathcal{O}_S}
R^q\pi_*\left(\mathcal{O}_{\mathbf{P}(\mathcal{E})}(-i)\right).
$$
Note that locally on $S$ the sheaf $\mathcal{E}$ is trivial,
i.e., isomorphic to $\mathcal{O}_S^{\oplus n + 1}$, hence locally on
$S$ the morphism $\mathbf{P}(\mathcal{E}) \to S$ can be identified
with $\mathbf{P}^n_S \to S$. Hence
locally on $S$ we can use the result of Lemmas
\ref{lemma-cohomology-projective-space-over-ring},
\ref{lemma-identify-functorially}, or
\ref{lemma-cohomology-projective-space-over-base}.
It follows that $L^{-i, q} = 0$ unless $i = q = 0$
or $i = n + 1$ and $q = n$. This in turn implies that
$E_2^{p, q} = 0$ unless $(p, q) = (0, 0)$ or
$(p, q) = (-n - 1, n)$, and
\begin{align*}
E_2^{0, 0} & = \pi_*\mathcal{O}_{\mathbf{P}(\mathcal{E})} = \mathcal{O}_S
\\
E_2^{-n - 1, n} & = \wedge^{n + 1}\mathcal{E} \otimes_{\mathcal{O}_S}
R^n\pi_*\left(\mathcal{O}_{\mathbf{P}(\mathcal{E})}(-n - 1)\right).
\end{align*}
Hence there can only be one nonzero
differential in the spectral sequence namely the map
$d_{n + 1}$ inducing a map
$$
d_{n + 1}^{0, 0} :
\mathcal{O}_S
\longrightarrow
\wedge^{n + 1}\mathcal{E} \otimes_{\mathcal{O}_S}
R^n\pi_*\left(\mathcal{O}_{\mathbf{P}(\mathcal{E})}(-n - 1)\right)
$$
which has to be an isomorphism (because the spectral sequence converges
to the $0$ sheaf). Since $\wedge^{n + 1}\mathcal{E}$ is an invertible
sheaf, this implies that
$R^n\pi_*\mathcal{O}_{\mathbf{P}(\mathcal{E})}(-n - 1)$ is invertible
as well and canonically isomorphic to the inverse of
$\wedge^{n + 1}\mathcal{E}$. In other words we have proved the case
$d = - n - 1$ of the lemma.

\medskip\noindent
Working locally on $S$ we see immediately from the computation of
cohomology in Lemmas \ref{lemma-cohomology-projective-space-over-ring},
\ref{lemma-identify-functorially}, or
\ref{lemma-cohomology-projective-space-over-base} the statements on
vanishing of the lemma. Moreover the result on $R^0\pi_*$ is clear
as well, since there are canonical maps
$\text{Sym}^d(\mathcal{E}) \to \pi_* \mathcal{O}_{\mathbf{P}(\mathcal{E})}(d)$
for all $d$. It remains to show that the description of
$R^n\pi_*\mathcal{O}_{\mathbf{P}(\mathcal{E})}(d)$ is correct
for $d < -n - 1$. In other to do this we consider the map
$$
\pi^*(\text{Sym}^{-d + n + 1}(\mathcal{E}))
\otimes_{\mathcal{O}_{\mathbf{P}(\mathcal{E})}}
\mathcal{O}_{\mathbf{P}(\mathcal{E})}(d)
\longrightarrow
\mathcal{O}_{\mathbf{P}(\mathcal{E})}(-n - 1)
$$
Applying $R^n\pi_*$ and the projection formula (see above) we get a map
$$
\text{Sym}^{-d + n + 1}(\mathcal{E})
\otimes_{\mathcal{O}_S}
R^n\pi_*(\mathcal{O}_{\mathbf{P}(\mathcal{E})}(d))
\longrightarrow
R^n\pi_*\mathcal{O}_{\mathbf{P}(\mathcal{E})}(-n - 1) =
(\wedge^{n + 1}\mathcal{E})^{\otimes -1}
$$
(the last equality we have shown above).
Again by the local calculations of Lemmas
\ref{lemma-cohomology-projective-space-over-ring},
\ref{lemma-identify-functorially}, or
\ref{lemma-cohomology-projective-space-over-base}
it follows that this map induces a perfect pairing between
$R^n\pi_*(\mathcal{O}_{\mathbf{P}(\mathcal{E})}(d))$ and
$\text{Sym}^{-d + n + 1}(\mathcal{E}) \otimes \wedge^{n + 1}(\mathcal{E})$
as desired.
\end{proof}






\section{Supports of modules}
\label{section-support}

\noindent
In this section we collect some elementary results on supports of
quasi-coherent modules on schemes.
Recall that the support of a sheaf of modules has been defined in
Modules, Section \ref{modules-section-support}.
On the other hand, the support of a module was defined in
Algebra, Section \ref{algebra-section-support}.
These match.

\begin{lemma}
\label{lemma-support-affine-open}
Let $X$ be a scheme. Let $\mathcal{F}$ be a quasi-coherent sheaf on $X$.
Let $\Spec(A) = U \subset X$ be an affine open, and set
$M = \Gamma(U, \mathcal{F})$.
Let $x \in U$, and let $\mathfrak p \subset A$ be the corresponding prime.
The following are equivalent
\begin{enumerate}
\item $\mathfrak p$ is in the support of $M$, and
\item $x$ is in the support of $\mathcal{F}$.
\end{enumerate}
\end{lemma}

\begin{proof}
This follows from the equality $\mathcal{F}_x = M_{\mathfrak p}$, see
Schemes, Lemma \ref{schemes-lemma-spec-sheaves}
and the definitions.
\end{proof}

\begin{lemma}
\label{lemma-support-closed-specialization}
Let $X$ be a scheme.
Let $\mathcal{F}$ be a quasi-coherent sheaf on $X$.
The support of $\mathcal{F}$ is closed under specialization.
\end{lemma}

\begin{proof}
If $x' \leadsto x$ is a specialization and $\mathcal{F}_x = 0$
then $\mathcal{F}_{x'}$ is zero, as $\mathcal{F}_{x'}$ is a localization
of the module $\mathcal{F}_x$. Hence the complement of
$\text{Supp}(\mathcal{F})$ is closed under generalization.
\end{proof}

\noindent
For finite type quasi-coherent modules the support is closed,
can be checked on fibres, and commutes with base change.

\begin{lemma}
\label{lemma-support-finite-type}
Let $\mathcal{F}$ be a finite type quasi-coherent module
on a scheme $X$. Then
\begin{enumerate}
\item The support of $\mathcal{F}$ is closed.
\item For $x \in X$ we have
$$
x \in \text{Supp}(\mathcal{F})
\Leftrightarrow
\mathcal{F}_x \not = 0
\Leftrightarrow
\mathcal{F}_x \otimes_{\mathcal{O}_{X, x}} \kappa(x) \not = 0.
$$
\item For any morphism of schemes $f : Y \to X$ the pullback
$f^*\mathcal{F}$ is of finite type as well and we have
$\text{Supp}(f^*\mathcal{F}) = f^{-1}(\text{Supp}(\mathcal{F}))$.
\end{enumerate}
\end{lemma}

\begin{proof}
Part (1) is a reformulation of
Modules, Lemma \ref{modules-lemma-support-finite-type-closed}.
You can also combine
Lemma \ref{lemma-support-affine-open},
Properties, Lemma \ref{properties-lemma-finite-type-module},
and
Algebra, Lemma \ref{algebra-lemma-support-closed}
to see this. The first equivalence in (2) is the definition
of support, and the second equivalence follows from
Nakayama's lemma, see
Algebra, Lemma \ref{algebra-lemma-NAK}.
Let $f : Y \to X$ be a morphism of schemes. Note that
$f^*\mathcal{F}$ is of finite type by
Modules, Lemma \ref{modules-lemma-pullback-finite-type}.
For the final assertion, let $y \in Y$ with image $x \in X$.
Recall that
$$
(f^*\mathcal{F})_y =
\mathcal{F}_x \otimes_{\mathcal{O}_{X, x}} \mathcal{O}_{Y, y},
$$
see
Sheaves, Lemma \ref{sheaves-lemma-stalk-pullback-modules}.
Hence $(f^*\mathcal{F})_y \otimes \kappa(y)$ is nonzero
if and only if $\mathcal{F}_x \otimes \kappa(x)$ is nonzero.
By (2) this implies $x \in \text{Supp}(\mathcal{F})$ if and only
if $y \in \text{Supp}(f^*\mathcal{F})$, which is the content of
assertion (3).
\end{proof}

\begin{lemma}
\label{lemma-scheme-theoretic-support}
Let $\mathcal{F}$ be a finite type quasi-coherent module
on a scheme $X$. There exists a smallest closed subscheme
$i : Z \to X$ such that there exists a quasi-coherent
$\mathcal{O}_Z$-module $\mathcal{G}$ with
$i_*\mathcal{G} \cong \mathcal{F}$. Moreover:
\begin{enumerate}
\item If $\Spec(A) \subset X$ is any affine open, and
$\mathcal{F}|_{\Spec(A)} = \widetilde{M}$ then
$Z \cap \Spec(A) = \Spec(A/I)$ where $I = \text{Ann}_A(M)$.
\item The quasi-coherent sheaf $\mathcal{G}$ is unique up to unique
isomorphism.
\item The quasi-coherent sheaf $\mathcal{G}$ is of finite type.
\item The support of $\mathcal{G}$ and of $\mathcal{F}$ is $Z$.
\end{enumerate}
\end{lemma}

\begin{proof}
Suppose that $i' : Z' \to X$ is a closed subscheme which satisfies the
description on open affines from the lemma. Then by
Morphisms, Lemma \ref{morphisms-lemma-i-star-equivalence}
we see that $\mathcal{F} \cong i'_*\mathcal{G}'$ for some unique
quasi-coherent sheaf $\mathcal{G}'$ on $Z'$. Furthermore, it is clear
that $Z'$ is the smallest closed subscheme with this property (by the
same lemma). Finally, using
Properties, Lemma \ref{properties-lemma-finite-type-module}
and
Algebra, Lemma \ref{algebra-lemma-finite-over-subring}
it follows that $\mathcal{G}'$ is of finite type. We have
$\text{Supp}(\mathcal{G}') = Z$ by
Algebra, Lemma \ref{algebra-lemma-support-closed}.
Hence, in order to prove the lemma it suffices to show that
the characterization in (1) actually does define a closed subscheme.
And, in order to do this it suffices to prove that the given rule
produces a quasi-coherent sheaf of ideals, see
Morphisms, Lemma \ref{morphisms-lemma-closed-immersion-bijection-ideals}.
This comes down to the following algebra fact: If $A$ is a ring, $f \in A$,
and $M$ is a finite $A$-module, then
$\text{Ann}_A(M)_f = \text{Ann}_{A_f}(M_f)$.
We omit the proof.
\end{proof}

\begin{definition}
\label{definition-scheme-theoretic-support}
Let $X$ be a scheme. Let $\mathcal{F}$ be a quasi-coherent
$\mathcal{O}_X$-module of finite type. The {\it scheme theoretic support
of $\mathcal{F}$} is the closed subscheme $Z \subset X$ constructed in
Lemma \ref{lemma-scheme-theoretic-support}.
\end{definition}

\noindent
In this situation we often think of $\mathcal{F}$ as a quasi-coherent
sheaf of finite type on $Z$ (via the equivalence of categories of
Morphisms, Lemma \ref{morphisms-lemma-i-star-equivalence}).











\section{Coherent sheaves on locally Noetherian schemes}
\label{section-coherent-sheaves}

\noindent
Allthough it is possible to consider coherent sheaves on non-Noetherian
schemes we will always assume the base scheme is locally Noetherian when
we consider coherent sheaves. Here is a characterization of coherent
sheaves on locally Noetherian schemes.

\begin{lemma}
\label{lemma-coherent-Noetherian}
Let $X$ be a locally Noetherian scheme.
Let $\mathcal{F}$ be an $\mathcal{O}_X$-module.
The following are equivalent
\begin{enumerate}
\item $\mathcal{F}$ is coherent,
\item $\mathcal{F}$ is a quasi-coherent, finite type $\mathcal{O}_X$-module,
\item $\mathcal{F}$ is a finitely presented $\mathcal{O}_X$-module,
\item for any affine open $\Spec(A) = U \subset X$ we have
$\mathcal{F}|_U = \widetilde M$ with $M$ a finite $A$-module, and
\item there exists an affine open covering $X = \bigcup U_i$,
$U_i = \Spec(A_i)$ such that each
$\mathcal{F}|_{U_i} = \widetilde M_i$ with $M_i$ a finite $A_i$-module.
\end{enumerate}
In particular $\mathcal{O}_X$ is coherent, any invertible
$\mathcal{O}_X$-module is coherent, and more generally any
finite locally free $\mathcal{O}_X$-module is invertible.
\end{lemma}

\begin{proof}
The implications (1) $\Rightarrow$ (2) and (1) $\Rightarrow$ (3) hold
in general, see
Modules, Lemma \ref{modules-lemma-coherent-finite-presentation}.
If $\mathcal{F}$ is finitely presented then $\mathcal{F}$ is
quasi-coherent, see
Modules, Lemma \ref{modules-lemma-finite-presentation-quasi-coherent}.
Hence also (3) $\Rightarrow$ (2).

\medskip\noindent
Assume $\mathcal{F}$ is a quasi-coherent, finite type $\mathcal{O}_X$-module.
By
Properties, Lemma \ref{properties-lemma-finite-type-module}
we see that on any affine open
$\Spec(A) = U \subset X$ we have $\mathcal{F}|_U = \widetilde M$
with $M$ a finite $A$-module. Since $A$ is Noetherian we see that
$M$ has a finite resolution
$$
A^{\oplus m} \to A^{\oplus n} \to M \to 0.
$$
Hence $\mathcal{F}$ is of finite presentation by
Properties, Lemma \ref{properties-lemma-finite-presentation-module}.
In other words (2) $\Rightarrow$ (3).

\medskip\noindent
By Modules, Lemma \ref{modules-lemma-coherent-structure-sheaf} it suffices
to show that $\mathcal{O}_X$ is coherent in order to show that (3)
implies (1). Thus we have to show: given any open $U \subset X$ and
any finite collection of sections $f_i \in \mathcal{O}_X(U)$,
$i = 1, \ldots, n$ the kernel of the map
$\bigoplus_{i = 1, \ldots, n} \mathcal{O}_U \to \mathcal{O}_U$
is of finite type. Since being of finite type is a local property
it suffices to check this in a neighbourhood of any $x \in U$.
Thus we may assume $U = \Spec(A)$ is affine. In this case
$f_1, \ldots, f_n \in A$ are elements of $A$. Since $A$ is
Noetherian, see
Properties, Lemma \ref{properties-lemma-locally-Noetherian}
the kernel $K$ of the map $\bigoplus_{i = 1, \ldots, n} A \to A$
is a finite $A$-module. See for example
Algebra, Lemma \ref{algebra-lemma-Noetherian-basic}.
As the functor\ $\widetilde{ }$\ is exact, see
Schemes, Lemma \ref{schemes-lemma-spec-sheaves}
we get an exact sequence
$$
\widetilde K \to
\bigoplus\nolimits_{i = 1, \ldots, n} \mathcal{O}_U \to
\mathcal{O}_U
$$
and by
Properties, Lemma \ref{properties-lemma-finite-type-module}
again we see that $\widetilde K$ is of finite type. We conclude
that (1), (2) and (3) are all equivalent.

\medskip\noindent
It follows from
Properties, Lemma \ref{properties-lemma-finite-type-module}
that (2) implies (4). It is trivial that (4) implies (5).
The discussion in
Schemes, Section \ref{schemes-section-quasi-coherent}
show that (5) implies
that $\mathcal{F}$ is quasi-coherent and it is clear that (5)
implies that $\mathcal{F}$ is of finite type. Hence (5) implies
(2) and we win.
\end{proof}

\begin{lemma}
\label{lemma-coherent-abelian-Noetherian}
Let $X$ be a locally Noetherian scheme.
The category of coherent $\mathcal{O}_X$-modules is abelian.
More precisely, the kernel and cokernel of a map of coherent
$\mathcal{O}_X$-modules are coherent. Any extension
of coherent sheaves is coherent.
\end{lemma}

\begin{proof}
This is a restatement of
Modules, Lemma \ref{modules-lemma-coherent-abelian}
in a particular case.
\end{proof}

\noindent
The following lemma does not always hold for the category of coherent
$\mathcal{O}_X$-modules on a general ringed space $X$.

\begin{lemma}
\label{lemma-coherent-Noetherian-quasi-coherent-sub-quotient}
Let $X$ be a locally Noetherian scheme.
Let $\mathcal{F}$ be a coherent $\mathcal{O}_X$-module.
Any quasi-coherent submodule of $\mathcal{F}$ is coherent.
Any quasi-coherent quotient module of $\mathcal{F}$ is coherent.
\end{lemma}

\begin{proof}
We may assume that $X$ is affine, say $X = \Spec(A)$.
Properties, Lemma \ref{properties-lemma-locally-Noetherian}
implies that $A$ is Noetherian. Lemma \ref{lemma-coherent-Noetherian}
turns this into algebra. The algebraic counter part of
the lemma is that a quotient, or a submodule of a finite $A$-module
is a finite $A$-module, see for example
Algebra, Lemma \ref{algebra-lemma-Noetherian-basic}.
\end{proof}

\begin{lemma}
\label{lemma-tensor-hom-coherent}
Let $X$ be a locally Noetherian scheme.
Let $\mathcal{F}$, $\mathcal{G}$ be coherent $\mathcal{O}_X$-modules.
The $\mathcal{O}_X$-modules $\mathcal{F} \otimes_{\mathcal{O}_X} \mathcal{G}$
and $\textit{Hom}_{\mathcal{O}_X}(\mathcal{F}, \mathcal{G})$ are
coherent.
\end{lemma}

\begin{proof}
It is shown in
Modules, Lemma \ref{modules-lemma-internal-hom-locally-kernel-direct-sum} that
$\textit{Hom}_{\mathcal{O}_X}(\mathcal{F}, \mathcal{G})$ is coherent.
The result for tensor products is
Modules, Lemma \ref{modules-lemma-tensor-product-permanence}
\end{proof}

\begin{lemma}
\label{lemma-local-isomorphism}
Let $X$ be a locally Noetherian scheme.
Let $\mathcal{F}$, $\mathcal{G}$ be coherent $\mathcal{O}_X$-modules.
Let $\varphi : \mathcal{G} \to \mathcal{F}$ be a homomorphism
of $\mathcal{O}_X$-modules. Let $x \in X$.
\begin{enumerate}
\item If $\mathcal{F}_x = 0$ then there exists an open neighbourhood
$U \subset X$ of $x$ such that $\mathcal{F}|_U = 0$.
\item If $\varphi_x : \mathcal{G}_x \to \mathcal{F}_x$ is injective,
then there exists an open neighbourhood $U \subset X$ of $x$ such that
$\varphi|_U$ is injective.
\item If $\varphi_x : \mathcal{G}_x \to \mathcal{F}_x$ is surjective,
then there exists an open neighbourhood $U \subset X$ of $x$ such that
$\varphi|_U$ is surjective.
\item If $\varphi_x : \mathcal{G}_x \to \mathcal{F}_x$ is bijective,
then there exists an open neighbourhood $U \subset X$ of $x$ such that
$\varphi|_U$ is an isomorphism.
\end{enumerate}
\end{lemma}

\begin{proof}
See Modules, Lemmas
\ref{modules-lemma-finite-type-surjective-on-stalk},
\ref{modules-lemma-finite-type-stalk-zero}, and
\ref{modules-lemma-finite-type-to-coherent-injective-on-stalk}.
\end{proof}

\begin{lemma}
\label{lemma-map-stalks-local-map}
Let $X$ be a locally Noetherian scheme.
Let $\mathcal{F}$, $\mathcal{G}$ be coherent $\mathcal{O}_X$-modules.
Let $x \in X$.
Suppose $\psi : \mathcal{G}_x \to \mathcal{F}_x$ is a map of
$\mathcal{O}_{X, x}$-modules.
Then there exists an open neighbourhood $U \subset X$ of $x$ and a map
$\varphi : \mathcal{G}|_U \to \mathcal{F}|_U$ such that
$\varphi_x = \psi$.
\end{lemma}

\begin{proof}
In view of Lemma \ref{lemma-coherent-Noetherian}
this is a reformulation of
Modules, Lemma \ref{modules-lemma-stalk-internal-hom}.
\end{proof}

\begin{lemma}
\label{lemma-coherent-support-closed}
Let $X$ be a locally Noetherian scheme. Let $\mathcal{F}$ be a coherent
$\mathcal{O}_X$-module. Then $\text{Supp}(\mathcal{F})$ is closed, and
$\mathcal{F}$ comes from a coherent sheaf on the scheme theoretic support
of $\mathcal{F}$, see
Definition \ref{definition-scheme-theoretic-support}.
\end{lemma}

\begin{proof}
Let $i : Z \to X$ be the scheme theoretic support of $\mathcal{F}$ and
let $\mathcal{G}$ be the finite type quasi-coherent sheaf on $Z$
such that $i_*\mathcal{G} \cong \mathcal{F}$.
Since $Z = \text{Supp}(\mathcal{F})$ we see that the support is closed.
The scheme $Z$ is locally Noetherian by
Morphisms, Lemmas \ref{morphisms-lemma-immersion-locally-finite-type}
and \ref{morphisms-lemma-finite-type-noetherian}.
Finally, $\mathcal{G}$ is a coherent $\mathcal{O}_Z$-module by
Lemma \ref{lemma-coherent-Noetherian}
\end{proof}

\begin{lemma}
\label{lemma-finite-pushforward-coherent}
Let $f : X \to Y$ be a morphism of schemes.
Let $\mathcal{F}$ be a quasi-coherent $\mathcal{O}_X$-module.
Assume $f$ is finite and $Y$ locally Noetherian.
Then $R^pf_*\mathcal{F} = 0$ for $p > 0$ and
$f_*\mathcal{F}$ is coherent if $\mathcal{F}$ is coherent.
\end{lemma}

\begin{proof}
The higher direct images vanish by
Lemma \ref{lemma-relative-affine-vanishing} and because
a finite morphism is affine (by definition).
Note that the assumptions imply that also $X$ is locally Noetherian
(see Morphisms, Lemma \ref{morphisms-lemma-finite-type-noetherian})
and hence the statement makes sense.
Let $\Spec(A) = V \subset Y$ be an affine open subset.
By Morphisms, Definition \ref{morphisms-definition-integral}
we see that $f^{-1}(V) = \Spec(B)$ with $A \to B$ finite.
Lemma \ref{lemma-coherent-Noetherian}
turns the statement of the lemma into the following algebra
fact: If $M$ is a finite $B$-module, then $M$ is also finite
viewed as a $A$-module, see
Algebra, Lemma \ref{algebra-lemma-finite-module-over-finite-extension}.
\end{proof}

\noindent
In the situation of the lemma also the higher direct images are
coherent since they vanish.
We will show that this is always the case for a proper morphism
between locally Noetherian schemes (insert future reference here).














\section{Coherent sheaves on Noetherian schemes}
\label{section-coherent-quasi-compact}

\noindent
In this section we mention some properties of coherent sheaves on
Noetherian schemes.

\begin{lemma}
\label{lemma-acc-coherent}
Let $X$ be a Noetherian scheme.
Let $\mathcal{F}$ be a coherent $\mathcal{O}_X$-module.
The ascending chain condition holds for quasi-coherent submodules
of $\mathcal{F}$. In other words, give any sequence
$$
\mathcal{F}_1 \subset \mathcal{F}_2 \subset \ldots \subset \mathcal{F}
$$
of quasi-coherent submodules, then
$\mathcal{F}_n = \mathcal{F}_{n + 1} = \ldots $ for some $n \geq 0$.
\end{lemma}

\begin{proof}
Choose a finite affine open covering.
On each member of the covering we get stabilization by
Algebra, Lemma \ref{algebra-lemma-Noetherian-basic}.
Hence the lemma follows.
\end{proof}

\begin{lemma}
\label{lemma-power-ideal-kills-sheaf}
Let $X$ be a Noetherian scheme.
Let $\mathcal{F}$ be a coherent sheaf on $X$.
Let $\mathcal{I} \subset \mathcal{O}_X$ be a quasi-coherent
sheaf of ideals corresponding to a closed subscheme $Z \subset X$.
Then there is some $n \geq 0$ such that $\mathcal{I}^n\mathcal{F} = 0$
if and only if $\text{Supp}(\mathcal{F}) \subset Z$ (set theoretically).
\end{lemma}

\begin{proof}
This follows immediately from 
Algebra, Lemma \ref{algebra-lemma-Noetherian-power-ideal-kills-module}
because $X$ has a finite covering by spectra of Noetherian rings.
\end{proof}

\begin{lemma}
\label{lemma-Artin-Rees}
(Artin-Rees.)
Let $X$ be a Noetherian scheme.
Let $\mathcal{F}$ be a coherent sheaf on $X$.
Let $\mathcal{G} \subset \mathcal{F}$ be a quasi-coherent subsheaf.
Let $\mathcal{I} \subset \mathcal{O}_X$ be a quasi-coherent sheaf of
ideals.
Then there exists a $c \geq 0$ such that for all $n \geq c$ we
have
$$
\mathcal{I}^{n - c}(\mathcal{I}^c\mathcal{F} \cap \mathcal{G})
=
\mathcal{I}^n\mathcal{F}
$$
\end{lemma}

\begin{proof}
This follows immediately from
Algebra, Lemma \ref{algebra-lemma-Artin-Rees}
because $X$ has a finite covering by spectra of Noetherian rings.
\end{proof}

\begin{lemma}
\label{lemma-homs-over-open}
Let $X$ be a Noetherian scheme.
Let $\mathcal{F}$, $\mathcal{G}$ be coherent $\mathcal{O}_X$-modules.
Let $\mathcal{I} \subset \mathcal{O}_X$ be a quasi-coherent sheaf of
ideals. Denote $Z \subset X$ the corresponding closed subscheme and
set $U = X \setminus Z$.
There is a canonical isomorphism
$$
\colim_n \text{Hom}_{\mathcal{O}_X}(
\mathcal{I}^n\mathcal{G}, \mathcal{F})
\longrightarrow
\textit{Hom}_{\mathcal{O}_U}(\mathcal{G}|_U, \mathcal{F}|_U).
$$
In particular we have an isomorphism
$$
\colim_n \text{Hom}_{\mathcal{O}_X}(
\mathcal{I}^n, \mathcal{F})
\longrightarrow
\Gamma(U, \mathcal{F}).
$$
\end{lemma}

\begin{proof}
We first prove the second equality.
Let $\mathcal{F}_n$ denote the quasi-coherent subsheaf of
$\mathcal{F}$ consisting of sections annihilated by $\mathcal{I}^n$,
see Properties, Lemma \ref{properties-lemma-sections-over-quasi-compact-open}.
Since $\mathcal{F}_1 \subset \mathcal{F}_2 \subset \ldots$ we see that
$\mathcal{F}_n = \mathcal{F}_{n + 1} = \ldots $ for some $n \geq 0$
by Lemma \ref{lemma-acc-coherent}. Set $\mathcal{H} = \mathcal{F}_n$
for this $n$. By Artin-Rees (Lemma \ref{lemma-Artin-Rees})
there exists an $c \geq 0$ such that
$\mathcal{I}^m\mathcal{F} \cap \mathcal{G}
\subset \mathcal{I}^{m - c}\mathcal{G}$. Picking $m = n + c$ we get
$\mathcal{I}^m\mathcal{F} \cap \mathcal{G} \subset \mathcal{I}^n\mathcal{G}
= 0$. Thus if we set $\mathcal{F}' = \mathcal{I}^m\mathcal{F}$ then we
see that $\mathcal{F}' \cap \mathcal{F}_n = 0$ and
$\mathcal{F}'|_U = \mathcal{F}|_U$. Note in particular that the subsheaf
$(\mathcal{F}')_N$ of sections annihilated by $\mathcal{I}^N$ is zero
for all $N \geq 0$. Hence by
Properties, Lemma \ref{properties-lemma-sections-over-quasi-compact-open}
we deduce that
the top horizontal arrow in the following commutative
diagram is a bijection:
$$
\xymatrix{
\colim_n \text{Hom}_{\mathcal{O}_X}(
\mathcal{I}^n, \mathcal{F}')
\ar[r] \ar[d] &
\Gamma(U, \mathcal{F}') \ar[d] \\
\colim_n \text{Hom}_{\mathcal{O}_X}(
\mathcal{I}^n, \mathcal{F})
\ar[r] &
\Gamma(U, \mathcal{F})
}
$$
Since also the right vertical arrow is a bijection we conclude that
the bottom horizontal arrow is surjective. The bottom horizontal
arrow is injective by
Properties, Lemma \ref{properties-lemma-sections-over-quasi-compact-open}.
This proves the bottom arrow is a bijection as desired.

\medskip\noindent
Next, we come to the general case.
By Lemma \ref{lemma-tensor-hom-coherent} the sheaf
$\mathcal{H} = \textit{Hom}_{\mathcal{O}_X}(\mathcal{G}, \mathcal{F})$
is coherent. By definition we have
$$
\mathcal{H}(U)
=
\textit{Hom}_{\mathcal{O}_U}(\mathcal{G}|_U, \mathcal{F}|_U)
$$
Pick a $\psi$ in the right hand side of the first arrow of the
lemma, i.e.,  $\psi \in \mathcal{H}(U)$. The result just proved applies
to $\mathcal{H}$ and hence there exists an $n \geq 0$ and an
$\varphi : \mathcal{I}^n \to \mathcal{H}$ which recovers
$\psi$ on restricition to $U$. By
Modules, Lemma \ref{modules-lemma-internal-hom}
$\varphi$ corresponds to a map
$$
\varphi :
\mathcal{I}^{\otimes n} \otimes_{\mathcal{O}_X} \mathcal{G}
\longrightarrow
\mathcal{F}.
$$
This is almost what we want except that the source of the arrow
is the tensor product of $\mathcal{I}^n$ and $\mathcal{G}$
and not the product. We will show that, at the cost of increasing $n$,
the difference is irrelevant. Consider the short exact sequence
$$
0 \to \mathcal{K} \to
\mathcal{I}^n \otimes_{\mathcal{O}_X} \mathcal{G} \to
\mathcal{I}^n\mathcal{G} \to 0
$$
where $\mathcal{K}$ is defined as the kernel. Note that
$\mathcal{I}^n\mathcal{K} = 0$ (proof omitted). By Artin-Rees
again we see that
$$
\mathcal{K}
\cap
\mathcal{I}^m(\mathcal{I}^n \otimes_{\mathcal{O}_X} \mathcal{G})
=
0
$$
for some $m$ large enough. In other words we see that
$$
\mathcal{I}^m(\mathcal{I}^n \otimes_{\mathcal{O}_X} \mathcal{G})
\longrightarrow
\mathcal{I}^{n + m}\mathcal{G}
$$
is an isomorphism. Let $\varphi'$ be the restriction of
$\varphi$ to this submodule thought of as a map
$\mathcal{I}^{m + n}\mathcal{G} \to \mathcal{F}$.
Then $\varphi'$ gives an element
of the left hand side of the first arrow of the lemma which
maps to $\psi$ via the arrow. In other words we have prove surjectivity
of the arrow. We omit the proof of injectivity.
\end{proof}









\section{Depth}
\label{section-depth}

\noindent
In this section we talk a little bit about depth and property
$(S_k)$ for coherent modules on locally Noetherian schemes.

\begin{definition}
\label{definition-depth}
Let $X$ be a locally Noetherian scheme.
Let $\mathcal{F}$ be a coherent $\mathcal{O}_X$-module.
Let $k \geq 0$ be an integer.
\begin{enumerate}
\item We say $\mathcal{F}$ has {\it depth $k$ at a point}
$x$ of $X$ if $\text{depth}_{\mathcal{O}_{X, x}}(\mathcal{F}_x) = k$.
\item We say $X$ has {\it depth $k$ at a point} $x$ of $X$ if
$\text{depth}(\mathcal{O}_{X, x}) = k$.
\item We say $\mathcal{F}$ has property {\it $(S_k)$} if
$$
\text{depth}_{\mathcal{O}_{X, x}}(\mathcal{F}_x)
\geq \min(k, \dim(\mathcal{F}_x))
$$
for all $x \in X$.
\item We say $X$ has property {\it $(S_k)$} if $\mathcal{O}_X$ has
property $(S_k)$.
\end{enumerate}
\end{definition}

\noindent
Any coherent sheaf satisfies condition $(S_0)$.
Condition $(S_1)$ is equivalent to having no embedded associated
points, see Divisors, Lemma \ref{divisors-lemma-S1-no-embedded}.

\begin{lemma}
\label{lemma-scheme-CM-iff-all-Sk}
Let $X$ be a locally Noetherian scheme.
Then $X$ is Cohen-Macaulay if and only if $X$ has $(S_k)$ for all $k \geq 0$.
\end{lemma}

\begin{proof}
By Properties, Lemma \ref{properties-lemma-characterize-Cohen-Macaulay}
we reduce to looking at local rings.
Hence the lemma is true because a Noetherian local ring is Cohen-Macaulay
if and only if it has depth equal to its dimension.
\end{proof}

\noindent
Thus it makes sense to introduce the following definition, which
is equivalent to the condition that all stalks are Cohen-Macaulay modules.

\begin{definition}
\label{definition-Cohen-Macaulay}
Let $X$ be a locally Noetherian scheme.
Let $\mathcal{F}$ be a coherent $\mathcal{O}_X$-module.
We say $\mathcal{F}$ is {\it Cohen-Macaulay} if and only
if $(S_k)$ holds for all $k \geq 0$.
\end{definition}

\begin{lemma}
\label{lemma-criterion-reduced}
Let $X$ be a locally Noetherian scheme.
Then $X$ is reduced if and only if $X$ has properties $(S_1)$ and $(R_0)$.
\end{lemma}

\begin{proof}
This is Algebra, Lemma \ref{algebra-lemma-criterion-reduced}.
\end{proof}

\begin{lemma}
\label{lemma-criterion-normal}
Let $X$ be a locally Noetherian scheme.
Then $X$ is normal if and only if $X$ has properties $(S_2)$ and $(R_1)$.
\end{lemma}

\begin{proof}
This is Algebra, Lemma \ref{algebra-lemma-criterion-normal}.
\end{proof}











\section{Devissage of coherent sheaves}
\label{section-devissage}

\noindent
Let $X$ be a Noetherian scheme. Consider an integral closed subscheme
$i : Z \to X$. It is often convenient to consider coherent sheaves of
the form $i_*\mathcal{G}$ where $\mathcal{G}$ is a coherent sheaf on
$Z$. In particular we are interested in these sheaves when $\mathcal{G}$
is a torsion free rank $1$ sheaf. For example $\mathcal{G}$ could be
a nonzero sheaf of ideals on $Z$, or even more specifically
$\mathcal{G} = \mathcal{O}_Z$.

\medskip\noindent
Throughout this section we will use that a coherent sheaf is the
same thing as a finite type quasi-coherent sheaf and that a
quasi-coherent subquotient of a coherent sheaf is coherent, see
Section \ref{section-coherent-sheaves}.
The support of a coherent sheaf is closed, see
Modules, Lemma \ref{modules-lemma-support-finite-type-closed}.

\begin{lemma}
\label{lemma-prepare-filter-support}
Let $X$ be a Noetherian scheme.
Let $\mathcal{F}$ be a coherent sheaf on $X$.
Suppose that $\text{Supp}(\mathcal{F}) = Z \cup Z'$ with $Z$, $Z'$ closed.
Then there exists a short exact sequence of coherent sheaves
$$
0 \to \mathcal{G}' \to \mathcal{F} \to \mathcal{G} \to 0
$$
with $\text{Supp}(\mathcal{G}') \subset Z'$ and
$\text{Supp}(\mathcal{G}) \subset Z$.
\end{lemma}

\begin{proof}
Throughout the proof we will use that a coherent sheaf is the
same thing as a finite type quasi-coherent sheaf and that a
quasi-coherent subquotient of a coherent sheaf is coherent, see
Section \ref{section-coherent-sheaves}.
The support of a coherent sheaf is closed, see
Modules, Lemma \ref{modules-lemma-support-finite-type-closed}.
Let $\mathcal{I} \subset \mathcal{O}_X$ be the sheaf of ideals
defining the reduced induced closed subscheme structure on $Z$, see
Schemes, Lemma \ref{schemes-lemma-reduced-closed-subscheme}.
Consider the subsheaves
$\mathcal{G}'_n = \mathcal{I}^n\mathcal{F}$ and the
quotients $\mathcal{G}_n = \mathcal{F}/\mathcal{I}^n\mathcal{F}$.
For each $n$ we have a short exact sequence
$$
0 \to \mathcal{G}'_n \to \mathcal{F} \to \mathcal{G}_n \to 0
$$
For every point $x$ of $Z' \setminus Z$ we have
$\mathcal{I}_x = \mathcal{O}_{X, x}$
and hence $\mathcal{G}_{n, x} = 0$. Thus we see that
$\text{Supp}(\mathcal{G}_n) \subset Z$. Note that $X \setminus Z'$
is a Noetherian scheme. Hence by Lemma \ref{lemma-power-ideal-kills-sheaf}
there exists an $n$ such that
$\mathcal{G}'_n|_{X \setminus Z'} =
\mathcal{I}^n\mathcal{F}|_{X \setminus Z'} = 0$.
For such an $n$ we see that $\text{Supp}(\mathcal{G}'_n) \subset Z'$.
Thus setting
$\mathcal{G}' = \mathcal{G}'_n$ and $\mathcal{G} = \mathcal{G}_n$
works.
\end{proof}

\begin{lemma}
\label{lemma-prepare-filter-irreducible}
Let $X$ be a Noetherian scheme.
Let $i : Z \to X$ be an integral closed subscheme.
Let $\xi \in Z$ be the generic point.
Let $\mathcal{F}$ be a coherent sheaf on $X$.
Assume that $\mathcal{F}_\xi$ is annihilated by
$\mathfrak m_\xi$. Then there exists an integer
$r \geq 0$ and a sheaf of ideals $\mathcal{I} \subset \mathcal{O}_Z$
and an injective map of coherent sheaves
$$
i_*\left(\mathcal{I}^{\oplus r}\right) \to \mathcal{F}
$$
which is an isomorphism in a neighbourhood of $\xi$.
\end{lemma}

\begin{proof}
Let $\mathcal{J} \subset \mathcal{O}_X$ be the ideal sheaf of $Z$.
Let $\mathcal{F}' \subset \mathcal{F}$ be the subsheaf of
local sections of $\mathcal{F}$ which are annihilated by
$\mathcal{J}$. It is a quasi-coherent sheaf by
Properties, Lemma \ref{properties-lemma-sections-annihilated-by-ideal}.
Moreover, $\mathcal{F}'_\xi = \mathcal{F}_\xi$ because
$\mathcal{J}_\xi = \mathfrak m_\xi$ and part (3) of
Properties, Lemma \ref{properties-lemma-sections-annihilated-by-ideal}.
By Lemma \ref{lemma-local-isomorphism} we see that
$\mathcal{F}' \to \mathcal{F}$
induces an isomorphism in a neighbourhood of $\xi$.
Hence we may replace $\mathcal{F}$ by $\mathcal{F}'$ and assume
that $\mathcal{F}$ is annihilated by $\mathcal{J}$.

\medskip\noindent
Assume $\mathcal{J}\mathcal{F} = 0$. By
Morphisms, Lemma \ref{morphisms-lemma-i-star-equivalence} we can write
$\mathcal{F} = i_*\mathcal{G}$ for some quasi-coherent
sheaf $\mathcal{G}$ on $Z$. By
Modules, Lemma \ref{modules-lemma-i-star-reflects-finite-type}
combined with the results of Section \ref{section-coherent-sheaves}
we also see $\mathcal{G}$ is coherent on $Z$.
Suppose we can find a morphism
$\mathcal{I}^{\oplus r} \to \mathcal{G}$ which is an isomorphism
in a neighbourhood of the generic point $\xi$ of $Z$.
Then applying $i_*$ (which is left exact) we get the result of the lemma.
Hence we have reduced to the case $X = Z$.

\medskip\noindent
Suppose $Z = X$ is an integral Noetherian scheme with generic point $\xi$.
Note that $\mathcal{O}_{X, \xi} = \kappa(\xi)$ is the function field of $X$
in this case.
Since $\mathcal{F}_\xi$ is a finite $\mathcal{O}_\xi$-module we see
that $r = \dim_{\kappa(\xi)} \mathcal{F}_\xi$ is finite.
Hence the sheaves $\mathcal{O}_X^{\oplus r}$ and $\mathcal{F}$
have isomorphic stalks at $\xi$.
By Lemma \ref{lemma-map-stalks-local-map} there exists a nonempty
open $U \subset X$ and a morphism
$\psi : \mathcal{O}_X^{\oplus r}|_U \to \mathcal{F}|_U$
which is an isomorphism
at $\xi$, and hence an isomorphism in a neighbourhood of $\xi$ by
Lemma \ref{lemma-local-isomorphism}.
By Schemes, Lemma \ref{schemes-lemma-reduced-closed-subscheme}
there exists a quasi-coherent sheaf of ideals
$\mathcal{I} \subset \mathcal{O}_X$
whose associated closed subscheme $Z \subset X$ is the complement
of $U$.
By Lemma \ref{lemma-homs-over-open} there exists an $n \geq 0$ and a morphism
$\mathcal{I}^n(\mathcal{O}_X)^{\oplus r}) \to \mathcal{F}$
which recovers our $\psi$ over $U$. Since
$\mathcal{I}^n(\mathcal{O}_X)^{\oplus r}) = (\mathcal{I}^n)^{\oplus r}$
we get a map as in the lemma. It is injective because $X$ is
integral and it is injective at the generic point of $X$
(easy proof omitted).
\end{proof}

\begin{lemma}
\label{lemma-coherent-filter}
Let $X$ be a Noetherian scheme.
Let $\mathcal{F}$ be a coherent sheaf on $X$.
There exists a filtration
$$
0 = \mathcal{F}_0 \subset \mathcal{F}_1 \subset
\ldots \subset \mathcal{F}_m = \mathcal{F}
$$
by coherent subsheaves such that for each $j = 1, \ldots, m$
there exists an integral closed subscheme $Z_j \subset X$
and a sheaf of ideals $\mathcal{I}_j \subset \mathcal{O}_{Z_j}$
such that
$$
\mathcal{F}_j/\mathcal{F}_{j - 1}
\cong (Z_j \to X)_* \mathcal{I}_j
$$
\end{lemma}

\begin{proof}
Consider the collection
$$
\mathcal{T} =
\left\{
\begin{matrix}
Z \subset X
\text{ closed such that there exists a coherent sheaf }
\mathcal{F} \\
\text{ with }
\text{Supp}(\mathcal{F}) = Z
\text{ for which the lemma is wrong}
\end{matrix}
\right\}
$$
We are trying to show that $\mathcal{T}$ is empty. If not, then
because $X$ is Noetherian we can choose a minimal element
$Z \in \mathcal{T}$. This means that there exists a coherent
sheaf $\mathcal{F}$ on $X$ whose support is $Z$ and for which the
lemma does not hold. Clearly $Z \not = \emptyset$ since the only
sheaf whose support is empty is the zero sheaf for which the
lemma does hold (with $m = 0$).

\medskip\noindent
If $Z$ is not irreducible, then we can write $Z = Z_1 \cup Z_2$
with $Z_1, Z_2$ closed and strictly smaller than $Z$.
Then we can apply Lemma \ref{lemma-prepare-filter-support}
to get a short exact sequence of coherent sheaves
$$
0 \to
\mathcal{G}_1 \to
\mathcal{F} \to
\mathcal{G}_2 \to 0
$$
with $\text{Supp}(\mathcal{G}_i) \subset Z_i$. By minimality of
$Z$ each of $\mathcal{G}_i$ has a filtration as in the statement
of the lemma. By considering the induced filtration on $\mathcal{F}$
we arrive at a contradiction. Hence we conclude
that $Z$ is irreducible.

\medskip\noindent
Suppose $Z$ is irreducible. Let $\mathcal{J}$ be the sheaf of ideals
cutting out the reduced induced closed subscheme structure of $Z$,
see Schemes, Lemma \ref{schemes-lemma-reduced-closed-subscheme}.
By Lemma \ref{lemma-power-ideal-kills-sheaf} we see there exists
an $n \geq 0$ such that $\mathcal{J}^n\mathcal{F} = 0$. Hence we obtain
a filtration
$$
0 = \mathcal{I}^n\mathcal{F} \subset \mathcal{I}^{n - 1}\mathcal{F}
\subset \ldots \subset \mathcal{I}\mathcal{F} \subset \mathcal{F}
$$
each of whose succesive subquotients is annihilated by $\mathcal{J}$.
Hence if each of these subquotients has a filtration as in the statement
of the lemma then also $\mathcal{F}$ does. In other words we may
assume that $\mathcal{J}$ does annihilate $\mathcal{F}$.

\medskip\noindent
In the case where $Z$ is irreducible and $\mathcal{J}\mathcal{F} = 0$
we can apply Lemma \ref{lemma-prepare-filter-irreducible}.
This gives a short exact sequence
$$
0 \to
i_*(\mathcal{I}^{\oplus r}) \to
\mathcal{F} \to
\mathcal{Q} \to 0
$$
where $\mathcal{Q}$ is defined as the quotient.
Since $\mathcal{Q}$ is zero in a neighbourhood of $\xi$ by
the lemma just cited we see that the support of $\mathcal{Q}$
is strictly smaller than $Z$. Hence we see that $\mathcal{Q}$
has a filtration of the desired type by minimality of $Z$.
But then clearly $\mathcal{F}$ does too, which is our final contradiction.
\end{proof}

\begin{lemma}
\label{lemma-property-initial}
Let $X$ be a Noetherian scheme.
Let $\mathcal{P}$ be a property of coherent sheaves on $X$ such that
\begin{enumerate}
\item For any short exact sequence of coherent sheaves
$$
0 \to \mathcal{F}_1 \to \mathcal{F} \to \mathcal{F}_2 \to 0
$$
if $\mathcal{F}_i$, $i = 1, 2$ have property $\mathcal{P}$
then so does $\mathcal{F}$.
\item For every integral closed subscheme $Z \subset X$
and every quasi-coherent sheaf of ideals
$\mathcal{I} \subset \mathcal{O}_Z$ we have
$\mathcal{P}$ for $i_*\mathcal{I}$.
\end{enumerate}
Then property $\mathcal{P}$ holds for every coherent sheaf
on $X$.
\end{lemma}

\begin{proof}
First note that if $\mathcal{F}$ is a coherent sheaf with a filtration
$$
0 = \mathcal{F}_0 \subset \mathcal{F}_1 \subset
\ldots \subset \mathcal{F}_m = \mathcal{F}
$$
by coherent subsheaves such that each of $\mathcal{F}_i/\mathcal{F}_{i - 1}$
has property $\mathcal{P}$, then so does $\mathcal{F}$.
This follows from the property (1) for $\mathcal{P}$.
On the other hand, by Lemma \ref{lemma-coherent-filter}
we can filter any $\mathcal{F}$
with succesive subquotients as in (2).
Hence the lemma follows.
\end{proof}

\begin{lemma}
\label{lemma-property-irreducible}
Let $X$ be a Noetherian scheme.
Let $Z_0 \subset X$ be an irreducible closed subset with generic point $\xi$.
Let $\mathcal{P}$ be a property of coherent sheaves on $X$ such that
\begin{enumerate}
\item For any short exact sequence of coherent sheaves if two
out of three of them have property $\mathcal{P}$ then so does the
third.
\item For every integral closed subscheme $Z \subset Z_0 \subset X$,
$Z \not = Z_0$ and every quasi-coherent sheaf of ideals
$\mathcal{I} \subset \mathcal{O}_Z$ we have
$\mathcal{P}$ for $(Z \to X)_*\mathcal{I}$.
\item There exists some coherent sheaf $\mathcal{G}$ on $X$ such that
\begin{enumerate}
\item $\text{Supp}(\mathcal{G}) = Z_0$,
\item $\mathcal{G}_\xi$ is annihilated by $\mathfrak m_\xi$,
\item $\dim_{\kappa(\xi)} \mathcal{G}_\xi = 1$, and
\item property $\mathcal{P}$ holds for $\mathcal{G}$.
\end{enumerate}
\end{enumerate}
Then property $\mathcal{P}$ holds for every coherent sheaf
$\mathcal{F}$ on $X$ whose support is contained in $Z_0$.
\end{lemma}

\begin{proof}
First note that if $\mathcal{F}$ is a coherent sheaf with a filtration
$$
0 = \mathcal{F}_0 \subset \mathcal{F}_1 \subset
\ldots \subset \mathcal{F}_m = \mathcal{F}
$$
by coherent subsheaves such that each of $\mathcal{F}_i/\mathcal{F}_{i - 1}$
has property $\mathcal{P}$, then so does $\mathcal{F}$. Or, if $\mathcal{F}$
has property $\mathcal{P}$ and all but one of the 
$\mathcal{F}_i/\mathcal{F}_{i - 1}$ has property $\mathcal{P}$ then
so does the last one.
This follows from the two-out-of-three property (1) for $\mathcal{P}$.

\medskip\noindent
As a first application of these remarks we conclude that
any coherent sheaf whose support is strictly contained in $Z_0$
has property $\mathcal{P}$. Namely, such a sheaf
has a filtration (see Lemma \ref{lemma-coherent-filter})
whose subquotients have property $\mathcal{P}$ according to (2).

\medskip\noindent
As a second application
we apply this remark to the sheaf $\mathcal{G}$ from assumption
(3) and a filtration
$$
0 = \mathcal{G}_0 \subset \mathcal{G}_1 \subset
\ldots \subset \mathcal{G}_m = \mathcal{G}
$$
by coherent subsheaves as in Lemma \ref{lemma-coherent-filter}.
Let $Z_j \to X$ be the integral closed subschemes, and
$\mathcal{I}_i \subset \mathcal{O}_{Z_i}$ the quasi-coherent sheaves
of ideals such that
$\mathcal{G}_i/\mathcal{G}_{i - 1} \cong (Z_i \to X)_*\mathcal{I}_i$.
We may obviously assume all the $\mathcal{I}_i$ are nonzero.
Since $\dim_{\kappa(\xi)} \mathcal{G}_\xi = 1$ we see that there
is exactly one $i = i_0$ such that $Z_{i_0} = Z_0$ and all other
$Z_i \subset Z_0$ are proper irreducible closed subsets of $Z_0$.
By the remark above and (2) we see that $(Z_{i_0} \to X)_*\mathcal{I}_{i_0}$
has property $\mathcal{P}$.
We conclude that there exists at least one quasi-coherent
sheaf of ideals $\mathcal{I}$ (namely $\mathcal{I}_{i_0}$) on $Z_0$
such that $(Z_0 \to X)_*\mathcal{I}$ has property $\mathcal{P}$.

\medskip\noindent
Next, suppose that $\mathcal{I}'$ is another quasi-coherent
sheaf of ideals $Z_0$. Then we can consider the intersection
$\mathcal{I}'' = \mathcal{I}' \cap \mathcal{I}$ and we get
two short exact sequences
$$
0 \to
(Z_0 \to X)_*\mathcal{I}'' \to
(Z_0 \to X)_*\mathcal{I} \to
\mathcal{Q} \to 0
$$
and
$$
0 \to
(Z_0 \to X)_*\mathcal{I}' \to
(Z_0 \to X)_*\mathcal{I} \to
\mathcal{Q}' \to 0.
$$
Note that the support of the coherent sheaves $\mathcal{Q}$ and
$\mathcal{Q}'$ are strictly contained in $Z_0$.
Hence $\mathcal{Q}$ and $\mathcal{Q}$ have property $\mathcal{P}$
(see above). Hence we conclude using (1)
that $(Z_0 \to X)_*\mathcal{I}''$ and $(Z_0 \to X)_*\mathcal{I}'$
both have $\mathcal{P}$ as well.

\medskip\noindent
The final step of the proof is to note that any coherent sheaf
$\mathcal{F}$ on $X$ whose support is contained in $Z_0$ has a filtration
(see Lemma \ref{lemma-coherent-filter} again) whose subquotients
all have property $\mathcal{P}$ by what we just said.
\end{proof}

\begin{lemma}
\label{lemma-property}
Let $X$ be a Noetherian scheme.
Let $\mathcal{P}$ be a property of coherent sheaves on $X$ such that
\begin{enumerate}
\item For any short exact sequence of coherent sheaves if two
out of three of them have property $\mathcal{P}$ then so does the
third.
\item For every integral closed subscheme $Z \subset X$
with generic point $\xi$ there exists
some coherent sheaf $\mathcal{G}$ such that
\begin{enumerate}
\item $\text{Supp}(\mathcal{G}) = Z$,
\item $\mathcal{G}_\xi$ is annihilated by $\mathfrak m_\xi$,
\item $\dim_{\kappa(\xi)} \mathcal{G}_\xi = 1$, and
\item property $\mathcal{P}$ holds for $\mathcal{G}$.
\end{enumerate}
\end{enumerate}
Then property $\mathcal{P}$ holds for every coherent sheaf
on $X$.
\end{lemma}

\begin{proof}
According to Lemma \ref{lemma-property-initial} it suffices to show
that given any integral closed subscheme $Z \subset X$
and every quasi-coherent sheaf of ideals
$\mathcal{I} \subset \mathcal{O}_Z$ we have
$\mathcal{P}$ for $(Z \to X)_*\mathcal{I}$.
If this fails, then since $X$ is Noetherian there
is a minimal integral closed subscheme $Z_0 \subset X$
such that $\mathcal{P}$ fails for $(Z_0 \to X)_*\mathcal{I}$ for
some quasi-coherent sheaf of ideals $\mathcal{I} \subset \mathcal{O}_{Z_0}$.
In other words, the result does hold for any integral closed
subscheme of $Z$. According to Lemma \ref{lemma-property-irreducible}
this cannot happen.
\end{proof}

\begin{lemma}
\label{lemma-property-irreducible-higher-rank}
(Variant of Lemma \ref{lemma-property-irreducible}.)
Let $X$ be a Noetherian scheme.
Let $Z_0 \subset X$ be an irreducible closed subset with generic point $\xi$.
Let $\mathcal{P}$ be a property of coherent sheaves on $X$ such that
\begin{enumerate}
\item For any short exact sequence of coherent sheaves if two
out of three of them have property $\mathcal{P}$ then so does the
third.
\item If $\mathcal{P}$ holds for a direct sum of coherent sheaves
then it holds for both.
\item For every integral closed subscheme $Z \subset Z_0 \subset X$,
$Z \not = Z_0$ and every quasi-coherent sheaf of ideals
$\mathcal{I} \subset \mathcal{O}_Z$ we have
$\mathcal{P}$ for $(Z \to X)_*\mathcal{I}$.
\item There exists some coherent sheaf $\mathcal{G}$ on $X$ such that
\begin{enumerate}
\item $\text{Supp}(\mathcal{G}) = Z_0$,
\item $\mathcal{G}_\xi$ is annihilated by $\mathfrak m_\xi$, and
\item property $\mathcal{P}$ holds for $\mathcal{G}$.
\end{enumerate}
\end{enumerate}
Then property $\mathcal{P}$ holds for every coherent sheaf
$\mathcal{F}$ on $X$ whose support is contained in $Z_0$.
\end{lemma}

\begin{proof}
The proof is a variant on the proof of Lemma \ref{lemma-property-irreducible}.
In exactly the same manner as in that proof we see that
any coherent sheaf whose support is strictly contained in $Z_0$
has property $\mathcal{P}$.

\medskip\noindent
Consider a coherent sheaf $\mathcal{G}$ as in (3).
By Lemma \ref{lemma-prepare-filter-irreducible}
there exists a sheaf of ideals $\mathcal{I}$ on $Z_0$ and
a short exact sequence
$$
0 \to
\left((Z_0 \to X)_*\mathcal{I}\right)^{\oplus r} \to
\mathcal{G} \to
\mathcal{Q} \to 0
$$
where the support of $\mathcal{Q}$ is stricly contained in $Z_0$.
In particular $r > 0$ and $\mathcal{I}$ is nonzero
because the support of $\mathcal{G}$ is equal to $Z$.
Since $\mathcal{Q}$ has property $\mathcal{P}$ we conclude that
also $\left((Z_0 \to X)_*\mathcal{I}\right)^{\oplus r}$
has property $\mathcal{P}$. 
By (2) we deduce property $\mathcal{P}$ for
$(Z_0 \to X)_*\mathcal{I}$. Slotting this into the proof of
Lemma \ref{lemma-property-irreducible}
at the appropriate point gives the lemma.
Some details omitted.
\end{proof}

\begin{lemma}
\label{lemma-property-higher-rank}
(Variant of Lemma \ref{lemma-property}.)
Let $X$ be a Noetherian scheme.
Let $\mathcal{P}$ be a property of coherent sheaves on $X$ such that
\begin{enumerate}
\item For any short exact sequence of coherent sheaves if two
out of three of them have property $\mathcal{P}$ then so does the
third.
\item If $\mathcal{P}$ holds for a direct sum of coherent sheaves
then it holds for both.
\item For every integral closed subscheme $Z \subset X$
with generic point $\xi$ there exists
some coherent sheaf $\mathcal{G}$ such that
\begin{enumerate}
\item $\text{Supp}(\mathcal{G}) = Z$,
\item $\mathcal{G}_\xi$ is annihilated by $\mathfrak m_\xi$, and
\item property $\mathcal{P}$ holds for $\mathcal{G}$.
\end{enumerate}
\end{enumerate}
Then property $\mathcal{P}$ holds for every coherent sheaf
on $X$.
\end{lemma}

\begin{proof}
This follows from Lemma \ref{lemma-property-irreducible-higher-rank}
by exactly the same argument as used in
the proof of Lemma \ref{lemma-property}.
\end{proof}

\begin{lemma}
\label{lemma-property-irreducible-higher-rank-cohomological}
(Cohomological variant of Lemma \ref{lemma-property-irreducible-higher-rank}.)
Let $X$ be a Noetherian scheme.
Let $Z_0 \subset X$ be an irreducible closed subset with generic point $\xi$.
Let $\mathcal{P}$ be a property of coherent sheaves on $X$ such that
\begin{enumerate}
\item For any short exact sequence of coherent sheaves
$$
0 \to \mathcal{F}_1 \to \mathcal{F} \to \mathcal{F}_2 \to 0
$$
if $\mathcal{F}_i$, $i = 1, 2$ have property $\mathcal{P}$
then so does $\mathcal{F}$.
\item If $\mathcal{P}$ holds for a direct sum of coherent sheaves
then it holds for both.
\item For every integral closed subscheme $Z \subset Z_0 \subset X$,
$Z \not = Z_0$ and every quasi-coherent sheaf of ideals
$\mathcal{I} \subset \mathcal{O}_Z$ we have
$\mathcal{P}$ for $(Z \to X)_*\mathcal{I}$.
\item There exists some coherent sheaf $\mathcal{G}$ such that
\begin{enumerate}
\item $\text{Supp}(\mathcal{G}) = Z_0$,
\item $\mathcal{G}_\xi$ is annihilated by $\mathfrak m_\xi$, and
\item for every quasi-coherent sheaf of ideals
$\mathcal{J} \subset \mathcal{O}_X$ such that
$\mathcal{J}_\xi = \mathcal{O}_{X, \xi}$ there exists a quasi-coherent
subsheaf $\mathcal{G}' \subset \mathcal{J}\mathcal{G}$ with
$\mathcal{G}'_\xi = \mathcal{G}_\xi$ and such that
$\mathcal{P}$ holds for $\mathcal{G}'$.
\end{enumerate}
\end{enumerate}
Then property $\mathcal{P}$ holds for every coherent sheaf
$\mathcal{F}$ on $X$ whose support is contained in $Z_0$.
\end{lemma}

\begin{proof}
The proof is a variant on the proof of Lemma \ref{lemma-property-irreducible}.
In exactly the same manner as in that proof we see that
any coherent sheaf whose support is strictly contained in $Z_0$
has property $\mathcal{P}$. Note that this does not use the full
strength of the two-out-of-three property of that lemma, only
the weaker variant (1) above which is in force in the current situation.

\medskip\noindent
Let us denote $i : Z_0 \to X$ the closed immersion.
Consider a coherent sheaf $\mathcal{G}$ as in (4).
By Lemma \ref{lemma-prepare-filter-irreducible}
there exists a sheaf of ideals $\mathcal{I}$ on $Z_0$ and
a short exact sequence
$$
0 \to
i_*\mathcal{I}^{\oplus r} \to
\mathcal{G} \to
\mathcal{Q} \to 0
$$
where the support of $\mathcal{Q}$ is stricly contained in $Z_0$.
In particular $r > 0$ and $\mathcal{I}$ is nonzero
because the support of $\mathcal{G}$ is equal to $Z_0$.
Let $\mathcal{I}' \subset \mathcal{I}$ be any nonzero quasi-coherent
sheaf of ideals on $Z$ contained in $\mathcal{I}$.
Then we also get a short exact sequence
$$
0 \to
i_*(\mathcal{I}')^{\oplus r} \to
\mathcal{G} \to
\mathcal{Q}' \to 0
$$
where $\mathcal{Q}'$ has support properly contained in $Z_0$.
Let $\mathcal{J} \subset \mathcal{O}_X$ be a quasi-coherent sheaf
of ideals cuttting out the support of $\mathcal{Q}'$ (for example
the ideal corresponding to the reduced induced closed subscheme
structure on the the support of $\mathcal{Q}'$). Then
$\mathcal{J}_\xi = \mathcal{O}_{X, \xi}$. By
Lemma \ref{lemma-power-ideal-kills-sheaf}
we see that $\mathcal{J}^n\mathcal{Q}' = 0$ for some $n$.
Hence $\mathcal{J}^n\mathcal{G} \subset i_*(\mathcal{I}')^{\oplus r}$.
By assumption (4)(c) of the lemma we see there exists
a quasi-coherent subsheaf $\mathcal{G}' \subset \mathcal{J}^n\mathcal{G}$
with $\mathcal{G}'_\xi = \mathcal{G}_\xi$
for which property $\mathcal{P}$ holds.
Hence we get a short exact sequence
$$
0 \to \mathcal{G}' \to
i_*(\mathcal{I}')^{\oplus r} \to
\mathcal{Q}'' \to 0
$$
where $\mathcal{Q}''$ has support properly contained in $Z_0$.
Thus by our initial remarks and property (1) of the lemma
we conclude that $i_*(\mathcal{I}')^{\oplus r}$ satisfies
$\mathcal{P}$. Hence we see that $i_*\mathcal{I}'$ satisfies
$\mathcal{P}$ by (2). Finally, for an arbitrary quasi-coherent
sheaf of ideals $\mathcal{I}'' \subset \mathcal{O}_{Z_0}$ we can set
$\mathcal{I} = \mathcal{I}'' \cap \mathcal{I}$ and we get
a short exact sequence
$$
0 \to
i_*(\mathcal{I}') \to
i_*(\mathcal{I}'') \to
\mathcal{Q}''' \to 0
$$
where $\mathcal{Q}'''$ has support properly contained in $Z_0$.
Hence we conclude that property $\mathcal{P}$ holds for
$i_*\mathcal{I}''$ as well. Slotting this into the proof of
Lemma \ref{lemma-property-irreducible}
at the appropriate point gives the lemma.
Some details omitted.
\end{proof}

\begin{lemma}
\label{lemma-property-higher-rank-cohomological}
(Cohomological variant of Lemma \ref{lemma-property-higher-rank}.)
Let $X$ be a Noetherian scheme.
Let $\mathcal{P}$ be a property of coherent sheaves on $X$ such that
\begin{enumerate}
\item For any short exact sequence of coherent sheaves
$$
0 \to \mathcal{F}_1 \to \mathcal{F} \to \mathcal{F}_2 \to 0
$$
if $\mathcal{F}_i$, $i = 1, 2$ have property $\mathcal{P}$
then so does $\mathcal{F}$.
\item If $\mathcal{P}$ holds for a direct sum of coherent sheaves
then it holds for both.
\item For every integral closed subscheme $Z \subset X$
with generic point $\xi$ there exists
some coherent sheaf $\mathcal{G}$ such that
\begin{enumerate}
\item $\text{Supp}(\mathcal{G}) = Z$,
\item $\mathcal{G}_\xi$ is annihilated by $\mathfrak m_\xi$, and
\item for every quasi-coherent sheaf of ideals
$\mathcal{J} \subset \mathcal{O}_X$ such that
$\mathcal{J}_\xi = \mathcal{O}_{X, \xi}$ there exists a quasi-coherent
subsheaf $\mathcal{G}' \subset \mathcal{J}\mathcal{G}$ with
$\mathcal{G}'_\xi = \mathcal{G}_\xi$ and such that
$\mathcal{P}$ holds for $\mathcal{G}'$.
\end{enumerate}
\end{enumerate}
Then property $\mathcal{P}$ holds for every coherent sheaf
on $X$.
\end{lemma}

\begin{proof}
Identical to the proofs of Lemmas \ref{lemma-property-higher-rank}
and \ref{lemma-property}.
\end{proof}








\section{Finite morphisms and affines}
\label{section-finite-affine}

\noindent
In this section we use the results of the preceding sections
to show that the image of a Noetherian affine scheme under a finite
morphism is affine. We will see later that this result holds more
generally (see Limits, Lemma \ref{limits-lemma-affine}).

\begin{lemma}
\label{lemma-finite-morphism-Noetherian}
Let $f : Y \to X$ be a morphism of schemes.
Assume $f$ is finite, surjective and $X$ locally Noetherian.
Let $Z \subset X$ be an integral closed subscheme with
generic point $\xi$. Then
there exists a coherent sheaf $\mathcal{F}$ on $Y$
such that the support of $f_*\mathcal{F}$ is equal to $Z$
and $(f_*\mathcal{F})_\xi$ is annihilated by $\mathfrak m_\xi$.
\end{lemma}

\begin{proof}
Note that $Y$ is locally Noetherian by
Morphisms, Lemma \ref{morphisms-lemma-finite-type-noetherian}.
Because $f$ is surjective the fibre $Y_\xi$ is not empty.
Pick $\xi' \in Y$ mapping to $\xi$. Let $Z' = \overline{\{\xi'\}}$.
We may think of $Z' \subset Y$ as a reduced closed subscheme,
see Schemes, Lemma \ref{schemes-lemma-reduced-closed-subscheme}.
Hence the sheaf $\mathcal{F} = (Z' \to Y)_*\mathcal{O}_{Z'}$
is a coherent sheaf on $Y$ (see
Lemma \ref{lemma-finite-pushforward-coherent}).
Look at the commutative diagram
$$
\xymatrix{
Z' \ar[r]_{i'} \ar[d]_{f'} &
Y \ar[d]^f \\
Z \ar[r]^i &
X
}
$$
We see that $f_*\mathcal{F} = i_*f'_*\mathcal{O}_{Z'}$.
Hence the stalk of $f_*\mathcal{F}$ at $\xi$ is the stalk
of $f'_*\mathcal{O}_{Z'}$ at $\xi$. Note that since $Z'$ is
integral with generic point $\xi'$ we have that
$\xi'$ is the only point of $Z'$ lying over $\xi$, see
Algebra, Lemmas \ref{algebra-lemma-finite-is-integral} and
\ref{algebra-lemma-integral-no-inclusion}.
Hence the stalk of $f'_*\mathcal{O}_{Z'}$ at $\xi$
equal $\mathcal{O}_{Z', \xi'} = \kappa(\xi')$. In particular
the stalk of $f_*\mathcal{F}$ at $\xi$ is not zero.
This combined with the fact that $f_*\mathcal{F}$ is
of the form $i_*f'_*(\text{something})$ implies the lemma.
\end{proof}

\begin{lemma}
\label{lemma-affine-morphism-projection-ideal}
Let $f : Y \to X$ be a morphism of schemes.
Let $\mathcal{F}$ be a quasi-coherent sheaf on $Y$.
Let $\mathcal{I}$ be a quasi-coherent sheaf of ideals on $X$.
If the morphism $f$ is affine then
$\mathcal{I}f_*\mathcal{F} = f_*(f^{-1}\mathcal{I}\mathcal{F})$.
\end{lemma}

\begin{proof}
The notation means the following. Since $f^{-1}$ is an exact functor
we see that $f^{-1}\mathcal{I}$ is a sheaf
of ideals of $f^{-1}\mathcal{O}_X$. Via the map
$f^\sharp : f^{-1}\mathcal{O}_X \to \mathcal{O}_Y$ this acts on
$\mathcal{F}$. Then $f^{-1}\mathcal{I}\mathcal{F}$ is the subsheaf
generated by sums of local sections of the form $as$ where $a$
is a local section of $f^{-1}\mathcal{I}$ and $s$ is a local section
of $\mathcal{F}$. It is a quasi-coherent $\mathcal{O}_Y$-submodule
of $\mathcal{F}$ because it is also the image of a natural map
$f^*\mathcal{I} \otimes_{\mathcal{O}_Y} \mathcal{F} \to \mathcal{F}$.

\medskip\noindent
Having said this the proof is straightforward. Namely, the question is local
and hence we may assume $X$ is affine. Since $f$ is affine we see that
$Y$ is affine too. Thus we may write
$Y = \Spec(B)$, $X = \Spec(A)$, $\mathcal{F} = \widetilde{M}$,
and $\mathcal{I} = \widetilde{I}$. The assertion of the lemma in this
case boils down to the statement that
$$
I(M_A) = ((IB)M)_A
$$
where $M_A$ indicates the $A$-module associated to the $B$-module $M$.
\end{proof}

\begin{lemma}
\label{lemma-image-affine-finite-morphism-affine-Noetherian}
Let $f : Y \to X$ be a morphism of schemes.
Assume
\begin{enumerate}
\item $f$ finite,
\item $f$ surjective,
\item $Y$ affine, and
\item $X$ Noetherian.
\end{enumerate}
Then $X$ is affine.
\end{lemma}

\begin{proof}
We will prove that under the assumptions of the lemma for any coherent
$\mathcal{O}_X$-module $\mathcal{F}$ we have $H^1(X, \mathcal{F}) = 0$.
Since this will in particular imply that $H^1(X, \mathcal{I}) = 0$
for every quasi-coherent sheaf of ideals of $\mathcal{O}_X$. Then it will
follows that $X$ is affine from either
Lemma \ref{lemma-quasi-compact-h1-zero-covering} or
Lemma \ref{lemma-quasi-separated-h1-zero-covering}.

\medskip\noindent
Let $\mathcal{P}$ be the property of coherent sheaves
$\mathcal{F}$ on $X$ defined by the rule
$$
\mathcal{P}(\mathcal{F}) \Leftrightarrow H^1(X, \mathcal{F}) = 0.
$$
We are going to apply Lemma \ref{lemma-property-higher-rank-cohomological}.
Thus we have to verify (1), (2) and (3) of that lemma for $\mathcal{P}$.
Property (1) follows from the long exact cohomology sequence associated
to a short exact sequence of sheaves. Property (2) follows since
$H^1(X, -)$ is an additive functor. To see (3) let $Z \subset X$ be
an integral closed subscheme with generic point $\xi$.
Let $\mathcal{F}$ be a coherent sheaf on $Y$ such that
the support of $f_*\mathcal{F}$ is equal to $Z$
and $(f_*\mathcal{F})_\xi$ is annihilated by $\mathfrak m_\xi$,
see Lemma \ref{lemma-finite-morphism-Noetherian}. We claim that
taking $\mathcal{G} = f_*\mathcal{F}$ works. We only have to verify
part (3)(c) of Lemma \ref{lemma-property-higher-rank-cohomological}.
Hence assume that $\mathcal{J} \subset \mathcal{O}_X$ is a 
quasi-coherent sheaf of ideals such that
$\mathcal{J}_\xi = \mathcal{O}_{X, \xi}$.
A finite morphism is affine hence by
Lemma \ref{lemma-affine-morphism-projection-ideal} we see that
$\mathcal{J}\mathcal{G} = f_*(f^{-1}\mathcal{J}\mathcal{F})$.
Also, as pointed out in the proof of
Lemma \ref{lemma-affine-morphism-projection-ideal} the sheaf
$f^{-1}\mathcal{J}\mathcal{F}$ is a quasi-coherent $\mathcal{O}_Y$-module.
Since $Y$ is affine we see that $H^1(Y, f^{-1}\mathcal{J}\mathcal{F}) = 0$,
see Lemma \ref{lemma-quasi-coherent-affine-cohomology-zero}.
Since $f$ is finite, hence affine, we see that
$R^qf_*(f^{-1}\mathcal{J}\mathcal{F}) = 0$ for all $q \geq 1$
by Lemma \ref{lemma-relative-affine-vanishing}.
By Cohomology, Lemma \ref{cohomology-lemma-apply-Leray} we see that
$$
H^1(X, \mathcal{J}\mathcal{G}) =
H^1(X, f_*(f^{-1}\mathcal{J}\mathcal{F})) =
H^1(Y, f^{-1}\mathcal{J}\mathcal{F}) = 0.
$$
Hence the quasi-coherent subsheaf $\mathcal{G}' = \mathcal{J}\mathcal{G}$
satisfies $\mathcal{P}$. This verifies property (3)(c) of
Lemma \ref{lemma-property-higher-rank-cohomological} as desired.
\end{proof}









\section{Coherent sheaves and projective morphisms}
\label{section-coherent-projective}

\noindent
It seems illuminating to formulate an all-in-one result for
projective space over a Noetherian ring.

\begin{lemma}
\label{lemma-coherent-projective}
Let $R$ be a Noetherian ring.
Let $n \geq 0$ be an integer.
For every coherent sheaf $\mathcal{F}$ on $\mathbf{P}^n_R$
we have the following:
\begin{enumerate}
\item There exists an $r \geq 0$ and
$d_1, \ldots, d_r \in \mathbf{Z}$ and a surjection
$$
\bigoplus\nolimits_{j = 1, \ldots, r}
\mathcal{O}_{\mathbf{P}^n_R}(d_j)
\longrightarrow
\mathcal{F}.
$$
\item We have $H^i(\mathbf{P}^n_R, \mathcal{F}) = 0$ unless
$0 \leq i \leq n$.
\item For any $i$ the cohomology group $H^i(\mathbf{P}^n_R, \mathcal{F})$
is a finite $R$-module.
\item If $i > 0$, then
$H^i(\mathbf{P}^n_R, \mathcal{F}(d)) = 0$ for all $d$ large enough.
\item For any $k \in \mathbf{Z}$ the graded $R[T_0, \ldots, T_n]$-module
$$
\bigoplus\nolimits_{d \geq k} H^0(\mathbf{P}^n_R, \mathcal{F}(d))
$$
is a finite $R[T_0, \ldots, T_n]$-module.
\end{enumerate}
\end{lemma}

\begin{proof}
We will use that $\mathcal{O}_{\mathbf{P}^n_R}(1)$ is an ample invertible
sheaf on
the scheme $\mathbf{P}^n_R$. This follows directly from the definition
since $\mathbf{P}^n_R$ covered by the standard affine opens $D_{+}(T_i)$.
Hence by
Properties, Proposition \ref{properties-proposition-characterize-ample}
every finite type quasi-coherent $\mathcal{O}_{\mathbf{P}^n_R}$-module
is a quotient of a finite direct sum of tensor powers of
$\mathcal{O}_{\mathbf{P}^n_R}(1)$. On the other hand a coherent sheaves
and finite type quasi-coherent sheaves are the same thing on projective
space over $R$ by Lemma \ref{lemma-coherent-Noetherian}. Thus we see (1).

\medskip\noindent
Projective $n$-space $\mathbf{P}^n_R$ is covered by $n + 1$ affines,
namely the standard opens $D_{+}(T_i)$, $i = 0, \ldots, n$, see Constructions,
Lemma \ref{constructions-lemma-standard-covering-projective-space}.
Hence we see that for any quasi-coherent
sheaf $\mathcal{F}$ on $\mathbf{P}^n_R$
we have $H^i(\mathbf{P}^n_R, \mathcal{F}) = 0$ for $i \geq n + 1$,
see Lemma \ref{lemma-vanishing-nr-affines}. Hence (2) holds.

\medskip\noindent
Let us prove (3) and (4) simultaneously for all coherent sheaves
on $\mathbf{P}^n_R$ by descending induction on $i$. Clearly the result
holds for $i \geq n + 1$ by (2). Suppose we know the result for
$i + 1$ and we want to show the result for $i$. (If $i = 0$, then
part (4) is vacuous.) Let $\mathcal{F}$ be a coherent sheaf on
$\mathbf{P}^n_R$. Choose a surjection as in (1) and denote
$\mathcal{G}$ the kernel so that we have a short exact sequence
$$
0 \to \mathcal{G} \to
\bigoplus\nolimits_{j = 1, \ldots, r}
\mathcal{O}_{\mathbf{P}^n_R}(d_j)
\to
\mathcal{F} \to 0
$$
By Lemma \ref{lemma-coherent-abelian-Noetherian}
we see that $\mathcal{G}$ is coherent. The long exact
cohomology sequence gives an exact sequence
$$
H^i(\mathbf{P}^n_R, \bigoplus\nolimits_{j = 1, \ldots, r}
\mathcal{O}_{\mathbf{P}^n_R}(d_j))
\to
H^i(\mathbf{P}^n_R, \mathcal{F})
\to
H^{i + 1}(\mathbf{P}^n_R, \mathcal{G}).
$$
By induction assumption the right $R$-module is finite and by
Lemma \ref{lemma-cohomology-projective-space-over-ring} the left
$R$-module is finite. Since $R$ is Noetherian it follows immediately
that $H^i(\mathbf{P}^n_R, \mathcal{F})$ is a finite $R$-module.
This proves the induction step for assertion (3).
Since $\mathcal{O}_{\mathbf{P}^n_R}(d)$ is invertible
we see that twisting on $\mathbf{P}^n_R$ is an exact functor (since
you get it by tensoring with an invertible sheaf, see
Constructions, Definition \ref{constructions-definition-twist}).
This means that for all $d \in \mathbf{Z}$ the sequence
$$
0 \to \mathcal{G}(d) \to
\bigoplus\nolimits_{j = 1, \ldots, r}
\mathcal{O}_{\mathbf{P}^n_R}(d_j + d)
\to
\mathcal{F}(d) \to 0
$$
is short exact. The resulting cohomology sequence is
$$
H^i(\mathbf{P}^n_R, \bigoplus\nolimits_{j = 1, \ldots, r}
\mathcal{O}_{\mathbf{P}^n_R}(d_j + d))
\to
H^i(\mathbf{P}^n_R, \mathcal{F}(d))
\to
H^{i + 1}(\mathbf{P}^n_R, \mathcal{G}(d)).
$$
By induction assumption we see the module on the right is zero
for $d \gg 0$ and by the computation in
Lemma \ref{lemma-cohomology-projective-space-over-ring}
the module on the left is zero as soon as $d \geq -\min\{d_j\}$
and $i \geq 1$. Hence the induction step for assertion (4).
This concludes the proof of (3) and (4).

\medskip\noindent
In order to prove (5) note that for all sufficiently large $d$
the map
$$
H^0(\mathbf{P}^n_R, \bigoplus\nolimits_{j = 1, \ldots, r}
\mathcal{O}_{\mathbf{P}^n_R}(d_j + d))
\to
H^0(\mathbf{P}^n_R, \mathcal{F}(d))
$$
is surjective by the vanishing of $H^1(\mathbf{P}^n_R, \mathcal{G}(d))$
we just proved. In other words, the module
$$
M_k
=
\bigoplus\nolimits_{d \geq k} H^0(\mathbf{P}^n_R, \mathcal{F}(d))
$$
is for $k$ large enough a quotient of the corresponding module
$$
N_k
=
\bigoplus\nolimits_{d \geq k} H^0(\mathbf{P}^n_R,
\bigoplus\nolimits_{j = 1, \ldots, r}
\mathcal{O}_{\mathbf{P}^n_R}(d_j + d)
)
$$
When $k$ is sufficiently small (e.g.\ $k < -d_j$ for all $j$) then
$$
N_k = \bigoplus\nolimits_{j = 1, \ldots, r}
R[T_0, \ldots, T_n](d_j)
$$
by our computations in Section \ref{section-cohomology-projective-space}.
In particular it is finitely generated.
Suppose $k \in \mathbf{Z}$ is arbitrary.
Choose $k_{-} \ll k \ll k_{+}$.
Consider the diagram
$$
\xymatrix{
N_{k_{-}} & N_{k_{+}} \ar[d] \ar[l] \\
M_k & M_{k_{+}} \ar[l]
}
$$
where the vertical arrow is the surjective map above and
the horizontal arrows are the obvious inclusion maps.
By what was said above we see that $N_{k_{-}}$ is a finitely
generated $R[T_0, \ldots, T_n]$-module. Hence $N_{k_{+}}$ is
a finitely generated $R[T_0, \ldots, T_n]$-module because it
is a submodule of a finitely generated module and the ring
$R[T_0, \ldots, T_n]$ is Noetherian. Since the vertical arrow
is surjective we conclude that $M_{k_{+}}$ is a finitely
generated $R[T_0, \ldots, T_n]$-module. The quotient
$M_k/M_{k_{+}}$ is finite as an $R$-module since it is a
finite direct sum of the finite $R$-modules
$H^0(\mathbf{P}^n_R, \mathcal{F}(d))$ for $k \leq d < k_{+}$.
Note that we use part (3) for $i = 0$ here. Hence
$M_k/M_{k_{+}}$ is a fortiori a finite $R[T_0, \ldots, T_n]$-module.
In other words, we have sandwiched $M_k$ between two finite
$R[T_0, \ldots, T_n]$-modules and we win.
\end{proof}

\begin{lemma}
\label{lemma-kill-by-twisting}
Let $f : X \to S$ be a morphism of schemes.
Let $\mathcal{F}$ be a quasi-coherent $\mathcal{O}_X$-module.
Let $\mathcal{L}$ be an invertible sheaf on $X$.
Assume that
\begin{enumerate}
\item $S$ is Noetherian,
\item $f$ is proper,
\item $\mathcal{F}$ is coherent, and
\item $\mathcal{L}$ is relatively ample on $X/S$.
\end{enumerate}
Then there exists an $n_0$ such that for all $n \geq n_0$
we have
$$
R^pf_*\left(\mathcal{F} \otimes_{\mathcal{O}_X} \mathcal{L}^{\otimes n}\right)
=
0
$$
for all $p > 0$.
\end{lemma}

\begin{proof}
A proper morphism is of finite type by definition.
By Morphisms, Lemma \ref{morphisms-lemma-characterize-ample-on-finite-type}
there exists an open covering $S = \bigcup V_j$ and immersions
$i_j : X_j \to \mathbf{P}^{n_j}_{V_j}$, where $X_j = f^{-1}(V_j)$
such that $i_j^*\mathcal{O}(1)$ is a power of $\mathcal{L}$.
Since $S$ is quasi-compact we may assume the covering is finite.
Clearly, if we solve the question for each of the finitely many
systems $(X_j \to V_j, \mathcal{L}|_{X_j}, \mathcal{F}|_{V_j})$
then the result follows. Hence we may assume there exists an
immersion $i : X \to \mathbf{P}^n_S$ such that
$\mathcal{L}^{\otimes d} = i^*\mathcal{O}(1)$ for some $d \geq 1$.

\medskip\noindent
Repeating the argument above with a finite affine open covering
of $S$ we see that we may also assume that $S$ is affine.
In this case the vanishing of
$R^pf_*(\mathcal{F} \otimes \mathcal{L}^{\otimes n})$
is equivalent to the vanishing of
$H^p(X, \mathcal{F} \otimes \mathcal{L}^{\otimes n})$, see
Lemma \ref{lemma-quasi-coherence-higher-direct-images-application}.

\medskip\noindent
Since $f$ is proper we see that $i$ is a closed immersion
(Morphisms, Lemma \ref{morphisms-lemma-image-proper-scheme-closed}).
Hence we see that
$R^pi_*(\mathcal{F} \otimes_{\mathcal{O}_X} \mathcal{L}^{\otimes n}) = 0$
for all $p \geq 1$ (see Lemma \ref{lemma-finite-pushforward-coherent}
for example). This implies that
$$
H^p(X, \mathcal{F} \otimes \mathcal{L}^{\otimes n})
=
H^p(\mathbf{P}^n_S, i_*(\mathcal{F} \otimes \mathcal{L}^{\otimes n}))
$$
by the Leray spectral sequence
(Cohomology, Lemma \ref{cohomology-lemma-Leray}).
Moreover, by the projection formula
(Cohomology, Lemma \ref{cohomology-lemma-projection-formula})
we have
$$
i_*(\mathcal{F} \otimes_{\mathcal{O}_X} \mathcal{L}^{\otimes n})
=
i_*(\mathcal{F} \otimes_{\mathcal{O}_X}
\mathcal{L}^{\otimes \langle n \rangle_d})
\otimes_{\mathcal{O}_{\mathbf{P}^n_S}}
\mathcal{O}(\lfloor n/d \rfloor)
$$
for all $n \in \mathbf{Z}$ where
$\langle n \rangle_d \in \{0, 1, \ldots, d - 1\}$
is the unique element congruent to $n$ module $d$.
The sheaves $\mathcal{F}_j = i_*(\mathcal{F} \otimes \mathcal{L}^{\otimes j})$,
$j \in \{0, 1, \ldots, d - 1\}$ are coherent by
Lemma \ref{lemma-finite-pushforward-coherent}.
Thus we see that for all $n$ large enough the cohomology groups
$H^p(\mathbf{P}^n_S, \mathcal{F}_j(n))$ vanish by
Lemma \ref{lemma-coherent-projective}.
Putting everything together this implies the lemma.
\end{proof}




\section{Chow's Lemma}
\label{section-chows-lemma}

\noindent
In this section we prove Chow's lemma in the Noetherian
case (Lemma \ref{lemma-chow-Noetherian}).
In
Limits, Section \ref{limits-section-chows-lemma}
we prove some variants for the non-Noetherian case.

\begin{lemma}
\label{lemma-chow-Noetherian}
Let $S$ be a Noetherian scheme.
Let $f : X \to S$ be a separated morphism of finite type.
Then there exists an $n \geq 0$ and a diagram
$$
\xymatrix{
X \ar[rd] & X' \ar[d] \ar[l]^\pi \ar[r] & \mathbf{P}^n_S \ar[dl] \\
& S &
}
$$
where $X' \to \mathbf{P}^n_S$ is an immersion, and
$\pi : X' \to X$ is proper and surjective. Moreover, we may
arrange it such that there exists a dense open subscheme
$U \subset X$ such that $\pi^{-1}(U) \to U$ is an isomorphism.
\end{lemma}

\begin{proof}
All of the schemes we will encounter during the rest of the proof
are going to be of finite type over the Noetherian scheme $S$ and
hence Noetherian
(see Morphisms, Lemma \ref{morphisms-lemma-finite-type-noetherian}).
All morphisms between them will automatically be quasi-compact, locally of
finite type and quasi-separated, see
Morphisms, Lemma \ref{morphisms-lemma-permanence-finite-type} and
Properties,
Lemmas \ref{properties-lemma-locally-Noetherian-quasi-separated} and
\ref{properties-lemma-morphism-Noetherian-schemes-quasi-compact}.

\medskip\noindent
The underlying topological space of $X$ is Noetherian
(see Properties, Lemma \ref{properties-lemma-Noetherian-topology})
and we conclude that $X$ has only finitely many irreducible components
(see Topology, Lemma \ref{topology-lemma-Noetherian}).
Say $X = X_1 \cup \ldots \cup X_r$ is the decomposition
of $X$ into irreducible components.
Let $\eta_i \in X_i$ be the generic point.
For every point $x \in X$ there exists an affine open
$U_x \subset X$ which contains $x$ and each of the generic
points $\eta_i$. See
Properties, Lemma \ref{properties-lemma-point-and-maximal-points-affine}.
Since $X$ is quasi-compact, we can find a finite affine open
covering $X = U_1 \cup \ldots \cup U_m$ such that
each $U_i$ contains $\eta_1, \ldots, \eta_r$.
In particular we conclude that the open
$U = U_1 \cap \ldots \cap U_m \subset X$ is
a dense open. This and the fact that the $U_i$ are affine opens
covering $X$ is all that we will use below.

\medskip\noindent
Let $X^* \subset X$ be the scheme theoretic closure of $U \to X$, see
Morphisms, Definition \ref{morphisms-definition-scheme-theoretic-image}.
Let $U_i^* = X^* \cap U_i$. Note that $U_i^*$ is a closed subscheme
of $U_i$. Hence $U_i^*$ is affine. Since $U$ is dense in $X$ the
morphism $X^* \to X$ is a surjective closed immersion. It is an
isomorphism over $U$. Hence we may replace $X$ by $X^*$ and
$U_i$ by $U_i^*$ and assume that $U$ is scheme theoretically dense
in $X$, see
Morphisms, Definition \ref{morphisms-definition-scheme-theoretically-dense}.

\medskip\noindent
By Morphisms, Lemma \ref{morphisms-lemma-quasi-projective-finite-type-over-S}
we can find an immersion $j_i : U_i \to \mathbf{P}_S^{n_i}$
for each $i$. By
Morphisms, Lemma \ref{morphisms-lemma-quasi-compact-immersion} we can find
closed subschemes $Z_i \subset \mathbf{P}_S^{n_i}$
such that $j_i : U_i \to Z_i$ is a scheme theoretically
dense open immersion. Note that $Z_i \to S$ is proper, see
Morphisms, Lemma \ref{morphisms-lemma-locally-projective-proper}.
Consider the morphism
$$
j = (j_1|_U, \ldots, j_n|_U) : U \longrightarrow
\mathbf{P}_S^{n_1} \times_S \ldots \times_S \mathbf{P}_S^{n_n}.
$$
By the lemma cited above we can find a closed subscheme
$Z$ of $\mathbf{P}_S^{n_1} \times_S \ldots \times_S \mathbf{P}_S^{n_n}$
such that $j : U \to Z$ is an open immersion and such that $U$
is scheme theoretically dense in $Z$. The morphism $Z \to S$
is proper. Consider the $i$th projection
$$
\text{pr}_i|_Z : Z \longrightarrow \mathbf{P}^{n_i}_S.
$$
This morphism factors through $Z_i$ (see Morphisms,
Lemma \ref{morphisms-lemma-factor-factor}). Denote $p_i : Z \to Z_i$
the induced morphism. This is a proper morphism, see
Morphisms, Lemma \ref{morphisms-lemma-image-proper-scheme-closed}
for example. At this point we have that
$U \subset U_i \subset Z_i$ are scheme theoretically
dense open immersions. Moreover, we can think of $Z$ as the
scheme theoretic image of the ``diagonal'' morphism
$U \to Z_1 \times_S \ldots \times_S Z_n$.

\medskip\noindent
Set $V_i = p_i^{-1}(U_i)$. Note that $p_i|_{V_i} : V_i \to U_i$ is proper.
Set $X' = V_1 \cup \ldots \cup V_n$. By construction $X'$ has an immersion
into the scheme
$\mathbf{P}^{n_1}_S \times_S \ldots \times_S \mathbf{P}^{n_n}_S$.
Thus by the Segre embedding (see
Morphisms, Lemma \ref{morphisms-lemma-segre-embedding}) we see that $X'$ has
an immersion into a projective space over $S$.

\medskip\noindent
We claim that the morphisms $p_i|_{V_i}: V_i \to U_i$ glue to a morphism
$X' \to X$. Namely, it is clear that $p_i|_U$ is the identity map
from $U$ to $U$. Since $U \subset X'$ is scheme theoretically
dense by construction, it is also scheme theoretically dense
in the open subscheme $V_i \cap V_j$. Thus we see that
$p_i|_{V_i \cap V_j} = p_j|_{V_i \cap V_j}$ as morphisms into the
separated $S$-scheme $X$, see
Morphisms, Lemma \ref{morphisms-lemma-equality-of-morphisms}.
We denote the resulting morphism $\pi : X' \to X$.

\medskip\noindent
We claim that $\pi^{-1}(U_i) = V_i$.
Since $\pi|_{V_i} = p_i|_{V_i}$ it follows that
$V_i \subset \pi^{-1}(U_i)$. Consider the diagram
$$
\xymatrix{
V_i \ar[r] \ar[rd]_{p_i|_{V_i}} & \pi^{-1}(U_i) \ar[d] \\
& U_i
}
$$
Since $V_i \to U_i$ is proper we see that the image of
the horizontal arrow is closed, see
Morphisms, Lemma \ref{morphisms-lemma-image-proper-scheme-closed}.
Since $V_i \subset \pi^{-1}(U_i)$ is scheme
theoretically dense (as it contains $U$)
we conclude that $V_i = \pi^{-1}(U_i)$ as claimed.

\medskip\noindent
This shows that $\pi^{-1}(U_i) \to U_i$ is identified with the proper
morphism $p_i|_{V_i} : V_i \to U_i$. Hence we see that $X$ has a
finite affine covering $X = \bigcup U_i$ such that the restriction
of $\pi$ is proper on each member of the covering.
Thus by Morphisms, Lemma \ref{morphisms-lemma-proper-local-on-the-base}
we see that $\pi$ is proper.

\medskip\noindent
Finally we have to show that $\pi^{-1}(U) = U$. To see this we argue in the
same way as above using the diagram
$$
\xymatrix{
U \ar[r] \ar[rd] & \pi^{-1}(U) \ar[d] \\
& U
}
$$
and using that $\text{id}_U : U \to U$ is proper and that
$U$ is scheme theoretically dense in $\pi^{-1}(U)$.
\end{proof}

\begin{remark}
\label{remark-chow-Noetherian}
In the situation of Chow's
Lemma \ref{lemma-chow-Noetherian}:
\begin{enumerate}
\item The morphism $\pi$ is actually H-projective (hence projective, see
Morphisms, Lemma \ref{morphisms-lemma-H-projective})
since the morphism $X' \to \mathbf{P}^n_S \times_S X = \mathbf{P}^n_X$
is a closed immersion (use the fact that $\pi$ is proper, see
Morphisms, Lemma \ref{morphisms-lemma-image-proper-scheme-closed}).
\item We may assume that $\pi^{-1}(U)$ is scheme theoretically dense
in $X'$. Namely, we can simply replace $X'$ by the scheme theoretic
closure of $\pi^{-1}(U)$. In this case we can think of $U$ as a
scheme theoretically dense open subscheme of $X'$.
See Morphisms, Section \ref{morphisms-section-scheme-theoretic-image}.
\item If $X$ is reduced then we may choose $X'$ reduced. This is clear
from (2).
\end{enumerate}
\end{remark}






\section{Higher direct images of coherent sheaves}
\label{section-proper-pushforward}

\noindent
In this section we prove the fundamental fact that the higher
direct images of a coherent sheaf under a proper morphism
are coherent.

\begin{lemma}
\label{lemma-locally-projective-pushforward}
Let $S$ be a locally Noetherian scheme.
Let $f : X \to S$ be a locally projective morphism.
Let $\mathcal{F}$ be a coherent $\mathcal{O}_X$-module.
Then $R^if_*\mathcal{F}$ is a coherent $\mathcal{O}_S$-module
for all $i \geq 0$.
\end{lemma}

\begin{proof}
We first remark that a locally projective morphism is proper
(Morphisms, Lemma \ref{morphisms-lemma-locally-projective-proper})
and hence of finite type.
In particular $X$ is locally Noetherian
(Morphisms, Lemma \ref{morphisms-lemma-finite-type-noetherian})
and hence the statement makes sense.
Moreover, by Lemma \ref{lemma-quasi-coherence-higher-direct-images}
the sheaves $R^pf_*\mathcal{F}$ are quasi-coherent.

\medskip\noindent
Having said this the statement is local on $S$ (for example by
Cohomology, Lemma \ref{cohomology-lemma-localize-higher-direct-images}).
Hence we may assume $S = \Spec(R)$ is the spectrum of
a Noetherian ring, and $X$ is a closed subscheme of
$\mathbf{P}^n_R$ for some $n$, see
Morphisms, Lemma \ref{morphisms-lemma-characterize-locally-projective}.
In this case, the sheaves $R^pf_*\mathcal{F}$ are the quasi-coherent
sheaves associated to the $R$-modules $H^p(X, \mathcal{F})$, see
Lemma \ref{lemma-quasi-coherence-higher-direct-images-application}.
Hence it suffices to show that $R$-modules $H^p(X, \mathcal{F})$
are finite $R$-modules (Lemma \ref{lemma-coherent-Noetherian}).
Denote $i : X \to \mathbf{P}^n_R$ the closed immersion.
Note that $R^pi_*\mathcal{F} = 0$ by
Lemma \ref{lemma-finite-pushforward-coherent}.
Hence the Leray spectral sequence
(Cohomology, Lemma \ref{cohomology-lemma-Leray})
for $i : X \to \mathbf{P}^n_R$ degenerates, and we see that
$H^p(X, \mathcal{F}) = H^p(\mathbf{P}^n_R, i_*\mathcal{F})$.
Since the sheaf $i_*\mathcal{F}$ is coherent by
Lemma \ref{lemma-finite-pushforward-coherent}
we see that the lemma follows from Lemma \ref{lemma-coherent-projective}.
\end{proof}

\noindent
Here is the general statement.

\begin{lemma}
\label{lemma-proper-pushforward-coherent}
Let $S$ be a locally Noetherian scheme.
Let $f : X \to S$ be a proper morphism.
Let $\mathcal{F}$ be a coherent $\mathcal{O}_X$-module.
Then $R^if_*\mathcal{F}$ is a coherent $\mathcal{O}_S$-module
for all $i \geq 0$.
\end{lemma}

\begin{proof}
Since the problem is local on $S$ we may assume that $S$ is
a Noetherian scheme. Since a proper morphism is of finite type
we see that in this case $X$ is a Noetherian scheme also.
Consider the property $\mathcal{P}$ of coherent sheaves
on $X$ defined by the rule
$$
\mathcal{P}(\mathcal{F}) \Leftrightarrow
R^pf_*\mathcal{F}\text{ is coherent for all }p \geq 0
$$
We are going to use the result of
Lemma \ref{lemma-property} to prove that
$\mathcal{P}$ holds for every coherent sheaf on $X$.

\medskip\noindent
Let
$$
0 \to \mathcal{F}_1 \to \mathcal{F}_2 \to \mathcal{F}_3 \to 0
$$
be a short exact sequence of coherent sheaves on $X$.
Consider the long exact sequence of higher direct images
$$
R^{p - 1}f_*\mathcal{F}_3 \to
R^pf_*\mathcal{F}_1 \to
R^pf_*\mathcal{F}_2 \to
R^pf_*\mathcal{F}_3 \to
R^{p + 1}f_*\mathcal{F}_1
$$
Then it is clear that if 2-out-of-3 of the sheaves $\mathcal{F}_i$
have property $\mathcal{P}$, then the higher direct images of the
third are sandwiched in this exact complex between two coherent
sheaves. Hence these higher direct images are also coherent by
Lemma \ref{lemma-coherent-abelian-Noetherian} and
\ref{lemma-coherent-Noetherian-quasi-coherent-sub-quotient}.
Hence property $\mathcal{P}$ holds for the third as well.

\medskip\noindent
Let $Z \subset X$ be an integral closed subscheme.
We have to find a coherent sheaf $\mathcal{F}$ on $X$ whose support is
contained in $Z$, whose stalk at the generic point $\xi$ of $Z$ is a
$1$-dimensional vector space over $\kappa(\xi)$ such that $\mathcal{P}$
holds for $\mathcal{F}$. Denote $g = f|_Z : Z \to S$ the restriction of $f$.
Suppose we can find a coherent sheaf $\mathcal{G}$ on $Z$ such
that
(a) $\mathcal{G}_\xi$ is a $1$-dimensional vector space over $\kappa(\xi)$,
(b) $R^pg_*\mathcal{G} = 0$ for $p > 0$, and
(c) $g_*\mathcal{G}$ is coherent. Then we can consider
$\mathcal{F} = (Z \to X)_*\mathcal{G}$. As $Z \to X$ is a closed immersion
we see that $(Z \to X)_*\mathcal{G}$ is coherent on $X$
and $R^p(Z \to X)_*\mathcal{G} = 0$ for $p > 0$
(Lemma \ref{lemma-finite-pushforward-coherent}).
Hence by the relative Leray spectral sequence
(Cohomology, Lemma \ref{cohomology-lemma-relative-Leray})
we will have $R^pf_*\mathcal{F} = R^pg_*\mathcal{G} = 0$ for $p > 0$
and $f_*\mathcal{F} = g_*\mathcal{G}$ is coherent.
Finally $\mathcal{F}_\xi = ((Z \to X)_*\mathcal{G})_\xi = \mathcal{G}_\xi$
which verifies the condition on the stalk at $\xi$.
Hence everything depends on finding a coherent sheaf $\mathcal{G}$
on $Z$ which has properties (a), (b), and (c).

\medskip\noindent
We can apply Chow's Lemma \ref{lemma-chow-Noetherian}
to the morphism $Z \to S$. Thus we get a diagram
$$
\xymatrix{
Z \ar[rd]_g & Z' \ar[d]^-{g'} \ar[l]^\pi \ar[r]_i & \mathbf{P}^n_S \ar[dl] \\
& S &
}
$$
as in the statement of Chow's lemma. Also, let $U \subset Z$ be
the dense open subscheme such that $\pi^{-1}(U) \to U$ is an isomorphism.
By the discussion in Remark \ref{remark-chow-Noetherian} we see that
$i' = (i, \pi) : \mathbf{P}^n_S \times_S Z' = \mathbf{P}^n_Z$ is
a closed immersion. Hence
$$
\mathcal{L} = i^*\mathcal{O}_{\mathbf{P}^n_X}(1) \cong
(i')^*\mathcal{O}_{\mathbf{P}^n_Z}(1)
$$
is $g'$-relatively ample and $\pi$-relatively ample (for example by
Morphisms, Lemma \ref{morphisms-lemma-characterize-ample-on-finite-type}).
Hence by Lemma \ref{lemma-kill-by-twisting}
there exists an $n \geq 0$ such that
both $R^p\pi_*\mathcal{L}^{\otimes n} = 0$ for all $p > 0$ and
$R^p(g')_*\mathcal{L}^{\otimes n} = 0$ for all $p > 0$.
Set $\mathcal{G} = \pi_*\mathcal{L}^{\otimes n}$.
Property (a) holds because $\pi_*\mathcal{L}^{\otimes}|_U$ is
an invertible sheaf (as $\pi^{-1}(U) \to U$ is an isomorphism).
Properties (b) and (c) hold because by the relative Leray
spectral sequence
(Cohomology, Lemma \ref{cohomology-lemma-relative-Leray})
we have
$$
E_2^{p, q} = R^pg_* R^q\pi_*\mathcal{L}^{\otimes n}
\Rightarrow
R^{p + q}(g')_*\mathcal{L}^{\otimes n}
$$
and by choice of $n$ the only nonzero terms in $E_2^{p, q}$ are
those with $q = 0$ and the only nonzero terms of
$R^{p + q}(g')_*\mathcal{L}^{\otimes n}$ are those with $p = q = 0$.
This implies that $R^pg_*\mathcal{G} = 0$ for $p > 0$ and
that $g_*\mathcal{G} = (g')_*\mathcal{L}^{\otimes n}$.
Finally, applying the previous
Lemma \ref{lemma-locally-projective-pushforward}
we see that $g_*\mathcal{G} = (g')_*\mathcal{L}^{\otimes n}$ is
coherent as desired.
\end{proof}

\begin{lemma}
\label{lemma-proper-over-affine-cohomology-finite}
Let $S = \Spec(A)$ with $A$ a Noetherian ring.
Let $f : X \to S$ be a proper morphism.
Let $\mathcal{F}$ be a coherent $\mathcal{O}_X$-module.
Then $H^i(X, \mathcal{F})$ is finite $A$-module for all $i \geq 0$.
\end{lemma}

\begin{proof}
This is just the affine case of Lemma \ref{lemma-proper-pushforward-coherent}.
Namely, by Lemmas \ref{lemma-quasi-coherence-higher-direct-images} and
\ref{lemma-quasi-coherence-higher-direct-images-application} we know that
$R^if_*\mathcal{F}$ is the quasi-coherent sheaf associated
to the $A$-module $H^i(X, \mathcal{F})$
and by Lemma \ref{lemma-coherent-Noetherian} this is
a coherent sheaf if and only if $H^i(X, \mathcal{F})$
is an $A$-module of finite type.
\end{proof}














\section{The theorem on formal functions}
\label{section-theorem-formal-functions}

\noindent
In this section we study the behaviour of cohomology of
sequences of sheaves either of the form $\{I^n\mathcal{F}\}_{n \geq 0}$
or of the form $\{\mathcal{F}/I^n\mathcal{F}\}_{n \geq 0}$ as
$n$-varies.

\medskip\noindent
Here and below we use the following notation.
Given a morphism of schemes $f : X \to Y$, a quasi-coherent sheaf
$\mathcal{F}$ on $X$, and a quasi-coherent sheaf of ideals
$\mathcal{I} \subset \mathcal{O}_Y$ we denote
$\mathcal{I}^n\mathcal{F}$ the quasi-coherent subsheaf generated
by products of local sections of $f^{-1}(\mathcal{I}^n)$ and
$\mathcal{F}$. In a formula
$$
\mathcal{I}^n\mathcal{F}
=
\text{Im}\left(
f^*(\mathcal{I}^n) \otimes_{\mathcal{O}_X} \mathcal{F}
\longrightarrow
\mathcal{F}
\right).
$$
Note that there are natural maps
$$
f^{-1}(\mathcal{I}^n) \otimes_{f^{-1}\mathcal{O}_Y} \mathcal{I}^m\mathcal{F}
\longrightarrow
f^*(\mathcal{I}^n) \otimes_{\mathcal{O}_X} \mathcal{I}^m\mathcal{F}
\longrightarrow
\mathcal{I}^{n + m}\mathcal{F}
$$
Hence a section of $\mathcal{I}^n$ will give rise to a
map $R^pf_*(\mathcal{I}^m\mathcal{F}) \to
R^pf_*(\mathcal{I}^{n + m}\mathcal{F})$ by functoriality
of higher direct images. Localizing and then sheafifying we
see that there are $\mathcal{O}_Y$-module maps
$$
\mathcal{I}^n \otimes_{\mathcal{O}_Y} R^pf_*(\mathcal{I}^m\mathcal{F})
\longrightarrow
R^pf_*(\mathcal{I}^{n + m}\mathcal{F}).
$$
In other words we see that
$\bigoplus_{n \geq 0} R^pf_*(\mathcal{I}^n\mathcal{F})$
is a graded $\bigoplus_{n \geq 0} \mathcal{I}^n$-module.

\medskip\noindent
If $Y = \Spec(A)$ and $\mathcal{I} = \widetilde{I}$ we denote
$\mathcal{I}^n\mathcal{F}$ simply $I^n\mathcal{F}$. The maps
introduced above give $M = \bigoplus H^p(X, I^n\mathcal{F})$ the
structure of a graded $S = \bigoplus I^n$-module. If $f$ is proper,
$A$ is Noetherian and $\mathcal{F}$ is coherent, then this turns out
to be a module of finite type.

\begin{lemma}
\label{lemma-cohomology-powers-ideal-times-F}
Let $A$ be a Noetherian ring.
Let $I \subset A$ be an ideal.
Set $S = \bigoplus_{n \geq 0} I^n$.
Let $f : X \to \Spec(A)$ be a proper morphism.
Let $\mathcal{F}$ be a coherent sheaf on $X$.
Then for every $p \geq 0$ the graded $S$-module
$\bigoplus_{n \geq 0} H^p(X, I^n\mathcal{F})$ is
a finite $S$-module.
\end{lemma}

\begin{proof}
To prove this we consider the fibre product diagram
$$
\xymatrix{
X' = \Spec(S) \times_{\Spec(A)} X
\ar[r] \ar[d]_{f'} &
X \ar[d]^f \\
\Spec(S) \ar[r] &
\Spec(A)
}
$$
Note that $f'$ is a proper morphism, see
Morphisms, Lemma \ref{morphisms-lemma-base-change-proper}.
Also, $S$ is a finitely generated $A$-algebra, and hence
Noetherian (Algebra, Lemma \ref{algebra-lemma-Noetherian-permanence}).
Thus the result will follow from
Lemma \ref{lemma-proper-over-affine-cohomology-finite}
if we can show there exists a
coherent sheaf $\mathcal{F}'$ on $X'$ whose cohomology
groups $H^p(X', \mathcal{F}')$ are identified with
$\bigoplus_{n \geq 0} H^p(X, I^n\mathcal{F})$.

\medskip\noindent
To do this note that the morphism $\pi : X' \to X$ is affine, see
Morphisms, Lemma \ref{morphisms-lemma-base-change-affine}.
Hence $H^p(X', \mathcal{F}') = H^p(X, \pi_*\mathcal{F}')$.
In other words, it suffices to construct a coherent
$\mathcal{O}_{X'}$-module $\mathcal{F}'$ such that
$\pi_*\mathcal{F}' = \bigoplus_{n \geq 0} I^n\mathcal{F}$.
Note that
$\pi_*\mathcal{O}_{X'} = \bigoplus_{n \geq 0} I^n \otimes_A \mathcal{O}_X$
hence the sheaf $\bigoplus_{n \geq 0} I^n\mathcal{F}$ has a natural
structure of $\pi_*\mathcal{O}_{X'}$-module.
By Morphisms, Lemma \ref{morphisms-lemma-affine-equivalence-modules}
we see that there is a unique quasi-coherent
$\mathcal{O}_{X'}$-module $\mathcal{F}'$ such that
$\pi_*\mathcal{F}' \cong \bigoplus_{n \geq 0} I^n \mathcal{F}$
as $\pi_*\mathcal{O}_{X'}$-modules.
Finally, we have to show that $\mathcal{F}'$ is a coherent
$\mathcal{O}_{X'}$-module.

\medskip\noindent
Let $\Spec(B) = U \subset X$ be any affine open.
Say $\mathcal{F}|_U$ is the coherent $\mathcal{O}_U$-module
associated to the finite $B$-module $M$.
By definition $\pi^{-1}(U) = \Spec(S \otimes_A B)$.
Since $B' = S \otimes_A B = \bigoplus_{n \geq 0} I^n \otimes_A B$
it is clear that $\mathcal{F}'$ corresponds to the
$B'$-module $\bigoplus I^nM$ which is clearly finitely generated.
\end{proof}

\begin{lemma}
\label{lemma-cohomology-powers-ideal-times-sheaf}
Given a morphism of schemes $f : X \to Y$, a quasi-coherent sheaf
$\mathcal{F}$ on $X$, and a quasi-coherent sheaf of ideals
$\mathcal{I} \subset \mathcal{O}_Y$. Assume $Y$ locally
Noetherian, $f$ proper, and $\mathcal{F}$ coherent.
Then
$$
\mathcal{M} =
\bigoplus\nolimits_{n \geq 0} R^pf_*(\mathcal{I}^n\mathcal{F})
$$
is a graded $\mathcal{A} = \bigoplus_{n \geq 0} \mathcal{I}^n$-module
which is quasi-coherent and of finite type.
\end{lemma}

\begin{proof}
The statement is local on $Y$, hence this reduces to the
case where $Y$ is affine. In the affine case the result follows
from Lemma \ref{lemma-cohomology-powers-ideal-times-F}.
Details omitted.
\end{proof}

\begin{lemma}
\label{lemma-cohomology-powers-ideal-application}
Let $A$ be a Noetherian ring.
Let $I \subset A$ be an ideal.
Let $f : X \to \Spec(A)$ be a proper morphism.
Let $\mathcal{F}$ be a coherent sheaf on $X$.
Then for every $p \geq 0$ there exists an integer $c \geq 0$
such that
\begin{enumerate}
\item the multiplication map
$I^{n - c} \otimes H^p(X, I^c\mathcal{F}) \to H^p(X, I^n\mathcal{F})$
is surjective for all $n \geq c$, and
\item the image of $H^p(X, I^{n + m}\mathcal{F}) \to H^p(X, I^n\mathcal{F})$
is contained in the submodule $I^{m - c} H^p(X, I^n\mathcal{F})$
for all $n \geq 0$, $m \geq c$.
\end{enumerate}
\end{lemma}

\begin{proof}
By Lemma \ref{lemma-cohomology-powers-ideal-times-F}
we can find $d_1, \ldots, d_t \geq 0$, and
$x_i \in H^p(X, I^{d_i}\mathcal{F})$ such that
$\bigoplus_{n \geq 0} H^p(X, I^n\mathcal{F})$ is generated
by $x_1, \ldots, x_t$ over $S = \bigoplus_{n \geq 0} I^n$.
Take $c = \max\{d_i\}$. It is clear that (1) holds.
For (2) let $b = \max(0, n - c)$.
Consider the commutative diagram of $A$-modules
$$
\xymatrix{
I^{n + m - c - b} \otimes I^b \otimes
H^p(X, I^c\mathcal{F}) \ar[r] \ar[d] &
I^{n + m - c} \otimes H^p(X, I^c\mathcal{F}) \ar[r] &
H^p(X, I^{n + m}\mathcal{F}) \ar[d] \\
I^{n + m - c - b} \otimes H^p(X, I^n\mathcal{F}) \ar[rr] & &
H^p(X, I^n\mathcal{F})
}
$$
By part (1) of the lemma the composition of the horizontal arrows
is surjective if $n + m \geq c$. On the other hand, it is clear
that $n + m - c - b \geq m - c$. Hence part (2).
\end{proof}

\noindent
In the situation of Lemmas \ref{lemma-cohomology-powers-ideal-times-F} and
\ref{lemma-cohomology-powers-ideal-application} consider the inverse
system
$$
\mathcal{F}/I\mathcal{F} \leftarrow
\mathcal{F}/I^2\mathcal{F} \leftarrow
\mathcal{F}/I^3\mathcal{F} \leftarrow \ldots
$$
We would like to know what happens to the cohomology groups.
Here is a first result.

\begin{lemma}
\label{lemma-ML-cohomology-powers-ideal}
Let $A$ be a Noetherian ring.
Let $I \subset A$ be an ideal.
Let $f : X \to \Spec(A)$ be a proper morphism.
Let $\mathcal{F}$ be a coherent sheaf on $X$.
Fix $p \geq 0$.
\begin{enumerate}
\item There exists a $c_1 \geq 0$ such that for all $n \geq c_1$
we have
$$
\text{Ker}(
H^p(X, \mathcal{F}) \to H^p(X, \mathcal{F}/I^n\mathcal{F})
)
\subset
I^{n - c_1}H^p(X, \mathcal{F}).
$$
\item The inverse system
$$
\left(H^p(X, \mathcal{F}/I^n\mathcal{F})\right)_{n \in \mathbf{N}}
$$
satisfies the Mittag-Leffler condition (see
Homology, Definition \ref{homology-definition-Mittag-Leffler}).
\item In fact for any $p$ and $n$ there exists a $c_2(n) \geq n$
such that
$$
\text{Im}(H^p(X, \mathcal{F}/I^k\mathcal{F})
\to H^p(X, \mathcal{F}/I^n\mathcal{F}))
=
\text{Im}(H^p(X, \mathcal{F})
\to H^p(X, \mathcal{F}/I^n\mathcal{F}))
$$
for all $k \geq c_2(n)$.
\end{enumerate}
\end{lemma}

\begin{proof}
Let $c_1 = \max\{c_p, c_{p + 1}\}$, where $c_p, c_{p +1}$ are the integers
found in Lemma \ref{lemma-cohomology-powers-ideal-application} for
$H^p$ and $H^{p + 1}$. We will use this constant in the proofs of
(1), (2) and (3).

\medskip\noindent
Let us prove part (1). Consider the short exact sequence
$$
0 \to I^n\mathcal{F} \to \mathcal{F} \to \mathcal{F}/I^n\mathcal{F} \to 0
$$
From the long exact cohomology sequence we see that
$$
\text{Ker}(
H^p(X, \mathcal{F}) \to H^p(X, \mathcal{F}/I^n\mathcal{F})
)
=
\text{Im}(
H^p(X, I^n\mathcal{F}) \to H^p(X, \mathcal{F})
)
$$
Hence by our choice of $c_1$ we see that this is contained in
$I^{n - c_1}H^p(X, \mathcal{F})$ for $n \geq c_1$.

\medskip\noindent
Note that part (3) implies part (2) by definition of the Mittag-Leffler
condition.

\medskip\noindent
Let us prove part (3).
Fix an $n$ throughout the rest of the proof.
Consider the commutative diagram
$$
\xymatrix{
0 \ar[r] &
I^n\mathcal{F} \ar[r] &
\mathcal{F} \ar[r] &
\mathcal{F}/I^n\mathcal{F} \ar[r] &
0 \\
0 \ar[r] &
I^{n + m}\mathcal{F} \ar[r] \ar[u] &
\mathcal{F} \ar[r] \ar[u] &
\mathcal{F}/I^{n + m}\mathcal{F} \ar[r] \ar[u] &
0
}
$$
This gives rise to the following commutative diagram
$$
\xymatrix{
H^p(X, I^n\mathcal{F}) \ar[r] &
H^p(X, \mathcal{F}) \ar[r] &
H^p(X, \mathcal{F}/I^n\mathcal{F}) \ar[r]_\delta &
H^{p + 1}(X, I^n\mathcal{F}) \\
H^p(X, I^{n + m}\mathcal{F}) \ar[r] \ar[u] &
H^p(X, \mathcal{F}) \ar[r] \ar[u]^1 &
H^p(X, \mathcal{F}/I^{n + m}\mathcal{F}) \ar[r] \ar[u] &
H^{p + 1}(X, I^{n + m}\mathcal{F}) \ar[u]^a
}
$$
If $m \geq c_1$ we see that the image of $a$ is
contained in $I^{m - c_1} H^{p + 1}(X, I^n\mathcal{F})$.
By the Artin-Rees lemma (see Algebra, Lemma \ref{algebra-lemma-map-AR})
there exists an integer $c_3(n)$ such that
$$
I^N H^{p + 1}(X, I^n\mathcal{F}) \cap \text{Im}(\delta)
\subset
\delta\left(I^{N - c_3(n)}H^p(X, \mathcal{F}/I^n\mathcal{F})\right)
$$
for all $N \geq c_3(n)$. As $H^p(X, \mathcal{F}/I^n\mathcal{F})$
is annihilated by $I^n$, we see that if $m \geq c_3(n) + c_1 + n$,
then
$$
\text{Im}(H^p(X, \mathcal{F}/I^{n + m}\mathcal{F})
\to H^p(X, \mathcal{F}/I^n\mathcal{F}))
=
\text{Im}(H^p(X, \mathcal{F})
\to H^p(X, \mathcal{F}/I^n\mathcal{F}))
$$
In other words, part (3) holds with $c_2(n) = c_3(n) + c_1 + n$.
\end{proof}

\begin{theorem}
\label{theorem-formal-functions}
(Theorem on formal functions)
Let $A$ be a Noetherian ring.
Let $I \subset A$ be an ideal.
Let $f : X \to \Spec(A)$ be a proper morphism.
Let $\mathcal{F}$ be a coherent sheaf on $X$.
Fix $p \geq 0$.
The system of maps
$$
H^p(X, \mathcal{F})/I^nH^p(X, \mathcal{F})
\longrightarrow
H^p(X, \mathcal{F}/I^n\mathcal{F})
$$
define an isomorphism of limits
$$
H^p(X, \mathcal{F})^\wedge
\longrightarrow
\lim_n H^p(X, \mathcal{F}/I^n\mathcal{F})
$$
where the left hand side is the completion of the $A$-module
$H^p(X, \mathcal{F})$ with respect to the ideal $I$, see
Algebra, Section \ref{algebra-section-completion}.
Moreover, this is in fact a homeomorphism for the limit topologies.
\end{theorem}

\begin{proof}
In fact, this follows immediately from
Lemma \ref{lemma-ML-cohomology-powers-ideal}. We spell out the details.
Set $M = H^p(X, \mathcal{F})$ and $M_n = H^p(X, \mathcal{F}/I^n\mathcal{F})$.
Denote $N_n = \text{Im}(M \to M_n)$.
By the description of the limit in Homology, Section
\ref{homology-section-inverse-systems} we have
$$
\lim_n M_n
=
\{(x_n) \in \prod M_n \mid \varphi_i(x_n) = x_{n - 1},\ n = 2, 3, \ldots\}
$$
Pick an element $x = (x_n) \in \lim_n M_n$.
By Lemma \ref{lemma-ML-cohomology-powers-ideal} part (3)
we have $x_n \in N_n$ for all $n$ since by
definition $x_n$ is the image of some $x_{n + m} \in M_{n + m}$ for
all $m$. By Lemma \ref{lemma-ML-cohomology-powers-ideal} part (1)
we see that there exists a factorization
$$
M \to N_n \to M/I^{n - c_1}M
$$
of the reduction map. Denote $y_n \in M/I^{n - c_1}M$ the image of $x_n$
for $n \geq c_1$. Since for $n' \geq n$ the composition
$M \to M_{n'} \to M_n$ is the given map $M \to M_n$ we see that
$y_{n'}$ maps to $y_n$ under the canonical map
$M/I^{n' - c_1}M \to M/I^{n - c_1}M$. Hence $y = (y_{n + c_1})$
defines an element of $\lim_n M/I^nM$.
We omit the verification that $y$ maps to $x$ under the
map
$$
M^\wedge = \lim_n M/I^nM \longrightarrow \lim_n M_n
$$
of the lemma. We also omit the verification on topologies.
\end{proof}

\begin{lemma}
\label{lemma-formal-functions-stalk}
Given a morphism of schemes $f : X \to Y$, a quasi-coherent sheaf
$\mathcal{F}$ on $X$, and a quasi-coherent sheaf of ideals
$\mathcal{I} \subset \mathcal{O}_Y$. Assume
\begin{enumerate}
\item $Y$ locally Noetherian,
\item $f$ proper, and
\item $\mathcal{F}$ coherent.
\end{enumerate}
Let $y \in Y$ be a point. Consider the infinitesimal neighbourhoods
$$
\xymatrix{
X_n =
\Spec(\mathcal{O}_{Y, y}/\mathfrak m_y^n) \times_Y X
\ar[r]_-{i_n} \ar[d]_{f_n} &
X \ar[d]^f \\
\Spec(\mathcal{O}_{Y, y}/\mathfrak m_y^n) \ar[r]^-{c_n} & Y
}
$$
of the fibre $X_1 = X_y$ and set $\mathcal{F}_n = i_n^*\mathcal{F}$.
Then we have
$$
\left(R^pf_*\mathcal{F}\right)_y^\wedge
\cong
\lim_n H^p(X_n, \mathcal{F}_n)
$$
as $\mathcal{O}_{Y, y}^\wedge$-modules.
\end{lemma}

\begin{proof}
This is just a reformulation of a special case of the theorem
on formal functions, Theorem \ref{theorem-formal-functions}.
Let us spell it out. Note that $\mathcal{O}_{Y, y}$ is a Noetherian
local ring. Consider the canonical morphism
$c : \Spec(\mathcal{O}_{Y, y}) \to Y$, see
Schemes, Equation (\ref{schemes-equation-canonical-morphism}).
This is a flat morphism as it identifies local rings.
Denote momentarily $f' : X' \to \Spec(\mathcal{O}_{Y, y})$
the base change of $f$ to this local ring. We see that
$c^*R^pf_*\mathcal{F} = R^pf'_*\mathcal{F}'$ by
Lemma \ref{lemma-flat-base-change-cohomology}.
Moreover, the infinitesimal neighbourhoods of
the fibre $X_y$ and $X'_y$ are identified (verification omitted; hint:
the morphisms $c_n$ factor through $c$).

\medskip\noindent
Hence we may assume that $Y = \Spec(A)$ is the spectrum of
a Noetherian local ring $A$ with maximal ideal $\mathfrak m$
and that $y \in Y$ corresponds to the closed point (i.e., to $\mathfrak m$).
In particular it follows that
$$
\left(R^pf_*\mathcal{F}\right)_y =
\Gamma(Y, R^pf_*\mathcal{F}) =
H^p(X, \mathcal{F}).
$$

\medskip\noindent
In this case also, the morphisms $c_n$ are each closed immersions.
Hence their base changes $i_n$ are closed immersions as well.
Note that $i_{n, *}\mathcal{F}_n = i_{n, *}i_n^*\mathcal{F}
= \mathcal{F}/\mathfrak m^n\mathcal{F}$. By the Leray spectral sequence
for $i_n$, and Lemma \ref{lemma-finite-pushforward-coherent} we see that
$$
H^p(X_n, \mathcal{F}_n) =
H^p(X, i_{n, *}\mathcal{F}) =
H^p(X, \mathcal{F}/\mathfrak m^n\mathcal{F})
$$
Hence we may indeed apply the theorem on formal functions to compute
the limit in the statement of the lemma and we win.
\end{proof}

\noindent
Here is a lemma which we will generalize later to fibres of
dimension $ > 0$, namely the next lemma.

\begin{lemma}
\label{lemma-higher-direct-images-zero-finite-fibre}
Let $f : X \to Y$ be a morphism of schemes.
Let $y \in Y$.
Assume
\begin{enumerate}
\item $Y$ locally Noetherian,
\item $f$ is proper, and
\item $f^{-1}(\{y\})$ is finite.
\end{enumerate}
Then for any coherent sheaf $\mathcal{F}$ on $X$ we have
$(R^pf_*\mathcal{F})_y = 0$ for all $p > 0$.
\end{lemma}

\begin{proof}
The fibre $X_y$ is finite, and by
Morphisms, Lemma \ref{morphisms-lemma-finite-fibre} it
is a finite discrete space. Moreover, the underlying topological
space of each infinitesimal neighourhood $X_n$ is the same.
Hence each of the schemes $X_n$ is affine according to
Schemes, Lemma \ref{schemes-lemma-scheme-finite-discrete-affine}.
Hence it follows that $H^p(X_n, \mathcal{F}_n) = 0$ for all
$p > 0$. Hence we see that $(R^pf_*\mathcal{F})_y^\wedge = 0$
by Lemma \ref{lemma-formal-functions-stalk}.
Note that $R^pf_*\mathcal{F}$ is coherent by
Lemma \ref{lemma-proper-pushforward-coherent} and
hence $R^pf_*\mathcal{F}_y$ is a finite
$\mathcal{O}_{Y, y}$-module.
By Algebra, Lemma \ref{algebra-lemma-completion-tensor}
this implies that $(R^pf_*\mathcal{F})_y = 0$.
\end{proof}

\begin{lemma}
\label{lemma-higher-direct-images-zero-above-dimension-fibre}
Let $f : X \to Y$ be a morphism of schemes.
Let $y \in Y$.
Assume
\begin{enumerate}
\item $Y$ locally Noetherian,
\item $f$ is proper, and
\item $\dim(X_y) = d$.
\end{enumerate}
Then for any coherent sheaf $\mathcal{F}$ on $X$ we have
$(R^pf_*\mathcal{F})_y = 0$ for all $p > d$.
\end{lemma}

\begin{proof}
The fibre $X_y$ is of finite type over $\Spec(\kappa(y))$.
Hence $X_y$ is a Noetherian scheme by
Morphisms, Lemma \ref{morphisms-lemma-finite-type-noetherian}.
Hence the underlying topological space of $X_y$ is Noetherian, see
Properties, Lemma \ref{properties-lemma-Noetherian-topology}.
Moreover, the underlying topological space of each infinitesimal
neighourhood $X_n$ is the same as that of $X_y$.
Hence $H^p(X_n, \mathcal{F}_n) = 0$ for all $p > d$ by
Cohomology, Lemma \ref{cohomology-lemma-vanishing-Noetherian}.
Hence we see that $(R^pf_*\mathcal{F})_y^\wedge = 0$
by Lemma \ref{lemma-formal-functions-stalk} for $p > d$.
Note that $R^pf_*\mathcal{F}$ is coherent by
Lemma \ref{lemma-proper-pushforward-coherent} and
hence $R^pf_*\mathcal{F}_y$ is a finite
$\mathcal{O}_{Y, y}$-module.
By Algebra, Lemma \ref{algebra-lemma-completion-tensor}
this implies that $(R^pf_*\mathcal{F})_y = 0$.
\end{proof}








\section{Applications of the theorem on formal functions}
\label{section-applications-formal-functions}


\noindent
We will add more here as needed. For the moment we need the
following characterization of finite morphisms (in the Noetherian
case -- for a more general version see the chapter More on Morphisms,
Section \ref{more-morphisms-section-application-etale-neighbourhoods}).

\begin{lemma}
\label{lemma-characterize-finite}
(For a more general version see
More on Morphisms, Lemma \ref{more-morphisms-lemma-characterize-finite}).
Let $f : X \to S$ be a morphism of schemes.
Assume $S$ is locally Noetherian.
The following are equivalent
\begin{enumerate}
\item $f$ is finite, and
\item $f$ is proper with finite fibres.
\end{enumerate}
\end{lemma}

\begin{proof}
A finite morphism is proper according to
Morphisms, Lemma \ref{morphisms-lemma-finite-proper}.
A finite morphism is quasi-finite according to
Morphisms, Lemma \ref{morphisms-lemma-finite-quasi-finite}.
A quasi-finite morphism has finite fibres, see
Morphisms, Lemma \ref{morphisms-lemma-quasi-finite}.
Hence a finite morphism is proper and has finite fibres.

\medskip\noindent
Assume $f$ is proper with finite fibres.
We want to show $f$ is finite.
In fact it suffices to prove $f$ is affine.
Namely, if $f$ is affine, then it follows that
$f$ is integral by
Morphisms, Lemma \ref{morphisms-lemma-integral-universally-closed}
whereupon it follows from
Morphisms, Lemma \ref{morphisms-lemma-finite-integral}
that $f$ is finite.

\medskip\noindent
To show that $f$ is affine we may assume that $S$ is affine, and our
goal is to show that $X$ is affine too.
Since $f$ is proper we see that $X$ is separated and quasi-compact.
Hence we may use the criterion of
Lemma \ref{lemma-quasi-separated-h1-zero-covering} to prove that $X$
is affine. To see this let $\mathcal{I} \subset \mathcal{O}_X$
be a finite type ideal sheaf. In particular $\mathcal{I}$ is
a coherent sheaf on $X$. By
Lemma \ref{lemma-higher-direct-images-zero-finite-fibre} we conclude that
$R^1f_*\mathcal{I}_s = 0$ for all $s \in S$.
In other words, $R^1f_*\mathcal{I} = 0$. Hence we see from
the Leray Spectral Sequence for $f$ that
$H^1(X , \mathcal{I}) = H^1(S, f_*\mathcal{I})$.
Since $S$ is affine, and $f_*\mathcal{I}$ is quasi-coherent
(Schemes, Lemma \ref{schemes-lemma-push-forward-quasi-coherent})
we conclude $H^1(S, f_*\mathcal{I}) = 0$
from Lemma \ref{lemma-quasi-coherent-affine-cohomology-zero}
as desired. Hence $H^1(X, \mathcal{I}) = 0$ as desired.
\end{proof}

\noindent
As a consequence we have the following useful result.

\begin{lemma}
\label{lemma-proper-finite-fibre-finite-in-neighbourhood}
(For a more general version see
More on Morphisms,
Lemma \ref{more-morphisms-lemma-proper-finite-fibre-finite-in-neighbourhood}).
Let $f : X \to S$ be a morphism of schemes.
Let $s \in S$.
Assume
\begin{enumerate}
\item $S$ is locally Noetherian,
\item $f$ is proper, and
\item $f^{-1}(\{s\})$ is a finite set.
\end{enumerate}
Then there exists an open neighbourhood $V \subset S$ of $s$
such that $f|_{f^{-1}(V)} : f^{-1}(V) \to V$ is finite.
\end{lemma}

\begin{proof}
The morphism $f$ is quasi-finite at all the points of $f^{-1}(\{s\})$
by Morphisms, Lemma \ref{morphisms-lemma-finite-fibre}.
By Morphisms, Lemma \ref{morphisms-lemma-quasi-finite-points-open} the
set of points at which $f$ is quasi-finite is an open $U \subset X$.
Let $Z = X \setminus U$. Then $s \not \in f(Z)$. Since $f$ is proper
the set $f(Z) \subset S$ is closed. Choose any open neighbourhood
$V \subset S$ of $s$ with $Z \cap V = \emptyset$. Then
$f^{-1}(V) \to V$ is locally quasi-finite and proper.
Hence it is quasi-finite
(Morphisms, Lemma \ref{morphisms-lemma-quasi-finite-locally-quasi-compact}),
hence has finite fibres
(Morphisms, Lemma \ref{morphisms-lemma-quasi-finite}), hence
is finite by Lemma \ref{lemma-characterize-finite}.
\end{proof}















\input{chapters}

\bibliography{my}
\bibliographystyle{amsalpha}

\end{document}
