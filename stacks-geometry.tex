\input{preamble}

% OK, start here.
%
\begin{document}

\title{The Geometry of Algebraic Stacks}


\maketitle

\phantomsection
\label{section-phantom}

\tableofcontents

\section{Introduction}
\label{section-introduction}

\noindent
This chapter discusses a few geometric properties of algebraic stacks.
The initial versions of Sections \ref{section-multiplicities} and
\ref{section-dimension-of-algebraic-stacks}
were written by Matthew Emerton and Toby Gee.






\section{Multiplicities of components of algebraic stacks}
\label{section-multiplicities}

\noindent
If $X$ is a locally Noetherian scheme, then we may write $X$ (thought
of simply as a topological space) as a union
of irreducible components, say $X = \cup T_i.$  Each irreducible
component is the closure of a unique generic point $\xi_i$,
and the local ring $\mathcal O_{X,\xi_i}$ is a local Artin ring.
We may define the {\it multiplicity} $\mu_{T_i}(X)$ of $X$ along $T_i$
to be $\ell(\mathcal O_{X,\xi_i})$.

\medskip\noindent
Our goal here is to generalise this definition to locally
Noetherian algebraic stacks. If $\mathcal{X}$ is such a stack,
then it has an underlying topological space $|\mathcal{X}|$
(see Properties of Stacks, Definition
\ref{stacks-properties-definition-topological-space}),
which is locally Noetherian
(by Topology, Lemma \ref{topology-lemma-image-Noetherian})
components; we refer to these as the irreducible components of $\mathcal{X}$.
If $\mathcal{X}$ is quasi-separated, then $|\mathcal{X}|$ is sober
(insert future reference here), but it need not be in the
non-quasi-separated case. Consider for example the non-quasi-separated
algebraic space $X = \mathbf{A}^1_{/\mathbf{C}}/\mathbf{Z}$.
Furthermore, there is no structure sheaf
on $|\mathcal{X}|$ whose stalks can be used to define multiplicities.

\medskip\noindent
In order to define the multiplicity of a component of $|\mathcal{X}|$,
we use the fact that if $U \to \mathcal{X}$ is a smooth surjection
from a scheme $U$ to $\mathcal{X}$ (such a surjection exists,
since $\mathcal{X}$ is an algebraic stack), it induces a surjection
$|U| \to |\mathcal{X}|$ by
Properties of Stacks, Lemma
\ref{stacks-properties-lemma-characterize-surjective}
(here $|U|$ simply denotes the topological
space underlying $U$), and for each irreducible component
$T$ of $|\mathcal{X}|$ there is an irreducible component $T'$ of
$|U|$ such that $T'$ maps into $T$ with dense image.
(See Lemma \ref{lemma-map-of-components} below for a proof.)

\begin{definition}
\label{definition-multiplicity}
The {\it multiplicity} of $T$ in $\mathcal{X}$ is
$\mu_T(\mathcal{X}) = \mu_{T'}(U)$.
\end{definition}

\noindent
Of course, we must check that this is independent
of the choice of chart $U$, and of the choice
of irreducible component $T'$ mapping to $T$.
We begin by making this verification, as well as
proving Lemma \ref{lemma-map-of-components}.

\begin{lemma}
\label{lemma-map-of-components}
If $U \to \mathcal{X}$ is a smooth morphism from a scheme
onto a locally Noetherian algebraic stack $\mathcal{X}$, then the closure of
the image of any irreducible
component of $|U|$ is an irreducible component of $|\mathcal{X}|$.
If this morphism is furthermore surjective,
then all irreducible components of $|\mathcal{X}|$ are obtained in this way.
\end{lemma}

\begin{proof}
This is easily verified, using the fact that $|U| \to |\mathcal{X}|$ is
continuous and open by
Properties of Stacks, Lemma
\ref{stacks-properties-lemma-topology-points},
and furthermore surjective if $U \to \mathcal{X}$ is,
once one recalls that the irreducible components of a locally
Noetherian topological space can be
characterised as being the closures of irreducible open subsets of the space.
\end{proof}

\noindent
The preceding lemma applies in particular in the case of smooth morphisms
between locally Noetherian schemes.    This particular case is
implicitly invoked in the statement of the following lemma.

\begin{lemma}
\label{lemma-multiplicities}
If $U \to X$ is a smooth morphism of locally Noetherian schemes,
and if $T'$ is an irreducible component of $U$, with $T$ denoting
the irreducible component of $X$ obtained as the closure of the
image of $T'$, then $\mu_{T'}(U) = \mu_{T}(X).$
\end{lemma}

\begin{proof}
Write $\xi'$ for the generic point of $T'$, and $\xi$ for the
generic point of $T$, so that we need to show that $\ell(\mathcal
O_{X,\xi})=\ell(\mathcal O_{U,\xi'})$.

\medskip\noindent
Let $n=\ell(\mathcal{O}_{X,\xi})$, and choose a sequence
$\mathcal{O}_{X,\xi}=I_0\supset
I_1\supset\dots\supset I_n=0$ with $I_i/I_{i+1}\cong
\mathcal{O}_{X,\xi}/\mathfrak m_{X,\xi}$. The map
$\mathcal{O}_{X,\xi}\to\mathcal{O}_{U,\xi'}$ is
flat, so that we have
$$
I_i\mathcal{O}_{U,\xi'}/I_{i+1}\mathcal{O}_{U,\xi'}\cong
(I_i/I_{i+1})\otimes_{\mathcal{O}_{X,\xi}}\mathcal{O}_{U,\xi'} \cong
\mathcal{O}_{U,\xi'}/\mathfrak m_{X,\xi}\mathcal{O}_{U,\xi'},
$$
so it suffices to
show that
$\mathfrak m_{X,\xi}\mathcal{O}_{U,\xi'} = \mathfrak m_{U,\xi'}$,
or in other words that
$\mathcal{O}_{U,\xi'}/\mathfrak m_{X,\xi}\mathcal{O}_{U,\xi'}$ is reduced.

\medskip\noindent
Since the map $U\to X$ is smooth,
so is its base-change $U_{\xi} \to \Spec \kappa(\xi).$   As $U_{\xi}$ is a
smooth scheme over a field, it is reduced, and thus so its local ring
at any point.  In particular,
$\mathcal{O}_{U,\xi'}/\mathfrak m_{X,\xi}\mathcal{O}_{U,\xi'}$,
which is naturally identified with the local ring of $U_{\xi}$ at $\xi'$,
is reduced, as required.
\end{proof}

\noindent
Using this result, we may show that notion of multiplicity
given in
Definition \ref{definition-multiplicity} is in fact well-defined.

\begin{lemma}
\label{lemma-multiplicity}
If $U_1 \to \mathcal{X}$ and $U_2 \to \mathcal{X}$
are two smooth surjections from
schemes to the locally Noetherian algebraic stack $\mathcal{X}$,
and $T_1'$ and $T_2'$ are irreducible components of $|U_1|$
and $|U_2|$ respectively, the closures of whose images
are both equal to the same irreducible component $T$ of $|\mathcal{X}|$,
then $\mu_{T_1'}(U_1) = \mu_{T_2'}(U_2)$.
\end{lemma}

\begin{proof}
Let $V_1$ and $V_2$ be dense subsets of $T_1'$ and $T'_2$, respectively,
that are open in $U_1$ and $U_2$ respectively.
The images of $|V_1|$ and $|V_2|$ in $|\mathcal{X}|$ are non-empty open
subsets of the irreducible subset $T$, and therefore have non-empty
intersection.
By Properties of Stacks, Lemma \ref{stacks-properties-lemma-points-cartesian},
the map $|V_1\times_\mathcal{X} V_2|\to
|V_1|\times_{|\mathcal{X}|}|V_2|$ is surjective,
and consequently $V_1\times_{\mathcal{X}} V_2$ is a non-empty algebraic
space; we may therefore choose an \'etale surjection
$V \to V_1\times_{\mathcal{X}} V_2$ whose source is a (non-empty) scheme.
If we let $T'$ be any irreducible component of $V$,
then Lemma \ref{lemma-map-of-components} shows that the closure of
the image of $T'$ in $U_1$ (respectively $U_2$) is equal to $T'_1$
(respectively $T'_2$).

\medskip\noindent
Applying
Lemma \ref{lemma-multiplicities} twice we find
that
$$
\mu_{T_1'}(U_1)=\mu_{T'}(V)=\mu_{T_2'}(U_2),
$$
as required.
\end{proof}

\noindent
It will be convenient to have a comparison between the notion of multiplicity
of an irreducible component given by Definition \ref{definition-multiplicity}
and the related notion of multiplicities of irreducible
components of (the spectra of) versal rings of $\mathcal{X}$ at finite type
points.
In order to have a robust theory of versal rings at finite type points,
we assume for the remainder of this note that $\mathcal{X}$ is locally
of finite presentation
over a locally Noetherian scheme $S$, all of whose local rings
at finite type points are $G$-rings.  (This hypothesis on the local rings
may not be necessary for all the assertions that follow, but it makes the
arguments straightforward, and in any case seems to be necessary
for the actual comparison of multiplicities.)

\medskip\noindent
We begin by recalling the following standard consequence of Artin approximation.

\begin{lemma}
\label{lemma-Artin-approximation-by-smooth-morphism}
Let $\mathcal{X}$ be an algebraic stack locally of finite presentation
over a locally Noetherian scheme $S$,
all of whose local rings at finite type points are $G$-rings,
and let $x: \Spec k \to \mathcal{X}$ be a morphism whose source is the spectrum
of a field of finite type over $\mathcal{O}_S$.
If $A_x$ is a versal ring to $\mathcal{X}$ at $x$, then we may find a smooth
morphism $U\to\mathcal{X}$ whose source is a scheme, containing a point
$u \in U$ of residue field $k$,
such that the induced morphism $u = \Spec k  \to U \to \mathcal{X}$
coincides with the given morphism $x$,
and such that there is an isomorphism $\widehat{\mathcal{O}}_{U,u} \cong
A_x$ compatible with the versal morphism $\text{Spf} A_x \to \mathcal{X}$
and the induced morphism
$\text{Spf} \widehat{\mathcal{O}}_{U,u} \to U \to \mathcal{X}$.
\end{lemma}

\begin{proof}
Since $\mathcal{X}$ is an algebraic stack,
the versal morphism $\text{Spf} A_x \to \mathcal{X}$ is effective,
i.e., can be promoted to a morphism $\Spec A_x \to \mathcal{X}$
Artin's Axioms, Lemma \ref{artin-lemma-effective}.
By assumption $\mathcal{X}$ is locally of finite presentation over $S$,
and hence limit preserving
Limits of Stacks, Proposition
\ref{stacks-limits-proposition-characterize-locally-finite-presentation}
and so Artin approximation
(see Artin's Axioms, Lemma \ref{artin-lemma-approximate-versal}
and its proof)
shows that we may find a morphism $U \to \mathcal{X}$ with source a finite type
$S$-scheme, containing a point $u \in U$ of residue field $k$,
satisfying all of the required properties except possibly the
smoothness of $U\to\mathcal{X}$.

\medskip\noindent
Since $\mathcal{X}$ is an algebraic stack, we see that if we replace
$U$ by a sufficient small neighbourhood of $u$, we may in addition
assume that $U \to \mathcal{X}$ is smooth
(Artin's Axioms, Lemma \ref{artin-lemma-versal-implies-smooth}), as required.
\end{proof}

\begin{lemma}
\label{lemma-branches}
Let $\mathcal{X}$ be an algebraic stack locally of finite presentation
over a locally Noetherian scheme $S$,
all of whose local rings at finite type points are $G$-rings,
and let $x: \Spec k \to \mathcal{X}$ be a morphism whose source is the spectrum
of a field of finite type over $\mathcal{O}_S$.
If $A_x$ and $A'_x$ are two versal rings to $\mathcal{X}$ at $x$,
then the multi-sets of irreducible components of $\Spec A_x$
and of $\Spec A'_x$
(in which each component is counted with its multiplicity),
are in canonical bijection.

\medskip\noindent
Furthermore, there is a natural surjection from the
set of irreducible components of each of $\Spec A_x$ and $\Spec A'_x$
to the set of irreducible components of $|\mathcal{X}|$ containing the
class of $x$ in $|\mathcal{X}|$; this surjection sends components
that correspond by the above bijection to the same component
of $|\mathcal{X}|$; and this surjection preserves multiplicities.
\end{lemma}

\begin{proof}
By Lemma \ref{lemma-Artin-approximation-by-smooth-morphism} we can find
smooth morphisms $U,U' \to \mathcal{X}$ whose sources are schemes, and  points
$u,u'$ of $U,U'$ respectively, both with
residue field $k$, such that the induced morphisms $\widehat{\mathcal{O}}_{U,u}
\to U \to \mathcal{X}$ and $\widehat{\mathcal{O}}_{U',u'}
\to U' \to \mathcal{X}$ can be identified respectively with the versal
morphisms $\text{Spf} A_x\to\mathcal{X}$ and $\text{Spf} A'_x \to \mathcal{X}$.
We then form the fibre product $U'' = U \times_{\mathcal{X}} U'$; this is an
algebraic space over $S$, and the two monomorphisms $u = \Spec k \to U$
and $u' = \Spec k \to U'$ induce a monomorphism $u'' = \Spec k \to U''.$
We consider the complete local ring $\widehat{\mathcal{O}}_{U'',u}$
of $U''$ at $u''$.

\medskip\noindent
Since $U'' \to U$ is smooth, we see that the induced morphism
$A_x = \widehat{\mathcal{O}}_{U,u} \to \widehat{\mathcal{O}}_{U'',u''}$ induces
a  smooth morphism of representable functors,
in the sense of
Formal Deformation Theory, Definition
\ref{formal-defos-definition-smooth-morphism}
and hence, by
Formal Deformation Theory, Lemma
\ref{formal-defos-lemma-smooth-morphism-power-series}
we see that $\widehat{\mathcal{O}}_{U'',u''}$ is a formal power series
ring over $A_x$.  Similarly, it is a formal power series
ring over $A'_x$.  Recall that if
$A$ is a complete local ring and $B$ is a formal
power series ring in finitely many variables over $A$,
then the irreducible components of $\Spec B$ are in a natural multiplicity
preserving bijection with the irreducible components of $\Spec A$.
Thus, we obtain multiplicity preserving bijections
between the multi-sets of irreducible components of each
of $\Spec A_x$ and $\Spec A'_x$ with the multi-set
of irreducible components of $\Spec \widehat{\mathcal{O}}_{U'',u''}$,
and hence between these two multi-sets themselves.

\medskip\noindent
The morphism $\Spec A_x \to \mathcal{X}$ factors through $U$,
and the scheme-theoretic image of each irreducible component
of $\Spec A_x$ is an irreducible component of $U$ (as follows
from the facts that $\Spec A_x \to U$ is flat,
and that flat morphisms satisfy the going-down theorem).
Composing with the natural map
from the set of irreducible components of $U$ to the set
of irreducible components of $\mathcal{X}$,
we obtain a morphism from the set of irreducible components of $\Spec A_x$
to the set of irreducible components of $|\mathcal{X}|$.
A consideration of the commutative diagram
$$
\xymatrix{|\Spec \mathcal{O}_{U'',u''}| \ar[r]\ar[d] & |U''| \ar[d] \\
|\Spec A_x| \ar[r] & |\mathcal{X}| }
$$
and of the analogous diagram with $A'_x$ in place of $A_x$,
shows that this map, and the corresponding map for $A'_x$,
are compatible with the bijection constructed
above between the irreducible components of $\Spec A_x$ and
the irreducible components of $\Spec A'_x$.

\medskip\noindent
It remains to show that this map, from the irreducible components
of $\Spec A_x$ to those of $\mathcal{X}$, is multiplicity preserving.
A consideration of the definition of the multiplicity of an irreducible
component of $\mathcal{X}$, and of the preceding constructions,
shows that it suffices to show that the map from the set of
irreducible components of $\Spec \widehat{\mathcal{O}}_{U'',u''}$ to
the set of irreducible components of $U''$, given by taking Zariski closures,
is multiplicity preserving.  As we will see, this follows from the assumption
that the local rings of $S$ at finite type points are $G$-rings.

\medskip\noindent
More precisely, noting that it suffices to compare these multiplicities
after making an \'etale base-change, we may replace $U''$
by a scheme which covers it via an \'etale map, and hence assume
that $U''$ itself is a scheme, so that the local ring
$\mathcal{O}_{U'',u''}$ is defined. (Alternatively, we could apply
Artin approximation to the versal morphism
$\text{Spf} \widehat{\mathcal{O}}_{U'',u''} \to U''$, so as to replace $U''$
by a scheme.)
The scheme $U''$ is of finite type over $S$,
and hence the local ring $\mathcal{O}_{U'',u''}$ is a $G$-ring.
Let $\mathfrak p$ be a minimal prime ideal of $\mathcal{O}_{U'',u''}$,
corresponding to an irreducible component of $U''$ passing
through $u''$, and let $\mathfrak q$ be a minimal prime
of $\widehat{\mathcal{O}}_{U'',u''}$ lying over $\mathfrak p$
(corresponding to an irreducible component of
$\Spec \widehat{\mathcal{O}}_{U'',u''}$
whose closure in $U''$ is the irreducible component corresponding to
$\mathfrak p$);
we have to show that the length
of $(\widehat{\mathcal{O}}_{U'',u''})_{\mathfrak q}$ is equal to the length of
$(\mathcal{O}_{U'',u''})_{\mathfrak p}$.
Since $\mathfrak q$ lies over $\mathfrak p,$
there is a natural isomorphism
$$
(\widehat{\mathcal{O}}_{U'',u''})_{\mathfrak q}
\cong
\bigl(\widehat{\mathcal{O}}_{U'',u''} \otimes
(\mathcal{O}_{U'',u''})_{\mathfrak p}\bigr)_{\mathfrak q}.
$$
Now if $\ell$ is the length of
$(\mathcal{O}_{U'',u''})_{\mathfrak p},$
then we may find a filtration of length $\ell$ on
$(\mathcal{O}_{U'',u''})_{\mathfrak p}$, each of whose graded
pieces is isomorphic to $\kappa(\mathfrak p)$.
This induces a corresponding filtration on
$\bigl(\widehat{\mathcal{O}}_{U'',u''} \otimes
(\mathcal{O}_{U'',u''})_{\mathfrak p}\bigr)_{\mathfrak q},$
each of whose graded pieces is isomorphic to
$\bigl(\widehat{\mathcal{O}}_{U'',u''} \otimes
\kappa(\mathfrak p)\bigr)_{\mathfrak q}.$
Since $\mathcal{O}_{U'',u''}$ is a $G$-ring,
the formal fibre
$\widehat{\mathcal{O}}_{U'',u''} \otimes
\kappa(\mathfrak p)$ is regular.
Since $\mathfrak q$ is a minimal prime in this ring,
the localization
$\bigl(\widehat{\mathcal{O}}_{U'',u''} \otimes
\kappa(\mathfrak p)\bigr)_{\mathfrak q}$
is thus a field, and hence equal to $\kappa(\mathfrak q)$.
We conclude that $(\widehat{\mathcal{O}}_{U'',u''})_{\mathfrak q}$
has length $\ell$, as required.
\end{proof}

\begin{definition}
\label{definition-formal-branches}
If $\mathcal{X}$ is an algebraic stack locally of finite presentation
over a locally Noetherian scheme $S$ all of whose local rings are $G$-rings,
if $x: \Spec k \to \mathcal{X}$ is a morphism whose source is the spectrum
of a field of finite type over $\mathcal{O}_S$,
and if $A_x$ is a versal ring to $\mathcal{X}$ at $x$,
then we define the set of
{\it formal branches of $\mathcal{X}$ through $x$} to be
the set of irreducible components of $\Spec A_x$,
and we define the multiplicity of a branch to be the multiplicity
of the corresponding component in $\Spec A_x$.
\end{definition}

\noindent
Lemma \ref{lemma-branches} shows, in the context of the preceding
definition, that the set of formal branches of $\mathcal{X}$ through $x$,
and their multiplicities, are well-defined independently of
the choice of versal ring used to compute them.  It also
shows that there is a natural map from the set
of formal branches of $\mathcal{X}$ through $x$ to the set of irreducible
components of $|\mathcal{X}|$ containing the class of $x$,
and that this map preserves multiplicities.

\medskip\noindent
As a closing remark, we note that it is sometimes convenient to think
of an irreducible component of $\mathcal{X}$ as a closed substack.
To this end, if $\mathcal{T}$ is an irreducible component of
$\mathcal{X}$, i.e., an irreducible component of $|\mathcal{X}|$,
then we endow $\mathcal{T}$ with its induced reduced substack structure, see
Properties of Stacks, Definition
\ref{stacks-properties-definition-reduced-induced-stack}.













\section{Dimension theory of algebraic stacks}
\label{section-dimension-of-algebraic-stacks}

\noindent
The main results on the dimension theory of algebraic stacks in the
literature that we are aware of are those of \cite{Osserman}, which
makes a study of the notions of codimension and relative dimension. We
make a more detailed examination of the notion of the dimension of an
algebraic stack at a point, and prove various results
relating the dimension of the fibres of a morphism at a point in the source
to the dimension of its source and target.  We also prove a result
(Lemma \ref{lemma-dimension-formula} below) which
allow us (under suitable hypotheses) to compute the dimension of
an algebraic stack at a point in terms of a versal ring.

\medskip\noindent
While we haven't always tried to optimise our results, we have
largely tried to avoid making unnecessary hypotheses.  However, in some
of our results, in which we compare certain properties of an algebraic
stack to the properties of a versal ring to this
stack at a point, we have restricted our attention
to the case of algebraic stacks that are locally finitely presented
over a locally Noetherian scheme base, all of whose local rings are
$G$-rings. This gives us the convenience of having Artin approximation
available to compare the geometry of the versal ring to the geometry
of the stack itself.  However, this restrictive hypothesis
may not be necessary for the truth
of all of the various statements that we prove.
Since it is satisfied in the applications that we have in mind,
though, we have been content to make it when it helps.

\medskip\noindent
If $X$ is a scheme, then we define the dimension $\dim(X)$ of $X$
to be the Krull dimension of the
topological space underlying $X$,
while if $x$ is a point of $X$,
then we define the dimension $\dim_x (X)$ of $X$ at $x$ to be the
minimum of the dimensions of the open subsets $U$ of $X$ containing
$x$, see
Properties, Definition \ref{properties-definition-dimension}.
One has the relation $\dim(X) = \sup_{x \in X} \dim_x(X)$, see
Properties, Lemma \ref{properties-lemma-dimension}.
If $X$ is locally Noetherian, then $\dim_x(X)$ coincides with the supremum
of the dimensions at $x$
of the irreducible components of $X$ passing through $x$.

\medskip\noindent
If $X$ is an algebraic space and $x \in |X|$,
then we define $\dim_x X = \dim_u U,$ where $U$ is any scheme
admitting an \'etale surjection $U \to X$,
and $u\in U$ is any point lying over $x$, see
Properties of Spaces, Definition
\ref{spaces-properties-definition-dimension-at-point}.
We set $\dim(X) = \sup_{x \in |X|} \dim_x(X)$, see
Properties of Spaces, Definition \ref{spaces-properties-definition-dimension}.

\begin{remark}
\label{remark-dimension-algebraic-space}
In general, the dimension of the algebraic space $X$ at a point $x$
may not coincide with the dimension of the underlying topological space
$|X|$ at $x$.  E.g.\ if $k$ is a field of characteristic zero and
$X =  \mathbf{A}^1_k / \mathbf{Z}$, then $X$ has dimension $1$ (the dimension
of $\mathbf{A}^1_k$) at each of its points,
while $|X|$ has the indiscrete topology, and hence is of Krull
dimension zero. On the other hand, in
Algebraic Spaces, Example \ref{spaces-example-infinite-product}
there is given an example of an algebraic space
which is of dimension $0$ at each of its points, while $|X|$ is
irreducible of Krull dimension $1$, and admits a generic point (so that the
dimension of $|X|$ at any of its points is $1$); see also the discussion
of this example in
Properties of Spaces, Section \ref{spaces-properties-section-dimension}.

\medskip\noindent
On the other hand, if $X$ is a {\it decent} algebraic space, in the sense of
Decent Spaces, Definition \ref{decent-spaces-definition-very-reasonable}
(in particular, if $X$ is quasi-separated; see
Decent Spaces, Section \ref{decent-spaces-section-reasonable-decent})
then in fact the dimension of $X$ at $x$ does coincide with the dimension
of $|X|$ at $x$; see
Decent Spaces, Lemma \ref{decent-spaces-lemma-dimension-decent-space}.
\end{remark}

\noindent
In order to  define the dimension of an algebraic stack,
it will be useful to first have the notion of the relative dimension,
at a point in the source,
of a morphism whose source is an algebraic space,
and whose target is an algebraic stack.  The definition is slightly
involved, just because (unlike in the case of schemes) the points of an
algebraic stack, or an algebraic
space, are not describable as morphisms from the spectrum of a field,
but only as equivalence classes of such.

\begin{definition}
\label{definition-relative-dimension}
If $f : T \to \mathcal{X}$ is a locally of finite type morphism from an
algebraic space to an algebraic stack,
and if $t \in |T|$ is a point with image $x \in | \mathcal{X}|$, then we define
{\it the relative dimension} of $f$ at $t$, denoted
$\dim_t(T_x),$
as follows:
choose a morphism $\Spec k \to \mathcal{X}$, with source the spectrum of
a field, which represents $x$, and choose a point
$t' \in |T \times_{\mathcal{X}} \Spec k|$
mapping to $t$ under the projection to $|T|$
(such a point $t'$ exists, by
Properties of Stacks, Lemma \ref{stacks-properties-lemma-points-cartesian});
then
$$
\dim_t(T_x) = \dim_{t'}(T \times_{\mathcal{X}} \Spec k ).
$$
\end{definition}

\noindent
Note that since $T$ is an algebraic space and $\mathcal{X}$ is an
algebraic stack, the fibre product $T \times_{\mathcal{X}} \Spec k$
is an algebraic space, and so the quantity on the right hand side of
this proposed definition is in fact defined (see discussion above).

\begin{remark}
\label{remark-relative-dimension}
(1)
One easily verifies (for example, by using the invariance
of the relative dimension of locally of finite type morphisms of schemes
under base-change; see for example
Morphisms, Lemma \ref{morphisms-lemma-dimension-fibre-after-base-change}
that $\dim_t(T_x)$ is well-defined, independently of the choices
used to compute it.

\medskip\noindent
(2)
In the case that $\mathcal{X}$ is also an algebraic space,
it is straightforward to confirm that this definition agrees with
the definition of relative dimension given in
Morphisms of Spaces, Definition
\ref{spaces-morphisms-definition-dimension-fibre}.
\end{remark}

\noindent
We next recall the following lemma, on which the definition of
the dimension of a locally Noetherian algebraic stack is founded.

\begin{lemma}
\label{lemma-behaviour-of-dimensions-wrt-smooth-morphisms}
If $f: U \to X$ is a smooth morphism of locally Noetherian algebraic
spaces, and
if $u \in |U|$ with image $x \in |X|$, then
$$
\dim_u (U) = \dim_x(X) + \dim_{u} (U_x)
$$
where $\dim_u (U_x)$ is defined via
Definition \ref{definition-relative-dimension}.
\end{lemma}

\begin{proof}
See Morphisms of Spaces, Lemma
\ref{spaces-morphisms-lemma-smoothness-dimension-spaces}
noting that the definition of $\dim_u (U_x)$ used here coincides with
the definition used there, by Remark \ref{remark-relative-dimension} (2).
\end{proof}

\begin{definition}
\label{definition-dimension-for-stacks}
If $\mathcal{X}$ is a locally Noetherian algebraic stack,
and $x \in |\mathcal{X}|$, then we define the
{\it dimension of $\mathcal{X}$ at $x$} as follows:
let $U \to \mathcal{X}$ be a smooth morphism
from a scheme (or, more generally, from an algebraic space) to $\mathcal{X}$
containing $x$ in its image,
let $u$ be any point of $|U|$ mapping to $x$,
and define
$$
\dim_x(\mathcal{X}) =  \dim_u (U) - \dim_{u}( U_x)
$$
(where the relative dimension $\dim_u(U_x)$ is defined
by Definition \ref{definition-relative-dimension}).
\end{definition}

\begin{remark}
\label{remark-computing-dims}
The preceding definition is justified by the formula of
Lemma \ref{lemma-behaviour-of-dimensions-wrt-smooth-morphisms},
and one can use that lemma to verify that $\dim_x(\mathcal{X})$ is well-defined,
independently of the choices used to compute it.
Alternatively (employing the notation of the definition, and choosing
$U$ to be a scheme),
one can compute $\dim_u(U_x)$ by choosing
the representative of $x$ to  be the composite
$\Spec \kappa(u) \to U \to \mathcal{X}$, where the first morphism is the
canonical
one with image $u \in U$.
Then, if we write $R = U\times_{\mathcal{X}} U$, and let $e: U \to R$ denote
the
diagonal morphism, the invariance of relative dimension under base-change
shows that $\dim_u \bigl(U_x) = \dim_{e(u)}(R_u),$
and thus the preceding definition of $\dim_x (\mathcal{X})$ coincides
with the definition as $\dim_u (U) - \dim_{e(u)}(R_u)$ given in
Properties of Stacks, Definition
\ref{stacks-properties-definition-dimension-at-point}.
which is shown to be independent of choices in
Properties of Stacks, Lemma
\ref{stacks-properties-lemma-dimension-at-point-well-defined}.
\end{remark}

\begin{remark}
\label{remark-dimension-DM}
For Deligne--Mumford stacks which are suitably decent
(e.g.\ quasi-separated),
it will again be the case that $\dim_x(\mathcal{X})$ coincides with the
topologically
defined quantity $\dim_x |\mathcal{X}|$.  However, for more general Artin
stacks,
this will typically not be the case.  For example, if
$\mathcal{X} = [\mathbf{A}^1/\mathbf{G}_m]$
(over some field, with the quotient being taken with
respect to the usual multiplication action of $\mathbf{G}_m$ on $\mathbf{A}^1$),
then  $|\mathcal{X}|$ has two points, one the specialisation of the other
(corresponding
to the two orbits of $\mathbf{G}_m$ on $\mathbf{A}^1$), and hence is of
dimension $1$ as
a topological space; but $\dim_x (\mathcal{X}) = 0$ for both points
$x \in |\mathcal{X}|$.
(An even more extreme example is given by the classifying space
$[\Spec k/\mathbf{G}_m]$, whose dimension at its unique point
is equal to $-1$.)
\end{remark}

\noindent
We can now extend Definition \ref{definition-relative-dimension}
to the context of (locally finite type)
morphisms between (locally Noetherian) algebraic stacks.

\begin{definition}
\label{definition-relative-dimension-for-stacks}
If $f : \mathcal{T} \to \mathcal{X}$
is a locally of finite type morphism between
locally Noetherian algebraic stacks, and if
$t \in |\mathcal{T}|$ is a point with image $x \in |\mathcal{X}|$, then
we define the {\it relative dimension} of $f$ at $t$, denoted
$\dim_t(\mathcal{T}_x),$ as follows:
choose a morphism $\Spec k \to \mathcal{X}$, with source the spectrum of
a field, which represents $x$, and choose a point
$t' \in |\mathcal{T} \times_{\mathcal{X}} \Spec k|$
mapping to $t$ under the projection to $|\mathcal{T}|$
(such a point $t'$ exists, by
Properties of Stacks, Lemma
\ref{stacks-properties-lemma-points-cartesian}; then
$$
\dim_t(\mathcal{T}_x) = \dim_{t'}(\mathcal{T} \times_{\mathcal{X}} \Spec k ).
$$
\end{definition}

\noindent
Note that since $\mathcal{T}$ is an algebraic stack and $\mathcal{X}$ is an
algebraic stack,
the fibre product $\mathcal{T}\times_{\mathcal{X}} \Spec k$
is an algebraic stack, which is locally Noetherian by
Morphisms of Stacks, Lemma
\ref{stacks-morphisms-lemma-locally-finite-type-locally-noetherian}.
Thus the quantity on the right side of this proposed definition
is defined by Definition \ref{definition-dimension-for-stacks}.

\begin{remark}
\label{remark-dimension-tangent-space-well-defined}
Standard manipulations show that $\dim_t(\mathcal{T}_x)$ is well-defined,
independently of the choices made to compute it.
\end{remark}

\noindent
We now establish some basic properties of relative dimension, which
are obvious generalisations of the corresponding statements in the
case of morphisms of schemes.

\begin{lemma}
\label{lemma-base-change-invariance-of-relative-dimension}
Suppose given
a Cartesian square of morphisms of locally Noetherian stacks
$$
\xymatrix{
\mathcal{T}' \ar[d]\ar[r] & \mathcal{T} \ar[d] \\
\mathcal{X}' \ar[r] & \mathcal{X}
}
$$
in which the vertical morphisms are locally of finite type.
If $t' \in |\mathcal{T}'|$,
with images $t$, $x'$, and $x$ in $|\mathcal{T}|$, $|\mathcal{X}'|$, and
$|\mathcal{X}|$
respectively, then $\dim_{t'}(\mathcal{T}'_{x'}) = \dim_{t}(\mathcal{T}_x).$
\end{lemma}

\begin{proof}
Both sides can (by definition) be computed as the
dimension of the same fibre product.
\end{proof}

\begin{lemma}
\label{lemma-behaviour-of-dimensions-wrt-smooth-morphisms-stacky}
If $f: \mathcal{U} \to \mathcal{X}$ is a smooth morphism of locally Noetherian
algebraic stacks, and
if $u \in |\mathcal{U}|$ with image $x \in |\mathcal{X}|$,
then
$$
\dim_u (\mathcal{U}) = \dim_x(\mathcal{X}) + \dim_{u} (\mathcal{U}_x).
$$
\end{lemma}

\begin{proof}
Choose a smooth surjective morphism $V \to \mathcal{U}$ whose source
is a scheme, and let $v\in |V|$ be a point mapping to $u$.
Then the composite $V \to \mathcal{U} \to \mathcal{X}$ is also smooth,
and by definition we have $\dim_x(\mathcal{X}) = \dim_v(V) - \dim_v(V_x),$
while $\dim_u(\mathcal{U}) = \dim_v(V) - \dim_v(V_u).$
Thus
$$
\dim_u(\mathcal{U}) - \dim_x(\mathcal{X}) = \dim_v (V_x) - \dim_v (V_u).
$$

\medskip\noindent
Choose a representative $\Spec k \to \mathcal{X}$ of $x$
and choose a point $v' \in | V \times_{\mathcal{X}} \Spec k|$ lying over
$v$, with image $u'$ in $|\mathcal{U}\times_{\mathcal{X}} \Spec k|$;
then by definition
$\dim_u(\mathcal{U}_x) = \dim_{u'}(\mathcal{U}\times_{\mathcal{X}} \Spec k),$
and
$\dim_v(V_x) = \dim_{v'}(V\times_{\mathcal{X}} \Spec k).$

\medskip\noindent
Now $V\times_{\mathcal{X}} \Spec k \to \mathcal{U}\times_{\mathcal{X}}\Spec k$
is a smooth surjective morphism (being the base-change
of such a morphism) whose source is an algebraic space
(since $V$ and $\Spec k$ are schemes, and $\mathcal{X}$
is an algebraic stack).  Thus, again by definition,
we have
\begin{align*}
\dim_{u'}(\mathcal{U}\times_{\mathcal{X}} \Spec k)
& =
\dim_{v'}(V\times_{\mathcal{X}} \Spec k) -
\dim_{v'}\bigl( (V\times_{\mathcal{X}} \Spec k)_{u'}) \\
& = \dim_v(V_x) -
\dim_{v'}\bigl( (V\times_{\mathcal{X}} \Spec k)_{u'}).
\end{align*}
Now $V\times_{\mathcal{X}} \Spec k \cong
V\times_{\mathcal{U}} (\mathcal{U}\times_{\mathcal{X}} \Spec k),$
and so
Lemma \ref{lemma-base-change-invariance-of-relative-dimension}
shows that
$\dim_{v'}\bigl( (V\times_{\mathcal{X}} \Spec k)_{u'})  = \dim_v(V_u).$
Putting everything together, we find that
$$
\dim_u(\mathcal{U}) - \dim_x(\mathcal{X}) =
\dim_u(\mathcal{U}_x),
$$
as required.
\end{proof}

\begin{lemma}
\label{lemma-relative-dimension-is-semi-continuous}
Let $f: \mathcal{T} \to \mathcal{X}$ be a locally of finite type morphism of
algebraic stacks.
\begin{enumerate}
\item
The function $t \mapsto \dim_t(\mathcal{T}_{f(t)})$ is upper semi-continuous
on $|\mathcal{T}|$.
\item If $f$ is smooth, then
the function $t \mapsto \dim_t(\mathcal{T}_{f(t)})$ is locally constant
on $|\mathcal{T}|$.
\end{enumerate}
\end{lemma}

\begin{proof}
Suppose to begin with that $\mathcal{T}$ is a scheme $T$,
let $U \to \mathcal{X}$ be a smooth surjective morphism whose source
is a scheme, and let $T' = T \times_{\mathcal{X}} U$.
Let $f': T' \to U$ be the pull-back of $f$ over $U$,
and let $g: T' \to T$ be the projection.

\medskip\noindent
Lemma \ref{lemma-base-change-invariance-of-relative-dimension}
shows that $\dim_{t'}(T'_{f'(t')}) = \dim_{g(t')}(T_{f(g(t'))}),$
for $t' \in T'$, while,
since $g$ is smooth and surjective (being the base-change
of a smooth surjective morphism) the map induced by $g$ on underlying
topological spaces is continuous and open
(by
Properties of Spaces, Lemma \ref{spaces-properties-lemma-topology-points}), and
surjective. Thus it suffices to note that part (1) for the morphism $f'$
follows from
Morphisms of Spaces, Lemma
\ref{spaces-morphisms-lemma-openness-bounded-dimension-fibres}, and part (2)
from either of Morphisms, Lemma
\ref{morphisms-lemma-flat-finite-presentation-CM-fibres-relative-dimension}
or
Morphisms, Lemma \ref{morphisms-lemma-smooth-omega-finite-locally-free}
(each of which gives the result for schemes, from which
the analogous results for algebraic spaces can
be deduced exactly as in
Morphisms of Spaces, Lemma
\ref{spaces-morphisms-lemma-openness-bounded-dimension-fibres}.

\medskip\noindent
Now return to the general case,
and choose a smooth surjective morphism
$h:V \to \mathcal{T}$ whose source is a scheme.
If $v \in V$, then, essentially by definition,
we have
$$
\dim_{h(v)}(\mathcal{T}_{f(h(v))}) =
\dim_{v}(V_{f(h(v))}) - \dim_{v}(V_{h(v)}).
$$
Since $V$ is a scheme, we have proved that the first
of the terms on the right hand side of this equality
is upper semi-continuous (and even locally
constant if $f$ is smooth), while the second term is
in fact locally constant.
Thus their difference is upper semi-continuous
(and locally constant if $f$ is smooth),
and hence the function
$\dim_{h(v)}(\mathcal{T}_{f(h(v))})$
is upper semi-continuous on $|V|$ (and locally
constant if $f$ is smooth).
Since the morphism $|V| \to |\mathcal{T}|$ is open and surjective,
the lemma follows.
\end{proof}

\noindent
Before continuing with our development,
we prove two lemmas related to the dimension theory of schemes.

\medskip\noindent
To put the first lemma in context,
we note that if $X$ is a finite-dimensional scheme, then since $\dim X$
is defined to equal the supremum of the dimensions $\dim_x X$,
there exists a point $x \in X$ such that $\dim_x X = \dim X$.
The following lemma shows that we may furthermore take the point
$x$ to be of finite type.

\begin{lemma}
\label{lemma-dimension-achieved-by-finite-type-point}
If $X$ is a finite-dimensional scheme,
then there exists a closed (and hence finite type) point $x \in X$
such that $\dim_x X = \dim X$.
\end{lemma}

\begin{proof}
Let $d = \dim X$,
and choose a maximal strictly decreasing
chain of irreducible closed subsets of $X$,
say
\begin{equation}
\label{equation-maximal-chain}
Z_0 \supset Z_1 \supset \cdots \supset Z_d.
\end{equation}
The subset $Z_d$ is a minimal irreducible closed subset of $X$,
and thus any point of $Z_d$ is a generic point of $Z_d$.
Since the underlying topological space of the scheme $X$ is sober,
we conclude that $Z_d$ is a singleton, consisting of a single
closed point $x \in X$.
If $U$ is
any neighbourhood of $x$, then
the chain
$$
U\cap Z_0 \supset U\cap Z_1 \supset \cdots \supset U\cap Z_d = Z_d =
\{x\}
$$
is then a strictly descending chain of irreducible
closed subsets of $U$, showing that $\dim U \geq d$.
Thus we find that $\dim_x X \geq d$.  The other inequality
being obvious, the lemma is proved.
\end{proof}

\noindent
The next lemma shows that $\dim_x X$ is a {\it constant} function
on an irreducible scheme satisfying some mild additional hypotheses.

\begin{lemma}
\label{lemma-constancy-of-dimension}
If $X$ is an irreducible, Jacobson, catenary, and locally Noetherian
scheme of finite dimension,
then $\dim U = \dim X$ for every
non-empty open subset $U$ of $X$.
Equivalently, $\dim_x X$ is a constant function on $X$.
\end{lemma}

\begin{proof}
The equivalence of the two claims follows directly from the
definitions.   Suppose, then, that $U\subset X$ is a non-empty open
subset.
Certainly $\dim U \leq \dim X$, and we have to show
that $\dim U \geq \dim X.$
Write $d = \dim X$, and choose a maximal strictly
decreasing chain of irreducible closed subsets
of $X$, say
$$
X = Z_0 \supset Z_1 \supset \dots \supset Z_d.
$$
Since $X$ is Jacobson, the minimal irreducible closed
subset $Z_d$ is equal to $\{x\}$ for some closed
point $x$.

\medskip\noindent
If $x \in U,$ then
$$
U = U \cap Z_0  \supset U\cap Z_1 \supset \dots \supset
U\cap Z_d = \{x\}
$$
is a strictly decreasing chain of irreducible closed
subsets of $U$, and so we conclude that $\dim U \geq d$,
as required.  Thus we may suppose that $x \not\in U.$

\medskip\noindent
Consider the flat morphism $\Spec \mathcal{O}_{X,x} \to X$.
The non-empty (and hence dense) open subset $U$ of $X$
pulls back to an open subset $V \subset \Spec \mathcal{O}_{X,x}$.
Replacing $U$ by a non-empty quasi-compact, and hence
Noetherian, open subset, we may assume that the inclusion
$U \to X$ is a quasi-compact morphism.  Since the
formation of scheme-theoretic images of quasi-compact
morphisms commutes with flat base-change
Morphisms, Lemma
\ref{morphisms-lemma-flat-base-change-scheme-theoretic-image}
we see that $V$ is dense in $\Spec \mathcal{O}_{X,x}$,
and so in particular non-empty,
and of course $x \not\in V.$  (Here we use $x$ also to denote
the closed point of $\Spec \mathcal{O}_{X,x}$, since its image
is equal to the given point $x \in X$.)
Now $\Spec \mathcal{O}_{X,x} \setminus \{x\}$ is Jacobson
Properties, Lemma
\ref{properties-lemma-complement-closed-point-Jacobson}
and hence $V$ contains a closed point $z$
of $\Spec \mathcal{O}_{X,x} \setminus \{x\}$.  The closure
in $X$ of the image of $z$ is then an irreducible
closed subset $Z$ of $X$ containing $x$, whose intersection
with $U$ is non-empty, and
for which there is no irreducible closed
subset properly contained in $Z$
and properly containing $\{x\}$
(because pull-back to $\Spec \mathcal{O}_{X,x}$ induces
a bijection between irreducible closed subsets of $X$
containing $x$ and irreducible closed subsets of $\Spec
\mathcal{O}_{X,x}$).
Since $U \cap Z$ is a non-empty closed subset of $U$,
it contains a point $u$ that is closed in $X$ (since
$X$ is Jacobson), and since $U\cap Z$
is a non-empty (and hence dense) open subset of the irreducible set $Z$
(which contains a point not lying in $U$, namely $x$),
the inclusion $\{u\} \subset U\cap Z$ is proper.

\medskip\noindent
As $X$ is catenary, the chain
$$
X = Z_0 \supseteq Z \supset \{x\} = Z_d
$$
can be refined to a chain of length $d+1$, which must then
be of the form
$$
X = Z_0 \supset W_1 \supset \cdots \supset W_{d-1} = Z \supset \{x\} = Z_d.
$$
Since $U\cap Z$ is non-empty, we then find that
$$
U = U \cap Z_0 \supset U \cap W_1\supset \dots \supset U\cap W_{d-1}
= U\cap Z \supset \{u\}
$$
is a strictly decreasing chain of irreducible closed subsets
of $U$ of length $d+1$, showing that $\dim U \geq d$,
as required.
\end{proof}

\noindent
We will prove a stack-theoretic analogue
of Lemma \ref{lemma-constancy-of-dimension}
in Lemma \ref{lemma-irreducible-implies-equidimensional} below,
but before doing so, we have to introduce an additional definition,
necessitated by the fact that the notion of a scheme being catenary
is not an \'etale local one
(see the example of
Algebra, Remark \ref{algebra-remark-universally-catenary-does-not-descend}
which makes it difficult to define what it means for an algebraic
space or algebraic stack to be catenary
(see the discussion of \cite[page 3]{Osserman}).
For certain aspects of dimension theory, the following
definition seems to provide a good substitute for the missing
notion of a catenary algebraic stack.

\begin{definition}
\label{definition-pseudo-catenary}
We say that a locally Noetherian algebraic stack $\mathcal{X}$
is {\it pseudo-catenary} if there exists a smooth
and surjective morphism $U \to \mathcal{X}$ whose source is
a universally catenary scheme.
\end{definition}

\begin{example}
\label{example-pseudo-catenary}
If $\mathcal{X}$ is locally of finite type over a universally
catenary locally Noetherian scheme $S$,
and $U\to \mathcal{X}$ is a smooth surjective morphism
whose source is a scheme, then the composite
$U \to \mathcal{X} \to S$ is locally of finite type,
and so $U$ is universally catenary
Morphisms, Lemma
\ref{morphisms-lemma-universally-catenary-local}.
Thus $\mathcal{X}$ is pseudo-catenary.
\end{example}

\noindent
The following lemma shows that the property of being pseudo-catenary
passes through finite-type morphisms.

\begin{lemma}
\label{lemma-catenary-covers}
If $\mathcal{X}$ is a pseudo-catenary locally Noetherian algebraic
stack, and if $\mathcal{Y} \to \mathcal{X}$ is a locally of finite type
morphism,
then there exists a smooth surjective morphism $V \to \mathcal{Y}$
whose source is a universally catenary scheme; thus
$\mathcal{Y}$ is again pseudo-catenary.
\end{lemma}

\begin{proof}
By assumption we may find a smooth surjective morphism
$U \to \mathcal{X}$ whose source is a universally catenary scheme.
The base-change $U\times_{\mathcal{X}} \mathcal{Y}$ is then an algebraic
stack; let $V \to U\times_{\mathcal{X}} \mathcal{Y}$ be a smooth
surjective morphism whose source is a scheme.
The composite $V \to U\times_{\mathcal{X}} \mathcal{Y} \to \mathcal{Y}$ is then
smooth and surjective (being a composite of smooth and
surjective morphisms), while the morphism $V \to U\times_{\mathcal{X}}
\mathcal{Y} \to U$ is locally of finite type (being a composite
of morphisms that are locally finite type).  Since $U$
is universally catenary, we see that $V$ is universally catenary
(by Morphisms, Lemma
\ref{morphisms-lemma-universally-catenary-local}),
as claimed.
\end{proof}

\noindent
We now study the behaviour of the function $\dim_x(\mathcal{X})$ on
$|\mathcal{X}|$
(for some locally Noetherian stack $\mathcal{X}$) with respect to the
irreducible
components of $|\mathcal{X}|$, as well as various
related topics.

\begin{lemma}
\label{lemma-irreducible-implies-equidimensional}
If $\mathcal{X}$ is
a Jacobson, pseudo-catenary, and locally Noetherian  algebraic stack
for which $|\mathcal{X}|$ is irreducible,
then $\dim_x(\mathcal{X})$ is a constant function on $|\mathcal{X}|$.
\end{lemma}

\begin{proof}
It suffices to show that $\dim_x(\mathcal{X})$ is locally constant on
$|\mathcal{X}|$,
since it will then necessarily be constant (as $|\mathcal{X}|$ is connected,
being irreducible).  Since $\mathcal{X}$ is pseudo-catenary,
we may find a smooth surjective morphism $U \to \mathcal{X}$ with $U$
being a univesally catenary scheme.  If $\{U_i\}$ is an
cover of $U$ by quasi-compact open subschemes, we may replace
$U$ by $\coprod U_i,$, and
it suffices to show that
the function $u \mapsto \dim_{f(u)}(\mathcal{X})$ is locally constant on $U_i$.
Since we check this for one $U_i$ at a time, we now drop the subscript,
and write simply $U$ rather than $U_i$.
Since $U$ is quasi-compact, it
is the union of a finite number of irreducible components,
say $T_1 \cup \cdots \cup T_n$.  Note that each $T_i$ is Jacobson,
catenary, and locally Noetherian,
being a closed subscheme of the Jacobson, catenary, and locally Noetherian
scheme $U$.

\medskip\noindent
By definition, we have
$\dim_{f(u)}(\mathcal{X}) = \dim_{u}(U) - \dim_{u}(U_{f(u)}).$
Lemma \ref{lemma-relative-dimension-is-semi-continuous} (2)
shows that the second term in the right hand expression is locally
constant on $U$, as $f$ is smooth,
and hence we must show that $\dim_u(U)$
is locally constant on $U$.  Since $\dim_u(U)$ is the maximum
of the dimensions $\dim_u T_i$, as $T_i$ ranges over the components
of $U$ containing $u$, it suffices to show
that if a point $u$ lies on two distinct components,
say $T_i$ and $T_j$ (with $i \neq j$),
then $\dim_u T_i = \dim_u T_j$,
and then to note that $t\mapsto \dim_t T$ is a constant
function on an irreducible Jacobson,
catenary, and locally Noetherian scheme $T$
(as follows from Lemma \ref{lemma-constancy-of-dimension}).

\medskip\noindent
Let $V = T_i \setminus \bigl( \bigcup_{i' \neq i} T_{i'}\bigr)$
and $W = T_j \setminus \bigl( \bigcup_{i' \neq j} T_{i'}\bigr)$.
Then each of $V$ and $W$ is a non-empty open subset of $U$,
and so each has non-empty open image in $|\mathcal{X}|$.  As $|\mathcal{X}|$ is
irreducible,
these two non-empty open subsets of $|\mathcal{X}|$ have a non-empty
intersection.
Let $x$ be a point lying in this intersection, and let $v \in V$ and
$w\in W$ be points mapping to $x$.
We then find that
$$
\dim T_i = \dim V = \dim_v (U) = \dim_x (\mathcal{X}) + \dim_v (U_x)
$$
and similarly that
$$
\dim T_j = \dim W = \dim_w (U) = \dim_x (\mathcal{X}) + \dim_w (U_x).
$$
Since $u \mapsto \dim_u (U_{f(u)})$ is locally constant on $U$,
and since $T_i \cup T_j$ is connected (being the union of two irreducible,
hence connected, sets that have non-empty intersection),
we see that $\dim_v (U_x) = \dim_w(U_x)$,
and hence, comparing the preceding two equations,
that $\dim T_i = \dim T_j$, as required.
\end{proof}

\begin{lemma}
\label{lemma-closed-immersions}
If $\mathcal{Z} \hookrightarrow \mathcal{X}$ is a closed immersion
of locally Noetherian schemes,
and if $z \in |\mathcal{Z}|$ has image $x \in |\mathcal{X}|$,
then $\dim_z (\mathcal{Z}) \leq \dim_x(\mathcal{X})$.
\end{lemma}

\begin{proof}
Choose a smooth surjective morphism
$U\to \mathcal{X}$ whose source is a scheme;
the base-changed morphism
$V = U\times_{\mathcal{X}} \mathcal{Z} \to \mathcal{Z}$
is then also smooth and surjective, and the projection
$V \to U$ is a closed immersion.
If $v \in |V|$ maps to $z \in |\mathcal{Z}|$, and
if we let $u$ denote the image of $v$ in $|U|$,
then clearly
$\dim_v(V) \leq \dim_u(U)$,
while
$\dim_v (V_z) = \dim_u(U_x)$,
by Lemma \ref{lemma-base-change-invariance-of-relative-dimension}.
Thus
$$
\dim_z(\mathcal{Z})  = \dim_v(V) - \dim_v(V_z)
\leq \dim_u(U) - \dim_u(U_x) = \dim_x(\mathcal{X}),
$$
as claimed.
\end{proof}

\begin{lemma}
\label{lemma-dimension-via-components}
If $\mathcal{X}$ is a locally Noetherian algebraic stack, and if
$x \in |\mathcal{X}|$,
then $\dim_x(\mathcal{X}) = \sup_{\mathcal{T}} \{ \dim_x(\mathcal{T}) \} $,
where $\mathcal{T}$ runs over all the irreducible components
of $|\mathcal{X}|$ passing through $x$ (endowed with their
induced reduced structure).
\end{lemma}

\begin{proof}
Lemma \ref{lemma-closed-immersions}
shows that
$\dim_x (\mathcal{T}) \leq \dim_x(\mathcal{X})$ for each
irreducible component $\mathcal{T}$ passing through
the point $x$.   Thus to prove the lemma,
it suffices to show that
\begin{equation}
\label{equation-desired-inequality}
\dim_x(\mathcal{X}) \leq
\sup_{\mathcal{T}} \{\dim_x(\mathcal{T})\}.
\end{equation}
Let $U\to\mathcal{X}$ be a smooth cover by a scheme. If $T$ is an irreducible
component of $U$ then we let $\mathcal{T}$ denote the closure of its image
in $\mathcal{X}$, which is an irreducible component of $\mathcal{X}$. Let
$u \in U$ be
a point mapping to $x$. Then we have
$\dim_x(\mathcal{X})=\dim_uU-\dim_uU_x=\sup_T\dim_uT-\dim_uU_x$, where the
supremum is over the irreducible components of $U$ passing
through $u$. Choose a component $T$ for which the supremum
is achieved, and note that
$\dim_x(\mathcal{T})=\dim_uT-\dim_u T_x$.
The desired inequality (\ref{equation-desired-inequality})
now follows from the evident inequality $\dim_u T_x \leq \dim_u U_x.$
(Note that if $\Spec k \to \mathcal{X}$ is a representative of $x$,
then $T\times_{\mathcal{X}} \Spec k$ is a closed subspace of
$U\times_{\mathcal{X}}
\Spec k$.)
\end{proof}

\begin{lemma}
\label{lemma-dimension-at-finite-type-point}
If $\mathcal{X}$ is a locally Noetherian algebraic stack, and if
$x \in |\mathcal{X}|$, then
for any open substack $\mathcal{V}$ of $\mathcal{X}$ containing $x$,
there is a finite type point $x_0 \in |\mathcal{V}|$ such that
$\dim_{x_0}(\mathcal{X}) = \dim_x(\mathcal{V})$.
\end{lemma}

\begin{proof}
Choose a smooth surjective
morphism  $f:U \to \mathcal{X}$ whose source is a scheme, and consider the
function $u \mapsto \dim_{f(u)}(\mathcal{X});$
since the morphism $|U| \to |\mathcal{X}|$ induced by $f$ is open (as $f$
is smooth) as well as  surjective (by assumption),
and takes finite type points to finite type points (by the very definition
of the finite type points of $|\mathcal{X}|$),
it suffices to show that for any $u \in U$, and any open neighbourhood of $u$,
there is a finite type point $u_0$ in this neighbourhood such that
$\dim_{f(u_0)}(\mathcal{X}) = \dim_{f(u)}(\mathcal{X}).$
Since, with this reformulation
of the problem,  the surjectivity of $f$ is no longer required,
we may replace $U$ by the open neighbourhood of the point $u$ in question,
and thus reduce to the problem of showing that for each $u \in U$,
there is a finite type point $u_0 \in U$ such that
$\dim_{f(u_0)}(\mathcal{X}) = \dim_{f(u)}(\mathcal{X}).$
By definition
$\dim_{f(u)}(\mathcal{X}) = \dim_u(U) - \dim_u(U_{f(u)}),$
while
$\dim_{f(u_0)}(\mathcal{X}) = \dim_{u_0}(U) - \dim_{u_0}(U_{f(u_0)}).$
Since $f$ is smooth, the expression $\dim_{u_0}(U_{f(u_0)})$ is locally
constant as $u_0$ varies over $U$ (by
Lemma \ref{lemma-relative-dimension-is-semi-continuous} (2)),
and so shrinking $U$ further around
$u$ if necessary, we may assume it is constant.  Thus the problem
becomes to show that we may find a finite type point $u_0 \in U$
for which $\dim_{u_0}(U) = \dim_u(U)$.
Since by definition $\dim_u U$ is the minimum of the dimensions
$\dim V$, as $V$ ranges over the open neighbourhoods $V$ of $u$
in $U$, we may shrink $U$ down further around $u$ so that
$\dim_u U = \dim U$.
The existence of desired point $u_0$ then follows from
Lemma \ref{lemma-dimension-achieved-by-finite-type-point}.
\end{proof}

\begin{lemma}
\label{lemma-monomorphing-a-component-in-of-the-right-dimension}
Let $\mathcal{T} \hookrightarrow \mathcal{X}$ be a locally
of finite type monomorphism of algebraic stacks,
with $\mathcal{X}$ (and thus also $\mathcal{T}$)
being Jacobson, pseudo-catenary, and locally Noetherian.
Suppose further that $\mathcal{T}$ is irreducible
of some (finite) dimension $d$, and that $\mathcal{X}$ is reduced
and of dimension less
than or equal to $d$.
Then there is a non-empty open substack $\mathcal{V}$ of $\mathcal{T}$ such
that the induced
monomorphism $\mathcal{V} \hookrightarrow \mathcal{X}$ is an open immersion
which identifies
$\mathcal{V}$ with an open subset of an irreducible component of $\mathcal{X}$.
\end{lemma}

\begin{proof}
Choose a smooth surjective morphism $f:U \to \mathcal{X}$ with source a scheme,
necessarily reduced since $\mathcal{X}$ is,
and write $U' = \mathcal{T}\times_{\mathcal{X}} U$.  The base-changed morphism
$U' \to U$ is a monomorphism of algebraic spaces, locally of finite
type, and thus representable
Morphisms of Spaces, Lemma
\ref{spaces-morphisms-lemma-locally-quasi-finite-separated-representable} and
\ref{spaces-morphisms-lemma-monomorphism-loc-finite-type-loc-quasi-finite};
since $U$ is a scheme, so is $U'$.
The projection $f': U' \to \mathcal{T}$ is again a smooth surjection.
Let $u' \in U'$, with image $u \in U$.
Lemma \ref{lemma-base-change-invariance-of-relative-dimension}
shows that $\dim_{u'}(U'_{f(u')}) = \dim_u(U_{f(u)}),$
while $\dim_{f'(u')}(\mathcal{T}) =d
\geq \dim_{f(u)}(\mathcal{X})$ by
Lemma \ref{lemma-irreducible-implies-equidimensional}
and our assumptions on $\mathcal{T}$ and $\mathcal{X}$.
Thus we see that
\begin{equation}
\label{equation-dim-inequality}
\dim_{u'} (U') = \dim_{u'} (U'_{f(u')}) + \dim_{f'(u')}(\mathcal{T})
\\
\geq \dim_u (U_{f(u)}) + \dim_{f(u)}(\mathcal{X}) = \dim_u (U).
\end{equation}
Since $U' \to U$ is a monomorphism, locally of finite type,
it is in particular unramified,
and so by the \'etale local structure of unramified morphisms
\'Etale Morphisms, Lemma \ref{etale-lemma-finite-unramified-etale-local},
we may find a commutative diagram
$$
\xymatrix{
V' \ar[r]\ar[d] & V \ar[d] \\
U' \ar[r] & U
}
$$
in which the scheme $V'$ is non-empty,
the vertical arrows are \'etale,
and the upper horizontal arrow is a closed immersion.
Replacing $V$ by a quasi-compact open subset
whose image has non-empty intersection with the image of $U'$,
and replacing $V'$ by the preimage of $V$, we may further
assume that $V$ (and thus $V'$) is quasi-compact.
Since $V$ is also locally Noetherian,
it is thus Noetherian, and so is the union of finitely many irreducible
components.

\medskip\noindent
Since \'etale morphisms preserve pointwise dimension
Descent, Lemma \ref{descent-lemma-dimension-at-point-local}
we deduce from (\ref{equation-dim-inequality})
that for any point $v' \in V'$,
with image $v \in V$, we have
$\dim_{v'}( V') \geq \dim_v(V)$.
In particular, the image of $V'$ can't be contained in the intersection
of two distinct irreducible components of $V$, and so we may find
at least one irreducible open subset of $V$ which has non-empty intersection
with $V'$; replacing $V$ by this subset, we may assume that $V$ is integral
(being both reduced and irreducible).  From the preceding inequality
on dimensions, we conclude that the closed immersion $V' \hookrightarrow V$
is in fact an isomorphism.
If we let $W$ denote the image of $V'$
in $U'$, then $W$ is a non-empty
open subset of $U'$ (as \'etale morphisms are open),
and the induced monomorphism $W \to U$ is \'etale
(since it is so \'etale locally on the source, i.e.\ after pulling back
to $V'$), and hence is an open immersion (being an \'etale monomorphism).
Thus, if we let $\mathcal{V}$ denote the image of $W$ in $\mathcal{T}$,
then $\mathcal{V}$ is a dense (equivalently, non-empty) open substack of
$\mathcal{T}$,
whose image is dense in an irreducible component of $\mathcal{X}$.
Finally,
we note that the morphism is $\mathcal{V} \to \mathcal{X}$ is smooth
(since its composite
with the smooth morphism $W\to \mathcal{V}$ is smooth),
and also a monomorphism, and thus is an open immersion.
\end{proof}

\begin{lemma}
\label{lemma-dims-of-images}
Let $f: \mathcal{T} \to \mathcal{X}$ be a locally of finite type
morphism of Jacobson, pseudo-catenary, and locally Noetherian
algebraic stacks,
whose source is irreducible and whose target is quasi-separated,
and let $\mathcal{Z} \hookrightarrow \mathcal{X}$ denote the scheme-theoretic
image of $\mathcal{T}$.
Then for every finite type point $t \in |T|$,
we have that
$\dim_t( \mathcal{T}_{f(t)}) \geq \dim \mathcal{T}  - \dim \mathcal{Z}$,
and there is a non-empty (equivalently, dense)
open subset of $|\mathcal{T}|$ over which equality holds.
\end{lemma}

\begin{proof}
Replacing $\mathcal{X}$ by $\mathcal{Z}$, we may and do assume that $f$ is
scheme theoretically dominant,
and also that $\mathcal{X}$ is irreducible.
By the upper semi-continuity of fibre dimensions
(Lemma \ref{lemma-relative-dimension-is-semi-continuous} (1)),
it suffices to prove that the equality
$\dim_t( \mathcal{T}_{f(t)}) =\dim \mathcal{T}  - \dim \mathcal{Z}$
holds for $t$ lying in
some non-empty open substack of $\mathcal{T}$.
For this reason, in the argument we are always free
to replace $\mathcal{T}$ by a non-empty open substack.

\medskip\noindent
Let $T' \to \mathcal{T}$ be a smooth surjective morphism whose source
is a scheme, and let $T$ be a non-empty quasi-compact open subset
of $T'$.  Since $\mathcal{Y}$ is quasi-separated, we find
that $T \to  \mathcal{Y}$ is quasi-compact
(by Morphisms of Stacks, Lemma
\ref{stacks-morphisms-lemma-quasi-compact-permanence}, applied to the morphisms
$T \to \mathcal{Y} \to \Spec \mathbf{Z}$).
Thus, if we replace $\mathcal{T}$ by the image of $T$ in $\mathcal{T}$,
then we may assume (appealing to
Morphisms of Stacks, Lemma
\ref{stacks-morphisms-lemma-surjection-from-quasi-compact}
that the morphism $f:\mathcal{T} \to \mathcal{X}$ is quasi-compact.

\medskip\noindent
If we choose a smooth surjection $U \to \mathcal{X}$ with $U$ a scheme,
then Lemma \ref{lemma-map-of-components} ensures that
we may find an irreducible open subset $V$ of $U$ such
that $V \to \mathcal{X}$ is smooth and scheme-theoretically dominant.
Since scheme-theoretic dominance for quasi-compact morphisms
is preserved by flat base-change,
the base-change $\mathcal{T} \times_{\mathcal{X}} V \to V$
of the scheme-theoretically
dominant morphism $f$ is again
scheme-theoretically dominant.   We let $Z$ denote a scheme
admitting a smooth surjection onto this fibre product;
then $Z \to \mathcal{T} \times_{\mathcal{X}} V \to V$
is again scheme-theoretically dominant.
Thus we may find an irreducible
component $C$ of $Z$ which scheme-theoretically
dominates $V$.
Since the composite  $Z \to \mathcal{T}\times_{\mathcal{X}} V \to \mathcal{T}$
is smooth,
and since $\mathcal{T}$ is irreducible,
Lemma \ref{lemma-map-of-components} shows that any irreducible
component of the source has dense image in $|\mathcal{T}|$.
We now replace
$C$ by a non-empty open subset $W$ which is disjoint from every other
irreducible component of $Z$, and
then replace $\mathcal{T}$ and $\mathcal{X}$ by the images of $W$
and $V$
(and apply Lemma \ref{lemma-irreducible-implies-equidimensional}
to see that this
doesn't change the dimension of either $\mathcal{T}$ or $\mathcal{X}$).
If we let $\mathcal{W}$ denote the image of the morphism
$W \to \mathcal{T}\times_{\mathcal{X}} V$,
then $\mathcal{W}$ is open in $\mathcal{T}\times_{\mathcal{X}} V$ (since the
morphism $W \to \mathcal{T}\times_{\mathcal{X}} V$ is smooth),
and is irreducible (being the image of an irreducible
scheme).  Thus we end up with a commutative diagram
$$
\xymatrix{
W \ar[dr] \ar[r]  & \mathcal{W} \ar[r] \ar[d]
& V \ar[d] \\ & \mathcal{T} \ar[r] & \mathcal{X}
}
$$
in which $W$ and $V$ are schemes,
the vertical arrows are smooth and surjective,
the diagonal arrows and the left-hand
upper horizontal arroware smooth,
and the induced morphism $\mathcal{W} \to \mathcal{T}\times_{\mathcal{X}} V$ is
an open immersion. Using this diagram, together with the definitions
of the various dimensions involved in
the statement of the lemma, we will reduce our verification
of the lemma to the case of schemes, where it is known.

\medskip\noindent
Fix $w \in |W|$ with image $w' \in |\mathcal{W}|$,
image $t \in |\mathcal{T}|$, image $v$ in $|V|$,
and image $x$ in $|\mathcal{X}|$.
Essentially by definition (using the
fact that $\mathcal{W}$ is open in $\mathcal{T}\times_{\mathcal{X}} V$, and that
the fibre of a base-change is the base-change of the fibre),
we obtain the equalities
$$
\dim_v V_x = \dim_{w'} \mathcal{W}_t
$$
and
$$
\dim_t \mathcal{T}_x = \dim_{w'} \mathcal{W}_v.
$$
Again by definition (the diagonal arrow and right-hand vertical
arrow in our diagram realise $W$ and $V$ as smooth covers by
schemes of the stacks $\mathcal{T}$ and $\mathcal{X}$), we find that
$$
\dim_t \mathcal{T} = \dim_w W - \dim_w W_t
$$
and
$$
\dim_x \mathcal{X} = \dim_v V - \dim_v V_x.
$$
Combining the equalities, we find that
$$
\dim_t \mathcal{T}_x - \dim_t \mathcal{T} + \dim_x \mathcal{X}
= \dim_{w'} \mathcal{W}_v - \dim_w W + \dim_w W_t + \dim_v V -
\dim_{w'} \mathcal{W}_t
$$
Since $W \to \mathcal{W}$ is a smooth surjection, the same is true
if we base-change over the morphism $\Spec \kappa(v) \to V$
(thinking of $W \to \mathcal{W}$ as a morphism over $V$),
and from this smooth morphism we obtain the first of the following
two equalities
$$
\dim_w W_v - \dim_{w'} \mathcal{W}_v = \dim_w (W_v)_{w'} = \dim_w W_{w'};
$$
the second equality follows via a direct comparison of the
two fibres involved.
Similarly, if we think of $W \to \mathcal{W}$ as a morphism of schemes
over $\mathcal{T}$, and base-change over some representative of the point
$t \in |\mathcal{T}|$, we obtain the equalities
$$
\dim_w W_t - \dim_{w'} \mathcal{W}_t = \dim_w (W_t)_{w'} = \dim_w W_{w'}.
$$
Putting everything together, we find that
$$
\dim_t \mathcal{T}_x - \dim_t \mathcal{T} + \dim_x \mathcal{X}
=  \dim_w W_v - \dim_w W + \dim_v V.
$$
Our goal is to show that the left-hand side of this equality
vanishes for a non-empty open subset
of $t$.  As $w$ varies over a non-empty open subset of $W$,
its image $t \in |\mathcal{T}|$ varies over a non-empty open
subset of $|\mathcal{T}|$ (as $W \to \mathcal{T}$ is smooth).

\medskip\noindent
We are therefore reduced to showing that if $W\to V$ is a
scheme-theoretically dominant morphism of irreducible locally
Noetherian schemes that is locally of finite type,
then there is a non-empty open subset of
points $w\in W$ such that $\dim_w W_v =\dim_w W - \dim_v V$
(where $v$ denotes the image of $w$ in $V$).
This is a standard fact,
whose proof we recall for the convenience of the reader.

\medskip\noindent
We may replace $W$ and $V$ by their underlying reduced subschemes
without altering the validity (or not) of this equation,
and thus we may assume that they are in fact integral schemes.
Since $\dim_w W_v$ is locally constant on $W,$ replacing $W$
by a non-empty open subset if necessary, we may assume that $\dim_w W_v$
is constant, say equal to $d$.  Choosing this open subset to be affine,
we may also assume that the morphism $W\to V$ is in fact of finite type.
Replacing $V$ by a non-empty open subset if necessary
(and then pulling back $W$ over this open subset; the resulting pull-back
is non-empty, since the flat base-change of a quasi-compact
and scheme-theoretically
dominant morphism remains scheme-theoretically dominant),
we may furthermore assume that $W$ is flat over $V$.
The morphism $W\to V$ is thus of relative dimension $d$
in the sense of
Morphisms, Definition
\ref{morphisms-definition-relative-dimension-d}
and it follows from
Morphisms, Lemma \ref{morphisms-lemma-rel-dimension-dimension}
that $\dim_w(W) = \dim_v(V) + d,$ as required.
\end{proof}

\begin{remark}
\label{remark-negative-dimension}
We note that in the context of the preceding lemma,
it need not be that $\dim \mathcal{T} \geq \dim \mathcal{Z}$; this does
not contradict the inequality in the statement of the lemma, because
the fibres of the morphism $f$ are again algebraic stacks, and
so may have negative dimension.  This is illustrated by taking
$k$ to be a field, and applying the lemma to the morphism
$[\Spec k/\mathbf{G}_m] \to \Spec k$.

\medskip\noindent
If the morphism $f$ in the statement of the lemma is assumed
to be quasi-DM (in the sense of
Morphisms of Stacks, Definition
\ref{stacks-morphisms-definition-separated}; e.g.\ morphisms that are
representable by algebraic spaces are quasi-DM),
then the fibres of the morphism over points of the target
are quasi-DM algebraic stacks, and hence are of non-negative
dimension.  In this case, the lemma implies
that indeed $\dim \mathcal{T} \geq \dim \mathcal{Z}$.  In fact, we obtain
the following more general result.
\end{remark}

\begin{lemma}
\label{lemma-dims-of-images-two}
Let $f: \mathcal{T} \to \mathcal{X}$ be a locally of finite type
morphism of Jacobson, pseudo-catenary, and locally Noetherian
algebraic stacks
which is quasi-DM,
whose source is irreducible and whose target is quasi-separated,
and let $\mathcal{Z} \hookrightarrow \mathcal{X}$ denote the scheme-theoretic
image of $\mathcal{T}$.
Then $\dim \mathcal{Z} \leq \dim \mathcal{T}$,
and furthermore, exactly one of the following two conditions holds:
\begin{enumerate}
\item for every finite type point $t \in |T|,$
we have
$\dim_t(\mathcal{T}_{f(t)}) > 0,$ in which
case $\dim \mathcal{Z} < \dim \mathcal{T}$; or
\item   $\mathcal{T}$ and $\mathcal{Z}$
are of the same dimension.
\end{enumerate}
\end{lemma}

\begin{proof}
As was observed in the preceding remark,
the dimension of a quasi-DM stack is always non-negative,
from which we conclude that $\dim_t \mathcal{T}_{f(t)} \geq 0$
for all $t \in |\mathcal{T}|$, with the equality
$$
\dim_t \mathcal{T}_{f(t)} = \dim_t \mathcal{T} - \dim_{f(t)} \mathcal{Z}
$$
holding
for a dense open subset of points $t\in |\mathcal{T}|$.
\end{proof}

\noindent
We close this section by establishing a formula allowing us to
compute $\dim_x(\mathcal{X})$ in terms of properties of the versal ring
to $\mathcal{X}$ at $x$.
For this,
we will suppose that the base-scheme $S$ (which has remained implicit
up till this point) is a locally Noetherian scheme, all of whose local rings
at finite type points are $G$-rings. (As with the discussion at the
end of Section \ref{section-multiplicities}, this assumption may not be
needed for the result to hold, but it allows for a simple argument.)

\begin{lemma}
\label{lemma-dimension-formula}
Suppose that $\mathcal{X}$ is an algebraic
stack, locally of finite presentation over a locally Noetherian
scheme $S$, all of whose local rings at finite type points
are $G$-rings.  Suppose further
that $x:\Spec k\to\mathcal{X}$ is a a morphism whose source is the spectrum
of a field of finite type over $\mathcal{O}_S$, and that
$[U/R] \cong \widehat{\mathcal{X}}_x$
is a presentation of $\widehat{\mathcal{X}}_x$
by a smooth groupoid in functors,
with $U$ and $R$ both Noetherianly pro-representable, by
$\text{Spf} A_x$ and $\text{Spf} B_x$ respectively. Then we have the following
formula:
$$
2\dim A_x-\dim B_x=\dim_x(\mathcal{X}).
$$
\end{lemma}

\begin{proof}
By Lemma \ref{lemma-Artin-approximation-by-smooth-morphism},
we may find a smooth morphism $V \to \mathcal{X}$, whose source is a scheme,
containing a point $v \in V$ of residue field $k$, such that induced
morphism $v = \Spec k \to V \to \mathcal{X}$ coincides with $x$,
and such that $\widehat{\mathcal{O}}_{V,x}$ may be identified with $A_x$.
If we write $W =  V\times_{\mathcal{X}} V,$ and we write $w = (v,v) \in W,$
then we may furthermore identify $\widehat{\mathcal{O}}_{W,w}$ with $B_x$.
Now Remark \ref{remark-computing-dims} shows that
$$
\dim_x{\mathcal{X}} = \dim_v V - \dim_{w}(W_v) = \dim_v V -
(\dim_w W - \dim_v V) = 2\dim_v V - \dim_w W.
$$
Since $v$ is a finite type point of $V$, we have that
$\dim_v V = \dim \mathcal{O}_{V,v} = \dim \widehat{\mathcal{O}_{V,v}} =
\dim A_x,$
and similarly $\dim_w W = \dim B_x$.  Thus the formula of the lemma
is proved.
\end{proof}






\input{chapters}

\bibliography{my}
\bibliographystyle{amsalpha}

\end{document}
