\input{preamble}

% OK, start here.
%
\begin{document}

\title{Resolution of Surfaces}


\maketitle

\phantomsection
\label{section-phantom}

\tableofcontents

\section{Introduction}
\label{section-introduction}

\noindent
This chapter discusses resolution of singularities of surfaces
following Lipman \cite{Lipman} and following the exposition
in \cite{Artin-Lipman}.





\section{A trace map in positive characteristic}
\label{section-trace}

\noindent
In this section $p$ will be a prime number. Let $R$ be an
$\mathbf{F}_p$-algebra. Let $M$ be an $R$-module and let $D : R \to M$ be a
derivation. Given an $a \in R$ set $A = R[x]/(x^p - a)$.
Define an $R$-linear map
$$
\text{Tr}_{x, D} : \Omega_{A/R} \longrightarrow M
$$
by the rule
$$
x^i\text{d}x \longmapsto
\left\{
\begin{matrix}
0 & \text{if} & 0 \leq i \leq p - 2, \\
D(a) & \text{if} & i = p - 1
\end{matrix}
\right.
$$
This makes sense as $\Omega_{A/R}$ is a free $R$-module with
basis $x^i\text{d}x$, $0 \leq i \leq p - 1$.
The following lemma implies that the trace map is well defined,
i.e., independent of the choice of the coordinate $x$.

\begin{lemma}
\label{lemma-trace-well-defined}
Let $\varphi : R[x]/(x^p - a) \to R[y]/(y^p - b)$ be an $R$-algebra
homomorphism. Then
$\text{Tr}_{x, D} = \text{Tr}_{y, D} \circ \varphi$.
\end{lemma}

\begin{proof}
Say $\varphi(x) = \lambda_0 + \lambda_1 y + \ldots + \lambda_{p - 1}y^{p - 1}$
with $\lambda_i \in R$. The condition that mapping $x$ to
$\lambda_0 + \lambda_1 y + \ldots + \lambda_{p - 1}y^{p - 1}$
induces an $R$-algebra homomorphism $R[x]/(x^p - a) \to R[y]/(y^p - b)$
is equivalent to the condition that
$$
a = \lambda_0^p + \lambda_1^p b + \ldots + \lambda_{p - 1}^pb^{p - 1}
$$
in the ring $R$. Consider the polynomial ring
$$
R_{univ} = \mathbf{F}_p[b, \lambda_0, \ldots, \lambda_{p - 1}]
$$
with the element
$a = \lambda_0^p + \lambda_1^p b + \ldots + \lambda_{p - 1}^pb^{p - 1}$
and
with its universal derivation given by
$$
D_{univ} = \text{d} :
R_{univ}
\longrightarrow
M_{univ} = \Omega_{R_{univ}/\mathbf{F}_p}
$$
Consider the universal algebra map
$\varphi_{univ} : R_{univ}[x]/(x^p - a) \to R_{univ}[y]/(y^p - b)$
given by mapping $x$ to
$\lambda_0 + \lambda_1 y + \ldots + \lambda_{p - 1}y^{p - 1}$.
We obtain a canonical maps
$$
R_{univ} \longrightarrow R,\quad
M_{univ} \longrightarrow M
$$
compatible with derivations by sending $b, \lambda_i$ to $b, \lambda_i$
and sending $\text{d}b, \text{d}\lambda_i$ to $D(b), D(\lambda_i)$.
By construction the maps
$$
R_{univ}[x]/(x^p - a) \to R[x]/(x^p - a),\quad
R_{univ}[y]/(y^p - b) \to R[y]/(y^p - b)
$$
are compatible with the trace maps. Hence it suffices to prove the
lemma for the map $\varphi_{univ}$. We will do this by evaluating
$\text{Tr}_{y, D}(\varphi(x)^i\text{d}\varphi(x))$ for $i = 0 , \ldots, p - 1$.

\medskip\noindent
The case $0 \leq i \leq p - 2$. Expand
$$
(\lambda_0 + \lambda_1 y + \ldots + \lambda_{p - 1}y^{p - 1})^i
(\lambda_1 + 2 \lambda_2 y + \ldots + (p - 1)\lambda_{p - 1}y^{p - 2})
$$
in the ring $R[y]/(y^p - b)$. We have to show that the coefficient
of $y^{p - 1}$ is zero. For this it suffices to show that
the expression above as a polynomial in $y$ has vanishing
coefficients in front of the powers $y^{pk - 1}$.
Then we write our polynomial as
$$
\frac{\text{d}}{(i + 1)\text{d}y}
(\lambda_0 + \lambda_1 y + \ldots + \lambda_{p - 1}y^{p - 1})^{i + 1}
$$
and indeed the coefficients of $y^{kp - 1}$ are all zero.

\medskip\noindent
The case $i = p - 1$. Expand
$$
(\lambda_0 + \lambda_1 y + \ldots + \lambda_{p - 1}y^{p - 1})^{p - 1}
(\lambda_1 + 2 \lambda_2 y + \ldots + (p - 1)\lambda_{p - 1}y^{p - 2})
$$
in the ring $R[y]/(y^p - b)$. To finish the proof we have to show that
the coefficient of $y^{p - 1}$ times $D(b)$ is $D(a)$. Here we use that
$R$ is $S/pS$ where
$S = \mathbf{Z}[b, \xi_j, \lambda_0, \ldots, \lambda_{p - 1}, \xi_{ij}]$.
Then the above, as a polynomial in $y$, is equal to
$$
\frac{\text{d}}{p\text{d}y}
(\lambda_0 + \lambda_1 y + \ldots + \lambda_{p - 1}y^{p - 1})^p
$$
Since $\frac{\text{d}}{\text{d}y}(y^{pk}) = pk y^{pk - 1}$
it suffices to understand the coefficients of $y^{pk}$ in the polynomial
$(\lambda_0 + \lambda_1 y + \ldots + \lambda_{p - 1}y^{p - 1})^p$
modulo $p$. The sum of these terms gives
$$
\lambda_0^p + \lambda_1^py^p + \ldots + \lambda_{p - 1}^py^{p(p - 1)}
\bmod p
$$
Whence we see that we obtain after applying the operator
$\frac{\text{d}}{p\text{d}y}$ and after reducing modulo $y^p - b$
the value
$$
\lambda_1^p + 2\lambda_2^pb + \ldots + (p - 1)\lambda_{p - 1}b^{p - 2}
$$
for the coefficient of $y^{p - 1}$ we wanted to compute. Now because
$a = \lambda_0^p + \lambda_1^p b + \ldots + \lambda_{p - 1}^pb^{p - 1}$
in $R$ we obtain that
$$
D(a) = (\lambda_1^p  + 2 \lambda_2^p b + \ldots +
(p - 1) \lambda_{p - 1}^p b^{p - 2}) D(b)
$$
in $R$. This proves that the coefficient of $y^{p - 1}$ is as desired.
\end{proof}

\begin{lemma}
\label{lemma-Noetherian-normal-domain-insep-extension}
Let $R$ be a Noetherian normal domain with fraction field $K$.
Let $a \in K$ be an element such that there exists a derivation
$D : R \to R$ with $D(a) \not = 0$. Then the integral closure
of $R$ in $L = K[x]/(x^p - a)$ is finite over $R$.
\end{lemma}

\begin{proof}
After replacing $x$ by $fx$ and $a$ by $f^pa$ for some $f \in R$
we may assume $a \in R$. Hence also $D(a) \in R$. We will show
by induction on $i \leq p - 1$ that if
$$
y = a_0 + a_1x + \ldots + a_i x^i,\quad a_j \in K
$$
is integral over $R$, then $D(a)^i a_j \in R$. Thus the integral
closure is contained in the finite $R$-module with basis
$D(a)^{-p + 1}x^j$, $j = 0, \ldots, p - 1$. Since $R$ is Noetherian
this proves the lemma.

\medskip\noindent
If $i = 0$, then $y = a_0$ is integral over $R$ if and only if $a_0 \in R$
and the statement is true. Suppose the statement holds for some $i < p - 1$
and suppose that
$$
y = a_0 + a_1x + \ldots + a_{i + 1} x^{i + 1},\quad a_j \in K
$$
is integral over $R$. Then
$$
y^p = a_0^p + a_1^p a + \ldots + a_{i + 1}^pa^{i + 1}
$$
is an element of $R$ (as it is in $K$ and integral over $R$). Applying
$D$ we obtain
$$
(a_1^p + 2a_2^p a + \ldots + (i + 1)a_{i + 1}^p a^i)D(a)
$$
is in $R$. Hence it follows that
$$
D(a)a_1 + 2D(a) a_2 x + \ldots + (i + 1)D(a) a_{i + 1} x^i
$$
is integral over $R$. By induction we find $D(a)^{i + 1}a_j \in R$
for $j = 1, \ldots, i + 1$. (Here we use that $1, \ldots, i + 1$
are invertible.) Hence $D(a)^{i + 1}a_0$ is also in $R$ because it
is the difference of $y$ and $\sum_{j > 0} D(a)^{i + 1}a_jx^j$ which
are integral over $R$ (since $x$ is integral over $R$ as $a \in R$).
\end{proof}


















\section{Modifications}
\label{section-modifications}

\noindent
Let $(A, \mathfrak m, \kappa)$ be a Noetherian local ring. We set
$S = \Spec(A)$ and $U = S \setminus \{\mathfrak m\}$. In this section
we will consider the category
\begin{equation}
\label{equation-modification}
\left\{
f : X \longrightarrow S
\quad \middle| \quad
\begin{matrix}
X\text{ is an algebraic space}\\
f\text{ is a proper morphism}\\
f^{-1}(U) \to U\text{ is an isomorphism}
\end{matrix}
\right\}
\end{equation}
A morphism from $X/S$ to $X'/S$ will be a morphism of algebraic spaces
$X \to X'$ compatible with the structure morphisms over $S$. In
Restricted Power Series, Section \ref{restricted-section-modifications}
we have seen that this category only depends on the completion of $A$
and we have proven some elementary properties of objects in this category.
In this section we specifically study cases where
$\dim(A) \leq 2$ or where the dimension of the closed fibre is at most $1$.

\begin{lemma}
\label{lemma-modification}
Let $(A, \mathfrak m, \kappa)$ be a $2$-dimensional Noetherian
local domain such that $U = \Spec(A) \setminus \{\mathfrak m\}$
is a normal scheme. Then any modification $f : X \to S$
(as in Spaces over Fields, Definition
\ref{spaces-over-fields-definition-modification})
is a morphism as in (\ref{equation-modification}).
\end{lemma}

\begin{proof}
Let $f : X \to S$ be a modification. We have to show that
$f^{-1}(U) \to U$ is an isomorphism. By
Spaces over Fields, Lemma
\ref{spaces-over-fields-lemma-modification-iso-over-open}
there exists a nonempty open $V \subset S$ such that $f^{-1}(V) \to V$
is an isomorphism. Since $X$ is integral we see that $f^{-1}(V)$ is
dense in $X$. Note that every closed point $u$ of $U$ has codimension
$1$, i.e., that $\dim(\mathcal{O}_{U, u}) = 1$. Thus we may apply
Spaces over Fields, Lemma \ref{spaces-over-fields-lemma-finite-in-codim-1}
to see that $f^{-1}(U) \to U$ is finite. In particular $f^{-1}(U)$ is a scheme.
Then $f^{-1}(U) \to U$ is an isomorphism, see
Morphisms, Lemma \ref{morphisms-lemma-finite-birational-over-normal}.
\end{proof}

\begin{lemma}
\label{lemma-closed-immersion-on-fibre}
Let $(A, \mathfrak m, \kappa)$ be a Noetherian local ring.
Let $g : X \to Y$ be a morphism in the category (\ref{equation-modification}).
If the induced morphism $X_\kappa \to Y_\kappa$ of special fibres is
a closed immersion, then $g$ is a closed immersion.
\end{lemma}

\begin{proof}
This is a special case of
More on Morphisms of Spaces, Lemma
\ref{spaces-more-morphisms-lemma-where-closed-immersion}.
\end{proof}

\begin{lemma}
\label{lemma-projective-over-complete}
Let $(A, \mathfrak m, \kappa)$ be a complete Noetherian local ring.
Let $X$ be an algebraic space over $\Spec(A)$.
If $X \to \Spec(A)$ is proper and $\dim(X_\kappa) \leq 1$, then
$X$ is a scheme projective over $A$.
\end{lemma}

\begin{proof}
By Spaces over Fields, Lemma
\ref{spaces-over-fields-lemma-codim-1-point-in-schematic-locus}
the algebraic space $X_\kappa$ is a scheme. Hence $X_\kappa$
is a proper scheme of dimension $\leq 1$ over $\kappa$.
By Varieties, Lemma \ref{varieties-lemma-dim-1-proper-projective}
we see that $X_\kappa$ is H-projective over $\kappa$.
Let $\mathcal{L}$ be an ample invertible sheaf on $X_\kappa$.

\medskip\noindent
We are going to show that $\mathcal{L}$ lifts to a compatible system
$\{\mathcal{L}_n\}$ of
invertible sheaves on the $n$th infinitesimal neighbourhoods
$$
X_n = X \times_{\Spec(A)} \Spec(A/\mathfrak m^n)
$$
of $X_\kappa = X_1$. Recall that the \'etale sites of $X_\kappa$
and all $X_n$ are canonically equivalent, see
More on Morphisms of Spaces, Lemma
\ref{spaces-more-morphisms-lemma-thickening-equivalence}.
In the rest of the proof we do not distinguish between sheaves on $X_n$
and sheaves on $X_m$ or $X_\kappa$.
Suppose, given a lift $\mathcal{L}_n$ to $X_n$. We consider
the exact sequence
$$
1 \to
(1 + \mathfrak m^n\mathcal{O}_X/\mathfrak m^{n + 1}\mathcal{O}_X)^* \to
\mathcal{O}_{X_{n + 1}}^* \to \mathcal{O}_{X_n}^* \to 1
$$
of sheaves on $X_{n + 1}$. We have
$(1 + \mathfrak m^n\mathcal{O}_X/\mathfrak m^{n + 1}\mathcal{O}_X)^*
\cong \mathfrak m^n\mathcal{O}_X/\mathfrak m^{n + 1}\mathcal{O}_X$
as abelian sheaves on $X_{n + 1}$. The class of $\mathcal{L}_n$ in
$H^1(X_n, \mathcal{O}_{X_n}^*)$ (see
Cohomology on Sites, Lemma \ref{sites-cohomology-lemma-h1-invertible})
can be lifted to an element of $H^1(X_{n + 1}, \mathcal{O}_{X_{n + 1}}^*)$
if and only if the obstruction in
$H^2(X_{n + 1}, \mathfrak m^n\mathcal{O}_X/\mathfrak m^{n + 1}\mathcal{O}_X)$
is zero. Note that
$\mathfrak m^n\mathcal{O}_X/\mathfrak m^{n + 1}\mathcal{O}_X$
is a quasi-coherent $\mathcal{O}_{X_\kappa}$-module on $X_\kappa$.
Hence its \'etale cohomology agrees with its cohomology on the
scheme $X_\kappa$, see
Descent, Proposition \ref{descent-proposition-same-cohomology-quasi-coherent}.
However, as $X_\kappa$ is a Noetherian scheme of dimension $\leq 1$
this cohomology group vanishes (Cohomology, Proposition
\ref{cohomology-proposition-vanishing-Noetherian}).

\medskip\noindent
By Grothendieck's algebraization theorem
(Cohomology of Schemes, Theorem \ref{coherent-theorem-algebraization})
we find a projective morphism of schemes $Y \to \Spec(A)$ and a compatible
system of isomorphisms $X_n \to Y_n$. (Here we use the assumption
that $A$ is complete.) By
More on Morphisms of Spaces, Lemma
\ref{spaces-more-morphisms-lemma-algebraize-morphism}
we see that $X \cong Y$ and the proof is complete.
\end{proof}

\begin{lemma}
\label{lemma-modification-of-dim-2-is-projective-over-complete}
If $(A, \mathfrak m, \kappa)$ is a complete Noetherian local domain
of dimension $2$, then every modification of $\Spec(A)$ is projective over $A$.
\end{lemma}

\begin{proof}
By Lemma \ref{lemma-projective-over-complete} it suffices to show that
the special fibre of any modification $X$ of $\Spec(A)$ has dimension
$\leq 1$. Let $U \to X$ be an \'etale morphism with $U$ affine.
Since $X \to \Spec(A)$ is a modification (Spaces over Fields, Definition
\ref{spaces-over-fields-definition-modification})
we see that a dense open of $U$ is \'etale over $A$.
In particular, every generic point $\eta$ of an irreducible component
$U'$ of $U$ maps to the generic point of $\Spec(A)$ and
$f.f.(A) \subset \kappa(\eta)$ is finite separable.
If $u \in U'$ is a closed point lying over $\mathfrak m \in \Spec(A)$,
then by the dimension formula we see that
$$
\dim(\mathcal{O}_{U', u}) \leq \dim(A) = 2,
$$
see Morphisms, Lemma \ref{morphisms-lemma-dimension-formula}.
Since $\eta \not \in U'_\kappa$, the dimension of $U'_\kappa$
can be at most $1$ as desired.
\end{proof}





\section{Quadratic transformations}
\label{section-quadratic}

\noindent
In this section we study what happens when we blow up a nonsingular point
on a surface. We hesitate the formally define such a morphism as a
{\it quadratic transformation} as on the one hand often other names are
used and on the other hand the phrase ``quadratic transformation'' is
sometimes used with a different meaning.

\begin{lemma}
\label{lemma-blowup}
Let $(A, \mathfrak m, \kappa)$ be a regular local ring of dimension $2$.
Let $f : X \to S = \Spec(A)$ be the blowing up of $A$ in $\mathfrak m$.
There is a closed immersion
$$
r : X \longrightarrow \mathbf{P}^1_S
$$
over $S$ such that $\mathcal{O}_X(1) = r^*\mathcal{O}_{\mathbf{P}^1_S}(1)$
and such that $r|_E : E \to \mathbf{P}^1_\kappa$ is an isomorphism.
\end{lemma}

\begin{proof}
As $A$ is regular of dimension $2$ we can write $\mathfrak m = (x, y)$.
Then $x$ and $y$ placed in degree $1$ generate the Rees algebra
$\bigoplus_{n \geq 0} \mathfrak m^n$ over $A$. Recall that
$X = \text{Proj}(\bigoplus_{n \geq 0} \mathfrak m^n)$, see
Divisors, Lemma \ref{divisors-lemma-blowing-up-affine}.
Thus the surjection
$$
A[T_0, T_1] \longrightarrow \bigoplus\nolimits_{n \geq 0} \mathfrak m^n,
\quad
T_0 \mapsto x,\ T_1 \mapsto y
$$
of graded $A$-algebras induces a closed immersion
$r : X \to \mathbf{P}^1_S = \text{Proj}(A[T_0, T_1])$
such that $\mathcal{O}_X(1) = r^*\mathcal{O}_{\mathbf{P}^1_S}(1)$, see
Constructions, Lemma
\ref{constructions-lemma-surjective-graded-rings-generated-degree-1-map-proj}.
To prove the final statement note that
$$
\left(\bigoplus\nolimits_{n \geq 0} \mathfrak m^n\right) \otimes_A \kappa =
\bigoplus\nolimits_{n \geq 0} \mathfrak m^n/\mathfrak m^{n + 1} \cong
\kappa[\overline{x}, \overline{y}]
$$
a polynomial algebra, see Algebra, Lemma \ref{algebra-lemma-regular-graded}.
This proves that the fibre of $X \to S$ over $\Spec(\kappa)$ is equal to
$\text{Proj}(\kappa[\overline{x}, \overline{y}]) = \mathbf{P}^1_\kappa$, see
Constructions, Lemma \ref{constructions-lemma-base-change-map-proj}.
Recall that $E$ is the closed subscheme of $X$ defined by
$\mathfrak m\mathcal{O}_X$, i.e., $E = X_\kappa$.
By our choice of the morphism $r$ we see that $r|_E$ in fact
produces the identification of $E = X_\kappa$ with the special
fibre of $\mathbf{P}^1_S \to S$.
\end{proof}

\begin{lemma}
\label{lemma-blowup-regular}
Let $(A, \mathfrak m, \kappa)$ be a regular local ring of dimension $2$.
Let $f : X \to S = \Spec(A)$ be the blowing up of $A$ in $\mathfrak m$.
Then $X$ is an irreducible regular scheme.
\end{lemma}

\begin{proof}
Observe that $X$ is integral by
Divisors, Lemma \ref{divisors-lemma-blow-up-integral-scheme}
and
Algebra, Lemma \ref{algebra-lemma-regular-domain}.
To see $X$ is regular it suffices to check that $\mathcal{O}_{X, x}$
is regular for closed points $x \in X$, see
Properties, Lemma \ref{properties-lemma-characterize-regular}.
Let $x \in X$ be a closed point. Since $f$ is proper $x$ maps to
$\mathfrak m$, i.e., $x$ is a point of the exceptional divisor $E$.
Then $E$ is an effective Cartier divisor and $E \cong \mathbf{P}^1_\kappa$.
Thus if $f \in \mathfrak m_x \subset \mathcal{O}_{X, x}$ is a local
equation for $E$, then
$\mathcal{O}_{X, x}/(f) \cong \mathcal{O}_{\mathbf{P}^1_\kappa, x}$.
Since $\mathbf{P}^1_\kappa$ is covered by two affine opens which are the
spectrum of a polynomial ring over $\kappa$, we see that
$\mathcal{O}_{\mathbf{P}^1_\kappa, x}$ is regular by
Algebra, Lemma \ref{algebra-lemma-dim-affine-space}.
We conclude by
Algebra, Lemma \ref{algebra-lemma-regular-mod-x}.
\end{proof}

\begin{lemma}
\label{lemma-cohomology-of-blowup}
Let $(A, \mathfrak m, \kappa)$ be a regular local ring of dimension $2$.
Let $f : X \to S = \Spec(A)$ be the blowing up of $A$ in $\mathfrak m$.
Let $\mathcal{F}$ be a quasi-coherent $\mathcal{O}_X$-module.
\begin{enumerate}
\item $H^p(X, \mathcal{F}) = 0$ for $p \not \in \{0, 1\}$,
\item $H^1(X, \mathcal{O}_X(n)) = 0$ for $n \geq -1$,
\item $H^1(X, \mathcal{F}) = 0$ if $\mathcal{F}$ or $\mathcal{F}(1)$
is globally generated,
\item $H^0(X, \mathcal{O}_X(n)) = \mathfrak m^{\max(0, n)}$,
\item $\text{length}_A H^1(X, \mathcal{O}_X(n)) = -n(-n - 1)/2$
if $n < 0$.
\end{enumerate}
\end{lemma}

\begin{proof}
If $\mathfrak m = (x, y)$, then $X$ is covered by the spectra
of the affine blowup algebras $A[\frac{\mathfrak m}{x}]$ and
$A[\frac{\mathfrak m}{y}]$ because $x$ and $y$ placed in degree $1$
generate the Rees algebra $\bigoplus \mathfrak m^n$ over $A$.
See Divisors, Lemma \ref{divisors-lemma-blowing-up-affine} and
Constructions, Lemma \ref{constructions-lemma-proj-quasi-compact}.
Since $X$ is separated by
Constructions, Lemma \ref{constructions-lemma-proj-separated}
we see that cohomology of quasi-coherent sheaves vanishes in
degrees $\geq 2$ by Cohomology of Schemes, Lemma
\ref{coherent-lemma-vanishing-nr-affines}.

\medskip\noindent
Let $i : E \to X$ be the exceptional divisor, see
Divisors, Definition \ref{divisors-definition-blow-up}.
Recall that $\mathcal{O}_X(-E) = \mathcal{O}_X(1)$ is
$f$-relatively ample, see
Divisors, Lemma \ref{divisors-lemma-blowing-up-gives-effective-Cartier-divisor}.
Hence we know that $H^1(X, \mathcal{O}_X(-nE)) = 0$ for some $n > 0$,
see Cohomology of Schemes, Lemma \ref{coherent-lemma-kill-by-twisting}.
Consider the filtration
$$
\mathcal{O}_X(-nE) \subset \mathcal{O}_X(-(n - 1)E) \subset
\ldots \subset \mathcal{O}_X(-E) \subset \mathcal{O}_X \subset \mathcal{O}_X(E)
$$
The succesive quotients are the sheaves
$$
\mathcal{O}_X(-t E)/\mathcal{O}_X(-(t + 1)E) =
\mathcal{O}_X(t)/\mathcal{I}(t) =
i_*\mathcal{O}_E(t)
$$
where $\mathcal{I} = \mathcal{O}_X(-E)$ is the ideal sheaf of $E$.
By Lemma \ref{lemma-blowup} we have $E = \mathbf{P}^1_\kappa$ and
$\mathcal{O}_E(1)$ indeed corresponds to the usual Serre twist of
the structure sheaf on $\mathbf{P}^1$. Hence the cohomology
of $\mathcal{O}_E(t)$ vanishes in degree $1$ for $t \geq -1$, see
Cohomology of Schemes, Lemma
\ref{coherent-lemma-cohomology-projective-space-over-ring}.
Since this is equal to $H^1(X, i_*\mathcal{O}_E(t))$ (by
Cohomology of Schemes, Lemma \ref{coherent-lemma-relative-affine-cohomology})
we find that $H^1(X, \mathcal{O}_X(-(t + 1)E)) \to H^1(X, \mathcal{O}_X(-tE))$
is surjective for $t \geq -1$. Hence
$$
0 = H^1(X, \mathcal{O}_X(-nE))
\longrightarrow
H^1(X, \mathcal{O}_X(-tE)) = H^1(X, \mathcal{O}_X(t))
$$
is surjective for $t \geq -1$ which proves (2).

\medskip\noindent
Let $\mathcal{F}$ be globally generated. This means there exists
a short exact sequence
$$
0 \to \mathcal{G} \to \bigoplus\nolimits_{i \in I} \mathcal{O}_X
\to \mathcal{F} \to 0
$$
Note that $H^1(X, \bigoplus_{i \in I} \mathcal{O}_X) =
\bigoplus_{i \in I} H^1(X, \mathcal{O}_X)$ by
Cohomology, Lemma \ref{cohomology-lemma-quasi-separated-cohomology-colimit}.
By part (2) we have $H^1(X, \mathcal{O}_X) = 0$.
If $\mathcal{F}(1)$ is globally generated, then we can find a
surjection $\bigoplus_{i \in I} \mathcal{O}_X(-1) \to \mathcal{F}$
and argue in a similar fashion.
In other words, part (3) follows from part (2).

\medskip\noindent
For part (4) we note that for all $n$ large enough we have
$\Gamma(X, \mathcal{O}_X(n)) = \mathfrak m^n$, see
Cohomology of Schemes, Lemma \ref{coherent-lemma-recover-tail-graded-module}.
If $n \geq 0$, then we can use the short exact sequence
$$
0 \to \mathcal{O}_X(n) \to \mathcal{O}_X(n - 1) \to
i_*\mathcal{O}_E(n - 1) \to 0
$$
and the vanishing of $H^1$ for the sheaf on the left to get a commutative
diagram
$$
\xymatrix{
0 \ar[r] &
\mathfrak m^{\max(0, n)} \ar[r] \ar[d] &
\mathfrak m^{\max(0, n - 1)} \ar[r] \ar[d] &
\mathfrak m^{\max(0, n)}/\mathfrak m^{\max(0, n - 1)} \ar[r] \ar[d] & 0\\
0 \ar[r] &
\Gamma(X, \mathcal{O}_X(n)) \ar[r] &
\Gamma(X, \mathcal{O}_X(n - 1)) \ar[r] &
\Gamma(E, \mathcal{O}_E(n - 1)) \ar[r] & 0
}
$$
with exact rows. In fact, the rows are exact also for $n < 0$
because in this case the groups on the right are zero.
In the proof of Lemma \ref{lemma-blowup}
we have seen that the right vertical arrow is an isomorphism
(details omitted). Hence if the left vertical arrow is an isomorphism, so
is the middle one. In this way we see that (4) holds by
descending induction on $n$.

\medskip\noindent
Finally, we prove (5) by descending induction on $n$ and the sequences
$$
0 \to \mathcal{O}_X(n) \to \mathcal{O}_X(n - 1) \to
i_*\mathcal{O}_E(n - 1) \to 0
$$
Namely, for $n \geq -1$ we already know $H^1(X, \mathcal{O}_X(n)) = 0$.
Since
$$
H^1(X, i_*\mathcal{O}_E(-2)) =
H^1(E, \mathcal{O}_E(-2)) =
H^1(\mathbf{P}^1_\kappa, \mathcal{O}(-2)) \cong \kappa
$$
by Cohomology of Schemes, Lemma
\ref{coherent-lemma-cohomology-projective-space-over-ring}
which has length $1$ as an $A$-module, we conclude from the long exact
cohomology sequence that (5) holds for $n = -2$. And so on and so forth.
\end{proof}

\begin{lemma}
\label{lemma-blowup-improve}
Let $(A, \mathfrak m)$ be a regular local ring of dimension $2$.
Let $f : X \to S = \Spec(A)$ be the blowing up of $A$ in $\mathfrak m$.
Let $\mathfrak m^n \subset I \subset \mathfrak m$ be an ideal.
Let $d \geq 0$ be the largest integer such that
$$
I \mathcal{O}_X \subset \mathcal{O}_X(-dE)
$$
where $E$ is the exceptional divisor. Set
$\mathcal{I}' = I\mathcal{O}_X(dE) \subset \mathcal{O}_X$.
Then $d > 0$, the sheaf
$\mathcal{O}_X/\mathcal{I}'$ is supported in finitely many
closed points $x_1, \ldots, x_r$ of $X$, and
\begin{align*}
\text{length}_A(A/I)
& >
\text{length}_A \Gamma(X, \mathcal{O}_X/\mathcal{I}') \\
& \geq
\sum\nolimits_{i = 1, \ldots, r}
\text{length}_{\mathcal{O}_{X, x_i}}
(\mathcal{O}_{X, x_i}/\mathcal{I}'_{x_i})
\end{align*}
\end{lemma}

\begin{proof}
Since $I \subset \mathfrak m$ we see that every element of $I$
vanishes on $E$. Thus we see that $d \geq 1$. On the other hand, since
$\mathfrak m^n \subset I$ we see that $d \leq n$. Consider the
short exact sequence
$$
0 \to I\mathcal{O}_X \to \mathcal{O}_X \to \mathcal{O}_X/I\mathcal{O}_X \to 0
$$
Since $I\mathcal{O}_X$ is globally generated, we see that
$H^1(X, I\mathcal{O}_X) = 0$ by Lemma \ref{lemma-cohomology-of-blowup}.
Hence we obtain a surjection
$A/I \to \Gamma(X, \mathcal{O}_X/I\mathcal{O}_X)$. Consider the short exact
sequence
$$
0 \to
\mathcal{O}_X(-dE)/I\mathcal{O}_X \to
\mathcal{O}_X/I\mathcal{O}_X \to
\mathcal{O}_X/\mathcal{O}_X(-dE) \to 0
$$
By Divisors, Lemma \ref{divisors-lemma-codim-1-part}
we see that $\mathcal{O}_X(-dE)/I\mathcal{O}_X$ is supported in finitely many
closed points of $X$. In particular, this coherent sheaf has vanishing higher
cohomology groups (detail omitted). Thus in the following diagram
$$
\xymatrix{
& & A/I \ar[d] \\
0 \ar[r] &
\Gamma(X, \mathcal{O}_X(-dE)/I\mathcal{O}_X) \ar[r] &
\Gamma(X, \mathcal{O}_X/I\mathcal{O}_X) \ar[r] &
\Gamma(X, \mathcal{O}_X/\mathcal{O}_X(-dE)) \ar[r] & 0
}
$$
the bottom row is exact and the vertical arrow surjective. We have
$$
\text{length}_A \Gamma(X, \mathcal{O}_X(-dE)/I\mathcal{O}_X) <
\text{length}_A(A/I)
$$
since $\Gamma(X, \mathcal{O}_X/\mathcal{O}_X(-dE))$ is nonzero.
Namely, the image of $1 \in \Gamma(X, \mathcal{O}_X)$
is nonzero as $d > 0$.

\medskip\noindent
To finish the proof we translate the results above into the statements
of the lemma. Since
$\mathcal{O}_X(dE)$ is invertible we have
$$
\mathcal{O}_X/\mathcal{I}' =
\mathcal{O}_X(-dE)/I\mathcal{O}_X \otimes_{\mathcal{O}_X} \mathcal{O}_X(dE).
$$
Thus $\mathcal{O}_X/\mathcal{I}'$ and $\mathcal{O}_X(-dE)/I\mathcal{O}_X$
are supported in the same set of finitely many
closed points, say $x_1, \ldots, x_r \in E \subset X$.
Moreover we obtain
$$
\Gamma(X, \mathcal{O}_X(-dE)/I\mathcal{O}_X) =
\bigoplus \mathcal{O}_X(-dE)_{x_i}/I\mathcal{O}_{X, x_i}
\cong
\bigoplus \mathcal{O}_{X, x_i}/\mathcal{I}'_{x_i} =
\Gamma(X, \mathcal{O}_X/\mathcal{I}')
$$
because an invertible module over a local ring is trivial.
Thus we obtain the strict inequality. We also get the second because
$$
\text{length}_A(\mathcal{O}_{X, x_i}/\mathcal{I}'_{x_i}) \geq
\text{length}_{\mathcal{O}_{X, x_i}}(\mathcal{O}_{X, x_i}/\mathcal{I}'_{x_i})
$$
as is immediate from the definition of length.
\end{proof}



\section{Quadratic transformations of spaces}
\label{section-quadratic-spaces}

\noindent
Using the result above we can prove that blowups in points dominate
any modification of a regular $2$ dimensional algebraic space.

\medskip\noindent
Let $X$ be a decent algebraic space over some base scheme $S$.
Let $x \in |X|$ be a closed point. By
Decent Spaces, Lemma \ref{decent-spaces-lemma-decent-space-closed-point}
we can represent $x$ by a closed immersion $i : \Spec(k) \to X$.
Then the {\it blowing up of $X$ at $x$} means the blowing up of $X$
in the closed subspace $Z = i(\Spec(k)) \subset X$.

\begin{lemma}
\label{lemma-make-ideal-principal}
Let $S$ be a scheme. Let $X$ be a Noetherian algebraic space over $S$.
Let $T \subset |X|$ be a finite set of closed points $x$ such that
(1) $X$ is regular at $x$ and (2) the local ring of $X$ at $x$ has
dimension $2$. Let $\mathcal{I} \subset \mathcal{O}_X$ be a quasi-coherent
sheaf of ideals such that $\mathcal{O}_X/\mathcal{I}$ is supported on $T$.
Then there exists a sequence
$$
X_n \to X_{n - 1} \to \ldots \to X_1 \to X_0 = X
$$
where $X_{i + 1} \to X_i$ is the blowing up of $X_i$ at a closed
point $x_i$ lying above a point of $T$ such that
$\mathcal{I}\mathcal{O}_{X_n}$ is an invertible ideal sheaf.
\end{lemma}

\begin{proof}
Say $T = \{x_1, \ldots, x_r\}$. Pick an \'etale morphism
$U \to X$ where $U$ is a scheme with points $u_i \in U$ lying over
$x_i$. By Decent Spaces, Lemma
\ref{decent-spaces-lemma-decent-no-specializations-map-to-same-point}
the points $u_i$ are closed points. After shrinking $U$ we may
assume these are the only points of $U$ mapping to $T$.
The local rings
$\mathcal{O}_{U, u_i}$ are regular local of dimension $2$, see
Properties of Spaces, Definitions
\ref{spaces-properties-definition-regular-at-point} and
\ref{spaces-properties-definition-dimension-local-ring}.
Let $I_i \subset \mathcal{O}_{U, u_i}$ be the stalk of
$\mathcal{I}|_U$ at $u_i$. Set
$$
n_i = \text{length}_{\mathcal{O}_{U, u_i}}(\mathcal{O}_{U, u_i}/I_i)
$$
This is finite as $\mathcal{O}_X/\mathcal{I}$ is supported on $T$
and hence $\mathcal{O}_{U, u_i}/I_i$ has support equal to
$\{\mathfrak m_{u_i}\}$ (see Algebra, Lemma \ref{algebra-lemma-support-point}).
We are going to use induction on $\sum n_i$. If $n_i = 0$ for all
$i$, then $\mathcal{I} = \mathcal{O}_X$ and we are done.

\medskip\noindent
Suppose $n_i > 0$. Let $X' \to X$ be the blowing up of $X$ in $x_i$
(see discussion above the lemma). Since $U \to X$ is \'etale and $u_i$
is the unique point of $U$ lying over $x$ we see that $U' = U \times_X X'$
is the blowup of $U$ in $u_i$, see
Divisors on Spaces, Lemma
\ref{spaces-divisors-lemma-flat-base-change-blowing-up}.
Since $\Spec(\mathcal{O}_{U, u_i}) \to U$ is flat we see that
$U' \times_U \Spec(\mathcal{O}_{U, u_i})$ is the blowup of
the ring $\mathcal{O}_{U, u_i}$ in the maximal ideal. Hence
both squares in the commutative diagram
$$
\xymatrix{
\text{Proj}(\bigoplus\nolimits_{d \geq 0} \mathfrak m_{u_i}^d) \ar[r] \ar[d] &
U' \ar[d] \ar[r] & X' \ar[d] \\
\Spec(\mathcal{O}_{U, u_i}) \ar[r] & U \ar[r] & X
}
$$
are cartesian. Let $E \subset X'$, $E' \subset U'$,
$E'' \subset \text{Proj}(\bigoplus\nolimits_{d \geq 0} \mathfrak m_{u_i}^d)$
be the exceptional divisors. Let $d \geq 1$ be the integer found in
Lemma \ref{lemma-blowup-improve} for the ideal
$\mathcal{I}_i \subset \mathcal{O}_{U, u_i}$.
Since the horizontal arrows in the diagram are flat, since
$E'' \to E$ is surjective, and since $E''$ is the pullback of $E$, we see that
$$
\mathcal{I}\mathcal{O}_{X'} \subset \mathcal{O}_{X'}(-dE)
$$
(some details omitted).
Set $\mathcal{I}' = \mathcal{I}\mathcal{O}_{X'}(dE) \subset \mathcal{O}_{X'}$.
Then we see that $\mathcal{O}_{X'}/\mathcal{I}'$ is supported in finitely
many closed points $T' \subset |X'|$ because this holds over
$X \setminus \{x_i\}$ and for the pullback to
$\text{Proj}(\bigoplus\nolimits_{d \geq 0} \mathfrak m_{u_i}^d)$.
The final assertion of Lemma \ref{lemma-blowup-improve}
tells us that the sum of the lengths of the stalks
$\mathcal{O}_{U', u'}/\mathcal{I}'\mathcal{O}_{U', u'}$
for $u'$ lying over $u_i$ is $< n_i$. Hence the sum of the lengths
has decreased.

\medskip\noindent
By induction hypothesis, there exists a sequence
$$
X'_n \to \ldots \to X'_1 \to X'
$$
of blowups at closed points lying over $T'$ such that
$\mathcal{I}'\mathcal{O}_{X'_n}$ is invertible. Since
$\mathcal{I}'\mathcal{O}_{X'}(-dE) = \mathcal{I}\mathcal{O}_{X'}$, we see
that $\mathcal{I}\mathcal{O}_{X'_n} =
\mathcal{I}'\mathcal{O}_{X'_n}(-d(f')^{-1}E)$
where $f' : X'_n \to X'$ is the composition.
Note that $(f')^{-1}E$ is an effective Cartier divisor by
Divisors on Spaces, Lemma
\ref{spaces-divisors-lemma-blow-up-pullback-effective-Cartier}.
Thus we are done by
Divisors on Spaces, Lemma
\ref{spaces-divisors-lemma-sum-effective-Cartier-divisors}.
\end{proof}

\begin{lemma}
\label{lemma-dominate-by-blowing-up-in-points}
Let $S$ be a scheme. Let $X$ be a Noetherian algebraic space over $S$.
Let $T \subset |X|$ be a finite set of closed points $x$ such that
(1) $X$ is regular at $x$ and (2) the local ring of $X$ at $x$ has
dimension $2$. Let $f : Y \to X$ be a proper morphism of
algebraic spaces which is an isomorphism over $U = X \setminus T$.
Then there exists a sequence
$$
X_n \to X_{n - 1} \to \ldots \to X_1 \to X_0 = X
$$
where $X_{i + 1} \to X_i$ is the blowing up of $X_i$ at a closed
point $x_i$ lying above a point of $T$ and a factorization $X_n \to Y \to X$
of the composition.
\end{lemma}

\begin{proof}
By More on Morphisms of Spaces,
Lemma \ref{spaces-more-morphisms-lemma-dominate-modification-by-blowup} 
there exists a $U$-admissible blowup $X' \to X$ which dominates
$Y \to X$. Hence we may assume there exists an ideal sheaf
$\mathcal{I} \subset \mathcal{O}_X$ such that
$\mathcal{O}_X/\mathcal{I}$ is supported on $T$ and such that
$Y$ is the blowing up of $X$ in $\mathcal{I}$.
By Lemma \ref{lemma-make-ideal-principal} 
there exists a sequence
$$
X_n \to X_{n - 1} \to \ldots \to X_1 \to X_0 = X
$$
where $X_{i + 1} \to X_i$ is the blowing up of $X_i$ at a closed
point $x_i$ lying above a point of $T$ such that
$\mathcal{I}\mathcal{O}_{X_n}$ is an invertible ideal sheaf.
By the universal property of blowing up
(Divisors on Spaces, Lemma
\ref{spaces-divisors-lemma-universal-property-blowing-up})
we find the desired factorization.
\end{proof}










\section{Examples}
\label{section-examples}

\noindent
Some examples related to the results earlier in this chapter.

\begin{example}
\label{example-factorial}
\begin{reference}
\cite[4(c)]{Samuel-UFD}
\end{reference}
Let $k$ be a field. The ring $A = k[x, y, z]/(x^r + y^s + z^t)$
is a UFD for $r, s, t$ pairwise coprime integers. Namely, since
$x^r + y^s + z^t$ is irreducible $A$ is a domain. The element $z$
is a prime element, i.e., generates a prime ideal in $A$.
On the other hand, if $r = 1 + ers$ for some $e$, then
$$
A[1/z] \cong k[x', y', 1/z]
$$
where $x' = x/z^{es}$, $y' = y/z^{et}$ and $z = (x')^r + (y')^s$.
Thus $A[1/z]$ is a localization of a polynomial ring and hence
a UFD. It follows from an argument of Nagata that $A$ is a UFD.
See Algebra, Lemma \ref{algebra-lemma-invert-prime-elements}.
A similar argument can be given if $r$ is not congruent to $1$
modulo $rs$.
\end{example}

\begin{example}
\label{example-completion-not-factorial}
\begin{reference}
See \cite{Brieskorn} and \cite{Lipman-rational} for nonvanishing of
local Picard groups in general.
\end{reference}
The ring $A = \mathbf{C}[[x, y, z]]/(x^r + y^s + z^t)$
is not a UFD when $r < s < t$ are pairwise coprime integers
and not equal to $2, 3, 5$. For example consider the special
case $A = \mathbf{C}[[x, y, z]]/(x^2 + y^5 + z^7)$.
Consider the maps
$$
\psi_\zeta : \mathbf{C}[[x, y, z]]/(x^2 + y^5 + z^7) \to \mathbf{C}[[t]]
$$
given by
$$
x \mapsto t^7,\quad
y \mapsto t^3,\quad
z \mapsto -\zeta t^2(1 + t)^{1/7}
$$
where $\zeta$ is a $7$th root of unity. The kernel $\mathfrak p_\zeta$
of $\psi_\zeta$ is a height one prime, hence if $A$ is a UFD, then
it is principal, say given by $f_\zeta \in \mathbf{C}[[x, y, z]]$.
Note that $V(x^3 - y^7) = \bigcup V(\mathfrak p_\zeta)$
and $A/(x^3 - y^7)$ is reduced away from the closed point. Hence,
still assuming $A$ is a UFD, we would obtain
$$
\prod\nolimits_\zeta f_\zeta = u(x^3 - y^7) + a(x^2 + y^5 + z^7)
\quad\text{in}\quad
\mathbf{C}[[x, y, z]]
$$
for some unit $u \in \mathbf{C}[[x, y, z]]$ and some
element $a \in \mathbf{C}[[x, y, z]]$. After scaling by a constant
we may assume $u(0, 0, 0) = 1$. Note that the left hand side vanishes to
order $7$. Hence $a = - x \bmod \mathfrak m^2$. But then we get a term
$xy^5$ on the right hand side which does not occur on the left
hand side. A contradiction.
\end{example}

\begin{example}
\label{example-not-blow-up}
There exists an excellent $2$-dimensional Noetherian local ring
and a modification $X \to S = \Spec(A)$ which is not a scheme.
We sketch a construction. Let $X$ be a normal surface over $\mathbf{C}$
with a unique singular point $x \in X$. Assume that there exists a
resolution $\pi : X' \to X$ such that the exceptional fibre
$C = \pi^{-1}(x)_{red}$ is a smooth projective curve. Furthermore, assume
there exists a point $c \in C$ such that if $\mathcal{O}_C(nc)$
is in the image of $\text{Pic}(X') \to \text{Pic}(C)$, then $n = 0$.
Then we let $X'' \to X'$ be the blowing up in the nonsingular point $c$.
Let $C' \subset X''$ be the strict transform of $C$ and let $E \subset X''$
be the exceptional fibre. By Artin's results
(\cite{ArtinII}; use for example \cite{Mumford-topology}
to see that the normal bundle of $C'$ is negative)
we can blow down the curve $C'$ in $X''$ to obtain an algebraic space $X'''$.
Picture
$$
\xymatrix{
& X'' \ar[ld] \ar[rd] \\
X' \ar[rd] &  & X''' \ar[ld] \\
& X
}
$$
We claim that $X'''$ is not a scheme. This provides us with our example
because $X'''$ is a scheme if and only if the base change of $X'''$
to $A = \mathcal{O}_{X, x}$ is a scheme (details omitted).
If $X'''$ where a scheme, then the image of $C'$ in $X'''$ would
have an affine neighbourhood. The complement of this neighbourhood
would be an effective Cartier divisor on $X'''$ (because $X'''$ is
nonsingular apart from $1$ point). This effective Cartier divisor would
correspond to an effective Cartier divisor on $X''$
meeting $E$ and avoiding $C'$. Taking the image in $X'$ we obtain
an effective Cartier divisor meeting $C$ (set theoretically) in $c$.
This is impossible as no multiple of $c$ is the restriction of a Cartier
divisor by assumption.

\medskip\noindent
To finish we have to find such a singular surface $X$. We can just take
$X$ to be the affine surface given by
$$
x^3 + y^3 + z^3 + x^4 + y^4 + z^4 = 0
$$
in $\mathbf{A}^3_\mathbf{C} = \Spec(\mathbf{C}[x, y, z])$ and singular point
$(0, 0, 0)$. Then $(0, 0, 0)$ is the only singular point. Blowing up $X$
in the maximal ideal corresponding to $(0, 0, 0)$ we find three charts each
isomorphic to the smooth affine surface
$$
1 + s^3 + t^3 + x(1 + s^4 + t^4) = 0
$$
which is nonsingular with exceptional divisor $C$ given by $x = 0$. The reader
will recognize $C$ as an elliptic curve. Finally, the surface $X$ is rational
as projection from $(0, 0, 0)$ shows, or because in the equation for the
blow up we can solve for $x$. Finally, the Picard group of a nonsingular
rational surface is countable, whereas the Picard group of an elliptic
curve over the complex numbers is uncountable. Hence we can find a closed
point $c$ as indicated.
\end{example}








\input{chapters}

\bibliography{my}
\bibliographystyle{amsalpha}

\end{document}
