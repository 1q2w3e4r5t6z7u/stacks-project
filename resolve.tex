\input{preamble}

% OK, start here.
%
\begin{document}

\title{Resolution of Surfaces}


\maketitle

\phantomsection
\label{section-phantom}

\tableofcontents

\section{Introduction}
\label{section-introduction}

\noindent
This chapter discusses resolution of singularities of surfaces
following Lipman \cite{Lipman} and following the exposition
in \cite{Artin-Lipman}.





\section{A trace map in positive characteristic}
\label{section-trace}

\noindent
In this section $p$ will be a prime number. Let $R$ be an
$\mathbf{F}_p$-algebra. Let $M$ be an $R$-module and let $D : R \to M$ be a
derivation. Given an $a \in R$ set $A = R[x]/(x^p - a)$.
Define an $R$-linear map
$$
\text{Tr}_{x, D} : \Omega_{A/R} \longrightarrow M
$$
by the rule
$$
x^i\text{d}x \longmapsto
\left\{
\begin{matrix}
0 & \text{if} & 0 \leq i \leq p - 2, \\
D(a) & \text{if} & i = p - 1
\end{matrix}
\right.
$$
This makes sense as $\Omega_{A/R}$ is a free $R$-module with
basis $x^i\text{d}x$, $0 \leq i \leq p - 1$.
The following lemma implies that the trace map is well defined,
i.e., independent of the choice of the coordinate $x$.

\begin{lemma}
\label{lemma-trace-well-defined}
Let $\varphi : R[x]/(x^p - a) \to R[y]/(y^p - b)$ be an $R$-algebra
homomorphism. Then
$\text{Tr}_{x, D} = \text{Tr}_{y, D} \circ \varphi$.
\end{lemma}

\begin{proof}
Say $\varphi(x) = \lambda_0 + \lambda_1 y + \ldots + \lambda_{p - 1}y^{p - 1}$
with $\lambda_i \in R$. The condition that mapping $x$ to
$\lambda_0 + \lambda_1 y + \ldots + \lambda_{p - 1}y^{p - 1}$
induces an $R$-algebra homomorphism $R[x]/(x^p - a) \to R[y]/(y^p - b)$
is equivalent to the condition that
$$
a = \lambda_0^p + \lambda_1^p b + \ldots + \lambda_{p - 1}^pb^{p - 1}
$$
in the ring $R$. Consider the polynomial ring
$$
R_{univ} = \mathbf{F}_p[b, \lambda_0, \ldots, \lambda_{p - 1}]
$$
with the element
$a = \lambda_0^p + \lambda_1^p b + \ldots + \lambda_{p - 1}^pb^{p - 1}$
and
with its universal derivation given by
$$
D_{univ} = \text{d} :
R_{univ}
\longrightarrow
M_{univ} = \Omega_{R_{univ}/\mathbf{F}_p}
$$
Consider the universal algebra map
$\varphi_{univ} : R_{univ}[x]/(x^p - a) \to R_{univ}[y]/(y^p - b)$
given by mapping $x$ to
$\lambda_0 + \lambda_1 y + \ldots + \lambda_{p - 1}y^{p - 1}$.
We obtain a canonical maps
$$
R_{univ} \longrightarrow R,\quad
M_{univ} \longrightarrow M
$$
compatible with derivations by sending $b, \lambda_i$ to $b, \lambda_i$
and sending $\text{d}b, \text{d}\lambda_i$ to $D(b), D(\lambda_i)$.
By construction the maps
$$
R_{univ}[x]/(x^p - a) \to R[x]/(x^p - a),\quad
R_{univ}[y]/(y^p - b) \to R[y]/(y^p - b)
$$
are compatible with the trace maps. Hence it suffices to prove the
lemma for the map $\varphi_{univ}$. We will do this by evaluating
$\text{Tr}_{y, D}(\varphi(x)^i\text{d}\varphi(x))$ for $i = 0 , \ldots, p - 1$.

\medskip\noindent
The case $0 \leq i \leq p - 2$. Expand
$$
(\lambda_0 + \lambda_1 y + \ldots + \lambda_{p - 1}y^{p - 1})^i
(\lambda_1 + 2 \lambda_2 y + \ldots + (p - 1)\lambda_{p - 1}y^{p - 2})
$$
in the ring $R[y]/(y^p - b)$. We have to show that the coefficient
of $y^{p - 1}$ is zero. For this it suffices to show that
the expression above as a polynomial in $y$ has vanishing
coefficients in front of the powers $y^{pk - 1}$.
Then we write our polynomial as
$$
\frac{\text{d}}{(i + 1)\text{d}y}
(\lambda_0 + \lambda_1 y + \ldots + \lambda_{p - 1}y^{p - 1})^{i + 1}
$$
and indeed the coefficients of $y^{kp - 1}$ are all zero.

\medskip\noindent
The case $i = p - 1$. Expand
$$
(\lambda_0 + \lambda_1 y + \ldots + \lambda_{p - 1}y^{p - 1})^{p - 1}
(\lambda_1 + 2 \lambda_2 y + \ldots + (p - 1)\lambda_{p - 1}y^{p - 2})
$$
in the ring $R[y]/(y^p - b)$. To finish the proof we have to show that
the coefficient of $y^{p - 1}$ times $D(b)$ is $D(a)$. Here we use that
$R$ is $S/pS$ where
$S = \mathbf{Z}[b, \xi_j, \lambda_0, \ldots, \lambda_{p - 1}, \xi_{ij}]$.
Then the above, as a polynomial in $y$, is equal to
$$
\frac{\text{d}}{p\text{d}y}
(\lambda_0 + \lambda_1 y + \ldots + \lambda_{p - 1}y^{p - 1})^p
$$
Since $\frac{\text{d}}{\text{d}y}(y^{pk}) = pk y^{pk - 1}$
it suffices to understand the coefficients of $y^{pk}$ in the polynomial
$(\lambda_0 + \lambda_1 y + \ldots + \lambda_{p - 1}y^{p - 1})^p$
modulo $p$. The sum of these terms gives
$$
\lambda_0^p + \lambda_1^py^p + \ldots + \lambda_{p - 1}^py^{p(p - 1)}
\bmod p
$$
Whence we see that we obtain after applying the operator
$\frac{\text{d}}{p\text{d}y}$ and after reducing modulo $y^p - b$
the value
$$
\lambda_1^p + 2\lambda_2^pb + \ldots + (p - 1)\lambda_{p - 1}b^{p - 2}
$$
for the coefficient of $y^{p - 1}$ we wanted to compute. Now because
$a = \lambda_0^p + \lambda_1^p b + \ldots + \lambda_{p - 1}^pb^{p - 1}$
in $R$ we obtain that
$$
D(a) = (\lambda_1^p  + 2 \lambda_2^p b + \ldots +
(p - 1) \lambda_{p - 1}^p b^{p - 2}) D(b)
$$
in $R$. This proves that the coefficient of $y^{p - 1}$ is as desired.
\end{proof}

\begin{lemma}
\label{lemma-Noetherian-normal-domain-insep-extension}
Let $R$ be a Noetherian normal domain with fraction field $K$.
Let $a \in K$ be an element such that there exists a derivation
$D : R \to R$ with $D(a) \not = 0$. Then the integral closure
of $R$ in $L = K[x]/(x^p - a)$ is finite over $R$.
\end{lemma}

\begin{proof}
After replacing $x$ by $fx$ and $a$ by $f^pa$ for some $f \in R$
we may assume $a \in R$. Hence also $D(a) \in R$. We will show
by induction on $i \leq p - 1$ that if
$$
y = a_0 + a_1x + \ldots + a_i x^i,\quad a_j \in K
$$
is integral over $R$, then $D(a)^i a_j \in R$. Thus the integral
closure is contained in the finite $R$-module with basis
$D(a)^{-p + 1}x^j$, $j = 0, \ldots, p - 1$. Since $R$ is Noetherian
this proves the lemma.

\medskip\noindent
If $i = 0$, then $y = a_0$ is integral over $R$ if and only if $a_0 \in R$
and the statement is true. Suppose the statement holds for some $i < p - 1$
and suppose that
$$
y = a_0 + a_1x + \ldots + a_{i + 1} x^{i + 1},\quad a_j \in K
$$
is integral over $R$. Then
$$
y^p = a_0^p + a_1^p a + \ldots + a_{i + 1}^pa^{i + 1}
$$
is an element of $R$ (as it is in $K$ and integral over $R$). Applying
$D$ we obtain
$$
(a_1^p + 2a_2^p a + \ldots + (i + 1)a_{i + 1}^p a^i)D(a)
$$
is in $R$. Hence it follows that
$$
D(a)a_1 + 2D(a) a_2 x + \ldots + (i + 1)D(a) a_{i + 1} x^i
$$
is integral over $R$. By induction we find $D(a)^{i + 1}a_j \in R$
for $j = 1, \ldots, i + 1$. (Here we use that $1, \ldots, i + 1$
are invertible.) Hence $D(a)^{i + 1}a_0$ is also in $R$ because it
is the difference of $y$ and $\sum_{j > 0} D(a)^{i + 1}a_jx^j$ which
are integral over $R$ (since $x$ is integral over $R$ as $a \in R$).
\end{proof}







\section{Modifications}
\label{section-modifications}

\noindent
In this section let $(A, \mathfrak m, \kappa)$ be a $2$-dimensional
Noetherian local ring. We set $S = \Spec(A)$ and
$U = S \setminus \{\mathfrak m\}$. A {\it modification}
will mean an algebraic space $X$ over $S$ with proper structure morphism
$f$ inducing an isomorphism $f^{-1}(U) \to U$ such that moreover
$f^{-1}(U) \subset X$ is dense.

\begin{lemma}
\label{lemma-henselian}
The category of modifications of $S$ is equivalent to the category
of modifications of $S^h = \Spec(A^h)$ where $A^h$ is the henselization
of $A$.
\end{lemma}

\begin{proof}
We will prove the base change functor from modifications of $S$ to
modifications of $S^h$ is essentially surjective. We omit the proof
of fully faithfulness.

\medskip\noindent
Write $A^h = \colim A_i$ as a filtered colimit where the ring maps
$A \to A_i$ are \'etale and induce an isomorphism
$\kappa(\mathfrak m) \to A_i/\mathfrak m A_i$. Set $S_i = \Spec(A_i)$.
If $X^h \to S^h$ is a modification, then there exists an $i$ and
a morphism $X_i \to S_i$ such that $X^h = S^h \times_{S_i} X_i$, see
Limits of Spaces, Lemma \ref{spaces-limits-lemma-descend-finite-presentation}.
After increasing $i$ we may assume that $X_i \to S_i$ is
proper, see
Limits of Spaces, Lemma \ref{spaces-limits-lemma-eventually-proper}.
After further increasing $i$ we may assume that
$X_i \to S_i$ is an isomorphism over the open
$S_i \setminus V(\mathfrak m A_i)$, see
Limits of Spaces, Lemma \ref{spaces-limits-lemma-descend-isomorphism}.
Thus it suffices to solve the problem posed in the following paragraph.

\medskip\noindent
Let $A \to B$ be an \'etale ring map inducing an isomorphism
$\kappa(\mathfrak m) \to B/\mathfrak m B$ and let $Y \to \Spec(B)$
be a modification. We have to show that $Y \cong X \times_{\Spec(A)} \Spec(B)$
for some modification $X \to \Spec(A)$. To do this we will use descent.
Consider the scheme $R = \Spec(B \otimes_A B)$ with its two morphisms
$s, t : R \to \Spec(B)$ and the diagonal morphism $e : \Spec(B) \to R$.
We claim there is a canonical isomorphism
$$
\varphi :
R \times_{s, \Spec(B)} Y
\longrightarrow
Y \times_{\Spec(B), t} R
$$
over $R$. Over the open subscheme $e(\Spec(B)) \subset R$ the two
pullbacks are the same because $s \circ e = t \circ e = \text{id}_{\Spec(B)}$
hence there is a canonical isomorphism. Because
$B/\mathfrak m B = A/\mathfrak m$ the scheme $R$ has a unique
point $r$ lying over $\mathfrak m \in \Spec(A)$ which is a closed point,
and the restriction of the two pullbacks to $R \setminus \{r\}$ both map
isomorphically to $R \setminus \{r\}$. Thus the isomorphism over
$e(\Spec(B))$ extends uniquely to an isomorphism over all of $R$.
In exactly the same way one verifies that $\varphi$ defines a descent
datum for $Y/B/A$ (Descent of Spaces, Definition
\ref{spaces-descent-definition-descent-datum}). Now since every
descent datum for algebraic spaces relative to an fppf covering
is effective by Bootstrap, Lemma \ref{bootstrap-lemma-descend-algebraic-space},
the proof is complete.
\end{proof}

\begin{lemma}
\label{lemma-G-ring}
If $A$ is a G-ring, then the category of modifications of $S$ is equivalent
to the category of modifications of $S^\wedge = \Spec(A^\wedge)$ where
$A^\wedge$ is the completion of $A$.
\end{lemma}

\begin{proof}
Omitted. Hint: Approximation and Lemma \ref{lemma-henselian}.
\end{proof}

\begin{lemma}
\label{lemma-dominate-by-admissible-blowup}
Let $f : X \to S$ be a modification. Then there exists a $U$-admissible
blowup $X' \to S$ which dominates $X$.
\end{lemma}

\begin{proof}
Special case of More on Morphisms of Spaces,
Lemma \ref{spaces-more-morphisms-lemma-dominate-proper-modification-by-blowup}.
\end{proof}

\begin{lemma}
\label{lemma-projective-over-complete}
If $A$ is a complete Noetherian local ring, then every modification
$X$ is projective over $S$.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}






\section{Examples}
\label{section-examples}

\noindent
Some examples related to the results earlier in this chapter.

\begin{example}
\label{example-factorial}
\begin{reference}
\cite[4(c)]{Samuel-UFD}
\end{reference}
Let $k$ be a field. The ring $A = k[x, y, z]/(x^r + y^s + z^t)$
is a UFD for $r, s, t$ pairwise coprime integers. Namely, since
$x^r + y^s + z^t$ is irreducible $A$ is a domain. The element $z$
is a prime element, i.e., generates a prime ideal in $A$.
On the other hand, if $r = 1 + ers$ for some $e$, then
$$
A[1/z] \cong k[x', y', 1/z]
$$
where $x' = x/z^{es}$, $y' = y/z^{et}$ and $z = (x')^r + (y')^s$.
It follows from an argument of Nagata that $A$ is a UFD. Namely,
because $z$ is a prime element of $A$ the map $A \to A[1/z]$ maps
irreducible elements to irreducible elements or units and prime elements
to prime elements or units. Details omitted.
A similar argument can be given if $r$ is not congruent to $1$
modulo $rs$.
\end{example}

\begin{example}
\label{example-completion-not-factorial}
\begin{reference}
See \cite{Brieskorn} and \cite{Lipman-rational} for nonvanishing of
local Picard groups in general.
\end{reference}
The ring $A = \mathbf{C}[[x, y, z]]/(x^r + y^s + z^t)$
is not a UFD when $r < s < t$ are pairwise coprime integers
and not equal to $2, 3, 5$. For example consider the special
case $A = \mathbf{C}[[x, y, z]]/(x^2 + y^5 + z^7)$.
Consider the maps
$$
\psi_\zeta : \mathbf{C}[[x, y, z]]/(x^2 + y^5 + z^7) \to \mathbf{C}[[t]]
$$
given by
$$
x \mapsto t^7,\quad
y \mapsto t^3,\quad
z \mapsto -\zeta t^2(1 + t)^{1/7}
$$
where $\zeta$ is a $7$th root of unity. The kernel $\mathfrak p_\zeta$
of $\psi_\zeta$ is a height one prime, hence if $A$ is a UFD, then
it is principal, say given by $f_\zeta \in \mathbf{C}[[x, y, z]]$.
Note that $V(x^3 - y^7) = \bigcup V(\mathfrak p_\zeta)$
and $A/(x^3 - y^7)$ is reduced away from the closed point. Hence,
still assuming $A$ is a UFD, we would obtain
$$
\prod\nolimits_\zeta f_\zeta = u(x^3 - y^7) + a(x^2 + y^5 + z^7)
\quad\text{in}\quad
\mathbf{C}[[x, y, z]]
$$
for some unit $u \in \mathbf{C}[[x, y, z]]$ and some
element $a \in \mathbf{C}[[x, y, z]]$. After scaling by a constant
we may assume $u(0, 0, 0) = 1$. Note that the left hand side vanishes to
order $7$. Hence $a = - x \bmod \mathfrak m^2$. But then we get a term
$xy^5$ on the right hand side which does not occur on the left
hand side. A contradiction.
\end{example}

\begin{example}
\label{example-not-blow-up}
There exists an excellent $2$-dimensional Noetherian local ring
and a modification $X \to S = \Spec(A)$ which is not a scheme.
We sketch a construction. Let $X$ be a normal surface over $\mathbf{C}$
with a unique singular point $x \in X$. Assume that there exists a
resolution $\pi : X' \to X$ such that the exceptional fibre
$C = \pi^{-1}(x)_{red}$ is a smooth projective curve. Furthermore, assume
there exists a point $c \in C$ such that if $\mathcal{O}_C(nc)$
is in the image of $\text{Pic}(X') \to \text{Pic}(C)$, then $n = 0$.
Then we let $X'' \to X'$ be the blowing up in the nonsingular point $c$.
Let $C' \subset X''$ be the strict transform of $C$ and let $E \subset X''$
be the exceptional fibre. By Artin's results
(\cite{ArtinII}; use for example \cite{Mumford-topology}
to see that the normal bundle of $C'$ is negative)
we can blow down the curve $C'$ in $X''$ to obtain an algebraic space $X'''$.
Picture
$$
\xymatrix{
& X'' \ar[ld] \ar[rd] \\
X' \ar[rd] &  & X''' \ar[ld] \\
& X
}
$$
We claim that $X'''$ is not a scheme. This provides us with our example
because $X'''$ is a scheme if and only if the base change of $X'''$
to $A = \mathcal{O}_{X, x}$ is a scheme (details omitted).
If $X'''$ where a scheme, then the image of $C'$ in $X'''$ would
have an affine neighbourhood. The complement of this neighbourhood
would be an effective Cartier divisor on $X'''$ (because $X'''$ is
nonsingular apart from $1$ point). This effective Cartier divisor would
correspond to an effective Cartier divisor on $X''$
meeting $E$ and avoiding $C'$. Taking the image in $X'$ we obtain
an effective Cartier divisor meeting $C$ (set theoretically) in $c$.
This is impossible as no multiple of $c$ is the restriction of a Cartier
divisor by assumption.

\medskip\noindent
To finish we have to find such a singular surface $X$. We can just take
$X$ to be the affine surface given by
$$
x^3 + y^3 + z^3 + x^4 + y^4 + z^4 = 0
$$
in $\mathbf{A}^3_\mathbf{C} = \Spec(\mathbf{C}[x, y, z])$ and singular point
$(0, 0, 0)$. Then $(0, 0, 0)$ is the only singular point. Blowing up $X$
in the maximal ideal of $x$ we find three charts each isomorphic to the
smooth affine surface
$$
1 + s^3 + t^3 + x(1 + s^4 + t^4) = 0
$$
which is nonsingular with exceptional divisor $C$ given by $x = 0$. The reader
will recognize $C$ as an elliptic curve. Finally, the surface $X$ is rational
as projection from $(0, 0, 0)$ shows, or because in the equation for the
blow up we can solve for $x$. Finally, the Picard group of a nonsingular
rational surface is countable, whereas the Picard group of an elliptic
curve over the complex numbers is uncountable. Hence we can find a closed
point $c$ as indicated.
\end{example}








\input{chapters}

\bibliography{my}
\bibliographystyle{amsalpha}

\end{document}
