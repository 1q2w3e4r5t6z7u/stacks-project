\input{preamble}

% OK, start here.
%
\begin{document}

\title{Limits of Schemes}


\maketitle

\tableofcontents

\section{Introduction}
\label{section-introduction}

\noindent
In this chapter we start proving some basic theorems of algebraic geometry.
A basic reference is \cite{EGA}.




\section{Directed limits of schemes with affine transition maps}
\label{section-limits}

\noindent
In this section we construct the limit.

\begin{lemma}
\label{lemma-directed-inverse-system-affine schemes-has-limit}
Let $I$ be a directed partially ordered set.
Let $(S_i, f_{ii'})$ be an inverse system of
schemes over $I$.  If all the schemes $S_i$
are affine, then the limit $S = \text{lim}_i\ S_i$ exists
in the category of schemes.
In fact $S$ is affine and $S = \text{Spec}(\text{colim}_i\ R_i)$
with $R_i = \Gamma(S_i, \mathcal{O})$.
\end{lemma}

\begin{proof}
Just define $S = \text{Spec}(\text{colim}_i\ R_i)$.
It follows from Schemes, Lemma \ref{schemes-lemma-morphism-into-affine}
that $S$ is the limit even in the category of locally ringed spaces.
\end{proof}

\begin{lemma}
\label{lemma-directed-inverse-system-has-limit}
Let $I$ be a directed partially ordered set.
Let $(S_i, f_{ii'})$ be an inverse system of
schemes over $I$. If all the morphisms $f_{ii'} : S_i \to S_{i'}$
are affine, then the limit $S = \text{lim}_i\ S_i$ exists
in the category of schemes.
Moreover,
\begin{enumerate}
\item each of the morphisms $f_i : S \to S_i$ is affine,
\item for any $i \in I$ and any open subscheme $U_i \subset S_i$
we have
$$
f_i^{-1}(U_i) = \text{lim}_{i' \geq i}\ f_{i'i}^{-1}(U_i).
$$
\end{enumerate}
\end{lemma}

\begin{proof}
Choose $i_0 \in I$. Note that $I$ is nonempty as the limit is directed.
For convenience write $S_0 = S_{i_0}$ and $i_0 = 0$.
For every $i \geq 0$ consider the quasi-coherent sheaf of
$\mathcal{O}_{S_0}$-algebras $\mathcal{A}_i = f_{i0,*}\mathcal{O}_{S_i}$.
Recall that $S_i = \underline{\text{Spec}}_{S_0}(\mathcal{A})$,
see Morphisms, Lemma \ref{morphisms-lemma-characterize-affine}.
Set $\mathcal{A} = \text{colim}_{i \geq 0}\ \mathcal{A}_i$.
This is a quasi-coherent sheaf of $\mathcal{O}_{S_0}$-algebras,
see Schemes, Section \ref{schemes-section-quasi-coherent}.
Set $S = \underline{\text{Spec}}_{S_0}(\mathcal{A})$.
By Morphisms, Lemma \ref{morphisms-lemma-affine-equivalence-algebras}
we get for $i \geq 0$ morphisms $f_i : S \to S_i$ compatible with
the transition morphisms. Note that the morphisms $f_i$ are
affine by Morphisms, Lemma \ref{morphisms-lemma-affine-permanence} for example.
By Lemma \ref{lemma-directed-inverse-system-affine schemes-has-limit} above
we see that for any affine open $U_0 \subset S_0$ the
inverse image $U = f_0^{-1}(U_0) \subset S$ is the limit of the
system of opens $U_i = f_i^{-1}(U_0)$, $i \geq 0$ in the
category of schemes.

\medskip\noindent
Let $T$ be a scheme. Let $g_i : T \to S_i$ be a compatible system
of morphisms. To show that $S = \text{lim}_i\ S_i$ we have
to prove there is a unique morphism $g : T \to S$ with
$g_i = f_i \circ g$ for all $i \in I$.
For every $t \in T$ there exists an affine open
$U_0 \subset S_0$ containing $g_0(t)$. Let $V \subset g_0^{-1}(U_0)$
be an affine open neighbourhood containing $t$.
By the remarks above we obtain a unique morphism
$g_V : V \to U = f_0^{-1}(U_0)$ such that $f_i \circ g_V = g_i|_{U_i}$
for all $i$. The open sets $V \subset T$ so constructed form
a basis for the topology of $T$. The morphisms $g_V$ glue to a morphism
$g : T \to S$ because of the uniqueness property. This gives the
desired morphism $g : T \to S$.
\end{proof}













\section{Absolute Noetherian Approximation}
\label{section-approximation}

\noindent
A nice reference for this section is Appendix C of the article
by Thomason and Trobaugh \cite{TT}.
See Categories, Section \ref{categories-section-posets-limits}
for our conventions regarding directed systems.
We will use the existence result and properties of the limit
from Section \ref{section-limits} without furhter mention.


\begin{lemma}
\label{lemma-limit-nonempty}
Let $I$ be a directed partially ordered set.
Let $(S_i, f_{ii'})$ be an inverse system of
schemes over $I$. Assume
\begin{enumerate}
\item all the morphisms $f_{ii'} : S_i \to S_{i'}$ are affine,
\item all the schemes $S_i$ are quasi-compact, and
\item all the schemes $S_i$ are nonempty.
\end{enumerate}
Then the limit $S = \text{lim}_i\ S_i$ is nonempty.
\end{lemma}

\begin{proof}
Choose $i_0 \in I$. Note that $I$ is nonempty as the limit is directed.
For convenience write $S_0 = S_{i_0}$ and $i_0 = 0$.
Choose an affine open covering $S_0 = \bigcup_{j = 1, \ldots, m} U_j$.
Since $I$ is directed there exists a $j \in \{1, \ldots, m\}$
such that $f_{i0}^{-1}(U_j) \not = \emptyset$ for all
$i \geq 0$. Hence $\lim_{i \geq 0}\ f_{i0}^{-1}(U_j)$ is not
empty since a directed colimit of nonzero rings is nonzero
(because $1 \not = 0$). As $\lim_{i \geq 0}\ f_{i0}^{-1}(U_j)$
is an open subscheme of the limit we win.
\end{proof}

\begin{lemma}
\label{lemma-limit-closed-nonempty}
Let $I$ be a directed partially ordered set.
Let $(S_i, f_{ii'})$ be an inverse system of
schemes over $I$. Assume
\begin{enumerate}
\item all the morphisms $f_{ii'} : S_i \to S_{i'}$ are affine, and
\item all the schemes $S_i$ are quasi-compact.
\end{enumerate}
Let $S = \text{lim}_i\ S_i$.
Suppose for each $i$ we are given a nonempty closed subset
$Z_i \subset S_i$ with $f_{ii'}(Z_i) \subset Z_{i'}$.
Then there exists a point $s \in S$ with $f_i(s) \in Z_i$ for
all $i$.
\end{lemma}

\begin{proof}
Let $Z_i \subset S_i$ also denote the reduced closed subscheme
associated to $Z_i$, see Schemes,
Definition \ref{schemes-definition-reduced-induced-scheme}.
A closed immersion is affine, and a composition of affine
morphisms is affine (see
Morphisms, Lemmas \ref{morphisms-lemma-closed-immersion-affine}
and \ref{morphisms-lemma-composition-affine}), and hence $Z_i \to S_{i'}$ is
affine when $i \geq i'$. We conclude that the morphism
$f_{ii'} : Z_i \to Z_{i'}$ is affine by
Morphisms, Lemma \ref{morphisms-lemma-affine-permanence}.
Each of the schemes $Z_i$ is quasi-compact as a closed
subscheme of a quasi-compact scheme. Hence we may apply
Lemma \ref{lemma-limit-nonempty} to see that
$Z = \text{lim}_i\ Z_i$ is nonempty. Since there is a
canonical morphism $Z \to S$ we win.
\end{proof}

\begin{lemma}
\label{lemma-descend-section}
Let $I$ be a directed partially ordered set.
Let $(S_i, f_{ii'})$ be an inverse system of schemes over $I$.
Assume
\begin{enumerate}
\item all the morphisms $f_{ii'} : S_i \to S_{i'}$ are affine,
\item all the schemes $S_i$ are quasi-compact and quasi-separated.
\end{enumerate}
Let $S = \text{lim}_i\ S_i$. Let $i \in I$.
Suppose that $\mathcal{F}_i$ is a quasi-coherent sheaf on $S_i$.
Set $\mathcal{F}_j = f_{ji}^*\mathcal{F}_i$ for $j \geq i$ and set
$\mathcal{F} = f_i^*\mathcal{F}_i$.
Then
$$
\Gamma(S, \mathcal{F}) = \text{colim}_{j \geq i}\ \Gamma(S_j, \mathcal{F}_j)
$$
\end{lemma}

\begin{proof}
Write $\mathcal{A}_j = f_{ji, *} \mathcal{O}_{S_j}$.
This is a quasi-coherent sheaf of $\mathcal{O}_{S_i}$-algebras
(see Morphisms, Lemma \ref{morphisms-lemma-affine-equivalence-algebras})
and $S_j$ is the relative spectrum of $\mathcal{A}_j$ over $S_i$.
In the proof of Lemma \ref{lemma-directed-inverse-system-has-limit}
we constructed $S$ as the relative spectrum of
$\mathcal{A} = \text{colim}_{j \geq i}\ \mathcal{A}_j$
over $S_i$. Set
$$
\mathcal{M}_j = \mathcal{F}_i \otimes_{\mathcal{O}_{S_i}} \mathcal{A}_j
$$
and
$$
\mathcal{M} = \mathcal{F}_i \otimes_{\mathcal{O}_{S_i}} \mathcal{A}.
$$
Then we have $f_{ji, *} \mathcal{F}_j = \mathcal{M}_j$
and $f_{i, *}\mathcal{F} = \mathcal{M}$. Since $\mathcal{A}$
is the colimit of the sheaves $\mathcal{A}_j$ and since tensor
product commutes with directed colimits, we conclude that
$\mathcal{M} = \text{colim}_{j \geq i}\ \mathcal{M}_j$.
Since $S_i$ is quasi-compact and quasi-separated we see that
\begin{eqnarray*}
\Gamma(S, \mathcal{F})
& = &
\Gamma(S_i, \mathcal{M}) \\
& = &
\Gamma(S_i, \text{colim}_{j \geq i} \ \mathcal{M}_j) \\
& = &
\text{colim}_{j \geq i}\ \Gamma(S_i, \mathcal{M}_j) \\
& = &
\text{colim}_{j \geq i}\ \Gamma(S_j, \mathcal{F}_j)
\end{eqnarray*}
see Sheaves, Lemma \ref{sheaves-lemma-directed-colimits-sections} and
Topology, Lemma \ref{topology-lemma-topology-quasi-separated-scheme}
for the middle equality.
\end{proof}

\begin{lemma}
\label{lemma-descend-opens}
Let $I$ be a directed partially ordered set.
Let $(S_i, f_{ii'})$ be an inverse system of
schemes over $I$. Assume
\begin{enumerate}
\item all the morphisms $f_{ii'} : S_i \to S_{i'}$ are affine,
\item all the schemes $S_i$ are quasi-compact and quasi-separated.
\end{enumerate}
Then we have the following:
\begin{enumerate}
\item Given any quasi-compact open $V \subset S = \text{lim}_i\ S_i$
there exists an $i \in I$ and a quasi-compact open $V_i \subset S_i$
such that $f_i^{-1}(V_i) = V$.
\item Given $V_i \subset S_i$ and $V_{i'} \subset S_{i'}$
quasi-compact opens such that $f_i^{-1}(V_i) = f_{i'}^{-1}(V_{i'})$
there exists an index $i'' \geq i, i'$ such that
$f_{i''i}^{-1}(V_i) = f_{i''i'}^{-1}(V_{i'})$.
\item If $V_{1, i}, \ldots, V_{n, i} \subset S_i$ are quasi-compact
opens and $S = f_i^{-1}(V_{1, i}) \cup \ldots \cup f_i^{-1}(V_{n, i})$
then $S_{i'} = f_{i'i}^{-1}(V_{1, i}) \cup \ldots \cup f_{i'i}^{-1}(V_{n, i})$
for some $i' \geq i$.
\end{enumerate}
\end{lemma}

\begin{proof}
Choose $i_0 \in I$. Note that $I$ is nonempty as the limit is directed.
For convenience we write $S_0 = S_{i_0}$ and $i_0 = 0$.
Choose an affine open covering $S_0 = U_{1, 0} \cup \ldots \cup U_{m, 0}$.
Denote $U_{j, i} \subset S_i$ the inverse image of $U_{j, 0}$
under the transition morphism for $i \geq 0$.
Denote $U_j$ the inverse image of $U_{j, 0}$ in $S$.
Note that $U_j = \text{lim}_i\ U_{j, i}$ is a limit of affine
schemes.

\medskip\noindent
We first prove the uniqueness statement: Let
$V_i \subset S_i$ and $V_{i'} \subset S_{i'}$
quasi-compact opens such that $f_i^{-1}(V_i) = f_{i'}^{-1}(V_{i'})$.
It suffices to show that $f_{i''i}^{-1}(V_i \cap U_{j, i''})$ and
$f_{i''i'}^{-1}(V_{i'} \cap U_{j, i''})$ become equal
for $i''$ large enough. Hence we reduce to the case
of a limit of affine schemes. In this case write
$S = \text{Spec}(R)$ and $S_i = \text{Spec}(R_i)$ for all $i \in I$.
We may write $V_i = S_i \setminus V(h_1, \ldots, h_m)$
and $V_{i'} = S_{i'} \setminus V(g_1, \ldots, g_n)$.
The assumption means that the ideals
$\sum g_jR$ and $\sum h_jR$ have the same radical
in $R$. This means that $g_j^N = \sum a_{jj'}h_{j'}$ and
$h_j^N = \sum b_{jj'} g_{j'}$ for some $N \gg 0$ and $a_{jj'}$
and $b_{jj'}$ in $R$.
Since $R = \text{colim}_i R_i$ we can chose an index
$i'' \geq i$ such that the equations
$g_j^N = \sum a_{jj'}h_{j'}$ and
$h_j^N = \sum b_{jj'} g_{j'}$ hold in $R_{i''}$ for some
$a_{jj'}$ and $b_{jj'}$ in $R_{i''}$. This implies that
the ideals $\sum g_jR_{i''}$ and $\sum h_jR_{i''}$ have the same radical
in $R_{i''}$ as desired.

\medskip\noindent
We prove existence. We may apply the uniqueness statement to
the limit of schemes
$U_{j_1} \cap U_{j_2} = \text{lim}_i\ U_{j_1, i} \cap U_{j_2, i}$
since these are still quasi-compact due to the fact that the
$S_i$ were assumed quasi-separated.
Hence it is enough to prove existence in the affine case.
In this case write $S = \text{Spec}(R)$ and $S_i = \text{Spec}(R_i)$
for all $i \in I$. Then $V = S \setminus V(g_1, \ldots, g_n)$
for some $g_1, \ldots, g_n \in R$. Choose any $i$ large enough
so that each of the $g_j$ comes from an element $g_{j, i} \in R_i$
and take $V_i = S_i \setminus V(g_{1, i}, \ldots, g_{n, i})$.

\medskip\noindent
The statement on coverings follows from the uniqueness statement
for the opens $V_{1, i} \cup \ldots \cup V_{n, i}$ and $S_i$ of $S_i$.
\end{proof}

\begin{lemma}
\label{lemma-limit-quasi-affine}
Let $I$ be a directed partially ordered set.
Let $(S_i, f_{ii'})$ be an inverse system of
schemes over $I$. Assume
\begin{enumerate}
\item all the morphisms $f_{ii'} : S_i \to S_{i'}$ are affine,
\item all the schemes $S_i$ are quasi-compact and quasi-separated, and
\item the limit $S = \text{lim}_i\ S_i$ is quasi-affine.
\end{enumerate}
Then for some $i_0 \in I$ the schemes $S_i$ for $i \geq i_0$
are quasi-affine.
\end{lemma}

\begin{proof}
Choose $i_0 \in I$. Note that $I$ is nonempty as the limit is directed.
For convenience we write $S_0 = S_{i_0}$ and $i_0 = 0$.
For any $s \in S$ we may choose an affine open
$U_0 \subset S_0$ containing $f_0(s)$. Since $S$ is quasi-affine
we may choose an element $a_s \in \Gamma(S, \mathcal{O}_S)$ such
that $s \in D(a_s) \subset f_0^{-1}(U_0)$, and such that
$D(a_s)$ is affine. By Lemma \ref{lemma-descend-section}
there exists an $i \geq 0$ such that $a_s$
comes from an element $a_{s, i} \in \Gamma(S_i, \mathcal{O}_{S_i})$.
For any index $j \geq i$ we denote $a_{s, j}$
the image of $a_{s, i}$ in the global sections of the
structure sheaf of $S_j$.
Consider the opens $D(a_{s, j}) \subset S_j$
and $U_j = f_{j0}^{-1}(U_0)$. Note that
$U_j$ is affine and $D(a_{s, j})$ is a quasi-compact open of $S_j$,
see Properties, Lemma \ref{properties-lemma-affine-cap-s-open}
for example. Hence we may apply Lemma \ref{lemma-descend-opens} to the opens
$U_j$ and $U_j \cup D(a_{s, j})$ to conclude that
$D(a_{s, j}) \subset U_j$ for some  $j \geq i$.
For such an index $j$ we see that $D(a_{s, j}) \subset S_j$ is an affine open
(because $D(a_{s, j})$ is a standard affine open of the affine open $U_j$)
containing the image $f_j(s)$.

\medskip\noindent
We conclude that for every $s \in S$ there exist
an index $i(s) \in I$, and a global section
$a_s \in \Gamma(S_{i(s)}, \mathcal{O}_{S_{i(s)}})$
such that $D(a_s) \subset S_{i(s)}$ is an affine open
containing $f_i(s)$. Because $S$ is quasi-compact we
may choose a single index $i \in I$ and global sections
$a_1, \ldots, a_m \in \Gamma(S_i, \mathcal{O}_{S_i})$
such that each $D(a_j) \subset S_i$ is affine open
and such that $f_i : S \to S_i$ has image contained
in the union $W_i = \bigcup_{j = 1, \ldots, m} D(a_j)$.
For $i' \geq i$ set $W_{i'} = f_{i'i}^{-1}(W_i)$.
Since $f_i^{-1}(W_i)$ is all of $S$ we see
(by Lemma \ref{lemma-descend-opens} again)
that for a suitable $i' \geq i$ we
have $S_{i'} = W_{i'}$. Thus we may replace $i$ by
$i'$ and assume that $S_i = \bigcup_{j = 1, \ldots, m} D(a_j)$.
This implies that $\mathcal{O}_{S_i}$ is an ample invertible
sheaf on $S_i$ (see Properties, Definition \ref{properties-definition-ample})
and hence that $S_i$ is quasi-affine, see
Properties, Lemma \ref{properties-lemma-quasi-affine-O-ample}.
Hence we win.
\end{proof}

\begin{lemma}
\label{lemma-limit-affine}
Let $I$ be a directed partially ordered set.
Let $(S_i, f_{ii'})$ be an inverse system of
schemes over $I$. Assume
\begin{enumerate}
\item all the morphisms $f_{ii'} : S_i \to S_{i'}$ are affine,
\item all the schemes $S_i$ are quasi-compact and quasi-separated, and
\item the limit $S = \text{lim}_i\ S_i$ is affine.
\end{enumerate}
Then for some $i_0 \in I$ the schemes $S_i$ for $i \geq i_0$
are affine.
\end{lemma}

\begin{proof}
By Lemma \ref{lemma-limit-quasi-affine} we may assume that
$S_i$ is quasi-affine for all $i$. Set $R_i = \Gamma(S_i, \mathcal{O}_{S_i})$.
Write $S = \text{Spec}(R)$. We have $R = \text{colim}_i\ R_i$
by Lemma \ref{lemma-descend-section}.
Write $\overline{S_i} = \text{Spec}(R_i)$, so that also
$S = \text{lim}_i\ \overline{S_i}$. Let $Z_i \subset \overline{S_i}$
be the closed subset such that
$\overline{S_i} = Z_i \coprod S_i$.
We have to show that $Z_i$ is empty for some $i$.
Assume $Z_i$ is nonempty for all $i$ to get a contradiction.
By Lemma \ref{lemma-limit-closed-nonempty} there exists
a point $s$ of $S$ which maps to a point of $Z_i$ for every $i$.
But $S = \text{lim}_i\ S_i$, and hence we get a contradiction.
\end{proof}

\begin{lemma}
\label{lemma-quasi-affine-finite-type-over-Z}
Let $W$ be a quasi-affine scheme of finite type over
$\mathbf{Z}$. Suppose $W \to \text{Spec}(R)$ is an
open immersion into an affine scheme. There exists a
finite type $\mathbf{Z}$-algebra $A \subset R$
which induces an open immersion $W \to \text{Spec}(A)$.
Moreover, $R$ can be written as a filtered colimit
of such algebras.
\end{lemma}

\begin{proof}
Choose an affine open covering $W = \bigcup_{i = 1, \ldots, n} W_i$
such that each $W_i$ is a standard affine open in $\text{Spec}(R)$.
In other words, if we write $W_i = \text{Spec}(R_i)$
then $R_i = R_{f_i}$ for some $f_i \in R$.
Choose finitely many $x_{ij} \in R_i$ which generate
$R_i$ over $\mathbf{Z}$.
Pick an $N \gg 0$ such that each $f_i^Nx_{ij}$ comes from an
element of $R$, say $y_{ij} \in R$.
Set $A$ equal to the $\mathbf{Z}$-algebra generated by
the $f_i$ and the $y_{ij}$ and (optionally) finitely many
additional elements of $R$. Then $A$ works. Details omitted.
\end{proof}

\begin{lemma}
\label{lemma-diagram-localize}
Suppose given a cartesian diagram of rings
$$
\xymatrix{
B \ar[r]_s & R \\
B'\ar[u] \ar[r] & R' \ar[u]_{t}
}
$$
Suppose $h \in B'$ corresponds to $g \in B$
and $f \in R'$ are such that $s(g) = t(f)$.
Then the diagram
$$
\xymatrix{
B_g \ar[r]_-s & R_{s(g)} = R_{t(f)} \\
(B')_h \ar[u] \ar[r] & (R')_f \ar[u]_{t}
}
$$
is cartesian too.
\end{lemma}

\begin{proof}
Note that $B' = \{(b, r') \in B \times R' \mid s(b) = t(r')\}$.
So $h = (g, f) \in B'$. First we show that $(B')_h$ maps
injectively into $B_g \times (R')_f$. Namely, suppose that
$(x, y)/h^n$ maps to zero. This means that
$(g^Nx, f^Ny)$ is zero for some $N$. Which clearly implies
that $x/g^n$ and $y/f^n$ are both zero.
Next, suppose that $x/g^n$ and $y/f^m$ are elements
which map to the same element of $R_{s(g)}$.
This means that $s(g)^N(t(f)^ms(x) - s(g)^nt(y)) = 0$ in $R'$
for some $N \gg 0$. We can rewrite this as
$s(g^{m + N}x) = t(f^{n + N}y)$. Hence we see that the
pair $(x/g^n, y/f^m)$ is the image of the element
$(g^{m + N}x, t(f^{n + N}y)/(g, f)^{n + m + N}$ of
$(B')_h$.
\end{proof}

\begin{lemma}
\label{lemma-diagram}
Suppose given a cartesian diagram of rings
$$
\xymatrix{
B \ar[r]_s & R \\
B'\ar[u] \ar[r] & R' \ar[u]_{t}
}
$$
Let $W' \subset \text{Spec}(R')$ be an open of
the form $W' = D(f_1) \cup \ldots \cup D(f_n)$
such that $t(f_i) = s(g_i)$ for some $g_i \in B$
and $B_{g_i} \cong R_{s(g_i)}$. Then $B' \to R'$
induces an open immersion of $W'$ into $\text{Spec}(B')$.
\end{lemma}

\begin{proof}
Set $h_i = (g_i, f_i) \in B'$.
Lemma \ref{lemma-diagram-localize} above shows that
$(B')_{h_i} \cong (R')_{f_i}$ as desired.
\end{proof}

\begin{proposition}
\label{proposition-approximate}
Let $S$ be a quasi-compact and quasi-separated scheme.
There exist a directed partially ordered set $I$
and an inverse system of schemes $(S_i, f_{ii'})$ over $I$
such that
\begin{enumerate}
\item the transition morphisms $f_{ii'}$ are affine
\item each $S_i$ is of finite type over $\mathbf{Z}$, and
\item $S = \text{lim}_i\ S_i$.
\end{enumerate}
\end{proposition}

\begin{proof}
Choose an affine open covering $S = \bigcup_{j = 1, \ldots, m} U_j$
with $m$ minimal. We will prove the lemma by induction on $m$.
The lemma is obvious when $m = 1$ since any ring is the
directed colimit of its finitely generated $\mathbf{Z}$-subalgebras.

\medskip\noindent
Thus we may assume that $S = U \cup V$ with $U$, $V$ quasi-compact
opens, $U$ affine and such that $V = \text{lim}_i\ V_i$ with
each $V_i$ of finite type over $\mathbf{Z}$. Set $W = U \cap V$.
By Lemma \ref{lemma-descend-opens}
(and after shrinking $I$) we may assume that there exists
an open $W_i \subset V_i$ such that $f_{ij}^{-1}(W_j) = W_i$
and such that $f_i^{-1}(W_i) = W$. Since $W = U \cap V$
is quasi-affine we may assume (after shrinking $I$)
that $W_i$ is quasi-affine for all $i$, see
Lemma \ref{lemma-limit-quasi-affine}.

\medskip\noindent
Write $U = \text{Spec}(B)$. Write $R = \Gamma(W, \mathcal{O}_W)$.
We can find a finite covering $W = \bigcup_{j = 1, \ldots, m} W_j$
such that each $W_j \subset W \subset U$ is a standard affine
open. Say $W_j = \text{Spec}(B_{g_j})$ for some $g_j \in B$.

\medskip\noindent
Write $R_i = \Gamma(W_i, \mathcal{O}_{W_i})$.
By Lemma \ref{lemma-descend-section} we have $R = \text{colim}_i\ R_i$.
Now we have the maps of rings
$$
\xymatrix{
B \ar[r]_s & R \\
& R_i \ar[u]_{t_i}
}
$$
We set $B_i = \{(b, r) \in B \times R_i \mid s(b) = t_i(t)\}$.
We can (after shrinking $I$) assume that the elements
$s(g_j) \in R$ come from $g_{j, i} \in R_i$, i.e., that
$s(g_j) = t_i(g_{j, i})$. Of course we choose the $g_{j, i}$
such that $g_{j, i}$ maps to $g_{j, i'}$ under the transition mappings.
Then, by Lemmas \ref{lemma-limit-affine} and \ref{lemma-descend-opens}
we can assume the corresponding
opens $D(g_{j, i}) \subset W_i$, $j = 1, \ldots, m$
are affine and cover $W_i$.

\medskip\noindent
At this point we may apply Lemma \ref{lemma-diagram}
to conclude that the morphism
$W_i \to \text{Spec}(R_i) \to \text{Spec}(B_i)$
is an open immersion.
By Lemma \ref{lemma-quasi-affine-finite-type-over-Z}
we can write $B_i$ as a directed limit of subalgebras
$A_{i, l} \subset B_i$, $l \in L_i$
of finite type over $\mathbf{Z}$ such that $W_i$ is
identified with an open subscheme of $\text{Spec}(A_{i, l})$
for all $l \in L_i$.
Let $S_{i, l}$ be the scheme obtained by glueing
$V_i$ and $\text{Spec}(A_{i, l})$ along the open $W_i$, see
Schemes, Section \ref{schemes-section-glueing-schemes}.
Note that $S_{i, l}$ is of finite type over $\mathbf{Z}$ since
it has a finite affine open covering whose members are
spectram of finite type $\mathbf{Z}$-algebras.
We define a partial ordering on $J = \coprod_{i \in I} L_i$
by the rule $(i', l') \geq (i, l)$ if and only if
$i' \geq i$ and the map $B_i \to B_{i'}$ sends $A_{i, l}$ into
$A_{i', l'}$. This is exactly the condition needed to
define a morphism $S_{i', l'} \to S_{i, l}$: namely just glue
the transition morphism $V_{i'} \to V_i$ to the morphism
$\text{Spec}(A_{i', l'}) \to \text{Spec}(A_{i, l})$ induced
by the ring map $A_{i, l} \to A_{i', l'}$. We omit the verification
that these morphisms agree agree over $W_{i'}$ as a morphism
into $S_{i, l}$.
It is easy to show that $S$ is the directed limit
of the schemes $S_{i, l}$ as desired.
\end{proof}






\section{Limits and morphisms of finite presentation}
\label{section-finite-presentation}

\noindent
The following is a generalization of
Algebra, Lemma \ref{algebra-lemma-characterize-finite-presentation}.

\begin{proposition}
\label{proposition-characterize-locally-finite-presentation}
Let $f : X \to S$ be a morphism of schemes.
The following are equivalent:
\begin{enumerate}
\item The morphism $f$ is locally of finite presentation.
\item For any directed partially ordered set $I$, and any
inverse system $(T_i, f_{ii'})$ of $S$-schemes over $I$
with each $T_i$ affine, we have
$$
\text{Mor}_S(\text{lim}_i\ T_i, X) =
\text{colim}_i\ \text{Mor}_S(T_i, X)
$$
\item For any directed partially ordered set $I$, and any
inverse system $(T_i, f_{ii'})$ of $S$-schemes over $I$
with each $f_{ii'}$ affine and every $T_i$ quasi-compact and
quasi-separated as a scheme, we have
$$
\text{Mor}_S(\text{lim}_i\ T_i, X) =
\text{colim}_i\ \text{Mor}_S(T_i, X)
$$
\end{enumerate}
\end{proposition}

\begin{proof}
It is clear that (3) implies (2).

\medskip\noindent
Let us prove that (2) implies (1). Assume (2).
Choose any affine opens $U \subset X$ and $V \subset S$ such that
$f(U) \subset V$. We have to show that
$\mathcal{O}_S(V) \to \mathcal{O}_X(U)$ is of finite presentation.
Let $(A_i, \varphi_{ii'})$ be a directed system of
$\mathcal{O}_S(V)$-algebras. Set $A = \text{colim}_i\ A_i$.
According to
Algebra, Lemma \ref{algebra-lemma-characterize-finite-presentation}
we have to show that
$$
\text{Hom}_{\mathcal{O}_S(V)}(\mathcal{O}_X(U), A) =
\text{colim}_i\ \text{Hom}_{\mathcal{O}_S(V)}(\mathcal{O}_X(U), A_i)
$$
Consider the schemes $T_i = \text{Spec}(A_i)$. They
form an inverse system of $V$-schemes over $I$
with transition morphisms $f_{ii'} : T_i \to T_{i'}$
induced by the $\mathcal{O}_S(V)$-algebra maps $\varphi_{i'i}$.
Set $T := \text{Spec}(A) = \text{lim}_i\ T_i$.
The formula above becomes in terms of morphism sets of schemes
$$
\text{Mor}_V(\text{lim}_i\ T_i, U) =
\text{colim}_i\ \text{Mor}_V(T_i, U).
$$
We first observe that
$\text{Mor}_V(T_i, U) = \text{Mor}_S(T_i, U)$
and
$\text{Mor}_V(T, U) = \text{Mor}_S(T, U)$.
Hence we have to show that
$$
\text{Mor}_S(\text{lim}_i\ T_i, U) =
\text{colim}_i\ \text{Mor}_S(T_i, U)
$$
and we are given that
$$
\text{Mor}_S(\text{lim}_i\ T_i, X) =
\text{colim}_i\ \text{Mor}_S(T_i, X).
$$
Hence it suffices to prove that given a morphism $g_i : T_i \to X$ over $S$
such that the composition $T \to T_i \to X$ ends up in $U$ there exists some
$i' \geq i$ such that the composition $g_{i'} : T_{i'} \to T_i \to X$ ends up
in $U$. Denote $Z_{i'} = g_{i'}^{-1}(X \setminus U)$.
Assume each $Z_{i'}$ is nonempty
to get a contradiction. By Lemma \ref{lemma-limit-closed-nonempty}
there exists a point $t$ of $T$ which is mapped into $Z_{i'}$ for all
$i' \geq i$. Such a point is not mapped into $U$. A contradiction.

\medskip\noindent
Finally, let us prove that (1) implies (3). Assume (1). Let an inverse directed
system $(T_i, f_{ii'})$ of $S$-schemes be given. Assume the morphisms $f_{ii'}$
are affine and each $T_i$ is quasi-compact and quasi-separated as a scheme. Let
$T = \text{lim}_i\ T_i$. Denote $f_i : T \to T_i$ the projection morphisms.
We have to show:
\begin{enumerate}
\item[(a)] Given morphisms $g_i, g'_i : T_i \to X$ over $S$ such that
$g_i \circ f_i = g'_i \circ f_i$, then there exists an $i' \geq i$
such that $g_i \circ f_{i'i} = g'_i \circ f_{i'i}$.
\item[(b)] Given any morphism
$g : T \to X$ over $S$ there exists an $i \in I$ and a morphism
$g_i : T_i \to X$ such that $g = f_i \circ g_i$.
\end{enumerate}

\noindent
First let us prove the uniqueness part (a). Let $g_i, g'_i : T_i \to X$ be
morphisms such that $g_i \circ f_i = g'_i \circ f_i$. For any $i' \geq i$
we set $g_{i'} = g_i \circ f_{i'i}$ and $g'_{i'} = g'_i \circ f_{i'i}$.
We also set $g = g_i \circ f_i = g'_i \circ f_i$.
Consider the morphism
$(g_i, g'_i) : T_i \to X\times_S X$. Set
$$
W =
\bigcup\nolimits_{U \subset X\text{ affine open},
V \subset S\text{ affine open}, f(U) \subset V}
U \times_V U.
$$
This is an open in $X \times_S X$, with the property that the morphism
$\Delta_{X/S}$ factors through a closed immersion into $W$, see the proof
of Schemes, Lemma \ref{schemes-lemma-diagonal-immersion}.
Note that the composition
$(g_i, g'_i) \circ f_i : T \to X \times_S X$ is a morphism into $W$
because it factors through the diagonal by assumption.
Set $Z_{i'} = (g_{i'}, g'_{i'})^{-1}(X \times_S X \setminus W)$.
If each $Z_{i'}$ is nonempty, then by Lemma \ref{lemma-limit-closed-nonempty}
there exists a point $t \in T$ which maps to $Z_{i'}$ for all
$i' \geq i$. This is a contradiction with the fact that $T$ maps into $W$.
Hence we may increase $i$ and assume that $(g_i, g'_i) : T_i \to X \times_S X$
is a morphism into $W$. By construction of $W$, and since $T_i$ is
quasi-compact we can find a finite affine open covering
$T_i = T_{1, i} \cup \ldots \cup T_{n, i}$ such that
$(g_i, g'_i)|_{T_{j, i}}$ is a morphism into $U \times_V U$ for
some pair $(U, V)$ as in the definition of $W$ above.
Since it suffices to prove that $g_{i'}$ and $g'_{i'}$ agree
on each of the $f_{i'i}^{-1}(T_{j, i})$ this reduces us to the affine case.
The affine case follows from
Algebra, Lemma \ref{algebra-lemma-characterize-finite-presentation}
and the fact that the ring map
$\mathcal{O}_S(V) \to \mathcal{O}_X(U)$ is of finite presentation
(see Morphisms,
Lemma \ref{morphisms-lemma-locally-finite-presentation-characterize}).

\medskip\noindent
Finally, we prove the existence part (b).
Let $g : T \to X$ be a morphism of schemes over $S$.
We can find a finite affine open covering
$T = W_1 \cup \ldots \cup W_n$ such that for
each $j \in \{1, \ldots, n\}$ there exist affine opens
$U_j \subset X$ and $V_j \subset S$ with $f(U_j) \subset V_j$
and $g(W_j) \subset U_j$. By Lemmas \ref{lemma-descend-opens}
and \ref{lemma-limit-affine}
(after possibly shrinking $I$) we may assume that
there exist affine open coverings $T_i = W_{1, i} \cup \ldots \cup W_{n, i}$
compatible with transition maps such that $W_j = \text{lim}_i\ W_{j, i}$.
We apply Algebra, Lemma \ref{algebra-lemma-characterize-finite-presentation}
to the rings corresponding to the affine schemes $U_j$, $V_j$, $W_{j, i}$ and
$W_j$ using that $\mathcal{O}_S(V_j) \to \mathcal{O}_X(U_j)$ is of finite
presentation (see Morphisms,
Lemma \ref{morphisms-lemma-locally-finite-presentation-characterize}).
Thus we can find for each $j$ an index $i_j \in I$ and a morphism
$g_{j, i_j} : W_{j, i_j} \to X$ such that
$g_{j, i_j} \circ f_i|_{W_j} : W_j \to W_{j, i} \to X$
equals $g|_{W_j}$. By part (a) proved above, using the quasi-compactness of
$W_{j_1, i} \cap W_{j_2, i}$ which follows as $T_i$ is quasi-separated,
we can find an index $i' \in I$ larger than all $i_j$ such that
$$
g_{j_1, i_{j_1}} \circ f_{i'i_{j_1}}|_{W_{j_1, i'} \cap W_{j_2, i'}} =
g_{j_2, i_{j_2}} \circ f_{i'i_{j_2}}|_{W_{j_1, i'} \cap W_{j_2, i'}}
$$
for all $j_1, j_2 \in \{1, \ldots, n\}$. Hence the morphisms
$g_{j, i_j} \circ f_{i'i_j}|_{W_{j, i'}}$ glue to given the
desired morphism $T_{i'} \to X$.
\end{proof}







\section{Finite type closed in finite presentation}
\label{section-finite-type-closed-in-finite-presentation}

\noindent
A reference is \cite{Conrad-Nagata}.

\begin{lemma}
\label{lemma-locally-finite-type-in-finite-presentation}
Let $f : X \to S$ be a morphism of schemes.
Assume:
\begin{enumerate}
\item The morphism $f$ is locally of finite type.
\item The scheme $X$ is quasi-compact and quasi-separated.
\end{enumerate}
Then there exists a morphism of finite presentation
$f' : X' \to S$ and an immersion $X \to X'$ of schemes over $S$.
\end{lemma}

\begin{proof}
By Propostion \ref{proposition-approximate} we can write
$X = \text{lim}_i\ X_i$ with each $X_i$ of finite type over $\mathbf{Z}$ and
with transition morphisms $f_{ii'} : X_i \to X_{i'}$ affine.
Consider the commutative diagram
$$
\xymatrix{
X \ar[r] \ar[rd] & X_{i, S} \ar[r] \ar[d] & X_i \ar[d] \\
& S \ar[r] & \text{Spec}(\mathbf{Z})
}
$$
Note that $X_i$ is of finite presentation over $\text{Spec}(\mathbf{Z})$, see
Morphisms,
Lemma \ref{morphisms-lemma-noetherian-finite-type-finite-presentation}.
Hence the base change $X_{i, S} \to S$ is of finite presentation by
Morphisms, Lemma \ref{morphisms-lemma-base-change-finite-presentation}.
Thus it suffices to show that the arrow $X \to X_{i, S}$ is an
immersion for some $i$ sufficiently large.

\medskip\noindent
To do this we choose a finite affine open covering
$X = V_1 \cup \ldots \cup V_n$ such that
$f$ maps each $V_j$ into an affine open $U_j \subset S$.
Let $h_{j, a} \in \mathcal{O}_X(V_j)$ be a finite
set of elements which generate $\mathcal{O}_X(V_j)$ as
an $\mathcal{O}_S(U_j)$-algebra, see
Morphisms, Lemma \ref{morphisms-lemma-locally-finite-type-characterize}.
By Lemmas \ref{lemma-descend-opens} and \ref{lemma-limit-affine}
(after possibly shrinking $I$) we may assume that
there exist affine open coverings
$X_i = V_{1, i} \cup \ldots \cup V_{n, i}$
compatible with transition maps such that $V_j = \text{lim}_i\ V_{j, i}$.
By Lemma \ref{lemma-descend-section} we can choose $i$ so large that each
$h_{j, a}$ comes from an element
$h_{j, a, i} \in \mathcal{O}_{X_i}(V_{j, i})$.
At this point it is clear that
$$
V_j \longrightarrow U_j \times_{\text{Spec}(\mathbf{Z})} V_{j, i} =
(V_{j, i})_{U_j} \subset (V_{j, i})_S \subset X_{i, S}
$$
is a closed immersion. Since the union of the schemes which appear as
the targets of these morphisms form an open of $X_{i, S}$ we win.
\end{proof}

\begin{remark}
\label{remark-cannot-do-better}
We cannot do better than this if we do not assume
more on $S$ and the morphism $f : X \to S$.
For example, in general it will not be possible to
find a {\it closed} immersion $X \to X'$ as in the lemma.
The reason is that this would imply that $f$ is quasi-compact which
may not be the case. An example is to take $S$ to be infinite
dimensional affine space with $0$ doubled and $X$ to be one of
the two infinite dimensional affine spaces.
\end{remark}

\noindent
Here is a version with a very strong assumption that we will use later
in the proof of Chow's lemma.

\begin{lemma}
\label{lemma-quasi-projective-finite-type-over-S}
Let $f : X \to S$ be a morphism of schemes.
Assume that
\begin{enumerate}
\item the scheme $X$ has an ample invertible sheaf, and
\item the morphism $X \to S$ is locally of finite type.
\end{enumerate}
Then there exists an $n \geq 0$ and an immersion $X \to \mathbf{P}^n_S$.
\end{lemma}

\begin{proof}
Let $\mathcal{L}$ be an ample invertible sheaf on $X$.
Let $A = \bigoplus_{d \geq 0} \Gamma(X, \mathcal{L}^{\otimes d})$.
By Properties, Proposition \ref{properties-proposition-characterize-ample}
the set of affine opens $X_a$ with $a \in A_{+}$ homogeneous forms
a basis for the topology of $X$. Hence we can find finitely
many such elements $a_1, \ldots, a_n \in A_{+}$ such that
\begin{enumerate}
\item we have $X = \bigcup_{i = 1, \ldots, n} X_{a_i}$,
\item each $X_{a_i}$ is affine, and
\item each $X_{a_i}$ maps into an affine open $V_i \subset S$.
\end{enumerate}
By Morphisms, Lemma \ref{morphisms-lemma-locally-finite-type-characterize}
we see that the ring maps
$\mathcal{O}_S(V_i) \to \mathcal{O}_X(X_{a_i})$ are
of finite type. Hence we can find finitely many
elements $f_{ij} \in \mathcal{O}_X(X_{a_i})$, $j = 1, \ldots, n_i$
which generate $\mathcal{O}_X(X_{a_i})$ as an $\mathcal{O}_S(V_i)$-algebra.
By Properties, Lemma \ref{properties-lemma-invert-s-sections}
we may write each
$f_{ij}$ as $a_{ij}/a_i^{e_{ij}}$ for some
$a_{ij} \in A_{+}$ homogeneous. Let $N$ be a positive integer which
is a common multiple of all the degrees of the elements
$a_i$, $a_{ij}$. Consider the elements
$$
a_i^{N/\deg(a_i)},\ a_{ij}a_i^{(N/\deg(a_i)) - e_{ij}} \in A_N.
$$
By construction these generate the invertible sheaf
$\mathcal{L}^{\otimes N}$ over $X$. Hence they give rise
to a morphism
$$
X \longrightarrow \mathbf{P}_S^{n + \sum_{i = 1, \ldots, n} n_i - 1}
$$
over $S$, see Constructions, Lemma \ref{constructions-lemma-projective-space}
and Definition \ref{constructions-definition-projective-space}.
By construction this morphism restricted to $X_{a_i}$
gives a closed immersion of $X_{a_i}$ into the open
$D_{+}(X_i)_{V_i}$ of $\mathbf{P}^N_S$. Hence we conclude that the morphism
is an immersion.
\end{proof}

\begin{lemma}
\label{lemma-finite-type-closed-in-finite-presentation}
Let $f : X \to S$ be a morphism of schemes.
Assume:
\begin{enumerate}
\item The morphism $f$ is of locally of finite type.
\item The scheme $X$ is quasi-compact and quasi-separated, and
\item The scheme $S$ is quasi-separated.
\end{enumerate}
Then there exists a morphism of finite presentation
$f' : X' \to S$ and a closed immersion $X \to X'$ of schemes over $S$.
\end{lemma}

\begin{proof}
By Lemma \ref{lemma-locally-finite-type-in-finite-presentation} above
there exists a morphism $Y \to S$ of finite presentation and an
immersion $i : X \to Y$ of schemes over $S$.
For every point $x \in X$, there exists an affine open
$V_x \subset Y$ such that $i^{-1}(V_x) \to V_x$ is a
closed immersion. Since $X$ is quasi-compact we can find
finitely may affine opens $V_1, \ldots, V_n \subset Y$
such that $i(X) \subset V_1 \cup \ldots \cup V_n$ and
$i^{-1}(V_j) \to V_j$ is a closed immersion. In other words
such that $i : X \to X' = V_1 \cup \ldots \cup V_n$ is a
closed immersion of schemes over $S$.
Since $S$ is quasi-separated and $Y$ is quasi-separated over $S$
we deduce that $Y$ is quasi-separated, see
Schemes, Lemma \ref{schemes-lemma-separated-permanence}.
Hence the open immersion $X' = V_1 \cup \ldots \cup V_n \to Y$
is quasi-compact. This implies that
$X' \to Y$ is of finite presentation, see
Morphisms,
Lemma \ref{morphisms-lemma-quasi-compact-open-immersion-finite-presentation}.
We conclude since then $X' \to Y \to S$ is a composition of morphisms
of finite presentation, and hence of finite presentation (see
Morphisms, Lemma \ref{morphisms-lemma-composition-finite-presentation}).
\end{proof}

\begin{lemma}
\label{lemma-eventually-separated}
Let $S$ be a scheme.
Let $I$ be a directed partially ordered set.
Let $(X_i, f_{ii'})$ be an inverse system of schemes over $S$ indexed by $I$.
Assume
\begin{enumerate}
\item the scheme $S$ is quasi-separated,
\item each $X_i$ is locally of finite type over $S$,
\item all the morphisms $f_{ii'} : X_i \to X_{i'}$ are affine,
\item all the schemes $X_i$ are quasi-compact and quasi-separated,
\item the morphism $X = \text{lim}_i\ X_i \to S$ is separated.
\end{enumerate}
Then $X_i \to S$ is separated for all $i$ large enough.
\end{lemma}

\begin{proof}
Let $i_0 \in I$. Note that $I$ is nonempty as the limit is directed.
For convenience write $X_0 = X_{i_0}$ and $i_0 = 0$.
As $X_0$ is quasi-compact we can find finitely many
affine opens $U_1, \ldots, U_n \subset S$ such that
$X_0 \to S$ maps into $U_1 \cup \ldots \cup U_n$.
Denote $h_i : X_i \to S$ the structural morphism.
It suffices to check that for some $i \geq 0$ the morphisms
$h_i^{-1}(U_j) \to U_j$ are separated for all $j = 1, \ldots,  n$.
Since $S$ is quasi-separated the morphisms $U_j \to S$ are quasi-compact.
Hence $h_i^{-1}(U_j)$ is quasi-compact and quasi-separated.
In this way we reduce to the case $S$ affine.

\medskip\noindent
Assume $S$ affine. Choose a finite affine open covering
$X_0 = V_{1, 0} \cup \ldots \cup V_{m, 0}$. As usual we denote
$V_{j, i}$ the inverse image of $V_{j, 0}$ in $X_i$ for
$i \geq 0$. We also denote $V_j$ the inverse image of
$V_{j, 0}$ in $X$. By assumption the intersections
$V_{j_1, i} \cap V_{j_2, i}$ are quasi-compact opens.
Since $X$ is separated we see that $V_{j_1} \cap V_{j_2}$
is affine. Hence we see that $V_{j_1, i} \cap V_{j_2, i}$
are all affine for $i$ big enough by Lemma \ref{lemma-limit-affine}.
After increasing $i_0 = 0$ we may assume this holds for
all $i \geq 0$.
By Schemes, Lemma \ref{schemes-lemma-characterize-separated}
we have to show that for some
$i$ big enough the ring map
$$
\mathcal{O}_{X_i}(V_{j_1, i})
\otimes_{\mathcal{O}_S(S)}
\mathcal{O}_{X_i}(V_{j_2, i})
\longrightarrow
\mathcal{O}_{X_i}(V_{j_1, i} \cap V_{j_2, i})
$$
is surjective. Since $V_{j, i}$ is the inverse image of
$V_{j, 0}$ under the affine transition maps $f_{i0}$ we
see that
$$
V_{j_1, i} \cap V_{j_2, i} =
V_{j_1, i} \times_{V_{j_1, 0}} (V_{j_1, 0} \cap V_{j_2, 0})
$$
Choose generators
$x_{j_1, j_2, \alpha} \in \mathcal{O}_{X_0}(V_{j_1, 0} \cap V_{j_2, 0})$
as an algebra over $\mathcal{O}_{X_0}(V_{j_1, 0})$.
We can choose finitely many of these since
$\mathcal{O}_{X_0}(V_{j_1, 0} \cap V_{j_2, 0})$
is a finite type $\mathcal{O}_S(S)$-algebra, see
Morphisms, Lemma \ref{morphisms-lemma-locally-finite-type-characterize}.
By the displayed equality of fibre products,
the images of $x_{j_1, j_2, \alpha}$ generate
$\mathcal{O}_{X_i}(V_{j_1, i} \cap V_{j_2, i})$ as an algebra over
$\mathcal{O}_{X_i}(V_{j_1, i})$ also.
Since $X$ is separated the ring maps
$$
\mathcal{O}_{X}(V_{j_1})
\otimes_{\mathcal{O}_S(S)}
\mathcal{O}_{X}(V_{j_2, i})
\longrightarrow
\mathcal{O}_{X}(V_{j_1} \cap V_{j_2})
$$
are surjective. Hence we can find finite sums
$$
\sum y_{j_1, j_2, \alpha, \beta} \otimes z_{j_1, j_2, \alpha, \beta}
$$
in the left hand side which map to the elements
$x_{j_1, j_2, \alpha}$ of the right hand side.
Using Lemma \ref{lemma-descend-section} we may choose
$i$ large enough so that each of the (finitely many)
elements $y_{j_1, j_2, \alpha, \beta}$ (resp.\ 
$z_{j_1, j_2, \alpha, \beta}$) comes from a corresponding element
$y_{j_1, j_2, \alpha, \beta, i}$ (resp.\ 
$z_{j_1, j_2, \alpha, \beta, i}$) of
$\mathcal{O}_{X_i}(V_{j_1, i})$ (resp.\ 
$\mathcal{O}_{X_i}(V_{j_2, i})$ and moreover such that the image
of
$$
\sum y_{j_1, j_2, \alpha, \beta, i} \otimes z_{j_1, j_2, \alpha, \beta, i}
$$
is the image of the element $x_{j_1, j_2, \alpha}$
in $\mathcal{O}_{X_i}(V_{j_1, i} \cap V_{j_2, i})$.
This clearly implies the desired surjectivity and we win.
\end{proof}

\begin{remark}
\label{remark-question-finite-type-necessary}
Is there an easy example to show that the finite type condition
for the morphisms $X_i \to S$ is necessary? Email if you have
one.
\end{remark}

\noindent
A less technical version of the results above is the following.

\begin{proposition}
\label{proposition-separated-closed-in-finite-presentation}
Let $f : X \to S$ be a morphism of schemes.
Assume:
\begin{enumerate}
\item The morphism $f$ is of of finite type and separated.
\item The scheme $S$ is quasi-compact and quasi-separated.
\end{enumerate}
Then there exists a separated morphism of finite presentation
$f' : X' \to S$ and a closed immersion $X \to X'$ of schemes over $S$.
\end{proposition}

\begin{proof}
We have seen that there is a closed immersion $X \to Y$ with $Y/S$ of
finite presentation. Let $\mathcal{I} \subset \mathcal{O}_Y$
be the quasi-coherent sheaf of ideals defining $X$ as a closed
subscheme of $Y$. By
Properties, Lemma \ref{properties-lemma-quasi-coherent-colimit-finite-type} 
we can write $\mathcal{I}$ as a directed colimit
$\mathcal{I} = \text{colim}_{a \in A}\ \mathcal{I}_a$ of its
quasi-coherent sheaves of ideals of finite type.
Let $X_a \subset Y$ be the closed subscheme defined by $\mathcal{I}_a$.
These form an inverse system of schemes indexed by $A$.
The transition morphisms $X_a \to X_{a'}$ are affine because
they are closed immersions. Each $X_a$ is quasi-compact and quasi-separated
since it is a closed subscheme of $Y$ and $Y$ is quasi-compact and
quasi-separated by our assumptions.
We have $X = \text{lim}_a\ X_a$ as follows directly from the
fact that $\mathcal{I} = \text{colim}_{a \in A}\ \mathcal{I}_a$.
Each of the morphisms $X_a \to Y$ is of finite presentation, see
Morphisms, Lemma \ref{morphisms-lemma-closed-immersion-finite-presentation}.
Hence the morphisms $X_a \to S$ are of finite presentation.
Thus it suffices to show that $X_a \to S$ is separated for some
$a \in A$. This follows from Lemma \ref{lemma-eventually-separated} as we have
assumed that $X \to S$ is separated.
\end{proof}










\section{Finding suitable affine opens}
\label{section-finding-affine-opens}

\noindent
In this section we collect some results on the existence of
affine opens in more and less general situations.

\begin{lemma}
\label{lemma-maximal-points-affine}
Let $X$ be a quasi-separated scheme.
Let $Z_1, \ldots, Z_n$ be pairwise distinct irreducible components of $X$,
see Topology, Section \ref{topology-section-irreducible-components}.
Let $\eta_i \in Z_i$ be their generic points, see
Schemes, Lemma \ref{schemes-lemma-scheme-sober}.
There exist affine open neighbourhoods $\eta_i \in U_i$
such that $U_i \cap U_j = \emptyset$ for all $i \not = j$.
In particular, $U = U_1 \cup \ldots \cup U_n$ is an affine
open containing all of the points $\eta_1, \ldots, \eta_n$.
\end{lemma}

\begin{proof}
Let $V_i$ be any affine open containing $\eta_i$
and disjoint from the closed set $Z_1 \cup \ldots \hat Z_i \ldots \cup Z_n$.
Since $X$ is quasi-separated for each $i$ the union
$W_i = \bigcup_{j, j \not = i} V_i \cap V_j$ is a quasi-compact
open of $V_i$ not containing $\eta_i$. 
We can find open neighbourhoods $U_i \subset V_i$
containing $\eta_i$ and disjoint from $W_i$ by
Algebra, Lemma \ref{algebra-lemma-standard-open-containing-maximal-point}.
Finally, $U$ is affine since it is the spectrum of
the ring $R_1 \times \ldots \times R_n$ where $R_i = \mathcal{O}_X(U_i)$,
see Schemes, Lemma \ref{schemes-lemma-disjoint-union-affines}.
\end{proof}

\begin{remark}
\label{remark-maximal-points-affine}
Lemma \ref{lemma-maximal-points-affine} above is false if $X$
is not quasi-separated. Here is an example. Take
$R = \mathbf{Q}[x, y_1, y_2, \ldots]/((x-i)y_i)$.
Consider the minimal prime ideal $\mathfrak p = (y_1, y_2, \ldots)$
of $R$. Glue two copies of $\text{Spec}(R)$ along the
(not quasi-compact) open $\text{Spec}(R) \setminus V(\mathfrak p)$
to get a scheme $X$ (glueing as in
Schemes, Example \ref{schemes-example-affine-space-zero-doubled}).
Then the two maximal points of $X$ corresponding to $\mathfrak p$
are not contained in a common affine open. The reason is
that any open of $\text{Spec}(R)$ containing $\mathfrak p$
contains infinitely many of the ``lines'' $x = i$, $y_j = 0$,
$j \not = i$ with parameter $y_i$. Details omitted.
\end{remark}

\noindent
Here is a slight refinement of the lemma above.

\begin{lemma}
\label{lemma-point-and-maximal-points-affine}
Let $X$ be a quasi-separated scheme. Let $Z_1, \ldots, Z_n$ be pairwise
distinct irreducible components of $X$. Let $\eta_i \in Z_i$ be their
generic points. Let $x \in X$ be arbitrary.
There exists an affine open $U \subset X$ containing
$x$ and all the $\eta_i$.
\end{lemma}

\begin{proof}
Suppose that $x \in Z_1 \cap \ldots \cap Z_r$ and
$x \not \in Z_{r + 1}, \ldots, Z_n$. Then we may choose
an affine open $W \subset X$ such that
$x \in W$ and $W \cap Z_i = \emptyset$ for
$i = r + 1, \ldots, n$. Note that clearly $\eta_i \in W$
for $i = 1, \ldots, r$. By Lemma \ref{lemma-maximal-points-affine}
we may choose affine opens $U_i \subset X$ which are pairwise
disjoint such that $\eta_i \in U_i$ for $i = r + 1, \ldots, n$.
Since $X$ is quasi-separated the opens $W \cap U_i$
are quasi-compact and do not contain $\eta_i$ for
$i = r + 1, \ldots, n$. Hence by
Algebra, Lemma \ref{algebra-lemma-standard-open-containing-maximal-point}
we may shrink $U_i$ such that $W \cap U_i = \emptyset$
for $i = r + 1, \ldots, n$. Then the union
$U = W \cup \bigcup_{i = r + 1, \ldots, n} U_i$ is disjoint and hence
(by Schemes, Lemma \ref{schemes-lemma-disjoint-union-affines})
a suitable affine open.
\end{proof}

\begin{lemma}
\label{lemma-ample-finite-set-in-affine}
Let $X$ be a scheme. Assume either
\begin{enumerate}
\item The scheme $X$ is quasi-affine.
\item The scheme $X$ is isomorphic to an open subscheme of an affine scheme.
\item There exists an ample invertible sheaf on $X$.
\item The scheme $X$ is isomorphic to an open subscheme
of $\text{Proj}(S)$ for some graded ring $S$.
\end{enumerate}
Then for any finite subset $E \subset X$ there exists an
affine open $U \subset X$ with $E \subset U$.
\end{lemma}

\begin{proof}
By Properties, Definition \ref{properties-definition-quasi-affine}
a quasi-affine scheme is a quasi-compact open subscheme
of an affine scheme. Any affine scheme $\text{Spec}(R)$ is isomorphic to
$\text{Proj}(R[X])$ where $R[X]$ is graded by setting $\deg(X) = 1$.
By Properties, Proposition \ref{properties-proposition-characterize-ample}
if $X$ has an ample invertible sheaf then $X$ is isomorphic to an open
subscheme of $\text{Proj}(S)$ for some graded ring $S$.
Hence, it suffices to prove the lemma in case (4).
Thus assume $X \subset \text{Proj}(S)$ is an open subscheme
where $S$ is some graded ring. Since $E$ is finite we may assume
$E \subset D_{+}(f_1) \cup \ldots \cup D_{+}(f_n) \subset X$
for some finite number of homogeneous elements $f_i \in S_{+}$.
Suppose that $E = \{\mathfrak p_1, \ldots, \mathfrak p_m\}$
as a subset of $\text{Proj}(S)$.
Consider the ideal $I = (f_1, \ldots, f_n) \subset S$.
Since $I \not \subset \mathfrak p_j$ for all $j = 1, \ldots, m$
we see from Algebra, Lemma \ref{algebra-lemma-graded-silly} that
there exists a homogeneous element $f \in I$, $f \not \in \mathfrak p_j$
for all $j = 1, \ldots, m$. Then $E \subset D_{+}(f) \subset
D_{+}(f_1) \cup \ldots \cup D_{+}(f_n)$ is an affine open as desired.
\end{proof}











\section{Chow's Lemma}
\label{section-chows-lemma}

\noindent
In this section we prove a number of variants of Chow's lemma.
The most interesting of which is probably just the Noetherian
case (Lemma \ref{lemma-chow-Noetherian} below).

\begin{lemma}
\label{lemma-chow-Noetherian}
Let $S$ be a Noetherian scheme.
Let $f : X \to S$ be a separated morphism of finite type.
Then there exists an $n \geq 0$ and a diagram
$$
\xymatrix{
X \ar[rd] & X' \ar[d] \ar[l]^\pi \ar[r] & \mathbf{P}^n_S \ar[dl] \\
& S &
}
$$
where $X' \to \mathbf{P}^n_S$ is an immersion, and
$\pi : X' \to X$ is proper and surjective. Moreover, we may
arrange it such that there exists a dense open subscheme
$U \subset X$ such that $\pi^{-1}(U) \to U$ is an isomorphism.
\end{lemma}

\begin{proof}
All of the schemes we will encounter during the rest of the proof
are going to be of finite type over the Noetherian scheme $S$ and
hence Noetherian
(see Morphisms, Lemma \ref{morphisms-lemma-finite-type-noetherian}).
All morphisms between them will automatically be quasi-compact and
separated, see Properties,
Lemmas \ref{properties-lemma-locally-Noetherian-quasi-separated} and
\ref{properties-lemma-morphism-Noetherian-schemes-quasi-compact}.

\medskip\noindent
The underlying topological space of $X$ is Noetherian
(see Properties, Lemma \ref{properties-lemma-Noetherian-topology})
and we conclude that $X$ has only finitely many irreducible components
(see Topology, Lemma \ref{topology-lemma-Noetherian}).
Say $X = X_1 \cup \ldots \cup X_r$ is the decomposition
of $X$ into irreducible components.
Let $\eta_i \in X_i$ be the generic point.
For every point $x \in X$ there exists an affine open
$U_x \subset X$ which contains $x$ and each of the generic
points $\eta_i$. See Lemma \ref{lemma-point-and-maximal-points-affine}. 
Since $X$ is quasi-compact, we can find a finite affine open
covering $X = U_1 \cup \ldots \cup U_m$ such that
each $U_i$ contains $\eta_1, \ldots, \eta_r$.
In particular we conclude that the open
$U = U_1 \cap \ldots \cap U_m \subset X$ is
a dense open. This and the fact that the $U_i$ are affine opens
covering $X$ is all that we will use below.

\medskip\noindent
Let $X^* \subset X$ be the scheme theoretic closure of $U \to X$, see
Morphisms, Definition \ref{morphisms-definition-scheme-theoretic-image}.
Let $U_i^* = X^* \cap U_i$. Note that $U_i^*$ is a closed subscheme
of $U_i$. Hence $U_i^*$ is affine. Since $U$ is dense in $X$ the
morphism $X^* \to X$ is a surjective closed immersion. It is an
isomorphism over $U$. Hence we may replace $X$ by $X^*$ and
$U_i$ by $U_i^*$ and assume that $U$ is scheme theoretically dense
in $X$, see
Morphisms, Definition \ref{morphisms-definition-scheme-theoretically-dense}.

\medskip\noindent
By Lemma \ref{lemma-quasi-projective-finite-type-over-S}
we can find an immersion $j_i : U_i \to \mathbf{P}_S^{n_i}$
for each $i$. By
Morphisms, Lemma \ref{morphisms-lemma-quasi-compact-immersion} we can find
closed subschemes $Z_i \subset \mathbf{P}_S^{n_i}$
such that $j_i : U_i \to Z_i$ is a dense and scheme theoretically
dense open immersion. Consider the morphism
$$
j = (j_1|_U, \ldots, j_n|_U) : U \longrightarrow
\mathbf{P}_S^{n_1} \times_S \ldots \times_S \mathbf{P}_S^{n_n}.
$$
By the lemma cited above we can find a closed subscheme
$Z$ of $\mathbf{P}_S^{n_1} \times_S \ldots \times_S \mathbf{P}_S^{n_n}$
such that $j : U \to Z$ is an open immersion and such that $U$
is dense and scheme theoretically dense in $Z$. Consider the $i$th
projection
$$
\text{pr}_i|_{Z_i} : Z \longrightarrow \mathbf{P}^{n_i}_S.
$$
This morphism factors through $Z_i$ (see Morphisms,
Lemma \ref{morphisms-lemma-factor-factor}). Denote $p_i : Z \to Z_i$
the induced morphism.
Thus $U \subset U_i \subset Z_i$ are dense and scheme theoretically
dense open immersions. Moreover, we can think of $Z$ as the
scheme theoretic image of the ``diagonal'' morphism
$U \to Z_1 \times_S \ldots \times_S Z_n$.

\medskip\noindent
Set $V_i = p_i^{-1}(U_i)$. Set $X' = V_1 \cup \ldots \cup V_n$.
By construction $X'$ has an immersion into the scheme
$\mathbf{P}^{n_1}_S \times_S \ldots \times_S \mathbf{P}^{n_n}_S$.
Thus by (insert future reference here) we see that $X'$ has
an immersion into a projective space over $S$.

\medskip\noindent
We claim that the morphisms $p_i|_{V_i} \to U_i$ glue to a morphism
$X' \to X$. Namely, it is clear that $p_i|_U$ is the identity map
from $U$ to $U$. Since $U \subset X'$ is scheme theoretically
dense by construction, it is also scheme theoretically dense
in the open subscheme $V_i \cap V_j$. Thus we see that
$p_i|_{V_i \cap V_j} = p_j|_{V_i \cap V_j}$ as morphisms into the
separated $S$-scheme $X$, see
Morphisms, Lemma \ref{morphisms-lemma-equality-of-morphisms}.
We denote the resulting morphism $\pi : X' \to X$.

\medskip\noindent
Note that $p_i$ is the composition of a closed immersion and
the projection morphism
$Z_1 \times_S \ldots \times_S Z_n \to Z_i$. Hence $p_i$ is proper (see
Morphisms, Section \ref{morphisms-section-proper}).
In particular, $V_i \to U_i$ is proper. Consider the diagram
$$
\xymatrix{
V_i \ar[r] \ar[rd] &
Z_1 \times_S \ldots \times_S
V_i \times_S \ldots \times_S Z_n \ar[d] \\
& U_i
}
$$
The top horizontal arrow is an immersion
(for example by Schemes, Lemma \ref{schemes-lemma-section-immersion}).
Since $V_i \to U_i$ is proper, it is a closed immersion, see
Morphisms, Lemma \ref{morphisms-lemma-image-proper-scheme-closed}
and Schemes, Lemma \ref{schemes-lemma-immersion-when-closed}.
Since taking scheme theoretic image commutes with restriction
to open subsets (see
Morphisms, Lemma \ref{morphisms-lemma-quasi-compact-scheme-theoretic-image})
we conclude that
$$
V_i =
Z \cap
(Z_1 \times_S \ldots \times_S V_i \times_S \ldots \times_S Z_n)
$$
in other words $V_i = \pi^{-1}(U_i)$. This shows that
$\pi^{-1}(U_i) \to U_i$ is identified with the proper morphism
$V_i \to U_i$. Hence we see that $X$ has a
finite affine covering $X = \bigcup U_i$ such that the restriction
of $\pi$ is proper on each member of the covering.
Thus by Morphisms, Lemma \ref{morphisms-lemma-proper-local-on-the-base}
we see that $\pi$ is proper.

\medskip\noindent
To see that $\pi^{-1}(U) = U$ we argue in the same way using the diagram
$$
\xymatrix{
U \ar[r] \ar[rd] &
p_1^{-1}(U) \times_S \ldots \times_S p_n^{-1}(U) \ar[d] \\
& U
}
$$
This proves the final statement of the lemma.
\end{proof}





















\input{chapters}

\bibliography{my}
\bibliographystyle{alpha}

\end{document}
