\input{preamble}

% OK, start here.
%
\begin{document}

\title{Quot and Hilbert Spaces}

\maketitle

\phantomsection
\label{section-phantom}

\tableofcontents




\section{Introduction}
\label{section-introduction}

\noindent
The purpose of this chapter is to write about Quot and Hilbert functors
and to prove that these are algebraic spaces provided certain technical
conditions are satisfied. In this chapter we will discuss this in the
setting of algebraic space. A reference is Grothendieck's lectures, see
\cite{Gr-I},
\cite{Gr-II},
\cite{Gr-III},
\cite{Gr-IV},
\cite{Gr-V}, and
\cite{Gr-VI}.
Another reference is the paper \cite{olsson-starr}; this paper discusses
the more general case of Quot and Hilbert spaces associated to a morphism
of algebraic stacks which we will discuss in another chapter, see
(insert future reference here).

\medskip\noindent
In the case of Hilbert spaces there is a more general notion of
``Hilbert stacks'' which we will discuss in a separate chapter, see
(insert future reference here).



\section{Conventions}
\label{section-conventions}

\noindent
The standing assumption is that all schemes are contained in
a big fppf site $\Sch_{fppf}$. And all rings $A$ considered
have the property that $\Spec(A)$ is (isomorphic) to an
object of this big site.

\medskip\noindent
Let $S$ be a scheme and let $X$ be an algebraic space over $S$.
In this chapter and the following we will write $X \times_S X$
for the product of $X$ with itself (in the category of algebraic
spaces over $S$), instead of $X \times X$.



\section{When is a morphism an isomorphism?}
\label{section-when-isomorphism}

\noindent
More generally we can ask:
``When does a morphism have property $\mathcal{P}$?''
A more precise question is the following. Suppose given a commutative diagram
$$
\xymatrix{
X \ar[rr]_f \ar[rd]_p & & Y \ar[ld]^q \\
& Z
}
$$
of algebraic spaces. Does there exist a monomorphism of algebraic spaces
$W \to Z$ with the following two properties:
\begin{enumerate}
\item the base change $f_W : X_W \to Y_W$ has property $\mathcal{P}$, and
\item any morphism $Z' \to Z$ of algebraic spaces factors through $W$ if
and only if the base change $f_{Z'} : X_{Z'} \to Y_{Z'}$ has property
$\mathcal{P}$.
\end{enumerate}
In many cases, if $W \to Z$ exists, then it is an immersion, open immersion,
or closed immersion.

\medskip\noindent
The answer to this question may depend on auxiliary properties of the
morphisms $f$, $p$, and $q$. An example is $\mathcal{P}(f) =$``$f$ is flat''
which we have discussed for morphisms of schemes in the case $Y = S$ in
great detail in the chapter ``More on Flatness'', starting with
More on Flatness, Section \ref{flat-section-flattening-functors}.

\begin{lemma}
\label{lemma-where-unramified}
Consider a commutative diagram
$$
\xymatrix{
X \ar[rr]_f \ar[rd]_p & & Y \ar[ld]^q \\
& Z
}
$$
of algebraic spaces. Assume that $p$ is locally of finite type and closed.
Then there exists an open subspace $W \subset Z$
such that a morphism $Z' \to Z$ factors through $W$ if and only if the
base change $f_{Z'} : X_{Z'} \to Y_{Z'}$ is unramified.
\end{lemma}

\begin{proof}
By
Morphisms of Spaces, Lemma \ref{spaces-morphisms-lemma-where-unramified}
there exists an open subspace $U(f) \subset X$ which is the set of
points where $f$ is unramified. Moreover, formation of $U(f)$ commutes
with arbitrary base change. Let $W \subset Z$ be the open subspace
(see
Properties of Spaces, Lemma
\ref{spaces-properties-lemma-open-subspaces})
with underlying set of points
$$
|W| = |Z| \setminus |p|\left(|X| \setminus |U(f)|\right)
$$
i.e., $z \in |Z|$ is a point of $W$ if and only if $f$ is unramified
at every point of $X$ above $z$. Note that this is open because we
assumed that $p$ is closed. Since the formation of $U(f)$
commutes with arbitrary base change we immediately see (using
Properties of Spaces, Lemma
\ref{spaces-properties-lemma-factor-through-open-subspace})
that $W$ has the desired universal property.
\end{proof}

\begin{lemma}
\label{lemma-where-unramified-universally-injective}
Consider a commutative diagram
$$
\xymatrix{
X \ar[rr]_f \ar[rd]_p & & Y \ar[ld]^q \\
& Z
}
$$
of algebraic spaces. Assume that
\begin{enumerate}
\item $p$ is locally of finite type,
\item $p$ is closed, and
\item $p_2 : X \times_Y X \to Z$ is closed.
\end{enumerate}
Then there exists an open subspace $W \subset Z$
such that a morphism $Z' \to Z$ factors through $W$ if and only if the
base change $f_{Z'} : X_{Z'} \to Y_{Z'}$ is unramified and universally
injective.
\end{lemma}

\begin{proof}
After replacing $Z$ by the open subspace found in
Lemma \ref{lemma-where-unramified}
we may assume that $f$ is already unramified; note that this does not
destroy assumption (2) or (3). By
Morphisms of Spaces, Lemma
\ref{spaces-morphisms-lemma-diagonal-unramified-morphism}
we see that $\Delta_{X/Y} : X \to X \times_Y X$ is an open immersion.
This remains true after any base change. Hence by
Morphisms of Spaces, Lemma
\ref{spaces-morphisms-lemma-universally-injective}
we see that $f_{Z'}$ is universally injective if and only if
the base change of the diagonal $X_{Z'} \to (X \times_Y X)_{Z'}$
is an isomorphism. Let $W \subset Z$ be the open subspace
(see
Properties of Spaces, Lemma
\ref{spaces-properties-lemma-open-subspaces})
with underlying set of points
$$
|W| = |Z| \setminus
|p_2|\left(|X \times_Y X| \setminus \text{Im}(|\Delta_{X/Y}|)\right)
$$
i.e., $z \in |Z|$ is a point of $W$ if and only if the fibre of
$|X \times_Y X| \to |Z|$ over $z$ is in the image of
$|X| \to |X \times_Y X|$. Then it is clear from the discussion above
that the restriction $p^{-1}(W) \to q^{-1}(W)$ of $f$ is
unramified and universally injective.

\medskip\noindent
Conversely, suppose that $f_{Z'}$ is unramified and universally injective.
In order to show that $Z' \to Z$ factors through $W$ it suffices to show
that $|Z'| \to |Z|$ has image contained in $|W|$, see
Properties of Spaces, Lemma
\ref{spaces-properties-lemma-factor-through-open-subspace}.
Hence it suffices to prove the result when $Z'$ is the spectrum of a field.
Denote $z \in |Z|$ the image of $|Z'| \to |Z|$. The discussion above shows
that
$$
|X_{Z'}| \longrightarrow |(X \times_Y X)_{Z'}|
$$
is surjective. By
Properties of Spaces,
Lemma \ref{spaces-properties-lemma-points-cartesian}
in the commutative diagram
$$
\xymatrix{
|X_{Z'}| \ar[d] \ar[r] &
|(X \times_Y X)_{Z'}| \ar[d] \\
|p|^{-1}(\{z\}) \ar[r] &
|p_2|^{-1}(\{z\})
}
$$
the vertical arrows are surjective. It follows that $z \in |W|$ as desired.
\end{proof}

\begin{lemma}
\label{lemma-where-closed-immersion}
Consider a commutative diagram
$$
\xymatrix{
X \ar[rr]_f \ar[rd]_p & & Y \ar[ld]^q \\
& Z
}
$$
of algebraic spaces. Assume that
\begin{enumerate}
\item $p$ is locally of finite type,
\item $p$ is universally closed, and
\item $q : Y \to Z$ is separated.
\end{enumerate}
Then there exists an open subspace $W \subset Z$
such that a morphism $Z' \to Z$ factors through $W$ if and only if the
base change $f_{Z'} : X_{Z'} \to Y_{Z'}$ is a closed immersion.
\end{lemma}

\begin{proof}
We will use the characterization of closed immersions as
universally closed, unramified, and universally injective morphisms, see
More on Morphisms of Spaces, Lemma
\ref{spaces-more-morphisms-lemma-characterize-closed-immersion}.
First, note that since $p$ is universally closed and $q$ is
separated, we see that $f$ is universally closed, see
Morphisms of Spaces, Lemma
\ref{spaces-morphisms-lemma-universally-closed-permanence}.
It follows that any base change of $f$ is universally closed, see
Morphisms of Spaces, Lemma
\ref{spaces-morphisms-lemma-base-change-universally-closed}.
Thus to finish the proof of the lemma it suffices to prove that
the assumptions of
Lemma \ref{lemma-where-unramified-universally-injective}
are satisfied. The projection $\text{pr}_0 : X \times_Y X \to X$
is universally closed as a base change of $f$, see
Morphisms of Spaces, Lemma
\ref{spaces-morphisms-lemma-base-change-universally-closed}.
Hence $X \times_Y X \to Z$ is universally closed as
a composition of universally closed morphisms (see
Morphisms of Spaces, Lemma
\ref{spaces-morphisms-lemma-composition-universally-closed}).
This finishes the proof of the lemma.
\end{proof}

\begin{lemma}
\label{lemma-where-flat}
Consider a commutative diagram
$$
\xymatrix{
X \ar[rr]_f \ar[rd]_p & & Y \ar[ld]^q \\
& Z
}
$$
of algebraic spaces. Assume that
\begin{enumerate}
\item $p$ is locally of finite presentation,
\item $p$ is flat,
\item $p$ is closed, and
\item $q$ is locally of finite type.
\end{enumerate}
Then there exists an open subspace $W \subset Z$
such that a morphism $Z' \to Z$ factors through $W$ if and only if the
base change $f_{Z'} : X_{Z'} \to Y_{Z'}$ is flat.
\end{lemma}

\begin{proof}
By
More on Morphisms of Spaces, Lemma
\ref{spaces-more-morphisms-lemma-base-change-flatness-fibres}
the set
$$
A = \{x \in |X| : X\text{ flat at }x \text{ over }Y\}.
$$
is open in $|X|$ and its formation commutes with arbitrary base
change. Let $W \subset Z$ be the open subspace
(see
Properties of Spaces, Lemma
\ref{spaces-properties-lemma-open-subspaces})
with underlying set of points
$$
|W| = |Z| \setminus |p|\left(|X| \setminus A\right)
$$
i.e., $z \in |Z|$ is a point of $W$ if and only if the whole fibre
of $|X| \to |Z|$ over $z$ is contained in $A$. This is open because
$p$ is closed. Since the formation of $A$ commutes with arbitrary
base change it follows that $W$ works.
\end{proof}

\begin{lemma}
\label{lemma-where-surjective-flat}
Consider a commutative diagram
$$
\xymatrix{
X \ar[rr]_f \ar[rd]_p & & Y \ar[ld]^q \\
& Z
}
$$
of algebraic spaces. Assume that
\begin{enumerate}
\item $p$ is locally of finite presentation,
\item $p$ is flat,
\item $p$ is closed,
\item $q$ is locally of finite type, and
\item $q$ is closed.
\end{enumerate}
Then there exists an open subspace $W \subset Z$
such that a morphism $Z' \to Z$ factors through $W$ if and only if the
base change $f_{Z'} : X_{Z'} \to Y_{Z'}$ is surjective and flat.
\end{lemma}

\begin{proof}
By
Lemma \ref{lemma-where-flat}
we may assume that $f$ is flat.
Note that $f$ is locally of finite presentation by
Morphisms of Spaces,
Lemma \ref{spaces-morphisms-lemma-finite-presentation-permanence}.
Hence $f$ is open, see
Morphisms of Spaces, Lemma \ref{spaces-morphisms-lemma-fppf-open}.
Let $W \subset Z$ be the open subspace (see
Properties of Spaces, Lemma
\ref{spaces-properties-lemma-open-subspaces})
with underlying set of points
$$
|W| = |Z| \setminus |q|\left(|Y| \setminus |f|(|X|)\right).
$$
in other words for $z \in |Z|$ we have $z \in |W|$ if and only
if the whole fibre of $|Y| \to |Z|$ over $z$ is in the image of
$|X| \to |Y|$. Since $q$ is closed this set is open in $|Z|$.
The morphism $X_W \to Y_W$ is surjective by construction.
Finally, suppose that $X_{Z'} \to Y_{Z'}$ is surjective.
In order to show that $Z' \to Z$ factors through $W$ it suffices to show
that $|Z'| \to |Z|$ has image contained in $|W|$, see
Properties of Spaces, Lemma
\ref{spaces-properties-lemma-factor-through-open-subspace}.
Hence it suffices to prove the result when $Z'$ is the spectrum of a field.
Denote $z \in |Z|$ the image of $|Z'| \to |Z|$. By
Properties of Spaces,
Lemma \ref{spaces-properties-lemma-points-cartesian}
in the commutative diagram
$$
\xymatrix{
|X_{Z'}| \ar[d] \ar[r] &
|Y_{Z'}| \ar[d] \\
|p|^{-1}(\{z\}) \ar[r] &
|q|^{-1}(\{z\})
}
$$
the vertical arrows are surjective. It follows that $z \in |W|$ as desired.
\end{proof}

\begin{lemma}
\label{lemma-where-isomorphism}
Consider a commutative diagram
$$
\xymatrix{
X \ar[rr]_f \ar[rd]_p & & Y \ar[ld]^q \\
& Z
}
$$
of algebraic spaces. Assume that
\begin{enumerate}
\item $p$ is locally of finite presentation,
\item $p$ is flat,
\item $p$ is universally closed,
\item $q$ is locally of finite type,
\item $q$ is closed, and
\item $q$ is separated.
\end{enumerate}
Then there exists an open subspace $W \subset Z$
such that a morphism $Z' \to Z$ factors through $W$ if and only if the
base change $f_{Z'} : X_{Z'} \to Y_{Z'}$ is an isomorphism.
\end{lemma}

\begin{proof}
By
Lemma \ref{lemma-where-surjective-flat}
there exists an open subspace $W_1 \subset Z$ such that
$f_{Z'}$ is surjective and flat if and only if $Z' \to Z$
factors through $W_1$. By
Lemma \ref{lemma-where-closed-immersion}
there exists an open subspace $W_2 \subset Z$ such that
$f_{Z'}$ is a closed immersion if and only if $Z' \to Z$
factors through $W_2$. We claim that $W = W_1 \cap W_2$ works.
Certainly, if $f_{Z'}$ is an isomorphism, then $Z' \to Z$
factors through $W$. Hence it suffices to show that
$f_W$ is an isomorphism. By construction $f_W$ is a
surjective flat closed immersion. In particular $f_W$ is
representable. Since a surjective flat closed immersion of
schemes is an isomorphism (see
Morphisms, Lemma \ref{morphisms-lemma-characterize-flat-closed-immersions})
we win. (Note that actually $f_W$ is locally of finite presentation,
whence open, so you can avoid the use of this lemma if you like.)
\end{proof}

\begin{lemma}
\label{lemma-where-lci}
Consider a commutative diagram
$$
\xymatrix{
X \ar[rr]_f \ar[rd]_p & & Y \ar[ld]^q \\
& Z
}
$$
of algebraic spaces. Assume that
\begin{enumerate}
\item $p$ is flat and locally of finite presentation,
\item $p$ is closed, and
\item $q$ is flat and locally of finite presentation,
\end{enumerate}
Then there exists an open subspace $W \subset Z$
such that a morphism $Z' \to Z$ factors through $W$ if and only if the
base change $f_{Z'} : X_{Z'} \to Y_{Z'}$ is a local complete intersection
morphism.
\end{lemma}

\begin{proof}
By
More on Morphisms of Spaces,
Lemma \ref{spaces-more-morphisms-lemma-base-change-lci-fibres}
there exists an open subspace $U(f) \subset X$ which is the set of
points where $f$ is Koszul. Moreover, formation of $U(f)$ commutes
with arbitrary base change. Let $W \subset Z$ be the open subspace
(see
Properties of Spaces, Lemma
\ref{spaces-properties-lemma-open-subspaces})
with underlying set of points
$$
|W| = |Z| \setminus |p|\left(|X| \setminus |U(f)|\right)
$$
i.e., $z \in |Z|$ is a point of $W$ if and only if $f$ is Koszul
at every point of $X$ above $z$. Note that this is open because we
assumed that $p$ is closed. Since the formation of $U(f)$
commutes with arbitrary base change we immediately see (using
Properties of Spaces, Lemma
\ref{spaces-properties-lemma-factor-through-open-subspace})
that $W$ has the desired universal property.
\end{proof}



\section{An auxiliary functor}
\label{section-F-zero}

\noindent
This section is the analogue of
More on Flatness, Section \ref{flat-section-flattening-functors}.

\begin{situation}
\label{situation-iso}
Let $S$ be a scheme.
Let $f : X \to B$ be a morphism of algebraic spaces over $S$.
Let $u : \mathcal{F} \to \mathcal{G}$ be a homomorphism of
quasi-coherent $\mathcal{O}_X$-modules. For any scheme $T$ over
$B$ we will denote $u_T : \mathcal{F}_T \to \mathcal{G}_T$ the
base change of $u$ to $T$, in other words, $u_T$ is the pullback
of $u$ via the projection morphism $X_T = X \times_B T \to X$.
In this situation we can consider the functor
\begin{equation}
\label{equation-iso}
F_{iso} : (\Sch/B)^{opp} \longrightarrow \textit{Sets}, \quad
T \longrightarrow \left\{
\begin{matrix}
\{*\} & \text{if }u_T\text{ is an isomorphism}, \\
\emptyset & \text{else.}
\end{matrix}
\right.
\end{equation}
There are variants $F_{inj}$, $F_{surj}$, $F_{zero}$ where we ask that
$u_T$ is injective, surjective, or zero.
\end{situation}

\begin{lemma}
\label{lemma-iso-sheaf}
In Situation \ref{situation-iso}.
Each of the functors $F_{iso}$, $F_{inj}$, $F_{surj}$, $F_{zero}$
satisfies the sheaf property for the fpqc topology.
\end{lemma}

\begin{proof}
Let $\{T_i \to T\}_{i \in I}$ be an fpqc covering of schemes over $B$.
Set $X_i = X_{T_i} = X \times_S T_i$ and $u_i = u_{T_i}$.
Note that $\{X_i \to X_T\}_{i \in I}$ is an fpqc covering of $X_T$, see
Topologies on Spaces, Lemma \ref{spaces-topologies-lemma-fpqc}.
In particular, for every $x \in |X_T|$ there exists an $i \in I$
and an $x_i \in |X_i|$ mapping to $x$. Since
$\mathcal{O}_{X_T, \overline{x}} \to \mathcal{O}_{X_i, \overline{x_i}}$
is flat, hence faithfully flat (see 
Morphisms of Spaces, Section \ref{spaces-morphisms-section-flat}).
we conclude that $(u_i)_{x_i}$ is injective, surjective, bijective, or zero
if and only if $(u_T)_x$ is injective, surjective, bijective, or zero.
The lemma follows.
\end{proof}

\begin{lemma}
\label{lemma-iso-go-up}
In Situation \ref{situation-iso} let $X' \to X$ be a flat morphism
of algebraic spaces. Denote $u' : \mathcal{F}' \to \mathcal{G}'$
the pullback of $u$ to $X'$. Denote $F'_{iso}$, $F'_{inj}$, $F'_{surj}$,
$F'_{zero}$ the functors on $\Sch/B$ associated to $u'$.
\begin{enumerate}
\item If $\mathcal{G}$ is of finite type and the image of $|X'| \to |X|$
contains the support of $\mathcal{G}$, then $F_{surj} = F'_{surj}$
and $F_{zero} = F'_{zero}$.
\item If $\mathcal{F}$ is of finite type and the image of $|X'| \to |X|$
contains the support of $\mathcal{F}$, then $F_{inj} = F'_{inj}$
and $F_{zero} = F'_{zero}$.
\item If $\mathcal{F}$ and $\mathcal{G}$ are of finite type and the
$|X'| \to |X|$ contains the supports of $\mathcal{F}$ and $\mathcal{G}$,
then $F_{iso} = F'_{iso}$.
\end{enumerate}
\end{lemma}

\begin{proof}
let $v : \mathcal{H} \to \mathcal{E}$ be a map of quasi-coherent
modules on an algebraic space $Y$ and let $\varphi : Y' \to Y$ be a
surjective flat morphism of algebraic spaces, then $v$ is
an isomorphism, injective, surjective, or zero if and only if $\varphi^*v$ is
an isomorphism, injective, surjective, or zero. Namely,
for every $y \in |Y|$ there exists a $y' \in |Y'|$ and the map
of local rings
$\mathcal{O}_{Y, \overline{y}} \to \mathcal{O}_{Y', \overline{y'}}$
is faithfully flat (see
Morphisms of Spaces, Section \ref{spaces-morphisms-section-flat}).
Of course, to check for injectivity or being zero it suffices to look
at the points in the support of $\mathcal{H}$, and to check for
surjectivity it suffices to look at points in the support of $\mathcal{E}$.
Moreover, under the finite type assumptions as in the statement of
the lemma, taking the supports commutes with base change, see
Morphisms of Spaces, Lemma \ref{spaces-morphisms-lemma-support-finite-type}.
Thus the lemma is clear.
\end{proof}

\noindent
Recall that we've defined the scheme theoretic support of a finite
type quasi-coherent module in Morphisms of Spaces, Definition
\ref{spaces-morphisms-definition-scheme-theoretic-support}.

\begin{lemma}
\label{lemma-iso-limits}
In Situation \ref{situation-iso}.
\begin{enumerate}
\item If $\mathcal{G}$ is of finite type and the scheme theoretic support
of $\mathcal{G}$ is quasi-compact over $B$, then $F_{surj}$ is limit
preserving.
\item If $\mathcal{F}$ of finite type and the scheme theoretic support
of $\mathcal{F}$ is quasi-compact over $B$, then
$F_{zero}$ is limit preserving.
\item If $\mathcal{F}$ is of finite type,
$\mathcal{G}$ is of finite presentation, and the
scheme theoretic supports of $\mathcal{F}$ and $\mathcal{G}$ are
quasi-compact over $B$, then $F_{iso}$ is limit preserving.
\end{enumerate}
\end{lemma}

\begin{proof}
Proof of (1). Let $i : Z \to X$ be the scheme theoretic support of
$\mathcal{G}$ and think of $\mathcal{G}$ as a finite type quasi-coherent
module on $Z$. We may replace $X$ by $Z$ and $u$ by the map
$i^*\mathcal{F} \to \mathcal{G}$ (details omitted). Hence we may assume
$f$ is quasi-compact and $\mathcal{G}$ of finite type.
Let $T = \lim_{i \in I} T_i$ be a directed limit of affine $B$-schemes
and assume that $u_T$ is surjective.
Set $X_i = X_{T_i} = X \times_S T_i$ and
$u_i = u_{T_i} : \mathcal{F}_i = \mathcal{F}_{T_i}
\to \mathcal{G}_i = \mathcal{G}_{T_i}$.
To prove part (2) we have to show that $u_i$ is surjective for some $i$.
Pick $0 \in I$ and replace $I$ by $\{i \mid i \geq 0\}$.
Since $f$ is quasi-compact the scheme $X_0$ is quasi-compact.
Hence we may choose a surjective \'etale morphism $\varphi_0 : W_0 \to X_0$
where $W_0$ is an affine scheme. Set $W = W_0 \times_{T_0} T$
and $W_i = W_0 \times_{T_0} T_i$ for $i \geq 0$.  These
are affine schemes endowed
with a surjective \'etale morphisms $\varphi : W \to X_T$ and
$\varphi_i : W_i \to X_i$. Note that $W = \lim W_i$.
Hence $\varphi^*u_T$ is surjective and it suffices to prove that
$\varphi_i^*u_i$ is surjective for some $i$. Thus we have reduced
the problem to the affine case which is
Algebra, Lemma \ref{algebra-lemma-module-map-property-in-colimit} part (2).

\medskip\noindent
Proof of (2). Assume $\mathcal{F}$ is of finite type with scheme theoretic
support $Z \subset B$ quasi-compact over $B$. Let $T = \lim_{i \in I} T_i$
be a directed limit of affine $B$-schemes and assume that $u_T$ is zero.
Set $X_i = T_i \times_B X$ and denote $u_i : \mathcal{F}_i \to \mathcal{G}_i$
the pullback. Choose $0 \in I$ and replace $I$ by
$\{i \mid i \geq 0\}$. Set $Z_0 = Z \times_X X_0$. By
Morphisms of Spaces, Lemma \ref{spaces-morphisms-lemma-support-finite-type}
the support of $\mathcal{F}_i$ is $|Z_0|$. Since $|Z_0|$ is quasi-compact
we can find an affine scheme $W_0$ and an \'etale morphism $W_0 \to X_0$
such that $|Z_0| \subset \text{Im}(|W_0| \to |X_0|)$.
Set $W = W_0 \times_{T_0} T$ and $W_i = W_0 \times_{T_0} T_i$ for $i \geq 0$.
These are affine schemes endowed
with \'etale morphisms $\varphi : W \to X_T$ and
$\varphi_i : W_i \to X_i$. Note that $W = \lim W_i$
and that the support of $\mathcal{F}_T$ and $\mathcal{F}_i$
is contained in the image of $|W| \to |X_T|$ and $|W_i| \to |X_i|$.
Now $\varphi^*u_T$ is injective and it suffices to prove that
$\varphi_i^*u_i$ is injective for some $i$.
Thus we have reduced the problem to the affine case which is
Algebra, Lemma \ref{algebra-lemma-module-map-property-in-colimit} part (1).

\medskip\noindent
Proof of (3). This can be proven in exactly the same manner as in the
previous two paragraphs using
Algebra, Lemma \ref{algebra-lemma-module-map-property-in-colimit} part (3).
We can also deduce it from (1) and (2) as follows.
Let $T = \lim_{i \in I} T_i$ be a directed limit of affine $B$-schemes
and assume that $u_T$ is an isomorphism. By part (1) there exists
an $0 \in I$ such that $u_{T_0}$ is surjective. Set
$\mathcal{K} = \text{Ker}(u_{T_0})$ and consider the map of quasi-coherent
modules $v : \mathcal{K} \to \mathcal{F}_{T_0}$. For $i \geq 0$ the base
change $v_{T_i}$ is zero if and only if $u_i$ is an isomorphism. Moreover,
$v_T$ is zero. Since $\mathcal{G}_{T_0}$
is of finite presentation, $\mathcal{F}_{T_0}$ is of finite type, and
$u_{T_0}$ is surjective we conclude that $\mathcal{K}$ is of finite type
(Modules on Sites, Lemma
\ref{sites-modules-lemma-kernel-surjection-finite-onto-finite-presentation}).
It is clear that the support of $\mathcal{K}$ is contained in the
support of $\mathcal{F}_{T_0}$ which is quasi-compact over $T_0$.
Hence we can apply part (2) to see that $v_{T_i}$ is zero for some $i$. 
\end{proof}

\begin{lemma}
\label{lemma-F-zero-somewhat-closed}
Let $S = \Spec(R)$ be an affine scheme. Let $X$ be an algebraic space over
$S$. Let $u : \mathcal{F} \to \mathcal{G}$ be a map of quasi-coherent
$\mathcal{O}_X$-modules. Assume $\mathcal{G}$ flat over $S$. Let $T \to S$
be a quasi-compact morphism of schemes such that the base change $u_T$ is
zero. Then exists a closed subscheme $Z \subset S$ such that
(a) $T \to S$ factors through $Z$ and (b) the base change $u_Z$ is zero.
If $\mathcal{F}$ is a finite type $\mathcal{O}_X$-module and
the scheme theoretic support of $\mathcal{F}$ is quasi-compact,
then we can take $Z \to S$ of finite presentation.
\end{lemma}

\begin{proof}
Let $U \to X$ be a surjective \'etale morphism of algebraic spaces
where $U = \coprod U_i$ is a disjoint union of affine schemes (see
Properties of Spaces, Lemma
\ref{spaces-properties-lemma-cover-by-union-affines}).
By Lemma \ref{lemma-iso-go-up} we see that we may
replace $X$ by $U$. In other words, we may assume that $X = \coprod X_i$
is a disjoint union of affine schemes $X_i$. Suppose that we can prove
the lemma for $u_i = u|_{X_i}$. Then we find a closed subscheme
$Z_i \subset S$ such that $T \to S$ factors through $Z_i$ and
$u_{i, Z_i}$ is zero. If
$Z_i = \Spec(R/I_i) \subset \Spec(R) = S$, then taking
$Z = \Spec(R/\sum I_i)$ works. Thus we may assume that
$X = \Spec(A)$ is affine.

\medskip\noindent
Choose a finite affine open covering $T = T_1 \cup \ldots \cup T_m$.
It is clear that we may replace $T$ by $\coprod_{j = 1, \ldots, m} T_j$.
Hence we may assume $T$ is affine. Say $T = \Spec(R')$.
Let $u : M \to N$ be the homomorphisms of $A$-modules
corresponding to $u : \mathcal{F} \to \mathcal{G}$.
Then $N$ is a flat $R$-module as $\mathcal{G}$ is flat over $S$.
The assumption of the lemma means that the composition
$$
M \otimes_R R' \to N \otimes_R R'
$$
is zero. Let $z \in M$. By Lazard's theorem
(Algebra, Theorem \ref{algebra-theorem-lazard}) and the fact
that $\otimes$ commutes with colimits we can find free $R$-module
$F_z$, an element $\tilde z \in F_z$, and a map $F_z \to N$ such that
$u(z)$ is the image of $\tilde z$ and $\tilde z$ maps to zero in
$F_z \otimes_R R'$. Choose a basis $\{e_{z, \alpha}\}$ of $F_z$ and wite
$\tilde z = \sum f_{z, \alpha} e_{z, \alpha}$ with $f_{z, \alpha} \in R$.
Let $I \subset R$ be the ideal generated by the elements $f_{z, \alpha}$
with $z$ ranging over all elements of $M$.
By construction $I$ maps to zero in $R'$ and the elements $\tilde z$
map to zero in $F_z/IF_z$ whence in $N/IN$. Thus $Z = \Spec(R/I)$
is a solution to the problem in this case.

\medskip\noindent
Assume $\mathcal{F}$ is of finite type with quasi-compact scheme
theoretic support. Write $Z = \Spec(R/I)$.
Write $I = \bigcup I_\lambda$ as a filtered union of finitely generated
ideals. Set $Z_\lambda = \Spec(R/I_\lambda)$, so $Z = \colim Z_\lambda$.
Since $u_Z$ is zero, we see that $u_{Z_\lambda}$ is zero
for some $\lambda$ by Lemma \ref{lemma-iso-limits}.
This finishes the proof of the lemma.
\end{proof}

\begin{lemma}
\label{lemma-F-zero-module-map}
Let $A$ be a ring. Let $u : M \to N$ be a map of $A$-modules.
If $N$ is projective as an $A$-module, then there exists an ideal
$I \subset A$ such that for any ring map $\varphi : A \to B$
the following are equivalent
\begin{enumerate}
\item $u \otimes 1 : M \otimes_A B \to N \otimes_A B$ is zero, and
\item $\varphi(I) = 0$.
\end{enumerate}
\end{lemma}

\begin{proof}
As $M$ is projective we can find a projective $A$-module $C$
such that $F = N \oplus C$ is a free $R$-module.
By replacing $u$ by $u \oplus 1 : F = M \oplus C \to N \oplus C$
we see that we may assume $N$ is free. In this case let $I$ be
the ideal of $A$ generated by coefficients of all the elements of
$\text{Im}(u)$ with respect to some (fixed) basis of $N$.
\end{proof}

\noindent
It would be interesting to find a simple direct proof of the following
lemma using the result of Lemma \ref{lemma-F-zero-somewhat-closed}.
A ``classical'' proof of this lemma when $f : X \to B$ is a projective
morphism and $B$ a Noetherian scheme would be: (a) choose a relatively ample
invertible sheaf $\mathcal{O}_X(1)$, (b) set
$u_n : f_*\mathcal{F}(n) \to f_*\mathcal{G}(n)$,
(c) observe that $f_*\mathcal{G}(n)$ is a finite locally free sheaf
for all $n \gg 0$, and (d) $F_{zero}$ is represented by the vanishing
locus of $u_n$ for some $n \gg 0$.

\begin{lemma}
\label{lemma-F-zero-closed}
In Situation \ref{situation-iso}. Assume
\begin{enumerate}
\item $f$ is locally of finite presentation,
\item $\mathcal{G}$ is locally of finite presentation and flat over $B$,
\item the scheme theoretic support of $\mathcal{G}$ is proper over $B$.
\end{enumerate}
Then the functor $F_{zero}$ is an algebraic space and $F_{zero} \to B$
is a closed immersion. If $\mathcal{F}$ is of finite type, then
$F_{zero} \to B$ is of finite presentation.
\end{lemma}

\begin{proof}
In order to prove that $F_{zero}$ is an algebraic space, it suffices
to show that $F_{zero} \to B$ is representable, see
Spaces, Lemma \ref{spaces-lemma-representable-over-space}.
Let $B' \to B$ be a morphism where $B'$ is a scheme and let
$u' : \mathcal{F}' \to \mathcal{G}'$ be the pullback of $u$ to $X' = X_{B'}$.
Then the associated functor $F'_{zero}$ equals $F_{zero} \times_B B'$.
This reduces us to the case that $B$ is a scheme.

\medskip\noindent
Assume $B$ is a scheme. We will show that $F_{zero}$ is representable
by a closed subscheme of $B$. By Lemma \ref{lemma-iso-sheaf} and
Descent, Lemmas \ref{descent-lemma-closed-immersion} and
\ref{descent-lemma-descent-data-sheaves}
the question is local for the \'etale topology on $B$. Let $b \in B$.
We first replace $B$ by an affine neighbourhood of $b$.
Denote $Z \subset X$ the scheme theoretic support of $\mathcal{G}$.
Denote $Z_b \subset X_b$ the fibre of $Z \subset X \to B$ over $b$.
The space $|Z_b|$ is quasi-compact by the last assumption of the lemma.
Choose an affine scheme $U$ and an \'etale morphism $\varphi : U \to X$
such that $|Z_b| \subset \text{Im}(|U| \to |X|)$. After replacing $B$ by an
affine elementary \'etale neighbourhood of $b$ and replacing $U$
by some affine $U'$ \'etale over $U$ with $U'_b \to U_b$ surjective,
we may assume that $\Gamma(U, \varphi^*\mathcal{G})$ is a projective
$\Gamma(B, \mathcal{O}_B)$-module, see
More on Flatness, Lemma \ref{flat-lemma-finite-presentation-flat-along-fibre}.
Since $Z \to B$ is proper the image of
$$
|Z| \setminus \text{Im}(|U| \to |X|)
$$
in $|B|$ is a closed subset not containing $b$. Hence, after replacing
$B$ by an affine open containing $b$, we may assume that
$|Z| \subset \text{Im}(|U| \to |X|)$. (To be sure, after this replacement
it is still true that $\Gamma(U, \varphi^*\mathcal{G})$ is a projective
$\Gamma(B, \mathcal{O}_B)$-module.) By Lemma \ref{lemma-iso-go-up}
we see that $F_{zero}$ is the same as the corresponding functor
for the map $\varphi^*\mathcal{F} \to \varphi^*\mathcal{G}$.
This case follows immediately from Lemma \ref{lemma-F-zero-module-map}.

\medskip\noindent
We still have to show that $F_{zero} \to B$ is of finite presentation if
$\mathcal{F}$ is of finite type. Let $\mathcal{F}' \subset \mathcal{G}$
be the image of $u$ and denote $F'_{zero}$ the functor corresponding
to $\mathcal{F}' \to \mathcal{G}$. Then $F_{zero} = F'_{zero}$ and
the scheme theoretic support of $\mathcal{F}'$ is a closed subspace of
the scheme theoretic support of $\mathcal{G}$, hence proper over $B$.
Thus Lemma \ref{lemma-iso-limits} implies that $F_{zero} = F'_{zero}$
is limit preserving over $B$. We conclude by Limits of Spaces, Proposition
\ref{spaces-limits-proposition-characterize-locally-finite-presentation}.
\end{proof}

\noindent
The following result is a variant of
More on Flatness, Theorem \ref{flat-theorem-flattening-map}.

\begin{lemma}
\label{lemma-F-iso-closed}
In Situation \ref{situation-iso}. Assume
\begin{enumerate}
\item $f$ is locally of finite presentation,
\item $\mathcal{F}$ is locally of finite presentation and flat over $B$,
\item the scheme theoretic support of $\mathcal{F}$ is proper over $B$, and
\item $u$ is surjective.
\end{enumerate}
Then the functor $F_{iso}$ is an algebraic space and $F_{iso} \to B$
is a closed immersion. If $\mathcal{G}$ is of finite presentation, then
$F_{iso} \to B$ is of finite presentation.
\end{lemma}

\begin{proof}
Let $\mathcal{K} = \text{Ker}(u)$ and apply Lemma \ref{lemma-F-zero-closed}
to $\mathcal{K} \to \mathcal{G}$. Note that $\mathcal{K}$ is of finite type
if $\mathcal{G}$ is of finite presentation, see
Modules on Sites, Lemma
\ref{sites-modules-lemma-kernel-surjection-finite-onto-finite-presentation}.
\end{proof}








\section{The functor of quotients}
\label{section-functor-quotients}

\noindent
In this section we discuss some generalities regarding the functor
defined below.

\begin{situation}
\label{situation-q}
Let $S$ be a scheme.
Let $f : X \to B$ be a morphism of algebraic spaces over $S$.
Let $\mathcal{F}$ be a quasi-coherent $\mathcal{O}_X$-module.
Assume $f$ is locally of finite presentation and $\mathcal{F}$ of finite type.
For any scheme $T$ over $B$ we will denote $X_T$ the base change of
$X$ to $T$ and $\mathcal{F}_T$ the pullback
of $\mathcal{F}$ via the projection morphism $X_T = X \times_S T \to X$.
Given such a $T$ we set
$$
\text{Q}_{\mathcal{F}/X/B}(T) =
\left\{
\begin{matrix}
\text{quotients }\mathcal{F}_T \to \mathcal{Q}\text{ where }
\mathcal{Q}\text{ is a quasi-coherent }\\
\mathcal{O}_{X_T}\text{-module of finite presentation, flat over }T
\end{matrix}
\right\}
$$
We identify quotients if they have the same kernel. Suppose
that $T' \to T$ is a morphism of schemes over $B$ and
$\mathcal{F}_T \to \mathcal{Q}$ is an element of
$\text{Q}_{\mathcal{F}/X/B}(T)$. Then the pullback
$\mathcal{Q}' = (X_{T'} \to X_T)^*\mathcal{Q}$ is a quasi-coherent
$\mathcal{O}_{X_{T'}}$-module of finite presentation flat over $T'$
(see Properties of Spaces, Section
\ref{spaces-properties-section-properties-modules}
and
Morphisms of Spaces, Lemma
\ref{spaces-morphisms-lemma-base-change-module-flat}).
Thus we obtain a functor
\begin{equation}
\label{equation-quot}
\text{Q}_{\mathcal{F}/X/B} : (\Sch/B)^{opp} \longrightarrow \textit{Sets}
\end{equation}
This is the functor of quotients of $\mathcal{F}/X/B$.
\end{situation}

\noindent
We will reserve the notation $\text{Quot}_{\mathcal{F}/X/B}$ for a
subfunctor of $\text{Q}_{\mathcal{F}/X/B}$ which we will discuss later.

\begin{lemma}
\label{lemma-q-sheaf}
In Situation \ref{situation-q}. The functor $\text{Q}_{\mathcal{F}/X/B}$
satisfies the sheaf property for the fpqc topology.
\end{lemma}

\begin{proof}
Let $\{T_i \to T\}_{i \in I}$ be an fpqc covering of schemes over $S$.
Set $X_i = X_{T_i} = X \times_S T_i$ and $\mathcal{F}_i = \mathcal{F}_{T_i}$.
Note that $\{X_i \to X_T\}_{i \in I}$ is an fpqc covering of
$X_T$, see
Topologies on Spaces, Lemma \ref{spaces-topologies-lemma-fpqc}.
Suppose that $\mathcal{F}_i \to \mathcal{Q}_i$ is a collection of
elements of $\text{Q}_{\mathcal{F}/X/B}(T_i)$ such that $\mathcal{Q}_i$
and $\mathcal{Q}_{i'}$ restrict to the same element of
$\text{Q}_{\mathcal{F}/X/B}(T_i \times_T T_{i'})$. This means that
the pullbacks of $\mathcal{Q}_i$ and $\mathcal{Q}_{i'}$ restrict
to the same quotient of $\mathcal{F}_{T_i \times_T T_{i'}}$.
Since $X_{T_i \times_T T_{i'}} = X_i \times_{X_T} X_{i'}$ we see
that we obtain a descent datum for quasi-coherent modules
with respect to $\{X_i \to X_T\}_{i \in I}$. By
Descent on Spaces, Proposition
\ref{spaces-descent-proposition-fpqc-descent-quasi-coherent}
we find a map of quasi-coherent $\mathcal{O}_{X_T}$-modules
$\mathcal{F}_T \to \mathcal{Q}$ whose restriction to $X_i$ recovers
the given quotients.

\medskip\noindent
Since the family of morphisms $\{X_i \to X_T\}$ is jointly surjective
and flat, for every point $x \in |X_T|$ there exists an $i$ and a point
$x_i \in |X_i|$ mapping to $x$. Note that the induced map on
local rings
$\mathcal{O}_{X_T, \overline{x}} \to \mathcal{O}_{X_i, \overline{x_i}}$
is faithfully flat, see 
Morphisms of Spaces, Section \ref{spaces-morphisms-section-flat}.
Thus we see that $\mathcal{F}_T \to \mathcal{Q}$ is surjective.
By Morphisms of Spaces, Lemma \ref{spaces-morphisms-lemma-flat-permanence}
we see that $\mathcal{Q}$ is flat over $T$. Finally,
Descent on Spaces, Lemma
\ref{spaces-descent-lemma-finite-presentation-descends}
guarantees that $\mathcal{Q}$ is of finite presentation as an
$\mathcal{O}_{X_T}$-module.
\end{proof}

\begin{lemma}
\label{lemma-q-limit-preserving}
In Situation \ref{situation-q} assume also that
(a) $f$ is quasi-compact and quasi-separated and
(b) $\mathcal{F}$ is of finite presentation.
Then the functor $\text{Q}_{\mathcal{F}/X/B}$
is limit preserving in the following sense: If $T = \lim T_i$ is a
directed limit of affine schemes over $B$, then
$\text{Q}_{\mathcal{F}/X/B}(T) = \colim \text{Q}_{\mathcal{F}/X/B}(T_i)$.
\end{lemma}

\begin{proof}
Let $T = \lim T_i$ be as in the statement of the lemma.
Choose $i_0 \in I$ and replace $I$ by $\{i \in I \mid i \geq i_0\}$.
We may set $B = S = T_{i_0}$ and we may replace $X$ by $X_{T_0}$
and $\mathcal{F}$ by the pullback to $X_{T_0}$. Then
$X_T = \lim X_{T_i}$, see
Limits of Spaces, Lemma
\ref{spaces-limits-lemma-directed-inverse-system-has-limit}.
Let $\mathcal{F}_T \to \mathcal{Q}$ be an element of
$\text{Q}_{\mathcal{F}/X/B}(T)$. By
Limits of Spaces, Lemma
\ref{spaces-limits-lemma-descend-modules-finite-presentation}
there exists an $i$ and a map $\mathcal{F}_{T_i} \to \mathcal{Q}_i$
of $\mathcal{O}_{X_{T_i}}$-modules of finite presentation whose
pullback to $X_T$ is the given quotient map.

\medskip\noindent
We still have to check that, after possibly increasing $i$, the map
$\mathcal{F}_{T_i} \to \mathcal{Q}_i$ is surjective and $\mathcal{Q}_i$
is flat over $T_i$. To do this, choose an affine scheme $U$ and a
surjective \'etale morphism $U \to X$ (see Properties of Spaces,
Lemma \ref{spaces-properties-lemma-quasi-compact-affine-cover}).
We may check surjectivity and flatness over $T_i$ after pulling
back to the \'etale cover $U_{T_i} \to X_{T_i}$ (by definition).
This reduces us to the case where $X = \Spec(B_0)$ is an affine scheme of
finite presentation over $B = S = T_0 = \Spec(A_0)$.
Writing $T_i = \Spec(A_i)$, then $T = \Spec(A)$ with $A = \colim A_i$
we have reached the following algebra problem. Let $M_i \to N_i$
be a map of finitely presented $B_0 \otimes_{A_0} A_i$-modules
such that $M_i \otimes_{A_i} A \to N_i \otimes_{A_i} A$ is surjective
and $N_i \otimes_{A_i} A$ is flat over $A$. Show that for some $i' \geq i$
$M_i \otimes_{A_i} A_{i'} \to N_i \otimes_{A_i} A_{i'}$ is surjective
and $N_i \otimes_{A_i} A_{i'}$ is flat over $A$.
The first follows from
Algebra, Lemma \ref{algebra-lemma-module-map-property-in-colimit}
and the second from
Algebra, Lemma \ref{algebra-lemma-flat-finite-presentation-limit-flat}.
\end{proof}

\begin{lemma}
\label{lemma-factors-through-quotient}
Let $S = \Spec(R)$ be an affine scheme. Let $X$ be an algebraic space over
$S$. Let $q_i : \mathcal{F} \to \mathcal{Q}_i$, $i = 1, 2$
be surjective maps of quasi-coherent $\mathcal{O}_X$-modules.
Assume $\mathcal{Q}_1$ flat over $S$. Let $T \to S$ be a quasi-compact
morphism of schemes such that there exists a factorization
$$
\xymatrix{
& \mathcal{F}_T \ar[rd]^{q_{2, T}} \ar[ld]_{q_{1, T}} \\
\mathcal{Q}_{1, T} & & \mathcal{Q}_{2, T} \ar@{..>}[ll]
}
$$
Then exists a closed subscheme $Z \subset S$ such that
(a) $T \to S$ factors through $Z$ and (b)
$q_{1, Z}$ factors through $q_{2, Z}$.
If $\text{ker}(q_2)$ is a finite type $\mathcal{O}_X$-module and $X$
quasi-compact, then we can take $Z \to S$ of finite presentation.
\end{lemma}

\begin{proof}
Apply Lemma \ref{lemma-F-zero-somewhat-closed}
to the map $\text{Ker}(q_2) \to \mathcal{Q}_1$.
\end{proof}







\input{chapters}

\bibliography{my}
\bibliographystyle{amsalpha}

\end{document}
