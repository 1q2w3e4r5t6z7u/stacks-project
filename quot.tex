\input{preamble}

% OK, start here.
%
\begin{document}

\title{Quot and Hilbert Spaces}

\maketitle

\phantomsection
\label{section-phantom}

\tableofcontents




\section{Introduction}
\label{section-introduction}

\noindent
The purpose of this chapter is to write about Quot and Hilbert functors
and to prove that these are algebraic spaces provided certain technical
conditions are satisfied. In this chapter we will discuss this in the
setting of algebraic space. A reference is Grothendieck's lectures, see
\cite{Gr-I},
\cite{Gr-II},
\cite{Gr-III},
\cite{Gr-IV},
\cite{Gr-V}, and
\cite{Gr-VI}.
Another reference is the paper \cite{olsson-starr}; this paper discusses
the more general case of Quot and Hilbert spaces associated to a morphism
of algebraic stacks which we will discuss in another chapter, see
(insert future reference here).

\medskip\noindent
In the case of Hilbert spaces there is a more general notion of
``Hilbert stacks'' which we will discuss in a separate chapter, see
(insert future reference here).

\medskip\noindent
We have intentionally placed this chapter, as well as the chapters
``Examples of Stacks'', ``Sheaves on Algebraic Stacks'',
``Criteria for Representability'', and ``Artin's Axioms'' before the
general development of the theory of algebraic stacks. The reason
for this is that starting with the next chapter (see
Properties of Stacks, Section \ref{stacks-properties-section-conventions})
we will no longer distinguish between a scheme and the algebraic stack
it gives rise to. Thus our language will become more flexible and
easier for a human to parse, but also less precise. These first few
chapters, including the initial chapter ``Algebraic Stacks'', lay the
groundwork that later allow us to ignore some of the very technical
distinctions between different ways of thinking about algebraic stacks.
But especially in the chapters ``Artin's Axioms'' and
``Criteria of Representability'' we need
to be very precise about what objects exactly we are working with, as
we are trying to show that certain constructions produce algebraic stacks or
algebraic spaces.

\medskip\noindent
Unfortunately, this means that some of the notation, conventions and
terminology is awkward and may seem backwards to the more experienced
reader. We hope the reader will forgive us!





\section{Conventions}
\label{section-conventions}

\noindent
The standing assumption is that all schemes are contained in
a big fppf site $\Sch_{fppf}$. And all rings $A$ considered
have the property that $\Spec(A)$ is (isomorphic) to an
object of this big site.

\medskip\noindent
Let $S$ be a scheme and let $X$ be an algebraic space over $S$.
In this chapter and the following we will write $X \times_S X$
for the product of $X$ with itself (in the category of algebraic
spaces over $S$), instead of $X \times X$.















\section{The Hom functor}
\label{section-hom}

\noindent
In this section we study the functor of homomorphisms defined below.

\begin{situation}
\label{situation-hom}
Let $S$ be a scheme. Let $f : X \to B$ be a morphism of algebraic spaces
over $S$. Let $\mathcal{F}$, $\mathcal{G}$ be quasi-coherent
$\mathcal{O}_X$-modules. For any scheme $T$ over $B$ we will denote
$\mathcal{F}_T$ and $\mathcal{G}_T$ the base changes of
$\mathcal{F}$ and $\mathcal{G}$ to $T$, in other words, the pullbacks
via the projection morphism $X_T = X \times_B T \to X$.
We consider the functor
\begin{equation}
\label{equation-hom}
\mathit{Hom}(\mathcal{F}, \mathcal{G}) :
(\Sch/B)^{opp}
\longrightarrow
\textit{Sets},\quad
T
\longrightarrow
\Hom_{\mathcal{O}_{X_T}}(\mathcal{F}_T, \mathcal{G}_T)
\end{equation}
\end{situation}

\noindent
In Situation \ref{situation-hom} we sometimes think of the functor
$\mathit{Hom}(\mathcal{F}, \mathcal{G})$ as a functor
$$
\mathit{Hom}(\mathcal{F}, \mathcal{G}) :
(\Sch/S)^{opp}
\longrightarrow
\textit{Sets}
$$
endowed with a morphism
$\mathit{Hom}(\mathcal{F}, \mathcal{G}) \to B$.
Namely, if $T$ is a scheme over $S$, then an element of
$\mathit{Hom}(\mathcal{F}, \mathcal{G})(T)$ consists of a pair
$(h, u)$, where $h$ is a morphism $h : T \to B$ and
$u : \mathcal{F}_T \to \mathcal{G}_T$ is an $\mathcal{O}_{X_T}$-module
map where $X_T = T \times_{h, B} X$ and $\mathcal{F}_T$ and $\mathcal{G}_T$
are the pullbacks to $X_T$. In particular, when we say
that $\mathit{Hom}(\mathcal{F}, \mathcal{G})$ is an algebraic space,
we mean that the corresponding functor
$(\Sch/S)^{opp} \to \textit{Sets}$ is an algebraic space.

\begin{lemma}
\label{lemma-hom-sheaf}
In Situation \ref{situation-hom} the functor
$\mathit{Hom}(\mathcal{F}, \mathcal{G})$ 
satisfies the sheaf property for the fpqc topology.
\end{lemma}

\begin{proof}
Let $\{T_i \to T\}_{i \in I}$ be an fpqc covering of schemes over $B$.
Set $X_i = X_{T_i} = X \times_S T_i$ and $\mathcal{F}_i = u_{T_i}$
and $\mathcal{G}_i = \mathcal{G}_{T_i}$.
Note that $\{X_i \to X_T\}_{i \in I}$ is an fpqc covering of $X_T$, see
Topologies on Spaces, Lemma \ref{spaces-topologies-lemma-fpqc}.
Thus a family of maps $u_i : \mathcal{F}_i \to \mathcal{G}_i$
such that $u_i$ and $u_j$ restrict to the same map on
$X_{T_i \times_T T_j}$ comes from a unique map
$u : \mathcal{F}_T \to \mathcal{G}_T$ by descent
(Descent on Spaces, Proposition
\ref{spaces-descent-proposition-fpqc-descent-quasi-coherent}).
\end{proof}

\begin{remark}
\label{remark-hom-base-change}
In Situation \ref{situation-hom} let $B' \to B$ be a morphism of
algebraic spaces over $S$. Set $X' = X \times_B B'$ and denote
$\mathcal{F}'$, $\mathcal{G}'$ the pullback of
$\mathcal{F}$, $\mathcal{G}$ to $X'$. Then we obtain a functor
$\mathit{Hom}(\mathcal{F}', \mathcal{G}') : (\Sch/B')^{opp} \to \textit{Sets}$
associated to the base change $f' : X' \to B'$. For a scheme $T$ over $B'$
it is clear that we have
$$
\mathit{Hom}(\mathcal{F}', \mathcal{G}')(T) =
\mathit{Hom}(\mathcal{F}, \mathcal{G})(T)
$$
where on the right hand side we think of $T$ as a scheme over $B$
via the composition $T \to B' \to B$. This trivial remark
will occasionally be useful to change the base algebraic space.
\end{remark}

\begin{lemma}
\label{lemma-hom-sheaf-in-X}
In Situation \ref{situation-hom} let $\{X_i \to X\}_{i \in I}$ be an fppf
covering and for each $i, j \in I$ let $\{X_{ijk} \to X_i \times_X X_j\}$
be an fppf covering. Denote $\mathcal{F}_i$, resp.\ $\mathcal{F}_{ijk}$
the pullback of $\mathcal{F}$ to $X_i$, resp.\ $X_{ijk}$. Similarly
define $\mathcal{G}_i$ and $\mathcal{G}_{ijk}$. For every scheme
$T$ over $B$ the diagram
$$
\xymatrix{
\mathit{Hom}(\mathcal{F}, \mathcal{G})(T) \ar[r] &
\prod\nolimits_i
\mathit{Hom}(\mathcal{F}_i, \mathcal{G}_i)(T)
\ar@<1ex>[r]^-{\text{pr}_0^*} \ar@<-1ex>[r]_-{\text{pr}_1^*}
&
\prod\nolimits_{i, j, k}
\mathit{Hom}(\mathcal{F}_{ijk}, \mathcal{G}_{ijk})(T)
}
$$
presents the first arrow as the equalizer of the other two.
\end{lemma}

\begin{proof}
Let $u_i : \mathcal{F}_{i, T} \to \mathcal{G}_{i, T}$ be an element in the
equalizer of $\text{pr}_0^*$ and $\text{pr}_1^*$. Since the base change
of an fppf covering is an fppf covering
(Topologies on Spaces, Lemma \ref{spaces-topologies-lemma-fppf})
we see that $\{X_{i, T} \to X_T\}_{i \in I}$ and
$\{X_{ijk, T} \to X_{i, T} \times_{X_T} X_{j, T}\}$ are fppf coverings.
Applying Descent on Spaces, Proposition
\ref{spaces-descent-proposition-fpqc-descent-quasi-coherent}
we first conclude that $u_i$ and $u_j$ restrict to the same morphism
over $X_{i, T} \times_{X_T} X_{j, T}$, whereupon a second application
shows that there is a unique morphism $u : \mathcal{F}_T \to \mathcal{G}_T$
restricting to $u_i$ for each $i$. This finishes the proof.
\end{proof}

\begin{lemma}
\label{lemma-hom-limits}
In Situation \ref{situation-hom}. If $\mathcal{F}$ is of finite presentation
and $f$ is quasi-compact and quasi-separated, then
$\mathit{Hom}(\mathcal{F}, \mathcal{G})$ is limit preserving.
\end{lemma}

\begin{proof}
Let $T = \lim_{i \in I} T_i$ be a directed limit of affine $B$-schemes.
We have to show that
$$
\mathit{Hom}(\mathcal{F}, \mathcal{G})(T) =
\colim \mathit{Hom}(\mathcal{F}, \mathcal{G})(T_i)
$$
Pick $0 \in I$. We may replace $B$ by $T_0$, $X$ by $X_{T_0}$,
$\mathcal{F}$ by $\mathcal{F}_{T_0}$, $\mathcal{G}$ by
$\mathcal{G}_{T_0}$, and $I$ by $\{i \in I \mid i \geq 0\}$.
See Remark \ref{remark-hom-base-change}.
Thus we may assume $B = \Spec(R)$ is affine.

\medskip\noindent
When $B$ is affine, then $X$ is quasi-compact and quasi-separated.
Choose a surjective \'etale morphism $U \to X$ where $U$ is an
affine scheme (Properties of Spaces, Lemma
\ref{spaces-properties-lemma-quasi-compact-affine-cover}).
Since $X$ is quasi-separated, the scheme $U \times_X U$ is quasi-compact
and we may choose a surjective \'etale morphism $V \to U \times_X U$
where $V$ is an affine scheme. Applying Lemma \ref{lemma-hom-sheaf-in-X}
we see that $\mathit{Hom}(\mathcal{F}, \mathcal{G})$ is the
equalizer of two maps between
$$
\mathit{Hom}(\mathcal{F}|_U, \mathcal{G}|_U)
\quad\text{and}\quad
\mathit{Hom}(\mathcal{F}|_V, \mathcal{G}|_V)
$$
This reduces us to the case that $X$ is affine.

\medskip\noindent
In the affine case the statement of the lemma reduces to
the following problem: Given a ring map $R \to A$, two $A$-modules
$M$, $N$ and a directed system of $R$-algebras $C = \colim C_i$.
When is it true that the map
$$
\colim \Hom_{A \otimes_R C_i}(M \otimes_R C_i, N \otimes_R C_i)
\longrightarrow
\Hom_{A \otimes_R C}(M \otimes_R C, N \otimes_R C)
$$
is bijective? By
Algebra, Lemma \ref{algebra-lemma-module-map-property-in-colimit}
this holds if $M \otimes_R C$ is of finite presentation over
$A \otimes_R C$, i.e., when $M$ is of finite presentation over $A$.
\end{proof}

\begin{lemma}
\label{lemma-hom-closed}
Let $S$ be a scheme. Let $B$ be an algebraic space over $S$.
Let $i : X' \to X$ be a closed immersion of algebraic spaces
over $B$. Let $\mathcal{F}$ be a quasi-coherent $\mathcal{O}_X$-module
and let $\mathcal{G}'$ be a quasi-coherent $\mathcal{O}_{X'}$-module.
Then
$$
\mathit{Hom}(\mathcal{F}, i_*\mathcal{G}') =
\mathit{Hom}(i^*\mathcal{F}, \mathcal{G}')
$$
as functors on $(\Sch/B)$.
\end{lemma}

\begin{proof}
Let $g : T \to B$ be a morphism where $T$ is a scheme.
Denote $i_T : X'_T \to X_T$ the base change of $i$.
Denote $h : X_T \to X$ and $h' : X'_T \to X'$ the projections.
Observe that $(h')^*i^*\mathcal{F} = i_T^*h^*\mathcal{F}$.
As a closed immersion is affine
(Morphisms of Spaces, Lemma
\ref{spaces-morphisms-lemma-closed-immersion-affine})
we have $h^*i_*\mathcal{G} = i_{T, *}(h')^*\mathcal{G}$ by
Cohomology of Spaces, Lemma \ref{spaces-cohomology-lemma-affine-base-change}.
Thus we have
\begin{align*}
\mathit{Hom}(\mathcal{F}, i_*\mathcal{G}')(T)
& =
\Hom_{\mathcal{O}_{X_T}}(h^*\mathcal{F}, h^*i_*\mathcal{G}') \\
& =
\Hom_{\mathcal{O}_{X_T}}(h^*\mathcal{F}, i_{T, *}(h')^*\mathcal{G}) \\
& =
\Hom_{\mathcal{O}_{X'_T}}(i_T^*h^*\mathcal{F}, (h')^*\mathcal{G}) \\
& =
\Hom_{\mathcal{O}_{X'_T}}((h')^*i^*\mathcal{F}, (h')^*\mathcal{G}) \\
& =
\mathit{Hom}(i^*\mathcal{F}, \mathcal{G}')(T)
\end{align*}
as desired. The middle equality follows from the adjointness of the functors
$i_{T, *}$ and $i_T^*$.
\end{proof}

\begin{lemma}
\label{lemma-cohomology-perfect-complex}
Let $S$ be a scheme. Let $B$ be an algebraic space over $S$.
Let $K$ be a pseudo-coherent object of $D(\mathcal{O}_B)$.
\begin{enumerate}
\item If for all $g : T \to B$ in $(\Sch/B)$ the cohomology sheaf
$H^{-1}(Lg^*K)$ is zero, then the functor
$$
(\Sch/B)^{opp} \longrightarrow \textit{Sets},\quad
(g : T \to B) \longmapsto H^0(T, H^0(Lg^*K))
$$
is an algebraic space affine and of finite presentation over $B$.
\item If for all $g : T \to B$ in $(\Sch/B)$ the cohomology sheaves
$H^i(Lg^*K)$ are zero for $i < 0$, then $K$ is perfect with tor amplitude
in $[0, b]$ for some $b \geq 0$ and the functor
$$
(\Sch/B)^{opp} \longrightarrow \textit{Sets},\quad
(g : T \to B) \longmapsto H^0(T, Lg^*K)
$$
is an algebraic space affine and of finite presentation over $B$.
\end{enumerate}
\end{lemma}

\begin{proof}
Under the assumptions of (2) we have $H^0(T, Lg^*K) = H^0(T, H^0(Lg^*K))$.
Let us prove that the rule $T \mapsto H^0(T, H^0(Lg^*K))$ satisfies the
sheaf property for the fppf topology. To do this assume we have an
fppf covering $\{h_i : T_i \to T\}$ of a scheme $g : T \to B$ over $B$.
Set $g_i = g \circ h_i$. Note that since $h_i$ is flat, we have
$Lh_i^* = h_i^*$ and $h_i^*$ commutes with taking cohomology. Hence
$$
H^0(T_i, H^0(Lg_i^*K)) =
H^0(T_i, H^0(h_i^*Lg^*K)) =
H^0(T, h_i^*H^0(Lg^*K))
$$
Similarly for the pullback to $T_i \times_T T_j$.
Since $Lg^*K$ is a pseudo-coherent complex on $T$
(Cohomology on Sites, Lemma
\ref{sites-cohomology-lemma-pseudo-coherent-pullback})
the cohomology sheaf $\mathcal{F} = H^0(Lg^*K)$ is quasi-coherent
(Derived Categories of Spaces, Lemma
\ref{spaces-perfect-lemma-pseudo-coherent}).
Hence by Descent on Spaces, Proposition
\ref{spaces-descent-proposition-fpqc-descent-quasi-coherent}
we see that
$$
H^0(T, \mathcal{F}) = \Ker(
\prod H^0(T_i, h_i^*\mathcal{F}) \to
\prod H^0(T_i, h_i^*\mathcal{F}))
$$
In this way we see that the rules in (1) and (2) satisfy
the sheaf property for fppf coverings. This mean we may apply
Bootstrap, Lemma \ref{bootstrap-lemma-locally-algebraic-space-finite-type}
it suffices to prove the representability \'etale locally on $B$. Moreover,
we may check whether the end result is affine and of finite presentation
\'etale locally on $B$, see
Morphisms of Spaces, Lemmas \ref{spaces-morphisms-lemma-affine-local} and
\ref{spaces-morphisms-lemma-finite-presentation-local}.
Hence we may assume that $B$ is an affine scheme.

\medskip\noindent
Assume $B = \Spec(A)$ is an affine scheme. By the results of
Derived Categories of Spaces, Lemmas
\ref{spaces-perfect-lemma-pseudo-coherent},
\ref{spaces-perfect-lemma-derived-quasi-coherent-small-etale-site}, and
\ref{spaces-perfect-lemma-descend-pseudo-coherent}
we deduce that in the rest of the proof we may think of $K$ as a perfect
object of the derived category of complexes of modules on $B$
in the Zariski topology. By 
Derived Categories of Schemes, Lemmas
\ref{perfect-lemma-pseudo-coherent},
\ref{perfect-lemma-affine-compare-bounded}, and
\ref{perfect-lemma-pseudo-coherent-affine} we can find a pseudo-coherent
complex $M^\bullet$ of $A$-modules such that $K$ is the corresponding
object of $D(\mathcal{O}_B)$. Our assumption on pullbacks implies
that $M^\bullet \otimes^\mathbf{L}_A \kappa(\mathfrak p)$
has vanishing $H^{-1}$ for all primes $\mathfrak p \subset A$.
By More on Algebra, Lemma \ref{more-algebra-lemma-cut-complex-in-two}
we can write
$$
M^\bullet =
\tau_{\geq 0}M^\bullet \oplus \tau_{\leq - 1}M^\bullet
$$
with $\tau_{\geq 0}M^\bullet$ perfect with Tor amplitude in $[0, b]$
for some $b \geq 0$ (here we also have used
More on Algebra, Lemmas \ref{more-algebra-lemma-glue-perfect} and
\ref{more-algebra-lemma-glue-tor-amplitude}).
Note that in case (2) we also see that $\tau_{\leq - 1}M^\bullet = 0$
in $D(A)$ whence $M^\bullet$ and $K$ are perfect with
tor amplitude in $[0, b]$. For any $B$-scheme $g : T \to B$ we have
$$
H^0(T, H^0(Lg^*K)) = H^0(T, H^0(Lg^*\tau_{\geq 0}K))
$$
(by the dual of Derived Categories, Lemma
\ref{derived-lemma-negative-vanishing})
hence we may replace $K$ by $\tau_{\geq 0}K$ and correspondingly
$M^\bullet$ by $\tau_{\geq 0}M^\bullet$. In other words, we may
assume $M^\bullet$ has tor amplitude in $[0, b]$.

\medskip\noindent
Assume $M^\bullet$ has tor amplitude in $[0, b]$.
We may assume $M^\bullet$ is a bounded above complex of finite free
$A$-modules (by our definition of pseudo-coherent complexes, see
More on Algebra, Definition \ref{more-algebra-definition-pseudo-coherent}
and the discussion following the definition).
By More on Algebra, Lemma \ref{more-algebra-lemma-last-one-flat}
we see that $M = \Coker(M^{- 1} \to M^0)$ is flat. By
Algebra, Lemma \ref{algebra-lemma-finite-projective} we see that $M$
is finite locally free. Hence $M^\bullet$ is quasi-isomorphic to
$$
M \to M^1 \to M^2 \to \ldots \to M^d \to 0 \ldots
$$
Note that this is a K-flat complex
(Cohomology, Lemma \ref{cohomology-lemma-bounded-flat-K-flat}),
hence derived pullback of $K$ via a morphism $T \to B$ is computed
by the complex
$$
g^*\widetilde{M} \to g^*\widetilde{M^1} \to \ldots
$$
Thus it suffices to show that the functor
$$
(g : T \to B) \longmapsto
\Ker(
\Gamma(T,g^*\widetilde{M})
\to
\Gamma(T, g^*(\widetilde{M^1})
)
$$
is representable by an affine scheme of finite presentation over $B$.

\medskip\noindent
We may still replace $B$ by the members of an affine open covering
in order to prove this last statement. Hence we may assume that $M$
is finite free (recall that $M^1$ is finite free to begin with).
Write $M = A^{\oplus n}$ and $M^1 = A^{\oplus m}$. Let the map
$M \to M^1$ be given by the $m \times n$ matrix $(a_{ij})$ with
coefficients in $A$. Then $\widetilde{M} = \mathcal{O}_B^{\oplus n}$
and $\widetilde{M^1} = \mathcal{O}_B^{\oplus m}$. Thus the functor
above is equal to the functor
$$
(g : T \to B) \longmapsto
\{(f_1, \ldots, f_n) \in \Gamma(T, \mathcal{O}_T) \mid
\sum g^\sharp(a_{ij}f_i = 0, j = 1, \ldots, m\}
$$
Clearly this is representable by the affine scheme
$$
\Spec\left(A[x_1, \ldots, x_n]/(\sum a_{ij}x_i; j = 1, \ldots, m)\right)
$$
and the lemma has been proved.
\end{proof}

\noindent
The functor $\mathit{Hom}(\mathcal{F}, \mathcal{G})$ is representable in a
number of situations. All of our results will be based on the following
basic case. The proof of this lemma as given below is in some sense the
natural generalization to the proof of \cite[III, Cor 7.7.8]{EGA}.

\begin{lemma}
\label{lemma-noetherian-hom}
In Situation \ref{situation-hom} assume that
\begin{enumerate}
\item $B$ is a Noetherian algebraic space,
\item $f$ is locally of finite type and quasi-separated,
\item $\mathcal{F}$ is a finite type $\mathcal{O}_X$-module, and
\item $\mathcal{G}$ is a finite type $\mathcal{O}_X$-module, flat over $B$,
with scheme theoretic support proper over $B$.
\end{enumerate}
Then the functor $\mathit{Hom}(\mathcal{F}, \mathcal{G})$ is
representable by an algebraic space affine and of finite presentation
over $B$.
\end{lemma}

\begin{proof}
We may replace $X$ by a quasi-compact open neighbourhood of
the support of $\mathcal{G}$, hence we may assume $X$ is Noetherian.
In this case $X$ and $f$ are quasi-compact and quasi-separated.
Choose an approximation $P \to \mathcal{F}$ by a perfect complex $P$ of
the triple $(X, \mathcal{F}, 0)$, see
Derived Categories of Spaces, Definition
\ref{spaces-perfect-definition-approximation-holds} and
Theorem \ref{spaces-perfect-theorem-approximation}).
Then the induced map
$$
\Hom_{\mathcal{O}_X}(\mathcal{F}, \mathcal{G})
\longrightarrow
\Hom_{D(\mathcal{O}_X)}(P, \mathcal{G})
$$
is an isomorphism because $P \to \mathcal{F}$ induces an isomorphism
$H^0(P) \to \mathcal{F}$ and $H^i(P) = 0$ for $i > 0$.
Moreover, for any morphism $g : T \to B$
denote $h : X_T = T \times_B X \to X$ the projection and set
$P_T = Lh^*P$. Then it is equally true that
$$
\Hom_{\mathcal{O}_{X_T}}(\mathcal{F}_T, \mathcal{G}_T)
\longrightarrow
\Hom_{D(\mathcal{O}_{X_T})}(P_T, \mathcal{G}_T)
$$
is an isomorphism, as $P_T = Lh^*P \to Lh^*\mathcal{F} \to \mathcal{F}_T$
induces an isomorphism $H^0(P_T) \to \mathcal{F}_T$ (because $h^*$ is
right exact and $H^i(P) = 0$ for $i > 0$). Thus it suffices to prove the
result for the functor
$$
T \longmapsto \Hom_{D(\mathcal{O}_{X_T})}(P_T, \mathcal{G}_T).
$$
By the Leray spectral sequence (see Cohomology on Sites, Remark
\ref{sites-cohomology-remark-before-Leray}) we have
$$
\Hom_{D(\mathcal{O}_{X_T})}(P_T, \mathcal{G}_T) =
H^0(X_T, R\SheafHom(P_T, \mathcal{G}_T)) =
H^0(T, Rf_{T, *}R\SheafHom(P_T, \mathcal{G}_T))
$$
where $f_T : X_T \to T$ is the base change of $f$. By
Derived Categories of Spaces, Lemma
\ref{spaces-perfect-lemma-base-change-RHom}
we have
$$
Rf_{T, *}R\SheafHom(P_T, \mathcal{G}_T) = Lg^*Rf_*R\SheafHom(P, \mathcal{G}).
$$
By
Derived Categories of Spaces, Lemma
\ref{spaces-perfect-lemma-compute-ext-perfect}
the object $K = Rf_*R\SheafHom(P, \mathcal{G})$ of $D(\mathcal{O}_B)$
is perfect. This means we can apply
Lemma \ref{lemma-cohomology-perfect-complex}
as long as we can prove that the cohomology sheaf
$H^i(Lg^*K)$ is $0$ for all $i < 0$ and $g : T \to B$ as above.
This is clear from the last displayed formula as
the cohomology sheaves of
$Rf_{T, *}R\SheafHom(P_T, \mathcal{G}_T)$
are zero in negative degrees
due to the fact that $R\SheafHom(P_T, \mathcal{G}_T)$ has vanishing
cohomology sheaves in negative degrees as $P_T$ is perfect with
vanishing cohomology sheaves in positive degrees.
\end{proof}

\noindent
Here is a cheap consequence of Lemma \ref{lemma-noetherian-hom}.

\begin{proposition}
\label{proposition-hom}
In Situation \ref{situation-hom} assume that
\begin{enumerate}
\item $f$ is of finite presentation, and
\item $\mathcal{G}$ is a finitely presented $\mathcal{O}_X$-module,
flat over $B$, with scheme theoretic support proper over $B$.
\end{enumerate}
Then the functor $\mathit{Hom}(\mathcal{F}, \mathcal{G})$ is
representable by an algebraic space affine over $B$. If $\mathcal{F}$
is of finite presentation, then $\mathit{Hom}(\mathcal{F}, \mathcal{G})$
is of finite presentation over $B$.
\end{proposition}

\begin{proof}
By Lemma \ref{lemma-hom-sheaf} the functor
$\mathit{Hom}(\mathcal{F}, \mathcal{G})$ satisfies
the sheaf property for fppf coverings. This mean we may\footnote{We omit
the verification of the set theoretical condition (3) of the referenced
lemma.} apply
Bootstrap, Lemma \ref{bootstrap-lemma-locally-algebraic-space}
to check the representability \'etale locally on $B$. Moreover,
we may check whether the end result is affine or
of finite presentation \'etale locally on $B$, see
Morphisms of Spaces, Lemmas \ref{spaces-morphisms-lemma-affine-local} and
\ref{spaces-morphisms-lemma-finite-presentation-local}.
Hence we may assume that $B$ is an affine scheme.

\medskip\noindent
Assume $B$ is an affine scheme. As $f$ is of finite presentation, it follows
$X$ is quasi-compact and quasi-separated. Thus we can write
$\mathcal{F} = \colim \mathcal{F}_i$ as a filtered colimit of
$\mathcal{O}_X$-modules of finite presentation
(Limits of Spaces, Lemma \ref{spaces-limits-lemma-colimit-finitely-presented}).
It is clear that
$$
\mathit{Hom}(\mathcal{F}, \mathcal{G}) =
\lim \mathit{Hom}(\mathcal{F}_i, \mathcal{G})
$$
Hence if we can show that each $\mathit{Hom}(\mathcal{F}_i, \mathcal{G})$
is representable by an affine scheme, then we see that the same thing
holds for $\mathit{Hom}(\mathcal{F}, \mathcal{G})$. Use the material in
Limits, Section \ref{limits-section-limits} and
Limits of Spaces, Section \ref{spaces-limits-section-limits}.
Thus we may assume that $\mathcal{F}$ is of finite presentation.

\medskip\noindent
Say $B = \Spec(R)$. Write $R = \colim R_i$ with each $R_i$ a finite
type $\mathbf{Z}$-algebra. Set $B_i = \Spec(R_i)$. By the results of
Limits of Spaces, Lemmas
\ref{spaces-limits-lemma-descend-finite-presentation} and
\ref{spaces-limits-lemma-descend-modules-finite-presentation}
we can find an $i$, a morphism of algebraic spaces $X_i \to B_i$,
and finitely presented $\mathcal{O}_{X_i}$-modules $\mathcal{F}_i$ and
$\mathcal{G}_i$ such that the base change of
$(X_i, \mathcal{F}_i, \mathcal{G}_i)$ to $B$ recovers
$(X, \mathcal{F}, \mathcal{G})$. By
Limits of Spaces, Lemma \ref{spaces-limits-lemma-descend-flat}
we may, after increasing $i$, assume that $\mathcal{G}_i$
is flat over $B_i$. By
Limits of Spaces, Lemma \ref{spaces-limits-lemma-eventually-proper-support}\
we may similarly assume the scheme theoretic support of $\mathcal{G}_i$
is proper over $B_i$. At this point we can apply
Lemma \ref{lemma-noetherian-hom}
to see that $H_i = \mathit{Hom}(\mathcal{F}_i, \mathcal{G}_i)$ is
an algebraic space affine of finite presentation over $B_i$.
Pulling back to $B$ (using Remark \ref{remark-hom-base-change})
we see that $H_i \times_{B_i} B = \mathit{Hom}(\mathcal{F}, \mathcal{G})$ 
and we win.
\end{proof}






\section{The Isom functor}
\label{section-isom}

\noindent
In Situation \ref{situation-hom} we can consider the subfunctor
$$
\mathit{Isom}(\mathcal{F}, \mathcal{G}) \subset
\mathit{Hom}(\mathcal{F}, \mathcal{G})
$$
whose value on a scheme $T$ over $B$ is the set of {\it invertible}
$\mathcal{O}_{X_T}$-homomorphisms $u : \mathcal{F}_T \to \mathcal{G}_T$.
In this brief section we quickly point out some properties of this
functor.

\begin{lemma}
\label{lemma-isom-sheaf}
In Situation \ref{situation-hom} the functor
$\mathit{Isom}(\mathcal{F}, \mathcal{G})$ 
satisfies the sheaf property for the fpqc topology.
\end{lemma}

\begin{proof}
We have already seen that $\mathit{Hom}(\mathcal{F}, \mathcal{G})$
satisfies the sheaf property. Hence it remains to show the following:
Given an fpqc covering $\{T_i \to T\}_{i \in I}$ of schemes over $B$
and an $\mathcal{O}_{X_T}$-linear map
$u : \mathcal{F}_T \to \mathcal{G}_T$ such that
$u_{T_i}$ is an isomorphism for all $i$, then $u$ is an isomorphism.
Since $\{X_i \to X_T\}_{i \in I}$ is an fpqc covering of $X_T$, see
Topologies on Spaces, Lemma \ref{spaces-topologies-lemma-fpqc},
this follows from
Descent on Spaces, Proposition
\ref{spaces-descent-proposition-fpqc-descent-quasi-coherent}.
\end{proof}

\begin{proposition}
\label{proposition-isom}
In Situation \ref{situation-hom} assume that
\begin{enumerate}
\item $f$ is of finite presentation, and
\item $\mathcal{F}$ and $\mathcal{G}$ are finitely presented
$\mathcal{O}_X$-modules, flat over $B$, with scheme theoretic
support proper over $B$.
\end{enumerate}
Then the functor $\mathit{Isom}(\mathcal{F}, \mathcal{G})$ is
representable by an algebraic space affine of finite presentation
over $B$.
\end{proposition}

\begin{proof}
We will use the abbreviations
$H = \mathit{Hom}(\mathcal{F}, \mathcal{G})$,
$I = \mathit{Hom}(\mathcal{F}, \mathcal{F})$,
$H' = \mathit{Hom}(\mathcal{G}, \mathcal{F})$, and
$I' = \mathit{Hom}(\mathcal{G}, \mathcal{G})$.
By Proposition \ref{proposition-hom} the functors
$H$, $I$, $H'$, $I'$ are algebraic spaces and the morphisms
$H \to B$, $I \to B$, $H' \to B$, and $I' \to B$
are affine and of finite presentation.
The composition of maps gives a morphism
$$
c : H' \times_B H \longrightarrow I \times_B I',\quad
(u', u) \longmapsto (u \circ u', u' \circ u)
$$
of algebraic spaces over $B$. Since $I \times_B I' \to B$ is separated,
the section $\sigma : B \to I \times_B I'$ corresponding to
$(\text{id}_\mathcal{F}, \text{id}_\mathcal{G})$
is a closed immersion
(Morphisms of Spaces, Lemma \ref{spaces-morphisms-lemma-section-immersion}).
Moreover, $\sigma$ is of finite presentation
(Morphisms of Spaces, Lemma
\ref{spaces-morphisms-lemma-finite-presentation-permanence}).
Hence
$$
\mathit{Isom}(\mathcal{F}, \mathcal{G}) =
(H' \times_B H) \times_{c, I \times_B I', \sigma} B
$$
is an algebraic space affine of finite presentation over $B$ as well.
Some details omitted.
\end{proof}






\section{The stack of coherent sheaves}
\label{section-stack-coherent-sheaves}

\noindent
In this section we prove that the stack of coherent sheaves 
on $X/B$ is algebraic under suitable hypotheses. This is a
special case of \cite[Theorem 2.1.1]{lieblich_remarks}
which treats the case of the stack of coherent sheaves on an
Artin stack over a base.

\begin{situation}
\label{situation-coherent}
Let $S$ be a scheme. Let $f : X \to B$ be a morphism of algebraic spaces
over $S$. Assume that $f$ is of finite presentation.
We denote $\textit{Coh}_{X/B}$ the category whose objects are
triples $(T, g, \mathcal{F})$ where
\begin{enumerate}
\item $T$ is a scheme over $S$,
\item $g : T \to B$ is a morphism over $S$, and setting
$X_T = T \times_{g, B} X$
\item $\mathcal{F}$ is a quasi-coherent $\mathcal{O}_{X_T}$-module
of finite presentation, flat over $T$, with scheme theoretic support
proper over $B$.
\end{enumerate}
A morphism $(T, g, \mathcal{F}) \to (T', g', \mathcal{F}')$
is given by a pair $(h, \varphi)$ where
\begin{enumerate}
\item $h : T \to T'$ is a morphism of schemes over $B$
(i.e., $g' \circ h = g$), and
\item $\varphi : (h')^*\mathcal{F}' \to \mathcal{F}$ is an
isomorphism of $\mathcal{O}_{X_T}$-modules where $h' : X_T \to X_{T'}$
is the base change of $h$.
\end{enumerate}
\end{situation}

\noindent
Thus $\textit{Coh}_{X/B}$ is a category and the rule
$$
p : \textit{Coh}_{X/B} \longrightarrow (\Sch/S)_{fppf},
\quad
(T, g, \mathcal{F}) \longmapsto T
$$
is a functor. For a scheme $T$ over $S$ we denote $\textit{Coh}_{X/B, T}$
the fibre category of $p$ over $T$. These fibre categories are groupoids.

\begin{lemma}
\label{lemma-coherent-fibred-in-groupoids}
In Situation \ref{situation-coherent} the functor
$p : \textit{Coh}_{X/B} \longrightarrow (\Sch/S)_{fppf}$
is fibred in groupoids.
\end{lemma}

\begin{proof}
We show that $p$ is fibred in groupoids by checking conditions
(1) and (2) of Categories, Definition
\ref{categories-definition-fibred-groupoids}.
Given an object $(T', g', \mathcal{F}')$
of $\textit{Coh}_{X/B}$ and a morphism $h : T \to T'$ of
schemes over $S$ we can set $g = h \circ g'$ and
$\mathcal{F} = (h')^*\mathcal{F}'$ where $h' : X_T \to X_{T'}$
is the base change of $h$. Then it is clear that we obtain
a morphism $(T, g, \mathcal{F}) \to (T', g', \mathcal{F}')$
of $\textit{Coh}_{X/B}$ lying over $h$. This proves (1).
For (2) suppose we are given morphisms
$$
(h_1, \varphi_1) : (T_1, g_1, \mathcal{F}_1) \to (T, g, \mathcal{F})
\quad\text{and}\quad
(h_2, \varphi_2) : (T_2, g_2, \mathcal{F}_2) \to (T, g, \mathcal{F})
$$
of $\textit{Coh}_{X/B}$ and a morphism $h : T_1 \to T_2$ such that
$h_2 \circ h = h_1$. Then we can let $\varphi$ be the composition
$$
(h')^*\mathcal{F}_2
\xrightarrow{(h')^*\varphi_2^{-1}}
(h')^*(h_2)^*\mathcal{F} = (h_1)^*\mathcal{F}
\xrightarrow{\varphi_1}
\mathcal{F}_1
$$
to obtain the morphism
$(h, \varphi) : (T_1, g_1, \mathcal{F}_1) \to (T_2, g_2, \mathcal{F}_2)$
that witnesses the truth of condition (2).
\end{proof}

\begin{lemma}
\label{lemma-coherent-diagonal}
In Situation \ref{situation-coherent}. Denote
$\mathcal{X} = \textit{Coh}_{X/B}$. Then
$\Delta : \mathcal{X} \to \mathcal{X} \times \mathcal{X}$ is
representable by algebraic spaces.
\end{lemma}

\begin{proof}
Consider two objects $x = (T, g, \mathcal{F})$ and $y = (T, h, \mathcal{G})$
of $\mathcal{X}$ over a scheme $T$. We have to show that
$\mathit{Isom}_\mathcal{X}(x, y)$ is representable by an algebraic
space over $T$, see
Algebraic Stacks, Lemma \ref{algebraic-lemma-representable-diagonal}.
If for $a : T' \to T$ the restrictions $x|_{T'}$ and $y|_{T'}$ are isomorphic
in the fibre category $\mathcal{X}_{T'}$, then $g \circ a = h \circ a$.
Hence there is a transformation of presheaves
$$
\mathit{Isom}_\mathcal{X}(x, y) \longrightarrow \text{Equalizer}(g, h)
$$
Since the diagonal of $B$ is representable by schemes this equalizer is
a scheme. Thus we may replace $T$ by this equalizer and the sheaves
$\mathcal{F}$ and $\mathcal{G}$ by their pullbacks. Thus we may assume
$g = h$. In this case we have
$\mathit{Isom}_\mathcal{X}(x, y) = \mathit{Isom}(\mathcal{F}, \mathcal{G})$
and the result follows from Proposition \ref{proposition-isom}.
\end{proof}

\begin{lemma}
\label{lemma-coherent-stack}
In Situation \ref{situation-coherent} the functor
$p : \textit{Coh}_{X/B} \longrightarrow (\Sch/S)_{fppf}$
is a stack in groupoids.
\end{lemma}

\begin{proof}
To prove that $\textit{Coh}_{X/B}$ is a stack in groupoids, we have to show
that the presheaves $\mathit{Isom}$ are sheaves and that descent data are
effective. The statement on $\mathit{Isom}$ follows from
Lemma \ref{lemma-coherent-diagonal}, see
Algebraic Stacks, Lemma \ref{algebraic-lemma-representable-diagonal}.
Let us prove the statement on descent data.
Suppose that $\{a_i : T_i \to T\}$ is an fppf covering of schemes over $S$.
Let $(\xi_i, \varphi_{ij})$ be a descent datum for $\{T_i \to T\}$
with values in $\textit{Coh}_{X/B}$.
For each $i$ we can write $\xi_i = (T_i, g_i, \mathcal{F}_i)$.
Denote $\text{pr}_0 : T_i \times_T T_j \to T_i$ and
$\text{pr}_1 : T_i \times_T T_j \to T_j$ the projections.
The condition that $\xi_i|_{T_i \times_T T_j} = \xi_j|_{T_i \times_T T_j}$
implies in particular that $g_i \circ \text{pr}_0 = g_j \circ \text{pr}_1$.
Thus there exists a unique morphism $g : T \to B$ such that
$g_i = g \circ a_i$, see
Descent on Spaces, Lemma
\ref{spaces-descent-lemma-fppf-universal-effective-epimorphisms}.
Denote $X_T = T \times_{g, B} X$. Set
$X_i = X_{T_i} = T_i \times_{g_i, B} X = T_i \times_{a_i, T} X_T$
and
$$
X_{ij} = X_{T_i} \times_{X_T} X_{T_j} = X_i \times_{X_T} X_j
$$
with projections $\text{pr}_i$ and $\text{pr}_j$ to $X_i$ and $X_j$.
Observe that the pullback of $(T_i, g_i, \mathcal{F}_i)$
by $\text{pr}_0 : T_i \times_T T_j \to T_i$ is given by
$(T_i \times_T T_j, g_i \circ \text{pr}_0, \text{pr}_i^*\mathcal{F}_i)$.
Hence a descent datum for $\{T_i \to T\}$ in $\textit{Coh}_{X/B}$
is given by the objects $(T_i, g \circ a_i, \mathcal{F}_i)$
and for each pair $i, j$ an isomorphism of $\mathcal{O}_{X_{ij}}$-modules
$$
\varphi_{ij} :
\text{pr}_i^*\mathcal{F}_i \longrightarrow \text{pr}_j^*\mathcal{F}_j
$$
satisfying the cocycle condition over (the pullback of $X$ to)
$T_i \times_T T_j \times_T T_k$.
Ok, and now we simply use that $\{X_i \to X_T\}$ is an fppf covering
so that we can view $(\mathcal{F}_i, \varphi_{ij})$ as a descent datum
for this covering. By
Descent on Spaces, Proposition
\ref{spaces-descent-proposition-fpqc-descent-quasi-coherent}
this descent datum is effective and we obtain a quasi-coherent
sheaf $\mathcal{F}$ over $X_T$ restricting to $\mathcal{F}_i$ on $X_i$.
By Morphisms of Spaces, Lemma \ref{spaces-morphisms-lemma-flat-permanence}
we see that $\mathcal{F}$ is flat over $T$ and
Descent on Spaces, Lemma
\ref{spaces-descent-lemma-finite-presentation-descends}
guarantees that $\mathcal{Q}$ is of finite presentation as an
$\mathcal{O}_{X_T}$-module. Finally, by
Descent on Spaces, Lemma \ref{spaces-descent-lemma-descending-property-proper}
we see that the scheme theoretic support of $\mathcal{F}$ is proper over
$T$ as we've assume the scheme theoretic support of $\mathcal{F}_i$
is proper over $T_i$ (note that taking scheme theoretic support commutes
with flat base change by
Morphisms of Spaces, Lemma \ref{spaces-morphisms-lemma-flat-pullback-support}).
In this way
and we obtain our desired object over $T$.
\end{proof}

\begin{remark}
\label{remark-coherent-base-change}
In Situation \ref{situation-coherent} the rule
$(T, g, \mathcal{F}) \mapsto (T, g)$ defines a $1$-morphism
$$
\textit{Coh}_{X/B} \longrightarrow \mathcal{S}_B
$$
of categories fibred in groupoids
(see Lemma \ref{lemma-coherent-stack},
Algebraic Stacks, Section \ref{algebraic-section-split}, and
Examples of Stacks, Section
\ref{examples-stacks-section-stack-associated-to-sheaf}).
Let $B' \to B$ be a morphism of
algebraic spaces over $S$. Let $\mathcal{S}_{B'} \to \mathcal{S}_B$
be the associated $1$-morphism of stacks fibred in sets.
Set $X' = X \times_B B'$.
We obtain a stack in groupoids $\textit{Coh}_{X'/B'} \to (\Sch/S)_{fppf}$
associated to the base change $f' : X' \to B'$. In this situation
the diagram
$$
\xymatrix{
\textit{Coh}_{X'/B'} \ar[r] \ar[d] & \textit{Coh}_{X/B} \ar[d] \\
\mathcal{S}_{B'} \ar[r] & \mathcal{S}_B
}
$$
is $2$-fibre product square. This trivial remark
will occasionally be useful to change the base algebraic space.
\end{remark}

\begin{lemma}
\label{lemma-coherent-limits}
In Situation \ref{situation-coherent} assume that $B \to S$
is locally of finite presentation. Then
$p : \textit{Coh}_{X/B} \to (\Sch/S)_{fppf}$ is limit preserving
(Artin's Axioms, Definition \ref{artin-definition-limit-preserving}).
\end{lemma}

\begin{proof}
Write $B(T)$ for the discrete category whose
objects are the $S$-morphisms $T \to B$. Let $T = \lim T_i$ be a filtered
limit of affine schemes over $S$. Assigning to an object
$(T, h, \mathcal{F})$ of $\textit{Coh}_{X/B, T}$ the object $h$
of $B(T)$ gives us a commutative diagram of fibre categories
$$
\xymatrix{
\colim \textit{Coh}_{X/B, T_i} \ar[r] \ar[d] &
\textit{Coh}_{X/B, T} \ar[d] \\
\colim B(T_i) \ar[r] & B(T)
}
$$
We have to show the top horizontal arrow is an equivalence. Since
we have assume that $B$ is locally of finite presentation over $S$
we see from
Limits of Spaces, Remark \ref{spaces-limits-remark-limit-preserving}
that the bottom horizontal arrow is an equivalence. This means that
we may assume $T = \lim T_i$ be a filtered limit of affine schemes over
$B$. Denote $g_i : T_i \to B$ and $g : T \to B$ the corresponding
morphisms. Set $X_i = T_i \times_{g_i, B} X$ and $X_T = T \times_{g, B} X$.
Observe that $X_T = \colim X_i$ and that the algebraic spaces
$X_i$ and $X_T$ are quasi-separated and quasi-compact (as they
are of finite presentation over the affines $T_i$ and $T$).
By Limits of Spaces, Lemma
\ref{spaces-limits-lemma-descend-modules-finite-presentation}
we see that
$$
\colim \textit{FP}(X_i) = \textit{FP}(X_T).
$$
where $\textit{FP}(W)$ is short hand for the category of finitely
presented $\mathcal{O}_W$-modules. The results of
Limits of Spaces, Lemmas \ref{spaces-limits-lemma-descend-flat} and
\ref{spaces-limits-lemma-eventually-proper-support}
tell us the same thing is true if we replace $\textit{FP}(X_i)$
and $\textit{FP}(X_T)$ by the full subcategory of objects
flat over $T_i$ and $T$ with scheme theoretic support proper
over $T_i$ and $T$. This proves the lemma.
\end{proof}

\begin{lemma}
\label{lemma-coherent-RS-star}
In Situation \ref{situation-coherent}. Let
$$
\xymatrix{
Z \ar[r] \ar[d] & Z' \ar[d] \\
Y \ar[r] & Y'
}
$$
be a pushout in the category of schemes over $S$ where
$Z \to Z'$ is a thickening and $Z \to Y$ is affine, see
More on Morphisms, Lemma \ref{more-morphisms-lemma-pushout-along-thickening}.
Then the functor on fibre categories
$$
\textit{Coh}_{X/B, Y'}
\longrightarrow
\textit{Coh}_{X/B, Y} \times_{\textit{Coh}_{X/B, Z}} \textit{Coh}_{X/B, Z'}
$$
is an equivalence.
\end{lemma}

\begin{proof}
Observe that the corresponding map
$$
B(Y') \longrightarrow B(Y) \times_{B(Z)} B(Z')
$$
is a bijection, see More on Morphisms of Spaces, Lemma
\ref{spaces-more-morphisms-lemma-pushout-along-thickening-schemes}.
Thus using the commutative diagram
$$
\xymatrix{
\textit{Coh}_{X/B, Y'} \ar[r] \ar[d] &
\textit{Coh}_{X/B, Y} \times_{\textit{Coh}_{X/B, Z}} \textit{Coh}_{X/B, Z'}
\ar[d] \\
B(Y') \ar[r] & B(Y) \times_{B(Z)} B(Z')
}
$$
we see that we may assume that $Y'$ is a scheme over $B'$. By
Remark \ref{remark-coherent-base-change}
we may replace $B$ by $Y'$ and $X$ by $X \times_B Y'$.
Thus we may assume $B = Y'$. In this case the statement follows from
More on Morphisms of Spaces, Lemma
\ref{spaces-more-morphisms-lemma-space-over-pushout-flat-modules}.
\end{proof}

\begin{lemma}
\label{lemma-coherent-over-first-order-thickening}
Let
$$
\xymatrix{
X \ar[d] \ar[r]_i & X' \ar[d] \\
T \ar[r] & T'
}
$$
be a cartesian square of algebraic spaces where $T \to T'$ is a first
order thickening. Let $\mathcal{F}'$ be an $\mathcal{O}_{X'}$-module
flat over $T'$. Set $\mathcal{F} = i^*\mathcal{F}'$. The following
are equivalent
\begin{enumerate}
\item $\mathcal{F}$ is a quasi-coherent $\mathcal{O}_{X'}$-module
of finite presentation,
\item $\mathcal{F}$ is an $\mathcal{O}_{X'}$-module of finite presentation,
\item $\mathcal{F}$ is a quasi-coherent $\mathcal{O}_X$-module
of finite presentation,
\item $\mathcal{F}$ is an $\mathcal{O}_X$-module of finite presentation,
\end{enumerate}
\end{lemma}

\begin{proof}
Recall that a finitely presented module is quasi-coherent hence the
equivalence of (1) and (2) and (3) and (4). The equivalence of (2)
and (4) is a special case of Deformation Theory, Lemma
\ref{defos-lemma-deform-fp-module-ringed-topoi}.
\end{proof}

\begin{lemma}
\label{lemma-coherent-tangent-space}
In Situation \ref{situation-coherent} assume that $S$ is a locally Noetherian
scheme and $B \to S$ is locally of finite presentation.
Let $k$ be a finite type field over $S$ and let
$x_0 = (\Spec(k), g_0, \mathcal{G}_0)$
be an object of $\mathcal{X} = \textit{Coh}_{X/B}$ over $k$. Then
the spaces $T\mathcal{F}_{\mathcal{X}, k, x_0}$ and
$\text{Inf}_{x_0}(\mathcal{F}_{\mathcal{X}, k, x_0})$
(Artin's Axioms, Section \ref{artin-section-tangent-spaces})
are finite dimensional.
\end{lemma}

\begin{proof}
Observe that by Lemma \ref{lemma-coherent-RS-star}
our stack in groupoids $\mathcal{X}$ satisfies property (RS*)
defined in Artin's Axioms, Section \ref{artin-section-inf}.
In particular $\mathcal{X}$ satisfies (RS).
Hence all associated predeformation
categories are deformation categories
(Artin's Axioms, Lemma \ref{artin-lemma-deformation-category})
and the statement makes sense.

\medskip\noindent
In this paragraph we show that we can reduce to the case $B = \Spec(k)$.
Set $X_0 = \Spec(k) \times_{g_0, B} X$
and denote $\mathcal{X}_0 = \textit{Coh}_{X_0/k}$. In
Remark \ref{remark-coherent-base-change} we have seen that
$\mathcal{X}_0$ is the $2$-fibre product of $\mathcal{X}$ with
$\Spec(k)$ over $B$ as categories fibred in groupoids over
$(\Sch/S)_{fppf}$. Thus by
Artin's Axioms, Lemma \ref{artin-lemma-fibre-product-tangent-spaces}
we reduce to proving that $B$, $\Spec(k)$, and $\mathcal{X}_0$
have finite dimensional tangent spaces and infinitesimal automorphism
spaces. The tangent space of $B$ and $\Spec(k)$ are finite dimensional by
Artin's Axioms, Lemma \ref{artin-lemma-finite-dimension}
and of course these have vanishing $\text{Inf}$.
Thus it suffices to deal with $\mathcal{X}_0$.

\medskip\noindent
Let $k[\epsilon]$ be the dual numbers over $k$.
Let $\Spec(k[\epsilon]) \to B$ be the composition of $g_0 : \Spec(k) \to B$
and the morphism $\Spec(k[\epsilon]) \to \Spec(k)$
coming from the inclusion $k \to k[\epsilon]$.
Set $X_0 = \Spec(k) \times_B X$ and
$X_\epsilon = \Spec(k[\epsilon]) \times_B X$.
Observe that $X_\epsilon$ is a first order thickening of $X_0$
flat over the first order thickening $\Spec(k) \to \Spec(k[\epsilon])$.
Unwinding the definitions and using
Lemma \ref{lemma-coherent-over-first-order-thickening}
we see that $T\mathcal{F}_{\mathcal{X}_0, k, x_0}$ is the set of
lifts of $\mathcal{G}_0$ to a flat module on $X_\epsilon$.
By Deformation Theory, Lemma \ref{defos-lemma-flat-ringed-topoi}
we conclude that
$$
T\mathcal{F}_{\mathcal{X}_0, k, x_0} =
\text{Ext}^1_{\mathcal{O}_{X_0}}(\mathcal{G}_0, \mathcal{G}_0)
$$
Here we have used the identification $\epsilon k[\epsilon] \cong k$
of $k[\epsilon]$-modules. Using
Deformation Theory, Lemma \ref{defos-lemma-flat-ringed-topoi}
once more we see that
$$
\text{Inf}_{x_0}(\mathcal{F}_{\mathcal{X}, k, x_0}) =
\text{Ext}^0_{\mathcal{O}_{X_0}}(\mathcal{G}_0, \mathcal{G}_0)
$$
These spaces are finite dimensional over $k$ as $\mathcal{G}_0$
has support proper over $\Spec(k)$. Namely, $X_0$ is of finite presentation
over $\Spec(k)$, hence Noetherian. Since $\mathcal{G}_0$ is of finite
presentation it is a coherent $\mathcal{O}_{X_0}$-module. Thus we may apply
Derived Categories of Spaces, Lemma
\ref{spaces-perfect-lemma-compute-ext}
to conclude the desired finiteness.
\end{proof}

\begin{lemma}
\label{lemma-coherent-existence}
In Situation \ref{situation-coherent} assume that $S$ is a locally Noetherian
scheme. Let $\mathcal{X} = \textit{Coh}_{X/B}$. Then the functor
Artin's Axioms, Equation (\ref{artin-equation-approximation})
is an equivalence.
\end{lemma}

\begin{proof}
Let $A$ be an $S$-algebra which is a complete local Noetherian ring
with maximal ideal $\mathfrak m$
whose residue field $k$ is of finite type over $S$.
We have to show that the category of objects over $A$ is
equivalent to the category of formal objects over $A$.
Since we know this holds for the category $\mathcal{S}_B$
fibred in sets associated to $B$ by Artin's Axioms, 
Lemma \ref{artin-lemma-effective}, it suffices to prove this
for those objects lying over a given morphism $\Spec(A) \to B$.

\medskip\noindent
Set $X_A = \Spec(A) \times_B X$ and $X_n = \Spec(A/\mathfrak m^n) \times_B X$.
By Grothendieck's existence theorem
(More on Morphisms of Spaces, Theorem
\ref{spaces-more-morphisms-theorem-grothendieck-existence})
we see that the category of coherent modules $\mathcal{F}$
on $X_A$ with support proper over $\Spec(A)$ is equivalent
to the category of systems $(\mathcal{F}_n)$ of coherent modules
$\mathcal{F}_n$ on $X_n$ with support proper over
$\Spec(A/\mathfrak m^n)$. The equivalence sends $\mathcal{F}$
to the system $(\mathcal{F} \otimes_A A/\mathfrak m^n)$. See discussion in
More on Morphisms of Spaces, Remark
\ref{spaces-more-morphisms-remark-reformulate-existence-theorem}.
To finish the proof of the lemma, it suffices to show that
$\mathcal{F}$ is flat over $A$ if and only if all
$\mathcal{F} \otimes_A A/\mathfrak m^n$ are flat over $A/\mathfrak m^n$.
This follows from
More on Morphisms of Spaces, Lemma
\ref{spaces-more-morphisms-lemma-flatness-over-Noetherian-ring}.
\end{proof}

\begin{lemma}
\label{lemma-coherent-defo-thy}
In Situation \ref{situation-coherent} assume that
$S$ is a locally Noetherian scheme, $S = B$, and $f : X \to B$ is flat.
Let $\mathcal{X} = \textit{Coh}_{X/B}$. Then we have openness of
versality for $\mathcal{X}$ (see
Artin's Axioms, Definition \ref{artin-definition-openness-versality}).
\end{lemma}

\begin{proof}
Let $U \to S$ be of finite type morphism of schemes, $x$ an object of
$\mathcal{X}$ over $U$ and $u_0 \in U$ a finite type point such that
$x$ is versal at $u_0$. After shrinking $U$ we may assume that $u_0$
is a closed point (Morphisms, Lemma \ref{morphisms-lemma-point-finite-type})
and $U = \Spec(A)$ with $U \to S$ mapping into an
affine open $\Spec(\Lambda)$ of $S$. We will use
Artin's Axioms, Lemma \ref{artin-lemma-dual-openness} to prove the lemma.
Let $\mathcal{F}$ be the coherent module on $X_A = \Spec(A) \times_S X$
flat over $A$ corresponding to the given object $x$.

\medskip\noindent
According to Deformation Theory, Lemma \ref{defos-lemma-flat-ringed-topoi}
we have an isomorphism of functors
$$
T_x(M) = \text{Ext}^1_{X_A}(\mathcal{F}, \mathcal{F} \otimes_A M)
$$
and given any surjection $A' \to A$ of $\Lambda$-algebras with square zero
kernel $I$ we have an obstruction class
$$
\xi_{A'} \in \text{Ext}^2_{X_A}(\mathcal{F}, \mathcal{F} \otimes_A I)
$$
This uses that for any $A' \to A$ as above the base change
$X_{A'} = \Spec(A') \times_B X$ is flat over $A'$.
Apply Derived Categories of Spaces, Lemma
\ref{spaces-perfect-lemma-compute-ext}
to the computation of the Ext groups
$\text{Ext}^i_{X_A}(\mathcal{F}, \mathcal{F} \otimes_A M)$
for $i \leq m$ with $m = 2$. We find a perfect object $K \in D(A)$
and functorial isomorphisms
$$
H^i(K \otimes_A^\mathbf{L} M)
\longrightarrow
\text{Ext}^i_{X_A}(\mathcal{F}, \mathcal{F} \otimes_A M)
$$
for $i \leq m$ compatible with boundary maps. This object $K$, together
with the displayed identifications above gives us a datum as in
Artin's Axioms, Situation \ref{artin-situation-dual}.
Finally, condition (iv) of
Artin's Axioms, Lemma \ref{artin-lemma-dual-obstruction}
holds by 
Deformation Theory, Lemma \ref{defos-lemma-verify-iv-ringed-topoi}.
Thus Artin's Axioms, Lemma \ref{artin-lemma-dual-openness}
does indeed apply and the lemma is proved.
\end{proof}

\begin{theorem}[Algebraicity of stack coherent sheaves]
\label{theorem-coherent-algebraic}
Let $S$ be a scheme. Let $f : X \to B$ be morphism of algebraic spaces
over $S$. Assume that $f$ is of finite presentation and
flat\footnote{This assumption is not necessary. See discussion in
Section \ref{section-not-flat}.}. Then $\textit{Coh}_{X/B}$ is
an algebraic stack over $S$.
\end{theorem}

\begin{proof}
Set $\mathcal{X} = \textit{Coh}_{X/B}$. We have seen that $\mathcal{X}$
is a stack in groupoids over $(\Sch/S)_{fppf}$ with diagonal representable
by algebraic spaces
(Lemmas \ref{lemma-coherent-stack} and \ref{lemma-coherent-diagonal}).
Hence it suffices to find a scheme $W$ and a surjective and smooth
morphism $W \to \mathcal{X}$.

\medskip\noindent
Let $B'$ be a scheme and let $B' \to B$ be a surjective \'etale morphism.
Set $X' = B' \times_B X$ and denote $f' : X' \to B'$ the projection.
Then $\mathcal{X}' = \textit{Coh}_{X'/B'}$ is equal to the $2$-fibre
product of $\mathcal{X}$ with the category fibred in sets
associated to $B'$ over the category fibred in sets associated to $B$
(Remark \ref{remark-coherent-base-change}). By the material in
Algebraic Stacks, Section \ref{algebraic-section-representable-properties}
the morphism $\mathcal{X}' \to \mathcal{X}$ is surjective and \'etale.
Hence it suffices to prove the result for $\mathcal{X}'$.
In other words, we may assume $B$ is a scheme.

\medskip\noindent
Assume $B$ is a scheme. In this case we may replace $S$ by $B$, see
Algebraic Stacks, Section \ref{algebraic-section-change-base-scheme}.
Thus we may assume $S = B$.

\medskip\noindent
Assume $S = B$. Choose an affine open covering $S = \bigcup U_i$.
Denote $\mathcal{X}_i$ the restriction of $\mathcal{X}$ to
$(\Sch/U_i)_{fppf}$. If we can find schemes $W_i$ over $U_i$ and
surjective smooth morphisms $W_i \to \mathcal{X}_i$, then we
set $W = \coprod W_i$ and we obtain a surjective smooth morphism
$W \to \mathcal{X}$. Thus we may assume $S = B$ is affine.

\medskip\noindent
Assume $S = B$ is affine, say $S = \Spec(\Lambda)$.
Write $\Lambda = \colim \Lambda_i$ as a filtered colimit with each $\Lambda_i$
of finite type over $\mathbf{Z}$. For some $i$ we can find
a morphism of algebraic spaces $X_i \to \Spec(\Lambda_i)$
which is of finite presentation and flat and whose base change
to $\Lambda$ is $X$. See
Limits of Spaces, Lemmas
\ref{spaces-limits-lemma-descend-finite-presentation} and
\ref{spaces-limits-lemma-descend-flat}.
If we show that $\textit{Coh}_{X_i/\Spec(\Lambda_i)}$ is an
algebraic stack, then it follows by base change
(Remark \ref{remark-coherent-base-change} and
Algebraic Stacks, Section \ref{algebraic-section-change-base-scheme})
that $\mathcal{X}$ is an algebraic stack.
Thus we may assume that $\Lambda$ is a finite type $\mathbf{Z}$-algebra.

\medskip\noindent
Assume $S = B = \Spec(\Lambda)$ is affine of finite type over $\mathbf{Z}$.
In this case we will verify conditions (1), (2), (3), and (4) of
Artin's Axioms, Lemma \ref{artin-lemma-diagonal-representable}
to conclude that $\mathcal{X}$ is an algebraic stack.
Note that $\Lambda$ is a G-ring, see
More on Algebra, Proposition \ref{more-algebra-proposition-ubiquity-G-ring}.
Hence all local rings of $S$ are G-rings. Thus (4) holds.
By Lemma \ref{lemma-coherent-defo-thy}
we have that $\mathcal{X}$ satisfies openness of versality, hence (3) holds.
To check (2) we have to verify axioms [-1], [0], [1], [2], [3], and [4]
of Artin's Axioms, Section \ref{artin-section-axioms}.
We omit the verification of [-1] and axioms
[0], [1], [2], [3], [4] correspond respectively to
Lemmas \ref{lemma-coherent-stack},
\ref{lemma-coherent-limits},
\ref{lemma-coherent-RS-star},
\ref{lemma-coherent-tangent-space}, and
\ref{lemma-coherent-existence}.
Finally, condition (1) is Lemma \ref{lemma-coherent-diagonal}.
This finishes the proof of the theorem.
\end{proof}








\section{The stack of coherent sheaves in the non-flat case}
\label{section-not-flat}

\noindent
In Theorem \ref{theorem-coherent-algebraic} the assumption that $f : X \to B$
is flat is not necessary. In this section we explain where this assumption is
used in the proof and one way to get around it.

\medskip\noindent
For a different approach to this problem the reader may wish to consult
\cite{ArtinI} and follow the method discussed in the papers
\cite{olsson-starr}, \cite{lieblich_remarks}, \cite{olsson_proper},
\cite{Hall-Rydh}, \cite{Hall-Rydh-Hilbert}, \cite{rydh_representability}.
Some of these papers deal with the more general case of the stack of
coherent sheaves on an algebraic stack over an algebraic stack and
others deal with similar problems in the case of Hilbert stacks
or Quot functors. Our strategy will be to show algebraicity of some
cases of Hilbert stacks and Quot functors as a consequence of the
algebraicity of the stack of coherent sheaves.

\medskip\noindent
The only step in the proof of Theorem \ref{theorem-coherent-algebraic}
which uses flatness is in the application of
Lemma \ref{lemma-coherent-defo-thy}.
The lemma is used to construct an obstruction theory as in
Artin's Axioms, Section \ref{artin-section-dual}.
The proof of the lemma relies on
Deformation Theory, Lemmas \ref{defos-lemma-flat-ringed-topoi} and
\ref{defos-lemma-verify-iv-ringed-topoi} from
Deformation Theory, Section \ref{defos-section-flat-ringed-topoi}.
This is how the assumption that $f$ is flat comes about.
Before we go on, note that results (2) and (3) of
Deformation Theory, Lemmas \ref{defos-lemma-flat-ringed-topoi}
do hold without the assumption that $f$ is flat as they rely
on Deformation Theory, Lemmas \ref{defos-lemma-inf-ext-rel-ringed-topoi}.
and \ref{defos-lemma-inf-map-rel-ringed-topoi}
which do not have any flatness assumptions.

\medskip\noindent
Before we give the details we give some motivation for the construction
from derived algebraic geometry, since we think it will clarify what
follows. Let $A$ be a finite type algebra over the locally Noetherian
base $S$. Denote $X \otimes^\mathbf{L} A$ a ``derived base change''
of $X$ to $A$ and denote $i : X_A \to X \otimes^\mathbf{L} A$ the
canonical inclusion morphism. The object $X \otimes^\mathbf{L} A$
does not (yet) have a definition in the Stacks project; we may think of it
as the algebraic space $X_A$ endowed with a simplicial sheaf of rings
$\mathcal{O}_{X \otimes^\mathbf{L} A}$ whose homology sheaves are
$$
H_i(\mathcal{O}_{X \otimes^\mathbf{L} A}) =
\text{Tor}^{\mathcal{O}_S}_i(\mathcal{O}_X, A).
$$
The morphism $X \otimes^\mathbf{L} A \to \Spec(A)$ is flat
(the terms of the simplicial sheaf of rings being $A$-flat),
so the usual material for deformations of flat modules applies to it.
Thus we see that we get an obstruction theory using the groups
$$
\text{Ext}^i_{X \otimes^\mathbf{L} A}(i_*\mathcal{F},
i_*\mathcal{F} \otimes_A M)
$$
where $i = 0, 1, 2$ for inf auts, inf defs, obstructions. Note that
a flat deformation of $i_*\mathcal{F}$ to $X \otimes^\mathbf{L} A'$
is automatically of the form $i'_*\mathcal{F}'$ where $\mathcal{F}'$
is a flat deformation of $\mathcal{F}$. By adjunction
of the functors $Li^*$ and $i_* = Ri_*$ these ext groups are equal to
$$
\text{Ext}^i_{X_A}(Li^*(i_*\mathcal{F}), \mathcal{F} \otimes_A M)
$$
Thus we obtain obstruction groups of exactly the same form as in the
proof of Lemma \ref{lemma-coherent-defo-thy} with the only change being
that one replaces the first occurrence of $\mathcal{F}$ by the complex
$Li^*(i_*\mathcal{F})$.

\medskip\noindent
Below we prove the non-flat version of the lemma by a ``direct''
construction of $E(\mathcal{F}) = Li^*(i_*\mathcal{F})$ and direct
proof of its relationship to the deformation theory of $\mathcal{F}$.
In fact, it suffices to construct $\tau_{\geq -2}E(\mathcal{F})$, as we
are only interested in the ext groups
$\text{Ext}^i_{X_A}(Li^*(i_*\mathcal{F}), \mathcal{F} \otimes_A M)$
for $i = 0, 1, 2$. We can even identify the cohomology sheaves
$$
H^i(E(\mathcal{F})) =
\left\{
\begin{matrix}
0 & \text{if }i > 0 \\
\mathcal{F} & \text{if } i = 0 \\
0 & \text{if } i = -1 \\
\text{Tor}_1^{\mathcal{O}_S}(\mathcal{O}_X, A)
\otimes_{\mathcal{O}_X} \mathcal{F} &
\text{if } i = -2
\end{matrix}
\right.
$$
This observation will guide our construction of $E(\mathcal{F})$
in the remarks below.

\begin{remark}[Direct construction]
\label{remark-construction-E}
Let $S$ be a scheme. Let $f : X \to B$ be a
morphism of algebraic spaces over $S$. Let $U$ be another algebraic
space over $B$. Denote $q : X \times_B U \to U$ the second projection.
Consider the distinguished triangle
$$
Lq^*L_{U/B} \to L_{X \times_B U/B} \to E \to Lq^*L_{U/B}[1]
$$
of Cotangent, Section \ref{cotangent-section-fibre-product}.
For any sheaf $\mathcal{F}$ of
$\mathcal{O}_{X \times_B U}$-modules we have the Atiyah class
$$
\mathcal{F} \to
L_{X \times_B U/B}
\otimes_{\mathcal{O}_{X \times_B U}}^\mathbf{L} \mathcal{F}[1]
$$
see Cotangent, Section \ref{cotangent-section-atiyah-general}.
We can compose this with the map to $E$ and choose a distinguished
triangle
$$
E(\mathcal{F}) \to \mathcal{F} \to
\mathcal{F} \otimes_{\mathcal{O}_{X \times_B U}}^\mathbf{L} E[1] \to
E(\mathcal{F})[1]
$$
in $D(\mathcal{O}_{X \times_B U})$.
By construction the Atiyah class lifts to a map
$$
e_\mathcal{F} :
E(\mathcal{F})
\longrightarrow
Lq^*L_{U/B} \otimes_{\mathcal{O}_{X \times_B U}}^\mathbf{L} \mathcal{F}[1]
$$
fitting into a morphism of distinguished triangles
$$
\xymatrix{
\mathcal{F} \otimes^\mathbf{L} Lq^*L_{U/B}[1] \ar[r] &
\mathcal{F} \otimes^\mathbf{L} L_{X \times_B U/B}[1] \ar[r] &
\mathcal{F} \otimes^\mathbf{L} E[1] \\
E(\mathcal{F}) \ar[r] \ar[u]^{e_\mathcal{F}} &
\mathcal{F} \ar[r] \ar[u]^{Atiyah} &
\mathcal{F} \otimes^\mathbf{L} E[1] \ar[u]^{=}
}
$$
Given $S, B, X, f, U, \mathcal{F}$ we fix a choice of $E(\mathcal{F})$
and $e_\mathcal{F}$.
\end{remark}

\begin{remark}[Construction of obstruction class]
\label{remark-construction-ob}
With notation as in Remark \ref{remark-construction-E} let $i : U \to U'$ be a
first order thickening of $U$ over $B$. Let
$\mathcal{I} \subset \mathcal{O}_{U'}$ be the quasi-coherent sheaf of
ideals cutting out $B$ in $B'$. The fundamental triangle
$$
Li^*L_{U'/B} \to L_{U/B} \to L_{U/U'} \to Li^*L_{U'/B}[1]
$$
together with the map $L_{U/U'} \to \mathcal{I}[1]$ determine a
map $e_{U'} : L_{U/B} \to \mathcal{I}[1]$. Combined with the map
$e_\mathcal{F}$ of the previous remark we obtain
$$
(\text{id}_\mathcal{F} \otimes Lq^*e_{U'}) \cup e_\mathcal{F} :
E(\mathcal{F})
\longrightarrow
\mathcal{F} \otimes_{\mathcal{O}_{X \times_B U}} q^*\mathcal{I}[2]
$$
(we have also composed with the map from the derived tensor product to
the usual tensor product). In other words, we obtain an element
$$
\xi_{U'} \in
\text{Ext}^2_{\mathcal{O}_{X \times_B U}}(
E(\mathcal{F}),
\mathcal{F} \otimes_{\mathcal{O}_{X \times_B U}} q^*\mathcal{I})
$$
\end{remark}

\begin{lemma}
\label{lemma-ob-is-obstruction}
In the situation of Remark \ref{remark-construction-ob} assume that
$\mathcal{F}$ is flat over $U$. Then the vanishing of the class
$\xi_{U'}$ is a necessary and sufficient condition for the existence of a
$\mathcal{O}_{X \times_B U'}$-module $\mathcal{F}'$ flat over $U'$
with $i^*\mathcal{F}' \cong \mathcal{F}$.
\end{lemma}

\begin{proof}[Proof (sketch)]
We will use the criterion of
Deformation Theory, Lemma \ref{defos-lemma-inf-obs-ext-rel-ringed-topoi}.
We will abbreviate $\mathcal{O} = \mathcal{O}_{X \times_B U}$ and
$\mathcal{O}' = \mathcal{O}_{X \times_B U'}$.
Consider the short exact sequence
$$
0 \to \mathcal{I} \to \mathcal{O}_{U'} \to \mathcal{O}_U \to 0.
$$
Let $\mathcal{J} \subset \mathcal{O}'$ be the quasi-coherent
sheaf of ideals cutting out $X \times_B U$. By the above we obtain an exact
sequence
$$
\text{Tor}_1^{\mathcal{O}_B}(\mathcal{O}_X, \mathcal{O}_U) \to
q^*\mathcal{I} \to \mathcal{J} \to 0
$$
where the $\text{Tor}_1^{\mathcal{O}_B}(\mathcal{O}_X, \mathcal{O}_U)$
is an abbreviation for
$$
\text{Tor}_1^{h^{-1}\mathcal{O}_B}(p^{-1}\mathcal{O}_X, q^{-1}\mathcal{O}_U)
\otimes_{(p^{-1}\mathcal{O}_X\otimes_{h^{-1}\mathcal{O}_B}q^{-1}\mathcal{O}_U)}
\mathcal{O}.
$$
Tensoring with $\mathcal{F}$ we obtain the exact sequence
$$
\mathcal{F} \otimes_\mathcal{O}
\text{Tor}_1^{\mathcal{O}_B}(\mathcal{O}_X, \mathcal{O}_U) \to
\mathcal{F} \otimes_\mathcal{O}
q^*\mathcal{I} \to
\mathcal{F} \otimes_\mathcal{O} \mathcal{J} \to 0
$$
(Note that the roles of the letters $\mathcal{I}$ and $\mathcal{J}$
are reversed relative to the notation in
Deformation Theory, Lemma \ref{defos-lemma-inf-obs-ext-rel-ringed-topoi}.)
Condition (1) of the lemma is that the last map above is an
isomorphism, i.e., that the first map is zero.
The vanishing of this map may be checked on stalks at geometric points 
$\overline{z} = (\overline{x}, \overline{u}) : \Spec(k) \to X \times_B U$.
Set $R = \mathcal{O}_{B, \overline{b}}$, $A = \mathcal{O}_{X, \overline{x}}$,
$B = \mathcal{O}_{U, \overline{u}}$, and
$C = \mathcal{O}_{\overline{z}}$.
By Cotangent, Lemma \ref{cotangent-lemma-fibre-product}
and the defining triangle for $E(\mathcal{F})$ we see that
$$
H^{-2}(E(\mathcal{F}))_{\overline{z}} =
\mathcal{F}_{\overline{z}} \otimes \text{Tor}_1^R(A, B)
$$
The map $\xi_{U'}$ therefore induces a map
$$
\mathcal{F}_{\overline{z}} \otimes \text{Tor}_1^R(A, B)
\longrightarrow
\mathcal{F}_{\overline{z}} \otimes_B \mathcal{I}_{\overline{u}}
$$
We claim this map is the same as the stalk of the map described above
(proof omitted; this is a purely ring theoretic statement).
Thus we see that condition (1) of 
Deformation Theory, Lemma \ref{defos-lemma-inf-obs-ext-rel-ringed-topoi}
is equivalent to the vanishing
$H^{-2}(\xi_{U'}) :
H^{-2}(E(\mathcal{F})) \to \mathcal{F} \otimes \mathcal{I}$.

\medskip\noindent
To finish the proof we show that, assuming that condition (1) is satisfied,
condition (2) is equivalent to the vanising of $\xi_{U'}$. In the rest
of the proof we write $\mathcal{F} \otimes \mathcal{I}$ to denote
$\mathcal{F} \otimes_\mathcal{O} q^*\mathcal{I} =
\mathcal{F} \otimes_\mathcal{O} \mathcal{J}$. A consideration
of the spectral sequence
$$
\text{Ext}^i(H^{-j}(E(\mathcal{F})), \mathcal{F} \otimes \mathcal{I})
\Rightarrow
\text{Ext}^{i + j}(E(\mathcal{F}), \mathcal{F} \otimes \mathcal{I})
$$
using that $H^0(E(\mathcal{F})) = \mathcal{F}$ and
$H^{-1}(E(\mathcal{F})) = 0$
shows that there is an exact sequence
$$
0 \to
\text{Ext}^2(\mathcal{F}, \mathcal{F} \otimes \mathcal{I}) \to
\text{Ext}^2(E(\mathcal{F}), \mathcal{F} \otimes \mathcal{I}) \to
\Hom(H^{-2}(E(\mathcal{F})), \mathcal{F} \otimes \mathcal{I})
$$
Thus our element $\xi_{U'}$ is an element of
$\text{Ext}^2(\mathcal{F}, \mathcal{F} \otimes \mathcal{I})$.
The proof is finished by showing this element agrees with the
element of
Deformation Theory, Lemma \ref{defos-lemma-inf-obs-ext-rel-ringed-topoi}
a verification we omit.
\end{proof}

\begin{lemma}
\label{lemma-coherent-defo-thy-general}
In Situation \ref{situation-coherent} assume that
$S$ is a locally Noetherian scheme and $S = B$.
Let $\mathcal{X} = \textit{Coh}_{X/B}$.
Then we have openness of versality for $\mathcal{X}$ (see
Artin's Axioms, Definition \ref{artin-definition-openness-versality}).
\end{lemma}

\begin{proof}[Proof (sketch)]
Let $U \to S$ be of finite type morphism of schemes, $x$ an object of
$\mathcal{X}$ over $U$ and $u_0 \in U$ a finite type point such that
$x$ is versal at $u_0$. After shrinking $U$ we may assume that $u_0$
is a closed point (Morphisms, Lemma \ref{morphisms-lemma-point-finite-type})
and $U = \Spec(A)$ with $U \to S$ mapping into an
affine open $\Spec(\Lambda)$ of $S$. We will use
Artin's Axioms, Lemma \ref{artin-lemma-dual-openness} to prove the lemma.
Let $\mathcal{F}$ be the coherent module on $X_A = \Spec(A) \times_S X$
flat over $A$ corresponding to the given object $x$.

\medskip\noindent
Choose $E(\mathcal{F})$ and $e_\mathcal{F}$ as in
Remark \ref{remark-construction-E}.
The description of the cohomology sheaves of $E(\mathcal{F})$ shows
that
$$
\text{Ext}^1(E(\mathcal{F}), \mathcal{F} \otimes_A M) =
\text{Ext}^1(\mathcal{F}, \mathcal{F} \otimes_A M)
$$
for any $A$-module $M$. Using this and using
Deformation Theory, Lemma \ref{defos-lemma-inf-ext-rel-ringed-topoi}
we have an isomorphism of functors
$$
T_x(M) = \text{Ext}^1_{X_A}(E(\mathcal{F}), \mathcal{F} \otimes_A M)
$$
By Lemma \ref{lemma-ob-is-obstruction} given any surjection $A' \to A$
of $\Lambda$-algebras with square zero kernel $I$ we have an obstruction class
$$
\xi_{A'} \in \text{Ext}^2_{X_A}(E(\mathcal{F}), \mathcal{F} \otimes_A I)
$$
Apply Derived Categories of Spaces, Lemma
\ref{spaces-perfect-lemma-compute-ext}
to the computation of the Ext groups
$\text{Ext}^i_{X_A}(E(\mathcal{F}), \mathcal{F} \otimes_A M)$
for $i \leq m$ with $m = 2$. We omit the verification that
$E(\mathcal{F})$ is in $D^-_{\textit{Coh}}$; hint: use
Cotangent, Lemma \ref{cotangent-lemma-cotangent-finite}.
We find a perfect object $K \in D(A)$
and functorial isomorphisms
$$
H^i(K \otimes_A^\mathbf{L} M)
\longrightarrow
\text{Ext}^i_{X_A}(E(\mathcal{F}), \mathcal{F} \otimes_A M)
$$
for $i \leq m$ compatible with boundary maps. This object $K$, together
with the displayed identifications above gives us a datum as in
Artin's Axioms, Situation \ref{artin-situation-dual}.
Finally, condition (iv) of
Artin's Axioms, Lemma \ref{artin-lemma-dual-obstruction}
holds by a variant of
Deformation Theory, Lemma \ref{defos-lemma-verify-iv-ringed-topoi}
whose formulation and proof we omit.
Thus Artin's Axioms, Lemma \ref{artin-lemma-dual-openness}
applies and the lemma is proved.
\end{proof}

\begin{theorem}[Algebraicity of stack coherent sheaves; general case]
\label{theorem-coherent-algebraic-general}
Let $S$ be a scheme. Let $f : X \to B$ be morphism of algebraic spaces
over $S$. Assume that $f$ is of finite presentation. Then
$\textit{Coh}_{X/B}$ is an algebraic stack over $S$.
\end{theorem}

\begin{proof}
Identical to the proof of Theorem \ref{theorem-coherent-algebraic}
except that we substitute
Lemma \ref{lemma-coherent-defo-thy-general} for
Lemma \ref{lemma-coherent-defo-thy}.
\end{proof}









\section{Flattening functors}
\label{section-F-zero}

\noindent
This section is the analogue of
More on Flatness, Section \ref{flat-section-flattening-functors}.
We urge the reader to skip this section on a first reading.

\begin{situation}
\label{situation-iso}
Let $S$ be a scheme.
Let $f : X \to B$ be a morphism of algebraic spaces over $S$.
Let $u : \mathcal{F} \to \mathcal{G}$ be a homomorphism of
quasi-coherent $\mathcal{O}_X$-modules. For any scheme $T$ over
$B$ we will denote $u_T : \mathcal{F}_T \to \mathcal{G}_T$ the
base change of $u$ to $T$, in other words, $u_T$ is the pullback
of $u$ via the projection morphism $X_T = X \times_B T \to X$.
In this situation we can consider the functor
\begin{equation}
\label{equation-iso}
F_{iso} : (\Sch/B)^{opp} \longrightarrow \textit{Sets}, \quad
T \longrightarrow \left\{
\begin{matrix}
\{*\} & \text{if }u_T\text{ is an isomorphism}, \\
\emptyset & \text{else.}
\end{matrix}
\right.
\end{equation}
There are variants $F_{inj}$, $F_{surj}$, $F_{zero}$ where we ask that
$u_T$ is injective, surjective, or zero.
\end{situation}

\noindent
In Situation \ref{situation-iso} we sometimes think of the functors
$F_{iso}$, $F_{inj}$, $F_{surj}$, and $F_{zero}$ as functors
$(\Sch/S)^{opp} \to \textit{Sets}$ endowed with a morphism
$F_{iso} \to B$, $F_{inj} \to B$, $F_{surj} \to B$, and $F_{zero} \to B$.
Namely, if $T$ is a scheme over $S$, then an element $h \in F_{iso}(T)$
is just a morphism $h : T \to B$, i.e., an element $h \in B(T)$,
such that the base change of $u$ via $h$ is an isomorphism.
In particular, when we say
that $F_{iso}$ is an algebraic space, we mean that the corresponding
functor $(\Sch/S)^{opp} \to \textit{Sets}$ is an algebraic space.

\begin{lemma}
\label{lemma-iso-sheaf}
In Situation \ref{situation-iso}.
Each of the functors $F_{iso}$, $F_{inj}$, $F_{surj}$, $F_{zero}$
satisfies the sheaf property for the fpqc topology.
\end{lemma}

\begin{proof}
Let $\{T_i \to T\}_{i \in I}$ be an fpqc covering of schemes over $B$.
Set $X_i = X_{T_i} = X \times_S T_i$ and $u_i = u_{T_i}$.
Note that $\{X_i \to X_T\}_{i \in I}$ is an fpqc covering of $X_T$, see
Topologies on Spaces, Lemma \ref{spaces-topologies-lemma-fpqc}.
In particular, for every $x \in |X_T|$ there exists an $i \in I$
and an $x_i \in |X_i|$ mapping to $x$. Since
$\mathcal{O}_{X_T, \overline{x}} \to \mathcal{O}_{X_i, \overline{x_i}}$
is flat, hence faithfully flat (see 
Morphisms of Spaces, Section \ref{spaces-morphisms-section-flat}).
we conclude that $(u_i)_{x_i}$ is injective, surjective, bijective, or zero
if and only if $(u_T)_x$ is injective, surjective, bijective, or zero.
The lemma follows.
\end{proof}

\begin{lemma}
\label{lemma-iso-go-up}
In Situation \ref{situation-iso} let $X' \to X$ be a flat morphism
of algebraic spaces. Denote $u' : \mathcal{F}' \to \mathcal{G}'$
the pullback of $u$ to $X'$. Denote $F'_{iso}$, $F'_{inj}$, $F'_{surj}$,
$F'_{zero}$ the functors on $\Sch/B$ associated to $u'$.
\begin{enumerate}
\item If $\mathcal{G}$ is of finite type and the image of $|X'| \to |X|$
contains the support of $\mathcal{G}$, then $F_{surj} = F'_{surj}$
and $F_{zero} = F'_{zero}$.
\item If $\mathcal{F}$ is of finite type and the image of $|X'| \to |X|$
contains the support of $\mathcal{F}$, then $F_{inj} = F'_{inj}$
and $F_{zero} = F'_{zero}$.
\item If $\mathcal{F}$ and $\mathcal{G}$ are of finite type and the image of
$|X'| \to |X|$ contains the supports of $\mathcal{F}$ and $\mathcal{G}$,
then $F_{iso} = F'_{iso}$.
\end{enumerate}
\end{lemma}

\begin{proof}
let $v : \mathcal{H} \to \mathcal{E}$ be a map of quasi-coherent
modules on an algebraic space $Y$ and let $\varphi : Y' \to Y$ be a
surjective flat morphism of algebraic spaces, then $v$ is
an isomorphism, injective, surjective, or zero if and only if $\varphi^*v$ is
an isomorphism, injective, surjective, or zero. Namely,
for every $y \in |Y|$ there exists a $y' \in |Y'|$ and the map
of local rings
$\mathcal{O}_{Y, \overline{y}} \to \mathcal{O}_{Y', \overline{y'}}$
is faithfully flat (see
Morphisms of Spaces, Section \ref{spaces-morphisms-section-flat}).
Of course, to check for injectivity or being zero it suffices to look
at the points in the support of $\mathcal{H}$, and to check for
surjectivity it suffices to look at points in the support of $\mathcal{E}$.
Moreover, under the finite type assumptions as in the statement of
the lemma, taking the supports commutes with base change, see
Morphisms of Spaces, Lemma \ref{spaces-morphisms-lemma-support-finite-type}.
Thus the lemma is clear.
\end{proof}

\noindent
Recall that we've defined the scheme theoretic support of a finite
type quasi-coherent module in Morphisms of Spaces, Definition
\ref{spaces-morphisms-definition-scheme-theoretic-support}.

\begin{lemma}
\label{lemma-iso-limits}
In Situation \ref{situation-iso}.
\begin{enumerate}
\item If $\mathcal{G}$ is of finite type and the scheme theoretic support
of $\mathcal{G}$ is quasi-compact over $B$, then $F_{surj}$ is limit
preserving.
\item If $\mathcal{F}$ of finite type and the scheme theoretic support
of $\mathcal{F}$ is quasi-compact over $B$, then
$F_{zero}$ is limit preserving.
\item If $\mathcal{F}$ is of finite type,
$\mathcal{G}$ is of finite presentation, and the
scheme theoretic supports of $\mathcal{F}$ and $\mathcal{G}$ are
quasi-compact over $B$, then $F_{iso}$ is limit preserving.
\end{enumerate}
\end{lemma}

\begin{proof}
Proof of (1). Let $i : Z \to X$ be the scheme theoretic support of
$\mathcal{G}$ and think of $\mathcal{G}$ as a finite type quasi-coherent
module on $Z$. We may replace $X$ by $Z$ and $u$ by the map
$i^*\mathcal{F} \to \mathcal{G}$ (details omitted). Hence we may assume
$f$ is quasi-compact and $\mathcal{G}$ of finite type.
Let $T = \lim_{i \in I} T_i$ be a directed limit of affine $B$-schemes
and assume that $u_T$ is surjective.
Set $X_i = X_{T_i} = X \times_S T_i$ and
$u_i = u_{T_i} : \mathcal{F}_i = \mathcal{F}_{T_i}
\to \mathcal{G}_i = \mathcal{G}_{T_i}$.
To prove (1) we have to show that $u_i$ is surjective for some $i$.
Pick $0 \in I$ and replace $I$ by $\{i \mid i \geq 0\}$.
Since $f$ is quasi-compact we see $X_0$ is quasi-compact.
Hence we may choose a surjective \'etale morphism $\varphi_0 : W_0 \to X_0$
where $W_0$ is an affine scheme. Set $W = W_0 \times_{T_0} T$
and $W_i = W_0 \times_{T_0} T_i$ for $i \geq 0$.  These
are affine schemes endowed
with a surjective \'etale morphisms $\varphi : W \to X_T$ and
$\varphi_i : W_i \to X_i$. Note that $W = \lim W_i$.
Hence $\varphi^*u_T$ is surjective and it suffices to prove that
$\varphi_i^*u_i$ is surjective for some $i$. Thus we have reduced
the problem to the affine case which is
Algebra, Lemma \ref{algebra-lemma-module-map-property-in-colimit} part (2).

\medskip\noindent
Proof of (2). Assume $\mathcal{F}$ is of finite type with scheme theoretic
support $Z \subset B$ quasi-compact over $B$. Let $T = \lim_{i \in I} T_i$
be a directed limit of affine $B$-schemes and assume that $u_T$ is zero.
Set $X_i = T_i \times_B X$ and denote $u_i : \mathcal{F}_i \to \mathcal{G}_i$
the pullback. Choose $0 \in I$ and replace $I$ by
$\{i \mid i \geq 0\}$. Set $Z_0 = Z \times_X X_0$. By
Morphisms of Spaces, Lemma \ref{spaces-morphisms-lemma-support-finite-type}
the support of $\mathcal{F}_i$ is $|Z_0|$. Since $|Z_0|$ is quasi-compact
we can find an affine scheme $W_0$ and an \'etale morphism $W_0 \to X_0$
such that $|Z_0| \subset \Im(|W_0| \to |X_0|)$.
Set $W = W_0 \times_{T_0} T$ and $W_i = W_0 \times_{T_0} T_i$ for $i \geq 0$.
These are affine schemes endowed
with \'etale morphisms $\varphi : W \to X_T$ and
$\varphi_i : W_i \to X_i$. Note that $W = \lim W_i$
and that the support of $\mathcal{F}_T$ and $\mathcal{F}_i$
is contained in the image of $|W| \to |X_T|$ and $|W_i| \to |X_i|$.
Now $\varphi^*u_T$ is injective and it suffices to prove that
$\varphi_i^*u_i$ is injective for some $i$.
Thus we have reduced the problem to the affine case which is
Algebra, Lemma \ref{algebra-lemma-module-map-property-in-colimit} part (1).

\medskip\noindent
Proof of (3). This can be proven in exactly the same manner as in the
previous two paragraphs using
Algebra, Lemma \ref{algebra-lemma-module-map-property-in-colimit} part (3).
We can also deduce it from (1) and (2) as follows.
Let $T = \lim_{i \in I} T_i$ be a directed limit of affine $B$-schemes
and assume that $u_T$ is an isomorphism. By part (1) there exists
an $0 \in I$ such that $u_{T_0}$ is surjective. Set
$\mathcal{K} = \Ker(u_{T_0})$ and consider the map of quasi-coherent
modules $v : \mathcal{K} \to \mathcal{F}_{T_0}$. For $i \geq 0$ the base
change $v_{T_i}$ is zero if and only if $u_i$ is an isomorphism. Moreover,
$v_T$ is zero. Since $\mathcal{G}_{T_0}$
is of finite presentation, $\mathcal{F}_{T_0}$ is of finite type, and
$u_{T_0}$ is surjective we conclude that $\mathcal{K}$ is of finite type
(Modules on Sites, Lemma
\ref{sites-modules-lemma-kernel-surjection-finite-onto-finite-presentation}).
It is clear that the support of $\mathcal{K}$ is contained in the
support of $\mathcal{F}_{T_0}$ which is quasi-compact over $T_0$.
Hence we can apply part (2) to see that $v_{T_i}$ is zero for some $i$. 
\end{proof}

\begin{lemma}
\label{lemma-F-zero-somewhat-closed}
Let $S = \Spec(R)$ be an affine scheme. Let $X$ be an algebraic space over
$S$. Let $u : \mathcal{F} \to \mathcal{G}$ be a map of quasi-coherent
$\mathcal{O}_X$-modules. Assume $\mathcal{G}$ flat over $S$. Let $T \to S$
be a quasi-compact morphism of schemes such that the base change $u_T$ is
zero. Then exists a closed subscheme $Z \subset S$ such that
(a) $T \to S$ factors through $Z$ and (b) the base change $u_Z$ is zero.
If $\mathcal{F}$ is a finite type $\mathcal{O}_X$-module and
the scheme theoretic support of $\mathcal{F}$ is quasi-compact,
then we can take $Z \to S$ of finite presentation.
\end{lemma}

\begin{proof}
Let $U \to X$ be a surjective \'etale morphism of algebraic spaces
where $U = \coprod U_i$ is a disjoint union of affine schemes (see
Properties of Spaces, Lemma
\ref{spaces-properties-lemma-cover-by-union-affines}).
By Lemma \ref{lemma-iso-go-up} we see that we may
replace $X$ by $U$. In other words, we may assume that $X = \coprod X_i$
is a disjoint union of affine schemes $X_i$. Suppose that we can prove
the lemma for $u_i = u|_{X_i}$. Then we find a closed subscheme
$Z_i \subset S$ such that $T \to S$ factors through $Z_i$ and
$u_{i, Z_i}$ is zero. If
$Z_i = \Spec(R/I_i) \subset \Spec(R) = S$, then taking
$Z = \Spec(R/\sum I_i)$ works. Thus we may assume that
$X = \Spec(A)$ is affine.

\medskip\noindent
Choose a finite affine open covering $T = T_1 \cup \ldots \cup T_m$.
It is clear that we may replace $T$ by $\coprod_{j = 1, \ldots, m} T_j$.
Hence we may assume $T$ is affine. Say $T = \Spec(R')$.
Let $u : M \to N$ be the homomorphisms of $A$-modules
corresponding to $u : \mathcal{F} \to \mathcal{G}$.
Then $N$ is a flat $R$-module as $\mathcal{G}$ is flat over $S$.
The assumption of the lemma means that the composition
$$
M \otimes_R R' \to N \otimes_R R'
$$
is zero. Let $z \in M$. By Lazard's theorem
(Algebra, Theorem \ref{algebra-theorem-lazard}) and the fact
that $\otimes$ commutes with colimits we can find free $R$-module
$F_z$, an element $\tilde z \in F_z$, and a map $F_z \to N$ such that
$u(z)$ is the image of $\tilde z$ and $\tilde z$ maps to zero in
$F_z \otimes_R R'$. Choose a basis $\{e_{z, \alpha}\}$ of $F_z$ and write
$\tilde z = \sum f_{z, \alpha} e_{z, \alpha}$ with $f_{z, \alpha} \in R$.
Let $I \subset R$ be the ideal generated by the elements $f_{z, \alpha}$
with $z$ ranging over all elements of $M$.
By construction $I$ maps to zero in $R'$ and the elements $\tilde z$
map to zero in $F_z/IF_z$ whence in $N/IN$. Thus $Z = \Spec(R/I)$
is a solution to the problem in this case.

\medskip\noindent
Assume $\mathcal{F}$ is of finite type with quasi-compact scheme
theoretic support. Write $Z = \Spec(R/I)$.
Write $I = \bigcup I_\lambda$ as a filtered union of finitely generated
ideals. Set $Z_\lambda = \Spec(R/I_\lambda)$, so $Z = \colim Z_\lambda$.
Since $u_Z$ is zero, we see that $u_{Z_\lambda}$ is zero
for some $\lambda$ by Lemma \ref{lemma-iso-limits}.
This finishes the proof of the lemma.
\end{proof}

\begin{lemma}
\label{lemma-F-zero-module-map}
Let $A$ be a ring. Let $u : M \to N$ be a map of $A$-modules.
If $N$ is projective as an $A$-module, then there exists an ideal
$I \subset A$ such that for any ring map $\varphi : A \to B$
the following are equivalent
\begin{enumerate}
\item $u \otimes 1 : M \otimes_A B \to N \otimes_A B$ is zero, and
\item $\varphi(I) = 0$.
\end{enumerate}
\end{lemma}

\begin{proof}
As $M$ is projective we can find a projective $A$-module $C$
such that $F = N \oplus C$ is a free $R$-module.
By replacing $u$ by $u \oplus 1 : F = M \oplus C \to N \oplus C$
we see that we may assume $N$ is free. In this case let $I$ be
the ideal of $A$ generated by coefficients of all the elements of
$\Im(u)$ with respect to some (fixed) basis of $N$.
\end{proof}

\noindent
It would be interesting to find a simple direct proof of the following
lemma using the result of Lemma \ref{lemma-F-zero-somewhat-closed}.
A ``classical'' proof of this lemma when $f : X \to B$ is a projective
morphism and $B$ a Noetherian scheme would be: (a) choose a relatively ample
invertible sheaf $\mathcal{O}_X(1)$, (b) set
$u_n : f_*\mathcal{F}(n) \to f_*\mathcal{G}(n)$,
(c) observe that $f_*\mathcal{G}(n)$ is a finite locally free sheaf
for all $n \gg 0$, and (d) $F_{zero}$ is represented by the vanishing
locus of $u_n$ for some $n \gg 0$.

\begin{lemma}
\label{lemma-F-zero-closed}
In Situation \ref{situation-iso}. Assume
\begin{enumerate}
\item $f$ is locally of finite presentation,
\item $\mathcal{G}$ is an $\mathcal{O}_X$-module of finite presentation
flat over $B$,
\item the scheme theoretic support of $\mathcal{G}$ is proper over $B$.
\end{enumerate}
Then the functor $F_{zero}$ is an algebraic space and $F_{zero} \to B$
is a closed immersion. If $\mathcal{F}$ is of finite type, then
$F_{zero} \to B$ is of finite presentation.
\end{lemma}

\begin{proof}
In order to prove that $F_{zero}$ is an algebraic space, it suffices
to show that $F_{zero} \to B$ is representable, see
Spaces, Lemma \ref{spaces-lemma-representable-over-space}.
Let $B' \to B$ be a morphism where $B'$ is a scheme and let
$u' : \mathcal{F}' \to \mathcal{G}'$ be the pullback of $u$ to $X' = X_{B'}$.
Then the associated functor $F'_{zero}$ equals $F_{zero} \times_B B'$.
This reduces us to the case that $B$ is a scheme.

\medskip\noindent
Assume $B$ is a scheme. We will show that $F_{zero}$ is representable
by a closed subscheme of $B$. By Lemma \ref{lemma-iso-sheaf} and
Descent, Lemmas \ref{descent-lemma-closed-immersion} and
\ref{descent-lemma-descent-data-sheaves}
the question is local for the \'etale topology on $B$. Let $b \in B$.
We first replace $B$ by an affine neighbourhood of $b$.
Denote $Z \subset X$ the scheme theoretic support of $\mathcal{G}$.
Denote $Z_b \subset X_b$ the fibre of $Z \subset X \to B$ over $b$.
The space $|Z_b|$ is quasi-compact by the last assumption of the lemma.
Choose an affine scheme $U$ and an \'etale morphism $\varphi : U \to X$
such that $|Z_b| \subset \Im(|U| \to |X|)$. After replacing $B$ by an
affine elementary \'etale neighbourhood of $b$ and replacing $U$
by some affine $U'$ \'etale over $U$ with $U'_b \to U_b$ surjective,
we may assume that $\Gamma(U, \varphi^*\mathcal{G})$ is a projective
$\Gamma(B, \mathcal{O}_B)$-module, see
More on Flatness, Lemma \ref{flat-lemma-finite-presentation-flat-along-fibre}.
Since $Z \to B$ is proper the image of
$$
|Z| \setminus \Im(|U| \to |X|)
$$
in $|B|$ is a closed subset not containing $b$. Hence, after replacing
$B$ by an affine open containing $b$, we may assume that
$|Z| \subset \Im(|U| \to |X|)$. (To be sure, after this replacement
it is still true that $\Gamma(U, \varphi^*\mathcal{G})$ is a projective
$\Gamma(B, \mathcal{O}_B)$-module.) By Lemma \ref{lemma-iso-go-up}
we see that $F_{zero}$ is the same as the corresponding functor
for the map $\varphi^*\mathcal{F} \to \varphi^*\mathcal{G}$.
This case follows immediately from Lemma \ref{lemma-F-zero-module-map}.

\medskip\noindent
We still have to show that $F_{zero} \to B$ is of finite presentation if
$\mathcal{F}$ is of finite type. Let $\mathcal{F}' \subset \mathcal{G}$
be the image of $u$ and denote $F'_{zero}$ the functor corresponding
to $\mathcal{F}' \to \mathcal{G}$. Then $F_{zero} = F'_{zero}$ and
the scheme theoretic support of $\mathcal{F}'$ is a closed subspace of
the scheme theoretic support of $\mathcal{G}$, hence proper over $B$.
Thus Lemma \ref{lemma-iso-limits} implies that $F_{zero} = F'_{zero}$
is limit preserving over $B$. We conclude by Limits of Spaces, Proposition
\ref{spaces-limits-proposition-characterize-locally-finite-presentation}.
\end{proof}

\noindent
The following result is a variant of
More on Flatness, Theorem \ref{flat-theorem-flattening-map}.

\begin{lemma}
\label{lemma-F-iso-closed}
In Situation \ref{situation-iso}. Assume
\begin{enumerate}
\item $f$ is locally of finite presentation,
\item $\mathcal{F}$ is locally of finite presentation and flat over $B$,
\item the scheme theoretic support of $\mathcal{F}$ is proper over $B$, and
\item $u$ is surjective.
\end{enumerate}
Then the functor $F_{iso}$ is an algebraic space and $F_{iso} \to B$
is a closed immersion. If $\mathcal{G}$ is of finite presentation, then
$F_{iso} \to B$ is of finite presentation.
\end{lemma}

\begin{proof}
Let $\mathcal{K} = \Ker(u)$ and apply Lemma \ref{lemma-F-zero-closed}
to $\mathcal{K} \to \mathcal{F}$. Note that $\mathcal{K}$ is of finite type
if $\mathcal{G}$ is of finite presentation, see
Modules on Sites, Lemma
\ref{sites-modules-lemma-kernel-surjection-finite-onto-finite-presentation}.
\end{proof}

\noindent
We will use the following (easy) result when discussing the Quot functor.

\begin{lemma}
\label{lemma-F-surj-open}
In Situation \ref{situation-iso}. Assume
\begin{enumerate}
\item $f$ is locally of finite presentation,
\item $\mathcal{G}$ is of finite type,
\item the scheme theoretic support of $\mathcal{G}$ is proper over $B$.
\end{enumerate}
Then $F_{surj}$ is an algebraic space and $F_{surj} \to B$
is an open immersion.
\end{lemma}

\begin{proof}
Consider $\Coker(u)$. Observe that
$\Coker(u_T) = \Coker(u)_T$ for any $T/B$.
Note that formation of the support of a finite type
quasi-coherent module commutes with pullback
(Morphisms of Spaces, Lemma \ref{spaces-morphisms-lemma-support-covering}).
Hence $F_{surj}$ is representable by the open subspace of $B$
corresponding to the open set
$$
|B| \setminus |f|(\text{Supp}(\Coker(u)))
$$
see Properties of Spaces, Lemma \ref{spaces-properties-lemma-open-subspaces}.
This is an open because $|f|$ is closed on $\text{Supp}(\mathcal{G})$
and $\text{Supp}(\Coker(u))$ is a closed subset of
$\text{Supp}(\mathcal{G})$.
\end{proof}










\section{The functor of quotients}
\label{section-functor-quotients}

\noindent
In this section we discuss some generalities regarding the functor
$Q_{\mathcal{F}/X/B}$ defined below.
The notation $\text{Quot}_{\mathcal{F}/X/B}$ is reserved for a
subfunctor of $\text{Q}_{\mathcal{F}/X/B}$.
We urge the reader to skip this section on a first reading.

\begin{situation}
\label{situation-q}
Let $S$ be a scheme. Let $f : X \to B$ be a morphism of algebraic spaces
over $S$. Let $\mathcal{F}$ be a quasi-coherent $\mathcal{O}_X$-module.
For any scheme $T$ over $B$ we will denote $X_T$ the base change of
$X$ to $T$ and $\mathcal{F}_T$ the pullback
of $\mathcal{F}$ via the projection morphism $X_T = X \times_S T \to X$.
Given such a $T$ we set
$$
\text{Q}_{\mathcal{F}/X/B}(T) =
\left\{
\begin{matrix}
\text{quotients }\mathcal{F}_T \to \mathcal{Q}\text{ where }
\mathcal{Q}\text{ is a quasi-coherent }\\
\mathcal{O}_{X_T}\text{-module of finite presentation, flat over }T
\end{matrix}
\right\}
$$
We identify quotients if they have the same kernel. Suppose
that $T' \to T$ is a morphism of schemes over $B$ and
$\mathcal{F}_T \to \mathcal{Q}$ is an element of
$\text{Q}_{\mathcal{F}/X/B}(T)$. Then the pullback
$\mathcal{Q}' = (X_{T'} \to X_T)^*\mathcal{Q}$ is a quasi-coherent
$\mathcal{O}_{X_{T'}}$-module of finite presentation flat over $T'$
(see Properties of Spaces, Section
\ref{spaces-properties-section-properties-modules}
and
Morphisms of Spaces, Lemma
\ref{spaces-morphisms-lemma-base-change-module-flat}).
Thus we obtain a functor
\begin{equation}
\label{equation-q}
\text{Q}_{\mathcal{F}/X/B} : (\Sch/B)^{opp} \longrightarrow \textit{Sets}
\end{equation}
This is the functor of quotients of $\mathcal{F}/X/B$.
\end{situation}

\noindent
In Situation \ref{situation-q} we sometimes think of
$\text{Q}_{\mathcal{F}/X/B}$ as a functor
$(\Sch/S)^{opp} \to \textit{Sets}$ endowed
with a morphism $\text{Q}_{\mathcal{F}/X/S} \to B$.
Namely, if $T$ is a scheme over $S$, then we can think of an element
of $\text{Q}_{\mathcal{F}/X/B}$ as a pair $(h, \mathcal{Q})$
where $h$ a morphism $h : T \to B$, i.e., an element $h \in B(T)$,
and $\mathcal{Q}$ is a $T$-flat quotient $\mathcal{F}_T \to \mathcal{Q}$
of finite presentation on $X_T = X \times_{B, h} T$. In particular, when we say
that $\text{Q}_{\mathcal{F}/X/S}$ is an algebraic space, we mean that the
corresponding functor $(\Sch/S)^{opp} \to \textit{Sets}$ is an algebraic space.

\begin{remark}
\label{remark-q-base-change}
In Situation \ref{situation-q} let $B' \to B$ be a morphism of
algebraic spaces over $S$. Set $X' = X \times_B B'$ and denote
$\mathcal{F}'$ the pullback of $\mathcal{F}$ to $X'$.
Thus we have the functor $Q_{\mathcal{F}'/X'/B'}$ on
the category of schemes over $B'$. For a scheme $T$ over $B'$
it is clear that we have
$$
Q_{\mathcal{F}'/X'/B'}(T) = Q_{\mathcal{F}/X/B}(T)
$$
where on the right hand side we think of $T$ as a scheme over $B$
via the composition $T \to B' \to B$. This trivial remark
will occasionally be useful to change the base algebraic space.
\end{remark}

\begin{remark}
\label{remark-q-sheaf}
Let $S$ be a scheme, $X$ an algebraic space over $S$, and $\mathcal{F}$
a quasi-coherent $\mathcal{O}_X$-module. Suppose that
$\{f_i : X_i \to X\}_{i \in I}$
is an fpqc covering and for each $i, j \in I$ we are given an fpqc covering
$\{X_{ijk} \to X_i \times_X X_j\}$. In this situation we have a bijection
$$
\left\{
\begin{matrix}
\text{quotients }\mathcal{F} \to \mathcal{Q}\text{ where } \\
\mathcal{Q}\text{ is a quasi-coherent }\\
\end{matrix}
\right\}
\longrightarrow
\left\{
\begin{matrix}
\text{families of quotients }f_i^*\mathcal{F} \to \mathcal{Q}_i
\text{ where } \\
\mathcal{Q}_i\text{ is quasi-coherent and }
\mathcal{Q}_i\text{ and }\mathcal{Q}_j\\
\text{ restrict to the same quotient on }X_{ijk}
\end{matrix}
\right\}
$$
Namely, let $(f_i^*\mathcal{F} \to \mathcal{Q}_i)_{i \in I}$
be an element of the right hand side. Then since
$\{X_{ijk} \to X_i \times_X X_j\}$ is an fpqc covering we see that
the pullbacks of $\mathcal{Q}_i$ and $\mathcal{Q}_j$ restrict
to the same quotient of the pullback of $\mathcal{F}$ to $X_i \times_X X_j$
(by fully faithfulness in
Descent on Spaces, Proposition
\ref{spaces-descent-proposition-fpqc-descent-quasi-coherent}).
Hence we obtain a descent datum for quasi-coherent modules
with respect to $\{X_i \to X\}_{i \in I}$. By
Descent on Spaces, Proposition
\ref{spaces-descent-proposition-fpqc-descent-quasi-coherent}
we find a map of quasi-coherent $\mathcal{O}_X$-modules
$\mathcal{F} \to \mathcal{Q}$ whose restriction to $X_i$ recovers
the given maps $f_i^*\mathcal{F} \to \mathcal{Q}_i$.
Since the family of morphisms $\{X_i \to X\}$ is jointly surjective
and flat, for every point $x \in |X|$ there exists an $i$ and a point
$x_i \in |X_i|$ mapping to $x$. Note that the induced map on
local rings
$\mathcal{O}_{X, \overline{x}} \to \mathcal{O}_{X_i, \overline{x_i}}$
is faithfully flat, see
Morphisms of Spaces, Section \ref{spaces-morphisms-section-flat}.
Thus we see that $\mathcal{F} \to \mathcal{Q}$ is surjective.
\end{remark}

\begin{lemma}
\label{lemma-q-sheaf}
In Situation \ref{situation-q}. The functor $\text{Q}_{\mathcal{F}/X/B}$
satisfies the sheaf property for the fpqc topology.
\end{lemma}

\begin{proof}
Let $\{T_i \to T\}_{i \in I}$ be an fpqc covering of schemes over $S$.
Set $X_i = X_{T_i} = X \times_S T_i$ and $\mathcal{F}_i = \mathcal{F}_{T_i}$.
Note that $\{X_i \to X_T\}_{i \in I}$ is an fpqc covering of
$X_T$ (Topologies on Spaces, Lemma \ref{spaces-topologies-lemma-fpqc})
and that $X_{T_i \times_T T_{i'}} = X_i \times_{X_T} X_{i'}$.
Suppose that $\mathcal{F}_i \to \mathcal{Q}_i$ is a collection of
elements of $\text{Q}_{\mathcal{F}/X/B}(T_i)$ such that $\mathcal{Q}_i$
and $\mathcal{Q}_{i'}$ restrict to the same element of
$\text{Q}_{\mathcal{F}/X/B}(T_i \times_T T_{i'})$. By
Remark \ref{remark-q-sheaf}
we obtain a surjective map of quasi-coherent $\mathcal{O}_{X_T}$-modules
$\mathcal{F}_T \to \mathcal{Q}$ whose restriction to $X_i$ recovers
the given quotients.
By Morphisms of Spaces, Lemma \ref{spaces-morphisms-lemma-flat-permanence}
we see that $\mathcal{Q}$ is flat over $T$. Finally,
Descent on Spaces, Lemma
\ref{spaces-descent-lemma-finite-presentation-descends}
guarantees that $\mathcal{Q}$ is of finite presentation as an
$\mathcal{O}_{X_T}$-module.
\end{proof}

\begin{lemma}
\label{lemma-q-sheaf-in-X}
In Situation \ref{situation-q} let $\{X_i \to X\}_{i \in I}$ be an fppf
covering and for each $i, j \in I$ let $\{X_{ijk} \to X_i \times_X X_j\}$
be an fppf covering. Denote $\mathcal{F}_i$, resp.\ $\mathcal{F}_{ijk}$
the pullback of $\mathcal{F}$ to $X_i$, resp.\ $X_{ijk}$. For every scheme
$T$ over $B$ the diagram
$$
\xymatrix{
Q_{\mathcal{F}/X/B}(T) \ar[r] &
\prod\nolimits_i
Q_{\mathcal{F}_i/X_i/B}(T)
\ar@<1ex>[r]^-{\text{pr}_0^*} \ar@<-1ex>[r]_-{\text{pr}_1^*}
&
\prod\nolimits_{i, j, k}
Q_{\mathcal{F}_{ijk}/X_{ijk}/B}(T)
}
$$
presents the first arrow as the equalizer of the other two.
\end{lemma}

\begin{proof}
Let $\mathcal{F}_{i, T} \to \mathcal{Q}_i$ be an element in the equalizer
of $\text{pr}_0^*$ and $\text{pr}_1^*$. By Remark \ref{remark-q-sheaf}
we obtain a surjection $\mathcal{F}_T \to \mathcal{Q}$ of quasi-coherent
$\mathcal{O}_{X_T}$-modules whose restriction to $X_{i, T}$ recovers
$\mathcal{F}_i \to \mathcal{Q}_i$.
By Morphisms of Spaces, Lemma \ref{spaces-morphisms-lemma-flat-permanence}
we see that $\mathcal{Q}$ is flat over $T$ as desired.
\end{proof}

\begin{lemma}
\label{lemma-q-limit-preserving}
In Situation \ref{situation-q} assume also that
(a) $f$ is quasi-compact and quasi-separated and
(b) $\mathcal{F}$ is of finite presentation.
Then the functor $\text{Q}_{\mathcal{F}/X/B}$
is limit preserving in the following sense: If $T = \lim T_i$ is a
directed limit of affine schemes over $B$, then
$\text{Q}_{\mathcal{F}/X/B}(T) = \colim \text{Q}_{\mathcal{F}/X/B}(T_i)$.
\end{lemma}

\begin{proof}
Let $T = \lim T_i$ be as in the statement of the lemma.
Choose $i_0 \in I$ and replace $I$ by $\{i \in I \mid i \geq i_0\}$.
We may set $B = S = T_{i_0}$ and we may replace $X$ by $X_{T_0}$
and $\mathcal{F}$ by the pullback to $X_{T_0}$. Then
$X_T = \lim X_{T_i}$, see
Limits of Spaces, Lemma
\ref{spaces-limits-lemma-directed-inverse-system-has-limit}.
Let $\mathcal{F}_T \to \mathcal{Q}$ be an element of
$\text{Q}_{\mathcal{F}/X/B}(T)$. By
Limits of Spaces, Lemma
\ref{spaces-limits-lemma-descend-modules-finite-presentation}
there exists an $i$ and a map $\mathcal{F}_{T_i} \to \mathcal{Q}_i$
of $\mathcal{O}_{X_{T_i}}$-modules of finite presentation whose
pullback to $X_T$ is the given quotient map.

\medskip\noindent
We still have to check that, after possibly increasing $i$, the map
$\mathcal{F}_{T_i} \to \mathcal{Q}_i$ is surjective and $\mathcal{Q}_i$
is flat over $T_i$. To do this, choose an affine scheme $U$ and a
surjective \'etale morphism $U \to X$ (see Properties of Spaces,
Lemma \ref{spaces-properties-lemma-quasi-compact-affine-cover}).
We may check surjectivity and flatness over $T_i$ after pulling
back to the \'etale cover $U_{T_i} \to X_{T_i}$ (by definition).
This reduces us to the case where $X = \Spec(B_0)$ is an affine scheme of
finite presentation over $B = S = T_0 = \Spec(A_0)$.
Writing $T_i = \Spec(A_i)$, then $T = \Spec(A)$ with $A = \colim A_i$
we have reached the following algebra problem. Let $M_i \to N_i$
be a map of finitely presented $B_0 \otimes_{A_0} A_i$-modules
such that $M_i \otimes_{A_i} A \to N_i \otimes_{A_i} A$ is surjective
and $N_i \otimes_{A_i} A$ is flat over $A$. Show that for some $i' \geq i$
$M_i \otimes_{A_i} A_{i'} \to N_i \otimes_{A_i} A_{i'}$ is surjective
and $N_i \otimes_{A_i} A_{i'}$ is flat over $A$.
The first follows from
Algebra, Lemma \ref{algebra-lemma-module-map-property-in-colimit}
and the second from
Algebra, Lemma \ref{algebra-lemma-flat-finite-presentation-limit-flat}.
\end{proof}

\begin{lemma}
\label{lemma-q-RS-star}
In Situation \ref{situation-q} assume $X \to B$ locally
of finite presentation. Let
$$
\xymatrix{
Z \ar[r] \ar[d] & Z' \ar[d] \\
Y \ar[r] & Y'
}
$$
be a pushout in the category of schemes over $B$ where
$Z \to Z'$ is a thickening and $Z \to Y$ is affine, see
More on Morphisms, Lemma \ref{more-morphisms-lemma-pushout-along-thickening}.
Then the natural map
$$
Q_{\mathcal{F}/X/B}(Y') \longrightarrow
Q_{\mathcal{F}/X/B}(Y) \times_{Q_{\mathcal{F}/X/B}(Z)} Q_{\mathcal{F}/X/B}(Z')
$$
is bijective.
\end{lemma}

\begin{proof}
We first argue that it suffices to prove this when all the schemes
and algebraic spaces in sight are affine schemes. Let $Y' = \bigcup Y'_i$
be an affine open covering and let $Y_i$, $Z'_i$, and $Z_i$ be the
corresponding (affine) opens of $Y$, $Z'$, and $Z$. Since
$Q_{\mathcal{F}/X/B}$ satisfies the sheaf property for the fpqc topology
(Lemma \ref{lemma-q-sheaf}), it suffices to prove the result of
the lemma for the diagrams
$$
\vcenter{
\xymatrix{
Z_i \ar[r] \ar[d] & Z'_i \ar[d] \\
Y_i \ar[r] & Y'_i
}
}
\quad\text{and}\quad
\vcenter{
\xymatrix{
Z_i \cap Z_j \ar[r] \ar[d] & Z'_i \cap Z'_j \ar[d] \\
Y_i \cap Y_j \ar[r] & Y'_i \cap Y'_j
}
}
$$
This reduces us to the case where the schemes $Y'$, $Y$, $Z'$, $Z$ are
separated and a second application of this argument to the case where
$Y'$, $Y$, $Z'$, $Z$ are affine.

\medskip\noindent
Assume $Y'$ (and hence also $Y$, $Z'$, and $Z$) is affine.
By Remark \ref{remark-q-base-change}
we may replace $B$ by $Y'$ and $X$ by $X \times_B Y'$, and $\mathcal{F}$
by the pullback. Thus we may assume $B = Y'$.

\medskip\noindent
Assume $B = Y'$ (and hence also $Y$, $Z'$, and $Z$) is affine.
Choose an \'etale covering $\{X_i \to X\}_{i \in I}$ with each $X_i$ affine
and similarly choose \'etale coverings $\{X_{ijk} \to X_i \times_X X_j\}$
with each $X_{ijk}$ affine
(Properties of Spaces, Lemma
\ref{spaces-properties-lemma-cover-by-union-affines}).
By Lemma \ref{lemma-q-sheaf-in-X} it suffices to prove the
lemma for each of the functors associated to $X_i$ and $X_{ijk}$.
Hence we may assume $X$ is affine as well. This reduces the lemma to
More on Algebra, Remark
\ref{more-algebra-remark-relative-modules-over-fibre-product}.
\end{proof}







\section{The quot functor}
\label{section-quot}

\noindent
In this section we prove the Quot functor is representable by
an algebraic space.

\begin{situation}
\label{situation-quot}
Let $S$ be a scheme. Let $f : X \to B$ be a morphism of
algebraic spaces  over $S$. Let $\mathcal{F}$ be a quasi-coherent
$\mathcal{O}_X$-module.
For any scheme $T$ over $B$ we will denote $X_T$ the base change of
$X$ to $T$ and $\mathcal{F}_T$ the pullback
of $\mathcal{F}$ via the projection morphism $X_T = X \times_S T \to X$.
Given such a $T$ we set
$$
\text{Quot}_{\mathcal{F}/X/B}(T) =
\left\{
\begin{matrix}
\text{quotients }\mathcal{F}_T \to \mathcal{Q}\text{ where }
\mathcal{Q}\text{ is a quasi-coherent }\\
\mathcal{O}_{X_T}\text{-module of finite presentation, flat over }T\\
\text{with scheme theoretic support proper over }T
\end{matrix}
\right\}
$$
This is a subfunctor of $Q_{\mathcal{F}/X/T}$ discussed in
Section \ref{section-functor-quotients}. Thus we obtain a functor
\begin{equation}
\label{equation-quot}
\text{Quot}_{\mathcal{F}/X/B} : (\Sch/B)^{opp} \longrightarrow \textit{Sets}
\end{equation}
This is the {\it quot functor} associated to $\mathcal{F}/X/B$.
\end{situation}

\noindent
In Situation \ref{situation-quot} we may think of
$\text{Quot}_{\mathcal{F}/X/B}$ as a functor
$(\Sch/S)^{opp} \to \textit{Sets}$ endowed
with a morphism $\text{Quot}_{\mathcal{F}/X/S} \to B$.
Namely, if $T$ is a scheme over $S$, then we can think of an element
of $\text{Quot}_{\mathcal{F}/X/B}$ as a pair $(h, \mathcal{Q})$
where $h$ a morphism $h : T \to B$, i.e., an element $h \in B(T)$,
and $Q$ is a finitely presented, $T$-flat quotient
$\mathcal{F}_T \to \mathcal{Q}$ on $X_T = X \times_{B, h} T$
with support proper over $T$. In particular, when we say
that $\text{Quot}_{\mathcal{F}/X/S}$ is an algebraic space, we mean that the
corresponding functor $(\Sch/S)^{opp} \to \textit{Sets}$ is an algebraic space.

\begin{lemma}
\label{lemma-quot-sheaf}
In Situation \ref{situation-quot}. The functor $\text{Quot}_{\mathcal{F}/X/B}$
satisfies the sheaf property for the fpqc topology.
\end{lemma}

\begin{proof}
In Lemma \ref{lemma-q-sheaf} we have seen that the functor
$\text{Q}_{\mathcal{F}/X/S}$ is a sheaf. Recall that for a
scheme $T$ over $S$ the subset
$\text{Quot}_{\mathcal{F}/X/S}(T) \subset \text{Q}_{\mathcal{F}/X/S}(T)$
picks out those quotients whose support is proper over $T$.
This defines a subsheaf by the result of
Descent on Spaces, Lemma \ref{spaces-descent-lemma-descending-property-proper}
(combined with
Morphisms of Spaces, Lemma \ref{spaces-morphisms-lemma-flat-pullback-support})
which shows that taking scheme theoretic support commutes
with flat base change).
\end{proof}

\begin{proposition}
\label{proposition-quot}
Let $S$ be a scheme. Let $f : X \to B$ be a morphism of algebraic
spaces over $S$. Let $\mathcal{F}$ be a quasi-coherent sheaf
on $X$. If $f$ is of finite presentation, then $\text{Quot}_{\mathcal{F}/X/B}$
is an algebraic space. If $\mathcal{F}$ is of finite presentation,
then $\text{Quot}_{\mathcal{F}/X/B} \to B$ is locally of finite presentation.
\end{proposition}

\begin{proof}
Note that $\text{Quot}_{\mathcal{F}/X/B}$ is a sheaf in the
fppf topology. Let $\textit{Quot}_{\mathcal{F}/X/B}$ be the stack in
groupoids corresponding to $\text{Quot}_{\mathcal{F}/X/S}$, see
Algebraic Stacks, Section \ref{algebraic-section-split}.
By Algebraic Stacks, Proposition
\ref{algebraic-proposition-algebraic-stack-no-automorphisms}
it suffices to show that $\textit{Quot}_{\mathcal{F}/X/B}$
is an algebraic stack.
Consider the $1$-morphism of stacks in groupoids
$$
\textit{Quot}_{\mathcal{F}/X/S}
\longrightarrow
\textit{Coh}_{X/B}
$$
on $(\Sch/S)_{fppf}$ which associates to the quotient
$\mathcal{F}_T \to \mathcal{Q}$ the coherent sheaf $\mathcal{Q}$.
By Theorem \ref{theorem-coherent-algebraic-general} we know that
$\textit{Coh}_{X/B}$ is an algebraic stack.
By Algebraic Stacks, Lemma
\ref{algebraic-lemma-representable-morphism-to-algebraic}
it suffices to show that this $1$-morphism is representable
by algebraic spaces.

\medskip\noindent
Let $T$ be a scheme over $S$ and let the object $(h, \mathcal{G})$ of
$\textit{Coh}_{X/B}$ over $T$ correspond
to a $1$-morphism $\xi : (\Sch/T)_{fppf} \to \textit{Coh}_{X/B}$.
The $2$-fibre product
$$
\mathcal{Z} =
(\Sch/T)_{fppf}
\times_{\xi, \textit{Coh}_{X/B}}
\textit{Quot}_{\mathcal{F}/X/S}
$$
is a stack in setoids, see
Stacks, Lemma \ref{stacks-lemma-2-fibre-product-gives-stack-in-setoids}.
The corresponding sheaf of sets (i.e., functor, see
Stacks, Lemmas
\ref{stacks-lemma-2-fibre-product-gives-stack-in-setoids} and
\ref{stacks-lemma-when-stack-in-sets}) assigns to a scheme
$T'/T$ the set of surjections $u : \mathcal{F}_{T'} \to \mathcal{G}_{T'}$
of quasi-coherent modules on $X_{T'}$. Thus we see that
$\mathcal{Z}$ is representable by an open subspace
(by Lemma \ref{lemma-F-surj-open}) of the algebraic space
$\mathit{Hom}(\mathcal{F}_T, \mathcal{G})$ from
Proposition \ref{proposition-hom}.
\end{proof}








\input{chapters}

\bibliography{my}
\bibliographystyle{amsalpha}

\end{document}
