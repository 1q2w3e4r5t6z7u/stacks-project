\input{preamble}

% OK, start here.
%
\begin{document}

\title{Quot and Hilbert Spaces}

\maketitle

\phantomsection
\label{section-phantom}

\tableofcontents




\section{Introduction}
\label{section-introduction}

\noindent
The purpose of this chapter is to write about Quot and Hilbert functors
and to prove that these are algebraic spaces provided certain technical
conditions are satisfied. In this chapter we will discuss this in the
setting of algebraic space. A reference is Grothendieck's lectures, see
\cite{Gr-I},
\cite{Gr-II},
\cite{Gr-III},
\cite{Gr-IV},
\cite{Gr-V}, and
\cite{Gr-VI}.
Another reference is the paper \cite{olsson-starr}; this paper discusses
the more general case of Quot and Hilbert spaces associated to a morphism
of algebraic stacks which we will discuss in another chapter, see
(insert future reference here).

\medskip\noindent
In the case of Hilbert spaces there is a more general notion of
``Hilbert stacks'' which we will discuss in a separate chapter, see
(insert future reference here).



\section{Conventions}
\label{section-conventions}

\noindent
The standing assumption is that all schemes are contained in
a big fppf site $\Sch_{fppf}$. And all rings $A$ considered
have the property that $\Spec(A)$ is (isomorphic) to an
object of this big site.

\medskip\noindent
Let $S$ be a scheme and let $X$ be an algebraic space over $S$.
In this chapter and the following we will write $X \times_S X$
for the product of $X$ with itself (in the category of algebraic
spaces over $S$), instead of $X \times X$.



\section{When is a morphism an isomorphism?}
\label{section-when-isomorphism}

\noindent
More generally we can ask:
``When does a morphism have property $\mathcal{P}$?''
A more precise question is the following. Suppose given a commutative diagram
$$
\xymatrix{
X \ar[rr]_f \ar[rd]_p & & Y \ar[ld]^q \\
& Z
}
$$
of algebraic spaces. Does there exist a monomorphism of algebraic spaces
$W \to Z$ with the following two properties:
\begin{enumerate}
\item the base change $f_W : X_W \to Y_W$ has property $\mathcal{P}$, and
\item any morphism $Z' \to Z$ of algebraic spaces factors through $W$ if
and only if the base change $f_{Z'} : X_{Z'} \to Y_{Z'}$ has property
$\mathcal{P}$.
\end{enumerate}
In many cases, if $W \to Z$ exists, then it is an immersion, open immersion,
or closed immersion.

\medskip\noindent
The answer to this question may depend on auxiliary properties of the
morphisms $f$, $p$, and $q$. An example is $\mathcal{P}(f) =$``$f$ is flat''
which we have discussed for morphisms of schemes in the case $Y = S$ in
great detail in the chapter ``More on Flatness'', starting with
More on Flatness, Section \ref{flat-section-flattening-functors}.

\begin{lemma}
\label{lemma-where-unramified}
Consider a commutative diagram
$$
\xymatrix{
X \ar[rr]_f \ar[rd]_p & & Y \ar[ld]^q \\
& Z
}
$$
of algebraic spaces. Assume that $p$ is locally of finite type and closed.
Then there exists an open subspace $W \subset Z$
such that a morphism $Z' \to Z$ factors through $W$ if and only if the
base change $f_{Z'} : X_{Z'} \to Y_{Z'}$ is unramified.
\end{lemma}

\begin{proof}
By
Morphisms of Spaces, Lemma \ref{spaces-morphisms-lemma-where-unramified}
there exists an open subspace $U(f) \subset X$ which is the set of
points where $f$ is unramified. Moreover, formation of $U(f)$ commutes
with arbitrary base change. Let $W \subset Z$ be the open subspace
(see
Properties of Spaces, Lemma
\ref{spaces-properties-lemma-open-subspaces})
with underlying set of points
$$
|W| = |Z| \setminus |p|\left(|X| \setminus |U(f)|\right)
$$
i.e., $z \in |Z|$ is a point of $W$ if and only if $f$ is unramified
at every point of $X$ above $z$. Note that this is open because we
assumed that $p$ is closed. Since the formation of $U(f)$
commutes with arbitrary base change we immediately see (using
Properties of Spaces, Lemma
\ref{spaces-properties-lemma-factor-through-open-subspace})
that $W$ has the desired universal property.
\end{proof}

\begin{lemma}
\label{lemma-where-unramified-universally-injective}
Consider a commutative diagram
$$
\xymatrix{
X \ar[rr]_f \ar[rd]_p & & Y \ar[ld]^q \\
& Z
}
$$
of algebraic spaces. Assume that
\begin{enumerate}
\item $p$ is locally of finite type,
\item $p$ is closed, and
\item $p_2 : X \times_Y X \to Z$ is closed.
\end{enumerate}
Then there exists an open subspace $W \subset Z$
such that a morphism $Z' \to Z$ factors through $W$ if and only if the
base change $f_{Z'} : X_{Z'} \to Y_{Z'}$ is unramified and universally
injective.
\end{lemma}

\begin{proof}
After replacing $Z$ by the open subspace found in
Lemma \ref{lemma-where-unramified}
we may assume that $f$ is already unramified; note that this does not
destroy assumption (2) or (3). By
Morphisms of Spaces, Lemma
\ref{spaces-morphisms-lemma-diagonal-unramified-morphism}
we see that $\Delta_{X/Y} : X \to X \times_Y X$ is an open immersion.
This remains true after any base change. Hence by
Morphisms of Spaces, Lemma
\ref{spaces-morphisms-lemma-universally-injective}
we see that $f_{Z'}$ is universally injective if and only if
the base change of the diagonal $X_{Z'} \to (X \times_Y X)_{Z'}$
is an isomorphism. Let $W \subset Z$ be the open subspace
(see
Properties of Spaces, Lemma
\ref{spaces-properties-lemma-open-subspaces})
with underlying set of points
$$
|W| = |Z| \setminus
|p_2|\left(|X \times_Y X| \setminus \text{Im}(|\Delta_{X/Y}|)\right)
$$
i.e., $z \in |Z|$ is a point of $W$ if and only if the fibre of
$|X \times_Y X| \to |Z|$ over $z$ is in the image of
$|X| \to |X \times_Y X|$. Then it is clear from the discussion above
that the restriction $p^{-1}(W) \to q^{-1}(W)$ of $f$ is
unramified and universally injective.

\medskip\noindent
Conversely, suppose that $f_{Z'}$ is unramified and universally injective.
In order to show that $Z' \to Z$ factors through $W$ it suffices to show
that $|Z'| \to |Z|$ has image contained in $|W|$, see
Properties of Spaces, Lemma
\ref{spaces-properties-lemma-factor-through-open-subspace}.
Hence it suffices to prove the result when $Z'$ is the spectrum of a field.
Denote $z \in |Z|$ the image of $|Z'| \to |Z|$. The discussion above shows
that
$$
|X_{Z'}| \longrightarrow |(X \times_Y X)_{Z'}|
$$
is surjective. By
Properties of Spaces,
Lemma \ref{spaces-properties-lemma-points-cartesian}
in the commutative diagram
$$
\xymatrix{
|X_{Z'}| \ar[d] \ar[r] &
|(X \times_Y X)_{Z'}| \ar[d] \\
|p|^{-1}(\{z\}) \ar[r] &
|p_2|^{-1}(\{z\})
}
$$
the vertical arrows are surjective. It follows that $z \in |W|$ as desired.
\end{proof}

\begin{lemma}
\label{lemma-where-closed-immersion}
Consider a commutative diagram
$$
\xymatrix{
X \ar[rr]_f \ar[rd]_p & & Y \ar[ld]^q \\
& Z
}
$$
of algebraic spaces. Assume that
\begin{enumerate}
\item $p$ is locally of finite type,
\item $p$ is universally closed, and
\item $q : Y \to Z$ is separated.
\end{enumerate}
Then there exists an open subspace $W \subset Z$
such that a morphism $Z' \to Z$ factors through $W$ if and only if the
base change $f_{Z'} : X_{Z'} \to Y_{Z'}$ is a closed immersion.
\end{lemma}

\begin{proof}
We will use the characterization of closed immersions as
universally closed, unramified, and universally injective morphisms, see
More on Morphisms of Spaces, Lemma
\ref{spaces-more-morphisms-lemma-characterize-closed-immersion}.
First, note that since $p$ is universally closed and $q$ is
separated, we see that $f$ is universally closed, see
Morphisms of Spaces, Lemma
\ref{spaces-morphisms-lemma-universally-closed-permanence}.
It follows that any base change of $f$ is universally closed, see
Morphisms of Spaces, Lemma
\ref{spaces-morphisms-lemma-base-change-universally-closed}.
Thus to finish the proof of the lemma it suffices to prove that
the assumptions of
Lemma \ref{lemma-where-unramified-universally-injective}
are satisfied. The projection $\text{pr}_0 : X \times_Y X \to X$
is universally closed as a base change of $f$, see
Morphisms of Spaces, Lemma
\ref{spaces-morphisms-lemma-base-change-universally-closed}.
Hence $X \times_Y X \to Z$ is universally closed as
a composition of universally closed morphisms (see
Morphisms of Spaces, Lemma
\ref{spaces-morphisms-lemma-composition-universally-closed}).
This finishes the proof of the lemma.
\end{proof}

\begin{lemma}
\label{lemma-where-flat}
Consider a commutative diagram
$$
\xymatrix{
X \ar[rr]_f \ar[rd]_p & & Y \ar[ld]^q \\
& Z
}
$$
of algebraic spaces. Assume that
\begin{enumerate}
\item $p$ is locally of finite presentation,
\item $p$ is flat,
\item $p$ is closed, and
\item $q$ is locally of finite type.
\end{enumerate}
Then there exists an open subspace $W \subset Z$
such that a morphism $Z' \to Z$ factors through $W$ if and only if the
base change $f_{Z'} : X_{Z'} \to Y_{Z'}$ is flat.
\end{lemma}

\begin{proof}
By
More on Morphisms of Spaces, Lemma
\ref{spaces-more-morphisms-lemma-base-change-flatness-fibres}
the set
$$
A = \{x \in |X| : X\text{ flat at }x \text{ over }Y\}.
$$
is open in $|X|$ and its formation commutes with arbitrary base
change. Let $W \subset Z$ be the open subspace
(see
Properties of Spaces, Lemma
\ref{spaces-properties-lemma-open-subspaces})
with underlying set of points
$$
|W| = |Z| \setminus |p|\left(|X| \setminus A\right)
$$
i.e., $z \in |Z|$ is a point of $W$ if and only if the whole fibre
of $|X| \to |Z|$ over $z$ is contained in $A$. This is open because
$p$ is closed. Since the formation of $A$ commutes with arbitrary
base change it follows that $W$ works.
\end{proof}

\begin{lemma}
\label{lemma-where-surjective-flat}
Consider a commutative diagram
$$
\xymatrix{
X \ar[rr]_f \ar[rd]_p & & Y \ar[ld]^q \\
& Z
}
$$
of algebraic spaces. Assume that
\begin{enumerate}
\item $p$ is locally of finite presentation,
\item $p$ is flat,
\item $p$ is closed,
\item $q$ is locally of finite type, and
\item $q$ is closed.
\end{enumerate}
Then there exists an open subspace $W \subset Z$
such that a morphism $Z' \to Z$ factors through $W$ if and only if the
base change $f_{Z'} : X_{Z'} \to Y_{Z'}$ is surjective and flat.
\end{lemma}

\begin{proof}
By
Lemma \ref{lemma-where-flat}
we may assume that $f$ is flat.
Note that $f$ is locally of finite presentation by
Morphisms of Spaces,
Lemma \ref{spaces-morphisms-lemma-finite-presentation-permanence}.
Hence $f$ is open, see
Morphisms of Spaces, Lemma \ref{spaces-morphisms-lemma-fppf-open}.
Let $W \subset Z$ be the open subspace (see
Properties of Spaces, Lemma
\ref{spaces-properties-lemma-open-subspaces})
with underlying set of points
$$
|W| = |Z| \setminus |q|\left(|Y| \setminus |f|(|X|)\right).
$$
in other words for $z \in |Z|$ we have $z \in |W|$ if and only
if the whole fibre of $|Y| \to |Z|$ over $z$ is in the image of
$|X| \to |Y|$. Since $q$ is closed this set is open in $|Z|$.
The morphism $X_W \to Y_W$ is surjective by construction.
Finally, suppose that $X_{Z'} \to Y_{Z'}$ is surjective.
In order to show that $Z' \to Z$ factors through $W$ it suffices to show
that $|Z'| \to |Z|$ has image contained in $|W|$, see
Properties of Spaces, Lemma
\ref{spaces-properties-lemma-factor-through-open-subspace}.
Hence it suffices to prove the result when $Z'$ is the spectrum of a field.
Denote $z \in |Z|$ the image of $|Z'| \to |Z|$. By
Properties of Spaces,
Lemma \ref{spaces-properties-lemma-points-cartesian}
in the commutative diagram
$$
\xymatrix{
|X_{Z'}| \ar[d] \ar[r] &
|Y_{Z'}| \ar[d] \\
|p|^{-1}(\{z\}) \ar[r] &
|q|^{-1}(\{z\})
}
$$
the vertical arrows are surjective. It follows that $z \in |W|$ as desired.
\end{proof}

\begin{lemma}
\label{lemma-where-isomorphism}
Consider a commutative diagram
$$
\xymatrix{
X \ar[rr]_f \ar[rd]_p & & Y \ar[ld]^q \\
& Z
}
$$
of algebraic spaces. Assume that
\begin{enumerate}
\item $p$ is locally of finite presentation,
\item $p$ is flat,
\item $p$ is universally closed,
\item $q$ is locally of finite type,
\item $q$ is closed, and
\item $q$ is separated.
\end{enumerate}
Then there exists an open subspace $W \subset Z$
such that a morphism $Z' \to Z$ factors through $W$ if and only if the
base change $f_{Z'} : X_{Z'} \to Y_{Z'}$ is an isomorphism.
\end{lemma}

\begin{proof}
By
Lemma \ref{lemma-where-surjective-flat}
there exists an open subspace $W_1 \subset Z$ such that
$f_{Z'}$ is surjective and flat if and only if $Z' \to Z$
factors through $W_1$. By
Lemma \ref{lemma-where-closed-immersion}
there exists an open subspace $W_2 \subset Z$ such that
$f_{Z'}$ is a closed immersion if and only if $Z' \to Z$
factors through $W_2$. We claim that $W = W_1 \cap W_2$ works.
Certainly, if $f_{Z'}$ is an isomorphism, then $Z' \to Z$
factors through $W$. Hence it suffices to show that
$f_W$ is an isomorphism. By construction $f_W$ is a
surjective flat closed immersion. In particular $f_W$ is
representable. Since a surjective flat closed immersion of
schemes is an isomorphism (see
Morphisms, Lemma \ref{morphisms-lemma-characterize-flat-closed-immersions})
we win. (Note that actually $f_W$ is locally of finite presentation,
whence open, so you can avoid the use of this lemma if you like.)
\end{proof}

\begin{lemma}
\label{lemma-where-lci}
Consider a commutative diagram
$$
\xymatrix{
X \ar[rr]_f \ar[rd]_p & & Y \ar[ld]^q \\
& Z
}
$$
of algebraic spaces. Assume that
\begin{enumerate}
\item $p$ is flat and locally of finite presentation,
\item $p$ is closed, and
\item $q$ is flat and locally of finite presentation,
\end{enumerate}
Then there exists an open subspace $W \subset Z$
such that a morphism $Z' \to Z$ factors through $W$ if and only if the
base change $f_{Z'} : X_{Z'} \to Y_{Z'}$ is a local complete intersection
morphism.
\end{lemma}

\begin{proof}
By
More on Morphisms of Spaces,
Lemma \ref{spaces-more-morphisms-lemma-base-change-lci-fibres}
there exists an open subspace $U(f) \subset X$ which is the set of
points where $f$ is Koszul. Moreover, formation of $U(f)$ commutes
with arbitrary base change. Let $W \subset Z$ be the open subspace
(see
Properties of Spaces, Lemma
\ref{spaces-properties-lemma-open-subspaces})
with underlying set of points
$$
|W| = |Z| \setminus |p|\left(|X| \setminus |U(f)|\right)
$$
i.e., $z \in |Z|$ is a point of $W$ if and only if $f$ is Koszul
at every point of $X$ above $z$. Note that this is open because we
assumed that $p$ is closed. Since the formation of $U(f)$
commutes with arbitrary base change we immediately see (using
Properties of Spaces, Lemma
\ref{spaces-properties-lemma-factor-through-open-subspace})
that $W$ has the desired universal property.
\end{proof}




\section{The functor of quotients}
\label{section-functor-quotients}

\noindent
In this section we discuss some generalities regarding the functor
defined below.

\begin{situation}
\label{situation-q}
Let $S$ be a scheme.
Let $f : X \to B$ be a morphism of algebraic spaces over $S$.
Let $\mathcal{F}$ be a quasi-coherent $\mathcal{O}_X$-module.
Assume $f$ is locally of finite presentation and $\mathcal{F}$ of finite type.
For any scheme $T$ over $B$ we will denote $X_T$ the base change of
$X$ to $T$ and $\mathcal{F}_T$ the pullback
of $\mathcal{F}$ via the projection morphism $X_T = X \times_S T \to X$.
Given such a $T$ we set
$$
\text{Q}_{\mathcal{F}/X/B}(T) =
\left\{
\begin{matrix}
\text{quotients }\mathcal{F}_T \to \mathcal{Q}\text{ where }
\mathcal{Q}\text{ is a quasi-coherent }\\
\mathcal{O}_{X_T}\text{-module of finite presentation, flat over }T
\end{matrix}
\right\}
$$
We identify quotients if they have the same kernel. Suppose
that $T' \to T$ is a morphism of schemes over $B$ and
$\mathcal{F}_T \to \mathcal{Q}$ is an element of
$\text{Q}_{\mathcal{F}/X/B}(T)$. Then the pullback
$\mathcal{Q}' = (X_{T'} \to X_T)^*\mathcal{Q}$ is a quasi-coherent
$\mathcal{O}_{X_{T'}}$-module of finite presentation flat over $T'$
(see Properties of Spaces, Section
\ref{spaces-properties-section-properties-modules}
and
Morphisms of Spaces, Lemma
\ref{spaces-morphisms-lemma-base-change-module-flat}).
Thus we obtain a functor
\begin{equation}
\label{equation-quot}
\text{Q}_{\mathcal{F}/X/B} : (\Sch/B)^{opp} \longrightarrow \textit{Sets}
\end{equation}
This is the functor of quotients of $\mathcal{F}/X/B$.
\end{situation}

\noindent
We will reserve the notation $\text{Quot}_{\mathcal{F}/X/B}$ for a
subfunctor of $\text{Q}_{\mathcal{F}/X/B}$ which we will discuss later.

\begin{lemma}
\label{lemma-q-sheaf}
In Situation \ref{situation-q}. The functor $\text{Q}_{\mathcal{F}/X/B}$
satisfies the sheaf property for the fpqc topology.
\end{lemma}

\begin{proof}
Let $\{T_i \to T\}_{i \in I}$ be an fpqc covering of schemes over $S$.
Set $X_i = X_{T_i} = X \times_S T_i$ and $\mathcal{F}_i = \mathcal{F}_{T_i}$.
Note that $\{X_i \to X_T\}_{i \in I}$ is an fpqc covering of
$X_T$, see
Topologies on Spaces, Lemma \ref{spaces-topologies-lemma-fpqc}.
Suppose that $\mathcal{F}_i \to \mathcal{Q}_i$ is a collection of
elements of $\text{Q}_{\mathcal{F}/X/B}(T_i)$ such that $\mathcal{Q}_i$
and $\mathcal{Q}_{i'}$ restrict to the same element of
$\text{Q}_{\mathcal{F}/X/B}(T_i \times_T T_{i'})$. This means that
the pullbacks of $\mathcal{Q}_i$ and $\mathcal{Q}_{i'}$ restrict
to the same quotient of $\mathcal{F}_{T_i \times_T T_{i'}}$.
Since $X_{T_i \times_T T_{i'}} = X_i \times_{X_T} X_{i'}$ we see
that we obtain a descent datum for quasi-coherent modules
with respect to $\{X_i \to X_T\}_{i \in I}$. By
Descent on Spaces, Proposition
\ref{spaces-descent-proposition-fpqc-descent-quasi-coherent}
we find a map of quasi-coherent $\mathcal{O}_{X_T}$-modules
$\mathcal{F}_T \to \mathcal{Q}$ whose restriction to $X_i$ recovers
the given quotients.

\medskip\noindent
Since the family of morphisms $\{X_i \to X_T\}$ is jointly surjective
and flat, for every point $x \in |X_T|$ there exists an $i$ and a point
$x_i \in |X_i|$ mapping to $x$. Note that the induced map on
local rings
$\mathcal{O}_{X_T, \overline{x}} \to \mathcal{O}_{X_i, \overline{x_i}}$
is faithfully flat, see 
Morphisms of Spaces, Section \ref{spaces-morphisms-section-flat}.
Thus we see that $\mathcal{F}_T \to \mathcal{Q}$ is surjective.
By Morphisms of Spaces, Lemma \ref{spaces-morphisms-lemma-flat-permanence}
we see that $\mathcal{Q}$ is flat over $T$. Finally,
Descent on Spaces, Lemma
\ref{spaces-descent-lemma-finite-presentation-descends}
guarantees that $\mathcal{Q}$ is of finite presentation as an
$\mathcal{O}_{X_T}$-module.
\end{proof}

\begin{lemma}
\label{lemma-q-limit-preserving}
In Situation \ref{situation-q} assume also that
(a) $f$ is quasi-compact and quasi-separated and
(b) $\mathcal{F}$ is of finite presentation.
Then the functor $\text{Q}_{\mathcal{F}/X/B}$
is limit preserving in the following sense: If $T = \lim T_i$ is a
directed limit of affine schemes over $B$, then
$\text{Q}_{\mathcal{F}/X/B}(T) = \colim \text{Q}_{\mathcal{F}/X/B}(T_i)$.
\end{lemma}

\begin{proof}
Let $T = \lim T_i$ be as in the statement of the lemma.
Choose $i_0 \in I$ and replace $I$ by $\{i \in I \mid i \geq i_0\}$.
We may set $B = S = T_{i_0}$ and we may replace $X$ by $X_{T_0}$
and $\mathcal{F}$ by the pullback to $X_{T_0}$. Then
$X_T = \lim X_{T_i}$, see
Limits of Spaces, Lemma
\ref{spaces-limits-lemma-directed-inverse-system-has-limit}.
Let $\mathcal{F}_T \to \mathcal{Q}$ be an element of
$\text{Q}_{\mathcal{F}/X/B}(T)$. By
Limits of Spaces, Lemma
\ref{spaces-limits-lemma-descend-modules-finite-presentation}
there exists an $i$ and a map $\mathcal{F}_{T_i} \to \mathcal{Q}_i$
of $\mathcal{O}_{X_{T_i}}$-modules of finite presentation whose
pullback to $X_T$ is the given quotient map.

\medskip\noindent
We still have to check that, after possibly increasing $i$, the map
$\mathcal{F}_{T_i} \to \mathcal{Q}_i$ is surjective and $\mathcal{Q}_i$
is flat over $T_i$. To do this, choose an affine scheme $U$ and a
surjective \'etale morphism $U \to X$ (see Properties of Spaces,
Lemma \ref{spaces-properties-lemma-quasi-compact-affine-cover}).
We may check surjectivity and flatness over $T_i$ after pulling
back to the \'etale cover $U_{T_i} \to X_{T_i}$ (by definition).
This reduces us to the case where $X = \Spec(B_0)$ is an affine scheme of
finite presentation over $B = S = T_0 = \Spec(A_0)$.
Writing $T_i = \Spec(A_i)$, then $T = \Spec(A)$ with $A = \colim A_i$
we have reached the following algebra problem. Let $M_i \to N_i$
be a map of finitely presented $B_0 \otimes_{A_0} A_i$-modules
such that $M_i \otimes_{A_i} A \to N_i \otimes_{A_i} A$ is surjective
and $N_i \otimes_{A_i} A$ is flat over $A$. Show that for some $i' \geq i$
$M_i \otimes_{A_i} A_{i'} \to N_i \otimes_{A_i} A_{i'}$ is surjective
and $N_i \otimes_{A_i} A_{i'}$ is flat over $A$.
The first follows from
Algebra, Lemma \ref{algebra-lemma-module-map-property-in-colimit}
and the second from
Algebra, Lemma \ref{algebra-lemma-flat-finite-presentation-limit-flat}.
\end{proof}

\begin{lemma}
\label{lemma-factors-through-quotient}
Let $S = \Spec(R)$ be an affine scheme. Let $X$ be an algebraic space over
$S$. Let $q_i : \mathcal{F} \to \mathcal{Q}_i$, $i = 1, 2$
be surjective maps of quasi-coherent $\mathcal{O}_X$-modules.
Assume $\mathcal{Q}_1$ flat over $S$. Let $T \to S$ be a quasi-compact
morphism of schemes such that there exists a factorization
$$
\xymatrix{
& \mathcal{F}_T \ar[rd]^{q_{2, T}} \ar[ld]_{q_{1, T}} \\
\mathcal{Q}_{1, T} & & \mathcal{Q}_{2, T} \ar@{..>}[ll]
}
$$
Then exists a closed subscheme $Z \subset S$ such that
(a) $T \to S$ factors through $Z$ and (b)
$q_{1, Z}$ factors through $q_{2, Z}$.
If $\text{ker}(q_2)$ is a finite type $\mathcal{O}_X$-module and $X$
quasi-compact, then we can take $Z \to S$ of finite presentation.
\end{lemma}

\begin{proof}
In the proof of this lemma we will use the following observation:
If $\pi : \mathcal{H} \to \mathcal{E}$ and
$\pi' : \mathcal{H} \to \mathcal{E}'$ are surjections of quasi-coherent
modules on an algebraic space $Y$ and $\varphi : Y' \to Y$ is a surjective
flat morphism of algebraic spaces, then $\pi$ factors through $\pi'$
if and only if $\varphi^*\pi$ factors through $\varphi^*\pi'$. Namely,
for every $y \in |Y|$ there exists a $y' \in |Y'|$ and the map
of local rings
$\mathcal{O}_{Y, \overline{y}} \to \mathcal{O}_{Y', \overline{y'}}$
is faithfully flat (see
Morphisms of Spaces, Section \ref{spaces-morphisms-section-flat}).

\medskip\noindent
Let $U \to X$ be a surjective \'etale morphism of algebraic spaces
where $U = \coprod U_i$ is a disjoint union of affine schemes (see
Properties of Spaces, Lemma
\ref{spaces-properties-lemma-cover-by-union-affines}).
Applying the initial remark of the proof we see that we may
replace $X$ by $U$. In other words, we may assume that $X = \coprod X_i$
is a disjoint union of affine schemes $X_i$. Suppose that we can prove
the lemma for $(q_1|_{X_i}, q_2|_{X_i})$. Then we find a closed subscheme
$Z_i \subset S$ such that $T \to S$ factors through $Z_i$ and
$q_{1, Z_i}$ factors through $q_{2, Z_i}$. If
$Z_i = \Spec(R/I_i) \subset \Spec(R) = S$, then taking
$Z = \Spec(R/\sum I_i)$ works. Thus we may assume that
$X = \Spec(A)$ is affine too.

\medskip\noindent
Choose a finite affine open covering $T = T_1 \cup \ldots \cup T_m$.
It is clear that we may replace $T$ by $\coprod_{j = 1, \ldots, m} T_j$.
Hence we may assume $T$ is affine as well. Say $T = \Spec(R')$.
Let $q_1 : M \to N_1$, $i = 1, 2$ be the homomorphisms of $A$-modules
corresponding to $q_i : \mathcal{F} \to \mathcal{Q}_i$, $i = 1, 2$.
Let $K_2 = \text{Ker}(q_2)$. The assumption of the lemma means that
the composition
$$
K_2 \otimes_R R' \to M \otimes_R R' \to N_1 \otimes_R R'
$$
is zero. Let $z \in K_2$. By Lazard's theorem
(Algebra, Theorem \ref{algebra-theorem-lazard}) and the fact
that $\otimes$ commutes with colimits we can find free $R$-module
$F_z$, an element $\tilde z \in F_z$, and a map $F_z \to N_2$ such that
$z$ is the image of $\tilde z$ and $\tilde z$ maps to zero in
$F_z \otimes_R R'$. Choose a basis $\{e_{z, \alpha}\}$ of $F_z$ and wite
$\tilde z = \sum f_{z, \alpha} e_{z, \alpha}$ with $f_{z, \alpha} \in R$.
Let $I \subset R$ be the ideal generated by the elements $f_{z, \alpha}$.
By construction $I$ maps to zero in $R'$ and the elements $\tilde z$
map to zero in $F_z/IF_z$ whence in $N_2/IN_2$. Thus $Z = \Spec(R/I)$
is a solution to the problem in this affine case.

\medskip\noindent
Assume $\text{Ker}(q_2)$ is of finite type and $X$ quasi-compact.
Write $Z = \Spec(R/I)$.
Write $I = \bigcup I_\lambda$ as a filtered union of finitely generated
ideals. Set $Z_\lambda = \Spec(R/I_\lambda)$, so $Z = \colim Z_\lambda$.
Since $\text{Ker}(q_2)_Z \to \mathcal{Q}_{1, Z}$ is zero, we see that
$\text{Ker}(q_2)_{Z_\lambda} \to \mathcal{Q}_{1, Z_\lambda}$ is zero
for some $\lambda$ by More on Flatness, Lemma \ref{flat-lemma-iso-sheaf}.
This finishes the proof of the lemma.
\end{proof}







\input{chapters}

\bibliography{my}
\bibliographystyle{amsalpha}

\end{document}
