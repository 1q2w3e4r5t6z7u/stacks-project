\input{preamble}

% OK, start here.
%
\begin{document}

\title{Cohomology of Algebraic Stacks}

\maketitle

\phantomsection
\label{section-phantom}

\tableofcontents




\section{Introduction}
\label{section-introduction}

\noindent
In this chapter we write about cohomology of algebraic stacks.
This mean in particular cohomology of quasi-coherent sheaves, i.e.,
we prove analogues of the results in the chapter entitled
``Coherent Cohomology''. The results in this chapter are different
from those in \cite{LM-B} mainly because we consistently use the
``big sites''. Before reading this chapter please take a quick look at
the chapter ``Sheaves on Algebraic Stacks'' in order to become
familiar with the terminology introduced there.



\section{Conventions and abuse of language}
\label{section-conventions}

\noindent
We continue to use the conventions and the abuse of language
introduced in
Properties of Stacks, Section \ref{stacks-properties-section-conventions}.











\section{Notation}
\label{section-notation}

\noindent
Different topologies. If we indicate an algebraic stack by a calligraphic
letter, such as $\mathcal{X}, \mathcal{Y}, \mathcal{Z}$, then the notation
$\mathcal{X}_{Zar}, \mathcal{X}_{\acute{e}tale}, \mathcal{X}_{smooth},
\mathcal{X}_{syntomic}, \mathcal{X}_{fppf}$ indicates the site introduced
in
Sheaves on Stacks, Definition
\ref{stacks-sheaves-definition-inherited-topologies}.
(Think ``big site''.) Correspondingly the structure sheaf of
$\mathcal{X}$ is a sheaf on $\mathcal{X}_{fppf}$.
On the other hand, algebraic spaces and schemes
are usually indicated by roman capitals, such as $X, Y, Z$, and in this case
$X_{\acute{e}tale}$ indicates the small \'etale site of $X$ (as
defined in
Topologies, Definition
\ref{topologies-definition-big-small-etale}
or
Properties of Spaces, Definition
\ref{spaces-properties-definition-etale-site}).
It seems that the distinction should be clear enough.

\medskip\noindent
The default topology is the fppf topology. Hence we will sometimes
say ``sheaf on $\mathcal{X}$'' or ``sheaf of $\mathcal{O}_\mathcal{X}$''
modules when we mean sheaf on $\mathcal{X}_{fppf}$ or object of
$\textit{Mod}(\mathcal{X}_{fppf}, \mathcal{O}_\mathcal{X})$.

\medskip\noindent
If $f : \mathcal{X} \to \mathcal{Y}$ is a morphism of algebraic
stacks, then the functors $f_*$ and $f^{-1}$ defined on presheaves
preserves sheaves for any of the topologies mentioned above. In particular
when we discuss the pushforward or pullback of a sheaf we don't have to
mention which topology we are working with. The same isn't true
when we compute cohomology groups and/or higher direct images. In this
case we will always mention which topology we are working with.

\medskip\noindent
Suppose that $f : X \to \mathcal{Y}$ is a morphism from an algebraic
space $X$ to an algebraic stack $\mathcal{Y}$. Let $\mathcal{G}$ be
a sheaf on $\mathcal{Y}_\tau$ for some topology $\tau$. In this case
$f^{-1}\mathcal{G}$ is a sheaf for the $\tau$ topology on $\mathcal{S}_X$
(the algebraic stack associated to $X$) because (by our conventions) $f$
really is a $1$-morphism $f : \mathcal{S}_X \to \mathcal{Y}$.
If $\tau = \acute{e}tale$ or stronger, then we write
$f^{-1}\mathcal{G}|_{X_{\acute{e}tale}}$
to denote the restriction to the \'etale site of $X$, see
Sheaves on Stacks, Section \ref{stacks-sheaves-section-compare}.
If $\mathcal{G}$ is an $\mathcal{O}_\mathcal{X}$-module we sometimes
write $f^*\mathcal{G}$ and $f^*\mathcal{G}|_{X_{\acute{e}tale}}$
instead.







\section{Pushforward of quasi-coherent modules}
\label{section-pushforward-quasi-coherent}

\noindent
Let $f : \mathcal{X} \to \mathcal{Y}$ be a morphism of algebraic stacks.
Consider the pushforward
$$
f_* :
\textit{Mod}(\mathcal{O}_\mathcal{X})
\longrightarrow
\textit{Mod}(\mathcal{O}_\mathcal{Y})
$$
It turns out that this functor almost never preserves the subcategories
of quasi-coherent sheaves. For example, consider the morphism of schemes
$$
j : X = \mathbf{A}^2_k \setminus \{0\} \longrightarrow \mathbf{A}^2_k = Y.
$$
Associated to this we have the corresponding morphism of algebraic stacks
$$
f = j_{big} : \mathcal{X} = (\Sch/X)_{fppf} \to
(\Sch/Y)_{fppf} = \mathcal{Y}
$$
The pushforward $f_*\mathcal{O}_\mathcal{X}$ of the structure sheaf has
global sections $k[x, y]$. Hence if $f_*\mathcal{O}_\mathcal{X}$ is
quasi-coherent on $\mathcal{Y}$ then we would have
$f_*\mathcal{O}_\mathcal{X} = \mathcal{O}_\mathcal{Y}$. However,
consider $T = \Spec(k) \to \mathbf{A}^2_k = Y$ mapping to $0$.
Then $\Gamma(T, f_*\mathcal{O}_\mathcal{X}) = 0$ because
$X \times_Y T = \emptyset$ whereas $\Gamma(T, \mathcal{O}_\mathcal{Y}) = k$.
On the positive side, we know from
Coherent, Lemma \ref{coherent-lemma-flat-base-change-cohomology}
that for any flat morphism $T \to Y$ we have the equality
$\Gamma(T, f_*\mathcal{O}_\mathcal{X}) = \Gamma(T, \mathcal{O}_\mathcal{Y})$
(this uses that $j$ is quasi-compact and quasi-separated).

\medskip\noindent
Let $f : \mathcal{X} \to \mathcal{Y}$ be a quasi-compact and
quasi-separated morphism of algebraic stacks. Here are
three key observations that will allows us to get a good theory anyway:
\begin{enumerate}
\item $f_*$ does preserve the category of locally quasi-coherent modules, and
\item $f_*$ transforms a quasi-coherent sheaf into a locally quasi-coherent
sheaf whose comparison maps, see
Sheaves on Stacks, Equation (\ref{stacks-sheaves-equation-comparison-modules})
are isomorphisms for maps $\varphi$ lying over flat maps, and
\item locally quasi-coherent $\mathcal{O}_\mathcal{Y}$-modules as in (2)
give rise to modules on a presentation of $\mathcal{Y}$ and hence
quasi-coherent modules on $\mathcal{Y}$, see
Sheaves on Stacks, Section
\ref{stacks-sheaves-section-quasi-coherent-algebraic-stacks}.
\end{enumerate}
Once we have worked out the details, we will obtain a functor
$$
f_{\textit{QCoh}, *} :
\textit{QCoh}(\mathcal{O}_\mathcal{X})
\longrightarrow
\textit{QCoh}(\mathcal{O}_\mathcal{Y})
$$
which is a right adjoint to
$f^* : \textit{QCoh}(\mathcal{O}_\mathcal{Y}) \to
\textit{QCoh}(\mathcal{O}_\mathcal{X})$
such that moreover
$$
\Gamma(y, f_*\mathcal{F}) = \Gamma(y, f_{\textit{QCoh}, *}\mathcal{F})
$$
for any $y \in \Ob(\mathcal{Y})$ such that the associated
$1$-morphism $y : V \to \mathcal{Y}$ is flat, see (insert future
reference here).
Moreover, a similar construction will produce functors $R^if_*$.
However, these results will not be sufficient to produce a
total direct image functor (of complexes with quasi-coherent
cohomology sheaves).






\section{Locally quasi-coherent modules}
\label{section-locally-quasi-coherent}

\noindent
Let $\mathcal{X}$ be an algebraic stack. In
Sheaves on Stacks, Definition
\ref{stacks-sheaves-definition-locally-quasi-coherent}
we have defined the notion of a locally quasi-coherent
$\mathcal{O}_\mathcal{X}$-module $\mathcal{F}$. Briefly, this means
$\mathcal{F}$ is an $\mathcal{O}_\mathcal{X}$-module for the
\'etale topology such that for any morphism $f : U \to \mathcal{X}$
the restriction $f^*\mathcal{F}|_{U_{\acute{e}tale}}$ is quasi-coherent
on $U$. (The actual definition is slightly different, but equivalent.)
A useful fact is that
$$
\textit{LQCoh}(\mathcal{O}_\mathcal{X}) \subset
\textit{Mod}(\mathcal{X}_{\acute{e}tale}, \mathcal{O}_\mathcal{X})
$$
is a weak Serre subcategory, see
Sheaves on Stacks, Lemma \ref{stacks-sheaves-lemma-lqc-colimits}.

\begin{lemma}
\label{lemma-check-lqc-on-etale-covering}
Let $\mathcal{X}$ be an algebraic stack. Let
$f_j : \mathcal{X}_j \to \mathcal{X}$ be a family of smooth
morphisms of algebraic stacks with
$|\mathcal{X}| =\bigcup |f_j|(|\mathcal{X}_j|)$.
Let $\mathcal{F}$ be a sheaf of $\mathcal{O}_\mathcal{X}$ modules
on $\mathcal{X}_{\acute{e}tale}$. If each $f_j^{-1}\mathcal{F}$
is locally quasi-coherent, then so is $\mathcal{F}$.
\end{lemma}

\begin{proof}
We may replace each of the algebraic stacks $\mathcal{X}_j$ by
a scheme $U_j$ (using that any algebraic stack has a smooth covering by
a scheme and that compositions of smooth morphisms are smooth, see
Morphisms of Stacks, Lemma \ref{stacks-morphisms-lemma-composition-smooth}).
The pullback of $\mathcal{F}$ to $(\Sch/U_j)_{\acute{e}tale}$ is still
locally quasi-coherent, see
Sheaves on Stacks, Lemma \ref{stacks-sheaves-lemma-pullback-lqc}.
Then $f = \coprod f_j : U = \coprod U_j \to \mathcal{X}$ is a smooth surjective
morphism. Let $x$ be an object of $\mathcal{X}$. By
Sheaves on Stacks, Lemma
\ref{stacks-sheaves-lemma-surjective-flat-locally-finite-presentation}
there exists an \'etale covering $\{x_i \to x\}_{i \in I}$
such that each $x_i$ lifts to an object $u_i$ of $(\Sch/U)_{\acute{e}tale}$.
This just means that $x$, $x_i$ live over a schemes $V$, $V_i$, that
$\{V_i \to V\}$ is an \'etale covering, and that $x_i$ comes from
a morphism $u_i : V_i \to U$. The restriction
$x_i^*\mathcal{F}|_{V_{i, \acute{e}tale}}$ is equal to the restriction
of $f^*\mathcal{F}$ to $V_{i, \acute{e}tale}$, see
Sheaves on Stacks, Lemma \ref{stacks-sheaves-lemma-comparison}.
Hence $x^*\mathcal{F}|_{V_{\acute{e}tale}}$
is a sheaf on the small \'etale site of $V$ which is quasi-coherent
when restricted to $V_{i, \acute{e}tale}$ for each $i$.
This implies that it is quasi-coherent (as desired), for example by
Properties of Spaces, Lemma
\ref{spaces-properties-lemma-characterize-quasi-coherent}.
\end{proof}

\begin{lemma}
\label{lemma-pushforward-locally-quasi-coherent}
Let $g : \mathcal{X} \to \mathcal{Y}$ be a quasi-compact and
quasi-separated morphism of algebraic stacks. Let 
$\mathcal{F}$ be a locally quasi-coherent
$\mathcal{O}_\mathcal{X}$-module. Then $R^ig_*\mathcal{F}$
(computed in the \'etale topology) is
a locally quasi-coherent $\mathcal{O}_\mathcal{Y}$-module.
\end{lemma}

\begin{proof}
By
Sheaves on Stacks, Lemma
\ref{stacks-sheaves-lemma-base-change-higher-direct-images}
taking higher direct images commutes with base change.
Hence using
Lemma \ref{lemma-check-lqc-on-etale-covering}
and that an algebraic stack has a smooth covering by
a scheme we may assume that $\mathcal{Y}$ is representable by a scheme.
Using the same lemma once more, we see that
the question is Zariski local on $\mathcal{Y}$, hence we may assume that
$\mathcal{Y}$ is representable by an affine scheme. Since $g$ is
quasi-compact this implies that also $\mathcal{X}$ is quasi-compact.
Thus we may choose a surjective smooth morphism
$f : \mathcal{U} \to \mathcal{X}$ where $\mathcal{U}$ is representable
by an affine scheme.

\medskip\noindent
In this situation we have the spectral sequence
$$
E_2^{p, q} = R^q(g \circ f_p)_*f_p^{-1}\mathcal{F}
\Rightarrow
R^{p + q}g_*\mathcal{F}
$$
of
Sheaves on Stacks, Proposition
\ref{stacks-sheaves-proposition-smooth-covering-compute-direct-image}.
Since $\textit{LQCoh}(\mathcal{O}_\mathcal{Y})$ is a weak Serre subcategory
of
$\textit{Mod}(\mathcal{Y}_{\acute{e}tale}, \mathcal{O}_\mathcal{Y})$
(see
Sheaves on Stacks, Lemma \ref{stacks-sheaves-lemma-lqc-colimits})
it suffices to prove that the higher direct images of locally
quasi-coherent modules under the morphisms
$$
\mathcal{U}_n =
\mathcal{U} \times_\mathcal{X} \ldots \times_\mathcal{X} \mathcal{U}
\longrightarrow
\mathcal{Y}
$$
are locally quasi-coherent. The algebraic spaces $\mathcal{U}_n$
are quasi-compact and quasi-separated by
Morphisms of Stacks, Lemma
\ref{stacks-morphisms-lemma-quasi-compact-quasi-separated-permanence}.
This reduces us to the case where $g : \mathcal{X} \to \mathcal{Y}$
is representable by algebraic spaces.

\medskip\noindent
In case $g$ is quasi-compact, quasi-separated, and representable by algebraic
spaces, choose any object $y$ of $\mathcal{Y}$ lying over a scheme $V$.
Consider the cartesian diagram
$$
\xymatrix{
Z \ar[d] \ar[r]_q \ar[d]_p & \mathcal{X} \ar[d]^g \\
V \ar[r]^y & \mathcal{Y}
}
$$
Thus $Z$ is an algebraic space and $p$ is quasi-compact and quasi-separated.
By Sheaves on Stacks, Lemma
\ref{stacks-sheaves-lemma-compare-representable-morphism-cohomology}
we have
$$
R^ig_*\mathcal{F}|_{V_{\acute{e}tale}} =
R^ip_{small, *}\big((q^*\mathcal{F})|_{Z_{\acute{e}tale}}\big)
$$
Hence the left hand side is a quasi-coherent sheaf on $V_{\acute{e}tale}$ by
Cohomology of Spaces, Lemma
\ref{spaces-cohomology-lemma-higher-direct-image}.
\end{proof}







\section{Flat comparison maps}
\label{section-flat-comparison}

\noindent
Let $\mathcal{X}$ be an algebraic stack. Let $\varphi : x \to x'$ be
a morphism of $\mathcal{X}$. Then $\varphi : x \to x'$ lies over a
morphism of schemes $f : U \to U'$ and we obtain a $2$-commutative diagram
$$
\xymatrix{
U \ar[rd]_x \ar[rr]_f & & U' \ar[ld]^{x'} \\
& \mathcal{X}
}
$$
Given a sheaf of modules $\mathcal{F}$ on $\mathcal{X}$
(for the \'etale or a stronger topology) we obtain a comparison map
\begin{equation}
\label{equation-comparison-modules}
c_\varphi :
f_{small}^*(\mathcal{F}|_{U'_{\acute{e}tale}})
\longrightarrow
\mathcal{F}|_{U_{\acute{e}tale}}
\end{equation}
see Sheaves on Stacks, Equation
(\ref{stacks-sheaves-equation-comparison-modules}).
In this situation we can consider the following property
of $\mathcal{F}$:
\begin{equation}
\label{equation-flat-comparison}
c_\varphi\text{ is an isomorphism whenever }f\text{ is flat.}
\end{equation}
There is also the weaker property
\begin{equation}
\label{equation-fppf-comparison}
c_\varphi\text{ is an isomorphism whenever }f
\text{ is flat and locally of finite presentation.}
\end{equation}
Here is a lemma with some properties of these notions.

\begin{lemma}
\label{lemma-check-flat-comparison-on-etale-covering}
Let $\mathcal{X}$ be an algebraic stack. Let $\mathcal{F}$
be a sheaf of $\mathcal{O}_\mathcal{X}$-modules on
$\mathcal{X}_{\acute{e}tale}$.
\begin{enumerate}
\item If $\mathcal{F}$ has (\ref{equation-flat-comparison}) or
(\ref{equation-fppf-comparison}) then for any morphism
$g : \mathcal{Y} \to \mathcal{X}$ of algebraic stacks, the
pullback $g^*\mathcal{F}$ does too.
\item The full subcategory of
$\textit{Mod}(\mathcal{X}_{\acute{e}tale}, \mathcal{O}_\mathcal{X})$
consisting of modules with property (\ref{equation-flat-comparison})
is a weak Serre subcategory. Similarly for (\ref{equation-fppf-comparison}).
\item  Let $g : \mathcal{Y} \to \mathcal{X}$ be a surjective smooth
morphism of algebraic stacks. If $g^*\mathcal{F}$
has (\ref{equation-flat-comparison}) or (\ref{equation-fppf-comparison}),
then so does $\mathcal{F}$.
\end{enumerate}
\end{lemma}

\begin{proof}
Let $g : \mathcal{Y} \to \mathcal{X}$ be as in (1).
Let $y$ be an object of $\mathcal{Y}$ lying over a scheme $V$. Unwinding
the definition of a the restriction (see
Sheaves on Stacks, Definition \ref{stacks-sheaves-definition-pullback}
and discussion following it) we see that
$(g^*\mathcal{F})|_{V_{\acute{e}tale}} = \mathcal{F}|_{V_{\acute{e}tale}}$
Hence a comparison mapping for the sheaf $g^*\mathcal{F}$ on $\mathcal{Y}$
is a special case of a comparison map for the sheaf $\mathcal{F}$ on
$\mathcal{X}$. In this way (1) is clear.

\medskip\noindent
Proof of (2). We use the characterization of weak Serre subcategories of
Homology, Lemma \ref{homology-lemma-characterize-weak-serre-subcategory}.
Kernels and cokernels of
maps between sheaves having property (\ref{equation-flat-comparison})
also have property (\ref{equation-flat-comparison}). This is clear because
$f_{small}^*$ is exact for a flat morphism of schemes and since the restriction
functors $(-)|_{U_{\acute{e}tale}}$ are exact (since we are working in
the \'etale topology. Finally, if $0 \to \mathcal{F}_1 \to \mathcal{F}_2
\to \mathcal{F}_3 \to 0$ is a short exact sequence of
$\textit{Mod}(\mathcal{X}_{\acute{e}tale}, \mathcal{O}_\mathcal{X})$
and the outer two sheaves have (\ref{equation-flat-comparison}) then
the middle one does as well, again because of the exactness of
$f_{small}^*$ and the restriction functors (and the 5 lemma).

\medskip\noindent
Let $g : \mathcal{Y} \to \mathcal{X}$ be a surjective smooth
morphisms of algebraic stacks and assume $g^*\mathcal{F}$
has (\ref{equation-flat-comparison}). By part (1), the definition of
an algebraic stack, and the fact that compositions of smooth morphisms
are smooth (see
Morphisms of Stacks, Lemma \ref{stacks-morphisms-lemma-composition-smooth})
we may assume that $\mathcal{Y}$ is a scheme. Let $U' \to \mathcal{X}$
be a morphism and let $f : U \to U'$ be a flat morphism of schemes.
By Sheaves on Stacks, Lemma
\ref{stacks-sheaves-lemma-surjective-flat-locally-finite-presentation}
there exists a surjective \'etale morphism $V' \to U'$ such that
$V' \to U' \to \mathcal{X}$ factors through $\mathcal{Y}$.
Thus we obtain a commutative diagram
$$
\xymatrix{
V = U \times_{U'} V' \ar[r]_-{f'} \ar[d] &
V' \ar[r] \ar[d] & \mathcal{Y} \ar[d]^g \\
U \ar[r]^f & U' \ar[r] & \mathcal{X}
}
$$
Note that $f'$ is a flat morphism of schemes as a base change of $f$.
By assumption the comparison map
$c_\psi : (f')_{small}^*\big(g^*\mathcal{F}|_{V'_{\acute{e}tale}}\big)
\to g^*\mathcal{F}|_{V_{\acute{e}tale}}$ is an isomorphism.
Because the vertical arrows $V' \to U'$ and $V \to U$ are \'etale,
the sheaves $g^*\mathcal{F}|_{V'_{\acute{e}tale}}$ and
$g^*\mathcal{F}|_{V_{\acute{e}tale}}$ are the restrictions of
$\mathcal{F}|_{U'_{\acute{e}tale}}$ and $\mathcal{F}|_{U_{\acute{e}tale}}$
and the map $c_\psi$ is the restriction of $c_\varphi$ to
$V_{\acute{e}tale}$, see
Sheaves on Stacks, Lemma \ref{stacks-sheaves-lemma-comparison}.
Since $V \to U$ is surjective, this implies
that the comparison map $c_\varphi$ is an isomorphism which is what
we wanted to prove.
\end{proof}

\begin{lemma}
\label{lemma-flat-comparison}
Let $g : \mathcal{X} \to \mathcal{Y}$ be a quasi-compact and
quasi-separated morphism of algebraic stacks. Let 
$\mathcal{F}$ be a locally quasi-coherent
$\mathcal{O}_\mathcal{X}$-module.
\begin{enumerate}
\item If $\mathcal{F}$ has property (\ref{equation-flat-comparison})
then so does $R^ig_*\mathcal{F}$.
\item If $\mathcal{F}$ has property (\ref{equation-fppf-comparison})
then so does $R^ig_*\mathcal{F}$.
\end{enumerate}
In both cases higher direct images are computed in the \'etale topology.
\end{lemma}

\begin{proof}
Proof of (1). By the exact same arguments as in the two first paragraphs
of the proof of
Lemma \ref{lemma-pushforward-locally-quasi-coherent}
(using the results of
Lemma \ref{lemma-check-flat-comparison-on-etale-covering}
in addition to the properties of locally quasi-coherent modules)
we reduce to proving this when $g$ is representable by algebraic spaces.
In this case, suppose $y'$ is an object of $\mathcal{Y}$ lying over a scheme
$V'$ and that $f : V \to V'$ is a flat morphism of schemes.
Then we obtain a flat morphism of algebraic spaces $Z \to Z'$ fitting
into the diagram
$$
\xymatrix{
Z \ar[d]_{g''} \ar[r]_q & Z' \ar[r]_{q'} \ar[d]_{g'} & \mathcal{X} \ar[d]^g \\
V \ar[r]^f & V' \ar[r]^{y'} & \mathcal{Y}
}
$$
with both squares cartesian. Since
(\ref{equation-flat-comparison}) holds for $\mathcal{F}$ we see that
$$
q_{small}^*\big((q')^*\mathcal{F}|_{Z'_{\acute{e}tale}}\big)
\longrightarrow
(q' \circ q)^*\mathcal{F}|_{Z_{\acute{e}tale}}
$$
is an isomorphism (we can see this by looking at \'etale coverings
of $Z$ and $Z'$ by schemes; details omitted). Moreover,
$$
R^ig_*\mathcal{F}|_{V'_{\acute{e}tale}} =
R^i(g')_{small, *}\big((q')^*\mathcal{F}|_{Z'_{\acute{e}tale}}\big)
$$
and
$$
R^ig_*\mathcal{F}|_{V_{\acute{e}tale}} =
R^i(g'')_{small, *}\big((q' \circ q)^*\mathcal{F}|_{Z_{\acute{e}tale}}\big)
$$
by
Sheaves on Stacks, Lemma
\ref{stacks-sheaves-lemma-compare-representable-morphism-cohomology}.
Hence we see that the comparision map is an isomorphism by
Cohomology of Spaces, Lemma
\ref{spaces-cohomology-lemma-flat-base-change-cohomology}.
The proof of (2) is omitted.
\end{proof}














\input{chapters}

\bibliography{my}
\bibliographystyle{amsalpha}

\end{document}
