\input{preamble}

% OK, start here.
%
\begin{document}

\title{Schemes}

%\begin{abstract}
%\end{abstract}

\maketitle

\tableofcontents

\section{Introduction}
\label{section-introduction}

\noindent
In this document we define schemes.
A basic reference is \cite{EGA}.

\section{Locally ringed spaces}
\label{section-locally-ringed-spaces}

\noindent
Recall that we defined ringed spaces
in Sheaves, Section \ref{sheaves-section-ringed-spaces}.
Briefly, a ringed space is a pair $(X, \mathcal{O}_X)$ consisting
of a topological space $X$ and a sheaf of rings $\mathcal{O}_X$.
A morphism of ringed spaces $f : (X, \mathcal{O}_X) \to (Y, \mathcal{O}_Y)$
is given by a continuous map $f : X \to Y$ and an $f$-map of sheaves
of rings $f^\sharp : \mathcal{O}_Y \to \mathcal{O}_X$. You can
think of $f^\sharp$ as a map $\mathcal{O}_Y \to f_*\mathcal{O}_X$, see
Sheaves, Definition \ref{sheaves-definition-f-map} and Lemma
\ref{sheaves-lemma-f-map}.

\medskip\noindent
A good geometric example of this to keep in mind is
$\mathcal{C}^\infty$-manifolds and morphisms of
$\mathcal{C}^\infty$-manifolds. Namely, if $M$ is a
$\mathcal{C}^\infty$-manifold, then the sheaf $\mathcal{C}^\infty_M$
of smooth functions is a sheaf of rings on $M$. And any
map $f : M \to N$ of manifolds is smooth if and only if
for every local section $h$ of $\mathcal{C}^\infty_N$
the composition $h \circ f$ is a local section of $\mathcal{C}^\infty_M$.
Thus a smooth map $f$ gives rise in a natural way to a morphism
of ringed spaces
$$
f : (M , \mathcal{C}^\infty_M) \longrightarrow (N, \mathcal{C}^\infty_N)
$$
see Sheaves, Example \ref{sheaves-example-continuous-map-ringed}.
It is instructive to consider what happens to stalks. Namely, let
$m \in M$ with image $f(m) = n \in N$. Recall that the stalk
$\mathcal{C}^\infty_{M,m}$ is the ring of germs of smooth
functions at $m$, see
Sheaves, Example \ref{sheaves-example-germs-functions}.
The algebra of germs of functions on $(M,m)$ is a local ring with maximal
ideal the functions which vanish at $m$.
Similarly for $\mathcal{C}^\infty_{N,n}$. The map on stalks
$f^\sharp : \mathcal{C}^\infty_{N,n} \to \mathcal{C}^\infty_{M,m}$
maps the maximal ideal into the maximal ideal, simply
because $f(m) = n$.

\medskip\noindent
In algebraic geometry we study schemes. On a scheme the sheaf of rings
is not determined by an intrinsic property of the space.
The spectrum of a ring $R$
(see Algebra, Section \ref{algebra-section-spectrum-ring}) endowed
with a sheaf of rings constructed out of $R$ (see below),
will be our basic building block. It will turn out that
the stalks of $\mathcal{O}$ on $\text{Spec}(R)$ are the local
rings of $R$ at its primes. There are two reasons to introduce
locally ringed spaces in this setting: (1) There is in general
no mechanism that assigns to a continuous map of spectra a
map of the corresponding rings. This is why we add as an extra datum
the map $f^\sharp$. (2) If we consider morphisms
of these spectra in the category of ringed spaces, then the
maps on stalks may not be local homomorphisms. Since our
geometric intuition says it should we introduce locally ringed spaces
as follows.

\begin{definition}
\label{definition-locally-ringed-space}
\begin{enumerate}
\item A {\it locally ringed space $(X,\mathcal{O}_X)$}
is a pair consisting of a
topological space $X$ and a sheaf of rings $\mathcal{O}_X$ all of whose stalks
are local rings.
\item A {\it morphism of locally ringed spaces}
$(f, f^\sharp) : (X, \mathcal{O}_X) \to (Y,\mathcal{O}_Y)$
is a morphism of ringed spaces such that for all $x \in X$
the induced ring map $\mathcal{O}_{Y,f(x)} \to \mathcal{O}_{X,x}$ is a
local ring map.
\end{enumerate}
\end{definition}

\noindent
We will usually suppress the sheaf of rings $\mathcal{O}_X$
in the notation when discussing locally ringed spaces. We will
simply refer to ``the locally ringed space $X$''.
We will by abuse of notation think of $X$ also as
the underlying topological space. Finally we will denote
the corresponding sheaf of rings
$\mathcal{O}_X$ as the {\it structure sheaf of $X$}.
In addition, it is customary to denote the maximal ideal
of the local ring $\mathcal{O}_{X, x}$ by
$\mathfrak{m}_{X,x}$ or simply $\mathfrak{m}_x$.
We will say ``let $f : X \to Y$ be a morphism of locally ringed
spaces'' thereby surpressing the structure sheaves even further.
In this case, we will by abuse of notation think of $f : X\to Y$
also as the underlying continuous map of topological spaces.
The $f$-map corresponding to $f$ will customarily
be denoted $f^\sharp$. The condition that $f$ is a morphism
of locally ringed spaces can then be expressed by saying that
for every $x\in X$ the map on stalks
$$
f^\sharp_x : \mathcal{O}_{Y,f(x)} \longrightarrow \mathcal{O}_{X, x}
$$
maps the maximal ideal $\mathfrak m_{Y, f(x)}$ into
$\mathfrak m_{X, x}$.

\medskip\noindent
Let us use these notational conventions to show that the
collection of locally ringed spaces and morphisms of locally
ringed spaces forms a category. In order to see this we have
to show that the composition of morphisms of locally ringed
spaces is a morphism of locally ringed spaces. OK, so let
$f : X \to Y$ and $g : Y \to Z$ be morphism of locally
ringed spaces. The composition of $f$ and $g$ is defined in
Sheaves, Definition \ref{sheaves-definition-composition-maps-ringed-spaces}.
Let $x \in X$. By
Sheaves, Lemma \ref{sheaves-lemma-compose-f-maps-stalks}
the composition
$$
\mathcal{O}_{Z, g(f(x))}
\xrightarrow{g^\sharp}
\mathcal{O}_{Y, f(x)}
\xrightarrow{f^\sharp}
\mathcal{O}_{X, x}
$$
is the associated map on stalks for the morphism $g \circ f$.
The result follows since a composition of local ring
homomorphisms is a local ring homomorphism.

\medskip\noindent
A pleasing feature of the definition is the fact that the functor
$$
\textit{Locally ringed spaces}
\longrightarrow
\textit{Ringed spaces}
$$
reflects isomorphisms. Here is a less abstract statement.

\begin{lemma}
\label{lemma-isomorphism-locally-ringed}
Let $X$, $Y$ be locally ringed spaces.
If $f : X \to Y$ is an isomorphism of
ringed spaces, then $f$ is an isomorphism
of locally ringed spaces.
\end{lemma}

\begin{proof}
This follows trivially from the corresponding fact in algebra:
Suppose $A$, $B$ are local rings. Any isomorphism of rings
$A \to B$ is a local ring homomorphism.
\end{proof}













\section{Immersions of locally closed spaces}
\label{section-immersion}

\begin{definition}
\label{definition-immersion-locally-ringed-spaces}
Let $f : X \to Y$ be a morphism of locally ringed spaces.
\begin{enumerate}
\item We say that $f$ is an {\it open immersion} if
$f$ is a homeomorphism of $X$ onto an open subset
of $Y$, and the map $f^{-1}\mathcal{O}_Y \to \mathcal{O}_X$
is an isomorphism.
\item We say that $f$ is a {\it closed immersion} if
$f$ is a homeomorphism onto a closed subset of $Y$,
and the map $\mathcal{O}_Y \to f_*\mathcal{O}_X$ is
surjective\footnote{This is not a good notion.
A better notion would be to require in addition that
the kernel is a quasi-coherent sheaf of $\mathcal{O}_Y$-modules}.
\item We say that $f$ is a {\it locally closed immersion},
or simply an {\it immersion}, if $f$ can be factored as
$f = j \circ i$, where $i$ is a closed immersion of locally
ringed spaces and $j$ is an open immersion of locally
ringed spaces.
\end{enumerate}
\end{definition}

\begin{example}
\label{example-open-subspace}
Let $X$ be a locally ringed space.
Let $U \subset X$ be an open subset.
Let $\mathcal{O}_U = \mathcal{O}_X|_U$ be the restriction
of $\mathcal{O}_X$ to $U$. For $u \in U$ the stalk $\mathcal{O}_{U, u}$
is equal to the stalk $\mathcal{O}_{X, u}$, and hence is a
local ring. Thus $(U, \mathcal{O}_U)$ is a locally ringed
space and the morphism $j : (U, \mathcal{O}_U) \to (X, \mathcal{O}_X)$
is an open immersion.
\end{example}

\begin{definition}
\label{definition-open-subspace}
Let $X$ be a locally ringed space.
Let $U \subset X$ be an open subset.
The locally ringed space $(U, \mathcal{O}_U)$
of Example \ref{example-open-subspace} above
is {\it the open subspace of $X$ associated to $U$}.
\end{definition}

\begin{lemma}
\label{lemma-open-immersion}
Let $f : X \to Y$ be an open immersion of 
locally ringed spaces. Let $j : V = f(X) \to Y$
be the open subspace of $Y$ associated to the image of $f$.
There is a unique isomorphism $f' : X \cong V$ of
locally ringed spaces such that $f = j \circ f'$.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\noindent
From now on we do not distinghuish between open subsets
and their associated subspaces.

\begin{lemma}
\label{lemma-restrict-map-to-opens}
Let $f : X \to Y$ be a morphism of locally ringed spaces.
Let $U \subset X$, and $V \subset Y$ be open subsets.
Suppose that $f(U) \subset V$. There exists a unique
morphism of locally ringed spaces $f|_U : U \to V$ such
that the following diagram is a commutative square of
locally ringed spaces
$$
\xymatrix{
U \ar[d]_{f|_U} \ar[r] & X \ar[d]^f \\
V \ar[r] & Y 
}
$$
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-support-sheaf-rings-closed}
Let $X$ be a topological space.
Let $\mathcal{O}$ be a sheaf of rings.
The support of $\mathcal{O}$ is closed.
\end{lemma}

\begin{proof}
Suppose $x \in X$ and $\mathcal{O}_x = 0$.
Then $1 = 0$ in $\mathcal{O}_x$. Thus there
exists an open neighbourhood $U$ of $x$
such that $1 = 0$ in $\Gamma(U, \mathcal{O})$.
Thus $\mathcal{O}|_U = 0$.
\end{proof}

\begin{example}
\label{example-closed-subspace}
Let $X$ be a locally ringed space.
Let $\mathcal{I} \subset \mathcal{O}_X$ be a sheaf of ideals.
Consider the short exact sequence
$$
0 \to \mathcal{I} \to \mathcal{O}_X \to \mathcal{O}' \to 0
$$
which defines the sheaf of rings $\mathcal{O}'$.
The support $Z$ of the sheaf $\mathcal{O}'$ is closed.
Denote $i : Z \to X$ the inclusion map. By Sheaves, Lemma \ref{},
we have $\mathcal{O}' = i_* \mathcal{O}_Z$ for some sheaf
of rings $\mathcal{O}_Z$. For $z \in Z$ the stalk
$\mathcal{O}_{Z, z} = \mathcal{O}'_{i(z)} =
\mathcal{O}_{X, i(z)}/\mathcal{I}_{i(z)}$ is a local ring.
Thus we see that $(Z, \mathcal{O}_Z)$ is a locally ringed
space. The pair $(i, \mathcal{O}_Y \to i_*\mathcal{O}_Z)$
is a closed immersion of locally ringed spaces.
\end{example}

\begin{definition}
\label{definition-closed-subspace}
Let $X$ be a locally ringed space.
Let $\mathcal{I} \subset \mathcal{O}_X$ be a sheaf of ideals.
The locally ringed space $(Z, \mathcal{O}_Z)$
of Example \ref{example-closed-subspace} above
is {\it the closed subspace of $X$ associated to $\mathcal{I}$}.
\end{definition}

\begin{lemma}
\label{lemma-closed-immersion}
Let $f : X \to Y$ be a closed immersion of 
locally ringed spaces. Let $\mathcal{I} \subset \mathcal{O}_Y$
be the kernel of the map $\mathcal{O}_Y \to f_*\mathcal{O}_X$.
Let $i : (Z, \mathcal{O}_Z) \to (Y, \mathcal{O}_Y)$
be the closed subspace associated to $\mathcal{I}$.
There is a unique isomorphism $f' : X \cong Z$ of
locally ringed spaces such that $f = i \circ f'$.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

























\section{Affine schemes}
\label{section-affine-schemes}

\noindent
Let $R$ be a ring. Consider the topological space $\text{Spec}(R)$
associated to $R$, see Algebra, Section \ref{algebra-section-spectrum-ring}.
We will endow this space with a sheaf of rings $\mathcal{O}_{\text{Spec}(R)}$
and the resulting pair $(\text{Spec}(R), \mathcal{O}_{\text{Spec}(R)})$
will be an affine scheme.

\medskip\noindent
Recall that $\text{Spec}(R)$ has a basis of open sets $D(f)$,
$f \in R$ which we call standard opens, see Algebra,
Definition \ref{algebra-definition-Zariski-topology}.
In addition, the intersection of two standard opens is another:
$D(f) \cap D(g) = D(fg)$, $f,g\in R$.

\begin{lemma}
\label{lemma-standard-open}
Let $R$ be a ring. Let $f \in R$.
\begin{enumerate}
\item If $g\in R$ and $D(g) \subset D(f)$,
then (a) $f$ is invertible in $R_g$,
(b) $g^e = af$ for some $e \geq 1$ and $a \in R$,
(c) there is a canonical ring map $R_f \to R_g$, and (d)
there is a canonical $R_f$-module map
$M_f \to M_g$ for any $R$-module $M$.
\item Any open covering of $D(f)$ can be refined to a finite
open covering of the form $D(f) = \bigcup_{i=1}^n D(g_i)$.
\item If $g_1,\ldots,g_n \in R$, then $D(f) \subset \bigcup D(g_i)$
if and only if $g_1,\ldots,g_n$ generate the unit ideal in $R_f$.
\end{enumerate}
\end{lemma}

\begin{proof}
Recall that $D(g) = \text{Spec}(R_g)$ (see
Algebra, Lemma \ref{algebra-lemma-standard-open}).
Thus (a) holds because $f$
maps to an element of $R_g$ which is not
contained in any prime ideal, and hence invertible,
see Algebra, Lemma \ref{algebra-lemma-Zariski-topology}.
Write the inverse of $f$ in $R_g$ as $a/g^d$.
This means $g^d - af$ is annihilated by a power of $g$, whence (b).
For (c), the map $R_f \to R_g$ exists by (a) from the universal property
of localization, or we can define it by mapping $b/f^n$
to $a^nb/g^{ne}$. The equality $M_f = M \otimes_R R_f$
can be used to obtain the map on modules, or
we can define $M_f \to M_g$ by mapping
$x/f^n$ to $a^nx/g^{ne}$.

\medskip\noindent
Recall that $D(f)$ is quasi-compact, see 
Algebra, Lemma \ref{algebra-lemma-qc-open}.
Hence the second statement follows directly
from the fact that the standard opens form
a basis for the topology.

\medskip\noindent
The third statement follows directly from
Algebra, Lemma \ref{algebra-lemma-Zariski-topology}.
\end{proof}

\noindent
In Sheaves, Section \ref{sheaves-section-bases} we defined
the notion of a sheaf on a basis, and we showed that it is
essentially equivalent to the notion of a sheaf on the space,
see Sheaves, Lemmas \ref{sheaves-lemma-extend-off-basis} and
\ref{sheaves-lemma-extend-off-basis-structures}. Moreover,
we showed in
Sheaves, Lemma \ref{sheaves-lemma-cofinal-systems-coverings-standard-case}
that it is sufficient to check the sheaf
condition on a cofinal system of open coverings for each
standard open. By the lemma above it suffices to check
on the finite coverings by standard opens.

\begin{definition}
\label{definition-standard-covering}
Let $R$ be a ring.
\begin{enumerate}
\item A {\it standard open covering} of $\text{Spec}(R)$
is a covering $\text{Spec}(R) = \bigcup_{i=1}^n D(f_i)$,
where $f_1,\ldots, f_n \in R$.
\item Suppose that $D(f) \subset \text{Spec}(R)$ is a standard
open. A {\it standard open covering} of $D(f)$
is a covering $D(f) = \bigcup_{i=1}^n D(g_i)$,
where $g_1,\ldots, g_n \in R$.
\end{enumerate}
\end{definition}

\noindent
Let $R$ be a ring. Let $M$ be an $R$-module. We will define
a presheaf $\widetilde M$ on the basis of standard opens.
Suppose that $U \subset \text{Spec}(R)$ is a standard open.
If $f, g \in R$ are such that $D(f) = D(g)$, then
by Lemma \ref{lemma-standard-open} above there are canonical
maps $M_f \to M_g$ and $M_g \to M_f$ which are mutually inverse.
Hence we may choose any $f$ such that $U = D(f)$
and define
$$
\widetilde M(U) = M_f.
$$
Note that if $D(g) \subset D(f)$, then by
Lemma \ref{lemma-standard-open} above we have
a canonical map
$$
\widetilde M(D(f)) = M_f \longrightarrow M_g = \widetilde M(D(g)).
$$
Clearly, this defines a presheaf of abelian groups on the basis
of standard opens. If $M = R$, then $\widetilde R$ is a presheaf
of rings on the basis of standard opens.

\medskip\noindent
Let us compute the stalk of $\widetilde M$ at a point $x \in \text{Spec}(R)$.
Suppose that $x$ corresponds to the prime $\mathfrak p \subset R$.
By definition of the stalk we see that
$$
\widetilde M_x = \text{colim}_{f\in R, f\not\in \mathfrak p}\ M_f
$$
Here the set $\{f\in R, f\not\in \mathfrak p\}$ is partially
ordered by the rule $f \geq f' \Leftrightarrow D(f) \subset D(f')$.
If $f_1, f_2 \in R \setminus \mathfrak p$, then we have
$f_1f_2 \geq f_1$ in this ordering. Hence by
Algebra, Lemma \ref{algebra-lemma-localization-colimit}
we conclude that
$$
\widetilde M_x = M_{\mathfrak p}.
$$

\medskip\noindent
Next, we check the sheaf condition for the standard open coverings.
If $D(f) = \bigcup_{i=1}^n D(g_i)$, then the sheaf condition
for this covering is equivalent with the exactness of the
sequence
$$
0 \to M_f \to \bigoplus M_{g_i} \to \bigoplus M_{g_ig_j}.
$$
Note that $D(g_i) = D(fg_i)$, and hence we can rewrite this
sequence as the sequence
$$
0 \to M_f \to \bigoplus M_{fg_i} \to \bigoplus M_{fg_ig_j}.
$$
In addition, by Lemma \ref{lemma-standard-open} above
we see that $g_1,\ldots,g_n$ generate the unit ideal
in $R_f$. Thus we may apply
Algebra, Lemma \ref{algebra-lemma-cover-module}
to the module $M_f$ over $R_f$ and the elements $g_1,\ldots,g_n$.
We conclude that the sequence is exact. By the remarks
made above, we see that $\widetilde M$ is a sheaf
on the basis of standard opens.

\medskip\noindent
Thus we conclude from the material in
Sheaves, Section \ref{sheaves-section-bases}
that there exists a
unique sheaf of rings $\mathcal{O}_{\text{Spec}(R)}$
which agrees with $\widetilde R$ on the standard opens.
Note that by our computation of stalks above, the
stalks of this sheaf of rings are all local rings.

\medskip\noindent
Similarly, for any $R$-module $M$ there exists
a unique sheaf of $\mathcal{O}_{\text{Spec}(R)}$-modules
$\mathcal{F}$ which agrees with $\widetilde M$ on the
standard opens, see
Sheaves, Lemma \ref{sheaves-lemma-extend-off-basis-module}.

\begin{definition}
\label{definition-structure-sheaf}
Let $R$ be a ring.
\begin{enumerate}
\item The {\it structure sheaf $\mathcal{O}_{\text{Spec}(R)}$ of the
spectrum of $R$} is the unique sheaf of rings $\mathcal{O}_{\text{Spec}(R)}$
which agrees with $\widetilde R$ on the basis of standard opens.
\item The locally ringed space
$(\text{Spec}(R), \mathcal{O}_{\text{Spec}(R)})$ is called
the {\it spectrum} of $R$ and denoted $\text{Spec}(R)$.
\item The sheaf of $\mathcal{O}_{\text{Spec}(R)}$-modules
extending $\widetilde M$ to all opens of $\text{Spec}(R)$
is called the sheaf of $\mathcal{O}_{\text{Spec}(R)}$-modules
associated to $M$.
\end{enumerate}
\end{definition}

\noindent
We summarize the results obtained so far.

\begin{lemma}
\label{lemma-spec-sheaves}
Let $R$ be a ring. Let $M$ be an $R$-module. Let $\mathcal{F}$
be the sheaf of $\mathcal{O}_{\text{Spec}(R)}$-modules
associated to $M$.
\begin{enumerate}
\item We have
$$
\Gamma(\text{Spec}(R), \mathcal{O}_{\text{Spec}(R)}) = R
$$
\item We have
$$
\Gamma(\text{Spec}(R), \mathcal{F}) = M
$$
as an $R$-module.
\item For every $f \in R$ we have 
$$
\Gamma(D(f), \mathcal{O}_{\text{Spec}(R)}) = R_f
$$
\item For every $f\in R$ we have
$$
\Gamma(D(f), \mathcal{F}) = M_f
$$
as an $R_f$-module.
\item Whenever $D(g) \subset D(f)$ the restriction mappings
$R_f \to R_g$ and $M_f \to M_g$ are the ones from Lemma
\ref{lemma-standard-open}.
\item Let $\mathfrak p$ be a prime of $R$, and let $x \in \text{Spec}(R)$
be the corresponding point. We have
$$
\mathcal{O}_{\text{Spec}(R), x} = R_{\mathfrak p}
$$
\item Let $\mathfrak p$ be a prime of $R$, and let $x \in \text{Spec}(R)$
be the corresponding point. We have
$$
\mathcal{F}_x = M_{\mathfrak p}
$$
as an $R_{\mathfrak p}$-module.
\end{enumerate}
\end{lemma}

\begin{proof}
Clear from the discussion above.
\end{proof}

\begin{definition}
\label{definition-affine-scheme}
An {\it affine scheme} is a locally ringed space isomorphic
as a locally ringed space to $\text{Spec}(R)$ for some ring $R$. 
A {\it morphism of affine schemes} is a morphism in the category
of locally ringed spaces.
\end{definition}

\noindent
It turns out that affine schemes play a special role
among all locally ringed spaces, which is what the next
section is about.

\section{The category of affine schemes}
\label{section-category-affine-schemes}

\noindent
Note that if $Y$ is an affine scheme, then its
points are in canonical $1-1$ bijection with
prime ideals in $\Gamma(Y, \mathcal{O}_Y)$.

\begin{lemma}
\label{lemma-morphism-into-affine-where-point-goes}
Let $X$ be a locally ringed space.
Let $Y$ be an affine scheme.
Let $f \in \text{Mor}(X, Y)$ be a morphism
of locally ringed spaces. Given a point $x \in X$
consider the ring maps
$$
\Gamma(Y, \mathcal{O}_Y) \xrightarrow{f^\sharp}
\Gamma(X, \mathcal{O}_X) \to \mathcal{O}_{X, x}
$$
Let $\mathfrak p \subset \Gamma(Y, \mathcal{O}_Y)$ denote
the inverse image of $\mathfrak m_x$. Let $y \in Y$ be the
corresponding point. Then $f(x) = y$.
\end{lemma}

\begin{proof}
Consider the commutative diagram
$$
\xymatrix{
\Gamma(X, \mathcal{O}_X) \ar[r] &
\mathcal{O}_{X, x} \\
\Gamma(Y, \mathcal{O}_Y) \ar[r] \ar[u] &
\mathcal{O}_{Y, f(x)} \ar[u]
}
$$
(see the discussion of $f$-maps below
Sheaves, Definition \ref{sheaves-definition-f-map}).
Since the right vertical arrow is local
we see that $\mathfrak m_{f(x)}$ is the
inverse image of $\mathfrak m_x$. The result
follows.
\end{proof}

\begin{lemma}
\label{lemma-f-open}
Let $X$ be a locally ringed space.
Let $f \in \Gamma(X, \mathcal{O}_X)$.
The set
$$
D(f) = \{x \in X \mid \text{image }f \not\in \mathfrak m_x\}
$$
is open. Moreover $f|_{D(f)}$ has an inverse.
\end{lemma}

\begin{proof}
Suppose that $U \subset X$ and $V \subset X$ are
two open subsets such that $f|_U$ has an inverse
$g$ and $f|_V$ has an inverse $h$. Then clearly
$g|_{U\cap V} = h|_{U\cap V}$. Thus it suffices
to show that $f$ is invertible in an open neighbourhood
of any $x \in D(f)$. This is clear because
$f \not \in \mathfrak m_x$ implies that $f \in \mathcal{O}_{X,x}$
has an inverse $g \in \mathcal{O}_{X,x}$ which means there
is some open neighbourhood $x \in U \subset X$ so
that $g \in \mathcal{O}_X(U)$ and $g\cdot f|_U = 1$.
\end{proof}

\begin{lemma}
\label{lemma-f-open-affine}
In Lemma \ref{lemma-f-open} above, if $X$ is an affine scheme,
then the open $D(f)$ agrees with the standard open $D(f)$
defined previously (in
Algebra, Definition \ref{algebra-definition-spectrum-ring}).
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-morphism-into-affine}
Let $X$ be a locally ringed space.
Let $Y$ be an affine scheme.
The map
$$
\text{Mor}(X, Y)
\longrightarrow
\text{Hom}(\Gamma(Y, \mathcal{O}_Y), \Gamma(X, \mathcal{O}_X))
$$
which maps $f$ to the restriction of $f^\sharp$ to global
sections is bijective.
\end{lemma}

\begin{proof}
Since $Y$ is affine we have
$(Y, \mathcal{O}_Y) \cong (\text{Spec}(R), \mathcal{O}_{\text{Spec}(R)})$
for some ring $R$.
During the proof we will use facts about $Y$ and
its structure sheaf which are direct consequences of things
we know about the spectrum of a ring, see e.g.\ Lemma
\ref{lemma-spec-sheaves}.

\medskip\noindent
Motivated by the lemmas above we construct the inverse map.
Let $\psi_Y : \Gamma(Y, \mathcal{O}_Y) \to \Gamma(X, \mathcal{O}_X)$
be a ring map. First, we define the corresponding map of
spaces
$$
\Psi : X \longrightarrow Y
$$
by the rule of
Lemma \ref{lemma-morphism-into-affine-where-point-goes}.
In other words, given $x \in X$ we define $\Psi(x)$
to be the point of $Y$ corresponding to the prime
in $\Gamma(Y, \mathcal{O}_Y)$ which is the inverse
image of $\mathfrak m_x$ under the composition
$
\Gamma(Y, \mathcal{O}_Y) \xrightarrow{\psi_Y}
\Gamma(X, \mathcal{O}_X) \to
\mathcal{O}_{X, x}
$.

\medskip\noindent
We claim that the map $\Psi : X \to Y$ is continuous.
The standard opens $D(g)$, for $g \in \Gamma(Y, \mathcal{O}_Y)$
are a basis for the toppology of $Y$. Thus it suffices to prove
that $\Psi^{-1}(D(g))$ is open. By construction of $\Psi$
the inverse image $\Psi^{-1}(D(g))$ is exactly the set
$D(\psi_Y(g)) \subset X$ which is open by Lemma \ref{lemma-f-open}.
Hence $\Psi$ is continuous.

\medskip\noindent
Next we construct a $\Psi$-map of sheaves from
$\mathcal{O}_Y$ to $\mathcal{O}_X$. By
Sheaves, Lemma \ref{sheaves-lemma-f-map-basis-below-structures}
it suffices to define ring maps
$\psi_{D(g)} : \Gamma(D(g), \mathcal{O}_Y) \to
\Gamma(\Psi^{-1}(D(g)), \mathcal{O}_X)$
compatible with restriction maps.
We have a canonical isomorphism
$\Gamma(D(g), \mathcal{O}_Y) = \Gamma(Y, \mathcal{O}_Y)_g$,
because $Y$ is an affine scheme.
Because $\psi_Y(g)$ is invertible on $D(\psi_Y(g))$
we see that there is a canonical map
$$
\Gamma(Y, \mathcal{O}_Y)_g
\longrightarrow
\Gamma(\Psi^{-1}(D(g)), \mathcal{O}_X)
=
\Gamma(D(\psi_Y(g)), \mathcal{O}_X) 
$$
extending the map $\psi_Y$
by the universal property of localization.
Note that there is no choice but to take the canonical map here!
And we take this, combined
with the canonical identification
$\Gamma(D(g), \mathcal{O}_Y) = \Gamma(Y, \mathcal{O}_Y)_g$, to
be $\psi_{D(g)}$. This is compatible with localization since the
restriction mapping on the affine schemes are defined in terms
of the universal properties of localization also, see
Lemmas \ref{lemma-spec-sheaves} and \ref{lemma-standard-open}.

\medskip\noindent
Thus we have defined a morphism of ringed spaces
$(\Psi, \psi) : (X, \mathcal{O}_X) \to (Y, \mathcal{O}_Y)$
recovering $\psi_Y$ on global sections. To see that it is
a morphism of locally ringed spaces we have to show that
the induced maps on local rings
$$
\psi_x : \mathcal{O}_{Y,\Psi(x)} \longrightarrow \mathcal{O}_{X, x}
$$
are local. This follows immediately from the commutative diagram
of the proof of Lemma \ref{lemma-morphism-into-affine-where-point-goes}
and the definition of $\Psi$.

\medskip\noindent
Finally, we have to show that the constructions
$(\Psi, \psi) \mapsto \psi_Y$ and the construction
$\psi_Y \mapsto (\Psi, \psi)$ are inverse to each other.
Clearly, $\psi_Y \mapsto (\Psi, \psi) \mapsto \psi_Y$.
Hence the only thing to prove is that given $\psi_Y$
there is at most one pair $(\Psi, \psi)$ giving rise
to it. The uniqueness of $\Psi$ was shown in Lemma
\ref{lemma-morphism-into-affine-where-point-goes} and
given the uniqueness of $\Psi$ the uniqueness of the
map $\psi$ was pointed out during the course of the proof
above.
\end{proof}

\begin{lemma}
\label{lemma-category-affine-schemes}
The category of affine schemes is equivalent to the opposite of the
category of rings. The equivalence is given by the functor that associates
to an affine scheme the global sections of its structure sheaf.
\end{lemma}

\begin{proof}
This is now clear from Definition \ref{definition-affine-scheme}
and Lemma \ref{lemma-morphism-into-affine}.
\end{proof}

\begin{lemma}
\label{lemma-standard-open-affine}
Let $Y$ be an affine scheme.
Let $f \in \Gamma(Y, \mathcal{O}_Y)$.
The open subspace $D(f)$ is an affine scheme.
\end{lemma}

\begin{proof}
We may assume that $Y = \text{Spec}(R)$ and $f \in R$.
Consider the morphism of affine schemes
$f : U = \text{Spec}(R_f) \to \text{Spec}(R) = Y$ induced by the ring
map $R \to R_f$. By Algebra, Lemma \ref{algebra-lemma-standard-open}
we know that it is a homeomorphism onto $D(f)$.
On the other hand, the map $f^{-1}\mathcal{O}_Y \to \mathcal{O}_U$
is an isomorphism on stalks, hence an isomorphism. Thus we see
that $f$ is an open immersion. We conclude that $D(f)$
is isomorphic to $U$ by Lemma \ref{lemma-open-immersion}.
\end{proof}










\section{Closed subspaces of affine schemes}
\label{section-closed-in-affine}


\begin{example}
\label{example-closed-immersion-affines}
Let $R$ be a ring.
Let $I \subset R$ be an ideal.
Consider the morphism of affine schemes
$i : Z = \text{Spec}(R/I) \to \text{Spec}(R) = X$.
By Algebra, Lemma \ref{lemma-spec-closed}
this is a homeomorphism of $Z$ onto a closed
subset of $X$. Moreover, if $I \subset \mathfrak p \subset R$
is a prime corresponding to a point $x = i(z)$, $x \in X$,
$z \in Z$, then on stalks we get the map
$$
\mathcal{O}_{X, x} = R_{\mathfrak p}
\longrightarrow
R_{\mathfrak p}/IR_{\mathfrak p} = \mathcal{O}_{Z, z}
$$
Thus we see that $i$ is a closed immersion.
\end{example}

\begin{lemma}
\label{lemma-closed-in-affine}
Let $X$ be an affine scheme.
Any closed subspace of $X$ comes
from an ideal $I \subset R$ as in Example
\ref{example-closed-immersion-affines}
above.
\end{lemma}

\begin{proof}
Let $X = \text{Spec}(R)$. Let $\mathcal{I} \subset \mathcal{O}_X$
be the sheaf of ideals which give rise to the closed subspace.
Let $x \in X$ be in the support $Z$ of
$\mathcal{O}' = \mathcal{O}_X/\mathcal{I}$, see
Example \ref{example-closed-subspace}. Let
$g \in \mathcal{I}_x \subset \mathcal{O}_{X, x}$.
There exists a neighbourhood $D(f) \subset X$ such
that $g$ comes from a section $g \in \mathcal{I}(D(f))$.
For some integer $n > 0$ there exists an element
$a \in R$ such that $f^n g = a|_{D(f)}$. Note that
$V(f) \cap Z$ is closed, quasi-compact and does not
contain $x$. For any point $z \in V(f) \cap Z$ consider
the element 




\end{proof}






\section{Schemes}
\label{section-schemes}

\begin{definition}
\label{definition-scheme}
A {\it scheme} is a locally ringed space with the property that
every point has a neighbourhood which is an affine scheme.
\end{definition}



\input{chapters}

\bibliography{my}
\bibliographystyle{alpha}

\end{document}
