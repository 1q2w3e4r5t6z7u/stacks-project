\input{preamble}

% OK, start here.
%
\begin{document}

\title{Schemes}

%\begin{abstract}
%\end{abstract}

\maketitle

\tableofcontents

\section{Introduction}
\label{section-introduction}

\noindent
In this document we define schemes.
A basic reference is \cite{EGA}.

\section{Locally ringed spaces}
\label{section-locally-ringed-spaces}

\noindent
Recall that we defined ringed spaces
in Sheaves, Section \ref{sheaves-section-ringed-spaces}.
Briefly, a ringed space is a pair $(X, \mathcal{O}_X)$ consisting
of a topological space $X$ and a sheaf of rings $\mathcal{O}_X$.
A morphism of ringed spaces $f : (X, \mathcal{O}_X) \to (Y, \mathcal{O}_Y)$
is given by a continuous map $f : X \to Y$ (which we will by abuse of
notion indicate with the same symbol) and an $f$-map of sheaves
of rings $f^\sharp : \mathcal{O}_Y \to \mathcal{O}_X$.

\medskip\noindent
A good geometric example of this to keep in mind is
$\mathcal{C}^\infty$-manifolds and morphisms of
$\mathcal{C}^\infty$-manifolds. Namely, if $M$ is a
$\mathcal{C}^\infty$-manifold, then the sheaf $\mathcal{C}^\infty_M$
of smooth functions is a sheaf of rings on $M$. And any
map $f : M \to N$ of manifolds is smooth if and only if
for every local section $h$ of $\mathcal{C}^\infty_N$
the composition $h \circ f$ is a local section of $\mathcal{C}^\infty_M$.
Thus a smooth map $f$ gives rise in a natural way to a morphism
of ringed spaces
$$
f : (M , \mathcal{C}^\infty_M) \longrightarrow (N, \mathcal{C}^\infty_N)
$$
see Sheaves, Example \ref{sheaves-example-continuous-map-ringed}.
It is instructive to consider what happens to stalks. Namely, let
$m \in M$ with image $f(m) = n \in N$. Recall that the stalk
$\mathcal{C}^\infty_{M,m}$ is the ring of germs of smooth
functions at $m$, see
Sheaves, Example \ref{sheaves-example-germs-functions}.
The algebra of germs of functions on $(M,m)$ is a local ring with maximal
ideal the functions which vanish at $m$.
Similarly for $\mathcal{C}^\infty_{N,n}$. The map on stalks
$f^\sharp : \mathcal{C}^\infty_{N,n} \to \mathcal{C}^\infty_{M,m}$
maps the maximal ideal into the maximal ideal, simply
because $f(m) = n$.

\medskip\noindent
In algebraic geometry we consider cases where the sheaf of rings
has nilpotent sections. Namely, the spectrum of a ring $R$
(see Algebra, Section \ref{algebra-section-spectrum-ring}) endowed
with a sheaf of rings constructed out of $R$ (see below),
will be our basic building block. It will turn out that
the stalks of $\mathcal{O}$ on $\text{Spec}(R)$ are the local
rings of $R$ at its primes. There are two reasons to introduce
(locally) ringed spaces in this setting: (1) There is in general
no mechanism that assigns to a continuous map of spectra a
map of the corresponding rings. This is why we add as an extra datum
the map $f^\sharp$. (2) If we consider morphisms
of these spectra in the category of ringed spaces, then the
maps on stalks may not be local homomorphisms. Since our
geometric intuition says it should we introduce locally ringed spaces
as follows.

\begin{definition}
\label{definition-locally-ringed-space}
\begin{enumerate}
\item A {\it locally ringed space $(X,\mathcal{O}_X)$}
is a pair consisting of a
topological space $X$ and a sheaf of rings $\mathcal{O}_X$ all of whose stalks
are local rings.
\item A {\it morphism of locally ringed spaces}
$(f, f^\sharp) : (X, \mathcal{O}_X) \to (Y,\mathcal{O}_Y)$
is a morphism of ringed spaces such that for all $x \in X$
the induced ring map $\mathcal{O}_{Y,f(x)} \to \mathcal{O}_{X,x}$ is a
local ring map.
\end{enumerate}
\end{definition}

\noindent
We will usually suppress the sheaf of rings $\mathcal{O}_X$
in the notation when discussing locally ringed spaces. We will
simply refer to ``the locally ringed space $X$''.
We will by abuse of notation think of $X$ also as
the underlying topological space. Finally we will denote
the corresponding sheaf of rings
$\mathcal{O}_X$ as the {\it structure sheaf of $X$}.
In addition, it is customary to denote the maximal ideal
of the local ring $\mathcal{O}_{X, x}$ by
$\mathfrak{m}_{X,x}$ or simply $\mathfrak{m}_x$.
We will say ``let $f : X \to Y$ be a morphism of locally ringed
spaces'' thereby surpressing the structure sheaves even further.
In this case, we will by abuse of notation think of $f : X\to Y$
also as the underlying continuous map of topological spaces.
The $f$-map corresponding to $f$ will customarily
be denoted $f^\sharp$. The condition that $f$ is a morphism
of locally ringed spaces can then be expressed by saying that
for every $x\in X$ the map on stalks
$$
f^\sharp_x : \mathcal{O}_{Y,f(x)} \longrightarrow \mathcal{O}_{X, x}
$$
maps the maximal ideal $\mathfrak m_{Y, f(x)}$ into
$\mathfrak m_{X, x}$.

\medskip\noindent
Let us use these notational conventions to show that the
collection of locally ringed spaces and morphisms of locally
ringed spaces forms a category. In order to see this we have
to show that the composition of morphisms of locally ringed
spaces is a morphism of locally ringed spaces. OK, so let
$f : X \to Y$ and $g : Y \to Z$ be morphism of locally
ringed spaces. The composition of $f$ and $g$ is defined in
Sheaves, Definition \ref{sheaves-definition-composition-maps-ringed-spaces}.
Let $x \in X$. By
Sheaves, Lemma \ref{sheaves-lemma-compose-f-maps-stalks}
the composition
$$
\mathcal{O}_{Z, g(f(x))}
\xrightarrow{g^\sharp}
\mathcal{O}_{Y, f(x)}
\xrightarrow{f^\sharp}
\mathcal{O}_{X, x}
$$
is the associated map on stalks for the morphism $g \circ f$.
The result follows since a composition of local ring
homomorphisms is a local ring homomorphism.

\medskip\noindent
A pleasing feature of the definition is the fact that the functor
$$
\textit{Locally ringed spaces}
\longrightarrow
\textit{Ringed spaces}
$$
reflects isomorphisms. Here is a less abstract statement.

\begin{lemma}
\label{lemma-isomorphism-locally-ringed}
Let $X$, $Y$ be locally ringed spaces.
If $f : X \to Y$ is an isomorphism of
ringed spaces, then $f$ is an isomorphism
of locally ringed spaces.
\end{lemma}

\begin{proof}
This follows trivially from the corresponding fact in algebra:
Suppose $A$, $B$ are local rings. Any isomorphism of rings
$A \to B$ is a local ring homomorphism.
\end{proof}



\section{Affine schemes}
\label{section-affine-schemes}

\noindent
An affine scheme is a locally ringed space isomorphic to a locally ringed
space of the form $\text{Spec}(A)$, for some commutative (unital) ring $A$.
(Note that $A$ can be the zero ring in which case $\text{Spec}(A)$ is
the empty space.) As a set $\text{Spec}(A)$ is the set of prime ideals of
$A$. The topology on $\text{Spec}(A)$ is the unique one that has a basis
of opens of the form $D(f) = \{ \wp \in\text{Spec}(A) \mid
f \not\in \wp \}$,
$f\in A$. The structure sheaf $\mathcal{O} = 
\mathcal{O}_{\text{Spec}(A)}$ is the unique
sheaf of rings such that (1) $\Gamma(D(f), \mathcal{O}) = A_f$ and
(2) the restriction map $\Gamma(D(f), \mathcal{O}) \to \Gamma(D(fg),
\mathcal{O})$ is the canonical map $A_f \to A_{fg}$.

\medskip\noindent
A morphism of affine schemes is a morphism in the category of locally ringed 
spaces.

\section{The category of affine schemes}
\label{section-category-affine-schemes}

\noindent
It should be clear what the category of affine schemes is, except for a
little bit of set-theoretical discussion. We will use the notation
$\text{Aff}$ to denote this category. Our approach is to use only
categories which are sets. Thus we will choose a supply of affines and
work with this. For a precise mathematical discussion, see
Section \ref{section-sets-of-affines}.

\medskip\noindent
The topology on $\text{Aff}$ will be the fppf topology. A covering is
given by a finite family of maps $\{U_i \to U\}$, where each $U_i \to U$
is a finitely presented flat morphism of affines, and $\coprod U_i \to U$
is surjective. 

\medskip\noindent
Sometimes we consider $\text{Aff}$ with other topologies, such as the
etale, Zariski, or fpqc topologies. Notation $\text{Aff}_{etale}$, etc.
FIXME. Put in internal reference to topology discussion.

\section{Sets of affine schemes}
\label{section-sets-of-affines}

\noindent
Choose an ordinal $\alpha$ and denote $\text{Aff}_\alpha$ the
category of affine schemes which are elements of $V_\alpha$, see
Sets, Section \ref{sets-section-sets-hierarchy}. So there is a
theory of algebraic stacks for any $\alpha$. There are some minimal
conditions on $\alpha$ needed to imply that $\text{Aff}_\alpha$ is a site. 
These minimal required properties are expressed in the following lemma.

\begin{lemma}
\label{lemma-Aff-site}
For any set $S$ may choose an ordinal $\alpha$ with $S \in V_\alpha$ 
such that $\text{Aff}_\alpha$ has (finite) fibre products, and finite disjoint
unions. In addition we may assume that for any finitely presented morphism
of affines $X \to Y$, such that $Y \in \text{Aff}_\alpha$, there exists
an affine $X' \in \text{Ob}(\text{Aff}_\alpha)$ such that $X' \cong X$.
\end{lemma}

\begin{proof}
Consider the following statement: ``For any finite directed graph $\Gamma$,
for any assignment $v \mapsto F(v)$, $\forall v\in \text{Vertices}(\Gamma)$,
where $F(v)$ is an affine scheme, and any assignment
$\big(e : v_1 \to v_2\big) \mapsto \big(F(e) : F(v_1) \to F(v_2)\big)$,
$\forall e \in \text{Edges}(\Gamma)$ where $F(e)$ is a morphism of affine
schemes, there exists an affine scheme $X$ and morphisms $f(v) : X \to F(v)$,
$\forall v\in \text{Vertices}(\Gamma)$ such that $f(v_2) = F(e) \circ f(v_1)$,
$\forall \big(e : v_1 \to v_2\big) \in \text{Edges}(\Gamma)$, such that
$(X, \{f(v)\}_{v\in \text{Vertices}(\Gamma)})$ is universal among all such.''
This statement says that finite limits exist for affine schemes. It is
proved in a standard way (for example by turning it into ring theory).

\medskip\noindent
On the other hand, upon formalizing the statement we obtain a provable
formula $\phi(\Gamma, F)$ of ZFC set theory. Hence, according to the reflection
principle, see Sets, Lemma \ref{sets-section-reflection-principle}
there exists an ordinal $\alpha$ such that the formula is true in
$V_\alpha$: If you take $\Gamma \in V_\alpha$ and the $F(v)$ to be in
$\text{Aff}_\alpha$, then you can find a solution
$(X, \{f(v)\}_{v\in \text{Vertices}(\Gamma)})$
with $X$ in $V_\alpha$. This takes care of the statement about fibre 
products. (Of course as soon as $\alpha$ is infinite then every
graph is isomorphic to a graph in $V_\alpha$; we can also simply apriori
require this for $V_\alpha$.).

\medskip\noindent
We can similarly write out the condition of the existence of disjoint unions
as a set theory formula, and similarly the existence of the affine $X'$
given $X \to Y$. The reflection principle states we can have $S$ inside of
$V_\alpha$ as well.
\end{proof}

\noindent
Clearly, we may assume that $\text{Aff}_\alpha$ is closed under any reasonable
operation (see Sets, Section \ref{sets-section-reflection-principle}).
Of course, whenever we require such a condition we will need to write out
the proof that this is so.

\medskip\noindent
So, in the following we will work with stacks (or categories) over
$\text{Aff}_\alpha$\footnote{As per our general philosophy, if we ever need
an actual 2-category of stacks, we also choose another cardinal $\gamma$ and
consider only those categories over $\text{Aff}_\alpha$ contained in
$V_\gamma$.}. If $\alpha < \beta$, then there is an inclusion
$\text{Aff}_\alpha \subset \text{Aff}_\beta$, and hence any category
over $\text{Aff}_\beta$ gives rise to a category over $\text{Aff}_\alpha$.
But this is not the correct thing to do when studying algebraic stacks.
Instead we want to show that algebraic stacks over $\text{Aff}_\alpha$
give rise to algebraic stacks over $\text{Aff}_\beta$. In other words we will
need a theorem saying that the 2-category of algebraic
stacks over $\text{Aff}_\alpha$ is equivalent to a full sub-2-category of
algebraic stacks over $\text{Aff}_\beta$. Here it is.

\medskip\noindent
FIXME. Improve the theorem below and move it to a more appropriate spot.

\begin{theorem}
\label{theorem-change-alpha}
Suppose that $p : \mathcal{S} \to \text{Aff}_\alpha$ is an algebraic stack.
Let $\beta > \alpha$. Then there exists an algebraic stack
$p' : \mathcal{S}' \to \text{Aff}_\beta$ and an equivalence
$$
\xymatrix{
(p')^{-1}(\text{Aff}_\alpha) \ar[rd]_{p'} \ar[rr]^c && \mathcal{S}\ar[ld]^p\\
&\text{Aff}_\alpha.&}
$$
The pair $((\mathcal{S'},p'),c)$ is well determined up to a 1-isomorphism
(which is itself unique up to unique 2-isomorphism).
\end{theorem}

\begin{proof}
FIXME. Hint. Choose a representation (in $\text{Stacks}/\text{Aff}_\alpha$)
$\mathcal{S} = [ \mathcal{X}/\mathcal{R} ]$, with $\mathcal{X}$ representable
by a scheme $X$ and $\mathcal{R}$ representable by an algebraic space.
Choose a presentation $\mathcal{R} = [ \mathcal{U}/\mathcal{R}_\mathcal{U} ]$
where $\mathcal{U}$ and $\mathcal{R}_\mathcal{U}$ are representable
by schemes $U$ and $R_U$. Now define (in $\text{Stacks}/\text{Aff}_\beta$)
$\mathcal{U}'$ to be the stack associated to $U$, $\mathcal{R}'_\mathcal{U}$
to be the stack associated to $R_U$, $\mathcal{R}'$ the stack
$\mathcal{R}' = [ \mathcal{U}'/\mathcal{R}'_\mathcal{U} ]$, $\mathcal{X}'$
the stack associated to $X$, and finally
$\mathcal{S}' = [ \mathcal{X}'/\mathcal{R}' ]$.
\end{proof}

\noindent
From now on $\text{Aff}$ will denote a category of affines $\text{Aff}_\alpha$
such as in Lemma \ref{lemma-Aff-site}. By the theorem above we may increase
$\alpha$ whenever this is needed.

\begin{remark}
\label{remark-other-approach}
There is another approach. Allow yourself to enlarge $\alpha$ at any moment.
Think of every statement in the text as being preceded by ``There exist
arbitrarily large $\alpha$ such that''. 
\end{remark}

\section{Schemes}
\label{section-schemes}

\noindent
We recall the definition of a scheme.

\medskip\noindent
A scheme $(X,\mathcal{O}_X)$ is a locally ringed space
with the property that every point has a neighbourhood which is an
affine scheme.

\medskip\noindent
A scheme $X$ gives rise to a functor (or presheaf)
$$
\xymatrix{
\text{Aff}^{\text{opp}} \ar[r]^{h_X} & \text{Sets}, &
U \ar@{|->}[r] & \text{Mor}(U, X).}
$$
The usual Yoneda lemma tells us that we can recover the scheme from this
functor. 

\begin{lemma}
\label{lemma-yoneda-schemes}
Suppose that $X$, $Y$ are schemes with that have open coverings
by affines isomorphic to objects of $\text{Aff}$. Then $\text{Mor}(X,Y)
= \text{Mor}(h_X, h_Y)$.
\end{lemma}

\begin{proof}
FIXME.
\end{proof}

\section{Stacks representable by a scheme}
\label{section-stack-representable-by-scheme}

\noindent
In Categories, Definition
\ref{categories-definition-representable-fibred-category} we
defined the notion of a representable category fibred in groupoids. This,
applied to a stack (or a category) over $\text{Aff}$ will define the notion of
a stack representable by an affine scheme. 

\medskip\noindent
Here is the formal definition of a category over $\text{Aff}$ representable by
a scheme. Please also see the informal discussion below.

\begin{definition}
\label{definition-representable-by-scheme}
A category fibred in groupoids $p : \mathcal{S} \to \text{Aff}$ is
called representable by a scheme, if the following conditions are satisfied:
\begin{enumerate}
\item all fibre categories $\mathcal{S}_U$ are setlike, and
\item the presheaf $U \mapsto \text{Ob}(\mathcal{S}_U)/\cong$ is 
is isomorphic to $h_S$ for a scheme $S$ as in
Lemma \ref{lemma-yoneda-schemes}.
\end{enumerate}
\end{definition}

\begin{lemma}
\label{lemma-representable-by-scheme-implies-stack}
If $\mathcal{S} \to \text{Aff}$ is representable by a scheme then $\mathcal{S}$
is a stack over $\text{Aff}$.
\end{lemma}

\begin{proof}
FIXME.
\end{proof}

\begin{example}
\label{example-standard-representable-scheme}
Let $X$ be a scheme that has a covering by open affines which are isomorphic
to objects of $\text{Aff}$. There is a standard stack over $\text{Aff}$
representable by $X$, namely the stack of affines over $X$. Compare
Categories, Example \ref {categories-example-comma-category}.
This stack will be denoted $\text{Aff}/X$, and it is described as follows.
\begin{enumerate}
\item An object of $\text{Aff}/X$ is a morphism of schemes
$U \to X$, with $U \in \text{Ob}(\text{Aff})$.
\item A morphism between $U\to X$ and $V \to X$ is a commutative diagram
$$
\xymatrix{
U \ar[rr] \ar[rd] && V \ar[ld] \\
&X.&}
$$
\item The functor $(\text{Aff}/X) \to \text{Aff}$ maps $U\to X$ to $U$.
\end{enumerate}
It is clear from the definition that $\text{Aff}/X$ is representable by
a scheme. 

\medskip\noindent
The construction is clearly functorial in $X$, so that a morphism
of schemes $f : X \to Y$ induces a morphisms of stacks 
$\text{Aff}/X \to \text{Aff}/Y$. FIXME: more?
\end{example}

\begin{situation}
\label{situation-stack-represented-by-scheme}
The following situation will appear repeatedly in the text. Suppose that
$\mathcal{S} \to \text{Aff}$ is a stack representable by a scheme. If we
say the scheme $S$ represents $\mathcal{S}$, then we mean that besides 
being given the scheme $S$, we are given an equivalence $j : \mathcal{S}
\to \text{Aff}/S$ of stacks over $\text{Aff}$.
\end{situation}

\begin{lemma}
\label{lemma-morphism-stacks-representable-by-schemes}
Suppose that the stacks $\mathcal{X}$, $\mathcal{Y}$ are represented
by the schemes $X$ and $Y$. For any morphism of stacks $F : \mathcal{X}
\to \mathcal{Y}$ there is a unique morphism of schemes $f : X \to Y$
such that the diagram
$$
\xymatrix{
\mathcal{X} \ar[r]^F \ar[d]_j & \mathcal{Y} \ar[d]^j \\
\text{Aff}/X \ar[r]^f & \text{Aff}/Y}
$$
2-commutes and then the diagram actually commutes.
\end{lemma}

\begin{proof}
FIXME.
\end{proof}

\section{Morphisms representable by schemes}
\label{section-morphisms-representable-by-schemes}

\noindent
In this section we define the notion of moprhisms of stacks over $\text{Aff}$
representable by schemes.

\section{Definition}
\label{section-definition-representable-by-schemes}

\noindent
Here is the formal definition. Please also see the informal discussion below.

\begin{definition}
\label{definition-representable-by-schemes}
Let $f : \mathcal{X} \to \mathcal{Y}$ be a morphism of categories
fibred in groupoids over $\text{Aff}$. We say $f$ is representable by
schemes if for every stack $\mathcal{S}$ representable by a scheme
(see Definition \ref{definition-representable-by-scheme}), and every morphism
$\mathcal{U} \to \mathcal{Y}$, the 2-fibre product
$\mathcal{S}\times_\mathcal{Y}\mathcal{X}$ is representable by a scheme.
\end{definition}

\noindent
Informal discussion. In the situation of the definition we sometimes 
say that $\mathcal{X}$ is relatively representable over $\mathcal{Y}$.
Suppose that, with the notation of the definition, $S$ represents
$\mathcal{S}$ and $W$ represents $\mathcal{S}\times_\mathcal{Y}\mathcal{X}$.
According to Lemma \ref{lemma-morphism-stacks-representable-by-schemes}
we get a morphism of schemes $g : W \to S$ and a 2-commutative diagram
of stacks
$$
\xymatrix{
\text{Aff}/W \ar[d]^g &
\mathcal{S}\times_\mathcal{X}\mathcal{Y} \ar[d] \ar[l]^j \ar[r] &
\mathcal{Y} \ar[d] \\
\text{Aff}/S &
\mathcal{S} \ar[l]^j \ar[r] & \mathcal{X}
}
$$
FIXME: more.

\medskip\noindent
FIXME. It seems to me that you can define the notion even if 
$\mathcal{X}$ and $\mathcal{Y}$ are just categories over $\text{Aff}$. Does
it make sense in this generality?

\begin{definition}
\label{definition-property-morphism-representable-by-schemes}
Let $P$ be a property of morphisms of schemes such that
if the morphism $f : X \to Y$ has property $P$, then so does
every base change of $f$. (FIXME: introduce base change.)
We say that a morphism of stacks $\mathcal{X}
\to \mathcal{Y}$ representable by schemes has property
$P$ if for every diagram as above the morphism of schemes
$g : W \to S$ has property $P$.
\end{definition}

\noindent
FIXME. Explain rationale behind this definition: what else could it be?

\input{chapters}

\bibliography{my}
\bibliographystyle{alpha}

\end{document}
