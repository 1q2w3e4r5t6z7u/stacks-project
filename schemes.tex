\input{preamble}

% OK, start here.
%
\begin{document}

\title{Schemes}

%\begin{abstract}
%\end{abstract}

\maketitle

\tableofcontents

\section{Introduction}
\label{section-introduction}

\noindent
In this document we define schemes.
A basic reference is \cite{EGA}.









\section{Locally ringed spaces}
\label{section-locally-ringed-spaces}

\noindent
Recall that we defined ringed spaces
in Sheaves, Section \ref{sheaves-section-ringed-spaces}.
Briefly, a ringed space is a pair $(X, \mathcal{O}_X)$ consisting
of a topological space $X$ and a sheaf of rings $\mathcal{O}_X$.
A morphism of ringed spaces $f : (X, \mathcal{O}_X) \to (Y, \mathcal{O}_Y)$
is given by a continuous map $f : X \to Y$ and an $f$-map of sheaves
of rings $f^\sharp : \mathcal{O}_Y \to \mathcal{O}_X$. You can
think of $f^\sharp$ as a map $\mathcal{O}_Y \to f_*\mathcal{O}_X$, see
Sheaves, Definition \ref{sheaves-definition-f-map} and Lemma
\ref{sheaves-lemma-f-map}.

\medskip\noindent
A good geometric example of this to keep in mind is
$\mathcal{C}^\infty$-manifolds and morphisms of
$\mathcal{C}^\infty$-manifolds. Namely, if $M$ is a
$\mathcal{C}^\infty$-manifold, then the sheaf $\mathcal{C}^\infty_M$
of smooth functions is a sheaf of rings on $M$. And any
map $f : M \to N$ of manifolds is smooth if and only if
for every local section $h$ of $\mathcal{C}^\infty_N$
the composition $h \circ f$ is a local section of $\mathcal{C}^\infty_M$.
Thus a smooth map $f$ gives rise in a natural way to a morphism
of ringed spaces
$$
f : (M , \mathcal{C}^\infty_M) \longrightarrow (N, \mathcal{C}^\infty_N)
$$
see Sheaves, Example \ref{sheaves-example-continuous-map-ringed}.
It is instructive to consider what happens to stalks. Namely, let
$m \in M$ with image $f(m) = n \in N$. Recall that the stalk
$\mathcal{C}^\infty_{M,m}$ is the ring of germs of smooth
functions at $m$, see
Sheaves, Example \ref{sheaves-example-germs-functions}.
The algebra of germs of functions on $(M,m)$ is a local ring with maximal
ideal the functions which vanish at $m$.
Similarly for $\mathcal{C}^\infty_{N,n}$. The map on stalks
$f^\sharp : \mathcal{C}^\infty_{N,n} \to \mathcal{C}^\infty_{M,m}$
maps the maximal ideal into the maximal ideal, simply
because $f(m) = n$.

\medskip\noindent
In algebraic geometry we study schemes. On a scheme the sheaf of rings
is not determined by an intrinsic property of the space.
The spectrum of a ring $R$
(see Algebra, Section \ref{algebra-section-spectrum-ring}) endowed
with a sheaf of rings constructed out of $R$ (see below),
will be our basic building block. It will turn out that
the stalks of $\mathcal{O}$ on $\text{Spec}(R)$ are the local
rings of $R$ at its primes. There are two reasons to introduce
locally ringed spaces in this setting: (1) There is in general
no mechanism that assigns to a continuous map of spectra a
map of the corresponding rings. This is why we add as an extra datum
the map $f^\sharp$. (2) If we consider morphisms
of these spectra in the category of ringed spaces, then the
maps on stalks may not be local homomorphisms. Since our
geometric intuition says it should we introduce locally ringed spaces
as follows.

\begin{definition}
\label{definition-locally-ringed-space}
\begin{enumerate}
\item A {\it locally ringed space $(X,\mathcal{O}_X)$}
is a pair consisting of a
topological space $X$ and a sheaf of rings $\mathcal{O}_X$ all of whose stalks
are local rings.
\item A {\it morphism of locally ringed spaces}
$(f, f^\sharp) : (X, \mathcal{O}_X) \to (Y,\mathcal{O}_Y)$
is a morphism of ringed spaces such that for all $x \in X$
the induced ring map $\mathcal{O}_{Y,f(x)} \to \mathcal{O}_{X,x}$ is a
local ring map.
\end{enumerate}
\end{definition}

\noindent
We will usually suppress the sheaf of rings $\mathcal{O}_X$
in the notation when discussing locally ringed spaces. We will
simply refer to ``the locally ringed space $X$''.
We will by abuse of notation think of $X$ also as
the underlying topological space. Finally we will denote
the corresponding sheaf of rings
$\mathcal{O}_X$ as the {\it structure sheaf of $X$}.
In addition, it is customary to denote the maximal ideal
of the local ring $\mathcal{O}_{X, x}$ by
$\mathfrak{m}_{X,x}$ or simply $\mathfrak{m}_x$.
We will say ``let $f : X \to Y$ be a morphism of locally ringed
spaces'' thereby surpressing the structure sheaves even further.
In this case, we will by abuse of notation think of $f : X\to Y$
also as the underlying continuous map of topological spaces.
The $f$-map corresponding to $f$ will customarily
be denoted $f^\sharp$. The condition that $f$ is a morphism
of locally ringed spaces can then be expressed by saying that
for every $x\in X$ the map on stalks
$$
f^\sharp_x : \mathcal{O}_{Y,f(x)} \longrightarrow \mathcal{O}_{X, x}
$$
maps the maximal ideal $\mathfrak m_{Y, f(x)}$ into
$\mathfrak m_{X, x}$.

\medskip\noindent
Let us use these notational conventions to show that the
collection of locally ringed spaces and morphisms of locally
ringed spaces forms a category. In order to see this we have
to show that the composition of morphisms of locally ringed
spaces is a morphism of locally ringed spaces. OK, so let
$f : X \to Y$ and $g : Y \to Z$ be morphism of locally
ringed spaces. The composition of $f$ and $g$ is defined in
Sheaves, Definition \ref{sheaves-definition-composition-maps-ringed-spaces}.
Let $x \in X$. By
Sheaves, Lemma \ref{sheaves-lemma-compose-f-maps-stalks}
the composition
$$
\mathcal{O}_{Z, g(f(x))}
\xrightarrow{g^\sharp}
\mathcal{O}_{Y, f(x)}
\xrightarrow{f^\sharp}
\mathcal{O}_{X, x}
$$
is the associated map on stalks for the morphism $g \circ f$.
The result follows since a composition of local ring
homomorphisms is a local ring homomorphism.

\medskip\noindent
A pleasing feature of the definition is the fact that the functor
$$
\textit{Locally ringed spaces}
\longrightarrow
\textit{Ringed spaces}
$$
reflects isomorphisms. Here is a less abstract statement.

\begin{lemma}
\label{lemma-isomorphism-locally-ringed}
Let $X$, $Y$ be locally ringed spaces.
If $f : X \to Y$ is an isomorphism of
ringed spaces, then $f$ is an isomorphism
of locally ringed spaces.
\end{lemma}

\begin{proof}
This follows trivially from the corresponding fact in algebra:
Suppose $A$, $B$ are local rings. Any isomorphism of rings
$A \to B$ is a local ring homomorphism.
\end{proof}













\section{Open immersions of locally ringed spaces}
\label{section-open-immersion}

\begin{definition}
\label{definition-immersion-locally-ringed-spaces}
Let $f : X \to Y$ be a morphism of locally ringed spaces.
We say that $f$ is an {\it open immersion} if
$f$ is a homeomorphism of $X$ onto an open subset
of $Y$, and the map $f^{-1}\mathcal{O}_Y \to \mathcal{O}_X$
is an isomorphism.
\end{definition}

\noindent
The following construction is parallel to 
Sheaves, Definition \ref{sheaves-definition-restriction} (3).

\begin{example}
\label{example-open-subspace}
Let $X$ be a locally ringed space.
Let $U \subset X$ be an open subset.
Let $\mathcal{O}_U = \mathcal{O}_X|_U$
be the restriction of $\mathcal{O}_X$ to $U$.
For $u \in U$ the stalk $\mathcal{O}_{U, u}$
is equal to the stalk $\mathcal{O}_{X, u}$, and hence is a
local ring. Thus $(U, \mathcal{O}_U)$ is a locally ringed
space and the morphism $j : (U, \mathcal{O}_U) \to (X, \mathcal{O}_X)$
is an open immersion.
\end{example}

\begin{definition}
\label{definition-open-subspace}
Let $X$ be a locally ringed space.
Let $U \subset X$ be an open subset.
The locally ringed space $(U, \mathcal{O}_U)$
of Example \ref{example-open-subspace} above
is {\it the open subspace of $X$ associated to $U$}.
\end{definition}

\begin{lemma}
\label{lemma-open-immersion}
Let $f : X \to Y$ be an open immersion of 
locally ringed spaces. Let $j : V = f(X) \to Y$
be the open subspace of $Y$ associated to the image of $f$.
There is a unique isomorphism $f' : X \cong V$ of
locally ringed spaces such that $f = j \circ f'$.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\noindent
From now on we do not distinguish between open subsets
and their associated subspaces.

\begin{lemma}
\label{lemma-restrict-map-to-opens}
Let $f : X \to Y$ be a morphism of locally ringed spaces.
Let $U \subset X$, and $V \subset Y$ be open subsets.
Suppose that $f(U) \subset V$. There exists a unique
morphism of locally ringed spaces $f|_U : U \to V$ such
that the following diagram is a commutative square of
locally ringed spaces
$$
\xymatrix{
U \ar[d]_{f|_U} \ar[r] & X \ar[d]^f \\
V \ar[r] & Y 
}
$$
\end{lemma}

\begin{proof}
Omitted.
\end{proof}












\section{Closed immersions of locally ringed spaces}
\label{section-closed-immersion}

\noindent
We follow our conventions introduced in
Modules, Definition \ref{modules-definition-closed-immersion}.

\begin{definition}
\label{definition-closed-immersion-locally-ringed-spaces}
Let $i : Z \to X$ be a morphism of locally ringed spaces.
We say that $i$ is an {\it closed immersion} if:
\begin{enumerate}
\item The map $i$ is a homeomorphism of $Z$ onto a closed subset of $X$.
\item The map $\mathcal{O}_X \to i_*\mathcal{O}_Z$ is surjective;
let $\mathcal{I}$ denote the kernel.
\item The $\mathcal{O}_X$-module $\mathcal{I}$
is locally generated by sections.
\end{enumerate}
\end{definition}

\begin{example}
\label{example-closed-subspace}
Let $X$ be a locally ringed space.
Let $\mathcal{I} \subset \mathcal{O}_X$ be a sheaf
of ideals which is locally generated as a sheaf
of $\mathcal{O}_X$-modules. Let $Z$ be the support of
the sheaf of rings $\mathcal{O}_X/\mathcal{I}$.
This is a closed subset of $X$, by 
Modules, Lemma \ref{modules-lemma-support-sheaf-rings-closed}.
Denote $i : Z \to X$ the inclusion map.
By Modules, Lemma \ref{modules-lemma-i-star-exact}
there is a unique sheaf of rings $\mathcal{O}_Z$ on $Z$
with $i_*\mathcal{O}_Z = \mathcal{O}_X/\mathcal{I}$.
For any $z \in Z$ the local ring $\mathcal{O}_{Z, z}$
is equal to the quotient ring $\mathcal{O}_{X, x}/\mathcal{I}_x$
and nonzero, hence a local ring.
Thus $i : (Z, \mathcal{O}_Z) \to (X, \mathcal{O}_X)$ is
a closed immersion of locally ringed spaces.
\end{example}

\begin{definition}
\label{definition-closed-subspace}
Let $X$ be a locally ringed space.
The locally ringed space $(Z, \mathcal{O}_Z)$
of Example \ref{example-closed-subspace} above
is {\it the closed subspace of $X$ associated to $\mathcal{I}$}.
\end{definition}

\begin{lemma}
\label{lemma-closed-immersion}
Let $f : X \to Y$ be a closed immersion of 
locally ringed spaces. Let $\mathcal{I}$ be the
kernel of the map $\mathcal{O}_Y \to f_*\mathcal{O}_X$.
Let $i : Z \to Y$ be the closed subspace of $Y$
associated to $\mathcal{I}$.
There is a unique isomorphism $f' : X \cong Z$ of
locally ringed spaces such that $f = i \circ f'$.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-restrict-map-to-closed}
Let $f : X \to Y$ be a morphism of locally ringed spaces.
Let $\mathcal{I} \subset \mathcal{O}_Y$ be a sheaf of
ideals which is locally generated by functions.
Let $i : Z \to Y$ be the closed subspace associated to the
sheaf of ideals $\mathcal{I}$.
Let $\mathcal{J}$ be the image of the map
$f^*\mathcal{I} \to f^*\mathcal{O}_Y = \mathcal{O}_X$.
Then this ideal is locally generated by sections.
Moreover, let $i' : Z' \to Y$ be the associated closed
subspace of $Y$. There exists a unique
morphism of locally ringed spaces $f' : Z \to Z'$ such
that the following diagram is a commutative square of
locally ringed spaces
$$
\xymatrix{
Z' \ar[d]_{f'} \ar[r]_i & X \ar[d]^f \\
Z \ar[r]^{i'} & Y 
}
$$
Moreover this diagram is a fibre square in the category of
locally ringed spaces.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}














\section{Affine schemes}
\label{section-affine-schemes}

\noindent
Let $R$ be a ring. Consider the topological space $\text{Spec}(R)$
associated to $R$, see Algebra, Section \ref{algebra-section-spectrum-ring}.
We will endow this space with a sheaf of rings $\mathcal{O}_{\text{Spec}(R)}$
and the resulting pair $(\text{Spec}(R), \mathcal{O}_{\text{Spec}(R)})$
will be an affine scheme.

\medskip\noindent
Recall that $\text{Spec}(R)$ has a basis of open sets $D(f)$,
$f \in R$ which we call standard opens, see Algebra,
Definition \ref{algebra-definition-Zariski-topology}.
In addition, the intersection of two standard opens is another:
$D(f) \cap D(g) = D(fg)$, $f,g\in R$.

\begin{lemma}
\label{lemma-standard-open}
Let $R$ be a ring. Let $f \in R$.
\begin{enumerate}
\item If $g\in R$ and $D(g) \subset D(f)$, then
\begin{enumerate}
\item $f$ is invertible in $R_g$,
\item $g^e = af$ for some $e \geq 1$ and $a \in R$,
\item there is a canonical ring map $R_f \to R_g$, and
\item there is a canonical $R_f$-module map
$M_f \to M_g$ for any $R$-module $M$.
\end{enumerate}
\item Any open covering of $D(f)$ can be refined to a finite
open covering of the form $D(f) = \bigcup_{i=1}^n D(g_i)$.
\item If $g_1,\ldots,g_n \in R$, then $D(f) \subset \bigcup D(g_i)$
if and only if $g_1,\ldots,g_n$ generate the unit ideal in $R_f$.
\end{enumerate}
\end{lemma}

\begin{proof}
Recall that $D(g) = \text{Spec}(R_g)$ (see
Algebra, Lemma \ref{algebra-lemma-standard-open}).
Thus (a) holds because $f$
maps to an element of $R_g$ which is not
contained in any prime ideal, and hence invertible,
see Algebra, Lemma \ref{algebra-lemma-Zariski-topology}.
Write the inverse of $f$ in $R_g$ as $a/g^d$.
This means $g^d - af$ is annihilated by a power of $g$, whence (b).
For (c), the map $R_f \to R_g$ exists by (a) from the universal property
of localization, or we can define it by mapping $b/f^n$
to $a^nb/g^{ne}$. The equality $M_f = M \otimes_R R_f$
can be used to obtain the map on modules, or
we can define $M_f \to M_g$ by mapping
$x/f^n$ to $a^nx/g^{ne}$.

\medskip\noindent
Recall that $D(f)$ is quasi-compact, see 
Algebra, Lemma \ref{algebra-lemma-qc-open}.
Hence the second statement follows directly
from the fact that the standard opens form
a basis for the topology.

\medskip\noindent
The third statement follows directly from
Algebra, Lemma \ref{algebra-lemma-Zariski-topology}.
\end{proof}

\noindent
In Sheaves, Section \ref{sheaves-section-bases} we defined
the notion of a sheaf on a basis, and we showed that it is
essentially equivalent to the notion of a sheaf on the space,
see Sheaves, Lemmas \ref{sheaves-lemma-extend-off-basis} and
\ref{sheaves-lemma-extend-off-basis-structures}. Moreover,
we showed in
Sheaves, Lemma \ref{sheaves-lemma-cofinal-systems-coverings-standard-case}
that it is sufficient to check the sheaf
condition on a cofinal system of open coverings for each
standard open. By the lemma above it suffices to check
on the finite coverings by standard opens.

\begin{definition}
\label{definition-standard-covering}
Let $R$ be a ring.
\begin{enumerate}
\item A {\it standard open covering} of $\text{Spec}(R)$
is a covering $\text{Spec}(R) = \bigcup_{i=1}^n D(f_i)$,
where $f_1,\ldots, f_n \in R$.
\item Suppose that $D(f) \subset \text{Spec}(R)$ is a standard
open. A {\it standard open covering} of $D(f)$
is a covering $D(f) = \bigcup_{i=1}^n D(g_i)$,
where $g_1,\ldots, g_n \in R$.
\end{enumerate}
\end{definition}

\noindent
Let $R$ be a ring. Let $M$ be an $R$-module. We will define
a presheaf $\widetilde M$ on the basis of standard opens.
Suppose that $U \subset \text{Spec}(R)$ is a standard open.
If $f, g \in R$ are such that $D(f) = D(g)$, then
by Lemma \ref{lemma-standard-open} above there are canonical
maps $M_f \to M_g$ and $M_g \to M_f$ which are mutually inverse.
Hence we may choose any $f$ such that $U = D(f)$
and define
$$
\widetilde M(U) = M_f.
$$
Note that if $D(g) \subset D(f)$, then by
Lemma \ref{lemma-standard-open} above we have
a canonical map
$$
\widetilde M(D(f)) = M_f \longrightarrow M_g = \widetilde M(D(g)).
$$
Clearly, this defines a presheaf of abelian groups on the basis
of standard opens. If $M = R$, then $\widetilde R$ is a presheaf
of rings on the basis of standard opens.

\medskip\noindent
Let us compute the stalk of $\widetilde M$ at a point $x \in \text{Spec}(R)$.
Suppose that $x$ corresponds to the prime $\mathfrak p \subset R$.
By definition of the stalk we see that
$$
\widetilde M_x = \text{colim}_{f\in R, f\not\in \mathfrak p}\ M_f
$$
Here the set $\{f\in R, f\not\in \mathfrak p\}$ is partially
ordered by the rule $f \geq f' \Leftrightarrow D(f) \subset D(f')$.
If $f_1, f_2 \in R \setminus \mathfrak p$, then we have
$f_1f_2 \geq f_1$ in this ordering. Hence by
Algebra, Lemma \ref{algebra-lemma-localization-colimit}
we conclude that
$$
\widetilde M_x = M_{\mathfrak p}.
$$

\medskip\noindent
Next, we check the sheaf condition for the standard open coverings.
If $D(f) = \bigcup_{i=1}^n D(g_i)$, then the sheaf condition
for this covering is equivalent with the exactness of the
sequence
$$
0 \to M_f \to \bigoplus M_{g_i} \to \bigoplus M_{g_ig_j}.
$$
Note that $D(g_i) = D(fg_i)$, and hence we can rewrite this
sequence as the sequence
$$
0 \to M_f \to \bigoplus M_{fg_i} \to \bigoplus M_{fg_ig_j}.
$$
In addition, by Lemma \ref{lemma-standard-open} above
we see that $g_1,\ldots,g_n$ generate the unit ideal
in $R_f$. Thus we may apply
Algebra, Lemma \ref{algebra-lemma-cover-module}
to the module $M_f$ over $R_f$ and the elements $g_1,\ldots,g_n$.
We conclude that the sequence is exact. By the remarks
made above, we see that $\widetilde M$ is a sheaf
on the basis of standard opens.

\medskip\noindent
Thus we conclude from the material in
Sheaves, Section \ref{sheaves-section-bases}
that there exists a
unique sheaf of rings $\mathcal{O}_{\text{Spec}(R)}$
which agrees with $\widetilde R$ on the standard opens.
Note that by our computation of stalks above, the
stalks of this sheaf of rings are all local rings.

\medskip\noindent
Similarly, for any $R$-module $M$ there exists
a unique sheaf of $\mathcal{O}_{\text{Spec}(R)}$-modules
$\mathcal{F}$ which agrees with $\widetilde M$ on the
standard opens, see
Sheaves, Lemma \ref{sheaves-lemma-extend-off-basis-module}.

\begin{definition}
\label{definition-structure-sheaf}
Let $R$ be a ring.
\begin{enumerate}
\item The {\it structure sheaf $\mathcal{O}_{\text{Spec}(R)}$ of the
spectrum of $R$} is the unique sheaf of rings $\mathcal{O}_{\text{Spec}(R)}$
which agrees with $\widetilde R$ on the basis of standard opens.
\item The locally ringed space
$(\text{Spec}(R), \mathcal{O}_{\text{Spec}(R)})$ is called
the {\it spectrum} of $R$ and denoted $\text{Spec}(R)$.
\item The sheaf of $\mathcal{O}_{\text{Spec}(R)}$-modules
extending $\widetilde M$ to all opens of $\text{Spec}(R)$
is called the sheaf of $\mathcal{O}_{\text{Spec}(R)}$-modules
associated to $M$. This sheaf is denoted $\widetilde M$ as
well.
\end{enumerate}
\end{definition}

\noindent
We summarize the results obtained so far.

\begin{lemma}
\label{lemma-spec-sheaves}
Let $R$ be a ring. Let $M$ be an $R$-module. Let $\widetilde M$
be the sheaf of $\mathcal{O}_{\text{Spec}(R)}$-modules
associated to $M$.
\begin{enumerate}
\item We have $\Gamma(\text{Spec}(R), \mathcal{O}_{\text{Spec}(R)}) = R$.
\item We have $\Gamma(\text{Spec}(R), \widetilde M) = M$ as an $R$-module.
\item For every $f \in R$ we have
$\Gamma(D(f), \mathcal{O}_{\text{Spec}(R)}) = R_f$.
\item For every $f\in R$ we have $\Gamma(D(f), \widetilde M) = M_f$
as an $R_f$-module.
\item Whenever $D(g) \subset D(f)$ the restriction mappings
on $\mathcal{O}_{\text{Spec}(R)}$ and $\widetilde M$
are the maps
$R_f \to R_g$ and $M_f \to M_g$ from Lemma
\ref{lemma-standard-open}.
\item Let $\mathfrak p$ be a prime of $R$, and let $x \in \text{Spec}(R)$
be the corresponding point. We have
$\mathcal{O}_{\text{Spec}(R), x} = R_{\mathfrak p}$.
\item Let $\mathfrak p$ be a prime of $R$, and let $x \in \text{Spec}(R)$
be the corresponding point. We have $\mathcal{F}_x = M_{\mathfrak p}$
as an $R_{\mathfrak p}$-module.
\end{enumerate}
Moreover, all these identifications are functorial in the $R$
module $M$. In particular, the functor $M \mapsto \widetilde M$
is an exact functor from the category of $R$-modules
to the category of $\mathcal{O}_{\text{Spec}(R)}$-modules.
\end{lemma}

\begin{proof}
Assertions (1) - (7) are clear from the discussion above.
The exactness of the functor $M \mapsto \widetilde M$
follows from the fact that the functor $M \mapsto M_{\mathfrak p}$
is exact and the fact that exactness of short exact sequences
may be checked on stalks, see
Modules, Lemma \ref{modules-lemma-abelian}.
\end{proof}

\begin{definition}
\label{definition-affine-scheme}
An {\it affine scheme} is a locally ringed space isomorphic
as a locally ringed space to $\text{Spec}(R)$ for some ring $R$. 
A {\it morphism of affine schemes} is a morphism in the category
of locally ringed spaces.
\end{definition}

\noindent
It turns out that affine schemes play a special role
among all locally ringed spaces, which is what the next
section is about.


















\section{The category of affine schemes}
\label{section-category-affine-schemes}

\noindent
Note that if $Y$ is an affine scheme, then its
points are in canonical $1-1$ bijection with
prime ideals in $\Gamma(Y, \mathcal{O}_Y)$.

\begin{lemma}
\label{lemma-morphism-into-affine-where-point-goes}
Let $X$ be a locally ringed space.
Let $Y$ be an affine scheme.
Let $f \in \text{Mor}(X, Y)$ be a morphism
of locally ringed spaces. Given a point $x \in X$
consider the ring maps
$$
\Gamma(Y, \mathcal{O}_Y) \xrightarrow{f^\sharp}
\Gamma(X, \mathcal{O}_X) \to \mathcal{O}_{X, x}
$$
Let $\mathfrak p \subset \Gamma(Y, \mathcal{O}_Y)$ denote
the inverse image of $\mathfrak m_x$. Let $y \in Y$ be the
corresponding point. Then $f(x) = y$.
\end{lemma}

\begin{proof}
Consider the commutative diagram
$$
\xymatrix{
\Gamma(X, \mathcal{O}_X) \ar[r] &
\mathcal{O}_{X, x} \\
\Gamma(Y, \mathcal{O}_Y) \ar[r] \ar[u] &
\mathcal{O}_{Y, f(x)} \ar[u]
}
$$
(see the discussion of $f$-maps below
Sheaves, Definition \ref{sheaves-definition-f-map}).
Since the right vertical arrow is local
we see that $\mathfrak m_{f(x)}$ is the
inverse image of $\mathfrak m_x$. The result
follows.
\end{proof}

\begin{lemma}
\label{lemma-f-open}
Let $X$ be a locally ringed space.
Let $f \in \Gamma(X, \mathcal{O}_X)$.
The set
$$
D(f) = \{x \in X \mid \text{image }f \not\in \mathfrak m_x\}
$$
is open. Moreover $f|_{D(f)}$ has an inverse.
\end{lemma}

\begin{proof}
Suppose that $U \subset X$ and $V \subset X$ are
two open subsets such that $f|_U$ has an inverse
$g$ and $f|_V$ has an inverse $h$. Then clearly
$g|_{U\cap V} = h|_{U\cap V}$. Thus it suffices
to show that $f$ is invertible in an open neighbourhood
of any $x \in D(f)$. This is clear because
$f \not \in \mathfrak m_x$ implies that $f \in \mathcal{O}_{X,x}$
has an inverse $g \in \mathcal{O}_{X,x}$ which means there
is some open neighbourhood $x \in U \subset X$ so
that $g \in \mathcal{O}_X(U)$ and $g\cdot f|_U = 1$.
\end{proof}

\begin{lemma}
\label{lemma-f-open-affine}
In Lemma \ref{lemma-f-open} above, if $X$ is an affine scheme,
then the open $D(f)$ agrees with the standard open $D(f)$
defined previously (in
Algebra, Definition \ref{algebra-definition-spectrum-ring}).
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-morphism-into-affine}
Let $X$ be a locally ringed space.
Let $Y$ be an affine scheme.
The map
$$
\text{Mor}(X, Y)
\longrightarrow
\text{Hom}(\Gamma(Y, \mathcal{O}_Y), \Gamma(X, \mathcal{O}_X))
$$
which maps $f$ to $f^\sharp$ (on global sections) is bijective.
\end{lemma}

\begin{proof}
Since $Y$ is affine we have
$(Y, \mathcal{O}_Y) \cong (\text{Spec}(R), \mathcal{O}_{\text{Spec}(R)})$
for some ring $R$.
During the proof we will use facts about $Y$ and
its structure sheaf which are direct consequences of things
we know about the spectrum of a ring, see e.g.\ Lemma
\ref{lemma-spec-sheaves}.

\medskip\noindent
Motivated by the lemmas above we construct the inverse map.
Let $\psi_Y : \Gamma(Y, \mathcal{O}_Y) \to \Gamma(X, \mathcal{O}_X)$
be a ring map. First, we define the corresponding map of
spaces
$$
\Psi : X \longrightarrow Y
$$
by the rule of
Lemma \ref{lemma-morphism-into-affine-where-point-goes}.
In other words, given $x \in X$ we define $\Psi(x)$
to be the point of $Y$ corresponding to the prime
in $\Gamma(Y, \mathcal{O}_Y)$ which is the inverse
image of $\mathfrak m_x$ under the composition
$
\Gamma(Y, \mathcal{O}_Y) \xrightarrow{\psi_Y}
\Gamma(X, \mathcal{O}_X) \to
\mathcal{O}_{X, x}
$.

\medskip\noindent
We claim that the map $\Psi : X \to Y$ is continuous.
The standard opens $D(g)$, for $g \in \Gamma(Y, \mathcal{O}_Y)$
are a basis for the toppology of $Y$. Thus it suffices to prove
that $\Psi^{-1}(D(g))$ is open. By construction of $\Psi$
the inverse image $\Psi^{-1}(D(g))$ is exactly the set
$D(\psi_Y(g)) \subset X$ which is open by Lemma \ref{lemma-f-open}.
Hence $\Psi$ is continuous.

\medskip\noindent
Next we construct a $\Psi$-map of sheaves from
$\mathcal{O}_Y$ to $\mathcal{O}_X$. By
Sheaves, Lemma \ref{sheaves-lemma-f-map-basis-below-structures}
it suffices to define ring maps
$\psi_{D(g)} : \Gamma(D(g), \mathcal{O}_Y) \to
\Gamma(\Psi^{-1}(D(g)), \mathcal{O}_X)$
compatible with restriction maps.
We have a canonical isomorphism
$\Gamma(D(g), \mathcal{O}_Y) = \Gamma(Y, \mathcal{O}_Y)_g$,
because $Y$ is an affine scheme.
Because $\psi_Y(g)$ is invertible on $D(\psi_Y(g))$
we see that there is a canonical map
$$
\Gamma(Y, \mathcal{O}_Y)_g
\longrightarrow
\Gamma(\Psi^{-1}(D(g)), \mathcal{O}_X)
=
\Gamma(D(\psi_Y(g)), \mathcal{O}_X) 
$$
extending the map $\psi_Y$
by the universal property of localization.
Note that there is no choice but to take the canonical map here!
And we take this, combined
with the canonical identification
$\Gamma(D(g), \mathcal{O}_Y) = \Gamma(Y, \mathcal{O}_Y)_g$, to
be $\psi_{D(g)}$. This is compatible with localization since the
restriction mapping on the affine schemes are defined in terms
of the universal properties of localization also, see
Lemmas \ref{lemma-spec-sheaves} and \ref{lemma-standard-open}.

\medskip\noindent
Thus we have defined a morphism of ringed spaces
$(\Psi, \psi) : (X, \mathcal{O}_X) \to (Y, \mathcal{O}_Y)$
recovering $\psi_Y$ on global sections. To see that it is
a morphism of locally ringed spaces we have to show that
the induced maps on local rings
$$
\psi_x : \mathcal{O}_{Y,\Psi(x)} \longrightarrow \mathcal{O}_{X, x}
$$
are local. This follows immediately from the commutative diagram
of the proof of Lemma \ref{lemma-morphism-into-affine-where-point-goes}
and the definition of $\Psi$.

\medskip\noindent
Finally, we have to show that the constructions
$(\Psi, \psi) \mapsto \psi_Y$ and the construction
$\psi_Y \mapsto (\Psi, \psi)$ are inverse to each other.
Clearly, $\psi_Y \mapsto (\Psi, \psi) \mapsto \psi_Y$.
Hence the only thing to prove is that given $\psi_Y$
there is at most one pair $(\Psi, \psi)$ giving rise
to it. The uniqueness of $\Psi$ was shown in Lemma
\ref{lemma-morphism-into-affine-where-point-goes} and
given the uniqueness of $\Psi$ the uniqueness of the
map $\psi$ was pointed out during the course of the proof
above.
\end{proof}

\begin{lemma}
\label{lemma-category-affine-schemes}
The category of affine schemes is equivalent to the opposite of the
category of rings. The equivalence is given by the functor that associates
to an affine scheme the global sections of its structure sheaf.
\end{lemma}

\begin{proof}
This is now clear from Definition \ref{definition-affine-scheme}
and Lemma \ref{lemma-morphism-into-affine}.
\end{proof}

\begin{lemma}
\label{lemma-standard-open-affine}
Let $Y$ be an affine scheme.
Let $f \in \Gamma(Y, \mathcal{O}_Y)$.
The open subspace $D(f)$ is an affine scheme.
\end{lemma}

\begin{proof}
We may assume that $Y = \text{Spec}(R)$ and $f \in R$.
Consider the morphism of affine schemes
$f : U = \text{Spec}(R_f) \to \text{Spec}(R) = Y$ induced by the ring
map $R \to R_f$. By Algebra, Lemma \ref{algebra-lemma-standard-open}
we know that it is a homeomorphism onto $D(f)$.
On the other hand, the map $f^{-1}\mathcal{O}_Y \to \mathcal{O}_U$
is an isomorphism on stalks, hence an isomorphism. Thus we see
that $f$ is an open immersion. We conclude that $D(f)$
is isomorphic to $U$ by Lemma \ref{lemma-open-immersion}.
\end{proof}

\begin{lemma}
\label{lemma-fibre-product-affine-schemes}
The category of affine schemes has finite products, and fibre products.
In other words, it has finite limits. Moreover, the products
and fibre products in the category of affine schemes
are the same as in the category of locally ringed spaces.
In a formula, we have (in the category of locally ringed spaces)
$$
\text{Spec}(R) \times \text{Spec}(S) =
\text{Spec}(R \otimes_{\mathbf{Z}} S)
$$
and given ring maps $R \to A$, $R \to B$ we have
$$
\text{Spec}(A) \times_{\text{Spec}(R)} \text{Spec}(B)
=
\text{Spec}(A \otimes_R B).
$$
\end{lemma}

\begin{proof}
This is just an application of Lemma \ref{lemma-morphism-into-affine}.
First of all, by that lemma, the affine scheme
$\text{Spec}(\mathbf{Z})$ is the final object in the category
of locally ringed spaces. Thus the first displayed formula
follows from the second. To prove the second note that
for any locally ringed space $X$ we have
\begin{eqnarray*}
\text{Mor}(X, \text{Spec}(A \otimes_R B))
& = &
\text{Hom}(A \otimes_R B, \mathcal{O}_X(X)) \\
& = &
\text{Hom}(A, \mathcal{O}_X(X))
\times_{\text{Hom}(R, \mathcal{O}_X(X))}
\text{Hom}(B, \mathcal{O}_X(X)) \\
& = &
\text{Mor}(X, \text{Spec}(A))
\times_{\text{Mor}(X, \text{Spec}(R))}
\text{Mor}(X, \text{Spec}(B))
\end{eqnarray*}
which proves the formula.
See Categories, Section \ref{categories-section-fibre-products} for the
relevant definitions.
\end{proof}

















\section{Quasi-Coherent sheaves on affines}
\label{section-quasi-coherent-affine}

\noindent
Recall that we have defined the abstract notion of a quasi-coherent
sheaf in Modules, Definition \ref{modules-definition-quasi-coherent}.
In this section we show that any quasi-coherent sheaf on an affine
scheme $\text{Spec}(R)$ corresponds the the sheaf $\widetilde M$ associated to
an $R$-module $M$.

\begin{lemma}
\label{lemma-compare-constructions}
Let $(X, \mathcal{O}_X) = (\text{Spec}(R), \mathcal{O}_{\text{Spec}(R)})$
be an affine scheme. Let $M$ be an $R$-module. There exists a canonical
isomorphism between the sheaf $\widetilde M$ associated to the $R$-module
$M$ (Definition \ref{definition-structure-sheaf}) and the sheaf
$\mathcal{F}_M$ associated to the $R$-module $M$
(Modules, Definition \ref{modules-definition-sheaf-associated}).
This isomorphism is functorial in $M$. In particular,
the sheaves $\widetilde M$ are quasi-coherent. Moreover, they
are characterized by the following mapping property
$$
\text{Hom}_{\mathcal{O}_X}(\widetilde M, \mathcal{F})
=
\text{Hom}_R(M, \Gamma(X, \mathcal{F}))
$$
for any sheaf of $\mathcal{O}_X$-modules $\mathcal{F}$.
Here a map $\alpha : \widetilde M \to \mathcal{F}$ corresponds
to its effect on global sections.
\end{lemma}

\begin{proof}
By Modules, Lemma \ref{modules-lemma-construct-quasi-coherent-sheaves}
we have a morphism $\mathcal{F}_M \to \widetilde M$ corresponding
to the map $M \to \Gamma(X, \widetilde M) = M$. Let $x \in X$
correspond to the prime $\mathfrak p \subset R$.
The induced map on stalks are the maps
$\mathcal{O}_{X, x} \otimes_R M \to M_{\mathfrak p}$
which are isomorphisms because
$R_{\mathfrak p} \otimes_R M = M_{\mathfrak p}$.
Hence the map $\mathcal{F}_M \to \widetilde M$ is an isomorphism.
The mapping property follows from the mapping property of
the sheaves $\mathcal{F}_M$.
\end{proof}

\begin{lemma}
\label{lemma-widetilde-pullback}
Let
$(X, \mathcal{O}_X) = (\text{Spec}(S), \mathcal{O}_{\text{Spec}(S)})$,
and
$(Y, \mathcal{O}_Y) = (\text{Spec}(R), \mathcal{O}_{\text{Spec}(R)})$
be affine schemes.
Let $\psi : (X, \mathcal{O}_X) \to (Y, \mathcal{O}_Y)$ be a
morphism of affine schemes, corresponding to the ring map
$\psi^\sharp : R \to S$ (see Lemma \ref{lemma-category-affine-schemes}).
\begin{enumerate}
\item We have $\psi^* \widetilde M = \widetilde{S\otimes_R M}$
functorially in the $R$-module $M$.
\item We have $\psi_* \widetilde N = \widetilde{N_R}$ functorially
in the $S$-module $N$.
\end{enumerate}
\end{lemma}

\begin{proof}
The first assertion follows from the identification in
Lemma \ref{lemma-compare-constructions}
and the result of Modules, Lemma \ref{modules-lemma-restrict-quasi-coherent}.
The second assertion follows from the fact
that $\psi^{-1}(D(f)) = D(\psi^\sharp(f))$ and hence
$\psi_* \widetilde N(D(f)) = \widetilde N(D(\psi^\sharp(f))) = 
N_{\psi^\sharp(f)} = (N_R)_f = \widetilde{N_R}(D(f))$.
\end{proof}

\noindent
Lemma \ref{lemma-widetilde-pullback} above says in particular
that if you restrict
the sheaf $\widetilde M$ to a standard affine open subspace
$D(f)$, then you get $\widetilde{M_f}$. We will use this from
now on without further mention.

\begin{lemma}
\label{lemma-quasi-coherent-affine}
Let $(X, \mathcal{O}_X) = (\text{Spec}(R), \mathcal{O}_{\text{Spec}(R)})$
be an affine scheme.
Any quasi-coherent $\mathcal{O}_X$-module
$\mathcal{F}$ is isomorphic to the sheaf associated to
the $R$-module $\Gamma(X, \mathcal{F})$.
\end{lemma}

\begin{proof}
Let $\mathcal{F}$ be a quasi-coherent $\mathcal{O}_X$-module.
Since every standard open $D(f)$ is quasi-compact we see that
$X$ is a locally quasi-compact, i.e., every point has a fundamental
system of quasi-compact neighbourhoods, see Topology,
Definition \ref{topology-definition-locally-quasi-compact}.
Hence by Modules, Lemma \ref{modules-lemma-quasi-coherent-module}
for every prime $\mathfrak p \subset R$ corresponding to $x \in X$
there exists an open neighbourhood $x \in U \subset X$ such that
$\mathcal{F}|_U$ is isomorphic to the quasi-coherent
sheaf associated to some $\mathcal{O}_X(U)$-module $M$.
In other words, we get an open covering by $U$'s with this property.
By Lemma \ref{lemma-standard-open} for example we can refine this
covering to  a standard open covering.
Thus we get a covering $\text{Spec}(R) = \bigcup D(f_i)$
and $R_{f_i}$-modules $M_i$ and isomorphisms
$\varphi_i : \mathcal{F}|_{D(f_i)} \to \mathcal{F}_{M_i}$
for some $R_{f_i}$-module $M_i$. On the overlaps
we get isomorphisms
$$
\xymatrix{
\mathcal{F}_{M_i}|_{D(f_if_j)}
\ar[rr]^{\varphi_i^{-1}|_{D(f_if_j)}}
& &
\mathcal{F}|_{D(f_if_j)}
\ar[rr]^{\varphi_j|_{D(f_if_j)}}
& &
\mathcal{F}_{M_j}|_{D(f_if_j)}.
}
$$
Let us denote these $\psi_{ij}$. It is clear that
we have the cocycle condition
$$
\psi_{jk}|_{D(f_if_jf_k)}
\circ 
\psi_{ij}|_{D(f_if_jf_k)}
=
\psi_{ik}|_{D(f_if_jf_k)}
$$
on triple overlaps.

\medskip\noindent
Recall that each of the open subspaces $D(f_i)$, $D(f_if_j)$,
$D(f_if_jf_k)$ is an affine scheme. Hence the sheaves $\mathcal{F}_{M_i}$
are isomorphic to the sheaves $\widetilde M_i$ by Lemma
\ref{lemma-compare-constructions} above. In particular we see that
$\mathcal{F}_{M_i}(D(f_if_j)) = (M_i)_{f_j}$, etc.
Also by Lemma \ref{lemma-compare-constructions} above we see
that $\psi_{ij}$ corresponds to a unique $R_{f_if_j}$-module isomorphism
$$
\psi_{ij} : (M_i)_{f_j} \longrightarrow (M_j)_{f_i}
$$
namely, the effect of $\psi_{ij}$ on sections over $D(f_if_j)$.
Moreover these then satisfy the cocycle condition that
$$
\xymatrix{
(M_i)_{f_jf_k}
\ar[rd]_{\psi_{ij}}
\ar[rr]^{\psi_{ik}}
& &
(M_k)_{f_if_j} \\
&
(M_j)_{f_if_k} \ar[ru]_{\psi_{jk}}
}
$$
commutes (for any triple $i, j, k$).

\medskip\noindent
Now Algebra, Lemma \ref{algebra-lemma-glue-modules}
shows that there exist an $R$-module $M$ such that
$M_i = M_{f_i}$ compatible with the morphisms $\psi_{ij}$.
Consider $\mathcal{F}_M = \widetilde M$. At this point it is
a formality to show that $\widetilde M$ is isomorphic to
the quasi-coherent sheaf $\mathcal{F}$ we started out with.
However, since it is rather cumbersome to write out completely
the details of this formality we argue instead as follows.
Let us construct an $R$-module map
$$
M \longrightarrow \Gamma(X, \mathcal{F}).
$$
Namely, given $m \in M$ we get $m_i = m/1 \in M_{f_i} = M_i$
by construction of $M$. By construction of $M_i$ this corresponds
to a section $s_i \in \mathcal{F}(U_i)$. (Namely, $\varphi^{-1}_i(m_i)$.)
We claim that $s_i|_{D(f_if_j)} = s_j|_{D(f_if_j)}$. This is
true because, by construction of $M$, we have $\psi_{ij}(m_i) = m_j$,
and by the construction of the $\psi_{ij}$. By the sheaf condition of
$\mathcal{F}$ this collection of sections gives rise to a unique
section $s$ of $\mathcal{F}$ over $X$. We leave it to the reader
to show that $m \mapsto s$ is a $R$-module map.
By Lemma \ref{lemma-compare-constructions} we obtain an associated
$\mathcal{O}_X$-module map
$$
\widetilde M \longrightarrow \mathcal{F}.
$$
By construction this map reduces to the isomorphisms
$\varphi_i^{-1}$ on each $D(f_i)$ and hence is an isomorphism.
\end{proof}

\begin{lemma}
\label{lemma-equivalence-quasi-coherent}
Let $(X, \mathcal{O}_X) = (\text{Spec}(R), \mathcal{O}_{\text{Spec}(R)})$
be an affine scheme.
The functors $M \mapsto \widetilde M$ and 
$\mathcal{F} \mapsto \Gamma(X, \mathcal{F})$ define quasi-inverse
equivalences of categories
$$
\xymatrix{
\text{QCoh}(\mathcal{O}_X)
\ar@<1ex>[r]
&
\text{Mod-}R
\ar@<1ex>[l]
}
$$
between the category of quasi-coherent $\mathcal{O}_X$-modules
and the category of $R$-modules.
\end{lemma}

\begin{proof}
See Lemmas \ref{lemma-compare-constructions}
and \ref{lemma-quasi-coherent-affine} above.
\end{proof}

\noindent
From now on we will not distinghuish between quasi-coherent
sheaves on affine schemes and sheaves of the form $\widetilde M$.

\begin{lemma}
\label{lemma-extension-quasi-coherent}
Let $(X, \mathcal{O}_X) = (\text{Spec}(R), \mathcal{O}_{\text{Spec}(R)})$
be an affine scheme. Suppose that
$$
0 \to
\mathcal{F}_1 \to
\mathcal{F}_2 \to
\mathcal{F}_3 \to
0
$$
is a short exact sequence of sheaves $\mathcal{O}_X$-modules.
If two out of three are quasi-coherent then so is the third.
\end{lemma}

\begin{proof}
This is clear in case both $\mathcal{F}_1$ and $\mathcal{F}_2$ are
quasi-coherent because the functor $M \mapsto \widetilde M$
is exact, see Lemma \ref{lemma-spec-sheaves}.
Similarly in case both $\mathcal{F}_2$ and $\mathcal{F}_3$ are
quasi-coherent. Now, suppose that $\mathcal{F}_1 = \widetilde M_1$ and 
$\mathcal{F}_3 = \widetilde M_3$ are quasi-coherent.
Set $M_2 = \Gamma(X, \mathcal{F}_2)$. We claim it suffices to show that
the sequence
$$
0 \to M_1 \to M_2 \to M_3 \to 0
$$
is exact. Namely, if this is the case, then (by using the mapping
property of Lemma \ref{lemma-compare-constructions}) we get a commutative
diagram
$$
\xymatrix{
0 \ar[r] &
\widetilde M_1 \ar[r] \ar[d] &
\widetilde M_2 \ar[r] \ar[d] &
\widetilde M_3 \ar[r] \ar[d] &
0 \\
0 \ar[r] &
\mathcal{F}_1 \ar[r] &
\mathcal{F}_2 \ar[r] &
\mathcal{F}_3 \ar[r] &
0
}
$$
and we win by the snake lemma.

\medskip\noindent
The ``correct'' argument here would be to show first
that $H^1(X, \mathcal{F}) = 0$ for any quasi-coherent sheaf $\mathcal{F}$.
This is actually not all that hard, but it is perhaps better to postpone
this till later. Instead we use a small trick.

\medskip\noindent
Pick $m \in M_3 = \Gamma(X, \mathcal{F}_3)$.
Consider the following set
$$
I = \{ f \in R \mid \text{the element }fm\text{ comes from }M_2\}.
$$
Clearly this is an ideal. It suffices to show $1 \in I$.
Hence it suffices to show that for any prime $\mathfrak p$
there exists an $f \in I$, $f \not\in \mathfrak p$.
Let $x \in X$ be the point corresponding to $\mathfrak p$.
Because surjectivity can be checked on stalks
there exists an open neighbourhood $U$ of $x$ such that
$m|_U$ comes from a local section $s \in \mathcal{F}_2(U)$.
In fact we may assume that $U = D(f)$ is a standard open,
i.e., $f \in R$, $f \not \in \mathfrak p$. We will show
that for some $N \gg 0$ we have $f^N \in I$, which
will finish the proof.

\medskip\noindent
Take any point $z \in V(f)$, say corresponding to the
prime $\mathfrak q \subset R$. We can also find a $g \in R$,
$g \not \in \mathfrak q$ such that $m|_{D(g)}$ lifts
to some $s' \in \mathcal{F}_2(D(g))$.
Consider the difference $s|_{D(fg)} - s'|_{D(fg)}$.
This is an element $m'$ of $\mathcal{F}_1(D(fg)) = (M_1)_{fg}$.
For some integer $n = n(z)$ the element $f^n m'$ comes
from some $m'_1 \in (M_1)_g$. We see that
$f^n s$ extends to a section $\sigma$ of $\mathcal{F}_2$ on $D(f) \cup D(g)$
because it agrees with the restriction of
$f^n s' + m'_1$ on $D(f) \cap D(g) = D(fg)$.
Moreover, $\sigma$ maps to the restriction of $f^n m$
to $D(f) \cup D(g)$.

\medskip\noindent
Since $V(f)$ is quasi-compact, there exists a finite list
of elements $g_1, \ldots, g_m \in R$ such that
$V(f) \subset \bigcup D(g_j)$, an integer $n > 0$ and sections
$\sigma_j \in \mathcal{F}_2(D(f) \cup D(g_j))$ such that
$\sigma_j|_{D(f)} = f^n s$ and $\sigma_j$ maps to the section
$f^nm|_{D(f) \cup D(g_j)}$ of $\mathcal{F}_3$.
Consider the differences
$$
\sigma_j|_{D(f) \cup D(g_jg_k)}
-
\sigma_k|_{D(f) \cup D(g_jg_k)}.
$$
These correspond to sections of $\mathcal{F}_1$
over $D(f) \cup D(g_jg_k)$ which are zero
on $D(f)$. In particular their images in
$\mathcal{F}_1(D(g_jg_k)) = (M_1)_{g_jg_k}$
are zero in $(M_1)_{g_jg_kf}$.
Thus some high power of $f$ kills each and every one of these.
In other words, the elements $f^N \sigma_j$, for some $N \gg 0$
satisfy the glueing condition of the sheaf property and
give rise to a section $\sigma $ of $\mathcal{F}_2$
over $\bigcup (D(f) \cup D(g_j)) = X$ as desired.
\end{proof}







\section{Closed subspaces of affine schemes}
\label{section-closed-in-affine}

\begin{example}
\label{example-closed-immersion-affines}
Let $R$ be a ring.
Let $I \subset R$ be an ideal.
Consider the morphism of affine schemes
$i : Z = \text{Spec}(R/I) \to \text{Spec}(R) = X$.
By Algebra, Lemma \ref{algebra-lemma-spec-closed}
this is a homeomorphism of $Z$ onto a closed
subset of $X$. Moreover, if $I \subset \mathfrak p \subset R$
is a prime corresponding to a point $x = i(z)$, $x \in X$,
$z \in Z$, then on stalks we get the map
$$
\mathcal{O}_{X, x} = R_{\mathfrak p}
\longrightarrow
R_{\mathfrak p}/IR_{\mathfrak p} = \mathcal{O}_{Z, z}
$$
Thus we see that $i$ is a closed immersion of locally ringed spaces,
see Definition \ref{definition-closed-immersion-locally-ringed-spaces}.
Clearly, this is (isomorphic) to the closed subspace associated
to the sheaf of ideals $\widetilde I$, as in 
Example \ref{example-closed-subspace}.
\end{example}

\begin{lemma}
\label{lemma-closed-immersion-affine-case}
Let $(X, \mathcal{O}_X) = (\text{Spec}(R), \mathcal{O}_{\text{Spec}(R)})$
be an affine scheme. Let $i : Z \to X$ be any closed immersion
of locally ringed spaces. Then there exists an unique ideal
$I \subset R$ such that the morphism $i : Z \to X$ can be identified
with the closed immersion $\text{Spec}(R/I) \to \text{Spec}(R)$
constructed in Example \ref{example-closed-immersion-affines} above.
\end{lemma}

\begin{proof}
This is kind of silly! Namely, by Lemma \ref{lemma-closed-immersion}
we can identify $Z \to X$ with the closed subspace associated to
a sheaf of ideals $\mathcal{I} \subset \mathcal{O}_X$ as in
Definition \ref{definition-closed-subspace} and
Example \ref{example-closed-subspace}. 
By our conventions this sheaf of ideals is locally generated
by sections as a sheaf of $\mathcal{O}_X$-modules.
Hence the quotient sheaf $\mathcal{O}_X / \mathcal{I}$
is locally on $X$ the cokernel
of a map $\bigoplus_{j \in J} \mathcal{O}_U \to \mathcal{O}_U$.
Thus by definition, $\mathcal{O}_X / \mathcal{I}$ is quasi-coherent.
By our results in Section \ref{section-quasi-coherent-affine}
it is of the form $\widetilde S$ for some $R$-module $S$.
Moreover, since $\mathcal{O}_X = \widetilde R \to \widetilde S$
is surjective we see by Lemma \ref{lemma-extension-quasi-coherent}
that also $\mathcal{I}$ is quasi-coherent, say $\mathcal{I} = \widetilde I$.
Of course $I \subset R$ and $S = R/I$ and everything is clear.
\end{proof}













\section{Schemes}
\label{section-schemes}



\begin{definition}
\label{definition-scheme}
A {\it scheme} is a locally ringed space with the property that
every point has an open neighbourhood which is an affine scheme.
A {\it morphism of schemes} is a morphism of locally
ringed spaces.
\end{definition}

\begin{lemma}
\label{lemma-open-subspace-scheme}
Let $X$ be a scheme.
Any open subspace (see Definition \ref{definition-open-subspace})
of $X$ is a scheme.
\end{lemma}

\begin{proof}
Let $U \subset X$. Let $u \in U$.
Pick an affine open neighbourhood $u \in V \subset X$.
Because standard opens of $V$ form a basis of the topology
on $V$ we see that there exists a $f\in \mathcal{O}_V(V)$
such that $D(f) \subset U$. And $D(f)$ is an affine scheme
by Lemma \ref{lemma-standard-open-affine}. This proves that every point
of $U$ has an open neighbourhood which is affine.
\end{proof}

\noindent
Clearly the lemma (or its proof) shows that any scheme
$X$ has a basis (see Topology, Section \ref{topology-section-bases})
for the topology consisting of affine opens.

\begin{lemma}
\label{lemma-closed-subspace-scheme}
Let $X$ be a scheme.
Any closed subspace (see Definition \ref{definition-closed-subspace})
of $X$ is a scheme.
\end{lemma}

\begin{proof}
Let $i : Z \to X$ be a closed immersion.
Let $z \in Z$ be a point. Choose any affine open
neighbourhood $i(z) \in U \subset X$. By 
Lemma \ref{lemma-closed-immersion-affine-case}
we see that $z \in i^{-1}(U) \subset Z$ is an 
affine neighbourhood of $z$. Thus $Z$ is a scheme.
\end{proof}



\section{Glueing schemes}
\label{section-glueing-schemes}

\noindent
Let $I$ be a set.
For each $i \in I$ let $(X_i, \mathcal{O}_i)$ be 
a locally ringed space. (Actually the construction that
follows works equally well for ringed spaces.)
For each pair $i, j \in I$ let $U_{ij} \subset X_i$
be an open subspace.
For each pair $i, j \in I$, let
$$
\varphi_{ij} : U_{ij} \to U_{ji}
$$
be an isomorphism of locally ringed spaces.
For each triple $i, j, k \in I$ assume that
\begin{enumerate}
\item we have
$\varphi_{ij}^{-1}(U_{ji} \cap U_{jk}) =  U_{ij} \cap U_{ik}$, and
\item the diagram
$$
\xymatrix{
U_{ij} \cap U_{ik} \ar[rr]_{\varphi_{ik}} \ar[rd]_{\varphi_{ij}} & &
U_{ki} \cap U_{kj} \\
& U_{ji} \cap U_{jk} \ar[ru]_{\varphi_{jk}}
}
$$
is commutative.
\end{enumerate}
Let us call a collection
$(I, (X_i)_{i\in I}, (U_{ij})_{i,j\in I}, (\varphi_{ij})_{i,j\in I})$
satisfying the conditions above a glueing data.

\begin{lemma}
\label{lemma-glue}
Given any glueing data of locally ringed spaces there
exists a locally ringed space $X$ and open subspaces
$U_i \subset X$ together with isomorphisms
$\varphi_i : U_i \to X_i$ such that
\begin{enumerate}
\item $\varphi_i^{-1}(U_{ij}) = U_i \cap U_j$, and
\item $\varphi_{ij} = \varphi_j \circ \varphi_i^{-1}$.
\end{enumerate}
\end{lemma}







\input{chapters}

\bibliography{my}
\bibliographystyle{alpha}

\end{document}
