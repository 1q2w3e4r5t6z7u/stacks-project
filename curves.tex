\input{preamble}

% OK, start here.
%
\begin{document}

\title{Algebraic Curves}


\maketitle

\phantomsection
\label{section-phantom}

\tableofcontents

\section{Introduction}
\label{section-introduction}

\noindent
In this chapter we develop some of the theory of algebraic curves.
A reference covering algebraic curves over the complex numbers is
the book \cite{ACGH}.

\medskip\noindent
What we already know. Besides general algebraic geometry, we
have already proved some specific results on algebraic curves.
Here is a list.
\begin{enumerate}
\item We have discussed affine opens of and ample invertible sheaves on
$1$ dimensional Noetherian schemes in
Varieties, Section \ref{varieties-section-dimension-one}.
\item We have seen a curve is either affine or projective
in Varieties, Section \ref{varieties-section-curves}.
\item We have discussed degrees of locally free modules on
proper curves in Varieties, Section \ref{varieties-section-divisors-curves}.
\item We have discussed the Picard scheme of a nonsingular projective
curve over an algebraically closed field in
Picard Schemes of Curves, Section \ref{pic-section-introduction}.
\end{enumerate}





\section{Curves and function fields}
\label{section-curves-function-fields}

\noindent
In this section we elaborate on the results of
Varieties, Section \ref{varieties-section-varieties-rational-maps}
in the case of curves.

\begin{lemma}
\label{lemma-extend-over-dvr}
Let $k$ be a field. Let $X$ be a curve and $Y$ a proper variety.
Let $U \subset X$ be a nonempty open and let $f : U \to Y$ be a morphism.
If $x \in X$ is a closed point such that $\mathcal{O}_{X, x}$
is a discrete valuation ring, then there exists an open
$U \subset U' \subset X$ containing $x$ and a morphism of
varieties $f' : U' \to Y$ extending $f$.
\end{lemma}

\begin{proof}
This is a specical case of
Morphisms, Lemma \ref{morphisms-lemma-extend-across}.
\end{proof}

\begin{lemma}
\label{lemma-extend-over-normal-curve}
Let $k$ be a field. Let $X$ be a normal curve and $Y$ a proper variety.
The set of rational maps from $X$ to $Y$ is the same as the set
of morphisms $X \to Y$.
\end{lemma}

\begin{proof}
This is clear from Lemma \ref{lemma-extend-over-dvr}
as every local ring is a discrete valuation ring
(for example by Varieties, Lemma \ref{varieties-lemma-regular-point-on-curve}).
\end{proof}

\begin{lemma}
\label{lemma-extend-to-completion}
Let $k$ be a field. Let $X \to Y$ be a morphism of varieties
with $Y$ proper. There exists a factorization $X \to \overline{X} \to Y$
where $X \to \overline{X}$ is an open immersion
and $\overline{X}$ is a projective curve.
\end{lemma}

\begin{proof}
This is clear from Lemma \ref{lemma-extend-over-dvr}
and Varieties, Lemma \ref{varieties-lemma-reduced-dim-1-projective-completion}.
\end{proof}

\noindent
Here is the main theorem of this section. We will say a morphism
$f : X \to Y$ of varieties is {\it constant} if the image $f(X)$
consists of a single point $y$ of $Y$. If this happens then
$y$ is a closed point of $Y$ (since the image of a closed point
of $X$ will be a closed point of $Y$).

\begin{theorem}
\label{theorem-curves-rational-maps}
Let $k$ be a field. The following categories are canonically equivalent
\begin{enumerate}
\item The category of finitely generated field extensions $K/k$ of
transcendence degree $1$.
\item The category of curves and dominant rational maps.
\item The category of normal projective curves and nonconstant morphisms.
\item The category of nonsingular projective curves and nonconstant morphisms.
\item The category of regular projective curves and nonconstant morphisms.
\item The category of normal proper curves and nonconstant morphisms.
\end{enumerate}
\end{theorem}

\begin{proof}
The equivalence between categories (1) and (2) is the restriction of the
equivalence of
Varieties, Theorem \ref{varieties-theorem-varieties-rational-maps}.
Namely, a variety is a curve if and only if its function field has
transcendence degree $1$, see for example
Varieties, Lemma \ref{varieties-lemma-dimension-locally-algebraic}.

\medskip\noindent
The categories in (3), (4), (5), and (6) are the same. First of all, the
terms ``regular'' and ``nonsingular'' are synonyms, see
Properties, Definition \ref{properties-definition-regular}.
Being normal and regular are the same thing for Noetherian
$1$-dimensional schemes
(Properties, Lemmas \ref{properties-lemma-regular-normal} and
\ref{properties-lemma-normal-dimension-1-regular}). See
Varieties, Lemma \ref{varieties-lemma-regular-point-on-curve}
for the case of curves. Thus (3) is the same as (5). Finally, (6)
is the same as (3) by
Varieties, Lemma \ref{varieties-lemma-dim-1-proper-projective}.

\medskip\noindent
If $f : X \to Y$ is a nonconstant morphism of nonsingular projective curves,
then $f$ sends the generic point $\eta$ of $X$ to the generic point $\xi$ of
$Y$. Hence we obtain a morphism
$k(Y) = \mathcal{O}_{Y, \xi} \to \mathcal{O}_{X, \eta} = k(X)$
in the category (1). Conversely, suppose that we have a map
$k(Y) \to k(X)$ in the category (1). Then we obtain a morphism $U \to Y$
for some nonempty open $U \subset X$. By Lemma \ref{lemma-extend-over-dvr}
this extends to all of $X$ and we obtain a morphism in the category (5).
Thus we see that there is a fully faithfull functor (5)$\to$(1).

\medskip\noindent
To finish the proof we have to show that every $K/k$ in (1)
is the function field of a normal projective curve.
We already know that $K = k(X)$ for some curve $X$.
After replacing $X$ by its normalization
(which is a variety birational to $X$)
we may assume $X$ is normal
(Varieties, Lemma \ref{varieties-lemma-normalization-locally-algebraic}).
Then we choose $X \to \overline{X}$ with
$\overline{X} \setminus X = \{x_1, \ldots, x_n\}$ as in
Varieties, Lemma \ref{varieties-lemma-reduced-dim-1-projective-completion}.
Since $X$ is normal and since each
of the local rings $\mathcal{O}_{\overline{X}, x_i}$ is normal
we conclude that $\overline{X}$ is a normal projective curve as desired.
(Remark: We can also first compactify using
Varieties, Lemma \ref{varieties-lemma-dim-1-projective-completion}
and then normalize using
Varieties, Lemma \ref{varieties-lemma-normalization-locally-algebraic}.
Doing it this way we avoid using the somewhat tricky
Morphisms, Lemma \ref{morphisms-lemma-relative-normalization-normal-codim-1}.)
\end{proof}

\begin{definition}
\label{definition-normal-projective-model}
Let $k$ be a field. Let $X$ be a curve.
A {\it nonsingular projective model of $X$}
is a pair $(Y, \varphi)$ where $Y$ is a nonsingular projective
curve and $\varphi : k(X) \to k(Y)$ is an isomorphism
of function fields.
\end{definition}

\noindent
A nonsingular projective model is determined up to unique
isomorphism by Theorem \ref{theorem-curves-rational-maps}.
Thus we often say ``the nonsingular projective model''.
We usually drop $\varphi$ from the notation.
Warning: it needn't be the case that $Y$ is smooth over $k$
but Lemma \ref{lemma-nonsingular-model-smooth}
shows this can only happen in positive characteristic.

\begin{lemma}
\label{lemma-nonsingular-model-smooth}
Let $k$ be a field. Let $X$ be a curve and let $Y$ be the nonsingular
projective model of $X$. If $k$ is perfect, then $Y$ is a smooth
projective curve.
\end{lemma}

\begin{proof}
See Varieties, Lemma \ref{varieties-lemma-regular-point-on-curve}
for example.
\end{proof}

\begin{lemma}
\label{lemma-smooth-models}
Let $k$ be a field. Let $X$ be a geometrically irreducible curve over $k$.
For a field extension $K/k$ denote $Y_K$ a nonsingular projective model
of $(X_K)_{red}$.
\begin{enumerate}
\item If $X$ is proper, then $Y_K$ is the normalization of $X_K$.
\item There exists $K/k$ finite purely inseparable such that $Y_K$ is smooth.
\item Whenever $Y_K$ is smooth\footnote{Or even geometrically reduced.}
we have $H^0(Y_K, \mathcal{O}_{Y_K}) = K$.
\item Given a commutative diagram
$$
\xymatrix{
\Omega & K' \ar[l] \\
K \ar[u] & k \ar[l] \ar[u]
}
$$
of fields such that $Y_K$ and $Y_{K'}$ are smooth, then
$Y_\Omega = (Y_K)_\Omega = (Y_{K'})_\Omega$.
\end{enumerate}
\end{lemma}

\begin{proof}
Let $X'$ be a nonsingular projective model of $X$. Then $X'$ and
$X$ have isomorphic nonempty open subschemes. In particular
$X'$ is geometrically irreducible as $X$ is (some details omitted).
Thus we may assume that $X$ is projective.

\medskip\noindent
Assume $X$ is proper. Then $X_K$ is proper and hence the normalization
$(X_K)^\nu$ is proper as a scheme finite over a proper scheme
(Varieties, Lemma \ref{varieties-lemma-normalization-locally-algebraic}
and Morphisms, Lemmas \ref{morphisms-lemma-finite-proper} and
\ref{morphisms-lemma-composition-proper}).
On the other hand, $X_K$ is irreducible as $X$ is geometrically
irreducible. Hence $X_K^\nu$ is proper, normal, irreducible, and birational
to $(X_K)_{red}$. This proves (1) because a proper curve is projective
(Varieties, Lemma \ref{varieties-lemma-dim-1-proper-projective}).

\medskip\noindent
Proof of (2). As $X$ is proper and we have (1), we can apply
Varieties, Lemma \ref{varieties-lemma-finite-extension-geometrically-normal}
to find $K/k$ finite purely inseparable such that
$Y_K$ is geometrically normal. Then $Y_K$ is geometrically regular
as normal and regular are the same for curves
(Properties, Lemma \ref{properties-lemma-normal-dimension-1-regular}).
Then $Y$ is a smooth variety by
Varieties, Lemma \ref{varieties-lemma-geometrically-regular-smooth}.

\medskip\noindent
If $Y_K$ is geometrically reduced, then $Y_K$ is geometrically
integral (Varieties, Lemma \ref{varieties-lemma-geometrically-integral})
and we see that $H^0(Y_K, \mathcal{O}_{Y_K}) = K$ by
Varieties, Lemma \ref{varieties-lemma-regular-functions-proper-variety}.
This proves (3) because a smooth variety is geometrically reduced
(even geometrically regular, see
Varieties, Lemma \ref{varieties-lemma-geometrically-regular-smooth}).

\medskip\noindent
If $Y_K$ is smooth, then for every extension $\Omega/K$
the base change $(Y_K)_\Omega$ is smooth over $\Omega$
(Morphisms, Lemma \ref{morphisms-lemma-base-change-smooth}).
Hence it is clear that $Y_\Omega = (Y_K)_\Omega$. This proves (4).
\end{proof}






\section{Riemann-Roch and duality}
\label{section-Riemann-Roch}

\noindent
Let $k$ be a field. Let $X$ be a proper scheme of dimension $\leq 1$
over $k$. In Varieties, Section \ref{varieties-section-divisors-curves}
we have defined the degree of a locally free $\mathcal{O}_X$-module
$\mathcal{E}$ of constant rank by the formula
\begin{equation}
\label{equation-degree}
\deg(\mathcal{E}) =
\chi(X, \mathcal{E}) - \text{rank}(\mathcal{E})\chi(X, \mathcal{O}_X)
\end{equation}
see Varieties, Definition \ref{varieties-definition-degree-invertible-sheaf}.
In the chapter on Chow Homology we defined the first chern class of
$\mathcal{E}$ as an operation on cycles
(Chow Homology, Section
\ref{chow-section-intersecting-chern-classes}) and we proved that
\begin{equation}
\label{equation-degree-c1}
\deg(\mathcal{E}) = \deg(c_1(\mathcal{E}) \cap [X]_1)
\end{equation}
see Chow Homology, Lemma \ref{chow-lemma-degree-vector-bundle}.
Combining (\ref{equation-degree}) and (\ref{equation-degree-c1})
we obtain our first version of the Riemann-Roch formula
\begin{equation}
\label{equation-rr}
\chi(X, \mathcal{E}) =
\deg(c_1(\mathcal{E}) \cap [X]_1) +
\text{rank}(\mathcal{E})\chi(X, \mathcal{O}_X)
\end{equation}
If $\mathcal{L}$ is an invertible $\mathcal{O}_X$-module, then
we can also consider the numerical intersection
$(\mathcal{L} \cdot X)$ as defined in
Varieties, Definition \ref{varieties-definition-intersection-number}.
However, this does not give anything new as
\begin{equation}
\label{equation-numerical-degree}
(\mathcal{L} \cdot X) = \deg(\mathcal{L})
\end{equation}
by Varieties, Lemma
\ref{varieties-lemma-intersection-numbers-and-degrees-on-curves}. If
$\mathcal{L}$ is ample, then this integer is positive and is
called the degree
\begin{equation}
\label{equation-degree-X}
\deg_\mathcal{L}(X) = (\mathcal{L} \cdot X) = \deg(\mathcal{L})
\end{equation}
of $X$ with respect to $\mathcal{L}$, see
Varieties, Definition \ref{varieties-definition-degree}.

\medskip\noindent
To obtain a true Riemann-Roch theorem we would like to write
$\chi(X, \mathcal{O}_X)$ as the degree of a canonical zero cycle on $X$.
We refer to \cite{F} for a fully general version of this. We will use
duality to get a formula in the case where $X$ is Gorenstein; however,
in some sense this is a cheat (for example because this method cannot
work in higher dimension).

\begin{lemma}
\label{lemma-duality-dim-1}
Let $X$ be a proper scheme of dimension $\leq 1$ over a field $k$.
There exists a dualizing complex $\omega_X^\bullet$ with the
following properties
\begin{enumerate}
\item $H^i(\omega_X^\bullet)$ is nonzero only for $i = -1, 0$,
\item $\omega_X = H^{-1}(\omega_X^\bullet)$
is a coherent Cohen-Macaulay module whose support is the
irreducible components of dimension $1$,
\item for $x \in X$ closed, the module $H^0(\omega_{X, x}^\bullet)$
is nonzero if and only if either
\begin{enumerate}
\item $\dim(\mathcal{O}_{X, x}) = 0$ or
\item $\dim(\mathcal{O}_{X, x}) = 1$
and $\mathcal{O}_{X, x}$ is not Cohen-Macaulay,
\end{enumerate}
\item there are functorial isomorphisms
$\text{Ext}^i_X(K, \omega_X^\bullet) = \Hom_k(H^{-i}(X, K), k)$
compatible with shifts for $K \in D_\QCoh(X)$,
\item there are functorial isomorphisms
$\Hom(\mathcal{F}, \omega_X) = \Hom_k(H^1(X, \mathcal{F}), k)$
for $\mathcal{F}$ quasi-coherent on $X$,
\item if $X \to \Spec(k)$ is smooth of relative dimension $1$,
then $\omega_X \cong \Omega_{X/k}$.
\end{enumerate}
\end{lemma}

\begin{proof}
Denote $f : X \to \Spec(k)$ the structure morphism.
We start with the relative dualizing complex
$$
\omega_X^\bullet = \omega_{X/k}^\bullet = a(\mathcal{O}_{\Spec(k)})
$$
as described in Dualizing Complexes,
Remark \ref{dualizing-remark-relative-dualizing-complex}.
Then property (4) holds by construction.
Observe that $\omega_X^\bullet$ is also the dualizing complex
normalized relative to
$\omega_{\Spec(k)}^\bullet = \mathcal{O}_{\Spec(k)}$, i.e.,
it is the dualizing complex $\omega_X^\bullet$
as in Dualizing Complexes, Example \ref{dualizing-example-proper-over-local}
with $A = k$ and $\omega_A = k[0]$.
Parts (1) and (2) follow from
Dualizing Complexes, Lemma \ref{dualizing-lemma-vanishing-good-dualizing}.
For a closed point $x \in X$ we see that $\omega_{X, x}^\bullet$ is a
normalized dualizing complex over $\mathcal{O}_{X, x}$, see
Dualizing Complexes, Lemma \ref{dualizing-lemma-good-dualizing-normalized}.
Assertion (3) then follows from
Dualizing Complexes, Lemma \ref{dualizing-lemma-apply-CM}.
Assertion (5) follows from
Dualizing Complexes, Lemma \ref{dualizing-lemma-dualizing-module-proper-over-A}
for coherent $\mathcal{F}$ and in general by unwinding
(4) for $K = \mathcal{F}[0]$ and $i = -1$.
Assertion (6) follows from Dualizing Complexes,
Lemma \ref{dualizing-lemma-smooth-proper}.
\end{proof}

\begin{lemma}
\label{lemma-duality-dim-1-CM}
Let $X$ be a proper scheme over a field $k$ which is Cohen-Macaulay
and equidimensional of dimension $1$. There exists a dualizing module
$\omega_X$ with the following properties
\begin{enumerate}
\item $\omega_X$ is a coherent Cohen-Macaulay module whose support is $X$,
\item there are functorial isomorphisms
$\text{Ext}^i_X(K, \omega_X[1]) = \Hom_k(H^{-i}(X, K), k)$
compatible with shifts for $K \in D_\QCoh(X)$,
\item there are functorial isomorphisms
$\text{Ext}^{1 + i}(\mathcal{F}, \omega_X) = \Hom_k(H^{-i}(X, \mathcal{F}), k)$
for $\mathcal{F}$ quasi-coherent on $X$.
\end{enumerate}
\end{lemma}

\begin{proof}
Let us take $\omega_X$ normalized as in
as in Dualizing Complexes, Example
\ref{dualizing-example-equidimensional-over-field}.
Then the statements follow from
Lemma \ref{lemma-duality-dim-1}
and the fact that $\omega_X^\bullet = \omega_X[1]$
as $X$ is Cohen-Macualay (Dualizing Complexes, Lemma
\ref{dualizing-lemma-dualizing-module-CM-scheme}).
\end{proof}

\begin{remark}
\label{remark-rework-duality-locally-free}
Let $X$ be a proper scheme of dimension $\leq 1$ over a field $k$.
Let $\omega_X^\bullet$ be as in Lemma \ref{lemma-duality-dim-1}.
If $\mathcal{E}$ is a finite locally free $\mathcal{O}_X$-module
with dual $\mathcal{E}^\wedge$ then we have canonical isomorphisms
$$
\Hom_k(H^{-i}(X, \mathcal{E}), k) =
H^i(X, \mathcal{E}^\wedge \otimes_{\mathcal{O}_X}^\mathbf{L} \omega_X^\bullet)
$$
This follows from the lemma and
Cohomology, Lemma \ref{cohomology-lemma-dual-perfect-complex}.
If $X$ is Cohen-Macaulay and equidimensional of dimension $1$, then
we have canonical isomorphisms
$$
\Hom_k(H^{-i}(X, \mathcal{E}), k) =
H^{1 - i}(X, \mathcal{E}^\wedge \otimes_{\mathcal{O}_X} \omega_X)
$$
where $\omega_X$ is as in Lemma \ref{lemma-duality-dim-1-CM}. In particular
if $\mathcal{L}$ is an invertible $\mathcal{O}_X$-module, then we have
$$
\dim_k H^0(X, \mathcal{L}) =
\dim_k H^1(X, \mathcal{L}^{\otimes -1} \otimes_{\mathcal{O}_X} \omega_X)
$$
and
$$
\dim_k H^1(X, \mathcal{L}) =
\dim_k H^0(X, \mathcal{L}^{\otimes -1} \otimes_{\mathcal{O}_X} \omega_X)
$$
\end{remark}

\noindent
We can use Lemmas \ref{lemma-duality-dim-1} and \ref{lemma-duality-dim-1-CM}
to get a relation between the euler
characteristic of $\mathcal{O}_X$ and the euler characteristic
of the dualizing complex or the dualizing module.

\begin{lemma}
\label{lemma-euler}
Let $X$ be a proper scheme of dimension $\leq 1$ over a field $k$.
With $\omega_X^\bullet$ as in Lemma \ref{lemma-duality-dim-1} we have
$$
\chi(X, \mathcal{O}_X) = \chi(X, \omega_X^\bullet)
$$
If $X$ is Cohen-Macaulay and equidimensional of dimension $1$, then
$$
\chi(X, \mathcal{O}_X) = - \chi(X, \omega_X)
$$
with $\omega_X$ as in Lemma \ref{lemma-duality-dim-1-CM}.
\end{lemma}

\begin{proof}
We define the right hand side of the first formula as follows:
$$
\chi(X, \omega_X^\bullet) =
\sum\nolimits_{i \in \mathbf{Z}} (-1)^i\dim_k H^i(X, \omega_X^\bullet)
$$
This is well defined because $\omega_X^\bullet$ is in
$D^b_{\textit{Coh}}(\mathcal{O}_X)$, but also because
$$
H^i(X, \omega_X^\bullet) =
\text{Ext}^i(\mathcal{O}_X, \omega_X^\bullet) =
H^{-i}(X, \mathcal{O}_X)
$$
which is always finite dimensional and nonzero only if $i = 0, -1$.
This of course also proves the first formula. The second is a consequence
of the first because $\omega_X^\bullet = \omega_X[1]$ in the CM case.
\end{proof}

\noindent
We will use Lemma \ref{lemma-euler} to get the desired formula for
$\chi(X, \mathcal{O}_X)$ in the case that $\omega_X$ is
invertible, i.e., that $X$ is Gorenstein.
The statement is that $-1/2$ of the first chern class of $\omega_X$
capped with the cycle $[X]_1$ associated to $X$ is a natural zero
cycle on $X$ with half-integer coefficients whose degree is
$\chi(X, \mathcal{O}_X)$.
The occurence of fractions in the statement of Riemann-Roch cannot
be avoided.

\begin{lemma}[Rieman-Roch]
\label{lemma-rr}
Let $X$ be a proper scheme over a field $k$ which is Gorenstein and
equidimensional of dimension $1$. Let $\omega_X$ be as in
Lemma \ref{lemma-duality-dim-1-CM}. Then
\begin{enumerate}
\item $\omega_X$ is an invertible $\mathcal{O}_X$-module,
\item $\deg(\omega_X) = -2\chi(X, \mathcal{O}_X)$,
\item for a locally free $\mathcal{O}_X$-module $\mathcal{E}$
of constant rank we have
$$
\chi(X, \mathcal{E}) = \deg(\mathcal{E}) -
\textstyle{\frac{1}{2}} \text{rank}(\mathcal{E}) \deg(\omega_X)
$$
and $\dim_k(H^i(X, \mathcal{E})) =
\dim_k(H^{1 - i}(X, \mathcal{E}^\wedge \otimes_{\mathcal{O}_X} \omega_X))$
for all $i \in \mathbf{Z}$.
\end{enumerate}
\end{lemma}

\begin{proof}
It follows more or less from the definition of the Gorenstein property
that the dualizing sheaf is invertible, see
Dualizing Complexes, Section \ref{dualizing-section-gorenstein}.
By (\ref{equation-rr}) applied to $\omega_X$ we have
$$
\chi(X, \omega_X) = 
\deg(c_1(\omega_X) \cap [X]_1) + \chi(X, \mathcal{O}_X)
$$
Combined with Lemma \ref{lemma-euler} this gives
$$
2\chi(X, \mathcal{O}_X) = - \deg(c_1(\omega_X) \cap [X]_1) = - \deg(\omega_X)
$$
the second equality by (\ref{equation-degree-c1}). Putting this back into
(\ref{equation-rr}) for $\mathcal{E}$ gives the displayed formula of the lemma.
The symmetry in dimensions is a consequence of duality for $X$, see
Remark \ref{remark-rework-duality-locally-free}.
\end{proof}




\section{Some vanishing results}
\label{section-vanishing}

\begin{lemma}
\label{lemma-automatic}
Let $k$ be a field. Let $X$ be a proper scheme over $k$ having dimension $1$
and $H^0(X, \mathcal{O}_X) = k$. Then $X$ is Cohen-Macaulay
and equidimensional of dimension $1$.
\end{lemma}

\begin{proof}
Since $\Gamma(X, \mathcal{O}_X) = k$ has no nontrivial idempotents,
we see that $X$ is connected. This already shows that $X$ is
equidimensional of dimension $1$ (any irreducible component
of dimension $0$ would be a connected component).
Let $\mathcal{I} \subset \mathcal{O}_X$
be the maximal coherent submodule supported in closed points.
Then $\mathcal{I}$ exists
(Divisors, Lemma \ref{divisors-lemma-remove-embedded-points})
and is globally generated
(Varieties, Lemma \ref{varieties-lemma-chi-tensor-finite}).
Since $1 \in \Gamma(X, \mathcal{O}_X)$ is not a section
of $\mathcal{I}$ we conclude that $\mathcal{I} = 0$.
Thus $X$ does not have embedded points
(Divisors, Lemma \ref{divisors-lemma-remove-embedded-points}).
Thus $X$ has $(S_1)$ by
Divisors, Lemma \ref{divisors-lemma-S1-no-embedded}.
Hence $X$ is Cohen-Macaulay.
\end{proof}

\noindent
In this section we work in the following situation.

\begin{situation}
\label{situation-Cohen-Macaulay-curve}
Here $k$ is a field, $X$ is a proper scheme over $k$ having dimension $1$
and $H^0(X, \mathcal{O}_X) = k$.
\end{situation}

\noindent
By Lemma \ref{lemma-automatic} the scheme $X$ is Cohen-Macaulay and
equidimensional of dimension $1$. We denote $\omega_X$ the dualizing module
of $X$ as in Dualizing Complexes, Example
\ref{dualizing-example-equidimensional-over-field}.
Then Lemmas \ref{lemma-duality-dim-1} and \ref{lemma-duality-dim-1-CM}
show that $\omega_X$ has nonvanishing $H^1$ and in fact
$\dim_k H^1(X, \omega_X) = 1$. It turns out
that anything slightly more ``positive'' than $\omega_X$ has vanishing $H^1$.

\begin{lemma}
\label{lemma-vanishing}
In Situation \ref{situation-Cohen-Macaulay-curve}. Given an exact sequence
$$
\omega_X \to \mathcal{F} \to \mathcal{Q} \to 0
$$
of coherent $\mathcal{O}_X$-modules with $H^1(X, \mathcal{Q}) = 0$
(for example if $\dim(\text{Supp}(\mathcal{Q})) = 0$), then
either $H^1(X, \mathcal{F}) = 0$ or
$\mathcal{F} = \omega_X \oplus \mathcal{Q}$.
\end{lemma}

\begin{proof}
(The parenthetical statement follows from
Cohomology of Schemes, Lemma \ref{coherent-lemma-coherent-support-dimension-0}.)
Since $H^0(X, \mathcal{O}_X) = k$ is dual to $H^1(X, \omega_X)$
(see Section \ref{section-Riemann-Roch})
we see that $\dim H^1(X, \omega_X) = 1$. The sheaf $\omega_X$
represents the functor
$\mathcal{F} \mapsto \Hom_k(H^1(X, \mathcal{F}), k)$
on the category of coherent $\mathcal{O}_X$-modules
(Dualizing Complexes, Lemma
\ref{dualizing-lemma-dualizing-module-proper-over-A}).
Consider an exact sequence as in the statement of the lemma
and assume that $H^1(X, \mathcal{F}) \not = 0$. Since
$H^1(X, \mathcal{Q}) = 0$ we see that
$H^1(X, \omega_X) \to H^1(X, \mathcal{F})$ is an isomorphism.
By the universal property of $\omega_X$ stated above, we conclude there
is a map $\mathcal{F} \to \omega_X$ whose action on $H^1$ is the inverse
of this isomorphism. The composition $\omega_X \to \mathcal{F} \to \omega_X$
is the identity (by the universal property) and the lemma is proved.
\end{proof}

\begin{lemma}
\label{lemma-vanishing-twist}
In Situation \ref{situation-Cohen-Macaulay-curve}. Let
$\mathcal{L}$ be an invertible $\mathcal{O}_X$-module which is
globally generated and not isomorphic to $\mathcal{O}_X$. Then
$H^1(X, \omega_X \otimes \mathcal{L}) = 0$.
\end{lemma}

\begin{proof}
By duality as discussed in Section \ref{section-Riemann-Roch} we have to
show that $H^0(X, \mathcal{L}^{\otimes - 1}) = 0$. If not, then we can
choose a global section $t$ of $\mathcal{L}^{\otimes - 1}$
and a global section $s$ of $\mathcal{L}$ such that $st \not = 0$.
However, then $st$ is a constant multiple of $1$, by our assumption
that $H^0(X, \mathcal{O}_X) = k$. It follows that
$\mathcal{L} \cong \mathcal{O}_X$, which is a contradiction.
\end{proof}

\begin{lemma}
\label{lemma-globally-generated}
In Situation \ref{situation-Cohen-Macaulay-curve}. Given an exact sequence
$$
\omega_X \to \mathcal{F} \to \mathcal{Q} \to 0
$$
of coherent $\mathcal{O}_X$-modules with $\dim(\text{Supp}(\mathcal{Q})) = 0$
and $\dim_k H^0(X, \mathcal{Q}) \geq 2$ and such that there is no nonzero
submodule $\mathcal{Q}' \subset \mathcal{F}$ such that
$\mathcal{Q}' \to \mathcal{Q}$ is injective.
Then the submodule of $\mathcal{F}$ generated by global
sections surjects onto $\mathcal{Q}$.
\end{lemma}

\begin{proof}
Let $\mathcal{F}' \subset \mathcal{F}$ be the submodule generated by
global sections and the image of $\omega_X \to \mathcal{F}$. Since
$\dim_k H^0(X, \mathcal{Q}) \geq 2$ and
$\dim_k H^1(X, \omega_X) = \dim_k H^0(X, \mathcal{O}_X) = 1$,
we see that $\mathcal{F}' \to \mathcal{Q}$ is not zero and
$\omega_X \to \mathcal{F}'$ is not an isomorphism.
Hence $H^1(X, \mathcal{F}') = 0$ by Lemma \ref{lemma-vanishing}
and our assumption on $\mathcal{F}$.
Consider the short exact sequence
$$
0 \to \mathcal{F}' \to \mathcal{F} \to
\mathcal{Q}/\Im(\mathcal{F}' \to \mathcal{Q}) \to 0
$$
If the quotient on the right is nonzero, then we obtain a contradiction
because then $H^0(X, \mathcal{F})$ is bigger than $H^0(X, \mathcal{F}')$.
\end{proof}

\noindent
Here is an example global generation statement.

\begin{lemma}
\label{lemma-globally-generated-curve}
In Situation \ref{situation-Cohen-Macaulay-curve} assume that
$X$ is integral. Let $0 \to \omega_X \to \mathcal{F} \to \mathcal{Q} \to 0$
be a short exact sequence of coherent $\mathcal{O}_X$-modules with
$\mathcal{F}$ torsion free, $\dim(\text{Supp}(\mathcal{Q})) = 0$,
and $\dim_k H^0(X, \mathcal{Q}) \geq 2$. Then $\mathcal{F}$
is globally generated.
\end{lemma}

\begin{proof}
Consider the submodule $\mathcal{F}'$ generated by the global sections. By
Lemma \ref{lemma-globally-generated} we see that $\mathcal{F}' \to \mathcal{Q}$
is surjective, in particular $\mathcal{F}' \not = 0$. Since $X$ is a curve, we
see that $\mathcal{F}' \subset \mathcal{F}$ is an inclusion of rank $1$
sheaves, hence $\mathcal{Q}' = \mathcal{F}/\mathcal{F}'$ is supported in
finitely many points. To get a contradiction, assume that
$\mathcal{Q}'$ is nonzero. Then we see that $H^1(X, \mathcal{F}') \not = 0$.
Then we get a nonzero map $\mathcal{F}' \to \omega_X$ by the universal
property (Dualizing Complexes, Lemma
\ref{dualizing-lemma-dualizing-module-proper-over-A}).
The image of the composition $\mathcal{F}' \to \omega_X \to \mathcal{F}$
is generated by global sections, hence is inside of $\mathcal{F}'$.
Thus we get a nonzero self map $\mathcal{F}' \to \mathcal{F}'$.
Since $\mathcal{F}'$ is torsion free of rank $1$ on a proper curve
this has to be an automorphism (details omitted). But then this implies that
$\mathcal{F}'$ is contained in $\omega_X \subset \mathcal{F}$
contradicting the surjectivity of $\mathcal{F}' \to \mathcal{Q}$.
\end{proof}

\begin{lemma}
\label{lemma-tensor-omega-with-globally-generated-invertible}
In Situation \ref{situation-Cohen-Macaulay-curve}. Let $\mathcal{L}$
be a very ample invertible $\mathcal{O}_X$-module with
$\deg(\mathcal{L}) \geq 2$. Then
$\omega_X \otimes_{\mathcal{O}_X} \mathcal{L}$ is globally generated.
\end{lemma}

\begin{proof}
Assume $k$ is algebraically closed. Let $x \in X$ be a closed point.
Let $C_i \subset X$ be the irreducible components and for each $i$
let $x_i \in C_i$ be the generic point. By
Varieties, Lemma \ref{varieties-lemma-very-ample-vanish-at-point}
we can choose a section $s \in H^0(X, \mathcal{L})$ such that $s$
vanishes at $x$ but not at $x_i$ for all $i$. The corresponding
module map $s : \mathcal{O}_X \to \mathcal{L}$ is injective with
cokernel $\mathcal{Q}$ supported in finitely many points and
with $H^0(X, \mathcal{Q}) \geq 2$. Consider the corresponding
exact sequence
$$
0 \to \omega_X \to \omega_X \otimes \mathcal{L} \to
\omega_X \otimes \mathcal{Q} \to 0
$$
By Lemma \ref{lemma-globally-generated} we see that the module generated
by global sections surjects onto $\omega_X \otimes \mathcal{Q}$.
Since $x$ was arbitrary this proves the lemma. Some details omitted.

\medskip\noindent
We will reduce the case where $k$ is not algebraically closed, to
the algebraically closed field case. We suggest the reader skip
the rest of the proof. Choose an algebraic closure $\overline{k}$
of $k$ and consider the base change $X_{\overline{k}}$. Let us
check that $X_{\overline{k}} \to \Spec(\overline{k})$ is an example
of Situation \ref{situation-Cohen-Macaulay-curve}. By flat base change
(Cohomology of Schemes, Lemma \ref{coherent-lemma-flat-base-change-cohomology})
we see that $H^0(X_{\overline{k}}, \mathcal{O}) = \overline{k}$.
By Varieties, Lemma \ref{varieties-lemma-CM-base-change}
we see that $X_{\overline{k}}$ is Cohen-Macaulay. The scheme
$X_{\overline{k}}$ is proper over $\overline{k}$ (Morphisms,
Lemma \ref{morphisms-lemma-base-change-proper}) and
equidimensional of dimension $1$
(Morphisms, Lemma \ref{morphisms-lemma-dimension-fibre-after-base-change}).
The pullback of $\omega_X$ to $X_{\overline{k}}$ is the dualizing
module of $X_{\overline{k}}$ by
Dualizing Complexes, Lemma \ref{dualizing-lemma-more-base-change}.
The pullback of $\mathcal{L}$ to $X_{\overline{k}}$ is very ample
(Morphisms, Lemma \ref{morphisms-lemma-very-ample-base-change}).
The degree of the pullback of $\mathcal{L}$ to $X_{\overline{k}}$
is equal to the degree of $\mathcal{L}$ on $X$ (Varieties, Lemma
\ref{varieties-lemma-degree-base-change}). Finally, we see that
$\omega_X \otimes \mathcal{L}$ is globally generated if and only
if its base change is so
(Varieties, Lemma \ref{varieties-lemma-globally-generated-base-change}).
In this way we see that the result follows from the result in the
case of an algebraically closed ground field.
\end{proof}





\section{The genus of a curve}
\label{section-genus}

\noindent
If $X$ is a smooth projective curve over an algebraically closed field,
then we've previously defined the genus of $X$ as the dimension of
$H^1(X, \mathcal{O}_X)$, see
Picard Schemes of Curves, Definition \ref{pic-definition-genus}.
Let us generalize this as follows.

\begin{definition}
\label{definition-genus}
Let $k$ be a field. Let $X$ be a proper scheme over $k$ having
dimension $1$ and $H^0(X, \mathcal{O}_X) = k$.
Then the {\it genus} of $X$ is $g = \dim_k H^1(X, \mathcal{O}_X)$.
\end{definition}

\noindent
This is sometimes called the {\it arithmetic genus} of $X$.
In the literature the arithmetic genus of a proper curve $X$
over $k$ is sometimes defined as
$$
p_a(X) = 1 - \chi(X, \mathcal{O}_X) =
1 - \dim_k H^0(X, \mathcal{O}_X) + \dim_k H^1(X, \mathcal{O}_X)
$$
This agrees with our definition when it applies because we assume
$H^0(X, \mathcal{O}_X) = k$. But note that
\begin{enumerate}
\item $p_a(X)$ can be negative, and
\item $p_a(X)$ depends on the base field $k$ and should be written $p_a(X/k)$.
\end{enumerate}
For example if $k = \mathbf{Q}$
and $X = \mathbf{P}^1_{\mathbf{Q}(i)}$ then
$p_a(X/\mathbf{Q}) = -1$ and $p_a(X/\mathbf{Q}(i)) = 0$.

\medskip\noindent
The assumption that $H^0(X, \mathcal{O}_X) = k$ in our definition has
two consequences. On the one hand, it means there is no confusion about
the base field. On the other hand, it implies the scheme $X$ is
Cohen-Macaulay and equidimensional of dimension $1$
(Lemma \ref{lemma-automatic}). Letting $\omega_X$ be the dualizing
module as in Dualizing Complexes, Example
\ref{dualizing-example-equidimensional-over-field}
we see that
\begin{equation}
\label{equation-genus}
g = \dim_k H^1(X, \mathcal{O}_X) = \dim_k H^0(X, \omega_X)
\end{equation}
by duality (see Remark \ref{remark-rework-duality-locally-free}).

\medskip\noindent
If $X$ is proper over $k$ of dimension $\leq 1$ and $H^0(X, \mathcal{O}_X)$
is not equal to the ground field $k$, instead of using the arithmetic genus
$p_a(X)$ given by the displayed formula above we shall use the invariant
$\chi(X, \mathcal{O}_X)$. In fact, it is advocated in
\cite[page 276]{FAC} and \cite[Introduction]{Hirzebruch}
that we should call $\chi(X, \mathcal{O}_X)$ the arithmetic genus.

\begin{lemma}
\label{lemma-genus-base-change}
Let $k'/k$ be a field extension. Let $X$ be a proper scheme over $k$ having
dimension $1$ and $H^0(X, \mathcal{O}_X) = k$. Then $X_{k'}$ is a
proper scheme over $k'$
having dimension $1$ and $H^0(X_{k'}, \mathcal{O}_{X_{k'}}) = k'$.
Moreover the genus of $X_{k'}$ is equal to the genus of $X$.
\end{lemma}

\begin{proof}
The dimension of $X_{k'}$ is $1$ for example by
Morphisms, Lemma \ref{morphisms-lemma-dimension-fibre-after-base-change}.
The morphism $X_{k'} \to \Spec(k')$ is proper by
Morphisms, Lemma \ref{morphisms-lemma-base-change-proper}.
The equality $H^0(X_{k'}, \mathcal{O}_{X_{k'}}) = k'$ follows from
Cohomology of Schemes, Lemma
\ref{coherent-lemma-flat-base-change-cohomology}.
The equality of the genus follows from the same lemma.
\end{proof}

\begin{lemma}
\label{lemma-genus-gorenstein}
Let $k$ be a field. Let $X$ be a proper scheme over $k$ having
dimension $1$ and $H^0(X, \mathcal{O}_X) = k$. If $X$ is Gorenstein,
then
$$
\deg(\omega_X) = 2g - 2
$$
where $g$ is the genus of $X$ and $\omega_X$ is as in
Lemma \ref{lemma-duality-dim-1-CM}.
\end{lemma}

\begin{proof}
Immediate from Lemma \ref{lemma-rr}.
\end{proof}

\begin{lemma}
\label{lemma-genus-smooth}
Let $X$ be a smooth proper curve over a field $k$
with $H^0(X, \mathcal{O}_X) = k$. Then
$$
\dim_k H^0(X, \Omega_{X/k}) = g
\quad\text{and}\quad
\deg(\Omega_{X/k}) = 2g - 2
$$
where $g$ is the genus of $X$.
\end{lemma}

\begin{proof}
By Lemma \ref{lemma-duality-dim-1} we have $\Omega_{X/k} = \omega_X$.
Hence the formulas hold by (\ref{equation-genus}) and
Lemma \ref{lemma-genus-gorenstein}.
\end{proof}






\section{Plane curves}
\label{section-plane-curves}

\noindent
Let $k$ be a field. A {\it plane curve} will be a curve $X$ which is isomorphic
to a closed subscheme of $\mathbf{P}^2_k$. Often the embedding
$X \to \mathbf{P}^2_k$ will be considered given. By
Divisors, Example \ref{divisors-example-closed-subscheme-of-proj}
a curve is determined by the corresponding homogeneous ideal
$$
I(X) =
\Ker\left(
k[T_0, T_2, T_2] \longrightarrow \bigoplus \Gamma(X, \mathcal{O}_X(n))
\right)
$$
Recall that in this situation we have
$$
X = \text{Proj}(k[T_0, T_2, T_2]/I)
$$
as closed subschemes of $\mathbf{P}^2_k$.
For more general information on these constructions we refer the
reader to Divisors, Example \ref{divisors-example-closed-subscheme-of-proj}
and the references therein.
It turns out that $I(X) = (F)$ for some homogeneous polynomial
$F \in k[T_0, T_1, T_2]$, see Lemma \ref{lemma-equation-plane-curve}.
Since $X$ is irreducible, it follows that $F$ is irreducible, see
Lemma \ref{lemma-plane-curve}. Moreover, looking at the short exact
sequence
$$
0 \to \mathcal{O}_{\mathbf{P}^2_k}(-d) \xrightarrow{F}
\mathcal{O}_{\mathbf{P}^2_k} \to \mathcal{O}_X \to 0
$$
where $d = \deg(F)$ we find that $H^0(X, \mathcal{O}_X) = k$ and that $X$
has genus $(d - 1)(d - 2)/2$, see proof of Lemma \ref{lemma-genus-plane-curve}.

\medskip\noindent
To find smooth plane curve it is easiest to write explicit
equations. Let $p$ denote the characteristic of $k$. If $p$
does not divide $d$, then we can take
$$
F = T_0^d + T_1^d + T_2^d
$$
The corresponding curve $X = V_+(F)$ is called the
{\it Fermat curve} of degree $d$. It is smooth because
on each standard affine piece $D_+(T_i)$ we obtain
a curve isomorphic to the affine curve
$$
\Spec(k[x, y]/(x^d + y^d + 1))
$$
The ring map $k \to k[x, y]/(x^d + y^d + 1)$ is smooth by
Algebra, Lemma \ref{algebra-lemma-relative-global-complete-intersection-smooth}
as $d x^{d - 1}$ and $d y^{d - 1}$ generate the unit ideal
in $k[x, y]/(x^d + y^d + 1)$. If $p | d$ but $p \not = 3$
then you can use the equation
$$
F = T_0^{d - 1}T_1 + T_1^{d - 1}T_2 + T_2^{d - 1}T_0
$$
Namely, on the affine pieces you get $x + x^{d - 1}y + y^{d - 1}$
with derivatives $1 - x^{d - 2}y$ and $x^{d - 1} - y^{d - 2}$
whose common zero set (of all three) is empty\footnote{Namely,
as $x^{d - 1} = y^{d - 2}$, then $0 = x + x^{d - 1}y + y^{d - 1} =
x + 2 x^{d - 1} y$. Since $x \not = 0$ because $1 = x^{d - 2}y$
we get $0 = 1 + 2x^{d - 2}y = 3$ which is absurd unless $3 = 0$.}.
We leave it to the reader to make examples in characteristic $3$.

\medskip\noindent
More generally for any field $k$ and any $n$ and $d$ there exists
a smooth hypersurface of degree $d$ in $\mathbf{P}^n_k$, see
for example \cite{Poonen}.

\medskip\noindent
Of course, in this way we only find smooth curves whose genus
is a triangular number. To get smooth curves of an arbitrary
genus one can look for smooth curves lying on
$\mathbf{P}^1 \times \mathbf{P}^1$ (insert future reference here).

\begin{lemma}
\label{lemma-equation-plane-curve}
Let $Z \subset \mathbf{P}^2_k$ be a closed subscheme which
is equidimensional of dimension $1$ and has no embedded points
(equivalently $Z$ is Cohen-Macaulay).
Then the ideal $I(Z) \subset k[T_0, T_1, T_2]$ corresponding
to $Z$ is principal.
\end{lemma}

\begin{proof}
This is a special case of
Divisors, Lemma \ref{divisors-lemma-equation-codim-1-in-projective-space}
(see also Varieties, Lemma
\ref{varieties-lemma-equation-codim-1-in-projective-space})
The parenthetical statement follows from the fact that a
$1$ dimensional Noetherian scheme is Cohen-Macaulay
if and only if it has no embedded points, see
Divisors, Lemma \ref{divisors-lemma-noetherian-dim-1-CM-no-embedded-points}.
\end{proof}

\begin{lemma}
\label{lemma-plane-curve}
Let $Z \subset \mathbf{P}^2_k$ be as in Lemma \ref{lemma-equation-plane-curve}
and let $I(Z) = (F)$ for some $F \in k[T_0, T_1, T_2]$.
Then $Z$ is a curve if and only if $F$ is irreducible.
\end{lemma}

\begin{proof}
If $F$ is reducible, say $F = F' F''$ then let $Z'$ be the closed subscheme
of $\mathbf{P}^2_k$ defined by $F'$. It is clear that $Z' \subset Z$
and that $Z' \not = Z$. Since $Z'$ has dimension $1$ as well, we conclude
that either $Z$ is not reduced, or that $Z$ is not irreducible.
Conversely, write $Z = \sum a_i D_i$ where $D_i$ are the irreducible
components of $Z$, see
Divisors, Lemmas \ref{divisors-lemma-codim-1-part} and
\ref{divisors-lemma-codimension-1-is-effective-Cartier}.
Let $F_i \in k[T_0, T_1, T_2]$ be the homogeneous
polynomial generating the ideal of $D_i$. Then it is clear that
$F$ and $\prod F_i^{a_i}$ cut out the same closed subscheme of
$\mathbf{P}^2_k$. Hence $F = \lambda \prod F_i^{a_i}$ for some
$\lambda \in k^*$ because both generate the ideal of $Z$.
Thus we see that if $F$ is irreducible, then $Z$ is
a prime divisor, i.e., a curve.
\end{proof}

\begin{lemma}
\label{lemma-genus-plane-curve}
Let $Z \subset \mathbf{P}^2_k$ be as in Lemma \ref{lemma-equation-plane-curve}
and let $I(Z) = (F)$ for some $F \in k[T_0, T_1, T_2]$.
Then $H^0(Z, \mathcal{O}_Z) = k$ and the genus of $Z$ is
$(d - 1)(d - 2)/2$ where $d = \deg(F)$.
\end{lemma}

\begin{proof}
Let $S = k[T_0, T_1, T_2]$.
There is an exact sequence of graded modules
$$
0 \to S(-d) \xrightarrow{F} S \to S/(F) \to 0
$$
Denote $i : Z \to \mathbf{P}^2_k$ the given closed immersion.
Applying the exact functor $\widetilde{\ }$
(Constructions, Lemma \ref{constructions-lemma-proj-sheaves})
we obtain
$$
0 \to \mathcal{O}_{\mathbf{P}^2_k}(-d) \to
\mathcal{O}_{\mathbf{P}^2_k} \to i_*\mathcal{O}_Z \to 0
$$
because $F$ generates the ideal of $Z$.
Note that the cohomology groups of $\mathcal{O}_{\mathbf{P}^2_k}(-d)$ and
$\mathcal{O}_{\mathbf{P}^2_k}$ are given in
Cohomology of Schemes, Lemma
\ref{coherent-lemma-cohomology-projective-space-over-ring}.
On the other hand, we have
$H^q(Z, \mathcal{O}_Z) = H^q(\mathbf{P}^2_k, i_*\mathcal{O}_Z)$ by
Cohomology of Schemes, Lemma \ref{coherent-lemma-relative-affine-cohomology}.
Applying the long exact cohomology sequence
we first obtain that
$$
k = H^0(\mathbf{P}^2_k, \mathcal{O}_{\mathbf{P}^2_k}) \longrightarrow
H^0(Z, \mathcal{O}_Z)
$$
is an isomorphism and next that the boundary map
$$
H^1(Z, \mathcal{O}_Z) \longrightarrow
H^2(\mathbf{P}^2_k, \mathcal{O}_{\mathbf{P}^2_k}(-d)) \cong
k[T_0, T_1, T_2]_{d - 3}
$$
is an isomorphism. Since it is easy to see that the dimension of this
is $(d - 1)(d - 2)/2$ the proof is finished.
\end{proof}








\section{Geometric genus}
\label{section-geometric-genus}

\noindent
If $X$ is a proper and {\bf smooth} curve over $k$ with
$H^0(X, \mathcal{O}_X) = k$, then
$$
p_g(X) = \dim_k H^0(X, \Omega_{X/k})
$$
is called the {\it geometric genus} of $X$. By Lemma \ref{lemma-genus-smooth}
the geometric genus of $X$ agrees with the (arithmetic) genus. However,
in higher dimensions there is a difference between the geometric genus
and the arithmetic genus, see Remark \ref{remark-genus-higher-dimension}.

\medskip\noindent
For singular curves, we will define the geometric genus as follows.

\begin{definition}
\label{definition-geometric-genus}
Let $k$ be a field. Let $X$ be a geometrically irreducible
curve over $k$. The {\it geometric genus} of $X$ is the genus
of a smooth projective model of $X$ possibly defined over
an extension field of $k$ as in
Lemma \ref{lemma-smooth-models}.
\end{definition}

\noindent
If $k$ is perfect, then the nonsingular projective model $Y$ of $X$
is smooth (Lemma \ref{lemma-nonsingular-model-smooth})
and the geometric genus of $X$ is just the genus of $Y$.
But if $k$ is not perfect, this may not be true.
In this case we choose an extension $K/k$ such that
the nonsingular projective model $Y_K$ of $(X_K)_{red}$ is
a smooth projective curve and we define the geometric genus
of $X$ to be the genus of $Y_K$. This is well defined by
Lemmas \ref{lemma-smooth-models} and \ref{lemma-genus-base-change}.

\begin{remark}
\label{remark-genus-higher-dimension}
Suppose that $X$ is a $d$-dimensional proper smooth variety over
an algebraically closed field $k$.
Then the {\it arithmetic genus} is often defined as
$p_a(X) = (-1)^d(\chi(X, \mathcal{O}_X) - 1)$ and the {\it geometric genus}
as $p_g(X) = \dim_k H^0(X, \Omega^d_{X/k})$. In this situation
the arithmetic geneus and the geometric genus no longer agree
even though it is still true that $\omega_X \cong \Omega_{X/k}^d$.
For example, if $d = 2$, then we have
\begin{align*}
p_a(X) - p_g(X) & =
h^0(X, \mathcal{O}_X) - h^1(X, \mathcal{O}_X) + h^2(X, \mathcal{O}_X) - 1
- h^0(X, \Omega^2_{X/k}) \\
& =
- h^1(X, \mathcal{O}_X) + h^2(X, \mathcal{O}_X) - h^0(X, \omega_X) \\
& =
- h^1(X, \mathcal{O}_X)
\end{align*}
where $h^i(X, \mathcal{F}) = \dim_k H^i(X, \mathcal{F})$ and
where the last equality follows from duality.
Hence for a surface the difference $p_g(X) - p_a(X)$ is always
nonnegative; it is sometimes called the irregularity of the surface.
If $X = C_1 \times C_2$ is a product of smooth projective curves of
genus $g_1$ and $g_2$, then the irregularity is $g_1 + g_2$.
\end{remark}






\section{Riemann-Hurwitz}
\label{section-riemann-hurewitz}

\noindent
Let $k$ be a field. Let $f : X \to Y$ be a morphism of smooth curves over $k$.
Then we obtain a canonical exact sequence
$$
f^*\Omega_{Y/k} \xrightarrow{\text{d}f} \Omega_{X/k}
\longrightarrow \Omega_{X/Y} \longrightarrow 0
$$
by Morphisms, Lemma \ref{morphisms-lemma-triangle-differentials}.
Since $X$ and $Y$ are smooth, the sheaves $\Omega_{X/k}$ and
$\Omega_{Y/k}$ are invertible modules, see
Morphisms, Lemma \ref{morphisms-lemma-smooth-omega-finite-locally-free}.
Assume the first map is nonzero, i.e., assume $f$ is generically
\'etale, see Lemma \ref{lemma-generically-etale}. Let $R \subset X$
be the closed subscheme cut out by the different $\mathfrak{D}_f$ of $f$.
By Dualizing Complexes, Lemma
\ref{dualizing-lemma-discriminant-quasi-finite-morphism-smooth}
this is the same as the vanishing locus of $\text{d}f$, it is
an effective Cartier divisor, and we get
$$
f^*\Omega_{Y/k} \otimes_{\mathcal{O}_X} \mathcal{O}_X(R) = \Omega_{X/k}
$$
In particular, if $X$, $Y$ are projective with
$k = H^0(Y, \mathcal{O}_Y) = H^0(X, \mathcal{O}_X)$
and $X$, $Y$ have genus $g_X$, $g_Y$, then we get the
Riemann-Hurwitz formula
\begin{align*}
2g_X - 2 & =
\deg(\Omega_{X/k}) \\
& =
\deg(f^*\Omega_{Y/k} \otimes_{\mathcal{O}_X} \mathcal{O}_X(R)) \\
& =
\deg(f) \deg(\Omega_{Y/k}) + \deg(R) \\
& =
\deg(f) (2g_Y - 2) + \deg(R)
\end{align*}
The first and last equality by Lemma \ref{lemma-genus-smooth}.
The second equality by the isomorphism of invertible sheaves given above.
The third equality by additivity of degrees
(Varieties, Lemma \ref{varieties-lemma-degree-tensor-product}),
the formula for the degree of a pullback
(Varieties, Lemma \ref{varieties-lemma-degree-pullback-map-proper-curves}),
and finally the formula for the degree of $\mathcal{O}_X(R)$
(Varieties, Lemma \ref{varieties-lemma-degree-effective-Cartier-divisor}).

\medskip\noindent
To use the Riemann-Hurwitz formula we need to compute
$\deg(R) = \dim_k \Gamma(R, \mathcal{O}_R)$. By the structure
of zero dimensional schemes over $k$ (see for example
Varieties, Lemma \ref{varieties-lemma-algebraic-scheme-dim-0}),
we see that $R$ is a finite disjoint union of spectra of
Artinian local rings $R = \coprod_{x \in R} \Spec(\mathcal{O}_{R, x})$
with each $\mathcal{O}_{R, x}$ of finite dimension over $k$. Thus
$$
\deg(R) = \sum\nolimits_{x \in R} \dim_k \mathcal{O}_{R, x} =
\sum\nolimits_{x \in R} d_x [\kappa(x) : k]
$$
with
$$
d_x = \text{length}_{\mathcal{O}_{R, x}} \mathcal{O}_{R, x} =
\text{length}_{\mathcal{O}_{X, x}} \mathcal{O}_{R, x}
$$
the multiplicity of $x$ in $R$
(see Algebra, Lemma \ref{algebra-lemma-pushdown-module}).
Let $x \in X$ be a closed point with image $y \in Y$.
Looking at stalks we obtain an exact sequence
$$
\Omega_{Y/k, y} \to \Omega_{X/k, x} \to \Omega_{X/Y, x} \to 0
$$
Choosing local generators $\eta_x$ and $\eta_y$ of the
(free rank $1$) modules $\Omega_{X/k, x}$ and $\Omega_{Y/k, y}$
we see that
$
\eta_y \mapsto h \eta_x
$
for some nonzero $h \in \mathcal{O}_{X, x}$. By definition
$R$ is cut out by $h$. By the exact sequence we see that
$\Omega_{X/Y, x} \cong \mathcal{O}_{X, x}/h\mathcal{O}_{X, x}$
as $\mathcal{O}_{X, x}$-modules. Thus we find the following
equalities
\begin{align*}
d_x
& =
\text{length}_{\mathcal{O}_{X, x}}(\mathcal{O}_{X, x}/h\mathcal{O}_{X, x}) \\
& =
\text{length}_{\mathcal{O}_{X, x}}(\Omega_{X/Y, x}) \\
& =
\text{ord}_{\mathcal{O}_{X, x}}(h) \\
& =
\text{ord}_{\mathcal{O}_{X, x}}(``\eta_y/\eta_x")
\end{align*}
The first equality by our definition of $d_x$. The second by the above.
The third equality is the definition of $\text{ord}$, see
Algebra, Definition \ref{algebra-definition-ord}.
The fourth equality is a mnemonic.
Since $\mathcal{O}_{X, x}$ is a discrete valuation ring, the
integer $\text{ord}_{\mathcal{O}_{X, x}}(h)$ just the valuation of $h$.

\medskip\noindent
Here is a case where one can ``calculate'' the multiplicity $d_x$ in terms
of other invariants. Namely, if $\kappa(x)$ is separable over $k$, then
we may choose $\eta_x = \text{d}s$ and $\eta_y = \text{d}t$ where $s$
and $t$ are uniformizers in $\mathcal{O}_{X, x}$ and $\mathcal{O}_{Y, y}$
(Lemma \ref{lemma-uniformizer-works}).
Then $t \mapsto u s^{e_x}$ for some unit $u \in \mathcal{O}_{X, x}$
where $e_x$ is the ramification index of the extension
$\mathcal{O}_{Y, y} \subset \mathcal{O}_{X, x}$. Hence we get
$$
\eta_y = \text{d}t = \text{d}(u s^{e_x}) =
e s^{e_x - 1} u \text{d}s + s^{e_x} \text{d}u
$$
Writing $\text{d}u = w \text{d}s$ for some $w \in \mathcal{O}_{X, x}$
we see that
$$
``\eta_y/\eta_x" = e s^{e_x - 1} u + s^{e_x} w = (e_x u + s w)s^{e_x - 1}
$$
We conclude that the order of vanishing of this is $e_x - 1$
unless the characteristic of $\kappa(x)$ is $p > 0$ and $p$ divides $e_x$
in which case the order of vanishing is $> e_x - 1$.

\medskip\noindent
Combining all of the above we find that if $k$ has characteristic
zero, then
$$
2g_x - 2 = (2g_Y - 2)\deg(f) +
\sum\nolimits_{x \in X} (e_x - 1)[\kappa(x) : k]
$$
where $e_x$ is the ramification index of $\mathcal{O}_{X, x}$ over
$\mathcal{O}_{Y, f(x)}$. This precise formula will hold if and only
if all the ramification is tame, i.e., when the
residue field extensions $\kappa(x)/\kappa(y)$ are separable and
$e_x$ is prime to the characteristic of $k$, although the
arguments above are insufficient to prove this. We refer the reader
to Lemma \ref{lemma-rhe} and its proof.

\begin{lemma}
\label{lemma-generically-etale}
Let $k$ be a field. Let $f : X \to Y$ be a morphism of smooth curves over $k$.
The following are equivalent
\begin{enumerate}
\item $\text{d}f : f^*\Omega_{Y/k} \to \Omega_{X/k}$ is nonzero,
\item $\Omega_{X/Y}$ is supported on a proper closed subset of $X$,
\item there exists a nonempty open $U \subset X$ such that
$f|_U : U \to Y$ is unramified,
\item there exists a nonempty open $U \subset X$ such that
$f|_U : U \to Y$ is \'etale,
\item the extension $k(Y) \subset k(X)$ of function fields is
finite separable.
\end{enumerate}
\end{lemma}

\begin{proof}
Since $X$ and $Y$ are smooth, the sheaves $\Omega_{X/k}$ and
$\Omega_{Y/k}$ are invertible modules, see
Morphisms, Lemma \ref{morphisms-lemma-smooth-omega-finite-locally-free}.
Using the exact sequence
$$
f^*\Omega_{Y/k} \longrightarrow \Omega_{X/k}
\longrightarrow \Omega_{X/Y} \longrightarrow 0
$$
of Morphisms, Lemma \ref{morphisms-lemma-triangle-differentials}
we see that (1) and (2) are equivalent and equivalent to the
condition that $f^*\Omega_{Y/k} \to \Omega_{X/k}$ is nonzero
in the generic point. The equivalence of (2) and (3) follows
from Morphisms, Lemma \ref{morphisms-lemma-unramified-omega-zero}.
The equivalence between (3) and (4) follows from
Morphisms, Lemma \ref{morphisms-lemma-flat-unramified-etale}
and the fact that flatness is automatic
(use that smooth curves are regular and
Algebra, Lemma \ref{algebra-lemma-CM-over-regular-flat}).
To see the equivalence of (5) and (4)
use Algebra, Lemma \ref{algebra-lemma-smooth-at-generic-point}.
Some details omitted.
\end{proof}

\begin{lemma}
\label{lemma-rh}
Let $f : X \to Y$ be a morphism of smooth proper curves
over a field $k$ which satisfies the equivalent conditions of
Lemma \ref{lemma-generically-etale}. If
$k = H^0(Y, \mathcal{O}_Y) = H^0(X, \mathcal{O}_X)$
and $X$ and $Y$ have genus $g_X$ and $g_y$, then
$$
2g_X - 2 = (2g_Y - 2) \deg(f) + \deg(R)
$$
where $R \subset X$ is the effective Cartier divisor cut out by
the different of $f$.
\end{lemma}

\begin{proof}
See discussion above; we used
Dualizing Complexes, Lemma
\ref{dualizing-lemma-discriminant-quasi-finite-morphism-smooth},
Lemma \ref{lemma-genus-smooth}, and
Varieties, Lemmas \ref{varieties-lemma-degree-tensor-product} and
\ref{varieties-lemma-degree-pullback-map-proper-curves}.
\end{proof}

\begin{lemma}
\label{lemma-uniformizer-works}
Let $X \to \Spec(k)$ be smooth of relative dimension $1$ at a closed
point $x \in X$. If $\kappa(x)$ is separable over $k$, then for
any uniformizer $s$ in the discrete valuation ring $\mathcal{O}_{X, x}$
the element $\text{d}s$ freely generates $\Omega_{X/k, x}$
over $\mathcal{O}_{X, x}$.
\end{lemma}

\begin{proof}
The ring $\mathcal{O}_{X, x}$ is a discrete valuation ring by
Algebra, Lemma \ref{algebra-lemma-characterize-smooth-over-field}.
Since $x$ is closed $\kappa(x)$ is finite over $k$. Hence if
$\kappa(x)/k$ is separable, then any uniformizer $s$
maps to a nonzero element of
$\Omega_{X/k, x} \otimes_{\mathcal{O}_{X, x}} \kappa(x)$ by
Algebra, Lemma \ref{algebra-lemma-computation-differential}.
Since $\Omega_{X/k, x}$ is free of rank $1$ over $\mathcal{O}_{X, x}$
the result follows.
\end{proof}

\begin{lemma}
\label{lemma-rhe}
Notation and assumptions as in Lemma \ref{lemma-rh}. For a closed point
$x \in X$ let $d_x$ be the multiplicity of $x$ in $R$. Then
$$
2g_X - 2 = (2g_Y - 2) \deg(f) + \sum\nolimits d_x [\kappa(x) : k]
$$
Moreover, we have the following results
\begin{enumerate}
\item $d_x = \text{length}_{\mathcal{O}_{X, x}}(\Omega_{X/Y, x})$,
\item $d_x \geq e_x - 1$ where $e_x$ is the ramification index
of $\mathcal{O}_{X, x}$ over $\mathcal{O}_{Y, y}$,
\item $d_x = e_x - 1$ if and only if $\mathcal{O}_{X, x}$ is tamely
ramified over $\mathcal{O}_{Y, y}$.
\end{enumerate}
\end{lemma}

\begin{proof}
By Lemma \ref{lemma-rh} and the discussion above
(which used
Varieties, Lemma \ref{varieties-lemma-algebraic-scheme-dim-0}
and
Algebra, Lemma \ref{algebra-lemma-pushdown-module})
it suffices to prove the results on the
multiplicity $d_x$ of $x$ in $R$. Part (1) was proved
in the discussion above. In the discussion above
we proved (2) and (3) only in the case where $\kappa(x)$ is
separable over $k$.
In the rest of the proof we give a uniform treatement
of (2) and (3) using material on differents of
quasi-finite Gorenstein morphisms.

\medskip\noindent
First, observe that $f$ is a quasi-finite Gorenstein morphism.
This is true for example because
$f$ is a flat quasi-finite morphism and $X$ is Gorenstein
(see Dualizing Complexes, Lemma
\ref{dualizing-lemma-flat-morphism-from-gorenstein-scheme})
or because it was shown in the proof of
Dualizing Complexes, Lemma
\ref{dualizing-lemma-discriminant-quasi-finite-morphism-smooth}
(which we used above). Thus $\omega_{X/Y}$ is invertible by
Dualizing Complexes, Lemma \ref{dualizing-lemma-gorenstein-quasi-finite}
and the same remains true after replacing $X$ by opens and after
performing a base change by some $Y' \to Y$. We will use this
below without further mention.

\medskip\noindent
Choose affine opens $U \subset X$ and $V \subset Y$
such that $x \in U$, $y \in V$, $f(U) \subset V$, and $x$ is the only
point of $U$ lying over $y$. Write $U = \Spec(A)$ and $V = \Spec(B)$.
Then $R \cap U$ is the different of $f|_U : U \to V$.
By Dualizing Complexes, Lemma \ref{dualizing-lemma-base-change-different}
formation of the different commutes with arbitrary base change
in our case. By our choice of $U$ and $V$ we have
$$
A \otimes_B \kappa(y) =
\mathcal{O}_{X, x} \otimes_{\mathcal{O}_{Y, y}} \kappa(y) =
\mathcal{O}_{X, x}/(s^{e_x})
$$
where $e_x$ is the ramification index as in the statement of the lemma.
Let $C = \mathcal{O}_{X, x}/(s^{e_x})$ viewed as a finite algebra
over $\kappa(y)$. Let $\mathfrak{D}_{C/\kappa(y)}$ be the different
of $C$ over $\kappa(y)$ in the sense of
Dualizing Complexes, Definition \ref{dualizing-definition-different}.
It suffices to show: $\mathfrak{D}_{C/\kappa(y)}$
is nonzero if and only if the the extension
$\mathcal{O}_{Y, y} \subset \mathcal{O}_{X, x}$ is tamely ramified
and in the tamely ramified case $\mathfrak{D}_{C/\kappa(y)}$
is equal to the ideal generated by $s^{e_x - 1}$ in $C$.
Recall that tame ramification means exactly that $\kappa(x)/\kappa(y)$
is separable and that the characteristic of $\kappa(y)$ does not
divide $e_x$. On the other hand, the different of $C/\kappa(y)$ is nonzero
if and only if $\tau_{C/\kappa(y)} \in \omega_{C/\kappa(y)}$ is nonzero.
Namely, since $\omega_{C/\kappa(y)}$ is an invertible $C$-module
(as the base change of $\omega_{A/B}$)
it is free of rank $1$, say with generator $\lambda$. Write
$\tau_{C/\kappa(y)} = h\lambda$ for some $h \in C$. Then
$\mathfrak{D}_{C/\kappa(y)} = (h) \subset C$ whence the claim.
By Dualizing Complexes, Lemma \ref{dualizing-lemma-tau-nonzero}
we have $\tau_{C/\kappa(y)} \not = 0$
if and only if $\kappa(x)/\kappa(y)$
is separable and $e_x$ is prime to the characteristic.
Finally, even if $\tau_{C/\kappa(y)}$ is nonzero, then
it is still the case that $s \tau_{C/\kappa(y)} = 0$
because $s\tau_{C/\kappa(y)} : C \to \kappa(y)$
sends $c$ to the trace of the nilpotent operator $sc$ which is zero.
Hence $sh = 0$, hence $h \in (s^{e_x - 1})$ which proves
that $\mathfrak{D}_{C/\kappa(y)} \subset (s^{e_x - 1})$ always.
Since $(s^{e_x - 1}) \subset C$ is the smallest nonzero ideal,
we have proved the final assertion.
\end{proof}

\begin{lemma}
\label{lemma-ramification-to-algebraic-closure}
Let $X$ be a smooth curve over a field $k$. Let
$\overline{x} \in X_{\overline{k}}$ be a closed
point with image $x \in X$. The ramification index of
$\mathcal{O}_{X, x} \subset \mathcal{O}_{X_{\overline{k}}, \overline{x}}$
is the inseparable degree of $\kappa(x)/k$.
\end{lemma}

\begin{proof}
After shrinking $X$ we may assume there is an \'etale morphism
$\pi : X \to \mathbf{A}^1_k$, see
Morphisms, Lemma \ref{morphisms-lemma-smooth-etale-over-affine-space}.
Then we can consider the diagram of local rings
$$
\xymatrix{
\mathcal{O}_{X_{\overline{k}}, \overline{x}} &
\mathcal{O}_{\mathbf{A}^1_{\overline{k}}, \pi(\overline{x})} \ar[l] \\
\mathcal{O}_{X, x} \ar[u] &
\mathcal{O}_{\mathbf{A}^1_k, \pi(x)} \ar[l] \ar[u]
}
$$
The horizontal arrows have ramification index $1$ as they correspond to
\'etale morphisms. Moreover, the extension $\kappa(x)/\kappa(\pi(x))$ is
separable hence $\kappa(x)$ and $\kappa(\pi(x))$ have the same
inseparable degree over $k$.
By multiplicativity of ramification indices it suffices to
prove the result when $x$ is a point of the affine line.

\medskip\noindent
Assume $X = \mathbf{A}^1_k$. In this case, the local ring of $X$ at $x$
looks like
$$
\mathcal{O}_{X, x} = k[t]_{(P)}
$$
where $P$ is an irreducible monic polynomial over $k$.
Then $P(t) = Q(t^q)$ for some separable polynomial $Q \in k[t]$, see
Fields, Lemma \ref{fields-lemma-irreducible-polynomials}.
Observe that $\kappa(x) = k[t]/(P)$ has inseparable degree $q$
over $k$. On the other hand, over $\overline{k}$ we can factor
$Q(t) = \prod (t - \alpha_i)$ with $\alpha_i$ pairwise distinct.
Write $\alpha_i = \beta_i^q$ for some unique $\beta_i \in \overline{k}$.
Then our point $\overline{x}$ corresponds to one of the $\beta_i$
and we conclude because the ramification index of
$$
k[t]_{(P)} \longrightarrow \overline{k}[t]_{(t - \beta_i)}
$$
is indeed equal to $q$ as the uniformizer $P$ maps to
$(t - \beta_i)^q$ times a unit.
\end{proof}





\section{Glueing and squishing}
\label{section-glueing-squishing}

\noindent
Below we will indicate $k[\epsilon]$ the algebra of dual numbers
over $k$ as defined in
Varieties, Definition \ref{varieties-definition-dual-numbers}.

\begin{lemma}
\label{lemma-no-in-between-over-k}
Let $k$ be an algebraically closed field. Let $k \subset A$ be a ring
extension such that $A$ has exactly two $k$-sub algebras, then
either $A = k \times k$ or $A = k[\epsilon]$.
\end{lemma}

\begin{proof}
The assumption means $k \not = A$ and any subring $k \subset C \subset A$
is equal to either $k$ or $A$. Let $t \in A$, $t \not \in k$.
Then $A$ is generated by $t$ over $k$. Hence $A = k[x]/I$ for some
ideal $I$. If $I = (0)$, then we have the subalgebra $k[x^2]$
which is not allowed. Otherwise $I$ is generated by a monic polynomial $P$.
Write $P = \prod_{i = 1}^d (t - a_i)$. If $d > 2$, then the subalgebra
generated by $(t - a_1)(t - a_2)$ gives a contradiction.
Thus $d = 2$. If $a_1 \not = a_2$, then $A = k \times k$,
if $a_1 = a_2$, then $A = k[\epsilon]$.
\end{proof}

\begin{example}[Glueing points]
\label{example-glue-points}
Let $k$ be an algebraically closed field. Let $f : X' \to X$
be a morphism of algebraic $k$-schemes. We say $X$ is
obtained by glueing $a$ and $b$ in $X'$ if the following are true:
\begin{enumerate}
\item $a, b \in X'(k)$ are distinct points which map to the same
point $x \in X(k)$,
\item $f$ is finite and
$f^{-1}(X \setminus \{x\}) \to X \setminus \{x\}$ is an isomorphism,
\item there is a short exact sequence
$$
0 \to \mathcal{O}_X \to f_*\mathcal{O}_{X'} \xrightarrow{a - b} x_*k \to 0
$$
where arrow on the right sends a local section $h$ of $f_*\mathcal{O}_{X'}$
to the difference $h(a) - h(b) \in k$.
\end{enumerate}
If this is the case, then there also is a short exact sequence
$$
0 \to \mathcal{O}_X^* \to f_*\mathcal{O}_{X'}^*
\xrightarrow{ab^{-1}} x_*k^* \to 0
$$
where arrow on the right sends a local section $h$ of $f_*\mathcal{O}_{X'}^*$
to the multplicative difference $h(a)h(b)^{-1} \in k^*$.
\end{example}

\begin{example}[Squishing a tangent vector]
\label{example-squish-tangent-vector}
Let $k$ be an algebraically closed field. Let $f : X' \to X$
be a morphism of algebraic $k$-schemes. We say $X$ is
obtained by squishing the tangent vector $\vartheta$ in $X'$
if the following are true:
\begin{enumerate}
\item $\vartheta : \Spec(k[\epsilon]) \to X'$ is a closed immersion
over $k$ such that $f \circ \vartheta$ factors through a point $x \in X(k)$,
\item $f$ is finite and
$f^{-1}(X \setminus \{x\}) \to X \setminus \{x\}$ is an isomorphism,
\item there is a short exact sequence
$$
0 \to \mathcal{O}_X \to f_*\mathcal{O}_{X'} \xrightarrow{\vartheta} x_*k \to 0
$$
where arrow on the right sends a local section $h$ of $f_*\mathcal{O}_{X'}$
to the coefficient of $\epsilon$ in $\vartheta^\sharp(h) \in k[\epsilon]$.
\end{enumerate}
If this is the case, then there also is a short exact sequence
$$
0 \to \mathcal{O}_X^* \to f_*\mathcal{O}_{X'}^*
\xrightarrow{\vartheta} x_*k \to 0
$$
where arrow on the right sends a local section $h$ of $f_*\mathcal{O}_{X'}^*$
to $\text{d}\log(\vartheta^\sharp(h))$ where
$\text{d}\log : k[\epsilon]^* \to k$
is the homomorphism of abelian groups sending $a + b\epsilon$ to $b/a \in k$.
\end{example}

\begin{lemma}
\label{lemma-factor-almost-isomorphism}
Let $k$ be an algebraically closed field. Let $f : X' \to X$ be a
finite morphism algebraic $k$-schemes such that
$\mathcal{O}_X \subset f_*\mathcal{O}_{X'}$ and such that $f$ is an
isomorphism away from a finite set of points. Then there is a factorization
$$
X' = X_n \to X_{n - 1} \to \ldots \to X_1 \to X_0 = X
$$
such that each $X_i \to X_{i - 1}$ is either the glueing of
two points or the squishing of a tangent vector
(see Examples \ref{example-glue-points} and
\ref{example-squish-tangent-vector}).
\end{lemma}

\begin{proof}
Let $U \subset X$ be the maximal open set over which $f$ is an isomorphism.
Then $X \setminus U = \{x_1, \ldots, x_n\}$ with $x_i \in X(k)$.
We will consider factorizations $X' \to Y \to X$ of $f$ such that
both morphisms are finite and
$$
\mathcal{O}_X \subset g_*\mathcal{O}_Y \subset f_*\mathcal{O}_{X'}
$$
where $g : Y \to X$ is the given morphism. By assumption
$\mathcal{O}_{X, x} \to (f_*\mathcal{O}_{X'})_x$ is an isomorphism
onless $x = x_i$ for some $i$. Hence the cokernel
$$
f_*\mathcal{O}_{X'}/\mathcal{O}_X = \bigoplus \mathcal{Q}_i
$$
is a direct sum of skyscaper sheaves $\mathcal{Q}_i$ supported at
$x_1, \ldots, x_n$.
Because the displayed quotient is a coherent $\mathcal{O}_X$-module,
we conclude that $\mathcal{Q}_i$ has finite length over
$\mathcal{O}_{X, x_i}$. Hence we can argue
by induction on the sum of these lenghts, i.e., the length of
the whole cokernel.

\medskip\noindent
If $n > 1$, then we can define an $\mathcal{O}_X$-subalgebra
$\mathcal{A} \subset f_*\mathcal{O}_{X'}$ by taking the inverse
image of $\mathcal{Q}_1$. This will give a nontrivial factorization
and we win by induction.

\medskip\noindent
Assume $n = 1$. We abbreviate $x = x_1$. Consider the finite
$k$-algebra extension
$$
A = \mathcal{O}_{X, x} \subset (f_*\mathcal{O}_{X'})_x = B
$$
Note that $\mathcal{Q} = \mathcal{Q}_1$ is the skyscraper sheaf
with value $B/A$.
We have a $k$-subalgebra $A \subset A + \mathfrak m_A B \subset B$.
If both inclusions are strict, then we obtain a nontrivial
factorization and we win by induction as above.
If $A + \mathfrak m_A B = B$, then $A = B$ by Nakayama, then
$f$ is an isomorphism and there is nothing to prove.
We conclude that we may assume $B = A + \mathfrak m_A B$.
Set $C = B/\mathfrak m_A B$. If $C$ has more than $2$
$k$-subalgebras, then we obtain a subalgebra between $A$
and $B$ by taking the inverse image in $B$. Thus we may
assume $C$ has exactly $2$ $k$-subalgebras. Thus $C = k \times k$
or $C = k[\epsilon]$ by Lemma \ref{lemma-no-in-between-over-k}.
In this case $f$ is correspondingly the glueing two points or the
squishing of a tangent vector.
\end{proof}

\begin{lemma}
\label{lemma-glue-points}
Let $k$ be an algebraically closed field. If $f : X \to X'$ is the
glueing of two points $a, b$ as in Example \ref{example-glue-points}, then
there is an exact sequence
$$
k^* \to \text{Pic}(X) \to \text{Pic}(X') \to 0
$$
The first map is zero if $a$ and $b$ are on different
connected components of $X'$ and injective
if $X'$ is proper and $a$ and $b$ are on the same connected component of $X'$.
\end{lemma}

\begin{proof}
The map $\text{Pic}(X) \to \text{Pic}(X')$ is surjective
by Varieties, Lemma \ref{varieties-lemma-surjective-pic-birational-finite}.
Using the short exact sequence
$$
0 \to \mathcal{O}_X^* \to f_*\mathcal{O}_{X'}^*
\xrightarrow{ab^{-1}} x_*k^* \to 0
$$
we obtain
$$
H^0(X', \mathcal{O}_{X'}^*) \xrightarrow{ab^{-1}} k^* \to
H^1(X, \mathcal{O}_X^*) \to H^1(X, f_*\mathcal{O}_{X'}^*)
$$
We have $H^1(X, f_*\mathcal{O}_{X'}^*) \subset H^1(X', \mathcal{O}_{X'}^*)$
(for example by the Leray spectral sequence, see
Cohomology, Lemma \ref{cohomology-lemma-Leray}).
Hence the kernel of $\text{Pic}(X) \to \text{Pic}(X')$ is the
cokernel of $ab^{-1} : H^0(X', \mathcal{O}_{X'}^*) \to k^*$.
If $a$ and $b$ are on different connected components of $X'$,
then $ab^{-1}$ is surjective (also for example if $X'$ is affine).
Because $k$ is algebraically closed any regular function on a
reduced connected proper scheme over $k$ comes from an element of $k$, see
Varieties, Lemma
\ref{varieties-lemma-proper-geometrically-reduced-global-sections}.
Thus $ab^{-1}$ is zero if $X'$ is proper and $a$ and $b$ are on
the same connected component.
\end{proof}

\begin{lemma}
\label{lemma-squish-tangent-vector}
Let $k$ be an algebraically closed field. If $f : X \to X'$ is the
squishing of a tangent vector $\vartheta$ as in
Example \ref{example-squish-tangent-vector}, then
there is an exact sequence
$$
(k, +) \to \text{Pic}(X) \to \text{Pic}(X') \to 0
$$
and the first map is injective if $X'$ is proper and reduced.
\end{lemma}

\begin{proof}
The map $\text{Pic}(X) \to \text{Pic}(X')$ is surjective
by Varieties, Lemma \ref{varieties-lemma-surjective-pic-birational-finite}.
Using the short exact sequence
$$
0 \to \mathcal{O}_X^* \to f_*\mathcal{O}_{X'}^*
\xrightarrow{\vartheta} x_*k \to 0
$$
of Example \ref{example-squish-tangent-vector} we obtain
$$
H^0(X', \mathcal{O}_{X'}^*) \xrightarrow{\vartheta} k \to
H^1(X, \mathcal{O}_X^*) \to H^1(X, f_*\mathcal{O}_{X'}^*)
$$
We have $H^1(X, f_*\mathcal{O}_{X'}^*) \subset H^1(X', \mathcal{O}_{X'}^*)$
(for example by the Leray spectral sequence, see
Cohomology, Lemma \ref{cohomology-lemma-Leray}).
Hence the kernel of $\text{Pic}(X) \to \text{Pic}(X')$ is the
cokernel of the map $\vartheta : H^0(X', \mathcal{O}_{X'}^*) \to k$.
Because $k$ is algebraically closed any regular function on a
reduced connected proper scheme over $k$ comes from an element of $k$, see
Varieties, Lemma
\ref{varieties-lemma-proper-geometrically-reduced-global-sections}.
Thus the final statement of the lemma.
\end{proof}


\section{Multicross and nodal singularities}
\label{section-multicross}

\noindent
In this section we discuss the simplest possible curve singularities.


\begin{lemma}
\label{lemma-prepare-delta-invariant}
Let $k$ be an algebraically closed field. Let $X$ be a reduced algebraic
$k$-scheme of dimension $\leq 1$. Let $\nu : X^\nu \to X$
be the normalization.
\begin{enumerate}
\item The morphism $\nu : X^\nu \to X$ is finite,
$\mathcal{O}_X \subset \nu_*\mathcal{O}_{X^\nu}$, and
$\nu_*\mathcal{O}_{X^\nu}/\mathcal{O}_X$
is a direct sum of skyscraper sheaves $\mathcal{Q}_x$
in the singular points $x$ of $X$.
\item $B = (\nu_*\mathcal{O}_{X^\nu})_x$ is the integral closure
of $A = \mathcal{O}_{X, x}$ in its total ring of fractions,
\item $A \to B$ is finite, $\mathcal{Q}_x = B/A$ has finite length,
and $B/A$ is annihilated by a power of $\mathfrak m_A$,
\item $B$ is a semi-local ring which is a finite product of
Dedekind domains,
\item the completion $A^\wedge$ is a reduced Noetherian complete
local $k$-algebra with residue field $k$ and dimension $1$,
\item the $\mathfrak m_A$-adic completion $B^\wedge$ is the
integral closure of $A^\wedge$ in its total ring of fractions,
\item $B^\wedge$ is a finite product of $k$-algebras isomorphic to
$k[[t]]$, and
\item $B/A \cong B^\wedge/A^\wedge$.
\end{enumerate}
\end{lemma}

\begin{proof}
Finiteness of $\nu$ follows from
Varieties, Lemma \ref{varieties-lemma-normalization-locally-algebraic}.
This lemma also shows that $\nu$ is birational, which implies
it is an isomorphism over a dense open $U \subset X$
(Morphisms, Lemma \ref{morphisms-lemma-birational-isomorphism-over-dense-open}).
Since $\dim(X) \leq 1$ this implies that $\nu$ is not an isomorphism
over finitely many points $x \in X$ (necessarily closed points of course).
In particular we see that we have a short exact sequence
$$
0 \to \mathcal{O}_X \to \nu_*\mathcal{O}_{X^\nu} \to
\bigoplus\nolimits_{x \in X \setminus U} \mathcal{Q}_x \to 0
$$
We will prove below that we only need to consider singular points
in the direct sum, i.e., that $\mathcal{Q}_x$ is zero for regular points.

\medskip\noindent
It follows from the construction of normalization
(via Morphisms, Lemma \ref{morphisms-lemma-integral-closure})
that $A = \mathcal{O}_{X, x} \subset B = (\nu_*\mathcal{O}_{X^\nu})_x$ is
the integral closure in $\prod \kappa(\eta)$ where the product is
over the generic points $\eta$ of $X$ which specialize to $x$.
Since $\prod_{\eta \leadsto x} \kappa(\eta)$ is the
total ring of fractions of $\mathcal{O}_{X, x}$ we see that $B$ is as
predicted in (2). You can also prove this by appealing to the
general description of normalization in Morphisms, Lemma
\ref{morphisms-lemma-description-normalization}
and the fact that normalization commutes with localization
(Algebra, Lemma \ref{algebra-lemma-integral-closure-localize}).
It is clear that $\mathcal{Q}_x$ is the skyscraper sheaf with
value $B/A$ from the short exact sequence.

\medskip\noindent
Recall that $\mathcal{O}_{X, x}$ is normal if and only if it is
regular (see for example
Varieties, Lemma \ref{varieties-lemma-regular-point-on-curve}),
hence the last statement of (1) is a consequence of the
description of $\mathcal{Q}_x$ as $B/A$ given above.

\medskip\noindent
The ring map $A \to B$ is finite by our result above that $\nu$ is finite.
Hence $B/A$ is a finite module with support in
$\{\mathfrak m\}$ by our exact sequence above.
This implies it has finite length
(Algebra, Lemma \ref{algebra-lemma-support-point}) and
that $B/A$ is killed by a power of $\mathfrak m$
(Algebra, Lemma \ref{algebra-lemma-Noetherian-power-ideal-kills-module}).
This proves (3).

\medskip\noindent
Since $A \to B$ is finite, we immediately see that $B$ is semi-local.
Moreover, above we have seen that
$B$ is the product of the integral closures of $B$
in the fields $\kappa(\eta)$ for $\eta \in X$ a generic point
specializing to $x$, hence $B$ is a product of Dedekind domains
for example by Algebra, Lemma \ref{algebra-lemma-integral-closure-Dedekind}.
This proves (4).

\medskip\noindent
By Algebra, Lemma \ref{algebra-lemma-completion-finite-extension}
we see that $B^\wedge$ is the product of the completions of $B$
at its maximal ideals $\mathfrak m$ (lying over $\mathfrak m_A$).
Since $k = \kappa(x) = \kappa(\mathfrak m_A) \subset \kappa(\mathfrak m)$
is finite, it is an isomorphism. Since $B_\mathfrak m$ is a discrete
valuation ring, so is its completion
(More on Algebra, Lemma \ref{more-algebra-lemma-completion-dvr}).
It follows from
Algebra, Lemma \ref{algebra-lemma-regular-complete-containing-coefficient-field}
that $(B_\mathfrak m)^\wedge$ is isomorphic to $k[[t]]$.
This proves (7).
In particular $B^\wedge$ is a normal ring which is equal to the integral
closure in its own total ring of fractions.

\medskip\noindent
Since completion on the category of finite $A$-modules is exact and
produces finite $A^\wedge$-modules
(Algebra, Lemmas \ref{algebra-lemma-completion-flat})
we have $A^\wedge \subset B^\wedge$
with quotient $(B/A)^\wedge$. We have
$(B/A)^\wedge = B/A$ because $B/A$ is annihilated by a power of
$\mathfrak m_A$ which gives (8).

\medskip\noindent
Since $A^\wedge \subset B^\wedge$ we find that $A^\wedge$ is reduced.
Since $A$ and $A^\wedge$ have the same dimension
(More on Algebra, Lemma \ref{more-algebra-lemma-completion-dimension})
we find that (5) holds.

\medskip\noindent
Pick $f \in \mathfrak m_A$ a nonzerodivisor; this is possible because
$A$ is reduced and therefore has $(S_1)$ by
Algebra, Lemma \ref{algebra-lemma-criterion-reduced}.
Then $f$ maps to a nonzerodivisor
in $B$ and $A_f \cong B_f$ because some power of $f$ annihilates $B/A$.
The exactness property of completion mentioned above implies
that $f$ maps to a nonzerodivisor of $A^\wedge$ and $B^\wedge$.
Of course $(A^\wedge)_f \cong (B^\wedge)_f$ because a power of $f$
annihilates $B^\wedge/A^\wedge = B/A$. Thus
$A^\wedge$ and $B^\wedge$ have the same total fraction rings.
Since $B^\wedge$ is finite over $A^\wedge$ (hence integral)
and since we saw above that $B^\wedge$ is the integrally closed
in its own total ring of fractions, we conclude that (6) is true.
\end{proof}

\begin{definition}
\label{definition-number-of-branches}
Let $k$ be an algebraically closed field. Let $X$ be a reduced
algebraic $k$-scheme equidimensional of dimension $1$ and let
$x \in X$ be a closed point. The {\it number of branches of $X$ at $x$} is
the number of points of the normalization of $X$ lying over $x$.
\end{definition}

\noindent
It follows from Lemma \ref{lemma-prepare-delta-invariant}
that the number of branches of $X$ at $x$ is
$$
\text{number of maximal ideals of }B =
\text{number of factors }k[[t]]\text{ of }B^\wedge
$$
We infer the number of branches is an invariant
of the complete local ring $\mathcal{O}_{X, x}^\wedge$.
If $A$ is a reduced local Nagata ring of dimension $1$
whose residue field is algebraically closed\footnote{If the
residue field is not algebraically closed then we should
consider ``geometric branches'' to get a good invariant.}, then we can
similarly define the number of branches of $A$ in terms
of the number of maximal ideals of the the normalization
or in terms of the number of minimal primes of the
completion of $A$.

\begin{definition}
\label{definition-delta-invariant}
Let $k$ be an algebraically closed field.
Let $X$ be a reduced algebraic $k$-scheme equidimensional of
dimension $1$ and let $x \in X$ be a
closed point. The {\it $\delta$-invariant of $X$ at $x$} is
$\text{length}_{\mathcal{O}_{X, x}}(\mathcal{Q}_x)$ where
$\mathcal{Q}_x$ is as in Lemma \ref{lemma-prepare-delta-invariant}.
\end{definition}

\noindent
It follows from Lemma \ref{lemma-prepare-delta-invariant}
that the $\delta$-invariant of $X$ at $x$ is
$$
\delta\text{-invariant of }X\text{ at }x =
\dim_k(B/A) = \dim_k(B^\wedge/A^\wedge).
$$
We conclude that the $\delta$-invariant is an invariant
of the complete local ring of the point. More precisely,
if $A$ is a reduced local Nagata ring of dimension $1$, then
we can define the {\it $\delta$-invariant of $A$} to be the length
of $B/A$ as an $A$-module where $B$ is the integral closure of $A$
in its total ring of fractions. This makes sense: as $A$ is Nagata
the extension $A \subset B$ is finite
(Algebra, Lemma
\ref{algebra-lemma-nagata-in-reduced-finite-type-finite-integral-closure})
and $B/A$ has finite length (by the same arguments as those used in the
proof of
Lemma \ref{lemma-prepare-delta-invariant}).
With this definition in place we see from
Lemma \ref{lemma-prepare-delta-invariant}
that
$$
\delta\text{-invariant of }X\text{ at }x =
\delta\text{-invariant of }\mathcal{O}_{X, x} =
\delta\text{-invariant of }\mathcal{O}_{X, x}^\wedge
$$
Observe that the $\delta$-invariant of a local ring $A$ as above
is $0$ if and only if $A$ is a discrete valuation ring, see
Algebra, Lemma \ref{algebra-lemma-characterize-dvr}.
Below we will see some examples.

\medskip\noindent
Let $k$ be a field. Consider the complete local $k$-algebra
\begin{equation}
\label{equation-multicross}
A = \{(f_1, \ldots, f_n) \in k[[t]] \times \ldots \times k[[t]] \mid
f_1(0) = \ldots = f_n(0)\}
\end{equation}
We encourage the reader to show that $A$ is indeed local.
Once verified it is immediate that $k[[t]] \times \ldots \times k[[t]]$
is the integral closure of $A$ in its total ring of fractions.
Hence the $\delta$-invariant of $A$ is $n - 1$.
There is an isomorphism
$$
k[[x_1, \ldots, x_n]]/(\{x_ix_j\}_{i \not = j}) \longrightarrow A
$$
obtained by sending $x_i$ to $(0, \ldots, 0, t, 0, \ldots, 0)$
in $A$. It follows that $\dim(A) = 1$ and
$\dim_k \mathfrak m/\mathfrak m^2 = n$.
Hence $A$ has embedding dimension $n$.
In particular, $A$ is regular if and only if $n = 1$.

\begin{lemma}
\label{lemma-multicross-algebra}
Let $k$ be an algebraically closed field. Let $A$ be a $1$-dimensional
reduced Nagata local $k$-algebra with residue field $k$. Then
$$
\delta\text{-invariant }A \geq \text{number of branches of }A - 1
$$
If equality holds, then $A^\wedge$ is as in (\ref{equation-multicross}).
\end{lemma}

\begin{proof}
We may replace $A$ by the completion of $A$ as the discussion below
Definition \ref{definition-delta-invariant} shows this does not change
the $\delta$-invariant. Then the integral closure
$B$ of $A$ in its total ring of fractions is a product of rings
isomorphic to $k[[t]]$ by Algebra, Lemma
\ref{algebra-lemma-regular-complete-containing-coefficient-field}.
To prove the lemma it suffices to show that if
$$
A \subset \prod\nolimits_{i = 1}^n k[[t]]
$$
is a local complete $k$-algebra of finite codimension, then
this codimension is at least $n - 1$ and if equal, then $A$
is as in (\ref{equation-multicross}). We omit the details.
\end{proof}

\begin{definition}
\label{definition-multicross}
Let $k$ be an algebraically closed field. Let $X$ be an algebraic
$1$-dimensional $k$-scheme. Let $x \in X$ be a closed point.
We say $x$ defines a {\it multicross singularity} if the completion
$\mathcal{O}_{X, x}^\wedge$
is isomorphic to (\ref{equation-multicross}) for some $n \geq 2$.
We say $x$ is a {\it node}, or an {\it ordinary double point}, or
{\it defines a nodal singularity} if $n = 2$.
\end{definition}

\noindent
These singularities are in some sense the simplest kind of singularities
one can have on a curve over an algebraically closed field.

\begin{lemma}
\label{lemma-multicross}
Let $k$ be an algebraically closed field. Let $X$ be a reduced algebraic
$1$-dimensional $k$-scheme. Let $x \in X$. The following are equivalent
\begin{enumerate}
\item $x$ defines a multicross singularity,
\item the $\delta$-invariant of $X$ at $x$ is the
number of branches of $X$ at $x$ minus $1$,
\item there is a sequence of morphisms
$U_n \to U_{n - 1} \to \ldots \to U_0 = U \subset X$
where $U$ is an open neighbourhood of $x$, where
$U_n$ is nonsingular, and where each $U_i \to U_{i - 1}$
is the glueing of two points as in Example \ref{example-glue-points}.
\end{enumerate}
\end{lemma}

\begin{proof}
The equivalence of (1) and (2) is Lemma \ref{lemma-multicross-algebra}.

\medskip\noindent
Assume (3). We will argue by descending induction on $i$ that all singularities
of $U_i$ are multicross. This is true for $U_n$ as $U_n$ has no singular points.
If $U_i$ is gotten from $U_{i + 1}$ by glueing $a, b \in U_{i + 1}$
to a point $c \in U_i$, then we see that
$$
\mathcal{O}_{U_i, c}^\wedge \subset
\mathcal{O}_{U_{i + 1}, a}^\wedge \times \mathcal{O}_{U_{i + 1}, b}^\wedge
$$
is the set of elements having the same residue classes in $k$.
Thus the number of branches at $c$ is the sum of the number of
branches at $a$ and $b$, and the $\delta$-invariant at $c$
is the sum of the $\delta$-invariants at $a$ and $b$ plus $1$
(because the displayed inclusion has codimension $1$).
This proves that (2) holds as desired.

\medskip\noindent
Assume the equivalent conditions (1) and (2). We may choose an open
$U \subset X$ such that $x$ is the only singular point of $U$.
Then we apply Lemma \ref{lemma-factor-almost-isomorphism} to
the normalization morphism
$$
U^\nu = U_n \to U_{n - 1} \to \ldots \to U_1 \to U_0 = U
$$
All we have to do is show that in none of the steps we are
squishing a tangent vector. Suppose $U_{i + 1} \to U_i$ is the
smallest $i$ such that this is the squishing of a tangent
vector $\theta$ at $u' \in U_{i + 1}$ lying over $u \in U_i$.
Arguing as above, we see that $u_i$ is a multicross singularity
(because the maps $U_i \to \ldots \to U_0$ are glueing of
pairs of points). But now the number of branches at $u'$ and $u$
is the same and the $\delta$-invariant of $U_i$ at $u$
is $1$ bigger than the $\delta$-invariant of $U_{i + 1}$ at $u'$.
By Lemma \ref{lemma-multicross-algebra}
this implies that $u$ cannot be a multicross singularity which
is a contradiction.
\end{proof}





\section{Torsion in the Picard group}
\label{section-torsion-in-pic}

\noindent
In this section we bound the torsion in the Picard group of a $1$-dimensional
proper scheme over an algebraically closed field. We will use this in our
study of semi-stable reduction for curves.

\medskip\noindent
There does not seem to be an elementary way to obtain the result of
Lemma \ref{lemma-torsion-picard-smooth-projective}.
Analyzing the proof there are two key ingredients:
(1) there is an abelian variety classifying degree zero invertible sheaves on
a smooth projective curve and (2) the structure of torsion points on
an abelian variety can be determined.

\begin{lemma}
\label{lemma-torsion-picard-smooth-projective}
Let $k$ be an algebraically closed field.
Let $X$ be a smooth projective curve of genus $g$ over $k$.
\begin{enumerate}
\item If $n \geq 1$ is invertible in $k$, then
$\text{Pic}(X)[n] \cong (\mathbf{Z}/n\mathbf{Z})^{\oplus 2g}$.
\item If the characteristic of $k$ is $p > 0$, then there exists
an integer $0 \leq f \leq g$ such that
$\text{Pic}(X)[p^m] \cong (\mathbf{Z}/p^m\mathbf{Z})^{\oplus f}$ for
all $m \geq 1$.
\end{enumerate}
\end{lemma}

\begin{proof}
Let $\text{Pic}^0(X) \subset \text{Pic}(X)$
denote the subgroup of invertible sheaves of degree $0$.
In other words, there is a short exact sequence
$$
0 \to \text{Pic}^0(X) \to \text{Pic}(X) \xrightarrow{\deg} \mathbf{Z} \to 0.
$$
The group $\text{Pic}^0(X)$ is the $k$-points of
the group scheme $\underline{\text{Pic}}^0_{X/k}$, see
Picard Schemes of Curves, Lemma \ref{pic-lemma-picard-pieces}.
The same lemma tells us that $\underline{\text{Pic}}^0_{X/k}$
is a $g$-dimensional abelian variety over $k$ as defined in
Groupoids, Definition \ref{groupoids-definition-abelian-variety}.
Thus we conclude by the results of
Groupoids, Proposition \ref{groupoids-proposition-review-abelian-varieties}.
\end{proof}

\begin{proposition}
\label{proposition-torsion-picard-reduced-proper}
Let $k$ be an algebraically closed field. Let $X$ be a proper scheme over $k$
which is reduced, connected, and has dimension $1$. Let $g$ be the genus
of $X$ and let $g_{geom}$ be the sum of the geometric genera of the
irreducible components of $X$. For any prime $\ell$ different from
the characteristic of $k$ we have
$$
\dim_{\mathbf{F}_\ell} \text{Pic}(X)[\ell]
\leq g + g_{geom}
$$
and equality holds if and only if all the singularities of $X$
are multicross.
\end{proposition}

\begin{proof}
Let $\nu : X^\nu \to X$ be the normalization
(Lemma \ref{lemma-prepare-delta-invariant}).
Choose a factorization
$$
X^\nu = X_n \to X_{n - 1} \to \ldots \to X_1 \to X_0 = X
$$
as in Lemma \ref{lemma-factor-almost-isomorphism}.
Let us denote $h^0_i = \dim_k H^0(X_i, \mathcal{O}_{X_i})$
and $h^1_i = \dim_k H^1(X_i, \mathcal{O}_{X_i})$.
By Lemmas \ref{lemma-glue-points} and \ref{lemma-squish-tangent-vector}
for each $n > i \geq 0$ we have
one of the following there possibilities
\begin{enumerate}
\item $X_i$ is obtained by glueing $a, b \in X_{i + 1}$
which are on different connected components: in this case
$\text{Pic}(X_i) = \text{Pic}(X_{i + 1})$,
$h^0_{i + 1} = h^0_i + 1$, $h^1_{i + 1} = h^1_i$,
\item $X_i$ is obtained by glueing $a, b \in X_{i + 1}$
which are on the same connected component: in this case
there is a short exact sequence
$$
0 \to k^* \to \text{Pic}(X_i) \to \text{Pic}(X_{i + 1}) \to 0,
$$
and $h^0_{i + 1} = h^0_i$, $h^1_{i + 1} = h^1_i - 1$,
\item $X_i$ is obtained by squishing a tangent vectorin $X_{i + 1}$:
in this case there is a short exact sequence
$$
0 \to (k, +) \to \text{Pic}(X_i) \to \text{Pic}(X_{i + 1}) \to 0,
$$
and $h^0_{i + 1} = h^0_i$, $h^1_{i + 1} = h^1_i - 1$.
\end{enumerate}
To prove the statements on dimensions of cohomology groups of the
structure sheaf, use the exact sequences in
Examples \ref{example-glue-points} and \ref{example-squish-tangent-vector}.
Since $k$ is algebraically closed of characteristic prime to $\ell$
we see that $(k, +)$ and $k^*$ are $\ell$-divisible and with
$\ell$-torsion $(k, +)[\ell] = 0$ and $k^*[\ell] \cong \mathbf{F}_\ell$.
Hence
$$
\dim_{\mathbf{F}_\ell} \text{Pic}(X_{i + 1})[\ell] -
\dim_{\mathbf{F}_\ell}\text{Pic}(X_i)[\ell]
$$
is zero, except in case (2) where it is equal to $-1$.
At the end of this process we get the normalization
$X^\nu = X_n$ which is a disjoint union of smooth projective
curves over $k$. Hence we have
\begin{enumerate}
\item $h^1_n = g_{geom}$ and
\item $\dim_{\mathbf{F}_\ell} \text{Pic}(X_n)[\ell] = 2g_{geom}$.
\end{enumerate}
The last equality by Lemma \ref{lemma-torsion-picard-smooth-projective}.
Since $g = h^1_0$ we see that the number of steps of type
(2) and (3) is at most $h^1_0 - h^1_n = g - g_{geom}$.
By our comptation of the differences in ranks we conclude that
$$
\dim_{\mathbf{F}_\ell} \text{Pic}(X)[\ell] \leq
g - g_{geom} + 2g_{geom} = g + g_{geom}
$$
and equality holds if and only if no steps of type (3) occur.
This indeed means that all singularities of $X$ are multicross
by Lemma \ref{lemma-multicross}. Conversely, if all the singularities
are multicross, then Lemma \ref{lemma-multicross} guarantees that
we can find a sequence $X^\nu = X_n \to \ldots \to X_0 = X$
as above such that no steps of type (3) occur in the sequence
and we find equality holds in the lemma (just glue the local sequences
for each point to find one that works for all singular points of $x$;
some details omitted).
\end{proof}





\input{chapters}

\bibliography{my}
\bibliographystyle{amsalpha}

\end{document}
