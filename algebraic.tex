\input{preamble}

% OK, start here.
%
\begin{document}

\title{Algebraic stacks}


\maketitle

\phantomsection
\label{section-phantom}

\tableofcontents

\section{Introduction}
\label{section-introduction}

\noindent
This is where we define algebraic stacks and make some very elementary
observations. The general philosophy will be to have no separation
conditions whatsoever and add those conditions necessary to make lemmas,
propositions, theorems true/provable. Thus the notions discussed here
differ slightly from those in other places in the literature, e.g.,
\cite{LM-B}.



\section{Conventions}
\label{section-conventions}

\noindent
The conventions we use in this chapter are the same as those in the
chapter on algebraic spaces. For convenience we repeat them here.

\medskip\noindent
We work in a suitable big fppf site $\textit{Sch}_{fppf}$
as in Topologies, Definition \ref{topologies-definition-big-fppf-site}.
So, if not explicitly stated otherwise all schemes will be objects
of $\textit{Sch}_{fppf}$.
We will record elsewhere what changes if you change the big
fppf site (insert future reference here).

\medskip\noindent
We will always work relative to a base $S$ contained in $\textit{Sch}_{fppf}$.
And we will then work with the big fppf site $(\textit{Sch}/S)_{fppf}$,
see Topologies, Definition \ref{topologies-definition-big-small-fppf}.
The absolute case can be recovered by taking
$S = \text{Spec}(\mathbf{Z})$.

\medskip\noindent
If $U, T$ are schemes over $S$, then we denote
$U(T)$ for the set of $T$-valued points {\it over} $S$.
In a formula: $U(T) = \text{Mor}_S(T, U)$.

\medskip\noindent
Note that any fpqc covering is a family of universally effective
epimorphisms, see
Descent, Lemma \ref{descent-lemma-fpqc-universal-effective-epimorphisms}.
Hence the topology on $\textit{Sch}_{fppf}$
is weaker than the canonical topology and all representable presheaves
are sheaves.
















\section{Representable morphisms of categories fibred in groupoids}
\label{section-representable}

\noindent
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
The basic object of study in this chapter will be a
category fibred in groupoids
$p : \mathcal{X} \to (\textit{Sch}/S)_{fppf}$, see
Categories, Definition \ref{categories-definition-fibred-groupoids}.
We will often simply say ``let $\mathcal{X}$ be a category fibred
in groupoids over $(\textit{Sch}/S)_{fppf}$'' to indicate
this situation. A $1$-morphism $\mathcal{X} \to \mathcal{Y}$ of categories
in groupoids over $(\textit{Sch}/S)_{fppf}$ will be a $1$-morphism
in the $2$-category of categories fibred in groupoids over
$(\textit{Sch}/S)_{fppf}$, see Categories,
Definition \ref{categories-definition-categories-fibred-in-groupoids-over-C}.
It is simply a functor $\mathcal{X} \to \mathcal{Y}$ over
$(\textit{Sch}/S)_{fppf}$.
We recall this is really a $(2, 1)$-category and that all $2$-fibre products
exist.

\medskip\noindent
Let $U \in \text{Ob}((\textit{Sch}/S)_{fppf})$, and let $\mathcal{X}$ be a
category fibred in groupoids over $(\textit{Sch}/S)_{fppf}$.
We will frequently use the $2$-Yoneda lemma, Categories,
Lemma \ref{categories-lemma-yoneda-2category}.
It says that $1$-morphisms $(\textit{Sch}/U)_{fppf} \to \mathcal{X}$
correspond to objects $x$ of the fibre category $\mathcal{X}_U$.
Let us make a choice of pullbacks for $\mathcal{X}$ as in Categories,
Definition \ref{categories-definition-pullback-functor-fibred-category}.
The functor $(\textit{Sch}/U)_{fppf} \to \mathcal{X}$ corresponding to $x$
is the functor $(f : V \to U) \mapsto f^*x$ on objects. The notation
$x : (\textit{Sch}/U)_{fppf} \to \mathcal{X}$ will be used to indicate this
functor.

\medskip\noindent
Let $\mathcal{X}$, $\mathcal{Y}$ be categories fibred in groupoids
over $(\textit{Sch}/S)_{fppf}$. Let $f : \mathcal{X} \to \mathcal{Y}$
be a {\it representable $1$-morphism}, see
Categories, Definition
\ref{categories-definition-representable-map-categories-fibred-in-groupoids}.
This means that for every $U \in \text{Ob}((\textit{Sch}/S)_{fppf})$ and
any $y \in \text{Ob}(\mathcal{Y}_U)$ the $2$-fiber product
$(\textit{Sch}/U)_{fppf} \times_{y, \mathcal{Y}} \mathcal{X}$
is representable, see Categories,
Definition \ref{categories-definition-representable-fibred-category}.
Choose a representing object $V_y$ and an equivalence
$$
(\textit{Sch}/V_y)_{fppf}
\longrightarrow
(\textit{Sch}/U)_{fppf} \times_\mathcal{Y} \mathcal{X}.
$$
By the $2$-Yoneda lemma the projection
$(\textit{Sch}/V_y)_{fppf} \to
(\textit{Sch}/U)_{fppf} \times_\mathcal{Y} \mathcal{Y}
\to (\textit{Sch}/U)_{fppf}$ comes from a unique object of
the fibre category $((\textit{Sch}/U)_{fppf})_{V_y}$, in other words
a morphism of schemes $f_y : V_y \to U$. Suggestively we could
represent this by the diagram
$$
\xymatrix{
V_y \ar@{~>}[r] \ar[d]_{f_y} &
(\textit{Sch}/V_y)_{fppf} \ar[d] \ar[r] &
\mathcal{X} \ar[d]^f \\
U \ar@{~>}[r] &
(\textit{Sch}/U)_{fppf} \ar[r]^-y &
\mathcal{Y}
}
$$
where the squiggly arrows represent the $2$-Yoneda embedding.
Here are some lemmas about this notion that work in great generality.

\begin{lemma}
\label{lemma-morphism-schemes-gives-representable-transformation}
Let $S$, $X$, $Y$ be objects of $\textit{Sch}_{fppf}$.
Let $f : X \to Y$ be a morphism of schemes.
Then the $1$-morphism induced by $f$
$$
(\textit{Sch}/X)_{fppf} \longrightarrow (\textit{Sch}/Y)_{fppf}
$$
is a representable $1$-morphism.
\end{lemma}

\begin{proof}
This is entirely formal and relies only on the fact that
the category $(\textit{Sch}/S)_{fppf}$ has fibre products.
\end{proof}

\begin{lemma}
\label{lemma-composition-representable-transformations}
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
Let $\mathcal{X}, \mathcal{Y}, \mathcal{Z}$
be categories fibred in groupoids over $(\textit{Sch}/S)_{fppf}$
Let $f : \mathcal{X} \to \mathcal{Y}$, $g : \mathcal{Y} \to \mathcal{Z}$
be representable $1$-morphisms. Then
$$
g \circ f : \mathcal{X} \longrightarrow \mathcal{Z}
$$
is a representable $1$-morphism.
\end{lemma}

\begin{proof}
This is entirely formal and works in any category.
\end{proof}

\begin{lemma}
\label{lemma-base-change-representable-transformations}
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
Let $\mathcal{X}, \mathcal{Y}, \mathcal{Z}$
be categories fibred in groupoids over $(\textit{Sch}/S)_{fppf}$
Let $f : \mathcal{X} \to \mathcal{Y}$ be a representable $1$-morphism.
Let $g : \mathcal{Z} \to \mathcal{Y}$ be any $1$-morphism.
Consider the fibre product diagram
$$
\xymatrix{
\mathcal{Z} \times_{g, \mathcal{Y}, f} \mathcal{X} \ar[r]_-{g'} \ar[d]_{f'} &
\mathcal{X} \ar[d]^f \\
\mathcal{Z} \ar[r]^g & \mathcal{Y}
}
$$
Then the base change $f'$ is a representable $1$-morphism.
\end{lemma}

\begin{proof}
This is entirely formal and works in any category.
\end{proof}

\begin{lemma}
\label{lemma-product-representable-transformations}
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
Let $\mathcal{X}_i, \mathcal{Y}_i$ be categories fibred in groupoids over
$(\textit{Sch}/S)_{fppf}$, $i = 1, 2$.
Let $f_i : \mathcal{X}_i \to \mathcal{Y}_i$, $i = 1, 2$
be representable $1$-morphisms.
Then
$$
f_1 \times f_2 :
\mathcal{X}_1 \times \mathcal{X}_2
\longrightarrow
\mathcal{Y}_1 \times \mathcal{Y}_2
$$
is a representable $1$-morphism.
\end{lemma}

\begin{proof}
Write $f_1 \times f_2$ as the composition
$\mathcal{X}_1 \times \mathcal{X}_2 \to
\mathcal{Y}_1 \times \mathcal{X}_2 \to
\mathcal{Y}_1 \times \mathcal{Y}_2$.
The first arrow is the base change of $f_1$ by the map
$\mathcal{Y}_1 \times \mathcal{X}_2 \to \mathcal{Y}_1$, and the second arrow
is the base change of $f_2$ by the map
$\mathcal{Y}_1 \times \mathcal{Y}_2 \to \mathcal{Y}_2$.
Hence this lemma is a formal
consequence of Lemmas \ref{lemma-composition-representable-transformations}
and \ref{lemma-base-change-representable-transformations}.
\end{proof}






\section{Morphisms representable by algebraic spaces}
\label{section-representable-by-algebraic-spaces}

\noindent
A slightly weaker notion than being representable is the notion of
being representable by algebraic spaces. This discussion might have
been avoid had we worked with the category $\textit{Spaces}_{fppf}$
of algebraic spaces instead of the category $\textit{Sch}_{fppf}$.
However, it seems to us natural to consider the category of all schemes
as the natural collection of ``test objects'' over which the fibre
categories of an algebraic stack are defined.

\medskip\noindent
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
Recall that given a presheaf
$$
F : (\textit{Sch}/S)_{fppf}^{opp} \longrightarrow \textit{Groupoids}
$$
we get a category fibred in groupoids $\mathcal{S}_F$ over
$(\textit{Sch}/S)_{fppf}$, see
Categories, Example \ref{categories-example-functor-groupoids}.
Any category fibred in groupoids isomorphic (!) to one of these
is called {\it split}, and any category fibred in groupoids
is equivalent to a split one.
If $F$ is a presheaf of sets then $\mathcal{S}_F$ is
fibred in sets (see Categories,
Definition \ref{categories-definition-category-fibred-sets}).

\medskip\noindent
An even more special case is where $F = h_X$ is a representable
presheaf (which is also a sheaf). In this case we have
$\mathcal{S}_F = (\textit{Sch}/X)_{fppf}$.

\medskip\noindent
In analogy with Categories, Definitions
\ref{categories-definition-representable-fibred-category} and
\ref{categories-definition-representable-map-categories-fibred-in-groupoids}
we make the following definition.

\begin{definition}
\label{definition-representable-by-algebraic-spaces}
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
\begin{enumerate}
\item A category fibred in groupoids
$p : \mathcal{X} \to (\textit{Sch}/S)_{fppf}$ is
called {\it representable by an algebraic space over $S$}
if there exists an algebraic space $F$ over $S$ and an equivalence
$j : \mathcal{X} \to \mathcal{S}_F$
(in the $2$-category of groupoids over $(\textit{Sch}/S)_{fppf}$).
\item A $1$-morphism $f : \mathcal{X} \to \mathcal{Y}$ of
categories fibred in groupoids over $(\textit{Sch}/S)_{fppf}$
is called {\it representable by algebraic spaces} if
for any $U \in \text{Ob}((\textit{Sch}/S)_{fppf})$
and any $y : (\textit{Sch}/U)_{fppf} \to \mathcal{Y}$
the category fibred in groupoids
$$
(\textit{Sch}/U)_{fppf} \times_{\mathcal{Y}} \mathcal{X}
$$
over $(\textit{Sch}/U)_{fppf}$
is representable by an algebraic space over $U$.
\end{enumerate}
\end{definition}

\noindent
Here is the analogue of Categories,
Lemma \ref{categories-lemma-characterize-representable-fibred-category}.

\begin{lemma}
\label{lemma-characterize-representable-by-space}
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
Let $p : \mathcal{X} \to (\textit{Sch}/S)_{fppf}$
be a category fibred in groupoids.
Then $\mathcal{X}$ is representable by an algebraic space over $S$
if and only if the following conditions are satisfied:
\begin{enumerate}
\item $\mathcal{S}$ is fibred in setoids\footnote{This means that
it is fibred in groupoids and objects in the fibre categories
have no nontrivial automorphisms, see Categories,
Definition \ref{categories-definition-category-fibred-sets}.}, and
\item the presheaf $U \mapsto \text{Ob}(\mathcal{S}_U)/\cong$ is
an algebraic space.
\end{enumerate}
\end{lemma}

\begin{proof}
Omitted, but see Categories,
Lemma \ref{categories-lemma-characterize-representable-fibred-category}.
\end{proof}

\noindent
Here is the analogue of Categories,
Lemma \ref{categories-lemma-criterion-representable-map-stack-in-groupoids}.

\begin{lemma}
\label{lemma-criterion-map-representable-spaces-fibred-in-groupoids}
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
Let $\mathcal{X}$, $\mathcal{Y}$ be categories fibred in groupoids
over $(\textit{Sch}/S)_{fppf}$.
Let $F : \mathcal{X} \to \mathcal{Y}$ be a $1$-morphism.
Assume
\begin{enumerate}
\item for each scheme $U/S$ the
functor $F_U : \mathcal{X}_U \longrightarrow \mathcal{Y}_U$
between fibre categories is faithful, and
\item for each $U$ and each $y \in \mathcal{Y}_U$ the presheaf
$$
(f : V \to U)
\longmapsto
\{(x, \phi) \mid x \in \mathcal{X}_V, \phi : f^*y \to F(x)\}/\cong
$$
is an algebraic space over $U$.
\end{enumerate}
Then $F$ is representable by algebraic spaces.
\end{lemma}

\begin{proof}
Clear from the description of fibre categories in
Categories, Lemma \ref{categories-lemma-identify-fibre-product}
and Lemma \ref{lemma-characterize-representable-by-space}.
\end{proof}

\noindent
Here are some lemmas about this notion that work in great generality.

\begin{lemma}
\label{lemma-morphism-spaces-gives-representable-by-spaces}
Let $S$ be an object of $\textit{Sch}_{fppf}$.
Let $f : \mathcal{X} \to \mathcal{Y}$
be a $1$-morphism of categories fibred in groupoids over $S$.
If $\mathcal{X}$ and $\mathcal{Y}$ are representable by
algebraic spaces over $S$, then the $1$-morphism $f$
is representable by algebraic spaces.
\end{lemma}

\begin{proof}
Omitted. This relies only on the fact that
the category of algebraic spaces over $S$ has fibre products,
see Spaces, Lemma \ref{spaces-lemma-fibre-product-spaces}.
\end{proof}

\begin{lemma}
\label{lemma-base-change-by-space-representable-by-space}
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
Let $\mathcal{X}, \mathcal{Y}, \mathcal{Z}$
be categories fibred in groupoids over $(\textit{Sch}/S)_{fppf}$
Let $f : \mathcal{X} \to \mathcal{Y}$,
$g : \mathcal{Z} \to \mathcal{Y}$ be $1$-morphisms.
Assume
\begin{enumerate}
\item $f$ is representable by algebraic spaces, and
\item $\mathcal{Z}$ is representable by an algebraic space over $S$.
\end{enumerate}
Then the $2$-fibre product
$\mathcal{Z} \times_{g, \mathcal{Y}, f} \mathcal{X}$
is representable by an algebraic space.
\end{lemma}

\begin{proof}
The proof relies on
Spaces, Lemma \ref{spaces-lemma-representable-by-spaces-over-space}.
Namely, first you show that
$\mathcal{Z} \times_{g, \mathcal{Y}, f} \mathcal{X}$
is fibred in setoids over $(\textit{Sch}/S)_{fppf}$.
Hence it is equivalent to $\mathcal{S}_F$ for some presheaf
$F$ on $(\textit{Sch}/S)_{fppf}$, see
Categories, Lemma \ref{categories-lemma-setlike-fibres}.
Moreover, let $G$ be the algebraic space such that
$\mathcal{Z}$ is equivalent to $\mathcal{S}_G$. Then the
$1$-morphism
$\mathcal{Z} \times_{g, \mathcal{Y}, f} \mathcal{X} \to \mathcal{Z}$
comes from a unique morphism $F \to G$ (by looking at isomorphism
classes of objects in fibre categories). This morphism is representable
by algebraic spaces, and hence 
Spaces, Lemma \ref{spaces-lemma-representable-by-spaces-over-space}
applies. Some details omitted.
\end{proof}

\begin{lemma}
\label{lemma-composition-representable-by-spaces}
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
Let $\mathcal{X}, \mathcal{Y}, \mathcal{Z}$
be categories fibred in groupoids over $(\textit{Sch}/S)_{fppf}$
If $f : \mathcal{X} \to \mathcal{Y}$, $g : \mathcal{Y} \to \mathcal{Z}$
are $1$-morphisms representable by algebraic spaces, then
$$
g \circ f : \mathcal{X} \longrightarrow \mathcal{Z}
$$
is a $1$-morphism representable by algebraic spaces.
\end{lemma}

\begin{proof}
This follows from
Lemma \ref{lemma-base-change-by-space-representable-by-space}.
Details omitted.
\end{proof}

\begin{lemma}
\label{lemma-base-change-representable-by-spaces}
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
Let $\mathcal{X}, \mathcal{Y}, \mathcal{Z}$
be categories fibred in groupoids over $(\textit{Sch}/S)_{fppf}$
Let $f : \mathcal{X} \to \mathcal{Y}$ be a $1$-morphism
representable by algebraic spaces.
Let $g : \mathcal{Z} \to \mathcal{Y}$ be any $1$-morphism.
Consider the fibre product diagram
$$
\xymatrix{
\mathcal{Z} \times_{g, \mathcal{Y}, f} \mathcal{X} \ar[r]_-{g'} \ar[d]_{f'} &
\mathcal{X} \ar[d]^f \\
\mathcal{Z} \ar[r]^g & \mathcal{Y}
}
$$
Then the base change $f'$ is a $1$-morphism representable by
algebraic spaces.
\end{lemma}

\begin{proof}
This is formal.
\end{proof}

\begin{lemma}
\label{lemma-product-representable-by-spaces}
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
Let $\mathcal{X}_i, \mathcal{Y}_i$ be categories fibred in groupoids over
$(\textit{Sch}/S)_{fppf}$, $i = 1, 2$.
Let $f_i : \mathcal{X}_i \to \mathcal{Y}_i$, $i = 1, 2$
be $1$-morphisms representable by algebraic spaces.
Then
$$
f_1 \times f_2 :
\mathcal{X}_1 \times \mathcal{X}_2
\longrightarrow
\mathcal{Y}_1 \times \mathcal{Y}_2
$$
is a $1$-morphism representable by algebraic spaces.
\end{lemma}

\begin{proof}
Write $f_1 \times f_2$ as the composition
$\mathcal{X}_1 \times \mathcal{X}_2 \to
\mathcal{Y}_1 \times \mathcal{X}_2 \to
\mathcal{Y}_1 \times \mathcal{Y}_2$.
The first arrow is the base change of $f_1$ by the map
$\mathcal{Y}_1 \times \mathcal{X}_2 \to \mathcal{Y}_1$, and the second arrow
is the base change of $f_2$ by the map
$\mathcal{Y}_1 \times \mathcal{Y}_2 \to \mathcal{Y}_2$.
Hence this lemma is a formal
consequence of Lemmas \ref{lemma-composition-representable-by-spaces}
and \ref{lemma-base-change-representable-by-spaces}.
\end{proof}




























\section{Stacks}
\label{section-stacks}

\noindent
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
Recall that a category $p : \mathcal{X} \to (\textit{Sch}/S)_{fppf}$
over $(\textit{Sch}/S)_{fppf}$ is said to be a
{\it stack in groupoids} (see
Stacks, Definition \ref{stacks-definition-stack-in-groupoids})
if and only if
\begin{enumerate}
\item $p : \mathcal{X} \to \mathcal{C}$ is fibred
in groupoids over $(\textit{Sch}/S)_{fppf}$,
\item for all $U \in \text{Ob}((\textit{Sch}/S)_{fppf})$,
for all $x, y\in \text{Ob}(\mathcal{X}_U)$ the presheaf
$\mathit{Isom}(x, y)$ is a sheaf on the site $(\textit{Sch}/S)_{fppf}$, and
\item for all coverings $\mathcal{U} = \{U_i \to U\}$ in
$(\textit{Sch}/S)_{fppf}$, all descent data $(x_i, \phi_{ij})$
for $\mathcal{U}$ are effective.
\end{enumerate}
As this may be a new notion we give some examples.

\begin{example}
\label{example-stack-associated-to-sheaf}


\end{example}
































































\section{Algebraic stacks}
\label{section-algebraic-stacks}

\begin{definition}
\label{definition-algebraic-stack}
Let $S$ be a base scheme contained in $\textit{Sch}_{fppf}$.
An {\it algebraic stack over $S$} is a category
$$
p : \mathcal{X} \to (\textit{Sch}/S)_{fppf}
$$
over $(\textit{Sch}/S)_{fppf}$ with the following properties:
\begin{enumerate}
\item The category $\mathcal{X}$ is a stack in groupoids over
$(\textit{Sch}/S)_{fppf}$.
\item The diagonal
$\Delta : \mathcal{X} \to \mathcal{X}\times\mathcal{X}$
is representable by algebraic spaces.
\item There exists a scheme $U \in \text{Ob}((\textit{Sch}/S)_{fppf})$
and a $1$-morphism $U \to \mathcal{X}$ which is surjective and etale.
\end{enumerate}
\end{definition}

\input{chapters}

\bibliography{my}
\bibliographystyle{alpha}

\end{document}
