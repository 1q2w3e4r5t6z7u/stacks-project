\input{preamble}

% OK, start here.
%
\begin{document}

\title{Algebraic stacks}


\maketitle

\phantomsection
\label{section-phantom}

\tableofcontents

\section{Introduction}
\label{section-introduction}

\noindent
This is where we define algebraic stacks and make some very elementary
observations. The general philosophy will be to have no separation
conditions whatsoever and add those conditions necessary to make lemmas,
propositions, theorems true/provable. Thus the notions discussed here
differ slightly from those in other places in the literature, e.g.,
\cite{LM-B}.



\section{Conventions}
\label{section-conventions}

\noindent
The conventions we use in this chapter are the same as those in the
chapter on algebraic spaces. For convenience we repeat them here.

\medskip\noindent
We work in a suitable big fppf site $\textit{Sch}_{fppf}$
as in Topologies, Definition \ref{topologies-definition-big-fppf-site}.
So, if not explicitly stated otherwise all schemes will be objects
of $\textit{Sch}_{fppf}$.
We will record elsewhere what changes if you change the big
fppf site (insert future reference here).

\medskip\noindent
We will always work relative to a base $S$ contained in $\textit{Sch}_{fppf}$.
And we will then work with the big fppf site $(\textit{Sch}/S)_{fppf}$,
see Topologies, Definition \ref{topologies-definition-big-small-fppf}.
The absolute case can be recovered by taking
$S = \text{Spec}(\mathbf{Z})$.

\medskip\noindent
If $U, T$ are schemes over $S$, then we denote
$U(T)$ for the set of $T$-valued points {\it over} $S$.
In a formula: $U(T) = \text{Mor}_S(T, U)$.

\medskip\noindent
Note that any fpqc covering is a universal effective
epimorphism, see
Descent, Lemma \ref{descent-lemma-fpqc-universal-effective-epimorphisms}.
Hence the topology on $\textit{Sch}_{fppf}$
is weaker than the canonical topology and all representable presheaves
are sheaves.








\section{Notation}
\label{section-notation}

\noindent
We use the letters $S, T, U, V, X, Y$ to indicate schemes.
We use the letters $\mathcal{X}, \mathcal{Y}, \mathcal{Z}$ to indicate
categories (fibred, fibred in groupoids, stacks,...)
over $(\textit{Sch}/S)_{fppf}$. We use small case letters
$f$, $g$ for functors such as $f : \mathcal{X} \to \mathcal{Y}$
over $(\textit{Sch}/S)_{fppf}$.
We use capital $F$, $G$, $H$ for algebraic spaces over $S$, and more
generally for presheaves of sets on $(\textit{Sch}/S)_{fppf}$.
(In future chapters we will revert to using also $X$, $Y$, etc
for algebraic spaces.)

\medskip\noindent
The reason for these choices is that we want to clearly distinguish between
the different types of objects in this chapter, to build the foundations.









\section{Representable categories fibred in groupoids}
\label{section-representable}

\noindent
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
The basic object of study in this chapter will be a
category fibred in groupoids
$p : \mathcal{X} \to (\textit{Sch}/S)_{fppf}$, see
Categories, Definition \ref{categories-definition-fibred-groupoids}.
We will often simply say ``let $\mathcal{X}$ be a category fibred
in groupoids over $(\textit{Sch}/S)_{fppf}$'' to indicate
this situation. A $1$-morphism $\mathcal{X} \to \mathcal{Y}$ of categories
in groupoids over $(\textit{Sch}/S)_{fppf}$ will be a $1$-morphism
in the $2$-category of categories fibred in groupoids over
$(\textit{Sch}/S)_{fppf}$, see
Categories,
Definition \ref{categories-definition-categories-fibred-in-groupoids-over-C}.
It is simply a functor $\mathcal{X} \to \mathcal{Y}$ over
$(\textit{Sch}/S)_{fppf}$.
We recall this is really a $(2, 1)$-category and that all $2$-fibre products
exist.

\medskip\noindent
Let $\mathcal{X}$ be a category fibred in groupoids over
$(\textit{Sch}/S)_{fppf}$. Recall that $\mathcal{X}$
is said to be {\it representable} if there exists a
scheme $U \in \text{Ob}((\textit{Sch}/S)_{fppf})$ and an
equivalence
$$
j : \mathcal{X} \longrightarrow (\textit{Sch}/U)_{fppf}
$$
of categories over $(\textit{Sch}/S)_{fppf}$, see
Categories,
Definition \ref{categories-definition-representable-fibred-category}.
We will sometimes say that $\mathcal{X}$ is
{\it representable by a scheme} to distinguish from the case
where $\mathcal{X}$ is representable by an algebraic space (see
below).

\medskip\noindent
If $\mathcal{X}, \mathcal{Y}$ are fibred in groupoids and
representable by $U, V$, then we have
\begin{equation}
\label{equation-morphisms-schemes}
\text{Mor}_{\textit{Cat}/(\textit{Sch}/S)_{fppf}}(\mathcal{X}, \mathcal{Y})
\Big/
2\text{-isomorphism}
=
\text{Mor}_{\textit{Sch}/S}(U, V)
\end{equation}
see
Categories,
Lemma \ref{categories-lemma-morphisms-representable-fibred-categories}.
More precisely, any $1$-morphism $\mathcal{X} \to \mathcal{Y}$
gives rise to a morphism $U \to V$. Conversely, given a morphism
of schemes $U \to V$ over $S$ there exists a $1$-morphism
$\phi : \mathcal{X} \to \mathcal{Y}$ which gives rise to $U \to V$
and which is unique up to unique $2$-isomorphism.






\section{The 2-Yoneda lemma}
\label{section-2-yoneda}

\noindent
Let $U \in \text{Ob}((\textit{Sch}/S)_{fppf})$, and let $\mathcal{X}$ be a
category fibred in groupoids over $(\textit{Sch}/S)_{fppf}$.
We will frequently use the $2$-Yoneda lemma, see
Categories, Lemma \ref{categories-lemma-yoneda-2category}.
Technically it says that there is an equivalence of categories
$$
\text{Mor}_{\textit{Cat}/(\textit{Sch}/S)_{fppf}}(
(\textit{Sch}/U)_{fppf}, \mathcal{X})
\longrightarrow
\mathcal{X}_U, \quad
f \longmapsto f(U/U).
$$
It says that $1$-morphisms $(\textit{Sch}/U)_{fppf} \to \mathcal{X}$
correspond to objects $x$ of the fibre category $\mathcal{X}_U$.
Namely, given a $1$-morphism $f : (\textit{Sch}/U)_{fppf} \to \mathcal{X}$
we obtain the object $x = f(U/U) \in \text{Ob}(\mathcal{X}_U)$.
Conversely, given a choice of pullbacks for $\mathcal{X}$ as in
Categories,
Definition \ref{categories-definition-pullback-functor-fibred-category},
and an object $x$ of $\mathcal{X}_U$, we obtain a functor
$(\textit{Sch}/U)_{fppf} \to \mathcal{X}$ defined by the rule
$$
(\varphi : V \to U) \longmapsto \varphi^*x
$$
on objects. By abuse of notation we use
$x : (\textit{Sch}/U)_{fppf} \to \mathcal{X}$
to indicate this functor. It indeed has the property that $x(U/U) = x$
and moreover, given any other functor $f$ with $f(U/U) = x$ there exists
a unique $2$-isomorphism $x \to f$. In other words the functor $x$
is well determined by the object $x$ up to unique $2$-isomorphism.

\medskip\noindent
We will use this without further mention in the following.





\section{Representable morphisms of categories fibred in groupoids}
\label{section-representable-morphism}


\noindent
Let $\mathcal{X}$, $\mathcal{Y}$ be categories fibred in groupoids
over $(\textit{Sch}/S)_{fppf}$. Let $f : \mathcal{X} \to \mathcal{Y}$
be a {\it representable $1$-morphism}, see
Categories, Definition
\ref{categories-definition-representable-map-categories-fibred-in-groupoids}.
This means that for every $U \in \text{Ob}((\textit{Sch}/S)_{fppf})$ and
any $y \in \text{Ob}(\mathcal{Y}_U)$ the $2$-fibre product
$(\textit{Sch}/U)_{fppf} \times_{y, \mathcal{Y}} \mathcal{X}$
is representable. Choose a representing object $V_y$ and an equivalence
$$
(\textit{Sch}/V_y)_{fppf}
\longrightarrow
(\textit{Sch}/U)_{fppf} \times_{y, \mathcal{Y}} \mathcal{X}.
$$
The projection
$(\textit{Sch}/V_y)_{fppf} \to
(\textit{Sch}/U)_{fppf} \times_\mathcal{Y} \mathcal{Y}
\to (\textit{Sch}/U)_{fppf}$
comes from a morphism of schemes $f_y : V_y \to U$, see
Section \ref{section-representable}. We represent this by the diagram
\begin{equation}
\label{equation-representable}
\vcenter{
\xymatrix{
V_y \ar@{~>}[r] \ar[d]_{f_y} &
(\textit{Sch}/V_y)_{fppf} \ar[d] \ar[r] &
\mathcal{X} \ar[d]^f \\
U \ar@{~>}[r] &
(\textit{Sch}/U)_{fppf} \ar[r]^-y &
\mathcal{Y}
}
}
\end{equation}
where the squiggly arrows represent the $2$-Yoneda embedding.
Here are some lemmas about this notion that work in great generality
(namely, they work for categories fibred in groupoids over any
base category which has fibre products).

\begin{lemma}
\label{lemma-morphism-schemes-gives-representable-transformation}
Let $S$, $X$, $Y$ be objects of $\textit{Sch}_{fppf}$.
Let $f : X \to Y$ be a morphism of schemes.
Then the $1$-morphism induced by $f$
$$
(\textit{Sch}/X)_{fppf} \longrightarrow (\textit{Sch}/Y)_{fppf}
$$
is a representable $1$-morphism.
\end{lemma}

\begin{proof}
This is formal and relies only on the fact that
the category $(\textit{Sch}/S)_{fppf}$ has fibre products.
\end{proof}

\begin{lemma}
\label{lemma-representable-morphism-equivalent}
Let $S$ be an object of $\textit{Sch}_{fppf}$.
Consider a $2$-commutative diagram
$$
\xymatrix{
\mathcal{X}' \ar[r] \ar[d]_{f'} & \mathcal{X} \ar[d]^f \\
\mathcal{Y}' \ar[r] & \mathcal{Y}
}
$$
of $1$-morphisms of categories fibred in groupoids over
$(\textit{Sch}/S)_{fppf}$.
Assume the horizontal arrows are equivalences.
Then $f$ is representable if and only if $f'$ is representable.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-composition-representable-transformations}
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
Let $\mathcal{X}, \mathcal{Y}, \mathcal{Z}$
be categories fibred in groupoids over $(\textit{Sch}/S)_{fppf}$
Let $f : \mathcal{X} \to \mathcal{Y}$, $g : \mathcal{Y} \to \mathcal{Z}$
be representable $1$-morphisms. Then
$$
g \circ f : \mathcal{X} \longrightarrow \mathcal{Z}
$$
is a representable $1$-morphism.
\end{lemma}

\begin{proof}
This is entirely formal and works in any category.
\end{proof}

\begin{lemma}
\label{lemma-base-change-representable-transformations}
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
Let $\mathcal{X}, \mathcal{Y}, \mathcal{Z}$
be categories fibred in groupoids over $(\textit{Sch}/S)_{fppf}$
Let $f : \mathcal{X} \to \mathcal{Y}$ be a representable $1$-morphism.
Let $g : \mathcal{Z} \to \mathcal{Y}$ be any $1$-morphism.
Consider the fibre product diagram
$$
\xymatrix{
\mathcal{Z} \times_{g, \mathcal{Y}, f} \mathcal{X} \ar[r]_-{g'} \ar[d]_{f'} &
\mathcal{X} \ar[d]^f \\
\mathcal{Z} \ar[r]^g & \mathcal{Y}
}
$$
Then the base change $f'$ is a representable $1$-morphism.
\end{lemma}

\begin{proof}
This is entirely formal and works in any category.
\end{proof}

\begin{lemma}
\label{lemma-product-representable-transformations}
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
Let $\mathcal{X}_i, \mathcal{Y}_i$ be categories fibred in groupoids over
$(\textit{Sch}/S)_{fppf}$, $i = 1, 2$.
Let $f_i : \mathcal{X}_i \to \mathcal{Y}_i$, $i = 1, 2$
be representable $1$-morphisms.
Then
$$
f_1 \times f_2 :
\mathcal{X}_1 \times \mathcal{X}_2
\longrightarrow
\mathcal{Y}_1 \times \mathcal{Y}_2
$$
is a representable $1$-morphism.
\end{lemma}

\begin{proof}
Write $f_1 \times f_2$ as the composition
$\mathcal{X}_1 \times \mathcal{X}_2 \to
\mathcal{Y}_1 \times \mathcal{X}_2 \to
\mathcal{Y}_1 \times \mathcal{Y}_2$.
The first arrow is the base change of $f_1$ by the map
$\mathcal{Y}_1 \times \mathcal{X}_2 \to \mathcal{Y}_1$, and the second arrow
is the base change of $f_2$ by the map
$\mathcal{Y}_1 \times \mathcal{Y}_2 \to \mathcal{Y}_2$.
Hence this lemma is a formal
consequence of Lemmas \ref{lemma-composition-representable-transformations}
and \ref{lemma-base-change-representable-transformations}.
\end{proof}



\section{Categories fibred in groupoids which are split}
\label{section-split}

\noindent
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
Recall that given a presheaf
$$
F : (\textit{Sch}/S)_{fppf}^{opp} \longrightarrow \textit{Groupoids}
$$
we get a category fibred in groupoids $\mathcal{S}_F$ over
$(\textit{Sch}/S)_{fppf}$, see
Categories, Example \ref{categories-example-functor-groupoids}.
Any category fibred in groupoids isomorphic (!) to one of these
is called a {\it split category fibred in groupoids}.
Any category fibred in groupoids is equivalent to a split one.

\medskip\noindent
If $F$ is a presheaf of sets then $\mathcal{S}_F$ is
fibred in sets (see
Categories,
Definition \ref{categories-definition-category-fibred-sets}).
The rule $F \mapsto \mathcal{S}_F$ is compatible with maps, see
Categories, Lemma \ref{categories-lemma-2-category-fibred-sets}.
If $F \to G$ and $H \to G$ are maps of presheaves of sets, then
$$
\mathcal{S}_{F \times_G H} =
\mathcal{S}_F \times_{\mathcal{S}_G} \mathcal{S}_H
$$
where the right hand side is the $2$-fibre product; this is immediate
from the definitions as the fibre categories of
$\mathcal{S}_F, \mathcal{S}_G, \mathcal{S}_H$ have only identity morphisms.

\medskip\noindent
An even more special case is where $F = h_X$ is a representable
presheaf. In this case we have $\mathcal{S}_F = (\textit{Sch}/X)_{fppf}$. See
Categories,
Example \ref{categories-example-fibred-category-from-functor-of-points}.

\medskip\noindent
We will use the notation $\mathcal{S}_F$ without further mention in the
following.




\section{Categories fibred in groupoids representable by algebraic spaces}
\label{section-representable-by-algebraic-spaces}

\noindent
A slightly weaker notion than being representable is the notion of
being representable by algebraic spaces which we discuss in this section.
This discussion might have been avoided had we worked with some category
$\textit{Spaces}_{fppf}$ of algebraic spaces instead of the category
$\textit{Sch}_{fppf}$. However, it seems to us natural to consider the
category of schemes as the natural collection of ``test objects'' over
which the fibre categories of an algebraic stack are defined.

\medskip\noindent
In analogy with Categories, Definitions
\ref{categories-definition-representable-fibred-category}
we make the following definition.

\begin{definition}
\label{definition-representable-by-algebraic-space}
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
A category fibred in groupoids $p : \mathcal{X} \to (\textit{Sch}/S)_{fppf}$
is called {\it representable by an algebraic space over $S$}
if there exists an algebraic space $F$ over $S$ and an equivalence
$j : \mathcal{X} \to \mathcal{S}_F$
of categories over $(\textit{Sch}/S)_{fppf}$.
\end{definition}

\noindent
We continue our abuse of notation in surpressing the equivalence $j$
whenever we encounter such a situation.
It follows formally from the above that if $\mathcal{X}$ is
representable (by a scheme), then it is representable by an
algebraic space. Here is the analogue of
Categories,
Lemma \ref{categories-lemma-characterize-representable-fibred-category}.

\begin{lemma}
\label{lemma-characterize-representable-by-space}
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
Let $p : \mathcal{X} \to (\textit{Sch}/S)_{fppf}$
be a category fibred in groupoids.
Then $\mathcal{X}$ is representable by an algebraic space over $S$
if and only if the following conditions are satisfied:
\begin{enumerate}
\item $\mathcal{X}$ is fibred in setoids\footnote{This means that
it is fibred in groupoids and objects in the fibre categories
have no nontrivial automorphisms, see Categories,
Definition \ref{categories-definition-category-fibred-sets}.}, and
\item the presheaf $U \mapsto \text{Ob}(\mathcal{X}_U)/\cong$ is
an algebraic space.
\end{enumerate}
\end{lemma}

\begin{proof}
Omitted, but see Categories,
Lemma \ref{categories-lemma-characterize-representable-fibred-category}.
\end{proof}

\noindent
If $\mathcal{X}, \mathcal{Y}$ are fibred in groupoids and
representable by algebraic spaces $F, G$ over $S$, then we have
\begin{equation}
\label{equation-morphisms-spaces}
\text{Mor}_{\textit{Cat}/(\textit{Sch}/S)_{fppf}}(\mathcal{X}, \mathcal{Y})
\Big/
2\text{-isomorphism}
=
\text{Mor}_{\textit{Sch}/S}(F, G)
\end{equation}
see
Categories, Lemma \ref{categories-lemma-2-category-fibred-setoids}.
More precisely, any $1$-morphism $\mathcal{X} \to \mathcal{Y}$
gives rise to a morphism $F \to G$. Conversely, give a morphism
of sheaves $F \to G$ over $S$ there exists a $1$-morphism
$\phi : \mathcal{X} \to \mathcal{Y}$ which gives rise to $F \to G$
and which is unique up to unique $2$-isomorphism.



\section{Morphisms representable by algebraic spaces}
\label{section-morphisms-representable-by-algebraic-spaces}

\noindent
In analogy with Categories, Definition
\ref{categories-definition-representable-map-categories-fibred-in-groupoids}
we make the following definition.

\begin{definition}
\label{definition-representable-by-algebraic-spaces}
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
A $1$-morphism $f : \mathcal{X} \to \mathcal{Y}$ of
categories fibred in groupoids over $(\textit{Sch}/S)_{fppf}$
is called {\it representable by algebraic spaces} if
for any $U \in \text{Ob}((\textit{Sch}/S)_{fppf})$
and any $y : (\textit{Sch}/U)_{fppf} \to \mathcal{Y}$
the category fibred in groupoids
$$
(\textit{Sch}/U)_{fppf} \times_{y, \mathcal{Y}} \mathcal{X}
$$
over $(\textit{Sch}/U)_{fppf}$
is representable by an algebraic space over $U$.
\end{definition}

\noindent
In the situation of
Definition \ref{definition-representable-by-algebraic-spaces} part (2)
choose an algebraic space $F_y$ over $U$ which represents
$(\textit{Sch}/U)_{fppf} \times_{y, \mathcal{Y}} \mathcal{X}$.
We may think of $F_y$ as an algebraic stack over $S$
which comes equipped with a canonical morphism $f_y : F_y \to U$
over $S$, see
Spaces, Section \ref{spaces-section-change-base-scheme}.
Here is the diagram
\begin{equation}
\label{equation-representable-by-algebraic-spaces}
\vcenter{
\xymatrix{
F_y \ar[d]_{f_y} &
(\textit{Sch}/U)_{fppf} \times_{y, \mathcal{Y}} \mathcal{X}
\ar@{~>}[l] \ar[d]_{\text{pr}_0} \ar[r]_-{\text{pr}_1} &
\mathcal{X} \ar[d]^f \\
U &
(\textit{Sch}/U)_{fppf} \ar@{~>}[l] \ar[r]^-y &
\mathcal{Y}
}
}
\end{equation}
where the squiggly arrows represent the construction which associates
to a stack fibred in setoids its associated sheaf of isomorphism classes
of objects. The right square is
$2$-commutative, and is a $2$-fibre product square.

\medskip\noindent
Here is the analogue of Categories,
Lemma \ref{categories-lemma-criterion-representable-map-stack-in-groupoids}.

\begin{lemma}
\label{lemma-criterion-map-representable-spaces-fibred-in-groupoids}
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
Let $\mathcal{X}$, $\mathcal{Y}$ be categories fibred in groupoids
over $(\textit{Sch}/S)_{fppf}$.
Let $f : \mathcal{X} \to \mathcal{Y}$ be a $1$-morphism.
Make a choice of pullbacks for $\mathcal{Y}$.
Assume
\begin{enumerate}
\item for each scheme $U/S$ the
functor $f_U : \mathcal{X}_U \longrightarrow \mathcal{Y}_U$
between fibre categories is faithful, and
\item for each $U$ and each $y \in \text{Ob}(\mathcal{Y}_U)$ the presheaf
$$
(h : V \to U)
\longmapsto
\{(x, \phi) \mid x \in \text{Ob}(\mathcal{X}_V), \phi : h^*y \to f(x)\}/\cong
$$
is an algebraic space over $U$.
\end{enumerate}
Then $f$ is representable by algebraic spaces.
\end{lemma}

\begin{proof}
Clear from the description of fibre categories in
Categories, Lemma \ref{categories-lemma-identify-fibre-product}
and Lemma \ref{lemma-characterize-representable-by-space}.
\end{proof}

\noindent
Here are some lemmas about this notion that work in great generality.

\begin{lemma}
\label{lemma-representable-by-spaces-morphism-equivalent}
Let $S$ be an object of $\textit{Sch}_{fppf}$.
Consider a $2$-commutative diagram
$$
\xymatrix{
\mathcal{X}' \ar[r] \ar[d]_{f'} & \mathcal{X} \ar[d]^f \\
\mathcal{Y}' \ar[r] & \mathcal{Y}
}
$$
of $1$-morphisms of categories fibred in groupoids over
$(\textit{Sch}/S)_{fppf}$.
Assume the horizontal arrows are equivalences.
Then $f$ is representable by algebraic spaces
if and only if $f'$ is representable by algebraic spaces.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-morphism-spaces-gives-representable-by-spaces}
Let $S$ be an object of $\textit{Sch}_{fppf}$.
Let $f : \mathcal{X} \to \mathcal{Y}$
be a $1$-morphism of categories fibred in groupoids over $S$.
If $\mathcal{X}$ and $\mathcal{Y}$ are representable by
algebraic spaces over $S$, then the $1$-morphism $f$
is representable by algebraic spaces.
\end{lemma}

\begin{proof}
Omitted. This relies only on the fact that
the category of algebraic spaces over $S$ has fibre products,
see Spaces, Lemma \ref{spaces-lemma-fibre-product-spaces}.
\end{proof}

\begin{lemma}
\label{lemma-map-presheaves-representable-by-algebraic-spaces}
Let $S$ be an object of $\textit{Sch}_{fppf}$.
Let $a : F \to G$ be a map of presehaves of sets on $(\textit{Sch}/S)_{fppf}$.
Denote $a' : \mathcal{S}_F  \to \mathcal{S}_G$ the associated
map of categories fibred in sets.
Then $a$ is representable by algebraic spaces (see
Bootstrap,
Definition \ref{bootstrap-definition-morphism-representable-by-spaces})
if and only if $a'$ is representable by algebraic spaces.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-map-fibred-setoids-representable-algebraic-spaces}
Let $S$ be an object of $\textit{Sch}_{fppf}$.
Let $f : \mathcal{X} \to \mathcal{Y}$ be a $1$-morphism of
categories fibred in setoids over $(\textit{Sch}/S)_{fppf}$.
Let $F$, resp.\ $G$ be the presheaf which to $T$ associates
the set of isomorphism classes of objects of
$\mathcal{X}_T$, resp.\ $\mathcal{Y}_T$.
Let $a : F \to G$ be the map of presheaves corresponding to $f$.
Then $a$ is representable by algebraic spaces (see
Bootstrap,
Definition \ref{bootstrap-definition-morphism-representable-by-spaces})
if and only if $f$ is representable by algebraic spaces.
\end{lemma}

\begin{proof}
Omitted. Hint: Combine
Lemmas \ref{lemma-representable-by-spaces-morphism-equivalent}
and \ref{lemma-map-presheaves-representable-by-algebraic-spaces}.
\end{proof}


\begin{lemma}
\label{lemma-base-change-representable-by-spaces}
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
Let $\mathcal{X}, \mathcal{Y}, \mathcal{Z}$
be categories fibred in groupoids over $(\textit{Sch}/S)_{fppf}$.
Let $f : \mathcal{X} \to \mathcal{Y}$ be a $1$-morphism
representable by algebraic spaces.
Let $g : \mathcal{Z} \to \mathcal{Y}$ be any $1$-morphism.
Consider the fibre product diagram
$$
\xymatrix{
\mathcal{Z} \times_{g, \mathcal{Y}, f} \mathcal{X} \ar[r]_-{g'} \ar[d]_{f'} &
\mathcal{X} \ar[d]^f \\
\mathcal{Z} \ar[r]^g & \mathcal{Y}
}
$$
Then the base change $f'$ is a $1$-morphism representable by
algebraic spaces.
\end{lemma}

\begin{proof}
This is formal.
\end{proof}

\begin{lemma}
\label{lemma-base-change-by-space-representable-by-space}
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
Let $\mathcal{X}, \mathcal{Y}, \mathcal{Z}$
be categories fibred in groupoids over $(\textit{Sch}/S)_{fppf}$
Let $f : \mathcal{X} \to \mathcal{Y}$,
$g : \mathcal{Z} \to \mathcal{Y}$ be $1$-morphisms.
Assume
\begin{enumerate}
\item $f$ is representable by algebraic spaces, and
\item $\mathcal{Z}$ is representable by an algebraic space over $S$.
\end{enumerate}
Then the $2$-fibre product
$\mathcal{Z} \times_{g, \mathcal{Y}, f} \mathcal{X}$
is representable by an algebraic space.
\end{lemma}

\begin{proof}
This is a reformulation of
Bootstrap, Lemma \ref{bootstrap-lemma-representable-by-spaces-over-space}.
First note that
$\mathcal{Z} \times_{g, \mathcal{Y}, f} \mathcal{X}$
is fibred in setoids over $(\textit{Sch}/S)_{fppf}$.
Hence it is equivalent to $\mathcal{S}_F$ for some presheaf
$F$ on $(\textit{Sch}/S)_{fppf}$, see
Categories, Lemma \ref{categories-lemma-setoid-fibres}.
Moreover, let $G$ be an algebraic space which represents
$\mathcal{Z}$. The $1$-morphism
$\mathcal{Z} \times_{g, \mathcal{Y}, f} \mathcal{X} \to \mathcal{Z}$
is representable by algebraic spaces by
Lemma \ref{lemma-base-change-representable-by-spaces}.
And $\mathcal{Z} \times_{g, \mathcal{Y}, f} \mathcal{X} \to \mathcal{Z}$
corresponds to a morphism $F \to G$ by
Categories, Lemma \ref{categories-lemma-2-category-fibred-setoids}.
Then $F \to G$ is representable by algebraic spaces by
Lemma \ref{lemma-map-fibred-setoids-representable-algebraic-spaces}.
Hence 
Bootstrap, Lemma \ref{bootstrap-lemma-representable-by-spaces-over-space}
implies that $F$ is an algebraic space as desired.
\end{proof}

\noindent
Let $S$, $\mathcal{X}$, $\mathcal{Y}$, $\mathcal{Z}$, $f$, $g$ be as in
Lemma \ref{lemma-base-change-by-space-representable-by-space}.
Let $F$ and $G$ be algebraic spaces over $S$ such that
$F$ represents $\mathcal{Z} \times_{g, \mathcal{Y}, f} \mathcal{X}$
and $G$ represents $\mathcal{Z}$. The $1$-morphism
$f' : \mathcal{Z} \times_{g, \mathcal{Y}, f} \mathcal{X} \to \mathcal{Z}$
corresponds to a morphism $f' : F \to G$ of algebraic spaces
by (\ref{equation-morphisms-spaces}).
Thus we have the following diagram
\begin{equation}
\label{equation-representable-by-algebraic-spaces-on-space}
\vcenter{
\xymatrix{
F \ar[d]_{f'} &
\mathcal{Z} \times_{g, \mathcal{Y}, f} \mathcal{X}
\ar@{~>}[l] \ar[d] \ar[r] &
\mathcal{X} \ar[d]^f \\
G &
\mathcal{Z} \ar@{~>}[l] \ar[r]^-g &
\mathcal{Y}
}
}
\end{equation}
where the squiggly arrows represent the construction which associates
to a stack fibred in setoids its associated sheaf of isomorphism classes
of objects. The middle square is
$2$-commutative with equivalences as horizontal arrows.

\begin{lemma}
\label{lemma-composition-representable-by-spaces}
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
Let $\mathcal{X}, \mathcal{Y}, \mathcal{Z}$
be categories fibred in groupoids over $(\textit{Sch}/S)_{fppf}$.
If $f : \mathcal{X} \to \mathcal{Y}$, $g : \mathcal{Y} \to \mathcal{Z}$
are $1$-morphisms representable by algebraic spaces, then
$$
g \circ f : \mathcal{X} \longrightarrow \mathcal{Z}
$$
is a $1$-morphism representable by algebraic spaces.
\end{lemma}

\begin{proof}
This follows from
Lemma \ref{lemma-base-change-by-space-representable-by-space}.
Details omitted.
\end{proof}

\begin{lemma}
\label{lemma-product-representable-by-spaces}
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
Let $\mathcal{X}_i, \mathcal{Y}_i$ be categories fibred in groupoids over
$(\textit{Sch}/S)_{fppf}$, $i = 1, 2$.
Let $f_i : \mathcal{X}_i \to \mathcal{Y}_i$, $i = 1, 2$
be $1$-morphisms representable by algebraic spaces.
Then
$$
f_1 \times f_2 :
\mathcal{X}_1 \times \mathcal{X}_2
\longrightarrow
\mathcal{Y}_1 \times \mathcal{Y}_2
$$
is a $1$-morphism representable by algebraic spaces.
\end{lemma}

\begin{proof}
Write $f_1 \times f_2$ as the composition
$\mathcal{X}_1 \times \mathcal{X}_2 \to
\mathcal{Y}_1 \times \mathcal{X}_2 \to
\mathcal{Y}_1 \times \mathcal{Y}_2$.
The first arrow is the base change of $f_1$ by the map
$\mathcal{Y}_1 \times \mathcal{X}_2 \to \mathcal{Y}_1$, and the second arrow
is the base change of $f_2$ by the map
$\mathcal{Y}_1 \times \mathcal{Y}_2 \to \mathcal{Y}_2$.
Hence this lemma is a formal
consequence of Lemmas \ref{lemma-composition-representable-by-spaces}
and \ref{lemma-base-change-representable-by-spaces}.
\end{proof}









\section{Properties of morphisms representable by algebraic spaces}
\label{section-representable-properties}

\noindent
Here is the definition that makes this work.

\begin{definition}
\label{definition-relative-representable-property}
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
Let $f : \mathcal{X} \to \mathcal{Y}$ be a $1$-morphism
of categories fibred in groupoids over $(\textit{Sch}/S)_{fppf}$.
Assume $f$ is representable by algebraic spaces.
Let $\mathcal{P}$ be a property of morphisms of algebraic spaces which
\begin{enumerate}
\item is preserved under any base change, and
\item is fppf local on the base, see
Descent and Spaces,
Definition \ref{spaces-descent-definition-property-morphisms-local}.
\end{enumerate}
In this case we say that $f$ has {\it property $\mathcal{P}$} if for every
$U \in \text{Ob}((\textit{Sch}/S)_{fppf})$ and
any $y \in \mathcal{Y}_U$ the resulting morphism of algebraic spaces
$f_y : F_y \to U$, see
diagram (\ref{equation-representable-by-algebraic-spaces}),
has property $\mathcal{P}$.
\end{definition}

\noindent
It is important to note that we will only use this definition for
properties of morphisms that are stable under base change, and
local in the fppf topology on the target. This is
not because the definition doesn't make sense otherwise; rather it
is because we may want to give a different definition which is
better suited to the property we have in mind.

\begin{lemma}
\label{lemma-property-morphism-equivalent}
Let $S$ be an object of $\textit{Sch}_{fppf}$.
Let $\mathcal{P}$ be as in
Definition \ref{definition-relative-representable-property}.
Consider a $2$-commutative diagram
$$
\xymatrix{
\mathcal{X}' \ar[r] \ar[d]_{f'} & \mathcal{X} \ar[d]^f \\
\mathcal{Y}' \ar[r] & \mathcal{Y}
}
$$
of $1$-morphisms of categories fibred in groupoids over
$(\textit{Sch}/S)_{fppf}$.
Assume the horizontal arrows are equivalences and $f$ (or equivalently $f'$)
is representably by algebraic spaces.
Then $f$ has $\mathcal{P}$ if and only if $f'$ has $\mathcal{P}$.
\end{lemma}

\begin{proof}
Note that this makes sense by
Lemma \ref{lemma-representable-by-spaces-morphism-equivalent}.
Proof omitted.
\end{proof}

\noindent
Here is a sanity check.

\begin{lemma}
\label{lemma-map-presheaves-representable-by-spaces-transformation-property}
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
Let $a : F \to G$ be a map of presheaves on $(\textit{Sch}/S)_{fppf}$.
Let $\mathcal{P}$ be as in
Definition \ref{definition-relative-representable-property}.
Assume $a$ is representable by algebraic spaces.
Then $a : F \to G$ has porperty $\mathcal{P}$ (see
Bootstrap, Definition \ref{bootstrap-definition-property-transformation})
if and only if the corresponding morphism
$\mathcal{S}_F \to \mathcal{S}_G$ of categories fibred in groupoids
has propery $\mathcal{P}$.
\end{lemma}

\begin{proof}
Note that the lemma makes sense by
Lemma \ref{lemma-map-presheaves-representable-by-algebraic-spaces}.
Proof omitted.
\end{proof}

\begin{lemma}
\label{lemma-composition-representable-transformations-property}
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
Let $\mathcal{X}$, $\mathcal{Y}$, $\mathcal{Z}$ be categories fibred
in groupoids over $(\textit{Sch}/S)_{fppf}$.
Let $\mathcal{P}$ be a property as in
Definition \ref{definition-relative-representable-property}
which is stable under composition.
Let $f : \mathcal{X} \to \mathcal{Y}$,
$g : \mathcal{Y} \to \mathcal{Z}$ be $1$-morphisms which
are representable by algebraic spaces.
If $f$ and $g$ have property $\mathcal{P}$ so does
$g \circ f : \mathcal{X} \to \mathcal{Z}$.
\end{lemma}

\begin{proof}
Note that the lemma makes sense by
Lemma \ref{lemma-composition-representable-by-spaces}.
Proof omitted.
\end{proof}

\begin{lemma}
\label{lemma-base-change-representable-transformations-property}
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
Let $\mathcal{X}, \mathcal{Y}, \mathcal{Z}$
be categories fibred in groupoids over $(\textit{Sch}/S)_{fppf}$.
Let $\mathcal{P}$ be a property as in
Definition \ref{definition-relative-representable-property}.
Let $f : \mathcal{X} \to \mathcal{Y}$ be a $1$-morphism
representable by algebraic spaces.
Let $g : \mathcal{Z} \to \mathcal{Y}$ be any $1$-morphism.
Consider the $2$-fibre product diagram
$$
\xymatrix{
\mathcal{Z} \times_{g, \mathcal{Y}, f} \mathcal{X} \ar[r]_-{g'} \ar[d]_{f'} &
\mathcal{X} \ar[d]^f \\
\mathcal{Z} \ar[r]^g & \mathcal{Y}
}
$$
If $f$ has $\mathcal{P}$, then the base change $f'$
has $\mathcal{P}$.
\end{lemma}

\begin{proof}
The lemma makes sense by
Lemma \ref{lemma-base-change-representable-by-spaces}.
Proof omitted.
\end{proof}

\begin{lemma}
\label{lemma-descent-representable-transformations-property}
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
Let $\mathcal{X}, \mathcal{Y}, \mathcal{Z}$
be categories fibred in groupoids over $(\textit{Sch}/S)_{fppf}$.
Let $\mathcal{P}$ be a property as in
Definition \ref{definition-relative-representable-property}.
Let $f : \mathcal{X} \to \mathcal{Y}$ be a $1$-morphism
representable by algebraic spaces.
Let $g : \mathcal{Z} \to \mathcal{Y}$ be any $1$-morphism.
Consider the fibre product diagram
$$
\xymatrix{
\mathcal{Z} \times_{g, \mathcal{Y}, f} \mathcal{X} \ar[r]_-{g'} \ar[d]_{f'} &
\mathcal{X} \ar[d]^f \\
\mathcal{Z} \ar[r]^g & \mathcal{Y}
}
$$
Assume that for every scheme $U$ and object $x$ of $\mathcal{Y}_U$,
there exists an fppf covering $\{U_i \to U\}$ such that $x|_{U_i}$
is in the essential image of the functor
$g : \mathcal{Z}_{U_i} \to \mathcal{Y}_{U_i}$.
In this case, if $f'$ has $\mathcal{P}$, then $f$ has $\mathcal{P}$.
\end{lemma}

\begin{proof}
Proof omitted. Hint: Compare with the proof of
Spaces,
Lemma \ref{spaces-lemma-descent-representable-transformations-property}.
\end{proof}

\begin{lemma}
\label{lemma-product-representable-transformations-property}
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
Let $\mathcal{P}$ be a property as in
Definition \ref{definition-relative-representable-property}
which is stable under composition.
Let $\mathcal{X}_i, \mathcal{Y}_i$ be categories fibred in groupoids over
$(\textit{Sch}/S)_{fppf}$, $i = 1, 2$.
Let $f_i : \mathcal{X}_i \to \mathcal{Y}_i$, $i = 1, 2$
be $1$-morphisms representable by algebraic spaces.
If $f_1$ and $f_2$ have property $\mathcal{P}$ so does
$
f_1 \times f_2 :
\mathcal{X}_1 \times \mathcal{X}_2
\to
\mathcal{Y}_1 \times \mathcal{Y}_2
$.
\end{lemma}

\begin{proof}
The lemma makes sense by
Lemma \ref{lemma-product-representable-by-spaces}.
Proof omitted.
\end{proof}

\begin{lemma}
\label{lemma-representable-transformations-property-implication}
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
Let $\mathcal{X}$, $\mathcal{Y}$ be categories fibred in groupoids
over $(\textit{Sch}/S)_{fppf}$.
Let $f : \mathcal{X} \to \mathcal{Y}$ be a $1$-morphism representable
by algebraic spaces.
Let $\mathcal{P}$, $\mathcal{P}'$ be properties as in
Definition \ref{definition-relative-representable-property}.
Suppose that for any morphism of algebraic spaces $a : F \to G$
we have $\mathcal{P}(a) \Rightarrow \mathcal{P}'(a)$.
If $f$ has property $\mathcal{P}$ then
$f$ has property $\mathcal{P}'$.
\end{lemma}

\begin{proof}
Formal.
\end{proof}

\noindent
Here is a characterization of those categories fibred in groupoids
for which the diagonal is representable by algebraic spaces.

\begin{lemma}
\label{lemma-representable-diagonal}
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
Let $\mathcal{X}$ be a category fibred in groupoids over
$(\textit{Sch}/S)_{fppf}$. The following are equivalent:
\begin{enumerate}
\item the diagonal $\mathcal{X} \to \mathcal{X} \times \mathcal{X}$
is representable by algebraic spaces,
\item for every scheme $U$ over $S$, and any $x \in \text{Ob}(\mathcal{X}_U)$
the associated $1$-morphism $x : (\textit{Sch}/U)_{fppf} \to \mathcal{X}$
is representable by algebraic spaces,
\item for every representable category fibred in groupoids $\mathcal{U}$
over $(\textit{Sch}/S)_{fppf}$ every $1$-morphism $\mathcal{U} \to \mathcal{X}$
is representable by algebraic spaces, and
\item for every category fibred in groupoids $\mathcal{U}$ which is
representable by an algebraic space every morphism
$\mathcal{U} \to \mathcal{X}$ is representable by algebraic spaces.
\end{enumerate}
\end{lemma}

\begin{proof}
We first prove the equivalence of (1) and (2).
Write $\mathcal{C} = (\textit{Sch}/S)_{fppf}$ for the base category.
We will use some of the observations of the proof of the similar
Categories, Lemma \ref{categories-lemma-representable-diagonal-groupoids}.
We will use the symbol $\cong$ to mean ``equivalence of categories fibred
in groupoids over $\mathcal{C} = (\textit{Sch}/S)_{fppf}$''.
Assume (1). Suppose given $U$ and $x$ as in (2). For any scheme $V$
and $y \in \text{Ob}(\mathcal{X}_V)$ we see (compare reference above) that
$$
\mathcal{C}/U
\times_{x, \mathcal{X}, y}
\mathcal{C}/V
\cong
(\mathcal{C}/U\times_S V)
\times_{(x, y), \mathcal{X} \times \mathcal{X}, \Delta}
\mathcal{X}
$$
which is representable by an algebraic space by assumption. Conversely,
assume (2). Consider any scheme $U$ over $S$ and a pair $(x, x')$
of objects of $\mathcal{X}$ over $U$. We have to show that
$\mathcal{X} \times_{\Delta, \mathcal{X} \times \mathcal{X}, (x, x')} U$
is representable by an algebraic space. This is clear because
(compare reference above)
$$
\mathcal{X}
\times_{\Delta, \mathcal{X} \times \mathcal{X}, (x, x')}
\mathcal{C}/U
\cong
(\mathcal{C}/U \times_{x, \mathcal{X}, x'} \mathcal{C}/U)
\times_{\mathcal{C}/U \times_S U, \Delta}
\mathcal{C}/U
$$
and the right hand side is representable by an algebraic space by assumption
and the fact that the category of algebraic spaces over $S$ has fibre products
and contains $U$ and $S$.

\medskip\noindent
The equivalence of (2) and (3) follows from
Lemma \ref{lemma-representable-by-spaces-morphism-equivalent}
and some formal arguments.
Assume (2), and let $\mathcal{U} \to \mathcal{X}$ be as in (4).
To prove (4) we have to show that for every scheme $V$ and $1$-morphism
$y : (\textit{Sch}/V)_{fppf} \to \mathcal{X}$ the $2$-fibre product
$(\textit{Sch}/V)_{fppf} \times_{y, \mathcal{X}} \mathcal{U}$
is representable by an algebraic space. Property (2) implies
that $y$ is representable by algebraic spaces, and then
Lemma \ref{lemma-base-change-by-space-representable-by-space}
implies what we want. Finally, (4) directly implies (3).
\end{proof}

\noindent
In the situation of the lemma, for any morphism
$x : (\textit{Sch}/U)_{fppf} \to \mathcal{X}$ as in the lemma, it makes sense
to say that $x$ has property $\mathcal{P}$, for any property
as in Definition \ref{definition-relative-representable-property}.
In particular this holds for
$\mathcal{P} = $ ``surjective'',
$\mathcal{P} = $ ``smooth'', and
$\mathcal{P} = $ ``etale'',
see
Descent on Spaces,
Lemmas \ref{spaces-descent-lemma-descending-property-surjective},
\ref{spaces-descent-lemma-descending-property-smooth}, and
\ref{spaces-descent-lemma-descending-property-etale}.
We will use these three cases in the definitions
of algebraic stacks below. 










\section{Stacks}
\label{section-stacks}

\noindent
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
Recall that a category $p : \mathcal{X} \to (\textit{Sch}/S)_{fppf}$
over $(\textit{Sch}/S)_{fppf}$ is said to be a
{\it stack in groupoids} (see
Stacks, Definition \ref{stacks-definition-stack-in-groupoids})
if and only if
\begin{enumerate}
\item $p : \mathcal{X} \to \mathcal{C}$ is fibred
in groupoids over $(\textit{Sch}/S)_{fppf}$,
\item for all $U \in \text{Ob}((\textit{Sch}/S)_{fppf})$,
for all $x, y\in \text{Ob}(\mathcal{X}_U)$ the presheaf
$\mathit{Isom}(x, y)$ is a sheaf on the site $(\textit{Sch}/U)_{fppf}$, and
\item for all coverings $\mathcal{U} = \{U_i \to U\}$ in
$(\textit{Sch}/S)_{fppf}$, all descent data $(x_i, \phi_{ij})$
for $\mathcal{U}$ are effective.
\end{enumerate}
For examples please see
Examples of Stacks, Section \ref{examples-stacks-section-introduction}.










\section{Algebraic stacks}
\label{section-algebraic-stacks}

\noindent
Here is the definition of an algebraic stack. We remark that condition
(2) implies we can make sense out of the condition in part (3) that
$(\textit{Sch}/U)_{fppf} \to \mathcal{X}$
is smooth and surjective, see discussion following
Lemma \ref{lemma-representable-diagonal}.

\begin{definition}
\label{definition-algebraic-stack}
Let $S$ be a base scheme contained in $\textit{Sch}_{fppf}$.
An {\it algebraic stack over $S$} is a category
$$
p : \mathcal{X} \to (\textit{Sch}/S)_{fppf}
$$
over $(\textit{Sch}/S)_{fppf}$ with the following properties:
\begin{enumerate}
\item The category $\mathcal{X}$ is a stack in groupoids over
$(\textit{Sch}/S)_{fppf}$.
\item The diagonal
$\Delta : \mathcal{X} \to \mathcal{X}\times\mathcal{X}$
is representable by algebraic spaces.
\item There exists a scheme $U \in \text{Ob}((\textit{Sch}/S)_{fppf})$
and a $1$-morphism $(\textit{Sch}/U)_{fppf} \to \mathcal{X}$
which is surjective and smooth\footnote{In future chapters we will denote
this simply $U \to \mathcal{X}$ as is customary in the literature. Another
good alterative would be to formulate this condition as the existence of a
representable category fibred in groupoids $\mathcal{U}$ and a surjective
smooth $1$-morphism $\mathcal{U} \to \mathcal{X}$.}.
\end{enumerate}
\end{definition}

\noindent
There are some differences with other definitions found in the literature.

\medskip\noindent
The first is that we require $\mathcal{X}$ to be a stack in groupoids
in the fppf topology, whereas in many references the etale topology is
used. It somehow seems to us that the fppf topology is the natural topology
to work with. In the end the resulting $2$-category of algebraic spaces
ends up being ``the same''. Namely, allthough the actual
stacks $\mathcal{X}$ being considered may be different, in the end the
category of algebraic stacks defined using sheaves in the etale topology
is equivalent the the category we define here. This will be clear later
when we introduce presentations (insert future reference here).

\medskip\noindent
The second is that we only require the diagonal map of $\mathcal{X}$ to be
representable by algebraic spaces, whereas in most references some other
conditions are imposed. Our point of view is to try to prove a certain
number of the results that follow only assuming that the diagonal
of $\mathcal{X}$ be representable by algebraic spaces, and simply add
an additional hypothesis wherever this is necessary. It has the added
benefit that any algebraic space (as defined in
Spaces, Definition \ref{spaces-definition-algebraic-space})
gives rise to an algebraic stack.

\medskip\noindent
The third is that in some papers it is required that there exists a
scheme $U$ and a surjective and etale morphism $U \to \mathcal{X}$.
In the groundbreaking paper \cite{DM} where algebraic stacks were first
introduced Deligne and Mumford used this definition and showed that
the moduli stack of stable genus $g > 1$ curves is an algebraic stack 
which has an etale covering by a scheme. Micheal Artin, see
\cite{artin_versal}, realized that many
natural results on algebraic stacks generalize to the case where one
only assume a smooth covering by a scheme. Hence our choice above.
To distinguish the two cases one sees the terms ``Deligne-Mumford stack''
and ``Artin stack'' used in the literature. We will reserve the term
``Artin stack'' for later use (insert future reference here), and continue
to use ``algebraic stack'', but we will use ``Deligne-Mumford stack''
to indicate those algebraic stacks which have an etale covering by a
scheme.

\begin{definition}
\label{definition-deligne-mumford}
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
Let $\mathcal{X}$ be an algebraic stack over $S$.
We say $\mathcal{X}$ is a {\it Deligne-Mumford stack} if there exists
a scheme $U$ and a surjective etale morphism
$(\textit{Sch}/U)_{fppf} \to \mathcal{X}$.
\end{definition}

\noindent
We will compare our notion of a Deligne-Mumford stack with
the notion as defined in the paper by Deligne and Mumford later
(see insert future reference here).

\medskip\noindent
The category of algebraic stacks over $S$ forms a $2$-category.
Here is the precise definition.

\begin{definition}
\label{definition-morphism-algebraic-stacks}
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
The {\it $2$-category of algebraic stacks over $S$} is the
sub $2$-category of the $2$-category of categories fibred in
groupoids over $(\textit{Sch}/S)_{fppf}$ (see
Categories,
Definition \ref{categories-definition-categories-fibred-in-groupoids-over-C})
defined as follows:
\begin{enumerate}
\item Its objects are those categories fibred in groupoids
over $(\textit{Sch}/S)_{fppf}$ which are algebraic stacks over $S$.
\item Its $1$-morphisms $f : \mathcal{X} \to \mathcal{Y}$ are
any functors of categories over $(\textit{Sch}/S)_{fppf}$, as in
Categories, Definition \ref{categories-definition-categories-over-C}.
\item Its $2$-morphisms are transformations between functors
over $(\textit{Sch}/S)_{fppf}$, as in
Categories, Definition \ref{categories-definition-categories-over-C}.
\end{enumerate}
\end{definition}

\noindent
In other words this $2$-category is the full sub $2$-category of
$\textit{Cat}/(\textit{Sch}/S)_{fppf}$ whose objects are algebraic stacks.
Note that every $2$-morphism is automatically an isomorphism.
Hence this is actually a $(2, 1)$-category and not just a $2$-category.

\medskip\noindent
We will see later (insert future reference here) that this $2$-category
has $2$-fibre products.

\medskip\noindent
Similar to the remark above the $2$-category of algebraic stacks over $S$ is a
full sub $2$-category of the $2$-category of categories fibred in groupoids
over $(\textit{Sch}/S)_{fppf}$. It turns out that it is closed under
equivalences. Here is the precise statement.

\begin{lemma}
\label{lemma-equivalent}
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
Let $\mathcal{X}$, $\mathcal{Y}$ be categories over $(\textit{Sch}/S)_{fppf}$.
Assume $\mathcal{X}$, $\mathcal{Y}$ are equivalent as categories over
$(\textit{Sch}/S)_{fppf}$. Then $\mathcal{X}$ is an algebraic stack if and
only if $\mathcal{Y}$ is an algebraic stack. Similarly, $\mathcal{X}$
is a Deligne-Mumford stack if and only if $\mathcal{Y}$ is a Deligne-Mumford
stack.
\end{lemma}

\begin{proof}
Assume $\mathcal{X}$ is an algebraic stack (resp.\ a Deligne-Mumford stack). By
Stacks, Lemma \ref{stacks-lemma-stack-in-groupoids-equivalent}
this implies that $\mathcal{Y}$ is a stack in groupoids over
$\textit{Sch}_{fppf}$. Choose an equivalence $f : \mathcal{X} \to \mathcal{Y}$
over $\textit{Sch}_{fppf}$. This gives a $2$-commutative diagram
$$
\xymatrix{
\mathcal{X} \ar[r]_f \ar[d]_{\Delta_\mathcal{X}} &
\mathcal{Y} \ar[d]^{\Delta_\mathcal{Y}} \\
\mathcal{X} \times \mathcal{X} \ar[r]^{f \times f} &
\mathcal{Y} \times \mathcal{Y}
}
$$
whose horizontal arrows are equivalences. This implies that
$\Delta_\mathcal{Y}$ is representable by algebraic spaces according to
Lemma \ref{lemma-representable-by-spaces-morphism-equivalent}.
Finally, let $U$ be a scheme over $S$, and let
$x : (\textit{Sch}/U)_{fppf} \to \mathcal{X}$ be a $1$-morphism which
is surjective and smooth (resp.\ etale). Considering the diagram
$$
\xymatrix{
(\textit{Sch}/U)_{fppf} \ar[r]_{\text{id}} \ar[d]_{x} &
(\textit{Sch}/U)_{fppf} \ar[d]^{f \circ x} \\
\mathcal{X} \ar[r]^f &
\mathcal{Y}
}
$$
and applying
Lemma \ref{lemma-property-morphism-equivalent}
we conclude that $x \circ f$ is surjective and smooth (resp.\ etale)
as desired.
\end{proof}




\section{Algebraic stacks and algebraic spaces}
\label{section-stacks-spaces}

\noindent
In this section we discuss some simple criteria which imply that an
algebraic stack is an algebraic space. The main result is that this
happens exactly when objects of fibre categories have no nontrivial
automorphisms. This is not a triviality! Before we come to this
we first do a sanity check.

\begin{lemma}
\label{lemma-representable-algebraic}
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
\begin{enumerate}
\item A category fibred in groupoids
$p : \mathcal{X} \to (\textit{Sch}/S)_{fppf}$
which is representable by an algebraic space is a Deligne-Mumford stack.
\item If $F$ is an algebraic space over $S$, then the associated
category fibred in groupoids
$p_F : \mathcal{S}_F \to (\textit{Sch}/S)_{fppf}$
is a Deligne-Mumford stack.
\item If $X \in \text{Ob}((\textit{Sch}/S)_{fppf})$, then
$(\textit{Sch}/X)_{fppf} \to (\textit{Sch}/S)_{fppf}$ is
a Deligne-Mumford stack.
\end{enumerate}
\end{lemma}

\begin{proof}
It is clear that (2) implies (3).
Parts (1) and (2) are equivalent by Lemma \ref{lemma-equivalent}.
Hence it suffices to prove (2).
First, we note that $\mathcal{S}_F$ is stack in sets since
$F$ is a sheaf (see
Examples of Stacks,
Section \ref{examples-stacks-section-stack-associated-to-sheaf}).
A fortiori it is a stack in groupoids. Second the diagonal
morphism $\mathcal{S}_F \to \mathcal{S}_F  \times \mathcal{S}_F$
is the same as the morphism $\mathcal{S}_F \to \mathcal{S}_{F \times F}$
which comes from the diagonal of $F$. Hence this is representable
by algebraic spaces according to
Lemma \ref{lemma-morphism-spaces-gives-representable-by-spaces}.
Actually it is even representable (by schemes), as the diagonal of
an algebraic space is representable, but we do not need this.
Let $U$ be a scheme and let $h_U \to F$ be a surjective etale morphism.
We may think of this a surjective etale morphism of algebraic spaces.
Hence by
Lemma
\ref{lemma-map-presheaves-representable-by-spaces-transformation-property}
the corresponding $1$-morphism $(\textit{Sch}/U)_{fppf} \to \mathcal{S}_F$
is surjective and etale.
\end{proof}

\noindent
The following result says that a Deligne-Mumford stack whose inertia
is trivial ``is'' an algebraic space. This lemma will be obsoleted by
the stronger
Proposition \ref{proposition-algebraic-stack-no-automorphisms}
below which says that this holds more generally for algebraic stacks...

\begin{lemma}
\label{lemma-algebraic-stack-no-automorphisms}
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
Let $\mathcal{X}$ be an algebraic stack over $S$.
The following are equivalent
\begin{enumerate}
\item $\mathcal{X}$ is a Deligne-Mumford stack and is a stack in setoids,
\item $\mathcal{X}$ is a Deligne-Mumford stack such that the
canonical $1$-morphism $\mathcal{I}_\mathcal{X} \to \mathcal{X}$
is an equivalence, and
\item $\mathcal{X}$ is representable by an algebraic space.
\end{enumerate}
\end{lemma}

\begin{proof}
The equivalence of (1) and (2) follows from
Stacks, Lemma \ref{stacks-lemma-inertia}.
The implication (3) $\Rightarrow$ (1) follows from
Lemma \ref{lemma-representable-algebraic}.
Finally, assume (1). By
Stacks, Lemma \ref{stacks-lemma-stack-in-setoids-characterize}
there exists an equivalence $j : \mathcal{X} \to \mathcal{S}_F$
where $F$ is a sheaf on $(\textit{Sch}/S)_{fppf}$. By
Lemma \ref{lemma-map-presheaves-representable-by-algebraic-spaces}
the fact that $\Delta_\mathcal{X}$ is representable by algebraic
spaces, means that $\Delta_F : F \to F \times F$
is representable by algebraic spaces.
Let $U$ be a scheme, and let $x : (\textit{Sch}/U)_{fppf} \to \mathcal{X}$
be a surjective etale morphism. The composition
$j \circ x : (\textit{Sch}/U)_{fppf} \to \mathcal{S}_F$
corresponds to a morphism $h_U \to F$ of sheaves. By
Bootstrap, Lemma \ref{bootstrap-lemma-representable-diagonal}
this morphism is representable by algebraic spaces.
Hence by
Lemma
\ref{lemma-map-presheaves-representable-by-spaces-transformation-property}
we conclude that $h_U \to F$ is surjective and etale.
Finally, we apply
Bootstrap, Theorem \ref{bootstrap-theorem-bootstrap}
to see that $F$ is an algebraic space.
\end{proof}

\begin{proposition}
\label{proposition-algebraic-stack-no-automorphisms}
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
Let $\mathcal{X}$ be an algebraic stack over $S$.
The following are equivalent
\begin{enumerate}
\item $\mathcal{X}$ is a stack in setoids,
\item the canonical $1$-morphism $\mathcal{I}_\mathcal{X} \to \mathcal{X}$
is an equivalence, and
\item $\mathcal{X}$ is representable by an algebraic space.
\end{enumerate}
\end{proposition}

\begin{proof}
The equivalence of (1) and (2) follows from
Stacks, Lemma \ref{stacks-lemma-inertia}.
The implication (3) $\Rightarrow$ (1) follows from
Lemma \ref{lemma-algebraic-stack-no-automorphisms}.
Finally, assume (1). By
Stacks, Lemma \ref{stacks-lemma-stack-in-setoids-characterize}
there exists an equivalence $j : \mathcal{X} \to \mathcal{S}_F$
where $F$ is a sheaf on $(\textit{Sch}/S)_{fppf}$.  By
Lemma \ref{lemma-map-presheaves-representable-by-algebraic-spaces}
the fact that $\Delta_\mathcal{X}$ is representable by algebraic
spaces, means that $\Delta_F : F \to F \times F$
is representable by algebraic spaces.
Let $U$ be a scheme and let $x : (\textit{Sch}/U)_{fppf} \to \mathcal{X}$
be a surjective smooth morphism. The composition
$j \circ x : (\textit{Sch}/U)_{fppf} \to \mathcal{S}_F$
corresponds to a morphism $h_U \to F$ of sheaves. By
Bootstrap, Lemma \ref{bootstrap-lemma-representable-diagonal}
this morphism is representable by algebraic spaces.
Hence by
Lemma
\ref{lemma-map-presheaves-representable-by-spaces-transformation-property}
we conclude that $h_U \to F$ is surjective and smooth.
In particular it is surjective, flat and locally of finite presentation
(use
Lemma \ref{lemma-representable-transformations-property-implication}
and the fact that a smooth morphism of algebraic spaces is flat and
locally of finite presentation)
Finally, we apply
Bootstrap, Theorem \ref{bootstrap-theorem-final-bootstrap}
to see that $F$ is an algebraic space.
\end{proof}








\section{Algebraic stacks, overhauled}
\label{section-overhaul}

\noindent
Some basic results on algebraic stacks.

\begin{lemma}
\label{lemma-lift-morphism-presentations}
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
Let $f : \mathcal{X} \to \mathcal{Y}$ be a $1$-morphism of algebraic
stacks over $S$.
Let $V \in \text{Ob}((\textit{Sch}/S)_{fppf})$.
Let $y : (\textit{Sch}/V)_{fppf} \to \mathcal{Y}$ be surjective and smooth.
Then there exists an object $U \in \text{Ob}((\textit{Sch}/S)_{fppf})$
and a $2$-commutative diagram
$$
\xymatrix{
(\textit{Sch}/U)_{fppf} \ar[r]_a \ar[d]_x &
(\textit{Sch}/V)_{fppf} \ar[d]^y \\
\mathcal{X} \ar[r]^f & \mathcal{Y}
}
$$
with $x$ surjective and smooth.
\end{lemma}

\begin{proof}
First choose $W \in \text{Ob}((\textit{Sch}/S)_{fppf})$ and a surjective
smooth $1$-morphism $z : (\textit{Sch}/W)_{fppf} \to \mathcal{X}$.
As $\mathcal{Y}$ is an algebraic stack we may choose an equivalence
$$
j :
\mathcal{S}_F
\longrightarrow
(\textit{Sch}/W)_{fppf}
\times_{f \circ z, \mathcal{Y}, y}
(\textit{Sch}/V)_{fppf}
$$
where $F$ is an algebraic space. By
Lemma \ref{lemma-base-change-representable-transformations-property}
the morphism
$\mathcal{S}_F \to (\textit{Sch}/W)_{fppf}$ is surjective and smooth
as a base change of $y$. Hence by
Lemma \ref{lemma-composition-representable-transformations-property}
we see that $\mathcal{S}_F \to \mathcal{X}$ is surjective and smooth.
Choose an object $U \in \text{Ob}((\textit{Sch}/S)_{fppf})$
and a surjective etale morphism $U \to F$. Then applying
Lemma \ref{lemma-composition-representable-transformations-property}
once more we obtain the desired properties.
\end{proof}

\begin{lemma}
\label{lemma-2-fibre-product}
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
Let $\mathcal{X}, \mathcal{Y}, \mathcal{Z}$ be algebraic stacks over $S$.
Let $f : \mathcal{X} \to \mathcal{Z}$, $g : \mathcal{Y} \to \mathcal{Z}$
be $1$-morphisms of algebraic stacks. Then the $2$-fibre product
$\mathcal{X} \times_{f, \mathcal{Z}, g} \mathcal{Y}$ is an algebraic stack.
It is also the $2$-fibre product in the $2$-category of algebraic stacks
over $(\textit{Sch}/S)_{fppf}$.
\end{lemma}

\begin{proof}
We have to check conditions (1), (2), and (3) of
Definition \ref{definition-algebraic-stack}.
The first condition follows from
Stacks, Lemma \ref{stacks-lemma-2-product-stacks-in-groupoids}.

\medskip\noindent
The second condition we have to check is that the $\mathit{Isom}$-sheaves
are representable by algebraic spaces. To do this, suppose that
$T$ is a scheme over $S$, and $u, v$ are objects of
$(\mathcal{X} \times_{f, \mathcal{Z}, g} \mathcal{Y})_T$.
By our construction of $2$-fibre products (which goes all the way
back to
Categories, Lemma \ref{categories-lemma-2-product-categories-over-C})
we may write $u = (x, y, \alpha)$ and $v = (x', y', \alpha)$.
Here $\alpha : f(x) \to g(y)$ and similarly for $\alpha'$.
Then it is clear that
$$
\xymatrix{
\mathit{Isom}(u, v) \ar[d] \ar[rr] & &
\mathit{Isom}(y, y') \ar[d]^{\phi \mapsto g(\phi) \circ \alpha} \\
\mathit{Isom}(x, x') \ar[rr]^-{\psi \mapsto \alpha' \circ f(\psi)} & &
\mathit{Isom}(f(x), g(y'))
}
$$
is a cartesian diagram of sheaves on $(\textit{Sch}/T)_{fppf}$.
Since by assumption the sheaves
$\mathit{Isom}(y, y')$, $\mathit{Isom}(x, x')$, $\mathit{Isom}(f(x), g(y'))$
are algebraic spaces we see that $\mathit{Isom}(u, v)$
is an algebraic space.

\medskip\noindent
Let $U, V \in \text{Ob}((\textit{Sch}/S)_{fppf})$,
and let $x, y$ be surjective smooth morphisms
$x : (\textit{Sch}/U)_{fppf} \to \mathcal{X}$,
$y : (\textit{Sch}/Y)_{fppf} \to \mathcal{Y}$.
Consider the morphism
$$
(\textit{Sch}/U)_{fppf}
\times_{f \circ x, \mathcal{Z}, g \circ y}
(\textit{Sch}/V)_{fppf}
\longrightarrow
\mathcal{X} \times_{f, \mathcal{Z}, g} \mathcal{Y}.
$$
As $\mathcal{Z}$ is an algebraic stack the source is representable
by an algebraic space $F$. Moreover, the morphism is the composition
of base changes of $x$ and $y$, hence surjective and smooth, see
Lemmas \ref{lemma-base-change-representable-transformations-property} and
\ref{lemma-composition-representable-transformations-property}.
Choosing a scheme $W$ and a surjective etale morphism $W \to F$
we see that the composition of the displayed morphism
with the corresponding map
$$
(\textit{Sch}/W)_{fppf}
\longrightarrow
(\textit{Sch}/U)_{fppf}
\times_{f \circ x, \mathcal{Z}, g \circ y}
(\textit{Sch}/V)_{fppf}
$$
is surjective and smooth which proves the last condition.
\end{proof}








\section{From an algebraic stack to a presentation}
\label{section-stack-to-presentation}

\noindent
Given an algebraic stack over $S$ we obtain a groupoid in algebraic spaces
over $S$ whose associated quotient stack is the algebraic stack.

\medskip\noindent
Recall that if $(U, R, s, t, c)$ is a groupoid in algebraic spaces over $S$
then $[U/R]$ denotes the quotient stack associated to this datum, see
Groupoids in Spaces,
Definition \ref{spaces-groupoids-definition-quotient-stack}.
In general $[U/R]$ is {\bf not} an algebraic stack. In particular the
stack $[U/R]$ occuring in the following lemma is in general not
algebraic.

\begin{lemma}
\label{lemma-map-space-into-stack}
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
Let $\mathcal{X}$ be an algebraic stack over $S$.
Let $\mathcal{U}$ be an algebraic stack over $S$ which
is representable by an algebraic space.
Let $f : \mathcal{U} \to \mathcal{X}$ be a 1-morphism. Then
\begin{enumerate}
\item the $2$-fibre product
$\mathcal{R} = \mathcal{U} \times_{f, \mathcal{X}, f} \mathcal{U}$
is representable by an algebraic space,
\item there is a canonical equivalence
$$
\mathcal{U} \times_{f, \mathcal{X}, f} \mathcal{U}
\times_{f, \mathcal{X}, f} \mathcal{U} =
\mathcal{R} \times_{\text{pr}_1, \mathcal{U}, \text{pr}_0} \mathcal{R},
$$
\item the projection $\text{pr}_{02}$ induces via (2) a $1$-morphism
$$
\text{pr}_{02} :
\mathcal{R} \times_{\text{pr}_1, \mathcal{U}, \text{pr}_0} \mathcal{R}
\longrightarrow
\mathcal{R}
$$
\item let $U$, $R$ be the algebraic spaces representing
$\mathcal{U}, \mathcal{R}$ and $t, s : R \to U$ and
$c : R \times_{s, U, t} R \to U$ are the morphisms corresponding
to the $1$-morphisms
$\text{pr}_0, \text{pr}_1 : \mathcal{R} \to \mathcal{U}$
and
$\text{pr}_{02} :
\mathcal{R} \times_{\text{pr}_1, \mathcal{U}, \text{pr}_0} \mathcal{R} \to
\mathcal{R}$ above, then the quintuple $(U, R, s, t, c)$ is a groupoid in
algebraic spaces over $S$,
\item the morphism $f$ induces a canonical $1$-morphism
$f_{can} : [U/R] \to \mathcal{X}$
of stacks in groupoids over $(\textit{Sch}/S)_{fppf}$, and
\item the $1$-morphism $f_{can} : [U/R] \to \mathcal{X}$ is fully faithful.
\end{enumerate}
\end{lemma}

\begin{proof}
Proof of (1). By definition $\Delta_{\mathcal{X}}$ is representable
by algebraic spaces so
Lemma \ref{lemma-representable-diagonal}
applies to show that $\mathcal{U} \to \mathcal{X}$ is representable
by algebraic spaces. Hence the result follows from
Lemma \ref{lemma-base-change-by-space-representable-by-space}.

\medskip\noindent
Let $T$ be a scheme over $S$. By construction of the $2$-fibre product (see
Categories, Lemma \ref{categories-lemma-2-product-categories-over-C})
we see that the objects of the fibre category $\mathcal{R}_T$
are triples $(a, b, \alpha)$ where $a, b \in \text{Ob}(\mathcal{U}_T)$
and $\alpha : f(a) \to f(b)$
is a morphism in the fibre category $\mathcal{X}_T$.

\medskip\noindent
Proof of (2). The equivalence comes from repeatedly applying
Categories, Lemmas \ref{categories-lemma-associativity-2-fibre-product} and
\ref{categories-lemma-2-fibre-product-erase-factor}.
Let us identify
$\mathcal{U} \times_{\mathcal{X}} \mathcal{U} \times_{\mathcal{X}} \mathcal{U}$
with
$(\mathcal{U} \times_{\mathcal{X}} \mathcal{U})
\times_{\mathcal{X}} \mathcal{U}$.
If $T$ is a scheme over $S$, then on fibre categories over $T$
this equivalence maps the object
$((a,b, \alpha), c, \beta)$ on the left hand side
to the object $((a, b, \alpha), (b, c, \beta))$ of the right hand side.

\medskip\noindent
Proof of (3). The $1$-morphism $\text{pr}_{02}$ is constructed in the proof of
Categories, Lemma \ref{categories-lemma-triple-2-fibre-product-pr02}.
In terms of the description of objects of the fibre category
above we see that $((a, b, \alpha), (b, c, \beta))$
maps to $(a, c, \beta \circ \alpha)$.

\medskip\noindent
Unfortunately, this is {\it not compatible} with our conventions on
groupoids where we always have $j = (t, s) : R \to U$, and we ``think''
of a $T$-valued point $r$ of $R$ as a morphism $r : s(r) \to t(r)$.
However, this does not affect the proof of (4), since the opposite of
a groupoid is a groupoid. But in the proof of (5) it is responsible
for the inverses in the displayed formula below.

\medskip\noindent
Proof of (4). Recall that the sheaf $U$ is isomorphic to the sheaf
$T \mapsto \text{Ob}(\mathcal{U}_T)/\!\cong$, and
similarly for $R$, see
Lemma \ref{lemma-characterize-representable-by-space}.
It follows from
Categories,
Lemma \ref{categories-lemma-category-fibred-setoids-presheaves-products}
that this description is compatible with $2$-fibre products
so we get a similar matching of
$\mathcal{R} \times_{\text{pr}_1, \mathcal{U}, \text{pr}_0} \mathcal{R}$
and $R \times_{s, U, t} R$.
The morphisms $t, s : R \to U$ and $c : R \times_{s, U, t} R \to R$
we get from the general equality (\ref{equation-morphisms-spaces}).
Explicitly these maps are the transformations of functors that come
from letting $\text{pr}_0$, $\text{pr}_0$, $\text{pr}_{02}$
act on isomorphism classes of objects of fibre categories.
Hence to show that we obtain a groupoid in algebraic
spaces it suffices to show that for every scheme $T$ over $S$
the structure
$$
(\text{Ob}(\mathcal{U}_T)/\!\cong,
\text{Ob}(\mathcal{R}_T)/\!\cong,
\text{pr}_1, \text{pr}_0, \text{pr}_{02})
$$
is a groupoid which is clear from our description of objects of
$\mathcal{R}_T$ above.

\medskip\noindent
Proof of (5). We will eventually apply
Groupoids in Spaces,
Lemma \ref{spaces-groupoids-lemma-quotient-stack-2-coequalizer}
to obtain the functor $[U/R] \to \mathcal{X}$.
Consider the $1$-morphism $f : \mathcal{U} \to \mathcal{X}$.
We have a $2$-arrow $\tau : f \circ \text{pr}_1 \to f \circ \text{pr}_0$
by definition of $\mathcal{R}$ as the $2$-fibre product.
Namely, on an object $(a, b, \alpha)$ of $\mathcal{R}$ over $T$ it is
the map $\alpha^{-1} : b \to a$. We claim that
$$
\tau \circ \text{id}_{\text{pr}_{02}} = 
(\tau \star \text{id}_{\text{pr}_0})
\circ
(\tau \star \text{id}_{\text{pr}_1}).
$$
This identity says that given an object
$((a, b, \alpha), (b, c, \beta))$ of
$\mathcal{R} \times_{\text{pr}_1, \mathcal{U}, \text{pr}_0} \mathcal{R}$
over $T$, then the composition of
$$
\xymatrix{
c \ar[r]^{\beta^{-1}} & b \ar[r]^{\alpha^{-1}} & a
}
$$
is the same as the arrow $(\beta \circ \alpha)^{-1} : a \to c$. This is
clearly true, hence the claim holds. In this way we see that all the
assumption of
Groupoids in Spaces,
Lemma \ref{spaces-groupoids-lemma-quotient-stack-2-coequalizer}
are satisfied for the structure
$(\mathcal{U}, \mathcal{R}, \text{pr}_0, \text{pr}_1, \text{pr}_{02})$
and the $1$-morphism $f$ and the $2$-morphism $\tau$.
Except, to apply the lemma we need to prove this holds
for the structure $(\mathcal{S}_U, \mathcal{S}_R, s, t, c)$
with suitable morphisms.

\medskip\noindent
Now there should be some general abstract nonsense
argument which transfer these data between the two, but it seems to
be quite long. Instead, we use the following trick.
Pick a quasi-inverse $j^{-1} : \mathcal{S}_U \to \mathcal{U}$
of the canonical equivalence $j : \mathcal{U} \to \mathcal{S}_U$ which comes
from $U(T) = \text{Ob}(\mathcal{U}_T)/\!\!\cong$.
This just means that for every scheme $T/S$ and every
object $a \in \mathcal{U}_T$ we have picked out a particular
element of its isomorphism class, namely $j^{-1}(j(a))$.
Using $j^{-1}$ we may therefore see $\mathcal{S}_U$
as a subcategory of $\mathcal{U}$. Having chosen this subcategory
we can consider those objects $(a, b, \alpha)$ of $\mathcal{R}_T$
such that $a, b$ are objects of $(\mathcal{S}_U)_T$, i.e., such
that $j^{-1}(j(a)) = a$ and $j^{-1}(j(b)) = b$. Then it is clear that
this forms a subcategory of $\mathcal{R}$ which maps isomorphically
to $\mathcal{S}_R$ via the canonical equivalence
$\mathcal{R} \to \mathcal{S}_R$. Moreover, this is clearly compatible
with forming the $2$-fibre product
$\mathcal{R} \times_{\text{pr}_1, \mathcal{U}, \text{pr}_0} \mathcal{R}$.
Hence we see that we may simply restrict
$f$ to $\mathcal{S}_U$ and restrict $\tau$ to a transformation
beween functors $\mathcal{S}_R \to \mathcal{X}$. Hence it is clear that
the displayed equality of
Groupoids in Spaces,
Lemma \ref{spaces-groupoids-lemma-quotient-stack-2-coequalizer}
holds since it holds even as an equality of transformations of functors
$\mathcal{R} \times_{\text{pr}_1, \mathcal{U}, \text{pr}_0} \mathcal{R}
\to \mathcal{X}$ before restricting to $\mathcal{S}_{R \times_{s, U, t} R}$.

\medskip\noindent
Proof of (6). Both $[U/R]$ and $\mathcal{X}$ are stacks.
Hence given a scheme $T/S$ and objects $x, y$ of $[U/R]$
over $T$ we obtain a transformation of fppf sheaves
$$
\mathit{Isom}(x, y) \longrightarrow \mathit{Isom}(f_{can}(x), f_{can}(y))
$$
on $(\textit{Sch}/T)_{fppf}$. We have to show that this is an
isomorphism. We may work fppf locally on $T$, hence we may assume that
$x, y$ come from morphisms $x, y : T \to U$. By the embedding
$\mathcal{S}_U \subset \mathcal{U}$ above we may also think of $x, y$ as
objects of $\mathcal{U}$ over $T$. In
Groupoids in Spaces,
Lemma \ref{spaces-groupoids-lemma-quotient-stack-morphisms}
we have seen that the left hand sheaf is represented by the algebraic space
$$
R \times_{(t, s), U \times_S U, (y, x)} T
$$
over $T$. On the other hand, the right hand
side is by
Stacks, Lemma \ref{stacks-lemma-isom-as-2-fibre-product}
equal to the sheaf associated to the following stack in setoids:
$$
\mathcal{X}
\times_{\mathcal{X} \times \mathcal{X}, (f \circ y, f \circ x)} T =
\mathcal{X}
\times_{\mathcal{X} \times \mathcal{X}, (f, f)}
(\mathcal{U} \times \mathcal{U})
\times_{\mathcal{U} \times \mathcal{U}, (y, x)} T =
\mathcal{R}
\times_{(\text{pr}_0, \text{pr}_1), \mathcal{U} \times \mathcal{U}, (y, x)} T
$$
and this is clear representable by the fibre product desplayed above.
At this point we have shown that the two $\mathit{Isom}$-sheaves
are isomorphic. We omit the verification that our $1$-morphism
$[U/R] \to \mathcal{X}$ gives the correct map on $\mathit{Isom}$-sheaves.
\end{proof}

\noindent
We can use the previous very abstract lemma to produce
presentations.

\begin{lemma}
\label{lemma-space-presentation}
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
Let $\mathcal{X}$ be an algebraic stack over $S$.
Let $U \in \text{Ob}((\textit{Sch}/S)_{fppf})$.
Let $f : (\textit{Sch}/U)_{fppf} \to \mathcal{X}$ be a
surjective smooth morphism.
Let $(U, R, s, t, c)$ be the groupoid in algebraic spaces
and $f_{can} : [U/R] \to \mathcal{X}$ be the result of applying
Lemma \ref{lemma-map-space-into-stack}
to $U$ and $f$. Then
\begin{enumerate}
\item the morphisms $s$, $t$ are smooth, and
\item the $1$-morphism $f_{can} : [U/R] \to \mathcal{X}$
is an equivalence.
\end{enumerate}
\end{lemma}

\begin{proof}
The morphisms $s, t$ are smooth by
Lemmas \ref{lemma-property-morphism-equivalent} and
\ref{lemma-map-presheaves-representable-by-spaces-transformation-property}.
As the $1$-morphism
$f : (\textit{Sch}/U)_{fppf} \to \mathcal{X}$ is smooth and
surjective it is clear that given any scheme $T$ and any object
$a \in \text{Ob}(\mathcal{X}_T)$ there exists a smooth and surjective
morphism $T' \to T$ such that $a|_T'$ comes from an object of
$[U/R]_{T'}$. Since $f_{can} : [U/R] \to \mathcal{X}$
is fully faithful, we deduce that
$[U/R] \to \mathcal{X}$ is essentially surjective as
descent data on objects are effective on both sides, see
Stacks, Lemma \ref{stacks-lemma-characterize-essentially-surjective-when-ff}.
\end{proof}





\input{chapters}

\bibliography{my}
\bibliographystyle{amsalpha}

\end{document}
