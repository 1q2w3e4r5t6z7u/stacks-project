\input{preamble}

% OK, start here.
%
\begin{document}

\title{Algebraic stacks}


\maketitle

\phantomsection
\label{section-phantom}

\tableofcontents

\section{Introduction}
\label{section-introduction}

\noindent
This is where we define algebraic stacks and make some very elementary
observations. The general philosophy will be to have no separation
conditions whatsoever and add those conditions necessary to make lemmas,
propositions, theorems true/provable. Thus the notions discussed here
differ slightly from those in other places in the literature, e.g.,
\cite{LM-B}.



\section{Conventions}
\label{section-conventions}

\noindent
The conventions we use in this chapter are the same as those in the
chapter on algebraic spaces. For convenience we repeat them here.

\medskip\noindent
We work in a suitable big fppf site $\textit{Sch}_{fppf}$
as in Topologies, Definition \ref{topologies-definition-big-fppf-site}.
So, if not explicitly stated otherwise all schemes will be objects
of $\textit{Sch}_{fppf}$.
We will record elsewhere what changes if you change the big
fppf site (insert future reference here).

\medskip\noindent
We will always work relative to a base $S$ contained in $\textit{Sch}_{fppf}$.
And we will then work with the big fppf site $(\textit{Sch}/S)_{fppf}$,
see Topologies, Definition \ref{topologies-definition-big-small-fppf}.
The absolute case can be recovered by taking
$S = \text{Spec}(\mathbf{Z})$.

\medskip\noindent
If $U, T$ are schemes over $S$, then we denote
$U(T)$ for the set of $T$-valued points {\it over} $S$.
In a formula: $U(T) = \text{Mor}_S(T, U)$.

\medskip\noindent
Note that any fpqc covering is a family of universally effective
epimorphisms, see
Descent, Lemma \ref{descent-lemma-fpqc-universal-effective-epimorphisms}.
Hence the topology on $\textit{Sch}_{fppf}$
is weaker than the canonical topology and all representable presheaves
are sheaves.








\section{Notation}
\label{section-notation}

\noindent
We use the letters $S, T, U, V, X, Y$ to indicate schemes.
We use the letters $\mathcal{X}, \mathcal{Y}, \mathcal{Z}$ to indicate
categories (fibred, fibred in groupoids, stacks,...)
over $(\textit{Sch}/S)_{fppf}$. We use small case letters
$f$, $g$ for functors such as $f : \mathcal{X} \to \mathcal{Y}$
over $(\textit{Sch}/S)_{fppf}$.
We use capital $F$, $G$, $H$ for algebraic spaces over $S$, and more
generally for presheaves of sets on $(\textit{Sch}/S)_{fppf}$.
(In future chapters we will revert to using also $X$, $Y$, etc
for algebraic spaces.)

\medskip\noindent
The reason for these choices is that we want to clearly distinguish between
the different types of objects in this chapter, to build the foundations.








\section{Representable morphisms of categories fibred in groupoids}
\label{section-representable}

\noindent
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
The basic object of study in this chapter will be a
category fibred in groupoids
$p : \mathcal{X} \to (\textit{Sch}/S)_{fppf}$, see
Categories, Definition \ref{categories-definition-fibred-groupoids}.
We will often simply say ``let $\mathcal{X}$ be a category fibred
in groupoids over $(\textit{Sch}/S)_{fppf}$'' to indicate
this situation. A $1$-morphism $\mathcal{X} \to \mathcal{Y}$ of categories
in groupoids over $(\textit{Sch}/S)_{fppf}$ will be a $1$-morphism
in the $2$-category of categories fibred in groupoids over
$(\textit{Sch}/S)_{fppf}$, see Categories,
Definition \ref{categories-definition-categories-fibred-in-groupoids-over-C}.
It is simply a functor $\mathcal{X} \to \mathcal{Y}$ over
$(\textit{Sch}/S)_{fppf}$.
We recall this is really a $(2, 1)$-category and that all $2$-fibre products
exist.

\medskip\noindent
Let $U \in \text{Ob}((\textit{Sch}/S)_{fppf})$, and let $\mathcal{X}$ be a
category fibred in groupoids over $(\textit{Sch}/S)_{fppf}$.
We will frequently use the $2$-Yoneda lemma, Categories,
Lemma \ref{categories-lemma-yoneda-2category}.
It says that $1$-morphisms $(\textit{Sch}/U)_{fppf} \to \mathcal{X}$
correspond to objects $x$ of the fibre category $\mathcal{X}_U$.
Namely, given a choice of pullbacks for $\mathcal{X}$ as in Categories,
Definition \ref{categories-definition-pullback-functor-fibred-category},
then the functor $(\textit{Sch}/U)_{fppf} \to \mathcal{X}$ corresponding to $x$
is the functor $(f : V \to U) \mapsto f^*x$ on objects. The notation
$x : (\textit{Sch}/U)_{fppf} \to \mathcal{X}$ will be used to indicate this
functor.

\medskip\noindent
Let $\mathcal{X}$, $\mathcal{Y}$ be categories fibred in groupoids
over $(\textit{Sch}/S)_{fppf}$. Let $f : \mathcal{X} \to \mathcal{Y}$
be a {\it representable $1$-morphism}, see
Categories, Definition
\ref{categories-definition-representable-map-categories-fibred-in-groupoids}.
This means that for every $U \in \text{Ob}((\textit{Sch}/S)_{fppf})$ and
any $y \in \text{Ob}(\mathcal{Y}_U)$ the $2$-fiber product
$(\textit{Sch}/U)_{fppf} \times_{y, \mathcal{Y}} \mathcal{X}$
is representable, see Categories,
Definition \ref{categories-definition-representable-fibred-category}.
Choose a representing object $V_y$ and an equivalence
$$
(\textit{Sch}/V_y)_{fppf}
\longrightarrow
(\textit{Sch}/U)_{fppf} \times_{y, \mathcal{Y}} \mathcal{X}.
$$
By the $2$-Yoneda lemma the projection
$(\textit{Sch}/V_y)_{fppf} \to
(\textit{Sch}/U)_{fppf} \times_\mathcal{Y} \mathcal{Y}
\to (\textit{Sch}/U)_{fppf}$ comes from a unique object of
the fibre category $((\textit{Sch}/U)_{fppf})_{V_y}$, in other words
a morphism of schemes $f_y : V_y \to U$. We represent this by the diagram
\begin{equation}
\label{equation-representable}
\vcenter{
\xymatrix{
V_y \ar@{~>}[r] \ar[d]_{f_y} &
(\textit{Sch}/V_y)_{fppf} \ar[d] \ar[r] &
\mathcal{X} \ar[d]^f \\
U \ar@{~>}[r] &
(\textit{Sch}/U)_{fppf} \ar[r]^-y &
\mathcal{Y}
}
}
\end{equation}
where the squiggly arrows represent the $2$-Yoneda embedding.
Here are some lemmas about this notion that work in great generality.

\begin{lemma}
\label{lemma-morphism-schemes-gives-representable-transformation}
Let $S$, $X$, $Y$ be objects of $\textit{Sch}_{fppf}$.
Let $f : X \to Y$ be a morphism of schemes.
Then the $1$-morphism induced by $f$
$$
(\textit{Sch}/X)_{fppf} \longrightarrow (\textit{Sch}/Y)_{fppf}
$$
is a representable $1$-morphism.
\end{lemma}

\begin{proof}
This is formal and relies only on the fact that
the category $(\textit{Sch}/S)_{fppf}$ has fibre products.
\end{proof}

\begin{lemma}
\label{lemma-composition-representable-transformations}
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
Let $\mathcal{X}, \mathcal{Y}, \mathcal{Z}$
be categories fibred in groupoids over $(\textit{Sch}/S)_{fppf}$
Let $f : \mathcal{X} \to \mathcal{Y}$, $g : \mathcal{Y} \to \mathcal{Z}$
be representable $1$-morphisms. Then
$$
g \circ f : \mathcal{X} \longrightarrow \mathcal{Z}
$$
is a representable $1$-morphism.
\end{lemma}

\begin{proof}
This is entirely formal and works in any category.
\end{proof}

\begin{lemma}
\label{lemma-base-change-representable-transformations}
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
Let $\mathcal{X}, \mathcal{Y}, \mathcal{Z}$
be categories fibred in groupoids over $(\textit{Sch}/S)_{fppf}$
Let $f : \mathcal{X} \to \mathcal{Y}$ be a representable $1$-morphism.
Let $g : \mathcal{Z} \to \mathcal{Y}$ be any $1$-morphism.
Consider the fibre product diagram
$$
\xymatrix{
\mathcal{Z} \times_{g, \mathcal{Y}, f} \mathcal{X} \ar[r]_-{g'} \ar[d]_{f'} &
\mathcal{X} \ar[d]^f \\
\mathcal{Z} \ar[r]^g & \mathcal{Y}
}
$$
Then the base change $f'$ is a representable $1$-morphism.
\end{lemma}

\begin{proof}
This is entirely formal and works in any category.
\end{proof}

\begin{lemma}
\label{lemma-product-representable-transformations}
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
Let $\mathcal{X}_i, \mathcal{Y}_i$ be categories fibred in groupoids over
$(\textit{Sch}/S)_{fppf}$, $i = 1, 2$.
Let $f_i : \mathcal{X}_i \to \mathcal{Y}_i$, $i = 1, 2$
be representable $1$-morphisms.
Then
$$
f_1 \times f_2 :
\mathcal{X}_1 \times \mathcal{X}_2
\longrightarrow
\mathcal{Y}_1 \times \mathcal{Y}_2
$$
is a representable $1$-morphism.
\end{lemma}

\begin{proof}
Write $f_1 \times f_2$ as the composition
$\mathcal{X}_1 \times \mathcal{X}_2 \to
\mathcal{Y}_1 \times \mathcal{X}_2 \to
\mathcal{Y}_1 \times \mathcal{Y}_2$.
The first arrow is the base change of $f_1$ by the map
$\mathcal{Y}_1 \times \mathcal{X}_2 \to \mathcal{Y}_1$, and the second arrow
is the base change of $f_2$ by the map
$\mathcal{Y}_1 \times \mathcal{Y}_2 \to \mathcal{Y}_2$.
Hence this lemma is a formal
consequence of Lemmas \ref{lemma-composition-representable-transformations}
and \ref{lemma-base-change-representable-transformations}.
\end{proof}






\section{Morphisms representable by algebraic spaces}
\label{section-representable-by-algebraic-spaces}

\noindent
A slightly weaker notion than being representable is the notion of
being representable by algebraic spaces. This discussion might have
been avoided had we worked with some category $\textit{Spaces}_{fppf}$
of algebraic spaces instead of the category $\textit{Sch}_{fppf}$.
However, it seems to us natural to consider the category of schemes
as the natural collection of ``test objects'' over which the fibre
categories of an algebraic stack are defined.

\medskip\noindent
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
Recall that given a presheaf
$$
F : (\textit{Sch}/S)_{fppf}^{opp} \longrightarrow \textit{Groupoids}
$$
we get a category fibred in groupoids $\mathcal{S}_F$ over
$(\textit{Sch}/S)_{fppf}$, see
Categories, Example \ref{categories-example-functor-groupoids}.
Any category fibred in groupoids isomorphic (!) to one of these
is called {\it split}, and any category fibred in groupoids
is equivalent to a split one.
If $F$ is a presheaf of sets then $\mathcal{S}_F$ is
fibred in sets (see Categories,
Definition \ref{categories-definition-category-fibred-sets}).

\medskip\noindent
An even more special case is where $F = h_X$ is a representable
presheaf (which is also a sheaf). In this case we have
$\mathcal{S}_F = (\textit{Sch}/X)_{fppf}$.

\medskip\noindent
In analogy with Categories, Definitions
\ref{categories-definition-representable-fibred-category} and
\ref{categories-definition-representable-map-categories-fibred-in-groupoids}
we make the following definition.

\begin{definition}
\label{definition-representable-by-algebraic-spaces}
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
\begin{enumerate}
\item A category fibred in groupoids
$p : \mathcal{X} \to (\textit{Sch}/S)_{fppf}$ is
called {\it representable by an algebraic space over $S$}
if there exists an algebraic space $F$ over $S$ and an equivalence
$j : \mathcal{X} \to \mathcal{S}_F$
in the $2$-category of groupoids over $(\textit{Sch}/S)_{fppf}$.
\item A $1$-morphism $f : \mathcal{X} \to \mathcal{Y}$ of
categories fibred in groupoids over $(\textit{Sch}/S)_{fppf}$
is called {\it representable by algebraic spaces} if
for any $U \in \text{Ob}((\textit{Sch}/S)_{fppf})$
and any $y : (\textit{Sch}/U)_{fppf} \to \mathcal{Y}$
the category fibred in groupoids
$$
(\textit{Sch}/U)_{fppf} \times_{y, \mathcal{Y}} \mathcal{X}
$$
over $(\textit{Sch}/U)_{fppf}$
is representable by an algebraic space over $U$.
\end{enumerate}
\end{definition}

\noindent
In the situation of
Definition \ref{definition-representable-by-algebraic-spaces} part (2)
choose an algebraic space $F_y$ over $U$ and an equivalence
$j :
\mathcal{S}_{F_y}
\to
(\textit{Sch}/U)_{fppf} \times_{y, \mathcal{Y}} \mathcal{X}$.
We will always consider $F_y$ as an algebraic stack over $S$, see
Spaces, Section \ref{spaces-section-change-base-scheme}.
The obvious morphism $F_y \to U$ is denoted $f_y$. Here is the diagram
\begin{equation}
\label{equation-representable-by-algebraic-spaces}
\vcenter{
\xymatrix{
F_y \ar@{~>}[r] \ar[d]_{f_y} &
\mathcal{S}_{F_y} \ar[d]_{\text{pr}_0 \circ j} \ar[r]_{\text{pr}_1 \circ j} &
\mathcal{X} \ar[d]^f \\
U \ar@{~>}[r] &
(\textit{Sch}/U)_{fppf} \ar[r]^-y &
\mathcal{Y}
}
}
\end{equation}
where the squiggly arrows represent the construction which associates
to a sheaf its split category fibred in sets. The right square is
$2$-commutative, and is a $2$-fibre product square.

\medskip\noindent
Here is the analogue of Categories,
Lemma \ref{categories-lemma-characterize-representable-fibred-category}.

\begin{lemma}
\label{lemma-characterize-representable-by-space}
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
Let $p : \mathcal{X} \to (\textit{Sch}/S)_{fppf}$
be a category fibred in groupoids.
Then $\mathcal{X}$ is representable by an algebraic space over $S$
if and only if the following conditions are satisfied:
\begin{enumerate}
\item $\mathcal{S}$ is fibred in setoids\footnote{This means that
it is fibred in groupoids and objects in the fibre categories
have no nontrivial automorphisms, see Categories,
Definition \ref{categories-definition-category-fibred-sets}.}, and
\item the presheaf $U \mapsto \text{Ob}(\mathcal{S}_U)/\cong$ is
an algebraic space.
\end{enumerate}
\end{lemma}

\begin{proof}
Omitted, but see Categories,
Lemma \ref{categories-lemma-characterize-representable-fibred-category}.
\end{proof}

\noindent
Here is the analogue of Categories,
Lemma \ref{categories-lemma-criterion-representable-map-stack-in-groupoids}.

\begin{lemma}
\label{lemma-criterion-map-representable-spaces-fibred-in-groupoids}
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
Let $\mathcal{X}$, $\mathcal{Y}$ be categories fibred in groupoids
over $(\textit{Sch}/S)_{fppf}$.
Let $f : \mathcal{X} \to \mathcal{Y}$ be a $1$-morphism.
Make a choice of pullbacks for $\mathcal{Y}$.
Assume
\begin{enumerate}
\item for each scheme $U/S$ the
functor $f_U : \mathcal{X}_U \longrightarrow \mathcal{Y}_U$
between fibre categories is faithful, and
\item for each $U$ and each $y \in \text{Ob}(\mathcal{Y}_U)$ the presheaf
$$
(h : V \to U)
\longmapsto
\{(x, \phi) \mid x \in \text{Ob}(\mathcal{X}_V), \phi : h^*y \to f(x)\}/\cong
$$
is an algebraic space over $U$.
\end{enumerate}
Then $f$ is representable by algebraic spaces.
\end{lemma}

\begin{proof}
Clear from the description of fibre categories in
Categories, Lemma \ref{categories-lemma-identify-fibre-product}
and Lemma \ref{lemma-characterize-representable-by-space}.
\end{proof}

\noindent
Here are some lemmas about this notion that work in great generality.

\begin{lemma}
\label{lemma-morphism-spaces-gives-representable-by-spaces}
Let $S$ be an object of $\textit{Sch}_{fppf}$.
Let $f : \mathcal{X} \to \mathcal{Y}$
be a $1$-morphism of categories fibred in groupoids over $S$.
If $\mathcal{X}$ and $\mathcal{Y}$ are representable by
algebraic spaces over $S$, then the $1$-morphism $f$
is representable by algebraic spaces.
\end{lemma}

\begin{proof}
Omitted. This relies only on the fact that
the category of algebraic spaces over $S$ has fibre products,
see Spaces, Lemma \ref{spaces-lemma-fibre-product-spaces}.
\end{proof}

\begin{lemma}
\label{lemma-base-change-by-space-representable-by-space}
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
Let $\mathcal{X}, \mathcal{Y}, \mathcal{Z}$
be categories fibred in groupoids over $(\textit{Sch}/S)_{fppf}$
Let $f : \mathcal{X} \to \mathcal{Y}$,
$g : \mathcal{Z} \to \mathcal{Y}$ be $1$-morphisms.
Assume
\begin{enumerate}
\item $f$ is representable by algebraic spaces, and
\item $\mathcal{Z}$ is representable by an algebraic space over $S$.
\end{enumerate}
Then the $2$-fibre product
$\mathcal{Z} \times_{g, \mathcal{Y}, f} \mathcal{X}$
is representable by an algebraic space.
\end{lemma}

\begin{proof}
The proof relies on
Spaces, Lemma \ref{spaces-lemma-representable-by-spaces-over-space}.
Namely, first you show that
$\mathcal{Z} \times_{g, \mathcal{Y}, f} \mathcal{X}$
is fibred in setoids over $(\textit{Sch}/S)_{fppf}$.
Hence it is equivalent to $\mathcal{S}_F$ for some presheaf
$F$ on $(\textit{Sch}/S)_{fppf}$, see
Categories, Lemma \ref{categories-lemma-setlike-fibres}.
Moreover, let $G$ be the algebraic space such that
$\mathcal{Z}$ is equivalent to $\mathcal{S}_G$. Then the
$1$-morphism
$\mathcal{Z} \times_{g, \mathcal{Y}, f} \mathcal{X} \to \mathcal{Z}$
comes from a unique morphism $F \to G$ (by looking at isomorphism
classes of objects in fibre categories). This morphism is representable
by algebraic spaces, and hence 
Spaces, Lemma \ref{spaces-lemma-representable-by-spaces-over-space}
applies. Some details omitted.
\end{proof}

\noindent
Let $S$, $\mathcal{X}$, $\mathcal{Y}$, $\mathcal{Z}$, $f$, $g$ be as in
Lemma \ref{lemma-base-change-by-space-representable-by-space}.
Let $F$, $G$ be algebraic spaces over $S$ such that $\mathcal{S}_G$
is equivalent to $\mathcal{Z}$, and $\mathcal{S}_F$ is equivalent
to $\mathcal{Z} \times_{g, \mathcal{Y}, f} \mathcal{X}$. The $1$-morphism
$f' : \mathcal{Z} \times_{g, \mathcal{Y}, f} \mathcal{X} \to \mathcal{Z}$
corresponds to a $1$-morphism
$\mathcal{S}_F \to \mathcal{S}_G$ well defined up to canonical isomorphism by
Categories, Lemma \ref{categories-lemma-morphisms-equivalent-fibred-groupoids}.
This in turn corresponds to a unique map of sheaves $f' : F \to G$, see
Categories, Lemma \ref{categories-lemma-2-category-fibred-sets}.
Thus we have the following diagram
\begin{equation}
\label{equation-representable-by-algebraic-spaces-on-space}
\vcenter{
\xymatrix{
F \ar@{~>}[r] \ar[d]_{f'} &
\mathcal{S}_F \ar[r] \ar[d] &
\mathcal{Z} \times_{g, \mathcal{Y}, f} \mathcal{X}
 \ar[d] \ar[r] &
\mathcal{X} \ar[d]^f \\
G \ar@{~>}[r] &
\mathcal{S}_G \ar[r] &
\mathcal{Z} \ar[r]^-g &
\mathcal{Y}
}
}
\end{equation}
where the squiggly arrows represent the construction which associates
to a sheaf its split category fibred in sets, and the middle square is
$2$-commutative with equivalences as horizontal arrows.

\begin{lemma}
\label{lemma-composition-representable-by-spaces}
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
Let $\mathcal{X}, \mathcal{Y}, \mathcal{Z}$
be categories fibred in groupoids over $(\textit{Sch}/S)_{fppf}$
If $f : \mathcal{X} \to \mathcal{Y}$, $g : \mathcal{Y} \to \mathcal{Z}$
are $1$-morphisms representable by algebraic spaces, then
$$
g \circ f : \mathcal{X} \longrightarrow \mathcal{Z}
$$
is a $1$-morphism representable by algebraic spaces.
\end{lemma}

\begin{proof}
This follows from
Lemma \ref{lemma-base-change-by-space-representable-by-space}.
Details omitted.
\end{proof}

\begin{lemma}
\label{lemma-base-change-representable-by-spaces}
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
Let $\mathcal{X}, \mathcal{Y}, \mathcal{Z}$
be categories fibred in groupoids over $(\textit{Sch}/S)_{fppf}$
Let $f : \mathcal{X} \to \mathcal{Y}$ be a $1$-morphism
representable by algebraic spaces.
Let $g : \mathcal{Z} \to \mathcal{Y}$ be any $1$-morphism.
Consider the fibre product diagram
$$
\xymatrix{
\mathcal{Z} \times_{g, \mathcal{Y}, f} \mathcal{X} \ar[r]_-{g'} \ar[d]_{f'} &
\mathcal{X} \ar[d]^f \\
\mathcal{Z} \ar[r]^g & \mathcal{Y}
}
$$
Then the base change $f'$ is a $1$-morphism representable by
algebraic spaces.
\end{lemma}

\begin{proof}
This is formal.
\end{proof}

\begin{lemma}
\label{lemma-product-representable-by-spaces}
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
Let $\mathcal{X}_i, \mathcal{Y}_i$ be categories fibred in groupoids over
$(\textit{Sch}/S)_{fppf}$, $i = 1, 2$.
Let $f_i : \mathcal{X}_i \to \mathcal{Y}_i$, $i = 1, 2$
be $1$-morphisms representable by algebraic spaces.
Then
$$
f_1 \times f_2 :
\mathcal{X}_1 \times \mathcal{X}_2
\longrightarrow
\mathcal{Y}_1 \times \mathcal{Y}_2
$$
is a $1$-morphism representable by algebraic spaces.
\end{lemma}

\begin{proof}
Write $f_1 \times f_2$ as the composition
$\mathcal{X}_1 \times \mathcal{X}_2 \to
\mathcal{Y}_1 \times \mathcal{X}_2 \to
\mathcal{Y}_1 \times \mathcal{Y}_2$.
The first arrow is the base change of $f_1$ by the map
$\mathcal{Y}_1 \times \mathcal{X}_2 \to \mathcal{Y}_1$, and the second arrow
is the base change of $f_2$ by the map
$\mathcal{Y}_1 \times \mathcal{Y}_2 \to \mathcal{Y}_2$.
Hence this lemma is a formal
consequence of Lemmas \ref{lemma-composition-representable-by-spaces}
and \ref{lemma-base-change-representable-by-spaces}.
\end{proof}












\section{Properties of morphisms representable by algebraic spaces}
\label{section-representable-properties}

\noindent
Here is the definition that makes this work.

\begin{definition}
\label{definition-relative-representable-property}
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
Let $f : \mathcal{X} \to \mathcal{Y}$ be a $1$-morphism
of categories fibred in groupoids over $(\textit{Sch}/S)_{fppf}$.
Assume $f$ is representable by algebraic spaces.
Let $P$ be a property of morphisms of algebraic spaces which
\begin{enumerate}
\item is preserved under any base change, and
\item is fppf local on the base, see
Descent and Spaces,
Definition \ref{spaces-descent-definition-property-morphisms-local}.
\end{enumerate}
In this case we say that $f$ has {\it property $P$} if for every
$U \in \text{Ob}((\textit{Sch}/S)_{fppf})$ and
any $y \in \mathcal{Y}_U$ the resulting morphism of algebraic spaces
$f_y : F_y \to U$, see
Equation (\ref{equation-representable-by-algebraic-spaces})
has property $P$.
\end{definition}

\noindent
It is important to note that we will only use this definition for
properties of morphisms that are stable under base change, and
local in the fppf topology on the target. This is
not because the definition doesn't make sense otherwise; rather it
is because we may want to give a different definition which is
better suited to the property we have in mind.

















\section{Stacks}
\label{section-stacks}

\noindent
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
Recall that a category $p : \mathcal{X} \to (\textit{Sch}/S)_{fppf}$
over $(\textit{Sch}/S)_{fppf}$ is said to be a
{\it stack in groupoids} (see
Stacks, Definition \ref{stacks-definition-stack-in-groupoids})
if and only if
\begin{enumerate}
\item $p : \mathcal{X} \to \mathcal{C}$ is fibred
in groupoids over $(\textit{Sch}/S)_{fppf}$,
\item for all $U \in \text{Ob}((\textit{Sch}/S)_{fppf})$,
for all $x, y\in \text{Ob}(\mathcal{X}_U)$ the presheaf
$\mathit{Isom}(x, y)$ is a sheaf on the site $(\textit{Sch}/S)_{fppf}$, and
\item for all coverings $\mathcal{U} = \{U_i \to U\}$ in
$(\textit{Sch}/S)_{fppf}$, all descent data $(x_i, \phi_{ij})$
for $\mathcal{U}$ are effective.
\end{enumerate}
As this may be a new notion we give some examples.

\begin{example}
\label{example-stack-associated-to-sheaf}
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
Let $F : (\textit{Sch}/S)_{fppf}^{opp} \to \textit{Sets}$ be a sheaf.
In this case the fibred category
$p_F : \mathcal{S}_F \to (\textit{Sch}/S)_{fppf}$ 
is a stack fibred in sets.
\end{example}

\begin{example}
\label{example-stack-of-quasi-coherent-sheaves}
The ``stack'' of quasi-coherent sheaves.
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
We denote
$$
p : \textit{QCoh} \to (\textit{Sch}/S)_{fppf}
$$
the category over $(\textit{Sch}/S)_{fppf}$ defined as follows.
\begin{enumerate}
\item An object of $\textit{QCoh}$ is a pair $(T, \mathcal{F})$,
where $T/S$ is an object of $(\textit{Sch}/S)_{fppf}$, and $\mathcal{F}$
is a quasi-coherent $\mathcal{O}_T$-module, and
\item a morphism $(f, \varphi) : (T, \mathcal{F}) \to (T', \mathcal{F}')$
is a pair consisting of a morphism $f : T \to T'$ of schemes over $S$
and an $f$-map (see
Sheaves, Definition \ref{sheaves-definition-f-map})
$\varphi : \mathcal{F}' \to \mathcal{F}$.
\end{enumerate}
The composition of morphisms
$$
(T, \mathcal{F}) \xrightarrow{(f, \varphi)}
(T', \mathcal{F}') \xrightarrow{(g, \psi)} (T'', \mathcal{F}'')
$$
is $(g \circ f, \varphi \circ \psi)$ where $\varphi \circ \psi$ is
as in
Sheaves, Definition \ref{sheaves-definition-composition-f-maps}.
Thus $\textit{QCoh}$ is a category and $p((T, \mathcal{F})) = T$
is a functor. Note that the fibre category $\textit{QCoh}_T$ over
a scheme $T$ is the category $\textit{QCoh}(T)$ of quasi-coherent
sheaves on $T$. So of course $\textit{QCoh}$ is not a stack in
groupoids over $(\textit{Sch}/S)_{fppf}$. It is also not a stack
because its collection of objects is a proper class, but it does
satisfy all the axioms of a stack. (We get around this
settheoretical issue in
Example \ref{example-stack-of-finitely-generated-quasi-coherent-sheaves}.)
\end{example}

\begin{lemma}
\label{lemma-stack-of-quasi-coherent-sheaves}
The functor $p : \textit{QCoh} \to (\textit{Sch}/S)_{fppf}$
constructed in Example \ref{example-stack-of-quasi-coherent-sheaves}
satisfies conditions (1), (2) and (3) of
Stacks, Definition \ref{stacks-definition-stack}.
\end{lemma}

\begin{proof}
To see this we have to show that (1) $\textit{QCoh}$ is fibred over
$(\textit{Sch}/S)_{fppf}$ and (2) for any fppf covering
$\mathcal{U} = \{T_i \to T\}_{i \in I}$ the functor
$$
\textit{QCoh}(T) \longrightarrow DD(\mathcal{U})
$$
is fully faithful and essentially surjective, see
Stacks, Lemma \ref{stacks-lemma-stack-equivalences}.
Part (1) follows from the observation that the strongly cartesian morphisms
of $\textit{QCoh}$ are exactly those morphisms
$(f, \varphi) : (T, \mathcal{F}) \to (T', \mathcal{F}')$
such that $\varphi$ induces an isomorphism
$f^*\mathcal{F}' \to \mathcal{F}$ (details omitted).
Part (2) follows from
Descent, Proposition \ref{descent-proposition-fpqc-descent-quasi-coherent}.
\end{proof}

\begin{example}
\label{example-stack-of-finitely-generated-quasi-coherent-sheaves}
The stack of finitely generated quasi-coherent sheaves.
Let us denote
$$
p_{fg} : \textit{QCoh}_{fg} \to (\textit{Sch}/S)_{fppf}
$$
the full subcategory of $\textit{QCoh}$ over $(\textit{Sch}/S)_{fppf}$ 
consisting of pairs $(T, \mathcal{F})$ such that $\mathcal{F}$
is a quasi-coherent $\mathcal{O}_T$-module of finite type. Then
$p_{fg} : \textit{QCoh}_{fg} \to (\textit{Sch}/S)_{fppf}$
also satisfies (1), (2) and (3) of
Stacks, Definition \ref{stacks-definition-stack}
as well as the additional condition (4) of
Stacks, Remark \ref{stacks-remark-stack-make-small}.
Hence we may replace $\textit{QCoh}_{fg}$ by a full subcategory
$\textit{QCoh}_{fg, small}$
which is a stack over $(\textit{Sch}/S)_{fppf}$ and such that
$\textit{QCoh}_{fg, small} \to \textit{QCoh}_{fg}$ is
fully faithfull and essentially surjective.
We will often perform this replacement without further
remarking on it, and by abuse of notation we will simply denote
$\textit{QCoh}_{fg}$ this replacement. Note that we may do
something similar if we want to consider those quasi-coherent sheaves
which are locally generated by at most $\kappa$ sections, for some
infinite cardinal $\kappa$, e.g., $\kappa = \aleph_0$.
\end{example}

\begin{example}
\label{example-stack-in-groupoids-of-quasi-coherent-sheaves}
The stack in groupoids of finitely generated quasi-coherent sheaves.
Let $p : \textit{QCoh}_{fg} \to (\textit{Sch}/S)_{fppf}$ be the stack
introduced in
Example \ref{example-stack-of-finitely-generated-quasi-coherent-sheaves}
(using the abuse of notation introduced there).
We can turn this into a stack in groupoids
$p' : \textit{QCoh}_{fg}' \to (\textit{Sch}/S)_{fppf}$ by
the procedure of
Categories, Lemma \ref{categories-lemma-fibred-gives-fibred-groupoids},
see
Stacks, Lemma \ref{stacks-lemma-stack-gives-stack-groupoids}.
In this particular case this simply means $\textit{QCoh}_{fg}'$ has
the same objects as $\textit{QCoh}_{fg}$ but the morphsms are
morphisms $(f, \varphi) : (T, \mathcal{F}) \to (T', \mathcal{F}')$
such that $\varphi$ induces an isomorphism $f^*\mathcal{F}' \to \mathcal{F}$.
\end{example}





















































\section{Algebraic stacks}
\label{section-algebraic-stacks}

\begin{definition}
\label{definition-algebraic-stack}
Let $S$ be a base scheme contained in $\textit{Sch}_{fppf}$.
An {\it algebraic stack over $S$} is a category
$$
p : \mathcal{X} \to (\textit{Sch}/S)_{fppf}
$$
over $(\textit{Sch}/S)_{fppf}$ with the following properties:
\begin{enumerate}
\item The category $\mathcal{X}$ is a stack in groupoids over
$(\textit{Sch}/S)_{fppf}$.
\item The diagonal
$\Delta : \mathcal{X} \to \mathcal{X}\times\mathcal{X}$
is representable by algebraic spaces.
\item There exists a scheme $U \in \text{Ob}((\textit{Sch}/S)_{fppf})$
and a $1$-morphism $U \to \mathcal{X}$ which is surjective and smooth.
\end{enumerate}
\end{definition}

\noindent
There are some differences with other definitions found in the literature.

\medskip\noindent
The first is that we require $\mathcal{X}$ to be a stack in groupoids
in the fppf topology, whereas in many references the etale topology is
used. It somehow seems to us that the fppf topology is the natural topology
to work with. In the end the resulting $2$-category of algebraic spaces
ends up being ``the same''. Namely, allthough the actual
stacks $\mathcal{X}$ being considered may be different, in the end the
category of algebraic stacks defined using sheaves in the etale topology
is equivalent the the category we define here. This will be clear later
when we introduce presentations (insert future reference here).

\medskip\noindent
The second is that we only require the diagonal map of $\mathcal{X}$ to be
representable by algebraic spaces, whereas in most references some other
conditions are imposed. Our point of view is to try to prove a certain
number of the results that follow only assuming that the diagonal
of $\mathcal{X}$ be representable by algebraic spaces, and simply add
an additional hypothesis wherever this is necessary. It has the added
benefit that any algebraic space (as defined in
Spaces, Definition \ref{spaces-definition-algebraic-space})
gives rise to an algebraic stack.

\medskip\noindent
The third is that in some papers it is required that there exists a
scheme $U$ and a surjective and etale morphism $U \to \mathcal{X}$.
In the groundbreaking paper \cite{DM} where algebraic stacks were first
introduced Deligne and Mumford used this definition and showed that
the moduli stack of stable genus $g > 1$ curves is an algebraic stack 
which has an etale covering by a scheme. Micheal Artin, see
\cite{artin_versal}, realized that many
natural results on algebraic stacks generalize to the case where one
only assume a smooth covering by a scheme. Hence our choice above.
To distinguish the two cases one sees the terms ``Deligne-Mumford stack''
and ``Artin stack'' used in the literature. We will reserve the term
``Artin stack'' for later use (insert future reference here), and continue
to use ``algebraic stack'', but we will use ``Deligne-Mumford stack''
to indicate those algebraic stacks which have an etale covering by a
scheme.

\begin{definition}
\label{definition-deligne-mumford}
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
Let $\mathcal{X}$ be an algebraic stack over $S$.
We say $\mathcal{X}$ is a {\it Deligne-Mumford stack} if there exists
a scheme and a surjective etale morphism $U \to \mathcal{X}$.
\end{definition}

\noindent
We will compare our notion of a Deligne-Mumford stack with
the notion as defined in the paper by Deligne and Mumford later
(see insert future reference here).

\medskip\noindent
The category of algebraic stacks over $S$ forms a $2$-category.
Here is the precise definition.

\begin{definition}
\label{definition-morphism-algebraic-stacks}
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
The {\it $2$-category of algebraic stacks over $S$} is the
sub $2$-category of the $2$-category of categories fibred in
groupoids over $(\textit{Sch}/S)_{fppf}$ (see
Categories,
Definition \ref{categories-definition-categories-fibred-in-groupoids-over-C})
defined as follows:
\begin{enumerate}
\item Its objects are those categories fibred in groupoids
over $(\textit{Sch}/S)_{fppf}$ which are algebraic stacks over $S$.
\item Its $1$-morphisms $f : \mathcal{X} \to \mathcal{Y}$ are
any functors of categories over $(\textit{Sch}/S)_{fppf}$, as in
Categories, Definition \ref{categories-definition-categories-over-C}.
\item Its $2$-morphisms are transformations between functors
over $(\textit{Sch}/S)_{fppf}$, as in
Categories, Definition \ref{categories-definition-categories-over-C}.
\end{enumerate}
\end{definition}

\noindent
In other words this $2$-category is the full sub $2$-category of
$\textit{Cat}/(\textit{Sch}/S)_{fppf}$ whose objects are algebraic stacks.
Note that every $2$-morphism is automatically an isomorphism.
Hence this is actually a $(2, 1)$-category and not just a $2$-category.

\medskip\noindent
We will see later (insert future reference here) that this $2$-category
has $2$-fibre products.

\medskip\noindent
Similar to the remark above the $2$-category of algebraic stacks over $S$ is a
full sub $2$-category of the $2$-category of categories fibred in groupoids
over $(\textit{Sch}/S)_{fppf}$. It turns out that it is closed under
equivalences. Here is the precise statement.

\begin{lemma}
\label{lemma-equivalent}
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
Let $\mathcal{X}$, $\mathcal{Y}$ be fibred in groupoids over
$(\textit{Sch}/S)_{fppf}$.
Let $f : \mathcal{X} \to \mathcal{Y}$ be an equivalence of
categories fibred in groupoids over $(\textit{Sch}/S)_{fppf}$.
Then $\mathcal{X}$ is an algebraic stack if and only if
$\mathcal{Y}$ is an algebraic stack. Similarly, $\mathcal{X}$
is a Deligne-Mumford stack if and only if $\mathcal{Y}$ is a Deligne-Mumford
stack.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}




\section{Algebraic stacks and algebraic spaces}
\label{section-stacks-spaces}

\noindent
Here is a sanity check.

\begin{lemma}
\label{lemma-representable-algebraic}
Let $S$ be a scheme contained in $\textit{Sch}_{fppf}$.
\begin{enumerate}
\item A category fibred in groupoids
$p : \mathcal{X} \to (\textit{Sch}/S)_{fppf}$
which is representable by an algebraic space is a Deligne-Mumford stack.
\item If $F$ is an algebraic space over $S$, then the associated
category fibred in groupoids
$p_F : \mathcal{S}_F \to (\textit{Sch}/S)_{fppf}$
is a Deligne-Mumford stack.
\item If $X \in \text{Ob}((\textit{Sch}/S)_{fppf})$, then
$(\textit{Sch}/X)_{fppf} \to (\textit{Sch}/S)_{fppf}$ is
a Deligne-Mumford stack.
\end{enumerate}
\end{lemma}

\begin{proof}
Omitted.
\end{proof}















\input{chapters}

\bibliography{my}
\bibliographystyle{amsalpha}

\end{document}
