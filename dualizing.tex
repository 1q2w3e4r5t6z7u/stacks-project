\input{preamble}

% OK, start here.
%
\begin{document}

\title{Dualizing Complexes}


\maketitle

\phantomsection
\label{section-phantom}

\tableofcontents

\section{Introduction}
\label{section-introduction}

\noindent
A reference is the book \cite{R+D}.

\medskip\noindent
The goals of this chapter are the following:
\begin{enumerate}
\item Define what it means to have a dualizing complex $\omega_A^\bullet$
over a Noetherian ring $A$, namely
\begin{enumerate}
\item we have $\omega_A^\bullet \in D^{+}(A)$,
\item the cohomology modules $H^i(\omega_A^\bullet)$ are
all finite $A$-modules,
\item $\omega_A^\bullet$ has finite injective dimension, and
\item we have $A \to R\Hom_A(\omega_A^\bullet, \omega_A^\bullet)$
is a quasi-isomorphism.
\end{enumerate}
\item List elementary properties of dualizing complexes.
\item Show a dualizing complex gives rise to a dimension function.
\item Show a dualizing complex gives rise to a good notion of a
reflexive hull.
\item Prove the finiteness theorem when a dualizing complex exists.
\end{enumerate}






\section{Essential surjections and injections}
\label{section-essential}

\noindent
We will mostly work in categories of modules, but we may as well make
the definition in general.

\begin{definition}
\label{definition-essential}
Let $\mathcal{A}$ be an abelian category.
\begin{enumerate}
\item An injection $A \subset B$ of $\mathcal{A}$ is {\it essential},
or we say that $B$ is an {\it essential extension of} $A$,
if every nonzero subobject $B' \subset B$ has nonzero intersection with $A$.
\item A surjection $f : A \to B$ of $\mathcal{A}$ is {\it essential}
if for every proper subobject $A' \subset A$ we have $f(A') \not = B$.
\end{enumerate}
\end{definition}

\noindent
Some lemmas about this notion.

\begin{lemma}
\label{lemma-essential}
Let $\mathcal{A}$ be an abelian category.
\begin{enumerate}
\item If $A \subset B$ and $B \subset C$ are essential extensions, then
$A \subset C$ is an essential extension.
\item If $A \subset B$ is an essential extension and $C \subset B$
is a subobject, then $A \cap C \subset C$ is an essential extension.
\item If $A \to B$ and $B \to C$ are essential surjections, then
$A \to C$ is an essential surjection.
\item Given an essential surjection $f : A \to B$ and a surjection
$A \to C$ with kernel $K$, the morphism $C \to B/f(K)$ is an essential
surjection.
\end{enumerate}
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-union-essential-extensions}
Let $R$ be a ring. Let $M$ be an $R$-module. Let $E = \colim E_i$
be a filtered colimit of $R$-modules. Suppose given a compatible
system of essential injections $M \to E_i$ of $R$-modules.
Then $M \to E$ is an essential extension of $M$.
\end{lemma}

\begin{proof}
Immediate from the definitions and the fact that filtered
colimits are exact (Algebra, Lemma \ref{algebra-lemma-directed-colimit-exact}).
\end{proof}

\begin{lemma}
\label{lemma-essential-extension}
Let $R$ be a ring. Let $M \subset N$ be $R$-modules. The following
are equivalent
\begin{enumerate}
\item $M \subset N$ is an essential extension,
\item for all $x \in N$ there exists an $f \in R$ such that $fx \in M$
and $fx \not = 0$.
\end{enumerate}
\end{lemma}

\begin{proof}
Assume (1) and let $x \in N$ be a nonzero element. By (1) we have
$Rx \cap M \not = 0$. This implies (2).

\medskip\noindent
Assume (2). Let $N' \subset N$ be a nonzero submodule. Pick $x \in N'$
nonzero. By (2) we can find $f \in $ with $fx \in N$ and $fx \not = 0$.
Thus $N' \cap M \not = 0$.
\end{proof}




\section{Injective modules}
\label{section-injective-modules}

\noindent
Some results about injective modules over rings.

\begin{lemma}
\label{lemma-product-injectives}
Let $R$ be a ring. Any product of injective $R$-modules is injective.
\end{lemma}

\begin{proof}
Special case of Homology, Lemma \ref{homology-lemma-product-injectives}.
\end{proof}

\begin{lemma}
\label{lemma-injective-flat}
Let $R \to S$ be a flat ring map. If $E$ is an injective $S$-module,
then $E$ is injective as an $R$-module.
\end{lemma}

\begin{proof}
This is true because $\Hom_R(M, E) = \Hom_S(M \otimes_R S, E)$
by Algebra, Lemma \ref{algebra-lemma-adjoint-tensor-restrict}
and the fact that tensoring with $S$ is exact.
\end{proof}

\begin{lemma}
\label{lemma-injective-epimorphism}
Let $R \to S$ be an epimorphism of rings. Let $E$ be an $S$-module.
If $E$ is injective as an $R$-module, then $E$ is an injective $S$-module.
\end{lemma}

\begin{proof}
This is true because $\Hom_R(N, E) = \Hom_S(N, E)$ for any $S$-module $N$,
see Algebra, Lemma \ref{algebra-lemma-epimorphism-modules}.
\end{proof}

\begin{lemma}
\label{lemma-hom-injective}
Let $R \to S$ be a ring map. If $E$ is an injective $R$-module,
then $\Hom_R(S, E)$ is an injective $S$-module.
\end{lemma}

\begin{proof}
This is true because $\Hom_S(N, \Hom_R(S, E)) = \Hom_R(N, E)$ by
Algebra, Lemma \ref{algebra-lemma-adjoint-hom-restrict}.
\end{proof}

\begin{lemma}
\label{lemma-essential-extensions-in-injective}
Let $R$ be a ring. Let $I$ be an injective $R$-module. Let $E \subset I$
be a submodule. The following are equivalent
\begin{enumerate}
\item $E$ is injective, and
\item for all $E \subset E' \subset I$ with $E \subset E'$ essential
we have $E = E'$.
\end{enumerate}
In particular, an $R$-module is injective if and only if every essential
extension is trivial.
\end{lemma}

\begin{proof}
The final assertion follows from the first and the fact that the
category of $R$-modules has enough injectives
(More on Algebra, Section \ref{more-algebra-section-injectives-modules}).

\medskip\noindent
Assume (1). Let $E \subset E' \subset I$ as in (2).
Then the map $\text{id}_E : E \to E$ can be extended
to a map $\alpha : E' \to E$. The kernel of $\alpha$ has to be
zero because it intersects $E$ trivially and $E'$ is an essential
extension. Hence $E = E'$.

\medskip\noindent
Assume (2). Let $M \subset N$ be $R$-modules and let $\varphi : M \to E$
be an $R$-module map. In order to prove (1) we have to show that
$\varphi$ extends to a morphism $N \to E$. Consider the set $\mathcal{S}$
of pairs
$(M', \varphi')$ where $M \subset M' \subset N$ and $\varphi' : M' \to E$
is an $R$-module map agreeing with $\varphi$ on $M$. We define an ordering
on $\mathcal{S}$ by the rule $(M', \varphi') \leq (M'', \varphi'')$
if and only if $M' \subset M''$ and $\varphi''|_{M'} = \varphi'$.
It is clear that we can take the maximum of a totally ordered subset
of $\mathcal{S}$. Hence by Zorn's lemma we may assume $(M, \varphi)$
is a maximal element.

\medskip\noindent
Choose an extension $\psi : N \to I$ of $\varphi$ composed
with the inclusion $E \to I$. This is possible as $I$ is injective.
If $\psi(N) \subset E$, then $\psi$ is the desired extension.
If $\psi(N)$ is not contained in $E$, then by (2) the inclusion
$E \subset E + \psi(N)$ is not essential. hence
we can find a nonzero submodule $K \subset E + \psi(N)$ meeting $E$ in $0$.
This means that $M' = \psi^{-1}(E + K)$ strictly contains $M$.
Thus we can extend $\varphi$ to $M'$ using
$$
M' \xrightarrow{\psi|_{M'}} E + K \to (E + K)/K = E
$$
This contradicts the maximality of $(M, \varphi)$.
\end{proof}

\begin{example}
\label{example-reduced-ring-injective}
Let $R$ be a reduced ring. Let $\mathfrak p \subset R$ be a minimal prime
so that $K = R_\mathfrak p$ is a field
(Algebra, Lemma \ref{algebra-lemma-minimal-prime-reduced-ring}).
Then $K$ is an injective $R$-module. Namely, we have
$\Hom_R(M, K) = \Hom_K(M_\mathfrak p, K)$ for any $R$-module
$M$. Since localization is an exact functor and taking duals is
an exact functor on $K$-vector spaces we conclude $\Hom_R(-, K)$
is an exact functor, i.e., $K$ is an injective $R$-module.
\end{example}

\begin{lemma}
\label{lemma-characterize-injective}
Let $R$ be a ring. Let $E$ be an $R$-module. The following are equivalent
\begin{enumerate}
\item $E$ is an injective $R$-module, and
\item given an ideal $I \subset R$ and a module map $\varphi: I \to E$
there exists an extension of $\varphi$ to and $R$-module map $R \to E$.
\end{enumerate}
\end{lemma}

\begin{proof}
The implication (1) $\Rightarrow$ (2) follows from the definitions.
Thus we assume (2) holds and we prove (1).
First proof: Since $R$ is a generator for the category of $R$-modules,
this follows from
Injectives, Lemma \ref{injectives-lemma-characterize-injective}.

\medskip\noindent
Second proof: We have to show that every essential extension $E \subset E'$
is trivial. Pick $x \in E'$ and set $I = \{f \in R \mid fx \in E\}$.
The map $I \to E$, $f \mapsto fx$ extends to $\psi : R \to E$ by (2).
Then $x' = x - \psi(1)$ is an element of $E'$ whose annihilator in
$E'/E$ is $I$ and which is annihilated by $I$ as an element of $E'$.
Thus $Rx' = (R/I)x'$ does not intersect $E$. Since $E \subset E'$
is an essential extension it follows that $x' \in E$ as desired.
\end{proof}

\begin{lemma}
\label{lemma-sum-injective-modules}
Let $R$ be a Noetherian ring. A direct sum of injective modules
is injective.
\end{lemma}

\begin{proof}
Let $E_i$ be a family of injective modules parametrized by a set $I$.
Set $E = \bigcup E_i$. To show that $E$ is injective we use
Lemma \ref{lemma-characterize-injective}.
Thus let $\varphi : I \to E$ be a module map from an ideal of $R$
into $E$. As $I$ is a finite $R$-module (because $R$ is Noetherian)
we can find finitely many elements $i_1, \ldots, i_r \in I$
such that $\varphi$ maps into $\bigcup_{j = 1, \ldots, r} E_{i_j}$.
Then we can extend $\varphi$ into $\bigcup_{j = 1, \ldots, r} E_{i_j}$
using the injectivity of the modules $E_{i_j}$.
\end{proof}

\begin{lemma}
\label{lemma-injective-module-divide}
Let $R$ be a Noetherian ring. Let $I$ be an injective $R$-module.
\begin{enumerate}
\item Let $f \in R$. Then $E = \{x \in I \mid \exists\ n,\ f^n x  = 0\}$
is an injective submodule of $I$.
\item Let $J \subset R$ be an ideal. Then the $J$-power torsion
submodule $I[J^\infty]$ is an injective submodule of $I$.
\end{enumerate}
\end{lemma}

\begin{proof}
We will use Lemma \ref{lemma-essential-extensions-in-injective}
to prove (1).
Suppose that $E \subset E' \subset I$ and that $E'$ is an essential
extension of $E$. We will show that $E' = E$. If not, then we can
find $x \in E'$ and $x \not \in E$. Let $J = \{a \in R \mid ax \in E'\}$.
Since $R$ is Noetherian we can choose $x$ with $J$ maximal.
Since $R$ is Noetherian we can write $J = (g_1, \ldots, g_t)$ for some
$g_i \in R$. Say $f^{n_i}$ annihilates $g_ix$. Set $n = \max\{n_i\}$.
Then $x' = f^n x$ is an element of $E'$ not in $E$ and is annihilated
by $J$. By maximality of $J$ we see that $R x' = (R/J)x'  \cap E = (0)$.
Hence $E'$ is not an essential extension of $E$ a contradiction.

\medskip\noindent
To prove (2) write $J = (f_1, \ldots, f_t)$. Then
$I[J^\infty]$ is equal to
$$
(\ldots((I[f_1^\infty])[f_2^\infty])\ldots)[f_t^\infty]
$$
and the result follows from (1) and induction.
\end{proof}



\section{Projective covers}
\label{section-projective-cover}

\noindent
In this section we briefly discuss projective covers.

\begin{definition}
\label{definition-projective-cover}
Let $R$ be a ring. A surjection $P \to M$ of $R$-modules is said
to be a {\it projective cover}, or sometimes a {\it projective envelope},
if $P$ is a projective $R$-module and $P \to M$ is an essential
surjection.
\end{definition}

\noindent
Projective covers do not always exist. For example, if $k$ is a field
and $R = k[x]$ is the polynomial ring over $k$, then the module $M = R/(x)$
does not have a projective cover. Namely, for any surjection $f : P \to M$
with $P$ projective over $R$, the proper submodule $(x - 1)P$ surjects
onto $M$. Hence $f$ is not essential.

\begin{lemma}
\label{lemma-projective-cover-unique}
Let $R$ be a ring and let $M$ be an $R$-module. If a projective cover
of $M$ exists, then it is unique up to isomorphism.
\end{lemma}

\begin{proof}
Let $P \to M$ and $P' \to M$ be projective covers. Because $P$ is a
projective $R$-module and $P' \to M$ is surjective, we can find an
$R$-module map $\alpha : P \to P'$ compatible with the maps to $M$.
Since $P' \to M$ is essential, we see that $\alpha$ is surjective.
As $P'$ is a projective $R$-module we can choose a direct sum decomposition
$P = \Ker(\alpha) \oplus P'$. Since $P' \to M$ is surjective
and since $P \to M$ is essential we conclude that $\Ker(\alpha)$
is zero as desired.
\end{proof}

\noindent
Here is an example where projective covers exist.

\begin{lemma}
\label{lemma-projective-covers-local}
Let $(R, \mathfrak m, \kappa)$ be a local ring. Any finite $R$-module has
a projective cover.
\end{lemma}

\begin{proof}
Let $M$ be a finite $R$-module. Let $r = \dim_\kappa(M/\mathfrak m M)$.
Choose $x_1, \ldots, x_r \in M$ mapping to a basis of $M/\mathfrak m M$.
Consider the map $f : R^{\oplus r} \to M$. By Nakayama's lemma this is
a surjection (Algebra, Lemma \ref{algebra-lemma-NAK}). If
$N \subset R^{\oplus R}$ is a proper submodule, then
$N/\mathfrak m N \to \kappa^{\oplus r}$ is not surjective (by
Nakayama's lemma again) hence $N/\mathfrak m N \to M/\mathfrak m M$
is not surjective. Thus $f$ is an essential surjection.
\end{proof}







\section{Injective hulls}
\label{section-injective-hull}

\noindent
In this section we briefly discuss injective hulls.

\begin{definition}
\label{definition-injective-hull}
Let $R$ be a ring. A injection $M \to I$ of $R$-modules is said
to be an {\it injective hull} if $I$ is a injective $R$-module and
$M \to I$ is an essential injection.
\end{definition}

\noindent
Injective hulls always exist.

\begin{lemma}
\label{lemma-injective-hull}
Let $R$ be a ring. Any $R$-module has an injective hull.
\end{lemma}

\begin{proof}
Let $M$ be an $R$-module. By
More on Algebra, Section \ref{more-algebra-section-injectives-modules}
the category of $R$-modules has enough injectives.
Choose an injection $M \to I$ with $I$ an injective $R$-module.
Consider the set $\mathcal{S}$ of submodules $M \subset E \subset I$
such that $E$ is an essential extension of $M$. We order $\mathcal{S}$
by inclusion. If $\{E_\alpha\}$ is a totally ordered subset
of $\mathcal{S}$, then $\bigcup E_\alpha$ is an essential extension of $M$
too (Lemma \ref{lemma-union-essential-extensions}).
Thus we can apply Zorn's lemma and find a maximal element
$E \in \mathcal{S}$. We claim $M \subset E$ is an injective hull, i.e.,
$E$ is an injective $R$-module. This follows from
Lemma \ref{lemma-essential-extensions-in-injective}.
\end{proof}

\begin{lemma}
\label{lemma-injective-hull-unique}
Let $R$ be a ring. Let $M$, $N$ be $R$-modules and let $M \to E$
and $N \to E'$ be injective hulls. Then
\begin{enumerate}
\item for any $R$-module map $\varphi : M \to N$ there exists an
$R$-module map $\psi : E \to E'$ such that
$$
\xymatrix{
M \ar[r] \ar[d]_\varphi & E \ar[d]^\psi \\
N \ar[r] & E'
}
$$
commutes,
\item if $\varphi$ is injective, then $\psi$ is injective,
\item if $\varphi$ is an essential injection, then $\psi$ is an isomorphism,
\item if $\varphi$ is an isomorphism, then $\psi$ is an isomorphism,
\item if $M \to I$ is an embedding of $M$ into an injective $R$-module,
then there is an isomorphism $I \cong E \oplus I'$ compatible with
the embeddings of $M$,
\end{enumerate}
In particular, the injective hull $E$ of $M$ is unique up to isomorphism.
\end{lemma}

\begin{proof}
Part (1) follows from the fact that $E'$ is an injective $R$-module.
Part (2) follows as $\Ker(\psi) \cap M = 0$
and $E$ is an essential extension of $M$.
Assume $\varphi$ is an essential injection. Then
$E \cong \psi(E) \subset E'$ by (2) which implies
$E' = \psi(E) \oplus E''$ because $E$ is injective.
Since $E'$ is an essential extension of
$M$ (Lemma \ref{lemma-essential}) we get $E'' = 0$.
Part (4) is a special case of (3).
Assume $M \to I$ as in (5).
Choose a map $\alpha : E \to I$ extending the map $M \to I$.
Arguing as before we see that $\alpha$ is injective.
Thus as before $\alpha(E)$ splits off from $I$.
This proves (5).
\end{proof}

\begin{example}
\label{example-injective-hull-domain}
Let $R$ be a domain with fraction field $K$. Then $R \subset K$ is an
injective hull of $R$. Namely, by
Example \ref{example-reduced-ring-injective} we see that $K$ is an injective
$R$-module and by Lemma \ref{lemma-essential-extension} we see that
$R \subset K$ is an essential extension.
\end{example}

\begin{definition}
\label{definition-indecomposable}
An object $X$ of an additive category is called {\it indecomposable}
if it is nonzero and if $X = Y \oplus Z$, then either $Y = 0$ or $Z = 0$.
\end{definition}

\begin{lemma}
\label{lemma-indecomposable-injective}
Let $R$ be a ring. Let $E$ be an indecomposable injective $R$-module.
Then
\begin{enumerate}
\item $E$ is the injective hull of any nonzero submodule of $E$,
\item the intersection of any two nonzero submodules of $E$ is nonzero,
\item $\text{End}_R(E, E)$ is a noncommutative local ring with maximal
ideal those $\varphi : E \to E$ whose kernel is nonzero, and
\item the set of zerodivisors on $E$ is a prime ideal $\mathfrak p$ of $R$
and $E$ is an injective $R_\mathfrak p$-module.
\end{enumerate}
\end{lemma}

\begin{proof}
Part (1) follows from Lemma \ref{lemma-injective-hull-unique}.
Part (2) follows from part (1) and the definition of injective hulls.

\medskip\noindent
Proof of (3). Set $A = \text{End}_R(E, E)$ and
$I = \{\varphi \in A \mid \Ker(f) \not = 0\}$.
The statement means that $I$ is a two sided ideal and
that any $\varphi \in A$, $\varphi \not \in I$ is invertible.
Suppose $\varphi$ and $\psi$ are not injective.
Then $\Ker(\varphi) \cap \Ker(\psi)$ is nonzero
by (2). Hence $\varphi + \psi \in I$. It follows that $I$
is a two sided ideal. If $\varphi \in A$, $\varphi \not \in I$,
then $E \cong \varphi(E) \subset E$ is an injective submodule,
hence $E = \varphi(E)$ because $E$ is indecomposable.

\medskip\noindent
Proof of (4). Consider the ring map $R \to A$ and let $\mathfrak p \subset R$
be the inverse image of the maximal ideal $I$. Then it is clear
that $\mathfrak p$ is a prime ideal and that $R \to A$ extends to
$R_\mathfrak p \to A$. Thus $E$ is an $R_\mathfrak p$-module.
It follows from Lemma \ref{lemma-injective-epimorphism} that $E$ is injective
as an $R_\mathfrak p$-module.
\end{proof}

\begin{lemma}
\label{lemma-injective-hull-indecomposable}
Let $\mathfrak p \subset R$ be a prime of a ring $R$.
Let $E$ be the injective hull of $R/\mathfrak p$. Then
\begin{enumerate}
\item $E$ is indecomposable,
\item $E$ is the injective hull of $\kappa(\mathfrak p)$,
\item $E$ is the injective hull of $\kappa(\mathfrak p)$
over the ring $R_\mathfrak p$.
\end{enumerate}
\end{lemma}

\begin{proof}
As $R/\mathfrak p \subset \kappa(\mathfrak p)$ we can extend the embedding
to a map $\kappa(\mathfrak p) \to E$. Hence (2) holds.
For $f \in R$, $f \not \in \mathfrak p$
the map $f : \kappa(\mathfrak p) \to \kappa(\mathfrak p)$ is an isomorphism
hence the map $f : E \to E$ is an isomorphism,
see Lemma \ref{lemma-injective-hull-unique}.
Thus $E$ is an $R_\mathfrak p$-module. It is injective
as an $R_\mathfrak p$-module by Lemma \ref{lemma-injective-epimorphism}.
Finally, let $E' \subset E$ be a nonzero injective $R$-submodule.
Then $J = (R/\mathfrak p) \cap E'$ is nonzero. After shrinking $E'$
we may assume that $E'$ is the injective hull of $J$ (see
Lemma \ref{lemma-injective-hull-unique} for example).
Observe that $R/\mathfrak p$ is an essential extension of $J$ for example by
Lemma \ref{lemma-essential-extension}. Hence $E' \to E$
is an isomorphism by Lemma \ref{lemma-injective-hull-unique} part (3).
Hence $E$ is indecomposable.
\end{proof}

\begin{lemma}
\label{lemma-indecomposable-injective-noetherian}
Let $R$ be a Noetherian ring. Let $E$ be an indecomposable injective
$R$-module. Then there exists a prime ideal $\mathfrak p$ of $R$ such that
$E$ is the injective hull of $\kappa(\mathfrak p)$.
\end{lemma}

\begin{proof}
Let $\mathfrak p$ be the prime ideal found in
Lemma \ref{lemma-indecomposable-injective}.
Say $\mathfrak p = (f_1, \ldots, f_r)$.
Pick a nonzero element $x \in \bigcap \Ker(f_i : E \to E)$,
see Lemma \ref{lemma-indecomposable-injective}.
Then $(R_\mathfrak p)x$ is a module isomorphic to $\kappa(\mathfrak p)$
inside $E$. We conclude by Lemma \ref{lemma-indecomposable-injective}.
\end{proof}

\begin{proposition}[Structure injective modules over Noetherian rings]
\label{proposition-structure-injectives-noetherian}
Let $R$ be a Noetherian ring.
Every injective module is a direct sum of indecomposable injective modules.
Every indecomposable injective module is the injective hull of
the residue field at a prime.
\end{proposition}

\begin{proof}
The second statement is Lemma \ref{lemma-indecomposable-injective-noetherian}.
For the second statement, let $I$ be an injective $R$-module.
We will use transfinite induction to construct $I_\alpha \subset I$
for ordinals $\alpha$ which are direct sums of indecomposable injective
$R$-modules $E_{\beta + 1}$ for $\beta < \alpha$.
For $\alpha = 0$ we let $I_0 = 0$. Suppose given an ordinal $\alpha$
such that $I_\alpha$ has been constructed. Then $I_\alpha$ is an
injective $R$-module by Lemma \ref{lemma-sum-injective-modules}.
Hence $I \cong I_\alpha \oplus I'$. If $I' = 0$ we are done.
If not, then $I'$ has an associated prime by
Algebra, Lemma \ref{algebra-lemma-ass-zero}.
Thus $I'$ contains a copy of $R/\mathfrak p$ for some prime $\mathfrak p$.
Hence $I'$ contains an indecomposable submodule $E$ by
Lemmas \ref{lemma-injective-hull-unique} and
\ref{lemma-injective-hull-indecomposable}. Set
$I_{\alpha + 1} = I_\alpha \oplus E_\alpha$.
If $\alpha$ is a limit ordinal and $I_\beta$ has been constructed
for $\beta < \alpha$, then we set
$I_\alpha = \bigcup_{\beta < \alpha} I_\beta$.
Observe that $I_\alpha = \bigoplus_{\beta < \alpha} E_{\beta + 1}$.
This concludes the proof.
\end{proof}



\section{Duality over Artinian local rings}
\label{section-artinian}

\noindent
Let $(R, \mathfrak m, \kappa)$ be an artinian local ring.
Recall that this implies $R$ is Noetherian and that $R$ has finite
length as an $R$-module. Moreover an $R$-module is finite if and
only if it has finite length. We will use these facts without
further mention in this section. Please see
Algebra, Sections \ref{algebra-section-length} and
\ref{algebra-section-artinian}
and
Algebra, Proposition \ref{algebra-proposition-dimension-zero-ring}
for more details.

\begin{lemma}
\label{lemma-finite}
Let $(R, \mathfrak m, \kappa)$ be an artinian local ring.
Let $E$ be an injective hull of $\kappa$. For every finite
$R$-module $M$ we have
$$
\text{length}_R(M) = \text{length}_R(\Hom_R(M, E))
$$
In particular, the injective hull $E$ of $\kappa$ is a finite $R$-module.
\end{lemma}

\begin{proof}
Because $E$ is an essential extension of $\kappa$ we have
$\kappa = E[\mathfrak m]$ where $E[\mathfrak m]$ is the
$\mathfrak m$-torsion in $E$ (notation as in More on Algebra, Section
\ref{more-algebra-section-formal-glueing}).
Hence $\Hom_R(\kappa, E) \cong \kappa$ and the equality of lengths
holds for $M = \kappa$. We prove the displayed equality of the lemma
by induction on the length of $M$. If $M$ is nonzero there exists a surjection
$M \to \kappa$ with kernel $M'$. Since the functor $M \mapsto \Hom_R(M, E)$
is exact we obtain a short exact sequence
$$
0 \to \Hom_R(\kappa, E) \to \Hom_R(M, E) \to \Hom_R(M', E) \to 0.
$$
Additivity of length for this sequence and the sequence
$0 \to M' \to M \to \kappa \to 0$ and the equality for $M'$ (induction
hypothesis) and $\kappa$ implies the equality for $M$.
The final statement of the lemma follows as $E = \Hom_R(R, E)$.
\end{proof}

\begin{lemma}
\label{lemma-evaluate}
Let $(R, \mathfrak m, \kappa)$ be an artinian local ring.
Let $E$ be an injective hull of $\kappa$.
For any finite $R$-module $M$ the evaluation map
$$
M \longrightarrow \Hom_R(\Hom_R(M, E), E)
$$
is an isomorphism. In particular $R = \Hom_R(E, E)$.
\end{lemma}

\begin{proof}
Observe that the displayed arrow is injective. Namely, if $x \in M$ is
a nonzero element, then there is a nonzero map $Rx \to \kappa$ which
we can extend to a map $\varphi : M \to E$ that doesn't vanish on $x$.
Since the source and target of the arrow have the same length by
Lemma \ref{lemma-finite}
we conclude it is an isomorphism. The final statement follows
on taking $M = R$.
\end{proof}

\noindent
To state the next lemma, denote $\text{Mod}^{fg}_R$ the category of finite
$R$-modules over a ring $R$.

\begin{lemma}
\label{lemma-duality}
Let $(R, \mathfrak m, \kappa)$ be an artinian local ring.
Let $E$ be an injective hull of $\kappa$.
The functor $D(-) = \Hom_R(-, E)$ induces an exact anti-equivalence
$\text{Mod}^{fg}_R \to \text{Mod}^{fg}_R$ and
$D \circ D \cong \text{id}$.
\end{lemma}

\begin{proof}
We have seen that $D \circ D = \text{id}$ on $\text{Mod}^{fg}_R$
in Lemma \ref{lemma-evaluate}. It follows immediately that
$D$ is an anti-equivalence.
\end{proof}

\begin{lemma}
\label{lemma-duality-torsion-cotorsion}
Assumptions and notation as in Lemma \ref{lemma-duality}.
Let $I \subset R$ be an ideal and $M$ a finite $R$-module.
Then
$$
D(M[I]) = D(M)/ID(M) \quad\text{and}\quad D(M/IM) = D(M)[I]
$$
\end{lemma}

\begin{proof}
Say $I = (f_1, \ldots, f_t)$. Consider the map
$$
M^{\oplus t} \xrightarrow{f_1, \ldots, f_t} M
$$
with cokernel $M/IM$. Applying the exact functor $D$ we conclude that
$D(M/IM)$ is $D(M)[I]$. The other case is proved in the same way.
\end{proof}



\section{Injective hull of the residue field}
\label{section-hull-residue-field}

\noindent
Most of our results will be for Noetherian local rings in this section.

\begin{lemma}
\label{lemma-quotient}
Let $R \to S$ be a surjective map of local rings with kernel $I$.
Let $E$ be the injective hull of the residue field of $R$ over $R$.
Then $E[I]$ is the injective hull of the residue field of $S$ over $S$.
\end{lemma}

\begin{proof}
Observe that $E[I] = \Hom_R(S, E)$ as $S = R/I$. Hence $E[I]$ is an injective
$S$-module by Lemma \ref{lemma-hom-injective}. Since $E$ is an essential
extension of $\kappa = R/\mathfrak m_R$ it follows that $E[I]$ is an
essential extension of $\kappa$ as well. The result follows.
\end{proof}

\begin{lemma}
\label{lemma-torsion-submodule-sum-injective-hulls}
Let $(R, \mathfrak m, \kappa)$ be a local ring.
Let $E$ be the injective hull of $\kappa$.
Let $M$ be a $\mathfrak m$-power torsion $R$-module
with $n = \dim_\kappa(M[\mathfrak m]) < \infty$.
Then $M$ is isomorphic to a submodule of $E^{\oplus n}$.
\end{lemma}

\begin{proof}
Observe that $E^{\oplus n}$ is the injective hull of
$\kappa^{\oplus n} = M[\mathfrak m]$. Thus there is an $R$-module map
$M \to E^{\oplus n}$ which is injective on $M[\mathfrak m]$.
Since $M$ is $\mathfrak m$-power torsion the inclusion
$M[\mathfrak m] \subset M$ is an essential extension
(for example by Lemma \ref{lemma-essential-extension})
we conclude that the kernel of $M \to E^{\oplus n}$ is zero.
\end{proof}

\begin{lemma}
\label{lemma-union-artinian}
Let $(R, \mathfrak m, \kappa)$ be a Noetherian local ring.
Let $E$ be an injective hull of $\kappa$ over $R$.
Let $E_n$ be an injective hull of $\kappa$ over $R/\mathfrak m^n$.
Then $E = \bigcup E_n$ and $E_n = E[\mathfrak m^n]$.
\end{lemma}

\begin{proof}
We have $E_n = E[\mathfrak m^n]$ by Lemma \ref{lemma-quotient}.
We have $E = \bigcup E_n$ because $\bigcup E_n = E[\mathfrak m^\infty]$
is an injective $R$-submodule which contains $\kappa$, see
Lemma \ref{lemma-injective-module-divide}.
\end{proof}

\noindent
The following lemma tells us the injective hull of the residue
field of a Noetherian local ring only depends on the completion.

\begin{lemma}
\label{lemma-compare}
Let $R \to S$ be a flat local homomorphism of local Noetherian rings
such that $R/\mathfrak m_R \cong S/\mathfrak m_R S$.
Then the injective hull of the residue field
of $R$ is the injective hull of the residue field of $S$.
\end{lemma}

\begin{proof}
Set $\kappa = R/\mathfrak m_R = S/\mathfrak m_S$.
Let $E_R$ be the injective hull of $\kappa$ over $R$.
Let $E_S$ be the injective hull of $\kappa$ over $S$.
Observe that $E_S$ is an injective $R$-module by
Lemma \ref{lemma-injective-flat}.
Choose an extension $E_R \to E_S$ of the identification of
residue fields. This map is an isomorphism by
Lemma \ref{lemma-union-artinian}
because $R \to S$ induces an isomorphism
$R/\mathfrak m_R^n \to S/\mathfrak m_S^n$ for all $n$.
\end{proof}

\begin{lemma}
\label{lemma-endos}
Let $(R, \mathfrak m, \kappa)$ be a Noetherian local ring.
Let $E$ be an injective hull of $\kappa$ over $R$. Then
$\Hom_R(E, E)$ is canonically isomorphic to the completion of $R$.
\end{lemma}

\begin{proof}
Write $E = \bigcup E_n$ with $E_n = E[\mathfrak m^n]$ as in
Lemma \ref{lemma-union-artinian}. Any endomorphism of $E$
preserves this filtration. Hence
$$
\Hom_R(E, E) = \lim \Hom_R(E_n, E_n)
$$
The lemma follows as
$\Hom_R(E_n, E_n) = \Hom_{R/\mathfrak m^n}(E_n, E_n) = R/\mathfrak m^n$
by Lemma \ref{lemma-evaluate}.
\end{proof}

\begin{lemma}
\label{lemma-injective-hull-has-dcc}
Let $(R, \mathfrak m, \kappa)$ be a Noetherian local ring.
Let $E$ be an injective hull of $\kappa$ over $R$. Then
$E$ satisfies the descending chain condition.
\end{lemma}

\begin{proof}
If $E \subset M_1 \subset M_2 \ldots$ is a sequence of submodules, then
$$
\Hom_R(E, E) \to \Hom_R(M_1, E) \to \Hom_R(M_2, E) \to \ldots
$$
is sequence of surjections. By Lemma \ref{lemma-endos} each of these is a
module over the completion $R^\wedge = \Hom_R(E, E)$.
Since $R^\wedge$ is Noetherian
(Algebra, Lemma \ref{algebra-lemma-completion-Noetherian-Noetherian})
the sequence stabilizes: $\Hom_R(M_n, E) = \Hom_R(M_{n + 1}, E) = \ldots$.
Since $E$ is injective, this can only happen if $\Hom_R(M_n/M_{n + 1}, E)$
is zero. However, if $M_n/M_{n + 1}$ is nonzero, then it contains a
nonzero element annihilated by $\mathfrak m$, because $E$ is
$\mathfrak m$-power torsion by Lemma \ref{lemma-union-artinian}.
In this case $M_n/M_{n + 1}$ has a nonzero map into $E$, contradicting
the assumed vanishing. This finishes the proof.
\end{proof}

\begin{lemma}
\label{lemma-describe-categories}
Let $(R, \mathfrak m, \kappa)$ be a Noetherian local ring.
Let $E$ be an injective hull of $\kappa$.
\begin{enumerate}
\item For an $R$-module $M$ the following are equivalent:
\begin{enumerate}
\item $M$ satisfies the ascending chain condition,
\item $M$ is a finite $R$-module, and
\item there exist $n, m$ and an exact sequence
$R^{\oplus m} \to R^{\oplus n} \to M \to 0$.
\end{enumerate}
\item For an $R$-module $M$ the following are equivalent:
\begin{enumerate}
\item $M$ satisfies the descending chain condition,
\item $M$ is $\mathfrak m$-power torsion and
$\dim_\kappa(M[\mathfrak m]) < \infty$, and
\item there exist $n, m$ and an exact sequence
$0 \to M \to E^{\oplus n} \to E^{\oplus m}$.
\end{enumerate}
\end{enumerate}
\end{lemma}

\begin{proof}
We omit the proof of (1).

\medskip\noindent
Let $M$ be an $R$-module with the descending chain condition. Let $x \in M$.
Then $\mathfrak m^n x$ is a descending chain of submodules, hence stabilizes.
Thus $\mathfrak m^nx = \mathfrak m^{n + 1}x$ for some $n$. By Nakayama's lemma
(Algebra, Lemma \ref{algebra-lemma-NAK}) this implies $\mathfrak m^n x = 0$,
i.e., $x$ is $\mathfrak m$-power torsion. Since $M[\mathfrak m]$ is a vector
space over $\kappa$ it has to be finite dimensional in order to have the
descending chain condition.

\medskip\noindent
Assume that $M$ is $\mathfrak m$-power torsion and has a finite dimensional
$\mathfrak m$-torsion submodule $M[\mathfrak m]$. By
Lemma \ref{lemma-torsion-submodule-sum-injective-hulls}
we see that $M$ is a submodule of $E^{\oplus n}$ for some $n$.
Consider the quotient $N = E^{\oplus n}/M$. By
Lemma \ref{lemma-injective-hull-has-dcc} the module $E$ has the
descending chain condition hence so do $E^{\oplus n}$ and $N$.
Therefore $N$ satisfies (2)(a) which implies $N$ satisfies
(2)(b) by the second paragraph of the proof. Thus by
Lemma \ref{lemma-torsion-submodule-sum-injective-hulls}
again we see that $N$ is a submodule of $E^{\oplus m}$ for some $m$.
Thus we have a short exact sequence
$0 \to M \to E^{\oplus n} \to E^{\oplus m}$.

\medskip\noindent
Assume we have a short exact sequence
$0 \to M \to E^{\oplus n} \to E^{\oplus m}$.
Since $E$ satisfies the descending chain condition by
Lemma \ref{lemma-injective-hull-has-dcc}
so does $M$.
\end{proof}

\begin{proposition}[Matlis duality]
\label{proposition-matlis}
Let $(R, \mathfrak m, \kappa)$ be a complete local Noetherian ring.
Let $E$ be an injective hull of $\kappa$ over $R$. The functor
$D(-) = \Hom_R(-, E)$ induces an anti-equivalence
$$
\left\{
\begin{matrix}
R\text{-modules with the} \\
\text{descending chain condition}
\end{matrix}
\right\}
\longleftrightarrow
\left\{
\begin{matrix}
R\text{-modules with the} \\
\text{ascending chain condition}
\end{matrix}
\right\}
$$
and we have $D \circ D = \text{id}$ on either side of the equivalence.
\end{proposition}

\begin{proof}
By Lemma \ref{lemma-endos} we have $R = \Hom_R(E, E) = D(E)$.
Of course we have $E = \Hom_R(R, E) = D(R)$. Since $E$ is injective
the functor $D$ is exact. The result now follows immediately from the
description of the categories in
Lemma \ref{lemma-describe-categories}.
\end{proof}




















\section{Local cohomology}
\label{section-local-cohomology}

\noindent
Let $A$ be a ring and let $I \subset A$ be a finitely generated ideal
(if $I$ is not finitely generated perhaps a different definition
should be used). Consider the functor
$$
\Gamma_Z : \text{Mod}_A \longrightarrow \text{Mod}_A,\quad
M \longmapsto \bigcup M[I^n]
$$
which sends $M$ to the submodule of $I$-power torsion.
This functor is left exact and has a derived extension
$R\Gamma_Z : D(A) \to D(A)$. Note that for every $K \in D(A)$
there is a canonical map $R\Gamma_Z(K) \to K$.

\begin{lemma}
\label{lemma-local-cohomology-closed}
With notation as above. The functors $\Gamma_Z$ and $R\Gamma_Z$
depend only on the closed subset $Z = V(I) \subset \Spec(A)$.
\end{lemma}

\begin{proof}
Let $M$ be an $A$-module. Let $x \in M$. If $x \in \Gamma_Z(M)$, then $x$
maps to zero in $M_f$ for all $f \in I$. Hence $x$ maps to zero in
$M_\mathfrak p$ for all $\mathfrak p \not \supset I$. Conversely, if $x$
maps to zero in $M_\mathfrak p$ for all $\mathfrak p \not \supset I$,
then $x$ maps to zero in $M_f$ for all $f \in I$. Hence if
$I = (f_1, \ldots, f_r)$, then $f_i^{n_i}x = 0$ for some $n_i \geq 1$.
It follows that $x \in M[I^{\sum n_i}]$. Thus $\Gamma_Z(M)$ is
the kernel of $M \to \prod_{\mathfrak p \not \in Z} M_\mathfrak p$.
\end{proof}

\begin{lemma}
\label{lemma-local-cohomology-ext}
With notation as above. For any $A$-module $M$ we have
$$
R^q\Gamma_Z(M) = \colim_n \text{Ext}_A^q(A/I^n, M)
$$
\end{lemma}

\begin{proof}
This follows immediately from the fact that $M[I^n] = \Hom_A(A/I^n, M)$.
\end{proof}

\begin{lemma}
\label{lemma-local-cohomology-if-annihilated-noetherian}
With notation as above. If $A$ is Noetherian and the $A$-module $M$
is $I$-power torsion, then the canonical map $R\Gamma_Z(M) \to M$ is an
isomorphism in $D(A)$.
\end{lemma}

\begin{proof}
By Lemma \ref{lemma-injective-module-divide}
we see that $M$ has an injective resolution $M \to J^0 \to J^1 \to \ldots$
with $J^p = J^p[I^\infty]$ completely $I$-power torsion. The result follows.
\end{proof}

\begin{lemma}
\label{lemma-compute-local-cohomology-noetherian}
If $A$ is a Noetherian ring and $I = (f_1, \ldots, f_r)$ an ideal.
There is a canonical isomorphism
$$
(A \to \prod\nolimits_{i_0} A_{f_{i_0}} \to
\prod\nolimits_{i_0 < i_1} A_{f_{i_0}f_{i_1}} \to
\ldots \to A_{f_1\ldots f_r}) \longrightarrow R\Gamma_Z(A)
$$
in $D(A)$.
\end{lemma}

\begin{proof}
There is a canonical map of complexes
$$
(A \to \prod\nolimits_{i_0} A_{f_{i_0}} \to
\prod\nolimits_{i_0 < i_1} A_{f_{i_0}f_{i_1}} \to
\ldots \to A_{f_1\ldots f_r}) \longrightarrow A.
$$
Applying $R\Gamma_Z$ we get a map
$$
R\Gamma_Z(A \to \prod\nolimits_{i_0} A_{f_{i_0}} \to
\prod\nolimits_{i_0 < i_1} A_{f_{i_0}f_{i_1}} \to
\ldots \to A_{f_1\ldots f_r}) \longrightarrow R\Gamma_Z(A).
$$
This map is an isomorphism as clearly $R\Gamma_Z(A_f) = 0$
for all $f \in I$. On the other hand, the homology modules
of the complex
$A \to \prod\nolimits_{i_0} A_{f_{i_0}} \to
\prod\nolimits_{i_0 < i_1} A_{f_{i_0}f_{i_1}} \to
\ldots \to A_{f_1\ldots f_r}$
are $I$-power torsion by
More on Algebra, Lemmas
\ref{more-algebra-lemma-extended-alternating-Cech-is-colimit-koszul} and
\ref{more-algebra-lemma-homotopy-koszul}. Thus the canonical map
$$
\xymatrix{
R\Gamma_Z(A \to \prod\nolimits_{i_0} A_{f_{i_0}} \to
\prod\nolimits_{i_0 < i_1} A_{f_{i_0}f_{i_1}} \to
\ldots \to A_{f_1\ldots f_r}) \ar[d] \\
(A \to \prod\nolimits_{i_0} A_{f_{i_0}} \to
\prod\nolimits_{i_0 < i_1} A_{f_{i_0}f_{i_1}} \to
\ldots \to A_{f_1\ldots f_r})
}
$$
is an isomorphism in $D(A)$ by
Lemma \ref{lemma-local-cohomology-if-annihilated-noetherian}
and the spectral sequence of
Derived Categories, Lemma \ref{derived-lemma-two-ss-complex-functor}.
\end{proof}

\begin{lemma}
\label{lemma-local-cohomology-change-rings}
If $A \to B$ is a homomorphism of Noetherian rings and $I \subset A$
is an ideal, then
$$
R\Gamma_Z(A) \otimes_A^\mathbf{L} B = R\Gamma_Y(B)
$$
where $Y = V(IB) \subset \Spec(B)$.
\end{lemma}

\begin{proof}
This is clear from Lemma \ref{lemma-compute-local-cohomology-noetherian}
and the fact that formation of the extended {\v C}ech complex
commutes with base change.
\end{proof}







\section{Sections with support in a closed subscheme}
\label{section-sections-with-exact-support}

\noindent
Let $A$ be a ring and let $I \subset A$ be a finitely generated ideal
(if $I$ is not finitely generated perhaps a different definition
should be used). Set $B = A/I$. Consider the functor
$$
\Hom(B, -) : \text{Mod}_A \longrightarrow \text{Mod}_B,\quad
M \longmapsto M[I] = \Hom_A(B, M)
$$
which sends $M$ to the submodule of $I$-torsion.
This functor is left exact and has a derived extension
$R\Hom(B, -) : D(A) \to D(B)$. Note that for every $K \in D(A)$
there is a canonical map $i_*R\Hom(B, K) \to K$ where
$i_* : D(B) \to D(A)$ is the obvious functor.

\begin{lemma}
\label{lemma-exact-support-ext}
With notation as above. For any $A$-module $M$ we have
$$
R^q\Hom(B, M) = \text{Ext}_A^q(B, M)
$$
as $A$-modules (the left hand side starts out as a $B$-module).
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\noindent
Let $X$ be a scheme and let $Z \subset X$ be a closed subscheme
with corresponding quasi-coherent ideal sheaf $\mathcal{I}$.
Let $i : Z \to X$ be the inclusion morphism.
Consider the functor which associates to a sheaf of $\mathcal{O}_X$-modules
$\mathcal{F}$ the sheaf
$$
\SheafHom(\mathcal{O}_Z, \mathcal{F}) =
\SheafHom_{i^{-1}\mathcal{O}_X}(\mathcal{O}_Z, i^{-1}\mathcal{F})
$$
We spell out what this means.

\begin{lemma}
\label{lemma-compute-sheaf-with-exact-support}
In the situation above we have
$$
i_*\SheafHom(\mathcal{O}_Z, \mathcal{F}) =
\SheafHom_{\mathcal{O}_X}(i_*\mathcal{O}_Z, \mathcal{F})
$$
For $V \subset Z$ open we have
$$
\Gamma(V, \SheafHom(\mathcal{O}_Z, \mathcal{F})) =
\{s \in \Gamma(U, \mathcal{F}) \mid \mathcal{I}s = 0\}
$$
where $U \subset X$ is an open whose intersection with $Z$ is $V$.
\end{lemma}

\begin{proof}
Let $V = Z \cap U$ as in the statement of the lemma. Then
$$
\SheafHom(\mathcal{O}_Z, \mathcal{F})(V) =
\Hom_{i^{-1}\mathcal{O}_U}(\mathcal{O}_V, i^{-1}\mathcal{F}|_V) =
\Hom_{\mathcal{O}_U}(i_*\mathcal{O}_Z|_U, \mathcal{F}|_U)
$$
by adjunction between $i_*$ and $i^{-1}$. This immediately proves (1)
and (2) follows as $\mathcal{O}_X \to i_*\mathcal{O}_Z$ is surjective
with kernel $\mathcal{I}$.
\end{proof}

\noindent
The functor
$$
\SheafHom(\mathcal{O}_Z, -) :
\textit{Mod}(\mathcal{O}_X)
\longrightarrow
\textit{Mod}(\mathcal{O}_Z),
\quad
\mathcal{F} \longmapsto \SheafHom(\mathcal{O}_Z, \mathcal{F})
$$
is left exact and has a derived extension
$$
R\SheafHom(\mathcal{O}_Z, -) : D(\mathcal{O}_X) \to D(\mathcal{O}_Z).
$$
Note that for every $K \in D(\mathcal{O}_X)$
there is a canonical map $i_*R\SheafHom(\mathcal{O}_Z, K) \to K$ where
$i_* : D(\mathcal{O}_Z) \to D(\mathcal{O}_X)$ is the obvious functor.

\begin{lemma}
\label{lemma-sheaf-with-exact-support-ext}
With notation as above. For any $\mathcal{O}_X$-module $\mathcal{F}$
we have
$$
i_*R\SheafHom(\mathcal{O}_Z, \mathcal{F}) =
R\SheafHom(i_*\mathcal{O}_Z, \mathcal{F})
$$
in $D(\mathcal{O}_X)$ and hence
$
i_*R^q\SheafHom(\mathcal{O}_Z, \mathcal{F}) =
\text{Ext}_{\mathcal{O}_X}^q(i_*\mathcal{O}_Z, \mathcal{F})
$
as $\mathcal{O}_X$-modules.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-sheaf-with-exact-support-quasi-coherent}
In the situation above, assume $i : Z \to X$ is a pseudo-coherent
morphism (for example if $X$ is Noetherian).
Then $R\SheafHom(\mathcal{O}_Z, -)$ maps $D^+_\QCoh(\mathcal{O}_X)$
into $D^+_\QCoh(\mathcal{O}_Z)$.
\end{lemma}

\begin{proof}
Let $K$ be an object of $D^+_\QCoh(\mathcal{O}_X)$.
By Morphisms, Lemma \ref{morphisms-lemma-i-star-equivalence}
it suffices to show that $i_*$ applied to
$H^n(R\SheafHom(\mathcal{O}_Z, K))$ produces a
quasi-coherent module on $X$. By
Lemma \ref{lemma-sheaf-with-exact-support-ext}
this means we have to show that $R\SheafHom(i_*\mathcal{O}_Z, K)$
is in $D_\QCoh(\mathcal{O}_X)$. Since $i$ is pseudo-coherent
the sheaf $\mathcal{O}_Z$ is a pseudo-coherent $\mathcal{O}_X$-module.
Hence the result follows from
Derived Categories of Schemes, Lemma
\ref{perfect-lemma-quasi-coherence-internal-hom}.
To explain the parenthetical remark, if $X$ is Noetherian, then
$i$ is pseudo-coherent by
More on Morphisms, Lemma \ref{more-morphisms-lemma-Noetherian-pseudo-coherent}.
\end{proof}




\section{Projective dimension}
\label{section-projective-dimension}

\noindent
We defined the projective dimension of a module in
Algebra, Definition \ref{algebra-definition-finite-proj-dim}.

\begin{definition}
\label{definition-projective-dimension}
Let $R$ be a ring. Let $K$ be an object of $D(R)$. We say $K$ has
{\it finite projective dimension} if $K$ can be represented by a
finite complex of projective modules. We say $K$ as
{\it projective-amplitude in $[a, b]$} if  $K$ is quasi-isomorphic
to a complex
$$
\ldots \to 0 \to P^a \to P^{a + 1} \to \ldots \to
P^{b - 1} \to P^b \to 0 \to \ldots
$$
where $P^i$ is a projective $R$-module for all $i \in \mathbf{Z}$.
\end{definition}

\noindent
Clearly, $K$ has bounded projective dimension if and only if $K$
has projective-amplitude in $[a, b]$ for some $a, b \in \mathbf{Z}$.
Furthermore, if $K$ has bounded projective dimension, then $K$
is bounded. Here is the obligatory lemma.

\begin{lemma}
\label{lemma-projective-amplitude}
Let $R$ be a ring. Let $K$ be an object of $D(R)$. Let $a, b \in \mathbf{Z}$.
The following are equivalent
\begin{enumerate}
\item $K$ has projective-amplitude in $[a, b]$,
\item $\text{Ext}^i_R(K, N) = 0$ for all $R$-modules $N$ and all
$i \not \in [-b, -a]$.
\end{enumerate}
\end{lemma}

\begin{proof}
Assume (1). We may assume $K$ is the complex
$$
\ldots \to 0 \to P^a \to P^{a + 1} \to \ldots \to
P^{b - 1} \to P^b \to 0 \to \ldots
$$
where $P^i$ is a projective $R$-module for all $i \in \mathbf{Z}$.
In this case we can compute the ext groups by the complex
$$
\ldots \to 0 \to \Hom_R(P^b, N) \to \ldots \to
\Hom_R(P^a, N) \to 0 \to \ldots
$$
and we obtain (2).

\medskip\noindent
Assume (2) holds. Choose an injection $H^n(K) \to I$ where $I$
is an injective $R$-module. Since $\Hom_R(-, I)$ is an exact functor,
we see that $\text{Ext}^{-n}(K, I) = \Hom_R(H^n(K), I)$.
We conclude that $H^n(K)$ is zero for $n \not \in [a, b]$.
In particular, $K$ is bounded above and we can choose a quasi-isomorphism
$$
P^\bullet \to K
$$
with $P^i$ projective (for example free) for all $i \in \mathbf{Z}$ and
$P^i = 0$ for $i > b$. See Derived Categories, Lemma
\ref{derived-lemma-subcategory-left-resolution}.
Let $Q = \Coker(P^{a - 1} \to P^a)$. Then $K$ is quasi-isomorphic
to the complex
$$
\ldots \to 0 \to Q \to P^{a + 1} \to \ldots \to P^b \to 0 \to \ldots
$$
Denote $K' = (P^{a + 1} \to \ldots \to P^b)$ the corresponding object of
$D(R)$. We obtain a distinguished triangle
$$
K' \to K \to Q[-a] \to K'[1]
$$
in $D(R)$. Thus for every $R$-module $N$ an exact sequence
$$
\text{Ext}^{-a}(K', N) \to \text{Ext}^1(Q, N) \to \text{Ext}^{1 - a}(K, N)
$$
By assumption the term on the right vanishes. By the implication
(1) $\Rightarrow$ (2) the term on the left vanishes. Thus $Q$
is a projective $R$-module by
Algebra, Lemma \ref{algebra-lemma-characterize-projective}.
\end{proof}

\begin{example}
\label{example-ext-not-bounded}
Let $k$ be a field and let $R$ be the ring of dual numbers
over $k$, i.e., $R = k[x]/(x^2)$. Denote $\epsilon \in R$ the
class of $x$. Let $M = R/(\epsilon)$. Then $M$ is quasi-isomorphic
to the complex
$$
R \xrightarrow{\epsilon} R \xrightarrow{\epsilon} R \to \ldots
$$
but $M$ does not have finite projective dimension as defined in
Algebra, Definition \ref{algebra-definition-finite-proj-dim}.
This explains why we consider bounded (in both directions) complexes
of projective modules in our definition of bounded projective dimension
of objects of $D(R)$.
\end{example}






\section{Injective dimension}
\label{section-injective-dimension}

\noindent
This section is the dual of the section on projective dimension.

\begin{definition}
\label{definition-injective-dimension}
Let $R$ be a ring. Let $K$ be an object of $D(R)$.
We say $K$ has {\it finite injective dimension} if $K$ can be
represented by a finite complex of injective $R$-modules.
We say $K$ has {\it injective-amplitude in $[a, b]$}
if $K$ is isomorphic to a complex
$$
\ldots \to 0 \to I^a \to I^{a + 1} \to \ldots \to
I^{b - 1} \to I^b \to 0 \to \ldots
$$
with $I^i$ an injective $R$-module for all $i \in \mathbf{Z}$.
\end{definition}

\noindent
Clearly, $K$ has bounded injective dimension if and only if $K$
has injective-amplitude in $[a, b]$ for some $a, b \in \mathbf{Z}$.
Furthermore, if $K$ has bounded injective dimension, then $K$
is bounded. Here is the obligatory lemma.

\begin{lemma}
\label{lemma-injective-amplitude}
Let $R$ be a ring. Let $K$ be an object of $D(R)$. Let $a, b \in \mathbf{Z}$.
The following are equivalent
\begin{enumerate}
\item $K$ has injective-amplitude in $[a, b]$,
\item $\text{Ext}^i_R(N, K) = 0$ for all $R$-modules $N$ and all
$i \not \in [a, b]$.
\end{enumerate}
\end{lemma}

\begin{proof}
Assume (1). We may assume $K$ is the complex
$$
\ldots \to 0 \to I^a \to I^{a + 1} \to \ldots \to
I^{b - 1} \to I^b \to 0 \to \ldots
$$
where $P^i$ is a injective $R$-module for all $i \in \mathbf{Z}$.
In this case we can compute the ext groups by the complex
$$
\ldots \to 0 \to \Hom_R(N, I^a) \to \ldots \to
\Hom_R(N, I^b) \to 0 \to \ldots
$$
and we obtain (2).

\medskip\noindent
Assume (2) holds. Choose an surjection $P \to H^n(K)$ where $P$
is a projective $R$-module. Since $\Hom_R(P, -)$ is an exact functor,
we see that $\text{Ext}^n(P, K) = \Hom_R(P, H^n(K))$.
We conclude that $H^n(K)$ is zero for $n \not \in [a, b]$.
In particular, $K$ is bounded below and we can choose a quasi-isomorphism
$$
K \to I^\bullet
$$
with $I^i$ injective for all $i \in \mathbf{Z}$ and
$I^i = 0$ for $i < a$. See Derived Categories, Lemma
\ref{derived-lemma-subcategory-right-resolution}.
Let $J = \Ker(I^b \to I^{b + 1})$. Then $K$ is quasi-isomorphic
to the complex
$$
\ldots \to 0 \to I^a \to \ldots \to I^{b - 1} \to J \to 0 \to \ldots
$$
Denote $K' = (I^a \to \ldots \to I^{b - 1})$ the corresponding object of
$D(R)$. We obtain a distinguished triangle
$$
J[-b] \to K \to K' \to J[1 - b]
$$
in $D(R)$. Thus for every $R$-module $N$ an exact sequence
$$
\text{Ext}^b(N, K') \to \text{Ext}^1(N, J) \to \text{Ext}^{1 + b}(N, K)
$$
By assumption the term on the right vanishes. By the implication
(1) $\Rightarrow$ (2) the term on the left vanishes. Thus $J$
is a injective $R$-module by
Homology, Lemma \ref{homology-lemma-characterize-injectives}.
\end{proof}

\begin{example}
\label{example-ext-not-bounded-reversed}
Let $k$ be a field and let $R$ be the ring of dual numbers
over $k$, i.e., $R = k[x]/(x^2)$. Denote $\epsilon \in R$ the
class of $x$. Let $M = R/(\epsilon)$. Then $M$ is quasi-isomorphic
to the complex
$$
\ldots \to R \xrightarrow{\epsilon} R \xrightarrow{\epsilon} R
$$
and $R$ is an injective $R$-module. However one usually does not
consider $M$ to have finite injective dimension in this situation.
This explains why we consider bounded (in both directions) complexes
of injective modules in our definition of bounded injective dimension
of objects of $D(R)$.
\end{example}







\section{Generalities on derived hom}
\label{section-RHom}

\noindent
Let $R$ be a ring. Let $L^\bullet$ and $M^\bullet$ be two complexes
of $R$-modules. We construct a complex $\Hom^\bullet(L^\bullet, M^\bullet)$.
Namely, for each $n$ we set
$$
\Hom^n(L^\bullet, M^\bullet) =
\prod\nolimits_{n = p + q} \Hom_R(L^{-q}, M^p)
$$
It is a good idea to think of $\Hom^n$ as the $R$-module of all $R$-linear
maps from $L^\bullet$ to $I^\bullet$ (viewed as graded modules)
which are homogenous of degree $n$. In this terminology, we define the
differential by the rule
$$
\text{d}(f) = \text{d}_M \circ f - (-1)^n f \circ \text{d}_L
$$
for $f \in \Hom^n(L^\bullet, M^\bullet)$. This construction is a special\
case of
Differential Graded Algebra, Example \ref{dga-example-category-complexes}.
In particular, we have
$$
H^n(\Hom^\bullet(L^\bullet, M^\bullet)) = \Hom_{K(R)}(L^\bullet, M^\bullet[n])
$$
for all $n \in \mathbf{Z}$.

\begin{lemma}
\label{lemma-compose}
Let $R$ be a ring. Given complexes $K^\bullet, L^\bullet, M^\bullet$
of $R$-modules there is a canonical isomorphism
$$
\Hom^\bullet(K^\bullet, \Hom^\bullet(L^\bullet, M^\bullet))
=
\Hom^\bullet(\text{Tot}(K^\bullet \otimes_R L^\bullet), M^\bullet)
$$
of complexes of $R$-modules.
\end{lemma}

\begin{proof}
Let $\alpha$ be an element of degree $n$ on the left hand side.
Thus
$$
\alpha = (\alpha^{p, q}) \in
\prod\nolimits_{p + q = n} \Hom_R(K^{-q}, \Hom^p(L^\bullet, M^\bullet))
$$
Each $\alpha^{p, q}$ is an element
$$
\alpha^{p, q} = (\alpha^{r, s, q}) \in
\prod\nolimits_{r + s + q = n} \Hom_R(K^{-q}, \Hom_R(L^{-s}, M^r))
$$
If we make the identifications
\begin{equation}
\label{equation-identification}
\Hom_R(K^{-q}, \Hom_R(L^{-s}, M^r)) = \Hom_R(K^{-q} \otimes_R L^{-s}, M^r)
\end{equation}
then by our sign rules we get
\begin{align*}
\text{d}(\alpha^{r, s, q})
& =
\text{d}_{\Hom^\bullet(L^\bullet, M^\bullet)} \circ \alpha^{r, s, q}
- (-1)^n \alpha^{r, s, q} \circ \text{d}_K \\
& =
\text{d}_M \circ \alpha^{r, s, q}
- (-1)^{r + s} \alpha^{r, s, q} \circ \text{d}_L
- (-1)^{r + s + q} \alpha^{r, s, q} \circ \text{d}_K
\end{align*}
On the other hand, if $\beta$ is an element of degree $n$ of
the right hand side, then
$$
\beta = (\beta^{r, s, q}) \in \prod\nolimits_{r + s + q = n}
\Hom_R(K^{-q} \otimes_R L^{-s}, M^r)
$$
and by our sign rule (Homology, Definition
\ref{homology-definition-associated-simple-complex}) we get
\begin{align*}
\text{d}(\beta^{r, s, q})
& =
\text{d}_M \circ \beta^{r, s, q}
- (-1)^n \beta^{r, s, q} \circ
\text{d}_{\text{Tot}(K^\bullet \otimes L^\bullet)} \\
& =
\text{d}_M \circ \beta^{r, s, q}
- (-1)^{r + s + q} \left(
\beta^{r, s, q} \circ \text{d}_K + (-1)^{-q} \beta^{r, s, q} \circ \text{d}_L
\right)
\end{align*}
Thus we see that the map induced by the identifications
(\ref{equation-identification}) indeed is a morphism of complexes.
\end{proof}

\begin{lemma}
\label{lemma-evaluate-and-more}
Let $R$ be a ring. Given complexes $K^\bullet, L^\bullet, M^\bullet$
of $R$-modules there is a canonical morphism
$$
\text{Tot}(\Hom^\bullet(L^\bullet, M^\bullet) \otimes_R K^\bullet)
\longrightarrow
\Hom^\bullet(\Hom^\bullet(K^\bullet, L^\bullet), M^\bullet)
$$
of complexes of $R$-modules functorial in all three complexes.
\end{lemma}

\begin{proof}
Consider an element $\beta$ of degree $n$ of the right hand side.
Then
$$
\beta = (\beta^{p, q}) \in
\prod\nolimits_{p + q = n} \Hom_R(\Hom^{-q}(K^\bullet, L^\bullet), M^p)
$$
Each $\beta^{p, q}$ is an element
$$
\beta^{p, q} = (\beta^{p, r, s}) \in
\prod\nolimits_{p + r + s = n} \Hom_R(\Hom_R(K^s, L^{-r}), M^p)
$$
We can apply the differentials $\text{d}_M$ and
$\text{d}_{\Hom^\bullet(K^\bullet, L^\bullet)}$
to the element $\beta^{p, q}$ and we can apply the
differentials $\text{d}_K$, $\text{d}_L$, $\text{d}_M$
to the element $\beta^{p, r, s}$. We omit the precise definitions.
The our sign rules tell us that
\begin{align*}
\text{d}(\beta^{p, r, s})
& =
\text{d}_M(\beta^{p, r, s})
- (-1)^n \text{d}_{\Hom^\bullet(K^\bullet, L^\bullet)}(\beta^{p, r, s}) \\
& =
\text{d}_M(\beta^{p, r, s})
- (-1)^n \left(
\text{d}_L(\beta^{p, r, s}) - (-1)^{r + s} \text{d}_K(\beta^{p, r, s})
\right) \\
& =
\text{d}_M(\beta^{p, r, s})
- (-1)^n \text{d}_L(\beta^{p, r, s})
+ (-1)^p \text{d}_K(\beta^{p, r, s})
\end{align*}
On the other hand, an element $\alpha$
of degree $n$ of the left hand side looks like
$$
\alpha = (\alpha^{t, s}) \in
\bigoplus\nolimits_{t + s = n} \Hom^t(L^\bullet, M^\bullet) \otimes K^s
$$
Each $\alpha^{t, s}$ is an element
$$
\alpha^{t, s} = (\alpha^{p, r, s}) \in
\prod\nolimits_{p + r + s = n} \Hom_R(L^{-r}, M^p) \otimes_R K^s
$$
By our sign rules and with conventions as above we get
\begin{align*}
\text{d}(\alpha^{p, r, s})
& =
\text{d}_{\Hom^\bullet(L^\bullet, M^\bullet)}(\alpha^{p, r, s})
+ (-1)^{p + r} \text{d}_K(\alpha^{p, r, s}) \\
& =
\text{d}_M(\alpha^{p, r, s})
- (-1)^{p + r} \text{d}_L(\alpha^{p, r, s})  +
(-1)^{p + r} \text{d}_K(\alpha^{p, r, s})
\end{align*}
To define our map we will use the canonical maps
$$
c_{p, r, s} : 
\Hom_R(L^{-r}, M^p) \otimes_R K^s
\longrightarrow
\Hom_R(\Hom_R(K^s, L^{-r}), M^p)
$$
which sends $\varphi \otimes k$ to the map $\psi \mapsto \varphi(\psi(k))$.
This is functorial in all three variables.
However, since the signs above do not match we need to use instead
some map
$$
\epsilon_{p, r, s} c_{p, r, s}
$$
for some sign $\epsilon_{p, r, s}$. Looking at the signs above we
find that we need to find a solution for the equations
$$
\epsilon_{p, r, s} = \epsilon_{p + 1, r, s}, \quad
\epsilon_{p, r, s} (-1)^s = \epsilon_{p, r + 1, s}, \quad
\epsilon_{p, r, s} (-1)^r = \epsilon_{p, r, s + 1}
$$
A good solution is to take $\epsilon_{p, r, s} = (-1)^{rs}$.
The choice of this sign is explained in the remark following
the proof.
\end{proof}

\begin{remark}
\label{remark-sign-explanation}
In the yoga of super vector spaces the sign used in the proof
of Lemma \ref{lemma-evaluate-and-more} above can be explained
as follows. A super vector space is just a vector space
$V$ which comes with a direct sum decomposition $V = V^+ \oplus V^-$.
Here we think of the elements of $V^+$ as the even elements
and the elements of $V^-$ as the odd ones. Given two super
vector spaces $V$ and $W$ we set
$$
(V \otimes W)^+ = (V^+ \otimes W^+) \oplus (V^- \otimes W^-)
$$
and similarly for the odd part. In the category of super vectors the
isomorphism
$$
V \otimes W \longrightarrow W \otimes V
$$
is defined to be the usual one, except that on the summand
$V^- \otimes W^-$ we use the negative of the usual identification.
In this way we obtain a tensor category (where $\otimes$ is symmetric
and associative with $1$). The category of super vector spaces has
an internal hom which we denote $V^\vee$. One checks that the
canonical isomorphisms $\Hom(V, W) = W \otimes V^\vee$
and $\Hom(V, W)^\vee = V \otimes W^\vee$ do not involve signs.
Finally, given three super vector spaces
$U$, $V$, $W$ we can consider the analogue
$$
c : \Hom(V, W) \otimes U \longrightarrow \Hom(\Hom(U, V), W)
$$
of the maps $c_{p, r, s}$ which occur in the lemma above.
Using the formulae given above (which do not involve signs)
this becomes a map
$$
W \otimes V^\vee \otimes U
\longrightarrow
W \otimes U \otimes V^\vee
$$
which involves a $(-1)$ on elements $w \otimes v^\vee \otimes u$
if $v^\vee$ and $u$ are odd.
\end{remark}

\noindent
The derived hom functor is an internal hom in the derived category of
$R$-modules in the sense that it is characterized by the formula
\begin{equation}
\label{equation-internal-hom}
\Hom_{D(R)}(K, R\Hom(L, M))
=
\Hom_{D(R)}(K \otimes_R^\mathbf{L} L, M)
\end{equation}
for objects $K, L, M$ of $D(R)$. Note that this formula characterizes
the objects up to unique isomorphism by the Yoneda lemma. A construction
can be given as follows. Choose a K-injective complex $I^\bullet$
of $R$-modules representing $M$, choose an complex $L^\bullet$
representing $L$, and set
$$
R\Hom(L, M) = \Hom^\bullet(L^\bullet, I^\bullet)
$$
with notation as above. It was shown in Differential Graded Categories,
Lemma \ref{dga-lemma-derived-restriction} that this is well defined.
It follows from the discussion above combined with
Derived Categories, Lemma \ref{derived-lemma-K-injective}
that we have
\begin{equation}
\label{equation-h0-RHom}
H^n(R\Hom(L, M)) = \Hom_{D(R)}(L, M[n])
\end{equation}
for all $n \in \mathbf{Z}$.

\begin{lemma}
\label{lemma-internal-hom}
Let $R$ be a ring. Let $K, L, M$ be objects of $D(R)$. There is a canonical
isomorphism
$$
R\Hom(K, R\Hom(L, M)) = R\Hom(K \otimes_R^\mathbf{L} L, M)
$$
in $D(R)$ functorial in $K, L, M$ which recovers
(\ref{equation-internal-hom}) by taking $H^0$.
\end{lemma}

\begin{proof}
Choose a K-injective complex $I^\bullet$ representing
$M$ and a K-flat complex of $R$-modules $L^\bullet$
representing $L$. For any complex of $R$-modules $K^\bullet$
we have
$$
\Hom^\bullet(K^\bullet, \Hom^\bullet(L^\bullet, I^\bullet)) =
\Hom^\bullet(\text{Tot}(K^\bullet \otimes_R L^\bullet), I^\bullet)
$$
by Lemma \ref{lemma-compose}. The lemma follows by the definition
of $R\Hom$ and because
$\text{Tot}(K^\bullet \otimes_R L^\bullet)$
represents the derived tensor product.
\end{proof}

\begin{lemma}
\label{lemma-internal-hom-evaluate}
Let $R$ be a ring. Let $K, L, M$ be objects of $D(R)$.
There is a canonical morphism
$$
R\Hom(L, M) \otimes_R^\mathbf{L} K
\longrightarrow
R\Hom(R\Hom(K, L), M)
$$
in $D(R)$ functorial in $K, L, M$.
\end{lemma}

\begin{proof}
Choose
a K-injective complex $I^\bullet$ representing $M$,
a K-injective complex $J^\bullet$ representing $L$, and
a K-flat complex $K^\bullet$ representing $K$.
The map is defined using the map
$$
\text{Tot}(\Hom^\bullet(J^\bullet, I^\bullet) \otimes_R K^\bullet)
\longrightarrow
\Hom^\bullet(\Hom^\bullet(K^\bullet, J^\bullet), I^\bullet)
$$
of Lemma \ref{lemma-evaluate-and-more}. We omit the proof that
this is functorial in all three objects of $D(R)$.
\end{proof}

\begin{lemma}
\label{lemma-internal-hom-evaluate-isomorphism}
Let $R$ be a ring. Let $K, L, M$ be objects of $D(R)$.
the map
$$
R\Hom(L, M) \otimes_R^\mathbf{L} K \longrightarrow R\Hom(R\Hom(K, L), M)
$$
of Lemma \ref{lemma-internal-hom-evaluate} is an isomorphism
in the following two cases
\begin{enumerate}
\item $K$ perfect, or
\item $K$ is pseudo-coherent, $L \in D^+(R)$, and $M$ finite injective
dimension.
\end{enumerate}
\end{lemma}

\begin{proof}
Choose
a K-injective complex $I^\bullet$ representing $M$,
a K-injective complex $J^\bullet$ representing $L$, and
a bounded above complex of finite projective modules $K^\bullet$
representing $K$. Consider the map of complexes
$$
\text{Tot}(\Hom^\bullet(J^\bullet, I^\bullet) \otimes_R K^\bullet)
\longrightarrow
\Hom^\bullet(\Hom^\bullet(K^\bullet, J^\bullet), I^\bullet)
$$
of Lemma \ref{lemma-evaluate-and-more} which is given by the maps
$$
c_{p, r, s} :
\Hom_R(J^{-r}, I^p) \otimes_R K^s
\longrightarrow
\Hom_R(\Hom_R(K^s, J^{-r}), I^p)
$$
Since each $K^s$ is finite projective, these maps are isomorphisms.
Now observe that for every element $\alpha = (\alpha^{p, r, s})$
of degree $n$ of the right hand side, there are only finitely
many values of $s$ such that $\alpha^{p, r, s}$ is nonzero
(for some $p, r$ with $n = p + r + s$). Hence our map
is an isomorphism if the same vanishing condition is forced
on the elements $\beta = (\beta^{p, r, s})$ of the right hand side.
If $K^\bullet$ is a bounded complex of finite projective
modules, this is clear. On the other hand, if we can choose
$I^\bullet$ bounded and $J^\bullet$ bounded below, then
$\beta^{p, r, s}$ is zero for $p$ outside a fixed range, for
$s \gg 0$, and for $r \gg 0$. Hence among solutions of $n = p + r + s$
with $\beta^{p, r, s}$ nonzero only a finite number of $s$ values
occur.
\end{proof}

\begin{lemma}
\label{lemma-internal-hom-evaluate-isomorphism-technical}
Let $R$ be a ring. Let $K, L, M$ be objects of $D(R)$.
the map
$$
R\Hom(L, M) \otimes_R^\mathbf{L} K \longrightarrow R\Hom(R\Hom(K, L), M)
$$
of Lemma \ref{lemma-internal-hom-evaluate} is an isomorphism
if the following three conditions are satisfied
\begin{enumerate}
\item $L, M$ have finite injective dimension,
\item $R\Hom(L, M)$ has finite tor dimension,
\item for every $n \in \mathbf{Z}$ the truncation $\tau_{\leq n}K$
is pseudo-coherent
\end{enumerate}
\end{lemma}

\begin{proof}
Pick an integer $n$ and consider the distinguihsed triangle
$$
\tau_{\leq n}K \to K \to \tau_{\geq n + 1}K \to \tau_{\leq n}K[1]
$$
see Derived Categories, Remark
\ref{derived-remark-truncation-distinguished-triangle}.
By assumption (3) and Lemma \ref{lemma-internal-hom-evaluate-isomorphism}
the map is an isomorphism for $\tau_{\leq n}K$. Hence it
suffices to show that both
$$
R\Hom(L, M) \otimes_R^\mathbf{L} \tau_{\geq n + 1}K
\quad\text{and}\quad
R\Hom(R\Hom(\tau_{\geq n + 1}K, L), M)
$$
have vanishing cohomology in degrees $\leq n - c$ for some $c$.
This follows immediately from assumptions (2) and (1).
\end{proof}



\section{Dualizing complexes}
\label{section-dualizing}

\noindent
In this section we define dualizing complexes for Noetherian rings.
Let $A$ be a Noetherian ring. We will denote
$$
D_{Coh}(A) \subset D(A)
$$
the full subcategory consisting of those objects $K$ of $D(A)$
whose cohomology modules are all finite $A$-modules. This makes sense
by Derived Categores, Section \ref{derived-section-triangulated-sub}
because as $A$ is Noetherian, the subcategory of finite $A$-modules
is a Serre subcategory of $\text{Mod}_A$.

\begin{definition}
\label{definition-dualizing}
Let $A$ be a Noetherian ring. A {\it dualizing complex} is a
complex of $A$-modules $\omega_A^\bullet$ such that
\begin{enumerate}
\item $\omega_A^\bullet$ has finite injective dimension,
\item $H^i(\omega_A^\bullet)$ is a finite $A$-module for all $i$, and
\item $A \to R\Hom(\omega_A^\bullet, \omega_A^\bullet)$
is a quasi-isomorphism.
\end{enumerate}
\end{definition}

\noindent
This definition takes some time getting used to. It is perhaps a good
idea to prove some of the following lemmas yourself without reading
the proofs.

\begin{lemma}
\label{lemma-dualizing}
Let $A$ be a Noetherian ring. If $\omega_A^\bullet$ is a dualizing
complex, then the functor
$$
K \longrightarrow R\Hom(K, \omega_A^\bullet)
$$
is an anti-equivalence $D_{\textit{Coh}}(A) \to D_{\textit{Coh}}(A)$
which exchanges $D^+_{\textit{Coh}}(A)$ and $D^-_{\textit{Coh}}(A)$
and induces an equivalence $D^b_{\textit{Coh}}(A) \to D^b_{\textit{Coh}}(A)$.
\end{lemma}

\begin{proof}
Let $K$ be an object of $D_{\textit{Coh}}(A)$. Pick an integer $n$ and
consider the distinguihsed triangle
$$
\tau_{\leq n}K \to K \to \tau_{\geq n + 1}K \to \tau_{\leq n}K[1]
$$
see Derived Categories, Remark
\ref{derived-remark-truncation-distinguished-triangle}.
Since $\omega_A^\bullet$ has finite injective dimension we see
that $R\Hom(\tau_{\geq n + 1}K, \omega_A^\bullet)$ has vanishing
cohomology in degrees $\geq n - c$ for some constant $c$.
On the other hand, we obtain a spectral sequence
$$
\text{Ext}_A^p(H^{-q}(\tau_{\leq n}K, \omega_A^\bullet)
\Rightarrow
\text{Ext}_A^{p + q}(\tau_{\leq n}K, \omega_A^\bullet) =
H^{p + q}(R\Hom(\tau_{\leq n}K, \omega_A^\bullet))
$$
which shows that these cohomology modules are finite. Since for
$n > p + q + c$ this is equal to $H^{p + q}(R\Hom(K, \omega_A^\bullet))$
we see that $R\Hom(K, \omega_A^\bullet)$ is indeed an object
of $D_{\textit{Coh}}(A)$.
By Lemma \ref{lemma-internal-hom-evaluate-isomorphism-technical}
and the assumptions on the dualizing complex
we obtain a canonical isomorphism
$$
K = R\Hom(\omega_A^\bullet, \omega_A^\bullet) \otimes_A^\mathbf{L} K
\longrightarrow
R\Hom(R\Hom(K, \omega_A^\bullet), \omega_A^\bullet)
$$
Thus our functor has a quasi-inverse and the proof is complete.
\end{proof}

\begin{lemma}
\label{lemma-detect-cohomology}
Let $A$ be a Noetherian ring. Let $K \in D^b_{\textit{Coh}}(A)$.
Let $\mathfrak m$ be a maximal ideal of $A$.
If $H^i(K)/\mathfrak m H^i(K) \not = 0$, then there exists a finite
$A$-module $E$ annihilated by a power of $\mathfrak m$
and a map $K \to E[-i]$ which is nonzero on $H^i(K)$.
\end{lemma}

\begin{proof}
Let $I$ be the injective hull of the residue field of $\mathfrak m$.
If $H^i(K)/\mathfrak m H^i(K) \not = 0$, then there exists a nonzero
map $H^i(K) \to I$. Since $I$ is injective, we can lift this to a
nonzero map $K \to I[-i]$. Recall that $I = \bigcup I[\mathfrak m^n]$,
see Lemma \ref{lemma-torsion-submodule-sum-injective-hulls}
and that each of the modules $E = I[\mathfrak m^n]$ is of the
desired type. Thus it suffices to prove that
$$
\Hom_{D(A)}(K, I) = \colim \Hom_{D(A)}(K, I[\mathfrak m^n])
$$
This would be immediate if $K$ where a compact object
(or a perfect object) of $D(A)$. This is not the case, but
$K$ is a pseudo-coherent object which is enough here. Namely,
we can represent $K$ by a bounded above complex of finite
free $R$-modules $K^\bullet$. In this case the $\Hom$ groups
above are computed by using $\Hom_{K(A)}(K^\bullet, -)$.
As each $K^n$ is finite free the limit statement holds and the
proof is complete.
\end{proof}

\noindent
Let $R$ be a ring. We will say that an object $L$ of $D(R)$ is
{\it invertible} if there is an open covering $\Spec(R) = \bigcup D(f_i)$
such that $L \otimes_R R_{f_i} \cong R_{f_i}[-n_i]$ for some integers $n_i$.
In this case, the function
$$
\mathfrak p \mapsto n_\mathfrak p,\quad
\text{where }n_\mathfrak p\text{ is the unique integer such that }
H^{n_\mathfrak p}(L \otimes \kappa(\mathfrak p)) \not = 0
$$
is locally constant on $\Spec(R)$. In particular, it follows that
$L = \bigoplus H^n(L)[-n]$ which gives a well defined complex of
$R$-modules (with zero differentials) representing $L$. Since each
$H^n(L)$ is finite projective and nonzero for only a finite number of
$n$ we also see that $L$ is a perfect object of $D(R)$.

\begin{lemma}
\label{lemma-equivalence-comes-from-invertible}
Let $A$ be a Noetherian ring. Let
$F : D^b_{\textit{Coh}}(A) \to D^b_{\textit{Coh}}(A)$ be an equivalence
of categories. Then $F(A)$ is an invertible object of $D(A)$.
\end{lemma}

\begin{proof}
Let $\mathfrak m \subset A$ be a maximal ideal with residue field $\kappa$.
Consider the object $F(\kappa)$. Since
$\kappa = \Hom_{D(A)}(\kappa, \kappa)$ we find that all
cohomology groups of $F(\kappa)$ are annihilated by $\mathfrak m$.
We also see that
$$
\text{Ext}^i_A(\kappa, \kappa) = \text{Ext}^i_A(F(\kappa), F(\kappa))
= \Hom_{D(A)}(F(\kappa), F(\kappa)[-i])
$$
is zero for $i < 0$. Say $H^a(F(\kappa)) \not = 0$ and
$H^b(F(\kappa)) \not = 0$ with $a$ minimal and $b$ maximal
(so in particular $a \leq b$). Then there is a nonzero map
$$
F(\kappa) \to H^b(F(\kappa))[-b] \to H^a(F(\kappa))[-b]
\to F(\kappa)[a - b]
$$
in $D(A)$ (nonzero because it induces a nonzero map on cohomology).
This proves that $b = a$. We conclude that $F(\kappa) = \kappa[-a]$.

\medskip\noindent
Let $G$ be a quasi-inverse to our functor $F$. Arguing as above
we find an integer $b$ such that $G(\kappa) = \kappa[-b]$.
On composing we find $a + b = 0$. Let $E$ be a finite $A$-module
wich is annihilated by a power of $\mathfrak m$. Arguing by
induction on the length of $E$ we find that $G(E) = E'[-b]$
for some finite $A$-module $E'$ annihilated by a power of
$\mathfrak m$. Then $E[-a] = F(E')$.
Next, we consider the groups
$$
\text{Ext}^i_A(A, E') = \text{Ext}^i_A(F(A), F(E')) =
\Hom_{D(A)}(F(A), E[-a + i])
$$
The left hand side is nonzero if and only if $i = 0$ and then
we get $E'$. Applying this with $E = E' = \kappa$ and using Nakayama's
lemma this implies that $H^j(F(A))$ is zero for $j > a$ and
generated by $1$ element for $j = a$. On the other hand, if
$H^j(F(A))_\mathfrak m$ is not zero for some $j < a$, then
there is a map $F(A) \to E[-a + i]$ for some $i < 0$ and some
$E$ (Lemma \ref{lemma-detect-cohomology})
Thus we see that $F(A)_\mathfrak m = M[-a]$
for some $A_\mathfrak m$-module $M$ generated by $1$ element.
However, since
$$
A_\mathfrak m = \Hom_{D(A)}(A, A)_\mathfrak m =
\Hom_{D(A)}(F(A), F(A))_\mathfrak m = \Hom_{A_\mathfrak m}(M, M)
$$
we see that $M \cong A_\mathfrak m$. We conclude that there exists
an element $f \in A$, $f \not \in \mathfrak m$ such that
$F(A)_f$ is isomorphic to $A_f[-a]$. This finishes the proof.
\end{proof}

\begin{lemma}
\label{lemma-dualizing-unique}
Let $A$ be a Noetherian ring. If $\omega_A^\bullet$ and
$(\omega'_A)^\bullet$ are dualizing complexes, then
$(\omega'_A)^\bullet \cong \omega_A^\bullet \otimes_A^\mathbf{L} L$
for some invertible object $L$ of $D(A)$.
\end{lemma}

\begin{proof}
By Lemmas \ref{lemma-dualizing} and
\ref{lemma-equivalence-comes-from-invertible} the functor
$K \mapsto R\Hom(R\Hom(K, \omega_A^\bullet), (\omega_A')^\bullet)$
maps $A$ to an invertible object $L$. In other words, there is
an isomorphism
$$
L \longrightarrow R\Hom(\omega_A^\bullet, (\omega_A')^\bullet)
$$
Since $L$ has finite tor dimension, this means that we can apply
Lemma \ref{lemma-internal-hom-evaluate-isomorphism-technical}
to see that
$$
R\Hom(\omega_A^\bullet, (\omega'_A)^\bullet) \otimes_A^\mathbf{L} K
\longrightarrow
R\Hom(R\Hom(K, \omega_A^\bullet), (\omega_A')^\bullet)
$$
is an isomorphism for $K$ in $D^b_{\textit{Coh}}(A)$.
In particular, setting $K = \omega_A^\bullet$ finishes the proof.
\end{proof}

\begin{lemma}
\label{lemma-dualizing-localize}
Let $A$ be a Noetherian ring. Let $B = S^{-1}A$ be a localization.
If $\omega_A^\bullet$ is a dualizing
complex, then $\omega_A^\bullet \otimes_A B$ is a dualizing
complex for $B$.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}







\input{chapters}

\bibliography{my}
\bibliographystyle{amsalpha}

\end{document}
